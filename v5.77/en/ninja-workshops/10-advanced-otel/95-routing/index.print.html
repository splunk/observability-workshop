<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=generator content="Relearn 7.2.1"><meta name=description content="The routing connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Routing :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="The routing connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.77/en/ninja-workshops/10-advanced-otel/95-routing/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Routing :: Splunk Observability Cloud Workshops"><meta property="og:description" content="The routing connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Routing :: Splunk Observability Cloud Workshops"><meta itemprop=description content="The routing connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta itemprop=dateModified content="2025-01-30T15:47:31+00:00"><meta itemprop=wordCount content="771"><title>Routing :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.77/en/ninja-workshops/10-advanced-otel/95-routing/index.html rel=canonical type=text/html title="Routing :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.77/images/favicon.ico?1738252789 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.77/css/fontawesome-all.min.css?1738252789 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.77/css/fontawesome-all.min.css?1738252789 rel=stylesheet></noscript><link href=/observability-workshop/v5.77/css/auto-complete.css?1738252789 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.77/css/auto-complete.css?1738252789 rel=stylesheet></noscript><link href=/observability-workshop/v5.77/css/perfect-scrollbar.min.css?1738252789 rel=stylesheet><link href=/observability-workshop/v5.77/css/theme.min.css?1738252789 rel=stylesheet><link href=/observability-workshop/v5.77/css/format-print.min.css?1738252789 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.77",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.77/en/ninja-workshops/10-advanced-otel/95-routing/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#setup>Setup</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.77/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.77/en/ninja-workshops/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.77/en/ninja-workshops/10-advanced-otel/index.html><span itemprop=name>Advanced OpenTelemetry</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>10. Routing</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.77/en/ninja-workshops/10-advanced-otel/95-routing/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.77/en/ninja-workshops/10-advanced-otel/90-transform-data/index.html title="Using the OpenTelemetry Transform Processor (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.77/en/ninja-workshops/10-advanced-otel/95-routing/8-1-routing-test/index.html title="Test our Routing Connector (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=routing>Routing</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The routing connector in OpenTelemetry is a powerful feature that allows you to direct data (<code>traces</code>, <code>metrics</code>, or l<code>ogs</code>) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.</p><p>For example, you might want to send <em>production</em> data to one exporter while directing <em>test</em> or <em>development</em> data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic.</p><h3 id=setup>Setup</h3><p>In the <code>[WORKSHOP]</code> directory create a new subdirectory called <code>8-routing</code>, then copy <code>*.yaml</code>, <code>*.json</code> and your <code>log-gen</code> script from the <code>7-transform-data</code> directory.</p><div class=tab-panel data-tab-group=c28a960171a81e8925703686fa88a3d4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=initial-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c28a960171a81e8925703686fa88a3d4","initial-directory-structure")'>
<span class=tab-nav-text>Initial Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=initial-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”œâ”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”œâ”€â”€ 5-dropping-spans
</span></span><span class=line><span class=cl>â”œâ”€â”€ 6-sensitive-data
</span></span><span class=line><span class=cl>â”œâ”€â”€ 7-transform-data
</span></span><span class=line><span class=cl>â”œâ”€â”€ 8-routing
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ log-gen.sh (or .ps1)
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ health.json
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol</span></span></code></pre></div></div></div></div></div><p>In the following exercise, you will configure the <code>routing connector</code> in the <code>gateway.yaml</code> file. This setup will enable the <code>gateway</code> to route traces based on the <code>deployment.environment</code> attribute in the spans you send. By doing so, you can process and handle traces differently depending on their attributes.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Open the <code>gateway.yaml</code> and add the following configuration:</p><ul><li><p><strong>Add the <code>connectors:</code> section</strong>:<br>In OpenTelemetry configuration files, <code>connectors</code> have their own dedicated section, similar to receivers and processors. In the <code>gateway.yaml</code>file, insert the <code>connectors:</code> section below the receivers section and above the processors section.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>connectors</span><span class=p>:</span><span class=w>       </span><span class=c># Section to configure connectors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#memory_limiter:</span></span></span></code></pre></div></li><li><p><strong>Add the <code>routing</code> connector</strong>:<br>In this configuration, spans will be routed if the <code>deployment.environment</code> resource attribute matches <code>"security_applications"</code>.</p><p>This same approach can also be applied to <code>metrics</code> and <code>logs</code>, allowing you to route them based on attributes in <code>resourceMetrics</code> or <code>resourceLogs</code> similarly. Add the following under the <code>connectors:</code> section:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>routing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default_pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/standard]</span><span class=w> </span><span class=c># Default pipeline to use if no matching rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                  </span><span class=w> </span><span class=c># Ignore errors in the routing </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w>                               </span><span class=c># Array with routing rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Connector will route any span to target pipeline if if the resourceSpn attribute matches this rule </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>statement</span><span class=p>:</span><span class=w> </span><span class=l>route() where attributes[&#34;deployment.environment&#34;] == &#34;security_applications&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/security]    </span><span class=w> </span><span class=c># Target pipeline </span></span></span></code></pre></div></li><li><p><strong>Configure two <code>file:</code> Exporters</strong>:
The <code>routing connector</code> requires different targets for routing. To achieve this, update the default <code>file/traces:</code> exporter and name it <code>file/traces/default</code> and add a second file exporter called <code>file/traces/security:</code>. This will allow the routing connector to direct data to the appropriate target based on the rules you define.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/standard</span><span class=p>:</span><span class=w>               </span><span class=c># Exporter Type/Name (For regular traces)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Path where trace data will be saved in OTLP json format </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-standard.out&#34;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>    </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/security</span><span class=p>:</span><span class=w>              </span><span class=c># Exporter Type/Name (For security traces)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Path where trace data will be saved in OTLP json format</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-security.out&#34;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                    </span><span class=c># Overwrite the file each time </span></span></span></code></pre></div></li><li><p><strong>Add both the <code>standard</code> and <code>security traces</code> pipelines</strong>:
To enable routing we need to define two pipelines for traces:</p><ol><li><strong>Standard</strong> pipeline.<br>This pipeline will handle all spans that do not match the routing rule. Add it below the regular <code>traces:</code> pipeline, and leave the configuration unchanged for now.</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#traces:               </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/standard</span><span class=p>:</span><span class=w>         </span><span class=c># Array of Trace Receivers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>routing]  </span><span class=w> </span><span class=c># Only receives spans from the routing connector </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>file/traces/standard, debug]</span><span class=w> </span><span class=c># Location for spans not matching rule</span></span></span></code></pre></div><ul><li>The Target pipeline, that will handle all spans that match the routing rule.</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#traces:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#traces/standard:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/security</span><span class=p>:</span><span class=w>         </span><span class=c># Array of Trace Receivers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>routing]  </span><span class=w> </span><span class=c># Only receives spans from the routing connector </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>file/traces/security, debug]</span><span class=w> </span><span class=c># Location for spans matching rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c>#metrics:</span></span></span></code></pre></div></li><li><p><strong>Update the <code>traces</code> pipeline to handle routing</strong>:<br>To enable <code>routing</code>, update the original <code>traces:</code> pipeline by adding <code>routing</code> as an exporter. This ensures that all span data is sent through the routing connector for evaluation.</p></li></ul><p>For clarity, we are removing the <code>debug</code> exporter from this pipeline, so that debug output is only shown from the new exporters behind the routing connector.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                       </span><span class=c># Original traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]          </span><span class=w> </span><span class=c># Array of Trace Receivers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>routing]      </span><span class=w> </span><span class=c># Array of Trace exporters</span></span></span></code></pre></div><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Keep in mind that any existing processors have been removed from this pipeline. They are now handled by either the standard pipeline or the target pipelines, depending on the routing rules.</p><p>Additionally, the <code>batch</code> processor has been removed from the new pipelines. This ensures that <code>spans</code> are written immediately, rather than waiting for multiple spans to arrive before processing. This change speeds up the workshop and allows you to see results faster.</p></div></details></div></details><p>Again, validate the <code>gateway</code> configuration using <code>otelbin.io</code> for spelling mistakes etc. Your <code>Traces:</code> pipeline should like this:</p><p><a href=#R-image-8284b277ed535e91dd6ca5eb4739e376 class=lightbox-link><img alt="Routing Connector" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../images/routing-8-1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8284b277ed535e91dd6ca5eb4739e376><img alt="Routing Connector" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../images/routing-8-1.png></a>
Lets&rsquo; test our configuration!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 30, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 10. Routing</h1><article class=default><header class=headline></header><h1 id=test-our-routing-connector>Test our Routing Connector</h1><h3 id=setup-test>Setup Test</h3><p>In this section, we will test the <code>routing</code> rule configured for the <code>gateway</code>. The expected result is that the<code>span</code> from the <code>security.json</code> file will be sent to the <code>gateway-traces-security.out</code> file.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><p><strong>Run the Gateway</strong>:
Find your <code>Gateway</code> terminal window, and navigate to the <code>[WORKSHOP]/8-routing</code> directory and restart the gateway with the routing configurations specified in the gateway.yaml.<br>It should start up normally and state : <code>Everything is ready. Begin running and processing data.</code></p></li><li><p><strong>Run the Agent</strong>:
Find your <code>Agent</code> terminal window and navigate to the <code>[WORKSHOP]/8-routing</code> directory and restart the agent with the regular <code>agent.yaml</code>.<br>It should also start up normally and state : <code>Everything is ready. Begin running and processing data.</code></p></li><li><p><strong>Create a trace for different Environments</strong>
Find your <code>Test</code> terminal window and navigate to the <code>[WORKSHOP]/8-routing</code>.<br>To test your configuration, you need to generate span data with the correct <code>ResourceSpan</code> attributes to trigger the routing rule. Copy the following JSON and save it as <code>security.json</code> in the <code>[WORKSHOP]/8-routing</code> directory.</p></li></ul><div class=tab-panel data-tab-group=9a295c96231d5b3d807bac712e8ec56d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9a295c96231d5b3d807bac712e8ec56d","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9a295c96231d5b3d807bac712e8ec56d","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;password_check&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;security_applications&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;keytest&#34;</span><span class=p>:</span><span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some value&#34;</span><span class=p>}}]}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;password_check&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;security_applications&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;keytest&#34;</span><span class=p>:</span> <span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some value&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><h3 id=testing-the-routing-scenario>Testing the routing scenario</h3><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Before proceeding, ensure that there are no <code>*.out</code> files in the <code>[WORKSHOP]/8-routing</code> directory.</p><ul><li><p><strong>Send a Regular Span</strong>:</p><ol><li>Open your test terminal and navigate to the <code>[WORKSHOP]/8-routing</code> directory.</li><li>Send a regular span using the <code>trace.json</code> file to confirm proper communication.</li></ol><p>Both the <code>agent</code> and <code>gateway</code> should display debug information, including the span you just sent. The gateway will also generate a new <code>gateway-traces-standard.out</code> file, as this is now the designated destination for regular spans.</p></li></ul><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you check <code>gateway-traces-standard.out</code>, it should contain the <code>span</code> sent using the <code>cURL</code> command. You will also see an empty <code>gateway-traces-security.out</code> file, as the routing configuration creates output files immediately, even if no matching spans have been processed yet.</p></div></details><ul><li><strong>Send a Security Span</strong>:<ol><li>Ensure both the <code>agent</code> and <code>gateway</code> are running.</li><li>Send a security span using the <code>security.json</code> file to test the gatewayâ€™s routing rule.</li></ol></li></ul><p>Again, both the <code>agent</code> and <code>gateway</code> should display debug information, including the span you just sent. This time, the <code>gateway</code> will write a line to the <code>gateway-traces-security.out</code> file, which is designated for spans where the <code>deployment.environment</code> resource attribute matches <code>"security_applications"</code>.
The <code>gateway-traces-standard.out</code> should be unchanged.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you verify the <code>./gateway-traces-security.out</code> it should only contain the spans from the <code>"security_applications"</code> deployment.environment.</p></div></details><p>You can repeat this scenario multiple times, and each trace will be written to its corresponding output file.</p></div></details><h3 id=conclusion>Conclusion</h3><p>In this section, we successfully tested the routing connector in the gateway by sending different spans and verifying their destinations.</p><ul><li><p><strong>Regular spans</strong> were correctly routed to <code>gateway-traces-default.out</code>, confirming that spans without a matching <code>deployment.environment</code> attribute follow the default pipeline.</p></li><li><p><strong>Security-related spans</strong> from <code>security.json</code> were routed to <code>gateway-traces-security.out</code>, demonstrating that the routing rule based on <code>"deployment.environment": "security_applications"</code> works as expected.</p></li></ul><p>By inspecting the output files, we confirmed that the OpenTelemetry Collector <em>correctly evaluates span attributes and routes them to the appropriate destinations</em>. This validates that routing rules can effectively separate and direct telemetry data for different use cases.</p><p>You can now extend this approach by defining additional routing rules to further categorize spans, metrics, and logs based on different attributes.</p><p>If you want to know more about the <code>routing</code> connector, you can find it <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/routingconnector rel=external target=_blank>here</a></p><p>Stop the <code>agent</code> and <code>gateway</code> using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 30, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.77/js/clipboard.min.js?1738252789 defer></script><script src=/observability-workshop/v5.77/js/perfect-scrollbar.min.js?1738252789 defer></script><script src=/observability-workshop/v5.77/js/theme.js?1738252789 defer></script></body></html>