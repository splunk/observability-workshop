<!doctype html><html id=R-html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 9.0.3+9bc97fdf9eaf3af61af9bcc11db2e010de83af95"><meta name=description content="In this section, weâ€™ll explore how to use the Count Connector to extract attribute values from logs and convert them into meaningful metrics.
Specifically, weâ€™ll use the Count Connector to track the number of â€œStar Warsâ€ and â€œLord of the Ringsâ€ quotes appearing in our logs, turning them into measurable data points.
Exercise Important Change ALL terminal windows to the 7-sum-count directory and run the clear command."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="7. Create metrics with Count Connector :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="In this section, weâ€™ll explore how to use the Count Connector to extract attribute values from logs and convert them into meaningful metrics.
Specifically, weâ€™ll use the Count Connector to track the number of â€œStar Warsâ€ and â€œLord of the Ringsâ€ quotes appearing in our logs, turning them into measurable data points.
Exercise Important Change ALL terminal windows to the 7-sum-count directory and run the clear command."><meta property="og:url" content="https://splunk.github.io/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="7. Create metrics with Count Connector :: Splunk Observability Cloud Workshops"><meta property="og:description" content="In this section, weâ€™ll explore how to use the Count Connector to extract attribute values from logs and convert them into meaningful metrics.
Specifically, weâ€™ll use the Count Connector to track the number of â€œStar Warsâ€ and â€œLord of the Ringsâ€ quotes appearing in our logs, turning them into measurable data points.
Exercise Important Change ALL terminal windows to the 7-sum-count directory and run the clear command."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="7. Create metrics with Count Connector :: Splunk Observability Cloud Workshops"><meta itemprop=description content="In this section, weâ€™ll explore how to use the Count Connector to extract attribute values from logs and convert them into meaningful metrics.
Specifically, weâ€™ll use the Count Connector to track the number of â€œStar Warsâ€ and â€œLord of the Ringsâ€ quotes appearing in our logs, turning them into measurable data points.
Exercise Important Change ALL terminal windows to the 7-sum-count directory and run the clear command."><meta itemprop=dateModified content="2025-09-19T17:43:15+01:00"><meta itemprop=wordCount content="762"><title>7. Create metrics with Count Connector :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/index.html rel=alternate hreflang=x-default><link href=https://splunk.github.io/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/index.html rel=alternate hreflang=en><link href=https://splunk.github.io/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/index.html rel=alternate hreflang=ja><link href=https://splunk.github.io/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/index.html rel=canonical type=text/html title="7. Create metrics with Count Connector :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/images/favicon.ico?1769793354 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/css/auto-complete/auto-complete.min.css?1769793354 rel=stylesheet><script src=/observability-workshop/js/auto-complete/auto-complete.min.js?1769793354 defer></script><script src=/observability-workshop/js/search-lunr.min.js?1769793354 defer></script><script src=/observability-workshop/js/search.min.js?1769793354 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/searchindex.en.js?1769793354"</script><script src=/observability-workshop/js/lunr/lunr.min.js?1769793354 defer></script><script src=/observability-workshop/js/lunr/lunr.stemmer.support.min.js?1769793354 defer></script><script src=/observability-workshop/js/lunr/lunr.multi.min.js?1769793354 defer></script><script src=/observability-workshop/js/lunr/lunr.en.min.js?1769793354 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/observability-workshop/fonts/fontawesome/css/all.min.css?1769793354 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/fonts/fontawesome/css/all.min.css?1769793354 rel=stylesheet></noscript><link href=/observability-workshop/css/perfect-scrollbar/perfect-scrollbar.min.css?1769793354 rel=stylesheet><link href=/observability-workshop/css/theme.min.css?1769793354 rel=stylesheet><link href=/observability-workshop/css/format-print.min.css?1769793354 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/index.html",window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({appplicationName:"observability-workshop",realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",recorder:"splunk",features:{video:!0}})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-origin=/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/ninja-workshops/index.html><span itemprop=name>Splunk4Ninjas Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/index.html><span itemprop=name>OpenTelemetry Collector Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/index.html><span itemprop=name>Advanced OpenTelemetry Collector</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>7. Count & Sum Connector</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/6-routing-data/6-3-test-routing/index.html title="6.3 Test Routing Connector (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/observability-workshop/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/7-sum-count/7-1-count-test/index.html title="7.1 Testing the Count Connector (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=7-create-metrics-with-count-connector>7. Create metrics with Count Connector</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, we&rsquo;ll explore how to use the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector rel=external><strong>Count Connector</strong></a> to extract attribute values from logs and convert them into meaningful metrics.</p><p>Specifically, we&rsquo;ll use the Count Connector to track the number of &ldquo;Star Wars&rdquo; and &ldquo;Lord of the Rings&rdquo; quotes appearing in our logs, turning them into measurable data points.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>7-sum-count</code> directory and run the <code>clear</code> command.</strong></p></div></details><p>Copy <code>*.yaml</code> from the <code>6-routing-data</code> directory into <code>7-sum-count</code>. Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=R-tabs-56a2f382c016e1de0e8e60e4fa338b39><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-88458196b944c21fd069d414e0f7aae5 aria-expanded=true data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-56a2f382c016e1de0e8e60e4fa338b39","R-tab-5a476a4994a778a4fb1b2011e6c9054c")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-88458196b944c21fd069d414e0f7aae5 data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â””â”€â”€ gateway.yaml</span></span></code></pre></div></div></div></div></div><ul><li><strong>Update the agent.yaml</strong> to change the frequency that we read logs.
Find the <code>filelog/quotes</code> receiver in the <code>agent.yaml</code> and add a <code>poll_interval</code> attribute:</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>poll_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s                </span><span class=w> </span><span class=c># Only read every ten seconds </span></span></span></code></pre></div></div></details><p>The reason for the delay is that the Count Connector in the OpenTelemetry Collector counts logs only within each processing interval. This means that every time the data is read, the count resets to zero for the next interval. With the default <code>Filelog reciever</code> interval of 200ms, it reads every line the loadgen writes, giving us counts of 1. With this interval we make sure we have multiple entries to count.</p><p>The Collector can maintain a running count for each read interval by omitting conditions, as shown below. However, itâ€™s best practice to let your backend handle running counts since it can track them over a longer time period.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><strong>Add the Count Connector</strong></li></ul><p>Include the Count Connector in the connector&rsquo;s section of your configuration and define the metrics counters we want to use:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>connectors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logs.full.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Running count of all logs read in interval&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logs.sw.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;StarWarsCount&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>attributes[&#34;movie&#34;] == &#34;SW&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logs.lotr.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;LOTRCount&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>attributes[&#34;movie&#34;] == &#34;LOTR&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logs.error.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ErrorCount&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>attributes[&#34;level&#34;] == &#34;ERROR&#34;</span></span></span></code></pre></div><ul><li><p><strong>Explanation of the Metrics Counters</strong></p><ul><li><code>logs.full.count</code>: Tracks the total number of logs processed during each read interval.<br>Since this metric has no filtering conditions, every log that passes through the system is included in the count.</li><li><code>logs.sw.count</code> Counts logs that contain a quote from a Star Wars movie.</li><li><code>logs.lotr.count</code>: Counts logs that contain a quote from a Lord of the Rings movie.</li><li><code>logs.error.count</code>: Represents a real-world scenario by counting logs with a severity level of ERROR for the read interval.</li></ul></li><li><p><strong>Configure the Count Connector in the pipelines</strong><br>In the pipeline configuration below, the connector exporter is added to the <code>logs</code> section, while the connector receiver is added to the <code>metrics</code> section.</p></li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redaction/redact              </span><span class=w> </span><span class=c># Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>count                          </span><span class=w> </span><span class=c># Count Connector that receives count metric from logs count exporter in logs pipeline. </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- hostmetrics                    # Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>transform/logs                </span><span class=w> </span><span class=c># Transform logs processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>count                         </span><span class=w> </span><span class=c># Count Connector that exports count as a metric to metrics pipeline.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></details><p>We count logs based on their attributes. If your log data is stored in the log body instead of attributes, youâ€™ll need to use a <code>Transform</code> processor in your pipeline to extract key/value pairs and add them as attributes.</p><p>In this workshop, weâ€™ve already added <code>merge_maps(attributes, cache, "upsert")</code> in the <code>05-transform-data</code> section. This ensures that all relevant data is included in the log attributes for processing.</p><p>When selecting fields to create attributes from, be mindfulâ€”adding all fields indiscriminately is generally not ideal for production environments. Instead, choose only the fields that are truly necessary to avoid unnecessary data clutter.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><strong>Validate</strong> the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong>. For reference, the <code>logs</code> and <code>metrics:</code> sections of your pipelines will look like this:</li></ul><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
    REC1(otlp&lt;br&gt;fa:fa-download):::receiver
    REC2(filelog&lt;br&gt;fa:fa-download&lt;br&gt;quotes):::receiver
    REC3(otlp&lt;br&gt;fa:fa-download):::receiver
    PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
    PRO2(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
    PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
    PRO4(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
    PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
    PRO6(batch&lt;br&gt;fa:fa-microchip):::processor
    PRO7(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
    PRO8(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
    PRO9(transfrom&lt;br&gt;fa:fa-microchip&lt;br&gt;logs):::processor
    EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    EXP2(&amp;emsp;&amp;emsp;otlphttp&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload):::exporter
    EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    EXP4(&amp;emsp;&amp;emsp;otlphttp&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload):::exporter
    ROUTE1(&amp;nbsp;count&amp;nbsp;&lt;br&gt;fa:fa-route):::con-export
    ROUTE2(&amp;nbsp;count&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive

    %% Links
    subID1:::sub-logs
    subID2:::sub-metrics
    subgraph &#34; &#34; 
      direction LR
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO7
      PRO7 --&gt; PRO3
      PRO3 --&gt; PRO9
      PRO9 --&gt; PRO5
      PRO5 --&gt; ROUTE1
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
      
      subgraph subID2[**Metrics**]
      direction LR
      ROUTE1 --&gt; ROUTE2       
      ROUTE2 --&gt; PRO2
      REC3 --&gt; PRO2
      PRO2 --&gt; PRO8
      PRO8 --&gt; PRO4
      PRO4 --&gt; PRO6
      PRO6 --&gt; EXP3
      PRO6 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 7. Count & Sum Connector</h1><article class=default><header class=headline></header><h1 id=71-testing-the-count-connector>7.1 Testing the Count Connector</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>:<br>In the <strong>Gateway terminal</strong> window run:</p><div class=tab-panel data-tab-group=R-tabs-570bd82dbe8161cb83be494819a0dc00><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b3d9cecc5d385f446f063aed62dadbe5 aria-expanded=true data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-570bd82dbe8161cb83be494819a0dc00","R-tab-dc146ad677dc5dd9c26a2a6537f98eb7")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div id=R-tab-id-b3d9cecc5d385f446f063aed62dadbe5 data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>:<br>In the <strong>Agent terminal</strong> window run:</p><div class=tab-panel data-tab-group=R-tabs-83a693a50f97237da650c96b58ddcd8c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d65d6bd19f5ca4db1b5fcf2b675cf6b2 aria-expanded=true data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-83a693a50f97237da650c96b58ddcd8c","R-tab-e2d8debf4ffe3bb6331201655f536d9d")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div id=R-tab-id-d65d6bd19f5ca4db1b5fcf2b675cf6b2 data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Send 12 Logs lines with the Loadgen</strong>:<br>In the <strong>Spans terminal</strong> window send 12 log lines, they should be read in two intervals. Do this with the following <code>loadgen</code> command:</p><div class=tab-panel data-tab-group=R-tabs-9c82d53b9a1fb829b05322effb23e3fb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4651da2becd480af7ce208b40e51d163 aria-expanded=true data-tab-item=R-tab-c04840259ee1732c29330a07b53ce556 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9c82d53b9a1fb829b05322effb23e3fb","R-tab-c04840259ee1732c29330a07b53ce556")'>
<span class=tab-nav-text>Loadgen</span></button></div><div class=tab-content-container><div id=R-tab-id-4651da2becd480af7ce208b40e51d163 data-tab-item=R-tab-c04840259ee1732c29330a07b53ce556 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -logs -json -count <span class=m>12</span></span></span></code></pre></div></div></div></div></div><p>Both the <strong>Agent</strong> and <strong>Gateway</strong> will display debug information, showing they are processing data. Wait until the <code>loadgen</code> completes.</p><p><strong>Verify metrics have been generated</strong><br>As the logs are processed, the <strong>Agent</strong> generates metrics and forwards them to the <strong>Gateway</strong>, which then writes them to <code>gateway-metrics.out</code>.</p><p>To check if the metrics <code>logs.full.count</code>, <code>logs.sw.count</code>, <code>logs.lotr.count</code>, and <code>logs.error.count</code> are present in the output, run the following <strong>jq</strong> query:</p><div class=tab-panel data-tab-group=R-tabs-7ccfb12b783feaa6723662db4d317b72><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4a3d20b77ca3a60f5e2005545699bce3 aria-expanded=true data-tab-item=R-tab-5bcdc0d6fffb60ccb3e52026507edd53 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-7ccfb12b783feaa6723662db4d317b72","R-tab-5bcdc0d6fffb60ccb3e52026507edd53")'>
<span class=tab-nav-text>jq query command</span>
</button>
<button aria-controls=R-tab-id-a270e05787c7258a474b4c1dde96d6d6 aria-expanded=false data-tab-item=R-tab-845b9df504b40e63fe9060457ddcf4e9 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-7ccfb12b783feaa6723662db4d317b72","R-tab-845b9df504b40e63fe9060457ddcf4e9")'>
<span class=tab-nav-text>jq example output</span></button></div><div class=tab-content-container><div id=R-tab-id-4a3d20b77ca3a60f5e2005545699bce3 data-tab-item=R-tab-5bcdc0d6fffb60ccb3e52026507edd53 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceMetrics[].scopeMetrics[].metrics[]
</span></span></span><span class=line><span class=cl><span class=s1>    | select(.name == &#34;logs.full.count&#34; or .name == &#34;logs.sw.count&#34; or .name == &#34;logs.lotr.count&#34; or .name == &#34;logs.error.count&#34;)
</span></span></span><span class=line><span class=cl><span class=s1>    | {name: .name, value: (.sum.dataPoints[0].asInt // &#34;-&#34;)}&#39;</span> gateway-metrics.out</span></span></code></pre></div></div></div><div id=R-tab-id-a270e05787c7258a474b4c1dde96d6d6 data-tab-item=R-tab-845b9df504b40e63fe9060457ddcf4e9 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.sw.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.lotr.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.full.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;4&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.error.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.error.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.sw.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.lotr.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;6&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.full.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;8&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Note: the <code>logs.full.count</code> normally is equal to <code>logs.sw.count</code> + <code>logs.lotr.count</code>, while the <code>logs.error.count</code> will be a random number.</p></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=72-create-metrics-with-sum-connector>7.2 Create metrics with Sum Connector</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, weâ€™ll explore how the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/sumconnector rel=external><strong>Sum Connector</strong></a> can extract values from spans and convert them into metrics.</p><p>Weâ€™ll specifically use the credit card charges from our base spans and leverage the Sum Connector to retrieve the total charges as a metric.</p><p>The connector can be used to collect (<strong>sum</strong>) attribute values from spans, span events, metrics, data points, and log records. It captures each individual value, transforms it into a metric, and passes it along. However, itâ€™s the <strong>backendâ€™s</strong> job to use these metrics and their attributes for calculations and further processing.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Switch to your <strong>Agent terminal</strong> window and open the <code>agent.yaml</code> file in your editor.</p><ul><li><strong>Add the Sum Connector</strong><br>Include the Sum Connector in the connectors section of your configuration and define the metrics counters:</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>sum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spans</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=nt>user.card-charge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>source_attribute</span><span class=p>:</span><span class=w> </span><span class=l>payment.amount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>attributes[&#34;payment.amount&#34;] != &#34;NULL&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span></span></span></code></pre></div></div></details><p>In the example above, we check for the <code>payment.amount</code> attribute in spans. If it has a valid value, the <strong>Sum</strong> connector generates a metric called <code>user.card-charge</code> and includes the <code>user.name</code> as an attribute. This enables the backend to track and display a userâ€™s total charges over an extended period, such as a billing cycle.</p><p>In the pipeline configuration below, the connector exporter is added to the traces section, while the connector receiver is added to the metrics section.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><strong>Configure the Count Connector in the pipelines</strong></li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redaction/redact              </span><span class=w> </span><span class=c># Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>sum                           </span><span class=w> </span><span class=c># Sum connector which aggregates payment.amount from spans and sends to metrics pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>sum                           </span><span class=w> </span><span class=c># Receives metrics from the sum exporter in the traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>count                         </span><span class=w> </span><span class=c># Receives count metric from logs count exporter in logs pipeline. </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- hostmetrics                   # Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>transform/logs                </span><span class=w> </span><span class=c># Transform logs processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>count                         </span><span class=w> </span><span class=c># Count Connector that exports count as a metric to metrics pipeline.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div><ul><li><strong>Validate</strong> the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong>. For reference, the <code>traces</code> and <code>metrics:</code> sections of your pipelines will look like this:</li></ul><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
    REC1(otlp&lt;br&gt;fa:fa-download&lt;br&gt; ):::receiver
    REC3(otlp&lt;br&gt;fa:fa-download&lt;br&gt; ):::receiver
    PRO1(memory_limiter&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO2(memory_limiter&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
    PRO4(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
    PRO5(batch&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO6(batch&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO7(resourcedetection&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO8(resourcedetection&lt;br&gt;fa:fa-microchip&lt;br&gt;):::processor

    PROA(attributes&lt;br&gt;fa:fa-microchip&lt;br&gt;redact):::processor
    PROB(redaction&lt;br&gt;fa:fa-microchip&lt;br&gt;update):::processor
    EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    EXP2(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    EXP4(&amp;emsp;&amp;emsp;otlphttp&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    EXP5(&amp;emsp;&amp;emsp;otlphttp&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    ROUTE1(&amp;nbsp;sum&amp;nbsp;&lt;br&gt;fa:fa-route&lt;br&gt; ):::con-export
    ROUTE2(&amp;nbsp;count&amp;nbsp;&lt;br&gt;fa:fa-route&lt;br&gt; ):::con-receive
    ROUTE3(&amp;nbsp;sum&amp;nbsp;&lt;br&gt;fa:fa-route&lt;br&gt; ):::con-receive

    %% Links
    subID1:::sub-traces
    subID2:::sub-metrics
    subgraph &#34; &#34; 
      direction LR
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PROA
      PROA --&gt; PROB
      PROB --&gt; PRO7
      PRO7 --&gt; PRO3
      PRO3 --&gt; PRO5 
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      PRO5 --&gt; EXP5
      PRO5 --&gt; ROUTE1
      end
      
      subgraph subID2[**Metrics**]
      direction LR
      ROUTE1 --&gt; ROUTE3
      ROUTE3 --&gt; PRO2       
      ROUTE2 --&gt; PRO2
      REC3 --&gt; PRO2
      PRO2 --&gt; PRO8
      PRO8 --&gt; PRO4
      PRO4 --&gt; PRO6
      PRO6 --&gt; EXP3
      PRO6 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=73-testing-the-count-connector>7.3 Testing the Count Connector</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>:<br>In the <strong>Gateway terminal</strong> window run:</p><div class=tab-panel data-tab-group=R-tabs-8ce6cd52e40fce3fff29d49fcdcba5f8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-a5134a8f50a0477ff1532899a8f3f4c1 aria-expanded=true data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-8ce6cd52e40fce3fff29d49fcdcba5f8","R-tab-dc146ad677dc5dd9c26a2a6537f98eb7")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div id=R-tab-id-a5134a8f50a0477ff1532899a8f3f4c1 data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>:<br>In the <strong>Agent terminal</strong> window run:</p><div class=tab-panel data-tab-group=R-tabs-ed8140f7ae8ec89c1f8855fb2118bd48><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-6356a4ae1a6a6223307ef7fec7e40b9a aria-expanded=true data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-ed8140f7ae8ec89c1f8855fb2118bd48","R-tab-e2d8debf4ffe3bb6331201655f536d9d")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div id=R-tab-id-6356a4ae1a6a6223307ef7fec7e40b9a data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Loadgen</strong>:<br>In the <strong>Spans terminal</strong> window send 8 spans with the following <code>loadgen</code> command:</p><div class=tab-panel data-tab-group=R-tabs-b85776c4bce46818701ee23ca9b473b4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-15ef5ba54517c9db10987d536d78e10d aria-expanded=true data-tab-item=R-tab-c04840259ee1732c29330a07b53ce556 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b85776c4bce46818701ee23ca9b473b4","R-tab-c04840259ee1732c29330a07b53ce556")'>
<span class=tab-nav-text>Loadgen</span></button></div><div class=tab-content-container><div id=R-tab-id-15ef5ba54517c9db10987d536d78e10d data-tab-item=R-tab-c04840259ee1732c29330a07b53ce556 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>8</span></span></span></code></pre></div></div></div></div></div><p>Both the <strong>Agent</strong> and <strong>Gateway</strong> will display debug information, showing they are processing data. Wait until the loadgen completes.</p><p><strong>Verify the metrics</strong>:<br>While processing the span, the <strong>Agent</strong>, has generated metrics and passed them on to the <strong>Gateway</strong>. The <strong>Gateway</strong> has written them into <code>gateway-metrics.out</code>.</p><p>To confirm the presence of <code>user.card-charge</code>and verify each one has an attribute <code>user.name</code> in the metrics output, run the following jq query:</p><div class=tab-panel data-tab-group=R-tabs-48382832a97d25185db6c0ba91f84e22><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-8478846601a257ac03b28b8721c0f119 aria-expanded=true data-tab-item=R-tab-5bcdc0d6fffb60ccb3e52026507edd53 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-48382832a97d25185db6c0ba91f84e22","R-tab-5bcdc0d6fffb60ccb3e52026507edd53")'>
<span class=tab-nav-text>jq query command</span>
</button>
<button aria-controls=R-tab-id-e212db76e81a57896eab0216d1ad4cd2 aria-expanded=false data-tab-item=R-tab-845b9df504b40e63fe9060457ddcf4e9 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-48382832a97d25185db6c0ba91f84e22","R-tab-845b9df504b40e63fe9060457ddcf4e9")'>
<span class=tab-nav-text>jq example output</span></button></div><div class=tab-content-container><div id=R-tab-id-8478846601a257ac03b28b8721c0f119 data-tab-item=R-tab-5bcdc0d6fffb60ccb3e52026507edd53 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -r <span class=s1>&#39;.resourceMetrics[].scopeMetrics[].metrics[] | select(.name == &#34;user.card-charge&#34;) | .sum.dataPoints[] | &#34;\(.attributes[] | select(.key == &#34;user.name&#34;).value.stringValue)\t\(.asDouble)&#34;&#39;</span> gateway-metrics.out <span class=p>|</span> <span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span><span class=s1>$&#39;\t&#39;</span> <span class=nb>read</span> -r name charge<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>printf</span> <span class=s2>&#34;%-20s %s\n&#34;</span> <span class=s2>&#34;</span><span class=nv>$name</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$charge</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>    </span></span></code></pre></div></div></div><div id=R-tab-id-e212db76e81a57896eab0216d1ad4cd2 data-tab-item=R-tab-845b9df504b40e63fe9060457ddcf4e9 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>George Lucas         67.49
</span></span><span class=line><span class=cl>Frodo Baggins        87.14
</span></span><span class=line><span class=cl>Thorin Oakenshield   90.98
</span></span><span class=line><span class=cl>Luke Skywalker       51.37
</span></span><span class=line><span class=cl>Luke Skywalker       65.56
</span></span><span class=line><span class=cl>Thorin Oakenshield   67.5
</span></span><span class=line><span class=cl>Thorin Oakenshield   66.66
</span></span><span class=line><span class=cl>Peter Jackson        94.39</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/js/js-yaml/js-yaml.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-color.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-dispatch.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-drag.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-ease.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-interpolate.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-selection.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-timer.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-transition.min.js?1769793354 defer></script><script src=/observability-workshop/js/d3/d3-zoom.min.js?1769793354 defer></script><script src=/observability-workshop/js/mermaid/mermaid.min.js?1769793354 defer></script><script>window.relearn.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/js/perfect-scrollbar/perfect-scrollbar.min.js?1769793354 defer></script><script src=/observability-workshop/js/theme.min.js?1769793354 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>