<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="Use the Splunk Helm chart to install the OpenTelemetry Collector in K3s Explore your cluster in the Kubernetes Navigator 1. Installation using Helm Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository to Helm and update:
â€‹ Helm Repo Add Helm Repo Add Output helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart && helm repo update Using ACCESS_TOKEN={REDACTED} Using REALM=eu0 â€œsplunk-otel-collector-chartâ€ has been added to your repositories Using ACCESS_TOKEN={REDACTED} Using REALM=eu0 Hang tight while we grab the latest from your chart repositoriesâ€¦ â€¦Successfully got an update from the â€œsplunk-otel-collector-chartâ€ chart repository Update Complete."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying the OpenTelemetry Collector in Kubernetes :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Use the Splunk Helm chart to install the OpenTelemetry Collector in K3s Explore your cluster in the Kubernetes Navigator 1. Installation using Helm Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository to Helm and update:
â€‹ Helm Repo Add Helm Repo Add Output helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart && helm repo update Using ACCESS_TOKEN={REDACTED} Using REALM=eu0 â€œsplunk-otel-collector-chartâ€ has been added to your repositories Using ACCESS_TOKEN={REDACTED} Using REALM=eu0 Hang tight while we grab the latest from your chart repositoriesâ€¦ â€¦Successfully got an update from the â€œsplunk-otel-collector-chartâ€ chart repository Update Complete."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.59/en/other/1-imt/gdi/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Deploying the OpenTelemetry Collector in Kubernetes :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Use the Splunk Helm chart to install the OpenTelemetry Collector in K3s Explore your cluster in the Kubernetes Navigator 1. Installation using Helm Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository to Helm and update:
â€‹ Helm Repo Add Helm Repo Add Output helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart && helm repo update Using ACCESS_TOKEN={REDACTED} Using REALM=eu0 â€œsplunk-otel-collector-chartâ€ has been added to your repositories Using ACCESS_TOKEN={REDACTED} Using REALM=eu0 Hang tight while we grab the latest from your chart repositoriesâ€¦ â€¦Successfully got an update from the â€œsplunk-otel-collector-chartâ€ chart repository Update Complete."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Deploying the OpenTelemetry Collector in Kubernetes :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Use the Splunk Helm chart to install the OpenTelemetry Collector in K3s Explore your cluster in the Kubernetes Navigator 1. Installation using Helm Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository to Helm and update:
â€‹ Helm Repo Add Helm Repo Add Output helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart && helm repo update Using ACCESS_TOKEN={REDACTED} Using REALM=eu0 â€œsplunk-otel-collector-chartâ€ has been added to your repositories Using ACCESS_TOKEN={REDACTED} Using REALM=eu0 Hang tight while we grab the latest from your chart repositoriesâ€¦ â€¦Successfully got an update from the â€œsplunk-otel-collector-chartâ€ chart repository Update Complete."><meta itemprop=dateModified content="2024-04-25T10:04:20+01:00"><meta itemprop=wordCount content="656"><title>Deploying the OpenTelemetry Collector in Kubernetes :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.59/en/other/1-imt/gdi/index.html rel=canonical type=text/html title="Deploying the OpenTelemetry Collector in Kubernetes :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.59/images/favicon.ico?1717508693 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.59/css/fontawesome-all.min.css?1717508706 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.59/css/fontawesome-all.min.css?1717508706 rel=stylesheet></noscript><link href=/observability-workshop/v5.59/css/nucleus.css?1717508706 rel=stylesheet><link href=/observability-workshop/v5.59/css/auto-complete.css?1717508706 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.59/css/auto-complete.css?1717508706 rel=stylesheet></noscript><link href=/observability-workshop/v5.59/css/perfect-scrollbar.min.css?1717508706 rel=stylesheet><link href=/observability-workshop/v5.59/css/fonts.css?1717508706 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.59/css/fonts.css?1717508706 rel=stylesheet></noscript><link href=/observability-workshop/v5.59/css/theme.css?1717508706 rel=stylesheet><link href=/observability-workshop/v5.59/css/theme-splunk-light.css?1717508706 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.59/css/chroma-relearn-light.css?1717508706 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.59/css/variant.css?1717508706 rel=stylesheet><link href=/observability-workshop/v5.59/css/print.css?1717508706 rel=stylesheet media=print><link href=/observability-workshop/v5.59/css/format-print.css?1717508706 rel=stylesheet><script src=/observability-workshop/v5.59/js/variant.js?1717508706></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.59",window.index_js_url="/observability-workshop/v5.59/en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.59/en/other/1-imt/gdi/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.59/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.59/en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.59/en/other/1-imt/index.html><span itemprop=name>Splunk IM</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>2. Get Data In</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.59/en/other/1-imt/initial-setup/index.html title="How to connect to your workshop environment (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/index.html title="Deploying NGINX in K3s (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=deploying-the-opentelemetry-collector-in-kubernetes>Deploying the OpenTelemetry Collector in Kubernetes</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<ul><li>Use the Splunk Helm chart to install the OpenTelemetry Collector in K3s</li><li>Explore your cluster in the Kubernetes Navigator</li></ul><hr><h2 id=1-installation-using-helm>1. Installation using Helm</h2><p>Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository to Helm and update:</p><div class=tab-panel data-tab-group=73ebd5c3536fbc8d59bfa593156d955c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-repo-add class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("73ebd5c3536fbc8d59bfa593156d955c","helm-repo-add")'>
<span class=tab-nav-text>Helm Repo Add</span>
</button>
<button data-tab-item=helm-repo-add-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("73ebd5c3536fbc8d59bfa593156d955c","helm-repo-add-output")'>
<span class=tab-nav-text>Helm Repo Add Output</span></button></div><div class=tab-content-container><div data-tab-item=helm-repo-add class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div data-tab-item=helm-repo-add-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Using ACCESS_TOKEN={REDACTED}
Using REALM=eu0
&ldquo;splunk-otel-collector-chart&rdquo; has been added to your repositories
Using ACCESS_TOKEN={REDACTED}
Using REALM=eu0
Hang tight while we grab the latest from your chart repositories&mldr;
&mldr;Successfully got an update from the &ldquo;splunk-otel-collector-chart&rdquo; chart repository
Update Complete. âŽˆHappy Helming!âŽˆ</p></div></div></div></div><p>Install the OpenTelemetry Collector Helm chart with the following commands, do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=3897ebe2e5fbc82f516be619db78f2b4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-install class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3897ebe2e5fbc82f516be619db78f2b4","helm-install")'>
<span class=tab-nav-text>Helm Install</span>
</button>
<button data-tab-item=helm-install-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("3897ebe2e5fbc82f516be619db78f2b4","helm-install-output")'>
<span class=tab-nav-text>Helm Install Output</span></button></div><div class=tab-content-container><div data-tab-item=helm-install class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=false&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;logsEngine=otel&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.profilingEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=nv>$INSTANCE</span><span class=s2>-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div><div data-tab-item=helm-install-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri May  7 11:19:01 2021
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>TEST SUITE: None</span></span></code></pre></div></div></div></div></div><p>You can monitor the progress of the deployment by running <code>kubectl get pods</code> which should typically report a new pod is up and running after about 30 seconds.</p><p>Ensure the status is reported as Running before continuing.</p><div class=tab-panel data-tab-group=7dde3c5361f061a6554eb29a6e96cccc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7dde3c5361f061a6554eb29a6e96cccc","kubectl-get-pods")'>
<span class=tab-nav-text>Kubectl Get Pods</span>
</button>
<button data-tab-item=kubectl-get-pods-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("7dde3c5361f061a6554eb29a6e96cccc","kubectl-get-pods-output")'>
<span class=tab-nav-text>Kubectl Get Pods Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-pods-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-2sk6k                             0/1     Running   0          10s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6956d4446f-gwnd7   0/1     Running   0          10s</span></span></code></pre></div></div></div></div></div><p>Ensure there are no errors by tailing the logs from the OpenTelemetry Collector pod. The output should look similar to the log output shown in the Output tab below.</p><p>Use the label set by the <code>helm</code> install to tail logs (You will need to press <code>ctrl+c</code> to exit). Or use the installed <code>k9s</code> terminal UI for bonus points!</p><div class=tab-panel data-tab-group=539d2921978304b68fca04ed37a77f23><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-logs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("539d2921978304b68fca04ed37a77f23","kubectl-logs")'>
<span class=tab-nav-text>Kubectl Logs</span>
</button>
<button data-tab-item=kubectl-logs-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("539d2921978304b68fca04ed37a77f23","kubectl-logs-output")'>
<span class=tab-nav-text>Kubectl Logs Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector</span></span></code></pre></div></div></div><div data-tab-item=kubectl-logs-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>2021-03-21T16:11:10.900Z INFO service/service.go:364 Starting receivers&mldr;
2021-03-21T16:11:10.900Z INFO builder/receivers_builder.go:70 Receiver is starting&mldr; {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;prometheus&rdquo;, &ldquo;component_name&rdquo;: &ldquo;prometheus&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:75 Receiver started. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;prometheus&rdquo;, &ldquo;component_name&rdquo;: &ldquo;prometheus&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:70 Receiver is starting&mldr; {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.009Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0 rel=external target=_blank>k8sclusterreceiver@v0.21.0</a>/watcher.go:195 Configured Kubernetes MetadataExporter {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;exporter_name&rdquo;: &ldquo;signalfx&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:75 Receiver started. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.009Z INFO healthcheck/handler.go:128 Health Check state change {&ldquo;component_kind&rdquo;: &ldquo;extension&rdquo;, &ldquo;component_type&rdquo;: &ldquo;health_check&rdquo;, &ldquo;component_name&rdquo;: &ldquo;health_check&rdquo;, &ldquo;status&rdquo;: &ldquo;ready&rdquo;}
2021-03-21T16:11:11.009Z INFO service/service.go:267 Everything is ready. Begin running and processing data.
2021-03-21T16:11:11.009Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0 rel=external target=_blank>k8sclusterreceiver@v0.21.0</a>/receiver.go:59 Starting shared informers and wait for initial cache sync. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.281Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0 rel=external target=_blank>k8sclusterreceiver@v0.21.0</a>/receiver.go:75 Completed syncing shared informer caches. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}</p></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Deleting a failed installation</div><div class=box-content><p>If you make an error installing the OpenTelemetry Collector you can start over by deleting the installation using:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><hr><h2 id=2-validate-metrics-in-the-ui>2. Validate metrics in the UI</h2><p>In the Splunk UI, click the <strong>&#187;</strong> bottom left and click on <strong>Infrastructure</strong>.</p><p><a href=#R-image-040d84a467940018311522c727968c59 class=lightbox-link><img alt="Selecting the Kubernetes Navigator Map" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/clustermap-nav.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-040d84a467940018311522c727968c59><img alt="Selecting the Kubernetes Navigator Map" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/clustermap-nav.png></a></p><p>Under <strong>Containers</strong> click on <strong>Kubernetes</strong> to open the Kubernetes Navigator Cluster Map to ensure metrics are being sent in.</p><p>Validate that your cluster is discovered and reported by finding your cluster (in the workshop you will see many other clusters). To find your cluster name run the following command and copy the output to your clipboard:</p><div class=tab-panel data-tab-group=e73cd8d1510146b9bc4b77885f04d1ee><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=echo-cluster-name class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e73cd8d1510146b9bc4b77885f04d1ee","echo-cluster-name")'>
<span class=tab-nav-text>Echo Cluster Name</span></button></div><div class=tab-content-container><div data-tab-item=echo-cluster-name class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$INSTANCE</span>-k3s-cluster</span></span></code></pre></div></div></div></div></div><p>Then in the UI, click on the &ldquo;Cluster: - " menu just below the Splunk Logo, paste the Cluster name you just copied into the search box, click the box to select your cluster, and finally click off the menu into white space to apply the filter.</p><p><a href=#R-image-0956df7f36fec6dc88dc79e5f6c255e3 class=lightbox-link><img alt="K8S Clusters Filter" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/search-k3s-cluster.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0956df7f36fec6dc88dc79e5f6c255e3><img alt="K8S Clusters Filter" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/search-k3s-cluster.png></a></p><p><a href=#R-image-e250938589a8248721765e9d9d7f8586 class=lightbox-link><img alt="Select K8S Cluster" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/selecting-k3s-cluster.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e250938589a8248721765e9d9d7f8586><img alt="Select K8S Cluster" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/selecting-k3s-cluster.png></a></p><p><a href=#R-image-bd47df4ab8729269ba4f9240ab04738e class=lightbox-link><img alt="Filtered K8S Cluster" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/filtered-k3s-cluster.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bd47df4ab8729269ba4f9240ab04738e><img alt="Filtered K8S Cluster" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/filtered-k3s-cluster.png></a></p><p>To examine the health of your node, hover over the pale blue background of your cluster, then click on the blue magnifying glass <a href=#R-image-21b414a1bbb01b087f65149aeb27419d class=lightbox-link><img alt="Magnifying Glass" class="noborder inline lazy lightbox noshadow figure-image" loading=lazy src="/observability-workshop/v5.59/en/other/1-imt/gdi/../images/blue-cross.png?classes=inline&height=25px" style=height:25px;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-21b414a1bbb01b087f65149aeb27419d><img alt="Magnifying Glass" class="noborder inline lazy lightbox noshadow lightbox-image" loading=lazy src="/observability-workshop/v5.59/en/other/1-imt/gdi/../images/blue-cross.png?classes=inline&height=25px"></a> that appears in the top left-hand corner.</p><p>This will drill down to the node level. Next, open the Metrics sidebar by clicking on the sidebar button.</p><p>Once it is open, you can use the slider on the side to explore the various charts relevant to your cluster/node: CPU, Memory, Network, Events etc.</p><p><a href=#R-image-2d5d0c5e2887eb0348458caf4da6edf9 class=lightbox-link><img alt="Sidebar metrics" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/explore-metrics.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2d5d0c5e2887eb0348458caf4da6edf9><img alt="Sidebar metrics" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/../images/explore-metrics.png></a></p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>rcastley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Apr 25, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Deploying the OpenTelemetry Collector in Kubernetes</h1><article class=default><header class=headline></header><h1 id=deploying-nginx-in-k3s>Deploying NGINX in K3s</h1><ul><li>Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment.</li><li>Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud!</li></ul><hr><h2 id=1-start-your-nginx>1. Start your NGINX</h2><p>Verify the number of pods running in the Splunk UI by selecting the <strong>WORKLOADS</strong> tab. This should give you an overview of the workloads on your cluster.</p><p><a href=#R-image-6cc6cf6d6e1e09c4f196e85b60d58c94 class=lightbox-link><img alt="Workload Agent" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/k8s-workloads.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6cc6cf6d6e1e09c4f196e85b60d58c94><img alt="Workload Agent" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/k8s-workloads.png></a></p><p>Note the single agent container running per node among the default Kubernetes pods. This single container will monitor all the pods and services being deployed on this node!</p><p>Now switch back to the default cluster node view by selecting the <strong>MAP</strong> tab and selecting your cluster again.</p><p>In your AWS/EC2 or Multipass shell session change into the <code>nginx</code> directory:</p><div class=tab-panel data-tab-group=08cb25d05b45a1337a5268c69fd7976e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=change-directory class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("08cb25d05b45a1337a5268c69fd7976e","change-directory")'>
<span class=tab-nav-text>Change Directory</span></button></div><div class=tab-content-container><div data-tab-item=change-directory class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/k3s/nginx</span></span></code></pre></div></div></div></div></div><hr><h2 id=2-create-nginx-deployment>2. Create NGINX deployment</h2><p>Create the NGINX ConfigMap<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> using the <code>nginx.conf</code> file:</p><div class=tab-panel data-tab-group=f1d9cf8f7c4d0c3b158fe56d6b9a438d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-configmap-create class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f1d9cf8f7c4d0c3b158fe56d6b9a438d","kubectl-configmap-create")'>
<span class=tab-nav-text>Kubectl Configmap Create</span>
</button>
<button data-tab-item=kubectl-create-configmap-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f1d9cf8f7c4d0c3b158fe56d6b9a438d","kubectl-create-configmap-output")'>
<span class=tab-nav-text>Kubectl Create Configmap Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-configmap-create class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create configmap nginxconfig --from-file<span class=o>=</span>nginx.conf</span></span></code></pre></div></div></div><div data-tab-item=kubectl-create-configmap-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>configmap/nginxconfig created</p></div></div></div></div><p>Then create the deployment:</p><div class=tab-panel data-tab-group=4959d7506cafb264f91bda3b2aac4dbb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-create-deployment class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4959d7506cafb264f91bda3b2aac4dbb","kubectl-create-deployment")'>
<span class=tab-nav-text>Kubectl Create Deployment</span>
</button>
<button data-tab-item=kubectl-create-deployment-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("4959d7506cafb264f91bda3b2aac4dbb","kubectl-create-deployment-output")'>
<span class=tab-nav-text>Kubectl Create Deployment Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-create-deployment class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f nginx-deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item=kubectl-create-deployment-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>deployment.apps/nginx created
service/nginx created</p></div></div></div></div><p>Next, we will deploy Locust<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> which is an open-source tool used for creating a load test against NGINX:</p><div class=tab-panel data-tab-group=217ee767768187a73c80a61767234de6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-create-deployment class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("217ee767768187a73c80a61767234de6","kubectl-create-deployment")'>
<span class=tab-nav-text>Kubectl Create Deployment</span>
</button>
<button data-tab-item=kubectl-create-deployment-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("217ee767768187a73c80a61767234de6","kubectl-create-deployment-output")'>
<span class=tab-nav-text>Kubectl Create Deployment Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-create-deployment class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f locust-deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item=kubectl-create-deployment-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>deployment.apps/nginx-loadgenerator created
service/nginx-loadgenerator created</p></div></div></div></div><p>Validate the deployment has been successful and that the Locust and NGINX pods are running.</p><p>If you have the Splunk UI open you should see new Pods being started and containers being deployed.</p><p>It should only take around 20 seconds for the pods to transition into a Running state. In the Splunk UI you will have a cluster that looks like the screenshot below:</p><p><a href=#R-image-43751df7e62b6fa2bdca446ea34e0bee class=lightbox-link><img alt="back to Cluster" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/cluster.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-43751df7e62b6fa2bdca446ea34e0bee><img alt="back to Cluster" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/cluster.png></a></p><p>If you select the <strong>WORKLOADS</strong> tab again you will now see that there is a new ReplicaSet and a deployment added for NGINX:</p><p><a href=#R-image-8e2db15faf8de5c83ada419f43dd6dab class=lightbox-link><img alt="NGINX loaded" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/k8s-workloads-nginx.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8e2db15faf8de5c83ada419f43dd6dab><img alt="NGINX loaded" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/k8s-workloads-nginx.png></a></p><hr><p>Let&rsquo;s validate this in your shell as well:</p><div class=tab-panel data-tab-group=981f7519799c729cff32acb27c12189c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("981f7519799c729cff32acb27c12189c","kubectl-get-pods")'>
<span class=tab-nav-text>Kubectl Get Pods</span>
</button>
<button data-tab-item=kubectl-get-pods-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("981f7519799c729cff32acb27c12189c","kubectl-get-pods-output")'>
<span class=tab-nav-text>Kubectl Get Pods Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=kubectl-get-pods-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>NAME READY STATUS RESTARTS AGE
splunk-otel-collector-k8s-cluster-receiver-77784c659c-ttmpk 1/1 Running 0 9m19s
splunk-otel-collector-agent-249rd 1/1 Running 0 9m19s
svclb-nginx-vtnzg 1/1 Running 0 5m57s
nginx-7b95fb6b6b-7sb9x 1/1 Running 0 5m57s
nginx-7b95fb6b6b-lnzsq 1/1 Running 0 5m57s
nginx-7b95fb6b6b-hlx27 1/1 Running 0 5m57s
nginx-7b95fb6b6b-zwns9 1/1 Running 0 5m57s
svclb-nginx-loadgenerator-nscx4 1/1 Running 0 2m20s
nginx-loadgenerator-755c8f7ff6-x957q 1/1 Running 0 2m20s</p></div></div></div></div><hr><h2 id=3-run-locust-load-test>3. Run Locust load test</h2><p>Locust, an open-source load generator, is available on port 8083 of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and go to <code>http://{==EC2-IP==}:8083/</code>, you will then be able to see the Locust running.</p><p><a href=#R-image-d686d04b793263dbdfebc3190983e7b5 class=lightbox-link><img alt=Locust class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/nginx-locust.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d686d04b793263dbdfebc3190983e7b5><img alt=Locust class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/nginx-locust.png></a></p><p>Set the <strong>Spawn rate</strong> to 2 and click <strong>Start Swarming</strong>.</p><p><a href=#R-image-995445389c50689c481af54fb57cad3e class=lightbox-link><img alt="Locust Spawn Rate" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/nginx-locust-spawn-rate.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-995445389c50689c481af54fb57cad3e><img alt="Locust Spawn Rate" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/nginx-locust-spawn-rate.png></a></p><p>This will start a gentle continuous load on the application.</p><p><a href=#R-image-387df06dfc478cb20c1d6d8c5dbeb71c class=lightbox-link><img alt="Locust Statistics" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/nginx-locust-statistics.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-387df06dfc478cb20c1d6d8c5dbeb71c><img alt="Locust Statistics" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/nginx-locust-statistics.png></a></p><p>As you can see from the above screenshot, most of the calls will report a fail, this is expected, as we have not yet deployed the application behind it, however, NGINX is reporting on your attempts and you should be able to see those metrics.</p><p>Validate you are seeing those metrics in the UI by selecting <strong>Dashboards â†’ Built-in Dashboard Groups â†’ NGINX â†’ NGINX Servers</strong>. Using the <strong>Overrides</strong> filter on <code>k8s.cluster.name:</code>, find the name of your cluster as returned by <code>echo $INSTANCE-k3s-cluster</code> in the terminal.</p><p><a href=#R-image-f52012763360892c96c1d78bb4e9a8be class=lightbox-link><img alt="NGINX Dashboard" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/nginx-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f52012763360892c96c1d78bb4e9a8be><img alt="NGINX Dashboard" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.59/en/other/1-imt/gdi/nginx/../../images/nginx-dashboard.png></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A ConfigMap is an API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or configuration files in a volume. A ConfigMap allows you to decouple environment-specific configuration from your container images so that your applications are easily portable.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://locust.io/ rel=external target=_blank>What is Locust?</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Robert Castley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Dec 21, 2023</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.59/js/clipboard.min.js?1717508706 defer></script><script src=/observability-workshop/v5.59/js/perfect-scrollbar.min.js?1717508706 defer></script><script src=/observability-workshop/v5.59/js/theme.js?1717508706 defer></script></body></html>