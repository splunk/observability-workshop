<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 8.0.0+97777ec5111409397e83f44eca496eea97697836"><meta name=description content="By the end of this workshop you'll have gotten hands-on experience deploying the OpenTelemetry Collector, instrumenting an application with OpenTelemetry, capturing tags from the application, and using Troubleshooting MetricSets and Tag Spotlight to determine the root cause of an issue."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Solving Problems with O11y Cloud :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="By the end of this workshop you'll have gotten hands-on experience deploying the OpenTelemetry Collector, instrumenting an application with OpenTelemetry, capturing tags from the application, and using Troubleshooting MetricSets and Tag Spotlight to determine the root cause of an issue."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v6.8/en/ninja-workshops/9-solving-problems-with-o11y-cloud/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Solving Problems with O11y Cloud :: Splunk Observability Cloud Workshops"><meta property="og:description" content="By the end of this workshop you'll have gotten hands-on experience deploying the OpenTelemetry Collector, instrumenting an application with OpenTelemetry, capturing tags from the application, and using Troubleshooting MetricSets and Tag Spotlight to determine the root cause of an issue."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Solving Problems with O11y Cloud :: Splunk Observability Cloud Workshops"><meta itemprop=description content="By the end of this workshop you'll have gotten hands-on experience deploying the OpenTelemetry Collector, instrumenting an application with OpenTelemetry, capturing tags from the application, and using Troubleshooting MetricSets and Tag Spotlight to determine the root cause of an issue."><meta itemprop=dateModified content="2025-02-03T14:16:51-08:00"><meta itemprop=wordCount content="89"><title>Solving Problems with O11y Cloud :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v6.8/en/ninja-workshops/9-solving-problems-with-o11y-cloud/index.html rel=canonical type=text/html title="Solving Problems with O11y Cloud :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v6.8/images/favicon.ico?1759784456 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v6.8/css/auto-complete/auto-complete.min.css?1759784456 rel=stylesheet><script src=/observability-workshop/v6.8/js/auto-complete/auto-complete.min.js?1759784456 defer></script><script src=/observability-workshop/v6.8/js/search-lunr.min.js?1759784456 defer></script><script src=/observability-workshop/v6.8/js/search.min.js?1759784456 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/v6.8/searchindex.en.js?1759784456"</script><script src=/observability-workshop/v6.8/js/lunr/lunr.min.js?1759784456 defer></script><script src=/observability-workshop/v6.8/js/lunr/lunr.stemmer.support.min.js?1759784456 defer></script><script src=/observability-workshop/v6.8/js/lunr/lunr.multi.min.js?1759784456 defer></script><script src=/observability-workshop/v6.8/js/lunr/lunr.en.min.js?1759784456 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/observability-workshop/v6.8/fonts/fontawesome/css/fontawesome-all.min.css?1759784456 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v6.8/fonts/fontawesome/css/fontawesome-all.min.css?1759784456 rel=stylesheet></noscript><link href=/observability-workshop/v6.8/css/perfect-scrollbar/perfect-scrollbar.min.css?1759784456 rel=stylesheet><link href=/observability-workshop/v6.8/css/theme.min.css?1759784456 rel=stylesheet><link href=/observability-workshop/v6.8/css/format-print.min.css?1759784456 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/ninja-workshops/9-solving-problems-with-o11y-cloud/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v6.8",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({appplicationName:"observability-workshop",realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",recorder:"splunk",features:{video:!0}})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-url=/observability-workshop/v6.8/en/ninja-workshops/9-solving-problems-with-o11y-cloud/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.8/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.8/en/ninja-workshops/index.html><span itemprop=name>Splunk4Ninjas Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Solving Problems with O11y Cloud</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.8/en/ninja-workshops/9-solving-problems-with-o11y-cloud/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.8/en/ninja-workshops/8-docker-k8s-otel/11-summary/index.html title="Summary (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.8/en/ninja-workshops/9-solving-problems-with-o11y-cloud/1-connect-to-instance/index.html title="Connect to EC2 Instance (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=solving-problems-with-o11y-cloud>Solving Problems with O11y Cloud</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Derek Mitchell</span></span><p>In this workshop, you&rsquo;ll get hands-on experience with the following:</p><ul><li>Deploy the <strong>OpenTelemetry Collector</strong> and customize the collector config</li><li>Deploy an application and instrument it with <strong>OpenTelemetry</strong></li><li>See how tags are captured using an <strong>OpenTelemetry SDK</strong></li><li>Create a <strong>Troubleshooting MetricSet</strong></li><li>Troubleshoot a problem and determine root cause using <strong>Tag Spotlight</strong></li></ul><p>Let&rsquo;s get started!</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>The easiest way to navigate through this workshop is by using:</p><ul><li>the left/right arrows (<strong>&lt;</strong> | <strong>></strong>) on the top right of this page</li><li>the left (◀️) and right (▶️) cursor keys on your keyboard</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 3, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of Solving Problems with O11y Cloud</h1><article class=default><header class=headline></header><h1 id=connect-to-ec2-instance>Connect to EC2 Instance</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=connect-to-your-ec2-instance>Connect to your EC2 Instance</h2><p>We’ve prepared an Ubuntu Linux instance in AWS/EC2 for each attendee. Using the IP address and password provided by your instructor, connect to your EC2 instance using one of the methods below:</p><ul><li>macOS / Linux<ul><li><code>ssh splunk@IP address</code></li></ul></li><li>Windows 10+<ul><li>Use the OpenSSH client</li></ul></li><li>Earlier versions of Windows<ul><li>Use Putty</li></ul></li></ul><h2 id=editing-files>Editing Files</h2><p>We&rsquo;ll use <code>vi</code> to edit files during the workshop. Here&rsquo;s a quick primer.</p><p>To open a file for editing:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi &lt;filename&gt; </span></span></code></pre></div><ul><li>To edit the file, click <code>i</code> to switch to <strong>Insert mode</strong> and begin entering text as normal. Use <code>Esc</code> to return to <strong>Command mode</strong>.</li><li>To save your changes without exiting the editor, enter <code>Esc</code> to return to command mode then enter <code>:w</code>.</li><li>To exit the editor without saving changes, enter <code>Esc</code> to return to command mode then enter <code>:q!</code>.</li><li>To save your changes and exist the editor, enter <code>Esc</code> to return to command mode then enter <code>:wq</code>.</li></ul><p>See <a href=https://www.redhat.com/en/blog/introduction-vi-editor rel=external target=_blank><strong>An introduction to the vi editor</strong></a> for a comprehensive introduction to <code>vi</code>.</p><p>If you&rsquo;d prefer using another editor, you can use <code>nano</code> instead:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano &lt;filename&gt; </span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 21, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=deploy-the-opentelemetry-collector-and-customize-config>Deploy the OpenTelemetry Collector and Customize Config</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>The first step to &ldquo;getting data in&rdquo; is to deploy an OpenTelemetry collector, which receives and processes telemetry data in our environment before exporting it to Splunk Observability Cloud.</p><p>We&rsquo;ll be using Kubernetes for this workshop, and will deploy the collector in our K8s cluster using Helm.</p><h2 id=what-is-helm>What is Helm?</h2><p>Helm is a package manager for Kubernetes which provides the following benefits:</p><ul><li>Manage Complexity<ul><li>deal with a single values.yaml file rather than dozens of manifest files</li></ul></li><li>Easy Updates<ul><li>in-place upgrades</li></ul></li><li>Rollback support<ul><li>Just use helm rollback to roll back to an older version of a release</li></ul></li></ul><h2 id=install-the-collector-using-helm>Install the Collector using Helm</h2><p>Let&rsquo;s change into the correct directory and run a script to install the collector:</p><div class=tab-panel data-tab-group=R-tabs-f208fb69800202383a6a48a75c6bf362><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-f208fb69800202383a6a48a75c6bf362","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-f208fb69800202383a6a48a75c6bf362","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk/workshop/tagging
</span></span><span class=line><span class=cl>./1-deploy-otel-collector.sh</span></span></code></pre></div></div></div><div data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=s2>&#34;splunk-otel-collector-chart&#34;</span> has been added to your repositories
</span></span><span class=line><span class=cl>Hang tight <span class=k>while</span> we grab the latest from your chart repositories...
</span></span><span class=line><span class=cl>...Successfully got an update from the <span class=s2>&#34;splunk-otel-collector-chart&#34;</span> chart repository
</span></span><span class=line><span class=cl>Update Complete. ⎈Happy Helming!⎈
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Mon Dec <span class=m>23</span> 18:47:38 <span class=m>2024</span>
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>1</span>
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm us1.</span></span></code></pre></div></div></div></div></div><blockquote><p>Note that the script may take a minute or so to run.</p></blockquote><p>How did this script install the collector? It first ensured that the environment variables set in the <code>~./profile</code> file are read:</p><blockquote><p>Important: There is no need to run the following commands, as they were already run
by the <code>1-deploy-otel-collector.sh</code> script.</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>source</span> ~/.profile</span></span></code></pre></div><p>It then installed the <code>splunk-otel-collector-chart</code> Helm chart and ensured it&rsquo;s up-to-date:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart
</span></span><span class=line><span class=cl>  helm repo update</span></span></code></pre></div><p>And finally, it used <code>helm install</code> to install the collector:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  helm install splunk-otel-collector --version 0.132.0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=tagging-workshop-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f otel/values.yaml</span></span></code></pre></div><blockquote><p>Note that the <code>helm install</code> command references a <code>values.yaml</code> file, which is used
to customize the collector configuration. We&rsquo;ll explore this is more detail below.</p></blockquote><h2 id=confirm-the-collector-is-running>Confirm the Collector is Running</h2><p>We can confirm whether the collector is running with the following command:</p><div class=tab-panel data-tab-group=R-tabs-39c1cc7e2887c5cfeea62f2215d6cc71><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-39c1cc7e2887c5cfeea62f2215d6cc71","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-39c1cc7e2887c5cfeea62f2215d6cc71","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                                                            READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-kfvjb                               1/1     Running   <span class=m>0</span>          2m33s
</span></span><span class=line><span class=cl>splunk-otel-collector-certmanager-7d89558bc9-2fqnx              1/1     Running   <span class=m>0</span>          2m33s
</span></span><span class=line><span class=cl>splunk-otel-collector-certmanager-cainjector-796cc6bd76-hz4sp   1/1     Running   <span class=m>0</span>          2m33s
</span></span><span class=line><span class=cl>splunk-otel-collector-certmanager-webhook-6959cd5f8-qd5b6       1/1     Running   <span class=m>0</span>          2m33s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-57569b58c8-8ghds     1/1     Running   <span class=m>0</span>          2m33s
</span></span><span class=line><span class=cl>splunk-otel-collector-operator-6fd9f9d569-wd5mn                 2/2     Running   <span class=m>0</span>          2m33s</span></span></code></pre></div></div></div></div></div><h2 id=confirm-your-k8s-cluster-is-in-o11y-cloud>Confirm your K8s Cluster is in O11y Cloud</h2><p>In Splunk Observability Cloud, navigate to <strong>Infrastructure</strong> → <strong>Kubernetes</strong> → <strong>Kubernetes Clusters</strong>,
and then search for your Cluster Name (which is <code>$INSTANCE-k3s-cluster</code>):</p><p><a href=#R-image-1034941485cff5bc4773f4544c93c67c class=lightbox-link><img alt="Kubernetes node" class="lazy lightbox figure-image" loading=lazy src=../images/k8snode.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1034941485cff5bc4773f4544c93c67c><img alt="Kubernetes node" class="lazy lightbox lightbox-image" loading=lazy src=../images/k8snode.png></a></p><h2 id=get-the-collector-configuration>Get the Collector Configuration</h2><p>Before we customize the collector config, how do we determine what the current configuration
looks like?</p><p>In a Kubernetes environment, the collector configuration is stored using a Config Map.</p><p>We can see which config maps exist in our cluster with the following command:</p><div class=tab-panel data-tab-group=R-tabs-00e99ddaf94de48310c75f841f9d119d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-00e99ddaf94de48310c75f841f9d119d","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-00e99ddaf94de48310c75f841f9d119d","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector</span></span></code></pre></div></div></div><div data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                                                 DATA   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-otel-k8s-cluster-receiver   <span class=m>1</span>      3h37m
</span></span><span class=line><span class=cl>splunk-otel-collector-otel-agent                  <span class=m>1</span>      3h37m</span></span></code></pre></div></div></div></div></div><p>We can then view the config map of the collector agent as follows:</p><div class=tab-panel data-tab-group=R-tabs-eeb17537be37e6ac5fa4b34270c42f98><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-eeb17537be37e6ac5fa4b34270c42f98","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-eeb17537be37e6ac5fa4b34270c42f98","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-agent</span></span></code></pre></div></div></div><div data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Name:         splunk-otel-collector-otel-agent
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Labels:       <span class=nv>app</span><span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/instance<span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/managed-by<span class=o>=</span>Helm
</span></span><span class=line><span class=cl>              app.kubernetes.io/name<span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/version<span class=o>=</span>0.113.0
</span></span><span class=line><span class=cl>              <span class=nv>chart</span><span class=o>=</span>splunk-otel-collector-0.113.0
</span></span><span class=line><span class=cl>              helm.sh/chart<span class=o>=</span>splunk-otel-collector-0.113.0
</span></span><span class=line><span class=cl>              <span class=nv>heritage</span><span class=o>=</span>Helm
</span></span><span class=line><span class=cl>              <span class=nv>release</span><span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>Annotations:  meta.helm.sh/release-name: splunk-otel-collector
</span></span><span class=line><span class=cl>              meta.helm.sh/release-namespace: default
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Data</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>relay:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>exporters:
</span></span><span class=line><span class=cl>  otlphttp:
</span></span><span class=line><span class=cl>    headers:
</span></span><span class=line><span class=cl>      X-SF-Token: <span class=si>${</span><span class=nv>SPLUNK_OBSERVABILITY_ACCESS_TOKEN</span><span class=si>}</span>
</span></span><span class=line><span class=cl>    metrics_endpoint: https://ingest.us1.signalfx.com/v2/datapoint/otlp
</span></span><span class=line><span class=cl>    traces_endpoint: https://ingest.us1.signalfx.com/v2/trace/otlp
</span></span><span class=line><span class=cl>    <span class=o>(</span>followed by the rest of the collector config in yaml format<span class=o>)</span> </span></span></code></pre></div></div></div></div></div><h2 id=how-to-update-the-collector-configuration-in-k8s>How to Update the Collector Configuration in K8s</h2><p>We can customize the collector configuration in K8s using the <code>values.yaml</code> file.</p><blockquote><p>See <a href=https://github.com/signalfx/splunk-otel-collector-chart/blob/main/helm-charts/splunk-otel-collector/values.yaml rel=external target=_blank>this file</a>
for a comprehensive list of customization options that are available in the <code>values.yaml</code> file.</p></blockquote><p>Let&rsquo;s look at an example.</p><h3 id=add-the-debug-exporter>Add the Debug Exporter</h3><p>Suppose we want to see the traces that are sent to the collector. We can use the debug exporter for this purpose, which can be helpful for troubleshooting OpenTelemetry related issues.</p><p>You can use <code>vi</code> or <code>nano</code> to edit the <code>values.yaml</code> file. We will show an example using vi:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/workshop/tagging/otel/values.yaml</span></span></code></pre></div><p>Add the debug exporter by copying and pasting the following text to the bottom of the <code>values.yaml</code> file:</p><blockquote><p>Press &lsquo;i&rsquo; to enter into insert mode in vi before adding the text below.</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=c># NEW CONTENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span></span></span></code></pre></div><p>After these changes, the <code>values.yaml</code> file should include the following contents:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>profilingEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>certmanager</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>operator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>kubeletstats</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>insecure_skip_verify</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>auth_type</span><span class=p>:</span><span class=w> </span><span class=l>serviceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=l>${K8S_NODE_IP}:10250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metric_groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>k8s_api_config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>auth_type</span><span class=p>:</span><span class=w> </span><span class=l>serviceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>extra_metadata_labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>container.id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>k8s.volume.type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># NEW CONTENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span></span></span></code></pre></div><blockquote><p>To save your changes in vi, press the <code>esc</code> key to enter command mode, then type <code>:wq!</code> followed by pressing the
<code>enter/return</code> key.</p></blockquote><p>Once the file is saved, we can apply the changes with:</p><div class=tab-panel data-tab-group=R-tabs-3a1c3ad8931124c4a1916c372e72b009><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-3a1c3ad8931124c4a1916c372e72b009","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-3a1c3ad8931124c4a1916c372e72b009","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk/workshop/tagging
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>helm upgrade splunk-otel-collector --version 0.132.0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=tagging-workshop-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f otel/values.yaml</span></span></code></pre></div></div></div><div data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Release <span class=s2>&#34;splunk-otel-collector&#34;</span> has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Mon Dec <span class=m>23</span> 19:08:08 <span class=m>2024</span>
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>2</span>
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm us1.</span></span></code></pre></div></div></div></div></div><p>Whenever a change to the collector config is made via a <code>values.yaml</code> file, it&rsquo;s helpful
to review the actual configuration applied to the collector by looking at the config map:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-agent</span></span></code></pre></div><p>We can see that the debug exporter was added to the traces pipeline, as desired:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>debug</span></span></span></code></pre></div><p>We&rsquo;ll explore the output of the debug exporter once we deploy an application
in our cluster and start capturing traces.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 29, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=deploy-the-sample-application-and-instrument-with-opentelemetry>Deploy the Sample Application and Instrument with OpenTelemetry</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>At this point, we&rsquo;ve deployed an OpenTelemetry collector in our K8s cluster, and it&rsquo;s
successfully collecting infrastructure metrics.</p><p>The next step is to deploy a sample application and instrument
with OpenTelemetry to capture traces.</p><p>We&rsquo;ll use a microservices-based application written in Python. To keep the workshop simple,
we&rsquo;ll focus on two services: a credit check service and a credit processor service.</p><h2 id=deploy-the-application>Deploy the Application</h2><p>To save time, we&rsquo;ve built Docker images for both of these services already which are available in Docker Hub.
We can deploy the credit check service in our K8s cluster with the following command:</p><div class=tab-panel data-tab-group=R-tabs-30eca46a8b8fe1076f84a58a2a3c675d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-30eca46a8b8fe1076f84a58a2a3c675d","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-30eca46a8b8fe1076f84a58a2a3c675d","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f /home/splunk/workshop/tagging/creditcheckservice-py-with-tags/creditcheckservice-dockerhub.yaml</span></span></code></pre></div></div></div><div data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/creditcheckservice created
</span></span><span class=line><span class=cl>service/creditcheckservice created</span></span></code></pre></div></div></div></div></div><p>Next, let&rsquo;s deploy the credit processor service:</p><div class=tab-panel data-tab-group=R-tabs-91e7adf51962829f30de849cb3817ddc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-91e7adf51962829f30de849cb3817ddc","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-91e7adf51962829f30de849cb3817ddc","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f /home/splunk/workshop/tagging/creditprocessorservice/creditprocessorservice-dockerhub.yaml</span></span></code></pre></div></div></div><div data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/creditprocessorservice created
</span></span><span class=line><span class=cl>service/creditprocessorservice created</span></span></code></pre></div></div></div></div></div><p>Finally, let&rsquo;s deploy a load generator to generate traffic:</p><div class=tab-panel data-tab-group=R-tabs-2d8061263c6c47787119fbec2281bf6a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-2d8061263c6c47787119fbec2281bf6a","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-2d8061263c6c47787119fbec2281bf6a","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f /home/splunk/workshop/tagging/loadgenerator/loadgenerator-dockerhub.yaml</span></span></code></pre></div></div></div><div data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/loadgenerator created</span></span></code></pre></div></div></div></div></div><h2 id=explore-the-application>Explore the Application</h2><p>We&rsquo;ll provide an overview of the application in this section. If you&rsquo;d like to see the complete source
code for the application, refer to the <a href=https://github.com/splunk/observability-workshop/tree/main/workshop/tagging rel=external target=_blank>Observability Workshop repository in GitHub</a></p><h3 id=opentelemetry-instrumentation>OpenTelemetry Instrumentation</h3><p>If we look at the Dockerfile&rsquo;s used to build the credit check and credit processor services, we
can see that they&rsquo;ve already been instrumented with OpenTelemetry. For example, let&rsquo;s look at
<code>/home/splunk/workshop/tagging/creditcheckservice-py-with-tags/Dockerfile</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.11-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Set working directory</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy requirements over</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install --yes gcc python3-dev<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>PIP_ROOT_USER_ACTION</span><span class=o>=</span>ignore
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Install Python dependencies</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install --no-cache-dir -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy main app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> main.py .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Bootstrap OTel</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> splunk-py-trace-bootstrap<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Set the entrypoint command to run the application</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;splunk-py-trace&#34;</span><span class=p>,</span> <span class=s2>&#34;python3&#34;</span><span class=p>,</span> <span class=s2>&#34;main.py&#34;</span><span class=p>]</span></span></span></code></pre></div><p>We can see that <code>splunk-py-trace-bootstrap</code> was included, which installs OpenTelemetry instrumentation
for supported packages used by our applications. We can also see that <code>splunk-py-trace</code> is used as part
of the command to start the application.</p><p>And if we review the <code>/home/splunk/workshop/tagging/creditcheckservice-py-with-tags/requirements.txt</code> file,
we can see that <code>splunk-opentelemetry[all]</code> was included in the list of packages.</p><p>Finally, if we review the Kubernetes manifest that we used to deploy this service (<code>/home/splunk/workshop/tagging/creditcheckservice-py-with-tags/creditcheckservice-dockerhub.yaml</code>),
we can see that environment variables were set in the container to tell OpenTelemetry
where to export OTLP data to:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8888&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4317&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;creditcheckservice&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_PROPAGATORS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;tracecontext,baggage&#34;</span></span></span></code></pre></div><p>This is all that&rsquo;s needed to instrument the service with OpenTelemetry!</p><h3 id=explore-the-application-1>Explore the Application</h3><p>We&rsquo;ve captured several custom tags with our application, which we&rsquo;ll explore shortly. Before we do that, let&rsquo;s
introduce the concept of tags and why they&rsquo;re important.</p><h3 id=what-are-tags>What are tags?</h3><p>Tags are key-value pairs that provide additional metadata about spans in a trace, allowing you to enrich the context of the spans you send to <strong>Splunk APM</strong>.</p><p>For example, a payment processing application would find it helpful to track:</p><ul><li>The payment type used (i.e. credit card, gift card, etc.)</li><li>The ID of the customer that requested the payment</li></ul><p>This way, if errors or performance issues occur while processing the payment, we have the context we need for troubleshooting.</p><p>While some tags can be added with the OpenTelemetry collector, the ones we’ll be working with in this workshop are more granular, and are added by application developers using the OpenTelemetry SDK.</p><h3 id=why-are-tags-so-important>Why are tags so important?</h3><p>Tags are essential for an application to be truly observable. They add the context to the traces to help us
understand why some users get a great experience and others don&rsquo;t. And powerful features in
<strong>Splunk Observability Cloud</strong> utilize tags to help you jump quickly to root cause.</p><blockquote><p>A note about terminology before we proceed. While we discuss <strong>tags</strong> in this workshop,
and this is the terminology we use in <strong>Splunk Observability Cloud</strong>, OpenTelemetry
uses the term <strong>attributes</strong> instead. So when you see tags mentioned throughout this
workshop, you can treat them as synonymous with attributes.</p></blockquote><h3 id=how-are-tags-captured>How are tags captured?</h3><p>To capture tags in a Python application, we start by importing the trace module by adding an
import statement to the top of the <code>/home/splunk/workshop/tagging/creditcheckservice-py-with-tags/main.py</code> file:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>waitress</span> <span class=kn>import</span> <span class=n>serve</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry</span> <span class=kn>import</span> <span class=n>trace</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></div><p>Next, we need to get a reference to the current span so we can add an attribute (aka tag) to it:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;customer.num&#34;</span><span class=p>,</span> <span class=n>customerNum</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></div><p>That was pretty easy, right? We&rsquo;ve captured a total of four tags in the credit check service, with the final result looking like this:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;customer.num&#34;</span><span class=p>,</span> <span class=n>customerNum</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get Credit Score</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span> <span class=o>+</span> <span class=n>customerNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScore</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>creditScoreReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.score&#34;</span><span class=p>,</span> <span class=n>creditScore</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreCategory</span> <span class=o>=</span> <span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.score.category&#34;</span><span class=p>,</span> <span class=n>creditScoreCategory</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Run Credit Check</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>customerNum</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;score=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditScore</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>checkResult</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditCheckReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.check.result&#34;</span><span class=p>,</span> <span class=n>checkResult</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>checkResult</span></span></span></code></pre></div><h2 id=review-trace-data>Review Trace Data</h2><p>Before looking at the trace data in Splunk Observability Cloud,
let&rsquo;s review what the debug exporter has captured by tailing the agent collector logs with the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>component</span><span class=o>=</span>otel-collector-agent -f</span></span></code></pre></div><p>Hint: use <code>CTRL+C</code> to stop tailing the logs.</p><p>You should see traces written to the agent collector logs such as the following:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>InstrumentationScope opentelemetry.instrumentation.flask 0.44b0
Span #0
    Trace ID       : 9f9fc109903f25ba57bea9b075aa4833
    Parent ID      : 
    ID             : 6d71519f454f6059
    Name           : /check
    Kind           : Server
    Start time     : 2024-12-23 19:55:25.815891965 +0000 UTC
    End time       : 2024-12-23 19:55:27.824664949 +0000 UTC
    Status code    : Unset
    Status message : 
Attributes:
     -&gt; http.method: Str(GET)
     -&gt; http.server_name: Str(waitress.invalid)
     -&gt; http.scheme: Str(http)
     -&gt; net.host.port: Int(8888)
     -&gt; http.host: Str(creditcheckservice:8888)
     -&gt; http.target: Str(/check?customernum=30134241)
     -&gt; net.peer.ip: Str(10.42.0.19)
     -&gt; http.user_agent: Str(python-requests/2.31.0)
     -&gt; net.peer.port: Str(47248)
     -&gt; http.flavor: Str(1.1)
     -&gt; http.route: Str(/check)
     -&gt; customer.num: Str(30134241)
     -&gt; credit.score: Int(443)
     -&gt; credit.score.category: Str(poor)
     -&gt; credit.check.result: Str(OK)
     -&gt; http.status_code: Int(200)</code></pre></div><p>Notice how the trace includes the tags (aka attributes) that we captured in the code, such as
<code>credit.score</code> and <code>credit.score.category</code>. We&rsquo;ll use these in the next section, when
we analyze the traces in Splunk Observability Cloud to find the root cause of a performance issue.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 16, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=create-a-troubleshooting-metricset>Create a Troubleshooting MetricSet</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=index-tags>Index Tags</h2><p>To use advanced features in <strong>Splunk Observability Cloud</strong> such as <strong>Tag Spotlight</strong>, we&rsquo;ll need to first index one or more tags.</p><p>To do this, navigate to <strong>Settings</strong> -> <strong>MetricSets</strong> and ensure the <strong>APM</strong> tab is selected. Then click the <strong>+ Add Custom MetricSet</strong> button.</p><p>Let&rsquo;s index the <code>credit.score.category</code> tag by entering the following details (<strong>note</strong>: since everyone in the workshop is using the same organization, the instructor will do this step on your behalf):</p><p><a href=#R-image-abd79d208a85ad860793404fc19bc528 class=lightbox-link><img alt="Create Troubleshooting MetricSet" class="lazy lightbox figure-image" loading=lazy src=../images/create_troubleshooting_metric_set.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-abd79d208a85ad860793404fc19bc528><img alt="Create Troubleshooting MetricSet" class="lazy lightbox lightbox-image" loading=lazy src=../images/create_troubleshooting_metric_set.png></a></p><p>Click <strong>Start Analysis</strong> to proceed.</p><p>The tag will appear in the list of <strong>Pending MetricSets</strong> while analysis is performed.</p><p><a href=#R-image-31b32b855386d3d1da74ef2a79d5e585 class=lightbox-link><img alt="Pending MetricSets" class="lazy lightbox figure-image" loading=lazy src=../images/pending_metric_set.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-31b32b855386d3d1da74ef2a79d5e585><img alt="Pending MetricSets" class="lazy lightbox lightbox-image" loading=lazy src=../images/pending_metric_set.png></a></p><p>Once analysis is complete, click on the checkmark in the <strong>Actions</strong> column.</p><h2 id=troubleshooting-vs-monitoring-metricsets>Troubleshooting vs. Monitoring MetricSets</h2><p>You may have noticed that, to index this tag, we created something called a <strong>Troubleshooting MetricSet</strong>. It&rsquo;s named this way because a Troubleshooting MetricSet, or TMS, allows us to troubleshoot issues with this tag using features such as <strong>Tag Spotlight</strong>.</p><p>You may have also noticed that there&rsquo;s another option which we didn&rsquo;t choose called a <strong>Monitoring MetricSet</strong> (or MMS). Monitoring MetricSets go beyond troubleshooting and allow us to use tags for alerting and dashboards. While we won&rsquo;t be
exploring this capability as part of this workshop, it&rsquo;s a powerful feature that I encourage you to explore on your own.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 10, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=troubleshoot-a-problem-using-tag-spotlight>Troubleshoot a Problem Using Tag Spotlight</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<h2 id=explore-apm-data>Explore APM Data</h2><p>Let&rsquo;s explore some of the APM data we&rsquo;ve captured to see how our application is performing.</p><p>Navigate to <strong>APM</strong>, then use the <strong>Environment</strong> dropdown to select your environment (i.e. <code>tagging-workshop-instancename</code>).</p><p>You should see <code>creditprocessorservice</code> and <code>creditcheckservice</code> displayed in the list of services:</p><p><a href=#R-image-994750726d04d0332370ccb7a2dacbb3 class=lightbox-link><img alt="APM Overview" class="lazy lightbox figure-image" loading=lazy src=../images/apm_overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-994750726d04d0332370ccb7a2dacbb3><img alt="APM Overview" class="lazy lightbox lightbox-image" loading=lazy src=../images/apm_overview.png></a></p><p>Click on <strong>Service Map</strong> on the right-hand side to view the service map. We can see that the <code>creditcheckservice</code> makes calls to the <code>creditprocessorservice</code>, with an average response time of at least 3 seconds:</p><p><a href=#R-image-38f11927ba4ff65d3e592a7d41073127 class=lightbox-link><img alt="Service Map" class="lazy lightbox figure-image" loading=lazy src=../images/service_map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-38f11927ba4ff65d3e592a7d41073127><img alt="Service Map" class="lazy lightbox lightbox-image" loading=lazy src=../images/service_map.png></a></p><p>Next, click on <strong>Traces</strong> on the right-hand side to see the traces captured for this application. You&rsquo;ll see that some traces run relatively fast (i.e. just a few milliseconds), whereas others take a few seconds.</p><p><a href=#R-image-0429a36e8e2db129feae4221476831c9 class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0429a36e8e2db129feae4221476831c9><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/traces.png></a></p><p>Click on one of the longer running traces. In this example, the trace took five seconds, and we can see that most of the time was spent calling the <code>/runCreditCheck</code> operation, which is part of the <code>creditprocessorservice</code>:</p><p><a href=#R-image-9b8bbb064f0cad40610de5517f20c577 class=lightbox-link><img alt="Long Running Trace" class="lazy lightbox figure-image" loading=lazy src=../images/long_running_trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9b8bbb064f0cad40610de5517f20c577><img alt="Long Running Trace" class="lazy lightbox lightbox-image" loading=lazy src=../images/long_running_trace.png></a></p><p>But why are some traces slow, and others are relatively quick?</p><p>Close the trace and return to the Trace Analyzer. If you toggle <strong>Errors only</strong> to <code>on</code>, you&rsquo;ll also notice that some traces have errors:</p><p><a href=#R-image-0ac40b2ce90a24cd9627e8e95cd971e5 class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/traces_with_errors.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0ac40b2ce90a24cd9627e8e95cd971e5><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/traces_with_errors.png></a></p><p>If we look at one of the error traces, we can see that the error occurs when the <code>creditprocessorservice</code> attempts to call another service named <code>otherservice</code>. But why do some requests result in a call to <code>otherservice</code>, and others don&rsquo;t?</p><p><a href=#R-image-173a3ee89e842fa64412b209a2a48ede class=lightbox-link><img alt="Trace with Errors" class="lazy lightbox figure-image" loading=lazy src=../images/error_trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-173a3ee89e842fa64412b209a2a48ede><img alt="Trace with Errors" class="lazy lightbox lightbox-image" loading=lazy src=../images/error_trace.png></a></p><p>To determine why some requests perform slowly, and why some requests result in errors, we could look through the
traces one by one and try to find a pattern behind the issues.</p><p><strong>Splunk Observability Cloud</strong> provides a better way to find the root cause of an issue. We&rsquo;ll explore this next.</p><h2 id=using-tag-spotlight>Using Tag Spotlight</h2><p>Since we indexed the <code>credit.score.category</code> tag, we can use it with <strong>Tag Spotlight</strong> to troubleshoot our application.</p><p>Navigate to <strong>APM</strong> then click on <strong>Tag Spotlight</strong> on the right-hand side. Ensure the <code>creditcheckservice</code> service is selected from the <strong>Service</strong> drop-down (if not already selected).</p><p>With <strong>Tag Spotlight</strong>, we can see 100% of credit score requests that result in a score of <code>impossible</code> have an error, yet requests for all other credit score types have no errors at all!</p><p><strong><a href=#R-image-45cd6d1c979630b3af31cacc016ba144 class=lightbox-link><img alt="Tag Spotlight with Errors" class="lazy lightbox figure-image" loading=lazy src=../images/tag_spotlight_errors.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-45cd6d1c979630b3af31cacc016ba144><img alt="Tag Spotlight with Errors" class="lazy lightbox lightbox-image" loading=lazy src=../images/tag_spotlight_errors.png></a></strong></p><p>This illustrates the power of <strong>Tag Spotlight</strong>! Finding this pattern would be time-consuming without it, as we&rsquo;d have to manually look through hundreds of traces to identify the pattern (and even then, there&rsquo;s no guarantee we&rsquo;d find it).</p><p>We&rsquo;ve looked at errors, but what about latency? Let&rsquo;s click on the <strong>Requests & errors distribution</strong> dropdown and change it to <strong>Latency distribution</strong>.</p><blockquote><p>IMPORTANT: Click on the settings icon beside <strong>Cards display</strong> to add the P50 and P99 metrics.</p></blockquote><p>Here, we can see that the requests with a <code>poor</code> credit score request are running slowly, with P50, P90, and P99 times of around 3 seconds, which is too long for our users to wait, and much slower than other requests.</p><p>We can also see that some requests with an <code>exceptional</code> credit score request are running slowly, with P99 times of around 5 seconds, though the P50 response time is relatively quick.</p><p><strong><a href=#R-image-d5ccf7fada17058dd2e9aa3940425d4e class=lightbox-link><img alt="Tag Spotlight with Latency" class="lazy lightbox figure-image" loading=lazy src=../images/tag_spotlight_latency.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d5ccf7fada17058dd2e9aa3940425d4e><img alt="Tag Spotlight with Latency" class="lazy lightbox lightbox-image" loading=lazy src=../images/tag_spotlight_latency.png></a></strong></p><h2 id=using-dynamic-service-maps>Using Dynamic Service Maps</h2><p>Now that we know the credit score category associated with the request can impact performance and error rates, let&rsquo;s explore another feature that utilizes indexed tags: <strong>Dynamic Service Maps</strong>.</p><p>With Dynamic Service Maps, we can breakdown a particular service by a tag. For example, let&rsquo;s click on <strong>APM</strong>, then click <strong>Service Map</strong> to view the service map.</p><p>Click on <code>creditcheckservice</code>. Then, on the right-hand menu, click on the drop-down that says <strong>Breakdown</strong>, and select the <code>credit.score.category</code> tag.</p><p>At this point, the service map is updated dynamically, and we can see the performance of requests hitting <code>creditcheckservice</code> broken down by the credit score category:</p><p><strong><a href=#R-image-b55a30520b29609aec561f5c1e104863 class=lightbox-link><img alt="Service Map Breakdown" class="lazy lightbox figure-image" loading=lazy src=../images/service_map_breakdown.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b55a30520b29609aec561f5c1e104863><img alt="Service Map Breakdown" class="lazy lightbox lightbox-image" loading=lazy src=../images/service_map_breakdown.png></a></strong></p><p>This view makes it clear that performance for <code>good</code> and <code>fair</code> credit scores is excellent, while <code>poor</code> and <code>exceptional</code> scores are much slower, and <code>impossible</code> scores result in errors.</p><h2 id=our-findings>Our Findings</h2><p><strong>Tag Spotlight</strong> has uncovered several interesting patterns for the engineers that own this service to explore further:</p><ul><li>Why are all the <code>impossible</code> credit score requests resulting in error?</li><li>Why are all the <code>poor</code> credit score requests running slowly?</li><li>Why do some of the <code>exceptional</code> requests run slowly?</li></ul><p>As an SRE, passing this context to the engineering team would be extremely helpful for their investigation, as it would allow them to track down the issue much more quickly than if we simply told them that the service was &ldquo;sometimes slow&rdquo;.</p><p>If you&rsquo;re curious, have a look at the source code for the <code>creditprocessorservice</code>. You&rsquo;ll see that requests with impossible, poor, and exceptional credit scores are handled differently, thus resulting in the differences in error rates and latency that we uncovered.</p><p>The behavior we saw with our application is typical for modern cloud-native applications, where different inputs passed to a service lead to different code paths, some of which result in slower performance or errors. For example, in a real credit check service, requests resulting in low credit scores may be sent to another downstream service to further evaluate risk, and may perform more slowly than requests resulting in higher scores, or encounter higher error rates.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 5, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;<p>This workshop provided hands-on experience with the following concepts:</p><ul><li>How to deploy the <strong>Splunk Distribution of the OpenTelemetry Collector</strong> using Helm.</li><li>How instrument an application with <a href=https://opentelemetry.io rel=external target=_blank><strong>OpenTelemetry</strong></a>.</li><li>How to capture tags of interest from your application using an OpenTelemetry SDK.</li><li>How to index tags in <strong>Splunk Observability Cloud</strong> using <strong>Troubleshooting MetricSets</strong>.</li><li>How to utilize tags in <strong>Splunk Observability Cloud</strong> to find “unknown unknowns” using the <strong>Tag Spotlight</strong> and <strong>Dynamic Service Map</strong> features.</li></ul><p>Collecting tags aligned with the best practices shared in this workshop will let you get even more value from the data you’re sending to <strong>Splunk Observability Cloud</strong>. Now that you’ve completed this workshop, you have the knowledge you need to start collecting tags from your own applications!</p><p>To get started with capturing tags today, check out <a href=https://docs.splunk.com/observability/en/apm/span-tags/add-context-trace-span.html#instrument-your-application-code-to-add-tags-to-spans rel=external target=_blank>how to add tags in various supported languages</a>, and then <a href=https://docs.splunk.com/observability/en/apm/span-tags/index-span-tags.html#apm-index-span-tags rel=external target=_blank>how to use them to create Troubleshooting MetricSets</a> so they can be analyzed in Tag Spotlight. For more help, feel free to <a href=https://www.splunk.com/en_us/about-splunk/contact-us.html rel=external target=_blank>ask a Splunk Expert</a>.</p><p>And to see how other languages and environments are instrumented with OpenTelemetry,
explore the <a href=https://github.com/signalfx/splunk-opentelemetry-examples rel=external target=_blank>Splunk OpenTelemetry Examples GitHub repository</a>.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip for Workshop Facilitator(s)</summary><div class=box-content><p>Once the workshop is complete, remember to delete the APM MetricSet you created earlier for the <code>credit.score.category</code> tag.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Dec 23, 2024</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v6.8/js/clipboard/clipboard.min.js?1759784456 defer></script><script src=/observability-workshop/v6.8/js/perfect-scrollbar/perfect-scrollbar.min.js?1759784456 defer></script><script src=/observability-workshop/v6.8/js/theme.min.js?1759784456 defer></script></body></html>