<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 8.0.0+97777ec5111409397e83f44eca496eea97697836"><meta name=description content="This scenario helps engineering teams identify and fix issues caused by planned and unplanned changes to their microservices-based applications."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Debug Problems in Microservices :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="This scenario helps engineering teams identify and fix issues caused by planned and unplanned changes to their microservices-based applications."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v6.7/en/scenarios/debug-problems/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Debug Problems in Microservices :: Splunk Observability Cloud Workshops"><meta property="og:description" content="This scenario helps engineering teams identify and fix issues caused by planned and unplanned changes to their microservices-based applications."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Debug Problems in Microservices :: Splunk Observability Cloud Workshops"><meta itemprop=description content="This scenario helps engineering teams identify and fix issues caused by planned and unplanned changes to their microservices-based applications."><meta itemprop=dateModified content="2025-09-08T12:10:04-04:00"><meta itemprop=wordCount content="72"><title>Debug Problems in Microservices :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v6.7/en/scenarios/debug-problems/index.html rel=canonical type=text/html title="Debug Problems in Microservices :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v6.7/images/favicon.ico?1759396524 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v6.7/css/auto-complete/auto-complete.min.css?1759396524 rel=stylesheet><script src=/observability-workshop/v6.7/js/auto-complete/auto-complete.min.js?1759396524 defer></script><script src=/observability-workshop/v6.7/js/search-lunr.min.js?1759396524 defer></script><script src=/observability-workshop/v6.7/js/search.min.js?1759396524 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/v6.7/searchindex.en.js?1759396524"</script><script src=/observability-workshop/v6.7/js/lunr/lunr.min.js?1759396524 defer></script><script src=/observability-workshop/v6.7/js/lunr/lunr.stemmer.support.min.js?1759396524 defer></script><script src=/observability-workshop/v6.7/js/lunr/lunr.multi.min.js?1759396524 defer></script><script src=/observability-workshop/v6.7/js/lunr/lunr.en.min.js?1759396524 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/observability-workshop/v6.7/fonts/fontawesome/css/fontawesome-all.min.css?1759396524 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v6.7/fonts/fontawesome/css/fontawesome-all.min.css?1759396524 rel=stylesheet></noscript><link href=/observability-workshop/v6.7/css/perfect-scrollbar/perfect-scrollbar.min.css?1759396524 rel=stylesheet><link href=/observability-workshop/v6.7/css/theme.min.css?1759396524 rel=stylesheet><link href=/observability-workshop/v6.7/css/format-print.min.css?1759396524 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/scenarios/debug-problems/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v6.7",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({appplicationName:"observability-workshop",realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",recorder:"splunk",features:{video:!0}})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-url=/observability-workshop/v6.7/en/scenarios/debug-problems/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.7/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.7/en/scenarios/index.html><span itemprop=name>Scenarios</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Debug Problems in Microservices</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.7/en/scenarios/debug-problems/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.7/en/scenarios/optimize-monitoring/6-workshop-conclusion/index.html title="Conclusion (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.7/en/scenarios/debug-problems/tagging/index.html title="Tagging Workshop (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable scenarios" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=debug-problems-in-microservices>Debug Problems in Microservices</h1><ul class="children children-type-tree children-sort-"><li class="children-title children-title-1"><a href=/observability-workshop/v6.7/en/scenarios/debug-problems/tagging/index.html>Tagging Workshop</a><p>This workshop shows how tags can be used to reduce the time required for SREs to isolate issues across services, so they know which team to engage to troubleshoot the issue further, and can provide context to help engineering get a head start on debugging.</p></li><li class="children-title children-title-1"><a href=/observability-workshop/v6.7/en/scenarios/debug-problems/profiling/index.html>Profiling Workshop</a><p>This workshop shows how Database Query Performance and AlwaysOn Profiling can be used to reduce the time required for engineers to debug problems in microservices.</p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 8, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of Debug Problems in Microservices</h1><article class=default><header class=headline></header><h1 id=tagging-workshop>Tagging Workshop</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Derek Mitchell</span></span><p><strong>Splunk Observability Cloud</strong> includes powerful features that dramatically reduce the time required for SREs to isolate issues across services, so they know which team to engage to troubleshoot the issue further, and can provide context to help engineering get a head start on debugging.</p><p>Unlocking these features requires tags to be included with your application traces. But how do you know which tags are the most valuable and how do you capture them?</p><p>In this workshop, we&rsquo;ll explore:</p><ul><li>What are <strong>tags</strong> and why are they such a critical part of making an application observable.</li><li>How to use <a href=https://opentelemetry.io rel=external target=_blank><strong>OpenTelemetry</strong></a> to capture tags of interest from your application.</li><li>How to index tags in <strong>Splunk Observability Cloud</strong> and the differences between <strong>Troubleshooting MetricSets</strong> and <strong>Monitoring MetricSets</strong>.</li><li>How to utilize tags in <strong>Splunk Observability Cloud</strong> to find “unknown unknowns” using the <strong>Tag Spotlight</strong> and <strong>Dynamic Service Map</strong> features.</li><li>How to utilize tags for alerting and dashboards.</li></ul><p>The workshop uses a simple microservices-based application to illustrate these concepts. Let&rsquo;s get started!</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>The easiest way to navigate through this workshop is by using:</p><ul><li>the left/right arrows (<strong>&lt;</strong> | <strong>></strong>) on the top right of this page</li><li>the left (◀️) and right (▶️) cursor keys on your keyboard</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of Tagging Workshop</h1><article class=default><header class=headline></header><h1 id=build-the-sample-application>Build the Sample Application</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=introduction>Introduction</h2><p>For this workshop, we&rsquo;ll be using a microservices-based application. This application is for an online retailer and normally includes more than a dozen services. However, to keep the workshop simple, we&rsquo;ll be focusing on two services used by the retailer as part of their payment processing workflow: the credit check service and the credit processor service.</p><h2 id=pre-requisites>Pre-requisites</h2><p>You will start with an EC2 instance and perform some <a href=/observability-workshop/v6.7/en/scenarios/debug-problems/tagging/1-build-application/index.html#initial-steps>initial steps</a> in order to get to the following state:</p><ul><li>Deploy the <strong>Splunk distribution of the OpenTelemetry Collector</strong></li><li>Build and deploy <code>creditcheckservice</code> and <code>creditprocessorservice</code></li><li>Deploy a load generator to send traffic to the services</li></ul><h2 id=initial-steps>Initial Steps</h2><p>The initial setup can be completed by executing the following steps on the command line of your EC2 instance:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> workshop/tagging
</span></span><span class=line><span class=cl>./0-deploy-collector-with-services.sh</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Java</summary><div class=box-content><p>There are implementations in multiple languages available for <code>creditcheckservice</code>.
Run</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./0-deploy-collector-with-services.sh java</span></span></code></pre></div><p>to pick Java over Python.</p></div></details><h2 id=view-your-application-in-splunk-observability-cloud>View your application in Splunk Observability Cloud</h2><p>Now that the setup is complete, let&rsquo;s confirm that it&rsquo;s sending data to <strong>Splunk Observability Cloud</strong>. Note that when the application is deployed for the first time, it may take a few minutes for the data to appear.</p><p>Navigate to APM, then use the Environment dropdown to select your environment (i.e. <code>tagging-workshop-instancename</code>).</p><p>If everything was deployed correctly, you should see <code>creditprocessorservice</code> and <code>creditcheckservice</code> displayed in the list of services:</p><p><a href=#R-image-8659952412b9484217419c9aac9edd4f class=lightbox-link><img alt="APM Overview" class="lazy lightbox figure-image" loading=lazy src=../images/apm_overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8659952412b9484217419c9aac9edd4f><img alt="APM Overview" class="lazy lightbox lightbox-image" loading=lazy src=../images/apm_overview.png></a></p><p>Click on <strong>Explore</strong> on the right-hand side to view the service map. We can see that the <code>creditcheckservice</code> makes calls to the <code>creditprocessorservice</code>, with an average response time of at least 3 seconds:</p><p><a href=#R-image-b8e39c50b2541ec94bd2b16b2e117b21 class=lightbox-link><img alt="Service Map" class="lazy lightbox figure-image" loading=lazy src=../images/service_map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b8e39c50b2541ec94bd2b16b2e117b21><img alt="Service Map" class="lazy lightbox lightbox-image" loading=lazy src=../images/service_map.png></a></p><p>Next, click on <strong>Traces</strong> on the right-hand side to see the traces captured for this application. You&rsquo;ll see that some traces run relatively fast (i.e. just a few milliseconds), whereas others take a few seconds.</p><p><a href=#R-image-997ffa30bea6bf7f69dd4b7c6d4fac9f class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-997ffa30bea6bf7f69dd4b7c6d4fac9f><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/traces.png></a></p><p>If you toggle <strong>Errors only</strong> to <code>on</code>, you&rsquo;ll also notice that some traces have errors:</p><p><a href=#R-image-ef1f0841f750c941cfdf6666edd8fca0 class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/traces_with_errors.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ef1f0841f750c941cfdf6666edd8fca0><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/traces_with_errors.png></a></p><p>Toggle <strong>Errors only</strong> back to <code>off</code> and sort the traces by duration, then click on one of the longer running traces. In this example, the trace took five seconds, and we can see that most of the time was spent calling the <code>/runCreditCheck</code> operation, which is part of the <code>creditprocessorservice</code>.</p><p><a href=#R-image-7ad4409c1dc929ee79854fe1993513f0 class=lightbox-link><img alt="Long Running Trace" class="lazy lightbox figure-image" loading=lazy src=../images/long_running_trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7ad4409c1dc929ee79854fe1993513f0><img alt="Long Running Trace" class="lazy lightbox lightbox-image" loading=lazy src=../images/long_running_trace.png></a></p><p>Currently, we don&rsquo;t have enough details in our traces to understand why some requests finish in a few milliseconds, and others take several seconds. To provide the best possible customer experience, this will be critical for us to understand.</p><p>We also don&rsquo;t have enough information to understand why some requests result in errors, and others don&rsquo;t. For example, if we look at one of the error traces, we can see that the error occurs when the <code>creditprocessorservice</code> attempts to call another service named <code>otherservice</code>. But why do some requests results in a call to <code>otherservice</code>, and others don&rsquo;t?</p><p><a href=#R-image-c200ff398413f7c02a54f8a157fce058 class=lightbox-link><img alt="Trace with Errors" class="lazy lightbox figure-image" loading=lazy src=../images/error_trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c200ff398413f7c02a54f8a157fce058><img alt="Trace with Errors" class="lazy lightbox lightbox-image" loading=lazy src=../images/error_trace.png></a></p><p>We&rsquo;ll explore these questions and more in the workshop.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=what-are-tags>What are Tags?</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>3 minutes</span>
</span>&nbsp;<p>To understand why some requests have errors or slow performance, we&rsquo;ll need to add context to our traces. We&rsquo;ll do this by adding tags. But first, let&rsquo;s take a moment to discuss what tags are, and why they&rsquo;re so important for observability.</p><h2 id=what-are-tags>What are tags?</h2><p>Tags are key-value pairs that provide additional metadata about spans in a trace, allowing you to enrich the context of the spans you send to Splunk APM.</p><p>For example, a payment processing application would find it helpful to track:</p><ul><li>The payment type used (i.e. credit card, gift card, etc.)</li><li>The ID of the customer that requested the payment</li></ul><p>This way, if errors or performance issues occur while processing the payment, we have the context we need for troubleshooting.</p><p>While some tags can be added with the OpenTelemetry collector, the ones we’ll be working with in this workshop are more granular, and are added by application developers using the OpenTelemetry API.</p><h2 id=attributes-vs-tags>Attributes vs. Tags</h2><p>A note about terminology before we proceed. While this workshop is about <strong>tags</strong>, and this is the terminology we use in <strong>Splunk Observability Cloud</strong>, OpenTelemetry uses the term <strong>attributes</strong> instead. So when you see tags mentioned throughout this workshop, you can treat them as synonymous with attributes.</p><h2 id=why-are-tags-so-important>Why are tags so important?</h2><p>Tags are essential for an application to be truly observable. As we saw with our credit check service, some users are having a great experience: fast with no errors. But other users get a slow experience or encounter errors.</p><p>Tags add the context to the traces to help us understand why some users get a great experience and others don&rsquo;t. And powerful features in <strong>Splunk Observability Cloud</strong> utilize tags to help you jump quickly to root cause.</p><h2 id=sneak-peak-tag-spotlight>Sneak Peak: Tag Spotlight</h2><p><strong>Tag Spotlight</strong> uses tags to discover trends that contribute to high latency or error rates:</p><p><a href=#R-image-2c0b1ae9831b309c9fd45c256ed32517 class=lightbox-link><img alt="Tag Spotlight Preview" class="lazy lightbox figure-image" loading=lazy src=../images/tag_spotlight_preview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2c0b1ae9831b309c9fd45c256ed32517><img alt="Tag Spotlight Preview" class="lazy lightbox lightbox-image" loading=lazy src=../images/tag_spotlight_preview.png></a></p><p>The screenshot above provides an example of Tag Spotlight from another application.</p><p>Splunk has analyzed all of the tags included as part of traces that involve the payment service.</p><p>It tells us very quickly whether some tag values have more errors than others.</p><p>If we look at the version tag, we can see that version 350.10 of the service has a 100% error rate, whereas version 350.9 of the service has no errors at all:</p><p><a href=#R-image-bcef169403d516e8083b8a28fae6000c class=lightbox-link><img alt="Tag Spotlight Preview" class="lazy lightbox figure-image" loading=lazy src=../images/tag_spotlight_preview_details.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bcef169403d516e8083b8a28fae6000c><img alt="Tag Spotlight Preview" class="lazy lightbox lightbox-image" loading=lazy src=../images/tag_spotlight_preview_details.png></a></p><p>We’ll be using Tag Spotlight with the credit check service later on in the workshop, once we’ve captured some tags of our own.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=capture-tags-with-opentelemetry>Capture Tags with OpenTelemetry</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>Please proceed to one of the subsections for Java or Python. Ask your instructor for the one used during the workshop!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 3. Capture Tags with OpenTelemetry</h1><article class=default><header class=headline></header><h1 id=1-capture-tags---java>1. Capture Tags - Java</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>Let&rsquo;s add some tags to our traces, so we can find out why some customers receive a poor experience from our application.</p><h2 id=identify-useful-tags>Identify Useful Tags</h2><p>We&rsquo;ll start by reviewing the code for the <code>creditCheck</code> function of <code>creditcheckservice</code> (which can be found in the file <code>/home/splunk/workshop/tagging/creditcheckservice-java/src/main/java/com/example/creditcheckservice/CreditCheckController.java</code>):</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/check&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>creditCheck</span><span class=p>(</span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s>&#34;customernum&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>customerNum</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Get Credit Score</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>creditScore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>creditScoreUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>customerNum</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>creditScore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>parseInt</span><span class=p>(</span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=n>creditScoreUrl</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>HttpClientErrorException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Error getting credit score&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>creditScoreCategory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Run Credit Check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>creditCheckUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>customerNum</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&amp;score=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>creditScore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>checkResult</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>checkResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=n>creditCheckUrl</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>HttpClientErrorException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Error running credit check&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>checkResult</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div><p>We can see that this function accepts a <strong>customer number</strong> as an input. This would be helpful to capture as part of a trace. What else would be helpful?</p><p>Well, the <strong>credit score</strong> returned for this customer by the <code>creditprocessorservice</code> may be interesting (we want to ensure we don&rsquo;t capture any PII data though). It would also be helpful to capture the <strong>credit score category</strong>, and the <strong>credit check result</strong>.</p><p>Great, we&rsquo;ve identified four tags to capture from this service that could help with our investigation. But how do we capture these?</p><h2 id=capture-tags>Capture Tags</h2><p>We start by adding OpenTelemetry imports to the top of the <code>CreditCheckController.java</code> file:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.opentelemetry.api.trace.Span</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.opentelemetry.instrumentation.annotations.WithSpan</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.opentelemetry.instrumentation.annotations.SpanAttribute</span><span class=p>;</span></span></span></code></pre></div><p>Next, we use the <code>@WithSpan</code> annotation to produce a span for <code>creditCheck</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/check&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@WithSpan</span><span class=w> </span><span class=c1>// ADDED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>creditCheck</span><span class=p>(</span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s>&#34;customernum&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>customerNum</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span></span></span></code></pre></div><p>We can now get a reference to the current span and add an attribute (aka tag) to it:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>creditScoreUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>customerNum</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>creditScore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>parseInt</span><span class=p>(</span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=n>creditScoreUrl</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>HttpClientErrorException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Error getting credit score&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Span</span><span class=w> </span><span class=n>currentSpan</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Span</span><span class=p>.</span><span class=na>current</span><span class=p>();</span><span class=w> </span><span class=c1>// ADDED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>currentSpan</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;credit.score&#34;</span><span class=p>,</span><span class=w> </span><span class=n>creditScore</span><span class=p>);</span><span class=w> </span><span class=c1>// ADDED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>...</span></span></span></code></pre></div><p>That was pretty easy, right? Let&rsquo;s capture some more, with the final result looking like this:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/check&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@WithSpan</span><span class=p>(</span><span class=n>kind</span><span class=o>=</span><span class=n>SpanKind</span><span class=p>.</span><span class=na>SERVER</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>creditCheck</span><span class=p>(</span><span class=nd>@RequestParam</span><span class=p>(</span><span class=s>&#34;customernum&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                          </span><span class=nd>@SpanAttribute</span><span class=p>(</span><span class=s>&#34;customer.num&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                          </span><span class=n>String</span><span class=w> </span><span class=n>customerNum</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Get Credit Score</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>creditScore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>creditScoreUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>customerNum</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>creditScore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>parseInt</span><span class=p>(</span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=n>creditScoreUrl</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>HttpClientErrorException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Error getting credit score&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Span</span><span class=w> </span><span class=n>currentSpan</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Span</span><span class=p>.</span><span class=na>current</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>currentSpan</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;credit.score&#34;</span><span class=p>,</span><span class=w> </span><span class=n>creditScore</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>creditScoreCategory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>currentSpan</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;credit.score.category&#34;</span><span class=p>,</span><span class=w> </span><span class=n>creditScoreCategory</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Run Credit Check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>creditCheckUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>customerNum</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&amp;score=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>creditScore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>checkResult</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>checkResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>restTemplate</span><span class=p>.</span><span class=na>getForObject</span><span class=p>(</span><span class=n>creditCheckUrl</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>HttpClientErrorException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=s>&#34;Error running credit check&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>currentSpan</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;credit.check.result&#34;</span><span class=p>,</span><span class=w> </span><span class=n>checkResult</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>checkResult</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div><h2 id=redeploy-service>Redeploy Service</h2><p>Once these changes are made, let&rsquo;s run the following script to rebuild the Docker image used for <code>creditcheckservice</code> and redeploy it to our Kubernetes cluster:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./5-redeploy-creditcheckservice.sh java</span></span></code></pre></div><h2 id=confirm-tag-is-captured-successfully>Confirm Tag is Captured Successfully</h2><p>After a few minutes, return to <strong>Splunk Observability Cloud</strong> and load one of the latest traces to confirm that the tags were captured successfully (hint: sort by the timestamp to find the latest traces):</p><p><strong><a href=#R-image-165199c18dfe5ebf260f3d530af7190d class=lightbox-link><img alt="Trace with Attributes" class="lazy lightbox figure-image" loading=lazy src=../../images/trace_with_attributes_java.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-165199c18dfe5ebf260f3d530af7190d><img alt="Trace with Attributes" class="lazy lightbox lightbox-image" loading=lazy src=../../images/trace_with_attributes_java.png></a></strong></p><p>Well done, you&rsquo;ve leveled up your OpenTelemetry game and have added context to traces using tags.</p><p>Next, we&rsquo;re ready to see how you can use these tags with <strong>Splunk Observability Cloud</strong>!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=2-capture-tags---python>2. Capture Tags - Python</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>Let&rsquo;s add some tags to our traces, so we can find out why some customers receive a poor experience from our application.</p><h2 id=identify-useful-tags>Identify Useful Tags</h2><p>We&rsquo;ll start by reviewing the code for the <code>credit_check</code> function of <code>creditcheckservice</code> (which can be found in the <code>/home/splunk/workshop/tagging/creditcheckservice-py/main.py</code> file):</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/check&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get Credit Score</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span> <span class=o>+</span> <span class=n>customerNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScore</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>creditScoreReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreCategory</span> <span class=o>=</span> <span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Run Credit Check</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>customerNum</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;score=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditScore</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>checkResult</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditCheckReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>checkResult</span></span></span></code></pre></div><p>We can see that this function accepts a <strong>customer number</strong> as an input. This would be helpful to capture as part of a trace. What else would be helpful?</p><p>Well, the <strong>credit score</strong> returned for this customer by the <code>creditprocessorservice</code> may be interesting (we want to ensure we don&rsquo;t capture any PII data though). It would also be helpful to capture the <strong>credit score category</strong>, and the <strong>credit check result</strong>.</p><p>Great, we&rsquo;ve identified four tags to capture from this service that could help with our investigation. But how do we capture these?</p><h2 id=capture-tags>Capture Tags</h2><p>We start by adding importing the trace module by adding an import statement to the top of the <code>creditcheckservice-py/main.py</code> file:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>waitress</span> <span class=kn>import</span> <span class=n>serve</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>opentelemetry</span> <span class=kn>import</span> <span class=n>trace</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></div><p>Next, we need to get a reference to the current span so we can add an attribute (aka tag) to it:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;customer.num&#34;</span><span class=p>,</span> <span class=n>customerNum</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl><span class=o>...</span></span></span></code></pre></div><p>That was pretty easy, right? Let&rsquo;s capture some more, with the final result looking like this:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>credit_check</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span> <span class=o>=</span> <span class=n>trace</span><span class=o>.</span><span class=n>get_current_span</span><span class=p>()</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>    <span class=n>customerNum</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;customernum&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;customer.num&#34;</span><span class=p>,</span> <span class=n>customerNum</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get Credit Score</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/getScore?customernum=&#34;</span> <span class=o>+</span> <span class=n>customerNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>creditScore</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>creditScoreReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.score&#34;</span><span class=p>,</span> <span class=n>creditScore</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>creditScoreCategory</span> <span class=o>=</span> <span class=n>getCreditCategoryFromScore</span><span class=p>(</span><span class=n>creditScore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.score.category&#34;</span><span class=p>,</span> <span class=n>creditScoreCategory</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Run Credit Check</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://creditprocessorservice:8899/runCreditCheck?customernum=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>customerNum</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;&amp;score=&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditScore</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>creditCheckReq</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>checkResult</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>creditCheckReq</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_span</span><span class=o>.</span><span class=n>set_attribute</span><span class=p>(</span><span class=s2>&#34;credit.check.result&#34;</span><span class=p>,</span> <span class=n>checkResult</span><span class=p>)</span>  <span class=c1># &lt;--- ADDED BY WORKSHOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>checkResult</span></span></span></code></pre></div><h2 id=redeploy-service>Redeploy Service</h2><p>Once these changes are made, let&rsquo;s run the following script to rebuild the Docker image used for <code>creditcheckservice</code> and redeploy it to our Kubernetes cluster:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./5-redeploy-creditcheckservice.sh</span></span></code></pre></div><h2 id=confirm-tag-is-captured-successfully>Confirm Tag is Captured Successfully</h2><p>After a few minutes, return to <strong>Splunk Observability Cloud</strong> and load one of the latest traces to confirm that the tags were captured successfully (hint: sort by the timestamp to find the latest traces):</p><p><strong><a href=#R-image-cc619efcff9d19616c9fb5b8a5e46cbd class=lightbox-link><img alt="Trace with Attributes" class="lazy lightbox figure-image" loading=lazy src=../../images/trace_with_attributes.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cc619efcff9d19616c9fb5b8a5e46cbd><img alt="Trace with Attributes" class="lazy lightbox lightbox-image" loading=lazy src=../../images/trace_with_attributes.png></a></strong></p><p>Well done, you&rsquo;ve leveled up your OpenTelemetry game and have added context to traces using tags.</p><p>Next, we&rsquo;re ready to see how you can use these tags with <strong>Splunk Observability Cloud</strong>!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=explore-trace-data>Explore Trace Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>Now that we&rsquo;ve captured several tags from our application, let&rsquo;s explore some of the trace data we&rsquo;ve captured that include this additional context, and see if we can identify what&rsquo;s causing a poor user experience in some cases.</p><h2 id=use-trace-analyzer>Use Trace Analyzer</h2><p>Navigate to <strong>APM</strong>, then select <strong>Traces</strong>. This takes us to the <strong>Trace Analyzer</strong>, where we can add filters to search for traces of interest. For example, we can filter on traces where the credit score starts with <code>7</code>:</p><p><a href=#R-image-e9291ba17da5a881e40db40abb3f7ae7 class=lightbox-link><img alt="Credit Check Starts with Seven" class="lazy lightbox figure-image" loading=lazy src=../images/credit_score_starts_with_seven.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e9291ba17da5a881e40db40abb3f7ae7><img alt="Credit Check Starts with Seven" class="lazy lightbox lightbox-image" loading=lazy src=../images/credit_score_starts_with_seven.png></a></p><p>If you load one of these traces, you&rsquo;ll see that the credit score indeed starts with seven.</p><p>We can apply similar filters for the customer number, credit score category, and credit score result.</p><h2 id=explore-traces-with-errors>Explore Traces With Errors</h2><p>Let&rsquo;s remove the credit score filter and toggle <strong>Errors only</strong> to on, which results in a list of only those traces where an error occurred:</p><p><a href=#R-image-b0ee15a9d5824c1c637c2ef75b3233c6 class=lightbox-link><img alt="Traces with Errors Only" class="lazy lightbox figure-image" loading=lazy src=../images/traces_errors_only.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b0ee15a9d5824c1c637c2ef75b3233c6><img alt="Traces with Errors Only" class="lazy lightbox lightbox-image" loading=lazy src=../images/traces_errors_only.png></a></p><p>Click on a few of these traces, and look at the tags we captured. Do you notice any patterns?</p><p>Next, toggle <strong>Errors only</strong> to off, and sort traces by duration. Look at a few of the slowest running traces, and compare them to the fastest running traces. Do you notice any patterns?</p><p>If you found a pattern that explains the slow performance and errors - great job! But keep in mind that this is a difficult way to troubleshoot, as it requires you to look through many traces and mentally keep track of what you saw, so you can identify a pattern.</p><p>Thankfully, <strong>Splunk Observability Cloud</strong> provides a more efficient way to do this, which we&rsquo;ll explore next.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=index-tags>Index Tags</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=index-tags>Index Tags</h2><p>To use advanced features in <strong>Splunk Observability Cloud</strong> such as <strong>Tag Spotlight</strong>, we&rsquo;ll need to first index one or more tags.</p><p>To do this, navigate to <strong>Settings</strong> -> <strong>APM MetricSets</strong>. Then click the <strong>+ New MetricSet</strong> button.</p><p>Let&rsquo;s index the <code>credit.score.category</code> tag by entering the following details (<strong>note</strong>: since everyone in the workshop is using the same organization, the instructor will do this step on your behalf):</p><p><a href=#R-image-5852f83d008179bcdc3fca76be290b04 class=lightbox-link><img alt="Create Troubleshooting MetricSet" class="lazy lightbox figure-image" loading=lazy src=../images/create_troubleshooting_metric_set.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5852f83d008179bcdc3fca76be290b04><img alt="Create Troubleshooting MetricSet" class="lazy lightbox lightbox-image" loading=lazy src=../images/create_troubleshooting_metric_set.png></a></p><p>Click <strong>Start Analysis</strong> to proceed.</p><p>The tag will appear in the list of <strong>Pending MetricSets</strong> while analysis is performed.</p><p><a href=#R-image-14f286edff667b5203a1ab1690ebec6b class=lightbox-link><img alt="Pending MetricSets" class="lazy lightbox figure-image" loading=lazy src=../images/pending_metric_set.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-14f286edff667b5203a1ab1690ebec6b><img alt="Pending MetricSets" class="lazy lightbox lightbox-image" loading=lazy src=../images/pending_metric_set.png></a></p><p>Once analysis is complete, click on the checkmark in the <strong>Actions</strong> column.</p><p><a href=#R-image-2e434b908fcb5263137a898f8c28a0b7 class=lightbox-link><img alt="MetricSet Configuraiton Applied" class="lazy lightbox figure-image" loading=lazy src=../images/metricset_config_applied.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2e434b908fcb5263137a898f8c28a0b7><img alt="MetricSet Configuraiton Applied" class="lazy lightbox lightbox-image" loading=lazy src=../images/metricset_config_applied.png></a></p><h2 id=how-to-choose-tags-for-indexing>How to choose tags for indexing</h2><p>Why did we choose to index the <code>credit.score.category</code> tag and not the others?</p><p>To understand this, let&rsquo;s review the primary use cases for tags:</p><ul><li>Filtering</li><li>Grouping</li></ul><h3 id=filtering>Filtering</h3><p>With the filtering use case, we can use the <strong>Trace Analyzer</strong> capability of <strong>Splunk Observability Cloud</strong> to filter on traces that match a particular tag value.</p><p>We saw an example of this earlier, when we filtered on traces where the credit score started with <code>7</code>.</p><p>Or if a customer calls in to complain about slow service, we could use <strong>Trace Analyzer</strong> to locate all traces with that particular customer number.</p><p>Tags used for filtering use cases are generally high-cardinality, meaning that there could be thousands or even hundreds of thousands of unique values. In fact, <strong>Splunk Observability Cloud</strong> can handle an effectively infinite number of unique tag values! Filtering using these tags allows us to rapidly locate the traces of interest.</p><p>Note that we aren&rsquo;t required to index tags to use them for filtering with <strong>Trace Analyzer</strong>.</p><h3 id=grouping>Grouping</h3><p>With the grouping use case, we can use <strong>Trace Analyzer</strong> to group traces by a particular tag.</p><p>But we can also go beyond this and surface trends for tags that we collect using the powerful <strong>Tag Spotlight</strong> feature in <strong>Splunk Observability Cloud</strong>, which we’ll see in action shortly.</p><p>Tags used for grouping use cases should be low to medium-cardinality, with hundreds of unique values.</p><p>For custom tags to be used with <strong>Tag Spotlight</strong>, they first need to be indexed.</p><p>We decided to index the <code>credit.score.category</code> tag because it has a few distinct values that would be useful for grouping. In contrast, the customer number and credit score tags have hundreds or thousands of unique values, and are more valuable for filtering use cases rather than grouping.</p><h2 id=troubleshooting-vs-monitoring-metricsets>Troubleshooting vs. Monitoring MetricSets</h2><p>You may have noticed that, to index this tag, we created something called a <strong>Troubleshooting MetricSet</strong>. It&rsquo;s named this way because a Troubleshooting MetricSet, or TMS, allows us to troubleshoot issues with this tag using features such as <strong>Tag Spotlight</strong>.</p><p>You may have also noticed that there&rsquo;s another option which we didn&rsquo;t choose called a <strong>Monitoring MetricSet</strong> (or MMS). Monitoring MetricSets go beyond troubleshooting and allow us to use tags for alerting and dashboards. We&rsquo;ll explore this concept later in the workshop.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=use-tags-for-troubleshooting>Use Tags for Troubleshooting</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=using-tag-spotlight>Using Tag Spotlight</h2><p>Now that we&rsquo;ve indexed the <code>credit.score.category</code> tag, we can use it with <strong>Tag Spotlight</strong> to troubleshoot our application.</p><p>Navigate to <strong>APM</strong> then click on <strong>Tag Spotlight</strong> on the right-hand side. Ensure the <code>creditcheckservice</code> service is selected from the <strong>Service</strong> drop-down (if not already selected).</p><p>With <strong>Tag Spotlight</strong>, we can see 100% of credit score requests that result in a score of <code>impossible</code> have an error, yet requests for all other credit score types have no errors at all!</p><p><strong><a href=#R-image-9b4821ea1b4b69a3a2ed448a44b00f82 class=lightbox-link><img alt="Tag Spotlight with Errors" class="lazy lightbox figure-image" loading=lazy src=../images/tag_spotlight_errors.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9b4821ea1b4b69a3a2ed448a44b00f82><img alt="Tag Spotlight with Errors" class="lazy lightbox lightbox-image" loading=lazy src=../images/tag_spotlight_errors.png></a></strong></p><p>This illustrates the power of <strong>Tag Spotlight</strong>! Finding this pattern would be time-consuming without it, as we&rsquo;d have to manually look through hundreds of traces to identify the pattern (and even then, there&rsquo;s no guarantee we&rsquo;d find it).</p><p>We&rsquo;ve looked at errors, but what about latency? Let&rsquo;s click on <strong>Latency</strong> near the top of the screen to find out.</p><p>Here, we can see that the requests with a <code>poor</code> credit score request are running slowly, with P50, P90, and P99 times of around 3 seconds, which is too long for our users to wait, and much slower than other requests.</p><p>We can also see that some requests with an <code>exceptional</code> credit score request are running slowly, with P99 times of around 5 seconds, though the P50 response time is relatively quick.</p><p><strong><a href=#R-image-e535eee93e1dce363e489f3802c2c236 class=lightbox-link><img alt="Tag Spotlight with Latency" class="lazy lightbox figure-image" loading=lazy src=../images/tag_spotlight_latency.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e535eee93e1dce363e489f3802c2c236><img alt="Tag Spotlight with Latency" class="lazy lightbox lightbox-image" loading=lazy src=../images/tag_spotlight_latency.png></a></strong></p><h2 id=using-dynamic-service-maps>Using Dynamic Service Maps</h2><p>Now that we know the credit score category associated with the request can impact performance and error rates, let&rsquo;s explore another feature that utilizes indexed tags: <strong>Dynamic Service Maps</strong>.</p><p>With Dynamic Service Maps, we can breakdown a particular service by a tag. For example, let&rsquo;s click on <strong>APM</strong>, then click <strong>Explore</strong> to view the service map.</p><p>Click on <code>creditcheckservice</code>. Then, on the right-hand menu, click on the drop-down that says <strong>Breakdown</strong>, and select the <code>credit.score.category</code> tag.</p><p>At this point, the service map is updated dynamically, and we can see the performance of requests hitting <code>creditcheckservice</code> broken down by the credit score category:</p><p><strong><a href=#R-image-f65fb851201bc3cc86e553694d7e8c60 class=lightbox-link><img alt="Service Map Breakdown" class="lazy lightbox figure-image" loading=lazy src=../images/service_map_breakdown.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f65fb851201bc3cc86e553694d7e8c60><img alt="Service Map Breakdown" class="lazy lightbox lightbox-image" loading=lazy src=../images/service_map_breakdown.png></a></strong></p><p>This view makes it clear that performance for <code>good</code> and <code>fair</code> credit scores is excellent, while <code>poor</code> and <code>exceptional</code> scores are much slower, and <code>impossible</code> scores result in errors.</p><h2 id=summary>Summary</h2><p><strong>Tag Spotlight</strong> has uncovered several interesting patterns for the engineers that own this service to explore further:</p><ul><li>Why are all the <code>impossible</code> credit score requests resulting in error?</li><li>Why are all the <code>poor</code> credit score requests running slowly?</li><li>Why do some of the <code>exceptional</code> requests run slowly?</li></ul><p>As an SRE, passing this context to the engineering team would be extremely helpful for their investigation, as it would allow them to track down the issue much more quickly than if we simply told them that the service was &ldquo;sometimes slow&rdquo;.</p><p>If you&rsquo;re curious, have a look at the source code for the <code>creditprocessorservice</code>. You&rsquo;ll see that requests with impossible, poor, and exceptional credit scores are handled differently, thus resulting in the differences in error rates and latency that we uncovered.</p><p>The behavior we saw with our application is typical for modern cloud-native applications, where different inputs passed to a service lead to different code paths, some of which result in slower performance or errors. For example, in a real credit check service, requests resulting in low credit scores may be sent to another downstream service to further evaluate risk, and may perform more slowly than requests resulting in higher scores, or encounter higher error rates.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=use-tags-for-monitoring>Use Tags for Monitoring</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>Earlier, we created a <strong>Troubleshooting Metric Set</strong> on the <code>credit.score.category</code> tag, which allowed us to use <strong>Tag Spotlight</strong> with that tag and identify a pattern to explain why some users received a poor experience.</p><p>In this section of the workshop, we&rsquo;ll explore a related concept: <strong>Monitoring MetricSets</strong>.</p><h2 id=what-are-monitoring-metricsets>What are Monitoring MetricSets?</h2><p><strong>Monitoring MetricSets</strong> go beyond troubleshooting and allow us to use tags for alerting, dashboards and SLOs.</p><h2 id=create-a-monitoring-metricset>Create a Monitoring MetricSet</h2><p>(<strong>note</strong>: <em>your workshop instructor will do the following for you, but observe the steps</em>)</p><p>Let&rsquo;s navigate to <strong>Settings</strong> -> <strong>APM MetricSets</strong>, and click the edit button (i.e. the little pencil) beside the MetricSet for <code>credit.score.category</code>.</p><p><a href=#R-image-95695214b3642c28f468e5f87a14566b class=lightbox-link><img alt="edit APM MetricSet" class="lazy lightbox figure-image" loading=lazy src=../images/edit_apm_metricset.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-95695214b3642c28f468e5f87a14566b><img alt="edit APM MetricSet" class="lazy lightbox lightbox-image" loading=lazy src=../images/edit_apm_metricset.png></a></p><p>Check the box beside <strong>Also create Monitoring MetricSet</strong> then click <strong>Start Analysis</strong></p><p><a href=#R-image-ebce400847202a49445e9b51dd018525 class=lightbox-link><img alt="Monitoring MetricSet" class="lazy lightbox figure-image" loading=lazy src=../images/monitoring_metricset.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ebce400847202a49445e9b51dd018525><img alt="Monitoring MetricSet" class="lazy lightbox lightbox-image" loading=lazy src=../images/monitoring_metricset.png></a></p><p>The <code>credit.score.category</code> tag appears again as a <strong>Pending MetricSet</strong>. After a few moments, a checkmark should appear. Click this checkmark to enable the <strong>Pending MetricSet</strong>.</p><p><a href=#R-image-1688832edc21feadc22b8b814fd7d656 class=lightbox-link><img alt="pending APM MetricSet" class="lazy lightbox figure-image" loading=lazy src=../images/update_pending_apm_metricset.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1688832edc21feadc22b8b814fd7d656><img alt="pending APM MetricSet" class="lazy lightbox lightbox-image" loading=lazy src=../images/update_pending_apm_metricset.png></a></p><h2 id=using-monitoring-metricsets>Using Monitoring MetricSets</h2><p>This mechanism creates a new dimension from the tag on a bunch of metrics that can be used to filter these metrics based on the values of that new dimension. <strong>Important</strong>: To differentiate between the original and the copy, the dots in the tag name are replaced by underscores for the new dimension. With that the metrics become a dimension named <code>credit_score_category</code> and not <code>credit.score.category</code>.</p><p>Next, let&rsquo;s explore how we can use this <strong>Monitoring MetricSet</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 7. Use Tags for Monitoring</h1><article class=default><header class=headline></header><h1 id=use-tags-with-dashboards>Use Tags with Dashboards</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h3 id=dashboards>Dashboards</h3><p>Navigate to <strong>Metric Finder</strong>, then type in the name of the tag, which is <code>credit_score_category</code> (remember that the dots in the tag name were replaced by underscores when the Monitoring MetricSet was created). You&rsquo;ll see that multiple metrics include this tag as a dimension:</p><p><a href=#R-image-386e3505d047600e0427ed15e9a66c34 class=lightbox-link><img alt="Metric Finder" class="lazy lightbox figure-image" loading=lazy src=../../images/metric_finder.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-386e3505d047600e0427ed15e9a66c34><img alt="Metric Finder" class="lazy lightbox lightbox-image" loading=lazy src=../../images/metric_finder.png></a></p><p>By default, <strong>Splunk Observability Cloud</strong> calculates several metrics using the trace data it receives. See <a href=https://docs.splunk.com/observability/en/apm/span-tags/metricsets.html rel=external target=_blank>Learn about MetricSets in APM</a> for more details.</p><p>By creating an MMS, <code>credit_score_category</code> was added as a dimension to these metrics, which means that this dimension can now be used for alerting and dashboards.</p><p>To see how, let&rsquo;s click on the metric named <code>service.request.duration.ns.p99</code>, which brings up the following chart:</p><p><a href=#R-image-232f9689f35e0ad46902f37f3c533d43 class=lightbox-link><img alt="Service Request Duration" class="lazy lightbox figure-image" loading=lazy src=../../images/service_request_duration_chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-232f9689f35e0ad46902f37f3c533d43><img alt="Service Request Duration" class="lazy lightbox lightbox-image" loading=lazy src=../../images/service_request_duration_chart.png></a></p><p>Add filters for <code>sf_environment</code>, <code>sf_service</code>, and <code>sf_dimensionalized</code>. Then set the <strong>Extrapolation policy</strong> to <code>Last value</code> and the <strong>Display units</strong> to <code>Nanosecond</code>:</p><p><a href=#R-image-013c0c83bd7db65388ea50f8a20c1b11 class=lightbox-link><img alt="Chart with Seconds" class="lazy lightbox figure-image" loading=lazy src=../../images/chart_settings.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-013c0c83bd7db65388ea50f8a20c1b11><img alt="Chart with Seconds" class="lazy lightbox lightbox-image" loading=lazy src=../../images/chart_settings.png></a></p><p>With these settings, the chart allows us to visualize the service request duration by credit score category:</p><p><a href=#R-image-aabcf9179b26a412c3e9f4973d58061d class=lightbox-link><img alt="Duration by Credit Score" class="lazy lightbox figure-image" loading=lazy src=../../images/duration_by_credit_score.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-aabcf9179b26a412c3e9f4973d58061d><img alt="Duration by Credit Score" class="lazy lightbox lightbox-image" loading=lazy src=../../images/duration_by_credit_score.png></a></p><p>Now we can see the duration by credit score category. In my example, the red line represents the <code>exceptional</code> category, and we can see that the duration for these requests sometimes goes all the way up to 5 seconds.</p><p>The orange represents the <code>very good</code> category, and has very fast response times.</p><p>The green line represents the <code>poor</code> category, and has response times between 2-3 seconds.</p><p>It may be useful to save this chart on a dashboard for future reference. To do this, click on the <strong>Save as&mldr;</strong> button and provide a name for the chart:</p><p><a href=#R-image-d0e2735fd225bb2b077e383a19067b79 class=lightbox-link><img alt="Save Chart As" class="lazy lightbox figure-image" loading=lazy src=../../images/save_chart_as.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d0e2735fd225bb2b077e383a19067b79><img alt="Save Chart As" class="lazy lightbox lightbox-image" loading=lazy src=../../images/save_chart_as.png></a></p><p>When asked which dashboard to save the chart to, let&rsquo;s create a <strong>new</strong> one named <code>Credit Check Service - Your Name</code> (substituting your actual name):</p><p><a href=#R-image-d63182ca0acab92398e6f95cb772c6d7 class=lightbox-link><img alt="Save Chart As" class="lazy lightbox figure-image" loading=lazy src=../../images/create_dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d63182ca0acab92398e6f95cb772c6d7><img alt="Save Chart As" class="lazy lightbox lightbox-image" loading=lazy src=../../images/create_dashboard.png></a></p><p>Now we can see the chart on our dashboard, and can add more charts as needed to monitor our credit check service:</p><p><a href=#R-image-cbd8c8c31046576cff11839905f06fbb class=lightbox-link><img alt="Credit Check Service Dashboard" class="lazy lightbox figure-image" loading=lazy src=../../images/credit_check_service_dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cbd8c8c31046576cff11839905f06fbb><img alt="Credit Check Service Dashboard" class="lazy lightbox lightbox-image" loading=lazy src=../../images/credit_check_service_dashboard.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=use-tags-with-alerting>Use Tags with Alerting</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>3 minutes</span>
</span>&nbsp;<h3 id=alerts>Alerts</h3><p>It&rsquo;s great that we have a dashboard to monitor the response times of the credit check service by credit score, but we don&rsquo;t want to stare at a dashboard all day.</p><p>Let&rsquo;s create an alert so we can be notified proactively if customers with <code>exceptional</code> credit scores encounter slow requests.</p><p>To create this alert, click on the little bell on the top right-hand corner of the chart, then select <strong>New detector from chart</strong>:</p><p><a href=#R-image-5900939cb3243d426fb7adabe6aefea6 class=lightbox-link><img alt="New Detector From Chart" class="lazy lightbox figure-image" loading=lazy src=../../images/new_detector_from_chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5900939cb3243d426fb7adabe6aefea6><img alt="New Detector From Chart" class="lazy lightbox lightbox-image" loading=lazy src=../../images/new_detector_from_chart.png></a></p><p>Let&rsquo;s call the detector <code>Latency by Credit Score Category</code>. Set the environment to your environment name (i.e. <code>tagging-workshop-yourname</code>) then select <code>creditcheckservice</code> as the service. Since we only want to look at performance for customers with <code>exceptional</code> credit scores, add a filter using the <code>credit_score_category</code> dimension and select <code>exceptional</code>:</p><p><a href=#R-image-e540ef159f48775d816bda91b17d666c class=lightbox-link><img alt="Create New Detector" class="lazy lightbox figure-image" loading=lazy src=../../images/create_new_detector.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e540ef159f48775d816bda91b17d666c><img alt="Create New Detector" class="lazy lightbox lightbox-image" loading=lazy src=../../images/create_new_detector.png></a></p><p>As an alert condition instead of &ldquo;<strong>Static threshold</strong>&rdquo; we want to select &ldquo;<strong>Sudden Change</strong>&rdquo; to make the example more vivid.</p><p><a href=#R-image-f3ab386efdb413b0fa415b7469288c07 class=lightbox-link><img alt="Alert Condition: Sudden Change" class="lazy lightbox figure-image" loading=lazy src=../../images/alert_condition_suddenchange.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f3ab386efdb413b0fa415b7469288c07><img alt="Alert Condition: Sudden Change" class="lazy lightbox lightbox-image" loading=lazy src=../../images/alert_condition_suddenchange.png></a></p><p>We can then set the remainder of the alert details as we normally would. The key thing to remember here is that without capturing a tag with the credit score category and indexing it, we wouldn&rsquo;t be able to alert at this granular level, but would instead be forced to bucket all customers together, regardless of their importance to the business.</p><p>Unless you want to get notified, we do not need to finish this wizard. You can just close the wizard by clicking the <strong>X</strong> on the top right corner of the wizard pop-up.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=use-tags-with-service-level-objectives>Use Tags with Service Level Objectives</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>We can now use the created Monitoring MetricSet together with Service Level Objectives a similar way we used them with dashboards and detectors/alerts before. For that we want to be clear about some key concepts:</p><h2 id=key-concepts-of-service-level-monitoring>Key Concepts of Service Level Monitoring</h2><p>(<a href=/observability-workshop/v6.7/en/scenarios/debug-problems/tagging/7-alerting-dashboards-slos/3-slos/index.html#creating-a-new-service-level-objective>skip</a> if you know this)</p><table><thead><tr><th>Concept</th><th>Definition</th><th>Examples</th></tr></thead><tbody><tr><td>Service level indicator (SLI)</td><td>An SLI is a quantitative measurement showing some health of a service, expressed as a metric or combination of metrics.</td><td><em>Availability SLI</em>: Proportion of requests that resulted in a successful response<br><em>Performance SLI</em>: Proportion of requests that loaded in &lt; 100 ms</td></tr><tr><td>Service level objective (SLO)</td><td>An SLO defines a target for an SLI and a compliance period over which that target must be met. An SLO contains 3 elements: an SLI, a target, and a compliance period. Compliance periods can be calendar, such as monthly, or rolling, such as past 30 days.</td><td><em>Availability SLI over a calendar period</em>: Our service must respond successfully to 95% of requests in a month<br><em>Performance SLI over a rolling period</em>: Our service must respond to 99% of requests in &lt; 100 ms over a 7-day period</td></tr><tr><td>Service level agreement (SLA)</td><td>An SLA is a contractual agreement that indicates service levels your users can expect from your organization. If an SLA is not met, there can be financial consequences.</td><td>A customer service SLA indicates that 90% of support requests received on a normal support day must have a response within 6 hours.</td></tr><tr><td>Error budget</td><td>A measurement of how your SLI performs relative to your SLO over a period of time. Error budget measures the difference between actual and desired performance. It determines how unreliable your service might be during this period and serves as a signal when you need to take corrective action.</td><td>Our service can respond to 1% of requests in >100 ms over a 7 day period.</td></tr><tr><td>Burn rate</td><td>A unitless measurement of how quickly a service consumes the error budget during the compliance window of the SLO. Burn rate makes the SLO and error budget actionable, showing service owners when a current incident is serious enough to page an on-call responder.</td><td>For an SLO with a 30-day compliance window, a constant burn rate of 1 means your error budget is used up in exactly 30 days.</td></tr></tbody></table><h2 id=creating-a-new-service-level-objective>Creating a new Service Level Objective</h2><p>There is an easy to follow wizard to create a new Service Level Objective (SLO). In the left navigation just follow the link &ldquo;<strong>Detectors & SLOs</strong>&rdquo;. From there select the third tab &ldquo;<strong>SLOs</strong>&rdquo; and click the blue button to the right that says &ldquo;<strong>Create SLO</strong>&rdquo;.</p><p><a href=#R-image-219facc454be2f6502c8a4cae8ebeeac class=lightbox-link><img alt="Create new SLO" class="lazy lightbox figure-image" loading=lazy src=../../images/slo_0_create.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-219facc454be2f6502c8a4cae8ebeeac><img alt="Create new SLO" class="lazy lightbox lightbox-image" loading=lazy src=../../images/slo_0_create.png></a></p><p>The wizard guides you through some easy steps. And if everything during the previous steps worked out, you will have no problems here. ;)</p><p>In our case we want to use <code>Service & endpoint</code> as our <strong>Metric type</strong> instead of <code>Custom metric</code>. We filter the <strong>Environment</strong> down to the environment that we are using during this workshop (i.e. <code>tagging-workshop-yourname</code>) and select the <code>creditcheckservice</code> from the <strong>Service and endpoint</strong> list. Our <strong>Indicator type</strong> for this workshop will be <code>Request latency</code> and not <code>Request success</code>.</p><p>Now we can select our <strong>Filters</strong>. Since we are using the <code>Request latency</code> as the <strong>Indicator type</strong> and that is a metric of the APM Service, we can filter on <code>credit.score.category</code>. Feel free to try out what happens, when you set the <strong>Indicator type</strong> to <code>Request success</code>.</p><p>Today we are only interested in our <code>exceptional</code> credit scores. So please select that as the filter.</p><p><a href=#R-image-c72d999c1dd952ab325a440f47068992 class=lightbox-link><img alt="Choose Service or Metric for SLO" class="lazy lightbox figure-image" loading=lazy src=../../images/slo_1_choose.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c72d999c1dd952ab325a440f47068992><img alt="Choose Service or Metric for SLO" class="lazy lightbox lightbox-image" loading=lazy src=../../images/slo_1_choose.png></a></p><p>In the next step we define the objective we want to reach. For the <code>Request latency</code> type, we define the <strong>Target (%)</strong>, the <strong>Latency (ms)</strong> and the <strong>Compliance Window</strong>. Please set these to <code>99</code>, <code>100</code> and <code>Last 7 days</code>. This will give us a good idea what we are achieving already.</p><p>Here we will already be in shock or play around with the numbers to make it not so scary. Feel free to play around with the numbers to see how well we achieve the objective and how much we have left to burn.</p><p><a href=#R-image-25b31d4e8a940069cdf484a0e5c40878 class=lightbox-link><img alt="Define Objective for SLO" class="lazy lightbox figure-image" loading=lazy src=../../images/slo_2_define_objective.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-25b31d4e8a940069cdf484a0e5c40878><img alt="Define Objective for SLO" class="lazy lightbox lightbox-image" loading=lazy src=../../images/slo_2_define_objective.png></a></p><p>The third step gives us the chance to alert (aka annoy) people who should be aware about these SLOs to initiate countermeasures. These &ldquo;people&rdquo; can also be mechanism like ITSM systems or webhooks to initiate automatic remediation steps.</p><p>Activate all categories you want to alert on and add recipients to the different alerts.</p><p><a href=#R-image-fb4bfda0b08fffaa58a39dbbf8d4ce50 class=lightbox-link><img alt="Define Alerting for SLO" class="lazy lightbox figure-image" loading=lazy src=../../images/slo_3_define_alerting.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fb4bfda0b08fffaa58a39dbbf8d4ce50><img alt="Define Alerting for SLO" class="lazy lightbox lightbox-image" loading=lazy src=../../images/slo_3_define_alerting.png></a></p><p>The next step is only the naming for this SLO. Have your own naming convention ready for this. In our case we would just name it <code>creditchceckservice:score:exceptional:YOURNAME</code> and click the <strong>Create</strong>-button <strong>BUT</strong> you can also <strong>just cancel the wizard</strong> by clicking anything in the left navigation and confirming to <strong>Discard changes</strong>.</p><p><a href=#R-image-6f3041c7e5dfb6defccdd3cf0aaf87fa class=lightbox-link><img alt="Name and Save the SLO" class="lazy lightbox figure-image" loading=lazy src=../../images/slo_4_name_and_save.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6f3041c7e5dfb6defccdd3cf0aaf87fa><img alt="Name and Save the SLO" class="lazy lightbox lightbox-image" loading=lazy src=../../images/slo_4_name_and_save.png></a></p><p>And with that we have (<em>nearly</em>) successfully created an SLO including the alerting in case we might miss or goals.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=summary>Summary</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;<p>In this workshop, we learned the following:</p><ul><li>What are tags and why are they such a critical part of making an application observable?</li><li>How to use <a href=https://opentelemetry.io rel=external target=_blank><strong>OpenTelemetry</strong></a> to capture tags of interest from your application.</li><li>How to index tags in <strong>Splunk Observability Cloud</strong> and the differences between <strong>Troubleshooting MetricSets</strong> and <strong>Monitoring MetricSets</strong>.</li><li>How to utilize tags in <strong>Splunk Observability Cloud</strong> to find “unknown unknowns” using the <strong>Tag Spotlight</strong> and <strong>Dynamic Service Map</strong> features.</li><li>How to utilize tags for dashboards, alerting and service level objectives.</li></ul><p>Collecting tags aligned with the best practices shared in this workshop will let you get even more value from the data you’re sending to <strong>Splunk Observability Cloud</strong>. Now that you’ve completed this workshop, you have the knowledge you need to start collecting tags from your own applications!</p><p>To get started with capturing tags today, check out <a href=https://docs.splunk.com/observability/en/apm/span-tags/add-context-trace-span.html#instrument-your-application-code-to-add-tags-to-spans rel=external target=_blank>how to add tags in various supported languages</a>, and then <a href=https://docs.splunk.com/observability/en/apm/span-tags/index-span-tags.html#apm-index-span-tags rel=external target=_blank>how to use them to create Troubleshooting MetricSets</a> so they can be analyzed in Tag Spotlight. For more help, feel free to <a href=https://www.splunk.com/en_us/about-splunk/contact-us.html rel=external target=_blank>ask a Splunk Expert</a>.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip for Workshop Facilitator(s)</summary><div class=box-content><p>Once the workshop is complete, remember to delete the APM MetricSet you created earlier for the <code>credit.score.category</code> tag.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=profiling-workshop>Profiling Workshop</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Derek Mitchell</span></span><p><strong>Service Maps</strong> and <strong>Traces</strong> are extremely valuable in determining what service an issue resides in. And related log data helps provide detail on why issues are occurring in that service.</p><p>But engineers sometimes need to go even deeper to debug a problem that’s occurring in one of their services.</p><p>This is where features such as Splunk&rsquo;s <strong>AlwaysOn Profiling</strong> and <strong>Database Query Performance</strong> come in.</p><p><strong>AlwaysOn Profiling</strong> continuously collects stack traces so that you can discover which lines in your code are consuming the most CPU and memory.</p><p>And <strong>Database Query Performance</strong> can quickly identify long-running, unoptimized, or heavy queries and mitigate issues they might be causing.</p><p>In this workshop, we&rsquo;ll explore:</p><ul><li>How to debug an application with several performance issues.</li><li>How to use <strong>Database Query Performance</strong> to find slow-running queries that impact application performance.</li><li>How to enable <strong>AlwaysOn Profiling</strong> and use it to find the code that consumes the most CPU and memory.</li><li>How to apply fixes based on findings from <strong>Splunk Observability Cloud</strong> and verify the result.</li></ul><p>The workshop uses a Java-based application called <code>The Door Game</code> hosted in Kubernetes. Let&rsquo;s get started!</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>The easiest way to navigate through this workshop is by using:</p><ul><li>the left/right arrows (<strong>&lt;</strong> | <strong>></strong>) on the top right of this page</li><li>the left (◀️) and right (▶️) cursor keys on your keyboard</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of Profiling Workshop</h1><article class=default><header class=headline></header><h1 id=build-the-sample-application>Build the Sample Application</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=introduction>Introduction</h2><p>For this workshop, we&rsquo;ll be using a Java-based application called <code>The Door Game</code>. It will be hosted in Kubernetes.</p><h2 id=pre-requisites>Pre-requisites</h2><p>You will start with an EC2 instance and perform some <a href=/observability-workshop/v6.7/en/scenarios/debug-problems/profiling/1-build-application/index.html#initial-steps>initial steps</a> in order to get to the following state:</p><ul><li>Deploy the <strong>Splunk distribution of the OpenTelemetry Collector</strong></li><li>Deploy the MySQL database container and populate data</li><li>Build and deploy the <code>doorgame</code> application container</li></ul><h2 id=initial-steps>Initial Steps</h2><p>The initial setup can be completed by executing the following steps on the command line of your EC2 instance.</p><p>You&rsquo;ll be asked to enter a name for your environment. Please use <code>profiling-workshop-yourname</code> (where <code>yourname</code> is replaced by your actual name).</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> workshop/profiling
</span></span><span class=line><span class=cl>./1-deploy-otel-collector.sh
</span></span><span class=line><span class=cl>./2-deploy-mysql.sh
</span></span><span class=line><span class=cl>./3-deploy-doorgame.sh</span></span></code></pre></div><h2 id=lets-play-the-door-game>Let&rsquo;s Play The Door Game</h2><p>Now that the application is deployed, let&rsquo;s play with it and generate some observability data.</p><p>Get the external IP address for your application instance using the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe svc doorgame <span class=p>|</span> grep <span class=s2>&#34;LoadBalancer Ingress&#34;</span></span></span></code></pre></div><p>The output should look like the following:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>LoadBalancer Ingress:     52.23.184.60</span></span></code></pre></div><p>You should be able to access The Door Game application by pointing your browser to port 81 of the provided IP address. For example:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>http://52.23.184.60:81</span></span></code></pre></div><p>You should be met with The Door Game intro screen:</p><p><a href=#R-image-3609d12408b3c2ef75ebecc748623b15 class=lightbox-link><img alt="Door Game Welcome Screen" class="lazy lightbox figure-image" loading=lazy src=../images/door_game_initial_screen.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3609d12408b3c2ef75ebecc748623b15><img alt="Door Game Welcome Screen" class="lazy lightbox lightbox-image" loading=lazy src=../images/door_game_initial_screen.png></a></p><p>Click <code>Let's Play</code> to start the game:</p><p><a href=#R-image-94449a5116d779fe01eeee3832d1bc5d class=lightbox-link><img alt="Let&rsquo;s Play" class="lazy lightbox figure-image" loading=lazy src=../images/lets_play.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-94449a5116d779fe01eeee3832d1bc5d><img alt="Let&rsquo;s Play" class="lazy lightbox lightbox-image" loading=lazy src=../images/lets_play.png></a></p><p>Did you notice that it took a long time after clicking <code>Let's Play</code> before we could actually start playing the game?</p><p>Let&rsquo;s use <strong>Splunk Observability Cloud</strong> to determine why the application startup is so slow.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=troubleshoot-game-startup>Troubleshoot Game Startup</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Let&rsquo;s use <strong>Splunk Observability Cloud</strong> to determine why the game started so slowly.</p><h2 id=view-your-application-in-splunk-observability-cloud>View your application in Splunk Observability Cloud</h2><p>Note: when the application is deployed for the first time, it may take a few minutes for the data to appear.</p><p>Navigate to APM, then use the Environment dropdown to select your environment (i.e. <code>profiling-workshop-name</code>).</p><p>If everything was deployed correctly, you should see <code>doorgame</code> displayed in the list of services:</p><p><a href=#R-image-8a83b6eff7239bf17e809e05093a7b5b class=lightbox-link><img alt="APM Overview" class="lazy lightbox figure-image" loading=lazy src=../images/apm_overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8a83b6eff7239bf17e809e05093a7b5b><img alt="APM Overview" class="lazy lightbox lightbox-image" loading=lazy src=../images/apm_overview.png></a></p><p>Click on <strong>Explore</strong> on the right-hand side to view the service map. We should the <code>doorgame</code> application on the service map:</p><p><a href=#R-image-aa6d75358ff96aa3e5309796e267d390 class=lightbox-link><img alt="Service Map" class="lazy lightbox figure-image" loading=lazy src=../images/service_map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-aa6d75358ff96aa3e5309796e267d390><img alt="Service Map" class="lazy lightbox lightbox-image" loading=lazy src=../images/service_map.png></a></p><p>Notice how the majority of the time is being spent in the MySQL database. We can get more details by clicking on <strong>Database Query Performance</strong> on the right-hand side.</p><p><a href=#R-image-4b001784cde1d72003f49b90b8b37498 class=lightbox-link><img alt="Database Query Performance" class="lazy lightbox figure-image" loading=lazy src=../images/db_query_performance.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4b001784cde1d72003f49b90b8b37498><img alt="Database Query Performance" class="lazy lightbox lightbox-image" loading=lazy src=../images/db_query_performance.png></a></p><p>This view shows the SQL queries that took the most amount of time. Ensure that the <strong>Compare to</strong> dropdown is set to <code>None</code>, so we can focus on current performance.</p><p>We can see that one query in particular is taking a long time:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>select * from doorgamedb.users, doorgamedb.organizations</code></pre></div><p>(do you notice anything unusual about this query?)</p><p>Let&rsquo;s troubleshoot further by clicking on one of the spikes in the latency graph. This brings up a list of example traces that include this slow query:</p><p><a href=#R-image-72ba67b179a2cbb9599c70d22778602b class=lightbox-link><img alt="Traces with Slow Query" class="lazy lightbox figure-image" loading=lazy src=../images/traces_with_slow_query.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-72ba67b179a2cbb9599c70d22778602b><img alt="Traces with Slow Query" class="lazy lightbox lightbox-image" loading=lazy src=../images/traces_with_slow_query.png></a></p><p>Click on one of the traces to see the details:</p><p><a href=#R-image-404213c0a2360560ffdb4034c97961d8 class=lightbox-link><img alt="Trace with Slow Query" class="lazy lightbox figure-image" loading=lazy src=../images/trace_with_slow_query.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-404213c0a2360560ffdb4034c97961d8><img alt="Trace with Slow Query" class="lazy lightbox lightbox-image" loading=lazy src=../images/trace_with_slow_query.png></a></p><p>In the trace, we can see that the <code>DoorGame.startNew</code> operation took 25.8 seconds, and 17.6 seconds of this was associated with the slow SQL query we found earlier.</p><h2 id=what-did-we-accomplish>What did we accomplish?</h2><p>To recap what we&rsquo;ve done so far:</p><ul><li>We&rsquo;ve deployed our application and are able to access it successfully.</li><li>The application is sending traces to <strong>Splunk Observability Cloud</strong> successfully.</li><li>We started troubleshooting the slow application startup time, and found a slow SQL query that seems to be the root cause.</li></ul><p>To troubleshoot further, it would be helpful to get deeper diagnostic data that tells us what&rsquo;s happening inside our JVM, from both a memory (i.e. JVM heap) and CPU perspective. We&rsquo;ll tackle that in the next section of the workshop.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=enable-alwayson-profiling>Enable AlwaysOn Profiling</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<p>Let&rsquo;s learn how to enable the memory and CPU profilers, verify their operation,
and use the results in Splunk Observability Cloud to find out why our application startup is slow.</p><h3 id=update-the-application-configuration>Update the application configuration</h3><p>We will need to pass additional configuration arguments to the Splunk OpenTelemetry Java agent in order to
enable both profilers. The configuration is <a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/java/instrumentation/instrument-java-application.html#activate-alwayson-profiling rel=external target=_blank>documented here</a>
in detail, but for now we just need the following settings:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>SPLUNK_PROFILER_ENABLED=&#34;true&#34;
SPLUNK_PROFILER_MEMORY_ENABLED=&#34;true&#34;</code></pre></div><p>Since our application is deployed in Kubernetes, we can update the Kubernetes manifest file to set these environment variables. Open the <code>doorgame/doorgame.yaml</code> file for editing, and ensure the values of the following environment variables are set to &ldquo;true&rdquo;:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPLUNK_PROFILER_ENABLED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPLUNK_PROFILER_MEMORY_ENABLED</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span></span></span></code></pre></div><p>Next, let&rsquo;s redeploy the Door Game application by running the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> workshop/profiling
</span></span><span class=line><span class=cl>kubectl apply -f doorgame/doorgame.yaml</span></span></code></pre></div><p>After a few seconds, a new pod will be deployed with the updated application settings.</p><h3 id=confirm-operation>Confirm operation</h3><p>To ensure the profiler is enabled, let&rsquo;s review the application logs with the following commands:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>doorgame --tail<span class=o>=</span><span class=m>100</span> <span class=p>|</span> grep JfrActivator</span></span></code></pre></div><p>You should see a line in the application log output that shows the profiler is active:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-log data-lang=log>[otel.javaagent 2024-02-05 19:01:12:416 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.```</code></pre></div><p>This confirms that the profiler is enabled and sending data to the OpenTelemetry collector deployed in our Kubernetes cluster, which in turn sends profiling data to Splunk Observability Cloud.</p><h3 id=profiling-in-apm>Profiling in APM</h3><p>Visit <code>http://&lt;your IP address>:81</code> and play a few more rounds of The Door Game.</p><p>Then head back to Splunk Observability Cloud, click on APM, and click on the <code>doorgame</code> service at the bottom of the screen.</p><p>Click on &ldquo;Traces&rdquo; on the right-hand side to load traces for this service. Filter on traces involving the <code>doorgame</code> service and the <code>GET new-game</code> operation (since we&rsquo;re troubleshooting the game startup sequence):</p><p><a href=#R-image-f6d67c024415b81a4a5909bdf076586c class=lightbox-link><img alt="New Game Traces" class="lazy lightbox figure-image" loading=lazy src=../images/new_game_traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f6d67c024415b81a4a5909bdf076586c><img alt="New Game Traces" class="lazy lightbox lightbox-image" loading=lazy src=../images/new_game_traces.png></a></p><p>Selecting one of these traces brings up the following screen:</p><p><a href=#R-image-6fe0ebc379b1654e84b24d5f0be4e001 class=lightbox-link><img alt="Trace with Call Stacks" class="lazy lightbox figure-image" loading=lazy src=../images/trace_with_call_stacks.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6fe0ebc379b1654e84b24d5f0be4e001><img alt="Trace with Call Stacks" class="lazy lightbox lightbox-image" loading=lazy src=../images/trace_with_call_stacks.png></a></p><p>You can see that the spans now include &ldquo;Call Stacks&rdquo;, which is a result of us enabling CPU and memory profiling earlier.</p><p>Click on the span named <code>doorgame: SELECT doorgamedb</code>, then click on CPU stack traces on the right-hand side:</p><p><a href=#R-image-5f6d13a8beb5e59da89911728e9108b3 class=lightbox-link><img alt="Trace with CPU Call Stacks" class="lazy lightbox figure-image" loading=lazy src=../images/trace_with_cpu_call_stacks.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5f6d13a8beb5e59da89911728e9108b3><img alt="Trace with CPU Call Stacks" class="lazy lightbox lightbox-image" loading=lazy src=../images/trace_with_cpu_call_stacks.png></a></p><p>This brings up the CPU call stacks captured by the profiler.</p><p>Let&rsquo;s open the AlwaysOn Profiler to review the CPU stack trace in more detail. We can do this by clicking on the <code>Span</code> link beside <code>View in AlwaysOn Profiler</code>:</p><p><a href=#R-image-aefaf90b9ff22f43f5d5d560fcd3f562 class=lightbox-link><img alt="Flamegraph and table" class="lazy lightbox figure-image" loading=lazy src=../images/flamegraph_and_table.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-aefaf90b9ff22f43f5d5d560fcd3f562><img alt="Flamegraph and table" class="lazy lightbox lightbox-image" loading=lazy src=../images/flamegraph_and_table.png></a></p><p>The AlwaysOn Profiler includes both a table and a <a href=https://www.brendangregg.com/flamegraphs.html rel=external target=_blank>flamegraph</a>. Take some time to explore this view by doing some of the following:</p><ul><li>click a table item and notice the change in flamegraph</li><li>navigate the flamegraph by clicking on a stack frame to zoom in, and a parent frame to zoom out</li><li>add a search term like <code>splunk</code> or <code>jetty</code> to highlight some matching stack frames</li></ul><p>Let&rsquo;s have a closer look at the stack trace, starting with the <code>DoorGame.startNew</code> method (since we already know that it&rsquo;s the slowest part of the request)</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>com.splunk.profiling.workshop.DoorGame.startNew(DoorGame.java:24)
com.splunk.profiling.workshop.UserData.loadUserData(UserData.java:33)
com.mysql.cj.jdbc.StatementImpl.executeQuery(StatementImpl.java:1168)
com.mysql.cj.NativeSession.execSQL(NativeSession.java:655)
com.mysql.cj.protocol.a.NativeProtocol.sendQueryString(NativeProtocol.java:998)
com.mysql.cj.protocol.a.NativeProtocol.sendQueryPacket(NativeProtocol.java:1065)
com.mysql.cj.protocol.a.NativeProtocol.readAllResults(NativeProtocol.java:1715)
com.mysql.cj.protocol.a.NativeProtocol.read(NativeProtocol.java:1661)
com.mysql.cj.protocol.a.TextResultsetReader.read(TextResultsetReader.java:48)
com.mysql.cj.protocol.a.TextResultsetReader.read(TextResultsetReader.java:87)
com.mysql.cj.protocol.a.NativeProtocol.read(NativeProtocol.java:1648)
com.mysql.cj.protocol.a.ResultsetRowReader.read(ResultsetRowReader.java:42)
com.mysql.cj.protocol.a.ResultsetRowReader.read(ResultsetRowReader.java:75)
com.mysql.cj.protocol.a.MultiPacketReader.readMessage(MultiPacketReader.java:44)
com.mysql.cj.protocol.a.MultiPacketReader.readMessage(MultiPacketReader.java:66)
com.mysql.cj.protocol.a.TimeTrackingPacketReader.readMessage(TimeTrackingPacketReader.java:41)
com.mysql.cj.protocol.a.TimeTrackingPacketReader.readMessage(TimeTrackingPacketReader.java:62)
com.mysql.cj.protocol.a.SimplePacketReader.readMessage(SimplePacketReader.java:45)
com.mysql.cj.protocol.a.SimplePacketReader.readMessage(SimplePacketReader.java:102)
com.mysql.cj.protocol.a.SimplePacketReader.readMessageLocal(SimplePacketReader.java:137)
com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:64)
java.io.FilterInputStream.read(Unknown Source:0)
sun.security.ssl.SSLSocketImpl$AppInputStream.read(Unknown Source:0)
sun.security.ssl.SSLSocketImpl.readApplicationRecord(Unknown Source:0)
sun.security.ssl.SSLSocketInputRecord.bytesInCompletePacket(Unknown Source:0)
sun.security.ssl.SSLSocketInputRecord.readHeader(Unknown Source:0)
sun.security.ssl.SSLSocketInputRecord.read(Unknown Source:0)
java.net.SocketInputStream.read(Unknown Source:0)
java.net.SocketInputStream.read(Unknown Source:0)
java.lang.ThreadLocal.get(Unknown Source:0)</code></pre></div><p>We can interpret the stack trace as follows:</p><ul><li>When starting a new Door Game, a call is made to load user data.</li><li>This results in executing a SQL query to load the user data (which is related to the slow SQL query we saw earlier).</li><li>We then see calls to read data in from the database.</li></ul><p>So, what does this all mean? It means that our application startup is slow since it&rsquo;s spending time loading user data. In fact, the profiler has told us the exact line of code where this happens:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>com.splunk.profiling.workshop.UserData.loadUserData(UserData.java:33)</code></pre></div><p>Let&rsquo;s open the corresponding source file (<code>./doorgame/src/main/java/com/splunk/profiling/workshop/UserData.java</code>) and look at this code in more detail:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>public class UserData {

    static final String DB_URL = &#34;jdbc:mysql://mysql/DoorGameDB&#34;;
    static final String USER = &#34;root&#34;;
    static final String PASS = System.getenv(&#34;MYSQL_ROOT_PASSWORD&#34;);
    static final String SELECT_QUERY = &#34;select * FROM DoorGameDB.Users, DoorGameDB.Organizations&#34;;

    HashMap&lt;String, User&gt; users;

    public UserData() {
        users = new HashMap&lt;String, User&gt;();
    }

    public void loadUserData() {

        // Load user data from the database and store it in a map
        Connection conn = null;
        Statement stmt = null;
        ResultSet rs = null;

        try{
            conn = DriverManager.getConnection(DB_URL, USER, PASS);
            stmt = conn.createStatement();
            rs = stmt.executeQuery(SELECT_QUERY);
            while (rs.next()) {
                User user = new User(rs.getString(&#34;UserId&#34;), rs.getString(&#34;FirstName&#34;), rs.getString(&#34;LastName&#34;));
                users.put(rs.getString(&#34;UserId&#34;), user);
            }</code></pre></div><p>Here we can see the application logic in action. It establishes a connection to the database, then executes the SQL query we saw earlier:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>select * FROM DoorGameDB.Users, DoorGameDB.Organizations</code></pre></div><p>It then loops through each of the results, and loads each user into a <code>HashMap</code> object, which is a collection of <code>User</code> objects.</p><p>We have a good understanding of why the game startup sequence is so slow, but how do we fix it?</p><p>For more clues, let&rsquo;s have a look at the other part of AlwaysOn Profiling: memory profiling. To do this, click on the <code>Memory</code> tab in AlwaysOn profiling:</p><p><a href=#R-image-ebabb0cae085c9a78d76d11878a2a366 class=lightbox-link><img alt="Memory Profiling" class="lazy lightbox figure-image" loading=lazy src=../images/memory_profiling.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ebabb0cae085c9a78d76d11878a2a366><img alt="Memory Profiling" class="lazy lightbox lightbox-image" loading=lazy src=../images/memory_profiling.png></a></p><p>At the top of this view, we can see how much heap memory our application is using, the heap memory allocation rate, and garbage collection activity.</p><p>We can see that our application is using about 400 MB out of the max 1 GB heap size, which seems excessive for such a simple application. We can also see that some garbage collection occurred, which caused our application to pause (and probably annoyed those wanting to play the Game Door).</p><p>At the bottom of the screen, which can see which methods in our Java application code are associated with the most heap memory usage. Click on the first item in the list to show the Memory Allocation Stack Traces associated with the <code>java.util.Arrays.copyOf</code> method specifically:</p><p><a href=#R-image-a8443a7c6081b972b629ce5894921929 class=lightbox-link><img alt="Memory Allocation Stack Traces" class="lazy lightbox figure-image" loading=lazy src=../images/memory_allocation_stack_traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a8443a7c6081b972b629ce5894921929><img alt="Memory Allocation Stack Traces" class="lazy lightbox lightbox-image" loading=lazy src=../images/memory_allocation_stack_traces.png></a></p><p>With help from the profiler, we can see that the <code>loadUserData</code> method not only consumes excessive CPU time, but it also consumes excessive memory when storing the user data in the <code>HashMap</code> collection object.</p><h2 id=what-did-we-accomplish>What did we accomplish?</h2><p>We&rsquo;ve come a long way already!</p><ul><li>We learned how to enable the profiler in the Splunk OpenTelemetry Java instrumentation agent.</li><li>We learned how to verify in the agent output that the profiler is enabled.</li><li>We have explored several profiling related workflows in APM:<ul><li>How to navigate to AlwaysOn Profiling from the troubleshooting view</li><li>How to explore the flamegraph and method call duration table through navigation and filtering</li><li>How to identify when a span has sampled call stacks associated with it</li><li>How to explore heap utilization and garbage collection activity</li><li>How to view memory allocation stack traces for a particular method</li></ul></li></ul><p>In the next section, we&rsquo;ll apply a fix to our application to resolve the slow startup performance.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=fix-application-startup-slowness>Fix Application Startup Slowness</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, we&rsquo;ll use what we learned from the profiling data in <strong>Splunk Observability Cloud</strong> to resolve the slowness we saw when starting our application.</p><h3 id=examining-the-source-code>Examining the Source Code</h3><p>Open the corresponding source file once again (<code>./doorgame/src/main/java/com/splunk/profiling/workshop/UserData.java</code>) and focus on the following code:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>public class UserData {

    static final String DB_URL = &#34;jdbc:mysql://mysql/DoorGameDB&#34;;
    static final String USER = &#34;root&#34;;
    static final String PASS = System.getenv(&#34;MYSQL_ROOT_PASSWORD&#34;);
    static final String SELECT_QUERY = &#34;select * FROM DoorGameDB.Users, DoorGameDB.Organizations&#34;;

    HashMap&lt;String, User&gt; users;

    public UserData() {
        users = new HashMap&lt;String, User&gt;();
    }

    public void loadUserData() {

        // Load user data from the database and store it in a map
        Connection conn = null;
        Statement stmt = null;
        ResultSet rs = null;

        try{
            conn = DriverManager.getConnection(DB_URL, USER, PASS);
            stmt = conn.createStatement();
            rs = stmt.executeQuery(SELECT_QUERY);
            while (rs.next()) {
                User user = new User(rs.getString(&#34;UserId&#34;), rs.getString(&#34;FirstName&#34;), rs.getString(&#34;LastName&#34;));
                users.put(rs.getString(&#34;UserId&#34;), user);
            }</code></pre></div><p>After speaking with a database engineer, you discover that the SQL query being executed includes a cartesian join:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>select * FROM DoorGameDB.Users, DoorGameDB.Organizations</code></pre></div><p>Cartesian joins are notoriously slow, and shouldn&rsquo;t be used, in general.</p><p>Upon further investigation, you discover that there are 10,000 rows in the user table, and 1,000 rows in the organization table. When we execute a cartesian join using both of these tables, we end up with 10,000 x 1,000 rows being returned, which is 10,000,000 rows!</p><p>Furthermore, the query ends up returning duplicate user data, since each record in the user table is repeated for each organization.</p><p>So when our code executes this query, it tries to load 10,000,000 user objects into the HashMap, which explains why it takes so long to execute, and why it consumes so much heap memory.</p><h3 id=lets-fix-that-bug>Let&rsquo;s Fix That Bug</h3><p>After consulting the engineer that originally wrote this code, we determined that the join with the Organizations table was inadvertent.</p><p>So when loading the users into the HashMap, we simply need to remove this table from the query.</p><p>Open the corresponding source file once again (<code>./doorgame/src/main/java/com/splunk/profiling/workshop/UserData.java</code>) and change the following line of code:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>SELECT_QUERY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select * FROM DoorGameDB.Users, DoorGameDB.Organizations&#34;</span><span class=p>;</span></span></span></code></pre></div><p>to:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>SELECT_QUERY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select * FROM DoorGameDB.Users&#34;</span><span class=p>;</span></span></span></code></pre></div><p>Now the method should perform much more quickly, and less memory should be used, as it&rsquo;s loading the correct number of users into the HashMap (10,000 instead of 10,000,000).</p><h3 id=rebuild-and-redeploy-application>Rebuild and Redeploy Application</h3><p>Let&rsquo;s test our changes by using the following commands to re-build and re-deploy the Door Game application:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> workshop/profiling
</span></span><span class=line><span class=cl>./5-redeploy-doorgame.sh</span></span></code></pre></div><p>Once the application has been redeployed successfully, visit The Door Game again to confirm that your fix is in place:
<code>http://&lt;your IP address>:81</code></p><p>Clicking <code>Let's Play</code> should take us to the game more quickly now (though performance could still be improved):</p><p><a href=#R-image-eefad634f81fd3fa806e93247e80396c class=lightbox-link><img alt="Choose Door" class="lazy lightbox figure-image" loading=lazy src=../images/door_game_choose_door.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-eefad634f81fd3fa806e93247e80396c><img alt="Choose Door" class="lazy lightbox lightbox-image" loading=lazy src=../images/door_game_choose_door.png></a></p><p>Start the game a few more times, then return to <strong>Splunk Observability Cloud</strong> to confirm that the latency of the <code>GET new-game</code> operation has decreased.</p><h2 id=what-did-we-accomplish>What did we accomplish?</h2><ul><li>We discovered why our SQL query was so slow.</li><li>We applied a fix, then rebuilt and redeployed our application.</li><li>We confirmed that the application starts a new game more quickly.</li></ul><p>In the next section, we&rsquo;ll explore continue playing the game and fix any remaining performance issues that we find.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=fix-in-game-slowness>Fix In Game Slowness</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Now that our game startup slowness has been resolved, let&rsquo;s play several rounds of the Door Game and ensure the rest of the game performs quickly.</p><p>As you play the game, do you notice any other slowness? Let&rsquo;s look at the data in <strong>Splunk Observability</strong> Cloud to put some numbers on what we&rsquo;re seeing.</p><h3 id=review-game-performance-in-splunk-observability-cloud>Review Game Performance in Splunk Observability Cloud</h3><p>Navigate to APM then click on Traces on the right-hand side of the screen. Sort the traces by Duration in descending order:</p><p><a href=#R-image-99579fa1d28cc5a263432b25f05b5324 class=lightbox-link><img alt="Slow Traces" class="lazy lightbox figure-image" loading=lazy src=../images/slow_trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-99579fa1d28cc5a263432b25f05b5324><img alt="Slow Traces" class="lazy lightbox lightbox-image" loading=lazy src=../images/slow_trace.png></a></p><p>We can see that a few of the traces with an operation of <code>GET /game/:uid/picked/:picked/outcome</code> have a duration of just over five seconds. This explains why we&rsquo;re still seeing some slowness when we play the app (note that the slowness is no longer on the game startup operation, <code>GET /new-game</code>, but rather a different operation used while actually playing the game).</p><p>Let&rsquo;s click on one of the slow traces and take a closer look. Since profiling is still enabled, call stacks have been captured as part of this trace. Click on the child span in the waterfall view, then click CPU Stack Traces:</p><p><a href=#R-image-b27cb2eb7cbf29a684fa0fc10474d4fc class=lightbox-link><img alt="View Stack on Span" class="lazy lightbox figure-image" loading=lazy src=../images/view_stack_on_span.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b27cb2eb7cbf29a684fa0fc10474d4fc><img alt="View Stack on Span" class="lazy lightbox lightbox-image" loading=lazy src=../images/view_stack_on_span.png></a></p><p>At the bottom of the call stack, we can see that the thread was busy sleeping:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-log data-lang=log>com.splunk.profiling.workshop.ServiceMain$$Lambda$.handle(Unknown Source:0)
com.splunk.profiling.workshop.ServiceMain.lambda$main$(ServiceMain.java:34)
com.splunk.profiling.workshop.DoorGame.getOutcome(DoorGame.java:41)
com.splunk.profiling.workshop.DoorChecker.isWinner(DoorChecker.java:14)
com.splunk.profiling.workshop.DoorChecker.checkDoorTwo(DoorChecker.java:30)
com.splunk.profiling.workshop.DoorChecker.precheck(DoorChecker.java:36)
com.splunk.profiling.workshop.Util.sleep(Util.java:9)
java.util.concurrent.TimeUnit.sleep(Unknown Source:0)
java.lang.Thread.sleep(Unknown Source:0)
java.lang.Thread.sleep(Native Method:0)</code></pre></div><p>The call stack tells us a story &ndash; reading from the bottom up, it lets us describe
what is happening inside the service code. A developer, even one unfamiliar with the
source code, should be able to look at this call stack to craft a narrative like:</p><blockquote><p>We are getting the outcome of a game. We leverage the DoorChecker to
see if something is the winner, but the check for door two somehow issues
a precheck() that, for some reason, is deciding to sleep for a long time.</p></blockquote><p>Our workshop application is left intentionally simple &ndash; a real-world service might see the
thread being sampled during a database call or calling into an un-traced external service.
It is also possible that a slow span is executing a complicated business process,
in which case maybe none of the stack traces relate to each other at all.</p><p>The longer a method or process is, the greater chance we will have call stacks
sampled during its execution.</p><h3 id=lets-fix-that-bug>Let&rsquo;s Fix That Bug</h3><p>By using the profiling tool, we were able to determine that our application is slow
when issuing the <code>DoorChecker.precheck()</code> method from inside <code>DoorChecker.checkDoorTwo()</code>.
Let&rsquo;s open the <code>doorgame/src/main/java/com/splunk/profiling/workshop/DoorChecker.java</code> source file in our editor.</p><p>By quickly glancing through the file, we see that there are methods for checking
each door, and all of them call <code>precheck()</code>. In a real service, we might be uncomfortable
simply removing the <code>precheck()</code> call because there could be unseen/unaccounted side
effects.</p><p>Down on line 29 we see the following:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>checkDoorTwo</span><span class=p>(</span><span class=n>GameInfo</span><span class=w> </span><span class=n>gameInfo</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>precheck</span><span class=p>(</span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>gameInfo</span><span class=p>.</span><span class=na>isWinner</span><span class=p>(</span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>precheck</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>doorNum</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>extra</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>Math</span><span class=p>.</span><span class=na>pow</span><span class=p>(</span><span class=n>70</span><span class=p>,</span><span class=w> </span><span class=n>doorNum</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=n>300</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>extra</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span></span></span></code></pre></div><p>With our developer hat on, we notice that the door number is zero based, so
the first door is 0, the second is 1, and the 3rd is 2 (this is conventional).
The <code>extra</code> value is used as extra/additional sleep time, and it is computed by taking
<code>70^doorNum</code> (<code>Math.pow</code> performs an exponent calculation). That&rsquo;s odd, because this means:</p><ul><li>door 0 => 70^0 => 1ms</li><li>door 1 => 70^1 => 70ms</li><li>door 2 => 70^2 => 4900ms</li></ul><p>We&rsquo;ve found the root cause of our slow bug! This also explains why the first two doors
weren&rsquo;t ever very slow.</p><p>We have a quick chat with our product manager and team lead, and we agree that the <code>precheck()</code>
method must stay but that the extra padding isn&rsquo;t required. Let&rsquo;s remove the <code>extra</code> variable
and make <code>precheck</code> now read like this:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>precheck</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>doorNum</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=n>300</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span></span></span></code></pre></div><p>Now all doors will have a consistent behavior. Save your work and then rebuild and redeploy the application using the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> workshop/profiling
</span></span><span class=line><span class=cl>./5-redeploy-doorgame.sh</span></span></code></pre></div><p>Once the application has been redeployed successfully, visit The Door Game again to confirm that your fix is in place:
<code>http://&lt;your IP address>:81</code></p><h2 id=what-did-we-accomplish>What did we accomplish?</h2><ul><li>We found another performance issue with our application that impacts game play.</li><li>We used the CPU call stacks included in the trace to understand application behavior.</li><li>We learned how the call stack can tell us a story and point us to suspect lines of code.</li><li>We identified the slow code and fixed it to make it faster.</li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>3 minutes</span>
</span>&nbsp;<p>In this workshop, we accomplished the following:</p><ul><li>We deployed our application and captured traces with <strong>Splunk Observability Cloud</strong>.</li><li>We used <strong>Database Query Performance</strong> to find a slow-running query that impacted the game startup time.</li><li>We enabled <strong>AlwaysOn Profiling</strong> and used it to confirm which line of code was causing the increased startup time and memory usage.</li><li>We found another application performance issue and used <strong>AlwaysOn Profiling</strong> again to find the problematic line of code.</li><li>We applied fixes for both of these issues and verified the result using <strong>Splunk Observability Cloud</strong>.</li></ul><p>Enabling <strong>AlwaysOn Profiling</strong> and utilizing <strong>Database Query Performance</strong> for your applications will let you get even more value from the data you’re sending to <strong>Splunk Observability Cloud</strong>.</p><p>Now that you’ve completed this workshop, you have the knowledge you need to start collecting deeper diagnostic data from your own applications!</p><p>To get started with <strong>Database Query Performance</strong> today, check out <a href=https://docs.splunk.com/observability/en/apm/db-query-perf/db-query-performance.html rel=external target=_blank>Monitor Database Query Performance</a>.</p><p>And to get started with <strong>AlwaysOn Profiling</strong>, check out <a href=https://docs.splunk.com/observability/en/apm/profiling/intro-profiling.html rel=external target=_blank>Introduction to AlwaysOn Profiling for Splunk APM</a></p><p>For more help, feel free to <a href=https://www.splunk.com/en_us/about-splunk/contact-us.html rel=external target=_blank>ask a Splunk Expert</a>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jul 23, 2025</span></span></footer></article></section></section></div></main></div><script src=/observability-workshop/v6.7/js/clipboard/clipboard.min.js?1759396524 defer></script><script src=/observability-workshop/v6.7/js/perfect-scrollbar/perfect-scrollbar.min.js?1759396524 defer></script><script src=/observability-workshop/v6.7/js/theme.min.js?1759396524 defer></script></body></html>