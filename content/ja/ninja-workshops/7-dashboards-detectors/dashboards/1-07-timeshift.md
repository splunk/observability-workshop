---
title: TimeShift と数式の使用
linkTitle: 1.07. TimeShift & Formula's
weight: 1.07
---

### 1. Timeshift 分析関数の使用

多くの場合、現在のパフォーマンスを過去のデータと比較することが有用です。たとえば、時間の経過に伴うトレンド、回帰、または改善を特定するためです。**Timeshift** 関数は、時系列を過去にシフトさせることでこれを簡単にし、過去の値を現在と並べて表示できるようにします。

開始するには、**Signal A** の横にある **`...`** メニュー **(1)** をクリックし、ドロップダウンから **Clone (2)** を選択してクローンを作成します。

シグナルを **クローン** すると、同じメトリクス、フィルター、および設定を持つ同一のコピーが作成されます。この複製、**Signal B** は、元のシグナルを変更せずに、1週間前のメトリクスがどのように見えたかを可視化するための **Timeshift** の適用など、さらなる計算や比較に使用できます。
![Clone Signal](../../images/timeshift-filter.png)

---
クローン作成後、**Signal B (1)** というラベルの新しいシグナルが表示されます。これは **Signal A** の正確なコピーであるため、両方のシグナルは同じ時間範囲で同じデータを表示します。その結果、チャート上で **完全に重なって** 表示され、1本の線しかないように見えます。

比較を意味のあるものにするために、**Signal B** に **Timeshift** を適用し、データを1週間過去にシフトさせます。これにより、現在のレイテンシのトレンドが先週の同時期と比較してどうなっているかを確認できます。

Signal Bの横にある **F(x)** 列で、{{% button style="blue" %}} **+** {{% /button %}} **(2)** をクリックし、リストから **Timeshift (3)** 関数を選択します。
![Plot Editor](../../images/ab-plot-full.png)

---
プロンプトが表示されたら、タイムシフト値として **1w**（または7日間の場合は **7d**）**(4)** を入力します。パネルの外側の任意の場所をクリック **(5)** して変更を確認します。

これにより、**Signal B** のデータが1週間過去にシフトされ、現在のレイテンシのトレンドを先週の同時期と視覚的に比較できます。
![Timeshift](../../images/b-shifted.png)

---
**Signal B** の色を変更するには、その行の右端にある ⚙️ 設定アイコン **(1)** をクリックして設定メニューを開きます。次に、ピンクなどの **Plot Color** **(2)** を選択して、チャート上で **Signal B** を元のシグナルと視覚的に区別します。
完了したら、{{% button style="gray" %}} Close {{% /button %}} **(3)** をクリックします。
![Change Plot Color](../../images/b-pink.png)

---
チャートに2つのプロットが表示されるはずです：現在のレイテンシの *p90*（**Signal A**）が青で表示され、1週間前の *p90*（**Signal B**）がピンクで表示されます。

それらの違いを解釈しやすくするために、**Area chart** アイコン **(1)** をクリックして可視化スタイルを変更します。これにより、曲線の下の領域が強調表示され、先週のレイテンシが現在の値より高かった時期を見つけやすくなります。

次に、Overrideバーの **Time (2)** の横にあるフィールドをクリックし、ドロップダウンから **Past Hour (3)** を選択して時間範囲を更新します。
![Timeframe](../../images/a-b-area.png)

---

### 2. 数式の使用

次に、2つの時間シフトされたメトリクス値の差を計算することで、さらに一歩進めましょう。たとえば、今日のデータをちょうど1週間前のデータと比較します。

行 **C (1)** の {{% button style=blue %}}Enter Formula{{% /button %}} ボタンをクリックし、**A - B** **(2)** と入力して **Signal B** を **Signal A** から減算します。これにより、**C** というラベルの新しい計算シグナルが作成されます。

この数式の結果のみに焦点を当てるには、**A (3)** と **B (4)** の横にある目のアイコンをクリックして他のシグナルを非表示にし、**C** のみを表示したままにします。

![C only](../../images/c-only.png)

現在のメトリクス値（**A**）と1週間前の値（**B**）の差を表す単一の線が表示されるはずです。チャートでは、一部の値が負になることがあります。これは、その時点で古いメトリクス（**B**）が現在のもの（**A**）より高かった場合に発生します。

ビジュアルチャート分析を探索したので、次のセクションでチャートとDetectorを駆動するSignalFlowの仕組みを見てみましょう！
