<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.4.0+tip"><meta name=description content="TODO Note on .env being overwritten
TODO change name of environment from YOURENV to something else.
The development team has started using Kubernetes for container orchestration. Switch to the provided milestone 12microservices-k8s with the instructions from â€œGetting Startedâ€.
The Kubernetes manifests are located in the k8s folder. Add auto-instrumentation to the public_api microservice deployment by configuring the Splunk distribution of OpenTelemetry Python. The Dockerfile has already been prepared.
Install the OpenTelemetry Collector to the environment using Splunkâ€™s helm chart and use the provided values."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Instrumentation in Kubernetes :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="TODO Note on .env being overwritten
TODO change name of environment from YOURENV to something else.
The development team has started using Kubernetes for container orchestration. Switch to the provided milestone 12microservices-k8s with the instructions from â€œGetting Startedâ€.
The Kubernetes manifests are located in the k8s folder. Add auto-instrumentation to the public_api microservice deployment by configuring the Splunk distribution of OpenTelemetry Python. The Dockerfile has already been prepared.
Install the OpenTelemetry Collector to the environment using Splunkâ€™s helm chart and use the provided values."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.67/en/unsupported-field-workshops/bootcamp/docs/apm/k8s/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Instrumentation in Kubernetes :: Splunk Observability Cloud Workshops"><meta property="og:description" content="TODO Note on .env being overwritten
TODO change name of environment from YOURENV to something else.
The development team has started using Kubernetes for container orchestration. Switch to the provided milestone 12microservices-k8s with the instructions from â€œGetting Startedâ€.
The Kubernetes manifests are located in the k8s folder. Add auto-instrumentation to the public_api microservice deployment by configuring the Splunk distribution of OpenTelemetry Python. The Dockerfile has already been prepared.
Install the OpenTelemetry Collector to the environment using Splunkâ€™s helm chart and use the provided values."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="Unsupported Field Workshops"><meta property="article:modified_time" content="2024-09-19T16:47:03+01:00"><meta itemprop=name content="Instrumentation in Kubernetes :: Splunk Observability Cloud Workshops"><meta itemprop=description content="TODO Note on .env being overwritten
TODO change name of environment from YOURENV to something else.
The development team has started using Kubernetes for container orchestration. Switch to the provided milestone 12microservices-k8s with the instructions from â€œGetting Startedâ€.
The Kubernetes manifests are located in the k8s folder. Add auto-instrumentation to the public_api microservice deployment by configuring the Splunk distribution of OpenTelemetry Python. The Dockerfile has already been prepared.
Install the OpenTelemetry Collector to the environment using Splunkâ€™s helm chart and use the provided values."><meta itemprop=dateModified content="2024-09-19T16:47:03+01:00"><meta itemprop=wordCount content="166"><title>Instrumentation in Kubernetes :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.67/en/unsupported-field-workshops/bootcamp/docs/apm/k8s/index.html rel=canonical type=text/html title="Instrumentation in Kubernetes :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.67/images/favicon.ico?1726779098 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.67/css/fontawesome-all.min.css?1726779098 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.67/css/fontawesome-all.min.css?1726779098 rel=stylesheet></noscript><link href=/observability-workshop/v5.67/css/nucleus.css?1726779098 rel=stylesheet><link href=/observability-workshop/v5.67/css/auto-complete.css?1726779098 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.67/css/auto-complete.css?1726779098 rel=stylesheet></noscript><link href=/observability-workshop/v5.67/css/perfect-scrollbar.min.css?1726779098 rel=stylesheet><link href=/observability-workshop/v5.67/css/fonts.css?1726779098 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.67/css/fonts.css?1726779098 rel=stylesheet></noscript><link href=/observability-workshop/v5.67/css/theme.css?1726779098 rel=stylesheet><link href=/observability-workshop/v5.67/css/theme-splunk-light.css?1726779098 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.67/css/chroma-relearn-light.css?1726779098 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.67/css/variant.css?1726779098 rel=stylesheet><link href=/observability-workshop/v5.67/css/print.css?1726779098 rel=stylesheet media=print><link href=/observability-workshop/v5.67/css/format-print.css?1726779098 rel=stylesheet><script src=/observability-workshop/v5.67/js/variant.js?1726779098></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../../../..",window.relearn.relBaseUri="../../../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.67",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.index_js_url="/observability-workshop/v5.67/en/index.search.js?1726779098",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.67/en/unsupported-field-workshops/bootcamp/docs/apm/k8s/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.67/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.67/en/unsupported-field-workshops/index.html><span itemprop=name>Unsupported Field Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Observability Bootcamp</span><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.67/en/unsupported-field-workshops/bootcamp/docs/index.html><span itemprop=name>Bootcamp Labs</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.67/en/unsupported-field-workshops/bootcamp/docs/apm/index.html><span itemprop=name>Microserverices APM</span></a><meta itemprop=position content="5">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Instrumentation in Kubernetes</span><meta itemprop=position content="6"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.67/en/index.html title="Splunk Observability Workshops (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class=topbar-control><i class="fa-fw fas fa-chevron-right"></i></span></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=instrumentation-in-kubernetes>Instrumentation in Kubernetes</h1><p>TODO Note on .env being overwritten</p><p>TODO change name of environment from YOURENV to something else.</p><p>The development team has started using Kubernetes for container orchestration. Switch to the provided milestone <code>12microservices-k8s</code> with the instructions from &ldquo;Getting Started&rdquo;.</p><p>The Kubernetes manifests are located in the <code>k8s</code> folder. Add auto-instrumentation to the <code>public_api</code> microservice <code>deployment</code> by configuring the Splunk distribution of OpenTelemetry Python. The <code>Dockerfile</code> has already been prepared.</p><p>Install the OpenTelemetry Collector to the environment using <a href=https://github.com/signalfx/splunk-otel-collector-chart rel=external target=_blank>Splunk&rsquo;s helm chart</a> and use the provided <code>values.yaml</code>:</p><div class=tab-panel data-tab-group=af58c91ae76ad962d5f9e575e7302a71><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("af58c91ae76ad962d5f9e575e7302a71","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>helm install my-splunk-otel-collector --set=&#34;splunkObservability.realm=${SPLUNK_REALM},splunkObservability.accessToken=${SPLUNK_ACCESS_TOKEN},clusterName=${CLUSTER_NAME}&#34; splunk-otel-collector-chart/splunk-otel-collector -f values.yaml</span></span></code></pre></div></div></div></div></div><p>Rebuild the container images for the private registry:</p><div class=tab-panel data-tab-group=5c22836e2fb675ffb58ae686d8c0a7c9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5c22836e2fb675ffb58ae686d8c0a7c9","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>docker-compose build</p></div></div></div></div><p>Push the images to the private registry:</p><div class=tab-panel data-tab-group=1e8ed087aa74fa326d29d4ae6ee2877d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1e8ed087aa74fa326d29d4ae6ee2877d","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>docker-compose push</p></div></div></div></div><p>Deploy to the cluster with</p><div class=tab-panel data-tab-group=43f0f620b9c3f308b147d9ab41b8a996><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("43f0f620b9c3f308b147d9ab41b8a996","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f k8s</span></span></code></pre></div></div></div></div></div><p>Test the service with:</p><div class=tab-panel data-tab-group=56fd5e52e9d23be28a780b6a88086161><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=shell-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("56fd5e52e9d23be28a780b6a88086161","shell-command")'>
<span class=tab-nav-text>Shell Command</span></button></div><div class=tab-content-container><div data-tab-item=shell-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ENDPOINT</span><span class=o>=</span><span class=k>$(</span>kubectl get service/public-api -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>curl http://<span class=nv>$ENDPOINT</span>:8000/api -F <span class=nv>text</span><span class=o>=</span>@hamlet.txt</span></span></code></pre></div></div></div></div></div><p>The milestone for this task is <code>12microservices-k8s-autoi</code>. It has auto-instrumentation applied for <em>all</em> microservices.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></div></main></div><script src=/observability-workshop/v5.67/js/clipboard.min.js?1726779098 defer></script><script src=/observability-workshop/v5.67/js/perfect-scrollbar.min.js?1726779098 defer></script><script src=/observability-workshop/v5.67/js/theme.js?1726779098 defer></script></body></html>