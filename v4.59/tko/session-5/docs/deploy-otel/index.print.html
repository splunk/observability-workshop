<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.11.2+tip"><meta name=description content="Splunk Observability Workshops"><title>Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v4.59/tko/session-5/docs/deploy-otel/index.html rel=canonical type=text/html title="Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace :: Splunk Observability Cloud Workshops"><link href=../../../../tko/session-5/docs/deploy-otel/index.xml rel=alternate type=application/rss+xml title="Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace :: Splunk Observability Cloud Workshops"><link href=../../../../images/favicon.ico?1676566747 rel=icon type=image/x-icon><link href=../../../../css/fontawesome-all.min.css?1676566749 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/fontawesome-all.min.css?1676566749 rel=stylesheet></noscript><link href=../../../../css/nucleus.css?1676566749 rel=stylesheet><link href=../../../../css/auto-complete.css?1676566749 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/auto-complete.css?1676566749 rel=stylesheet></noscript><link href=../../../../css/perfect-scrollbar.min.css?1676566749 rel=stylesheet><link href=../../../../css/fonts.css?1676566749 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/fonts.css?1676566749 rel=stylesheet></noscript><link href=../../../../css/theme.css?1676566749 rel=stylesheet><link href=../../../../css/theme-splunk-light.css?1676566749 rel=stylesheet id=variant-style><link href=../../../../css/variant.css?1676566749 rel=stylesheet><link href=../../../../css/print.css?1676566749 rel=stylesheet media=print><link href=../../../../css/format-print.css?1676566749 rel=stylesheet><link href=../../../../css/ie.css?1676566749 rel=stylesheet><script src=../../../../js/url.js?1676566749></script>
<script src=../../../../js/variant.js?1676566749></script>
<script>window.index_js_url="../../../../index.search.js";var root_url="../../../../",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://splunk.github.io/observability-workshop/v4.59/",window.variants&&variants.init(["splunk-light","splunk-dark","aws"])</script></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../../tko/session-5/docs/deploy-otel/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../tko/index.html><span itemprop=name>TKO Workshops</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../tko/session-5/index.html><span itemprop=name>5. How Platform Engineers Observe Kubernetes</span></a><meta itemprop=position content="3">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace</span><meta itemprop=position content="4"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags></div><article class=default><h1 id=deploying-the-opentelemetry-collector-in-kubernetes-using-a-namespace>Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace</h1><h2 id=1-new-kubernetes-navigator-20-ui>1. New Kubernetes Navigator 2.0 UI</h2><p>As we are in the process of switching to the new generation of the Kubernetes Navigator, please check if you are already on the new Kubernetes navigator.</p><p>When you select <strong>Infrastructure</strong> from the main menu on the left, followed by selecting <strong>Kubernetes</strong>, you should see two services panes for Kubernetes, similar like the ones below:</p><p><a href=#image-28ad14e045f390c8c3bcdf7da837486b class=lightbox-link><img src=../../../../tko/session-5/docs/deploy-otel/../images/k8s-nav2-two.png alt=k8s-navi-v-2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-28ad14e045f390c8c3bcdf7da837486b><img src=../../../../tko/session-5/docs/deploy-otel/../images/k8s-nav2-two.png alt=k8s-navi-v-2 class=lightbox-image loading=lazy></a></p><p>If you are taken straight to the Kubernetes Navigator v1 Map view after selecting <strong>Kubernetes</strong>, you need to opt-in to the new Navigator yourself for this workshop by clicking on the big blue
<span class="btn cstyle blue"><button type=button>
Switch to new navigator</button>
</span>.</p><p>You should now be in the K8s Node view with chart below the cluster map similar like shown below:</p><p><a href=#image-26f3b07d01a5a67d93a638eccf71646e class=lightbox-link><img src=../../../../tko/session-5/docs/deploy-otel/../images/new-k8s-view.png alt=k8s-navi-v-2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-26f3b07d01a5a67d93a638eccf71646e><img src=../../../../tko/session-5/docs/deploy-otel/../images/new-k8s-view.png alt=k8s-navi-v-2 class=lightbox-image loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>If you actually see three services for Kubernetes including one that is named <code>K8s clusters</code>, you need to turn off Precognition in the Superpowers view.
To do this, please change the Url in your browser to match the following: <a href=https://app.[REALM].signalfx.com/#/superpowers target=_blank>https://app.[REALM].signalfx.com/#/superpowers</a></p><p>where [REALM] needs to match the Realm we are using for this workshop then remove the Precognition flag like in the example below. This is one of the first options you can set:</p><p><a href=#image-f78505857038d98867684eb091f6119c class=lightbox-link><img src=../../../../tko/session-5/docs/deploy-otel/../images/precognition.png alt=Set-Precognition style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f78505857038d98867684eb091f6119c><img src=../../../../tko/session-5/docs/deploy-otel/../images/precognition.png alt=Set-Precognition class=lightbox-image loading=lazy></a></p><p>Once its unset, you can refresh your page and reselect Kubernetes from the Infrastructure Navigator menu.</p></div></div><h2 id=2-connect-to-ec2-instance>2. Connect to EC2 instance</h2><p>You will be able to connect to the workshop instance by using SSH from your Mac, Linux or Windows device.</p><p>To use SSH, open a terminal on your system and type <code>ssh ubuntu@x.x.x.x</code> (replacing x.x.x.x with the IP address assigned to you).</p><div class="box notices cstyle default" style=--VARIABLE-BOX-color:info><div class=box-label>Note</div><div class=box-content><p>Your workshop instance has been pre-configured with the correct <code>ACCESS_TOKEN</code> and <code>REALM</code> for this workshop. There is no need for you to configure these.</p></div></div><h2 id=3-namespaces-in-kubernetes>3. Namespaces in Kubernetes</h2><p>Most of our customers will make use of some kind of private or public cloud service to run Kubernetes. They often choose to have only a few large Kubernetes clusters as it is easier to manage centrally.</p><p>Namespaces are a way to organize these large Kubernetes clusters into virtual sub-clusters. This can be helpful when different teams or projects share a Kubernetes cluster as this will give them the easy ability to just see and work with their own stuff.</p><p>Any number of namespaces are supported within a cluster, each logically separated from others but with the ability to communicate with each other. Components are only &ldquo;visible&rdquo; when selecting a namespace or when adding the <code>--all-namespaces</code> flag to <code>kubectl</code> instead of allowing you to view just the components relevant to your project by selecting your namespace.</p><p>Most customers will want to install the Splunk OpenTelemetry Collector in a separate namespace. This workshop will follow that practice.</p><h2 id=4-install-splunk-otel-using-helm>4. Install Splunk OTel using Helm</h2><p>Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository and update.</p><div class=tab-panel data-tab-group=default><div class=tab-nav><button data-tab-item="Helm Repo Add" class="tab-nav-button active" onclick='switchTab("default","Helm Repo Add")'>
<span>Helm Repo Add</span></button>
<button data-tab-item="Helm Repo Add Output" class=tab-nav-button onclick='switchTab("default","Helm Repo Add Output")'>
<span>Helm Repo Add Output</span></button></div><div class=tab-content><div data-tab-item="Helm Repo Add" class="tab-content-text active"><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> helm repo update
</span></span></code></pre></div></div><div data-tab-item="Helm Repo Add Output" class=tab-content-text><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Using ACCESS_TOKEN={REDACTED}
</span></span><span style=display:flex><span>Using REALM=eu0
</span></span><span style=display:flex><span>&#34;splunk-otel-collector-chart&#34; has been added to your repositories
</span></span><span style=display:flex><span>Using ACCESS_TOKEN={REDACTED}
</span></span><span style=display:flex><span>Using REALM=eu0
</span></span><span style=display:flex><span>Hang tight while we grab the latest from your chart repositories...
</span></span><span style=display:flex><span>...Successfully got an update from the &#34;splunk-otel-collector-chart&#34; chart repository
</span></span><span style=display:flex><span>Update Complete. ⎈Happy Helming!⎈
</span></span></code></pre></div></div></div></div><p>Install the OpenTelemetry Collector Helm chart into the <code>splunk</code> namespace with the following commands, do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=default><div class=tab-nav><button data-tab-item="Helm Install" class="tab-nav-button active" onclick='switchTab("default","Helm Install")'>
<span>Helm Install</span></button></div><div class=tab-content><div data-tab-item="Helm Install" class="tab-content-text active"><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install splunk-otel-collector <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--set<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;splunkObservability.realm=</span><span style=color:#000>$REALM</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--set<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;splunkObservability.accessToken=</span><span style=color:#000>$ACCESS_TOKEN</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--set<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;clusterName=</span><span style=color:#204a87;font-weight:700>$(</span>hostname<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>-k3s-cluster&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--set<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;splunkObservability.logsEnabled=true&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--set<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>splunk-otel-collector-chart/splunk-otel-collector <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--namespace splunk <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--create-namespace <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>-f ~/workshop/k3s/splunk-defaults.yaml
</span></span></code></pre></div></div></div></div><h2 id=5-verify-deployment>5. Verify Deployment</h2><p>You can monitor the progress of the deployment by running <code>kubectl get pods</code> and adding <code>-n splunk</code> to the command to see the pods in the <code>splunk</code> namespace which should typically report that the new pods are up and running after about 30 seconds.</p><p>Ensure the status is reported as <strong>Running</strong> before continuing.</p><div class=tab-panel data-tab-group=default><div class=tab-nav><button data-tab-item="kubectl get pods" class="tab-nav-button active" onclick='switchTab("default","kubectl get pods")'>
<span>kubectl get pods</span></button>
<button data-tab-item="kubectl get pods Output" class=tab-nav-button onclick='switchTab("default","kubectl get pods Output")'>
<span>kubectl get pods Output</span></button></div><div class=tab-content><div data-tab-item="kubectl get pods" class="tab-content-text active"><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -n splunk
</span></span></code></pre></div></div><div data-tab-item="kubectl get pods Output" class=tab-content-text><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>NAME                                                          READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>splunk-otel-collector-agent-pvstb                             2/2     Running   0          19s
</span></span><span style=display:flex><span>splunk-otel-collector-k8s-cluster-receiver-6c454894f8-mqs8n   1/1     Running   0          19s
</span></span></code></pre></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>If you are using the Kubernetes Integration setup from the Data Management page from the O11y UI , you find that the guide will use
<code>--generate-name splunk-otel-collector-chart/splunk-otel-collector</code> instead of just <code>splunk-otel-collector-chart/splunk-otel-collector</code> as we do in the above example.</p><p>This will generate an unique name/label for the collector install and Pods by adding a unique number at the end of the object name, allowing you to install multiple collectors in your Kubernetes environment with different configurations.</p><p>Just make sure you use the correct label that is generated by the Helm chart if you wish to use the <code>helm</code> and <code>kubectl</code> commands from this workshop on an install done with the <code>--generate-name</code> option.</p></div></div><p>Use the label set by the <code>helm</code> install to tail logs (You will need to press <code>ctrl + c</code> to exit).</p><div class=tab-panel data-tab-group=default><div class=tab-nav><button data-tab-item="kubectl logs" class="tab-nav-button active" onclick='switchTab("default","kubectl logs")'>
<span>kubectl logs</span></button></div><div class=tab-content><div data-tab-item="kubectl logs" class="tab-content-text active"><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl logs -l <span style=color:#000>app</span><span style=color:#ce5c00;font-weight:700>=</span>splunk-otel-collector -f --container otel-collector -n splunk
</span></span></code></pre></div></div></div></div><p>Or use the installed <code>k9s</code> terminal UI.</p><p><a href=#image-da26475e198b62abeff15bc7c708c03d class=lightbox-link><img src=../../../../tko/session-5/docs/deploy-otel/../images/k9s.png alt=k9s style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-da26475e198b62abeff15bc7c708c03d><img src=../../../../tko/session-5/docs/deploy-otel/../images/k9s.png alt=k9s class=lightbox-image loading=lazy></a></p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Deleting a failed installation</div><div class=box-content><p>If you make an error installing the Splunk OpenTelemetry Collector you can start over by deleting the installation using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm delete splunk-otel-collector -n splunk
</span></span></code></pre></div></div></div><footer class=footline></footer></article></div></main></div><script src=../../../../js/clipboard.min.js?1676566749 defer></script>
<script src=../../../../js/perfect-scrollbar.min.js?1676566749 defer></script>
<script src=../../../../js/theme.js?1676566749 defer></script></body></html>