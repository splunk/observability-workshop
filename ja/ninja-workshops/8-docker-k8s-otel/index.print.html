<!doctype html><html lang=ja dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 8.2.0+9cac649a184a2967957ef9bbececf9402192846c"><meta name=description content="ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯ã€ã“ã‚Œã‚‰ã®æ¦‚å¿µã‚’èª¬æ˜ã™ã‚‹ãŸã‚ã«ã‚·ãƒ³ãƒ—ãƒ«ãª.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã•ã‚ã€å§‹ã‚ã¾ã—ã‚‡ã†ï¼ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®çµ‚ã‚ã‚Šã¾ã§ã«ã€OpenTelemetryã‚’ä½¿ç”¨ã—ãŸ.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨ˆè£…ã®å®Ÿè·µçµŒé¨“ã‚’ç©ã¿ã€ãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®DockeråŒ–ãŠã‚ˆã³Kubernetesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã™ã€‚ã¾ãŸã€Helmã‚’ä½¿ç”¨ã—ãŸOpenTelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®å•é¡Œã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®çµŒé¨“ã‚‚å¾—ã‚‰ã‚Œã¾ã™ã€‚"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenTelemetryã€Dockerã€K8sã‚’å®Ÿè·µã§å­¦ã¶ :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯ã€ã“ã‚Œã‚‰ã®æ¦‚å¿µã‚’èª¬æ˜ã™ã‚‹ãŸã‚ã«ã‚·ãƒ³ãƒ—ãƒ«ãª.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã•ã‚ã€å§‹ã‚ã¾ã—ã‚‡ã†ï¼ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®çµ‚ã‚ã‚Šã¾ã§ã«ã€OpenTelemetryã‚’ä½¿ç”¨ã—ãŸ.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨ˆè£…ã®å®Ÿè·µçµŒé¨“ã‚’ç©ã¿ã€ãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®DockeråŒ–ãŠã‚ˆã³Kubernetesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã™ã€‚ã¾ãŸã€Helmã‚’ä½¿ç”¨ã—ãŸOpenTelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®å•é¡Œã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®çµŒé¨“ã‚‚å¾—ã‚‰ã‚Œã¾ã™ã€‚"><meta property="og:url" content="https://splunk.github.io/observability-workshop/ja/ninja-workshops/8-docker-k8s-otel/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="OpenTelemetryã€Dockerã€K8sã‚’å®Ÿè·µã§å­¦ã¶ :: Splunk Observability Cloud Workshops"><meta property="og:description" content="ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯ã€ã“ã‚Œã‚‰ã®æ¦‚å¿µã‚’èª¬æ˜ã™ã‚‹ãŸã‚ã«ã‚·ãƒ³ãƒ—ãƒ«ãª.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã•ã‚ã€å§‹ã‚ã¾ã—ã‚‡ã†ï¼ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®çµ‚ã‚ã‚Šã¾ã§ã«ã€OpenTelemetryã‚’ä½¿ç”¨ã—ãŸ.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨ˆè£…ã®å®Ÿè·µçµŒé¨“ã‚’ç©ã¿ã€ãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®DockeråŒ–ãŠã‚ˆã³Kubernetesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã™ã€‚ã¾ãŸã€Helmã‚’ä½¿ç”¨ã—ãŸOpenTelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®å•é¡Œã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®çµŒé¨“ã‚‚å¾—ã‚‰ã‚Œã¾ã™ã€‚"><meta property="og:locale" content="ja"><meta property="og:type" content="website"><meta itemprop=name content="OpenTelemetryã€Dockerã€K8sã‚’å®Ÿè·µã§å­¦ã¶ :: Splunk Observability Cloud Workshops"><meta itemprop=description content="ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯ã€ã“ã‚Œã‚‰ã®æ¦‚å¿µã‚’èª¬æ˜ã™ã‚‹ãŸã‚ã«ã‚·ãƒ³ãƒ—ãƒ«ãª.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã•ã‚ã€å§‹ã‚ã¾ã—ã‚‡ã†ï¼ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®çµ‚ã‚ã‚Šã¾ã§ã«ã€OpenTelemetryã‚’ä½¿ç”¨ã—ãŸ.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨ˆè£…ã®å®Ÿè·µçµŒé¨“ã‚’ç©ã¿ã€ãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®DockeråŒ–ãŠã‚ˆã³Kubernetesã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã™ã€‚ã¾ãŸã€Helmã‚’ä½¿ç”¨ã—ãŸOpenTelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®å•é¡Œã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®çµŒé¨“ã‚‚å¾—ã‚‰ã‚Œã¾ã™ã€‚"><meta itemprop=dateModified content="2025-06-17T14:05:11+09:00"><meta itemprop=wordCount content="29"><title>OpenTelemetryã€Dockerã€K8sã‚’å®Ÿè·µã§å­¦ã¶ :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/en/ninja-workshops/8-docker-k8s-otel/index.html rel=alternate hreflang=x-default><link href=https://splunk.github.io/observability-workshop/en/ninja-workshops/8-docker-k8s-otel/index.html rel=alternate hreflang=en><link href=https://splunk.github.io/observability-workshop/ja/ninja-workshops/8-docker-k8s-otel/index.html rel=alternate hreflang=ja><link href=https://splunk.github.io/observability-workshop/ja/ninja-workshops/8-docker-k8s-otel/index.html rel=canonical type=text/html title="OpenTelemetryã€Dockerã€K8sã‚’å®Ÿè·µã§å­¦ã¶ :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/images/favicon.ico?1765303813 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/css/auto-complete/auto-complete.min.css?1765303813 rel=stylesheet><script src=/observability-workshop/js/auto-complete/auto-complete.min.js?1765303813 defer></script><script src=/observability-workshop/js/search-lunr.min.js?1765303813 defer></script><script src=/observability-workshop/js/search.min.js?1765303813 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/searchindex.ja.js?1765303813"</script><script src=/observability-workshop/js/lunr/lunr.min.js?1765303813 defer></script><script src=/observability-workshop/js/lunr/lunr.stemmer.support.min.js?1765303813 defer></script><script src=/observability-workshop/js/lunr/lunr.multi.min.js?1765303813 defer></script><script src=/observability-workshop/js/lunr/tinyseg.js?1765303813 defer></script><script src=/observability-workshop/js/lunr/lunr.ja.min.js?1765303813 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["ja"]</script><link href=/observability-workshop/fonts/fontawesome/css/fontawesome-all.min.css?1765303813 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/fonts/fontawesome/css/fontawesome-all.min.css?1765303813 rel=stylesheet></noscript><link href=/observability-workshop/css/perfect-scrollbar/perfect-scrollbar.min.css?1765303813 rel=stylesheet><link href=/observability-workshop/css/theme.min.css?1765303813 rel=stylesheet><link href=/observability-workshop/css/format-print.min.css?1765303813 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/ninja-workshops/8-docker-k8s-otel/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼`,window.T_Copied_to_clipboard=`ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼!`,window.T_Copy_link_to_clipboard=`ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼`,window.T_Link_copied_to_clipboard=`ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ!`,window.T_Reset_view=`ãƒ“ãƒ¥ãƒ¼ã®ãƒªã‚»ãƒƒãƒˆ`,window.T_View_reset=`ãƒªã‚»ãƒƒãƒˆã‚’è¦‹ã‚‹`,window.T_No_results_found=`"{0}" ã®çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`,window.T_N_results_found=`"{0}" ã§ {1} ä»¶ã®çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({appplicationName:"observability-workshop",realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",recorder:"splunk",features:{video:!0}})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-url=/observability-workshop/ja/ninja-workshops/8-docker-k8s-otel/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleNav() type=button title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="ç›®æ¬¡ (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/ja/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/ja/ninja-workshops/index.html><span itemprop=name>Splunk4Ninjas Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>OpenTelemetryã€Dockerã€K8sã‚’å®Ÿè·µã§å­¦ã¶</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><a href=/observability-workshop/ja/ninja-workshops/8-docker-k8s-otel/index.print.html title="ç« å…¨ä½“ã‚’å°åˆ·ã™ã‚‹ (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><a href=/observability-workshop/ja/ninja-workshops/6-lambda-kinesis/7-summary/index.html title="çµè«– (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><a href=/observability-workshop/ja/ninja-workshops/8-docker-k8s-otel/1-connect-to-instance/index.html title="EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®æ¥ç¶š (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=æ›´ã«><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=opentelemetrydockerk8sã‚’å®Ÿè·µã§å­¦ã¶>OpenTelemetryã€Dockerã€K8sã‚’å®Ÿè·µã§å­¦ã¶</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Derek Mitchell</span></span><p>ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯ã€ä»¥ä¸‹ã®é …ç›®ã«ã¤ã„ã¦å®Ÿè·µçµŒé¨“ã‚’ç©ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼š</p><ul><li>Linux ãŠã‚ˆã³ Kubernetes ç’°å¢ƒã§ã€Splunk ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã® OpenTelemetry .NET ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨ˆè£…ã‚’å®Ÿè·µã—ã¾ã™ã€‚</li><li>.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€ŒDocker åŒ–ã€ã€Docker ã§ã®å®Ÿè¡Œã€ãã—ã¦ Splunk OpenTelemetry è¨ˆè£…ã®è¿½åŠ ã‚’å®Ÿè·µã—ã¾ã™ã€‚</li><li>Helm ã‚’ä½¿ç”¨ã—ãŸ K8s ç’°å¢ƒã§ã® Splunk ãƒ‡ã‚£ã‚¹ãƒˆãƒ­ã®ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè·µã—ã¾ã™ã€‚ãã®å¾Œã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã€å•é¡Œã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚</li></ul><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã‚’æœ€ã‚‚ç°¡å˜ã«ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã™ã‚‹æ–¹æ³•ã¯ä»¥ä¸‹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ï¼š</p><ul><li>ã“ã®ãƒšãƒ¼ã‚¸ã®å³ä¸Šã«ã‚ã‚‹å·¦å³ã®çŸ¢å°ï¼ˆ<strong>&lt;</strong> | <strong>></strong>ï¼‰</li><li>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å·¦ï¼ˆâ—€ï¸ï¼‰ã¨å³ï¼ˆâ–¶ï¸ï¼‰ã®ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><section><h1 class=a11y-only>OpenTelemetryã€Dockerã€K8sã‚’å®Ÿè·µã§å­¦ã¶ã®ã‚µãƒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³</h1><article class=default><header class=headline></header><h1 id=ec2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®æ¥ç¶š>EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®æ¥ç¶š</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=ec2-ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸æ¥ç¶š>EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸æ¥ç¶š</h2><p>å„å‚åŠ è€…ã®ãŸã‚ã«ã€AWS/EC2 ã« Ubuntu Linux ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚</p><p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã‹ã‚‰æä¾›ã•ã‚ŒãŸ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§ EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«æ¥ç¶šã—ã¦ãã ã•ã„ï¼š</p><ul><li>Mac OS / Linux<ul><li>ssh splunk@IP ã‚¢ãƒ‰ãƒ¬ã‚¹</li></ul></li><li>Windows 10+<ul><li>OpenSSH ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨</li></ul></li><li>ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® Windows<ul><li>Putty ã‚’ä½¿ç”¨</li></ul></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/16</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤>OpenTelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=opentelemetry-ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«>OpenTelemetry ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h2><p>EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¯ã€ã™ã§ã« Splunk Distribution ã® OpenTelemetry ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å…ˆã«é€²ã‚€å‰ã«ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ï¼š</p><div class=tab-panel data-tab-group=R-tabs-dbd72531ce1793761f28f776f6280ee4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d2bf21f2bf34f7a8c999bff8c3ca68f0 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-dbd72531ce1793761f28f776f6280ee4","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-5a95c1cd260b7e9d39c1467770ee24a8 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-dbd72531ce1793761f28f776f6280ee4","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-d2bf21f2bf34f7a8c999bff8c3ca68f0 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh<span class=p>;</span>
</span></span><span class=line><span class=cl>sudo sh /tmp/splunk-otel-collector.sh --uninstall</span></span></code></pre></div></div></div><div id=R-tab-id-5a95c1cd260b7e9d39c1467770ee24a8 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Reading package lists... Done
</span></span><span class=line><span class=cl>Building dependency tree... Done
</span></span><span class=line><span class=cl>Reading state information... Done
</span></span><span class=line><span class=cl>The following packages will be REMOVED:
</span></span><span class=line><span class=cl>  splunk-otel-collector*
</span></span><span class=line><span class=cl><span class=m>0</span> upgraded, <span class=m>0</span> newly installed, <span class=m>1</span> to remove and <span class=m>167</span> not upgraded.
</span></span><span class=line><span class=cl>After this operation, <span class=m>766</span> MB disk space will be freed.
</span></span><span class=line><span class=cl><span class=o>(</span>Reading database ... <span class=m>157441</span> files and directories currently installed.<span class=o>)</span>
</span></span><span class=line><span class=cl>Removing splunk-otel-collector <span class=o>(</span>0.92.0<span class=o>)</span> ...
</span></span><span class=line><span class=cl><span class=o>(</span>Reading database ... <span class=m>147373</span> files and directories currently installed.<span class=o>)</span>
</span></span><span class=line><span class=cl>Purging configuration files <span class=k>for</span> splunk-otel-collector <span class=o>(</span>0.92.0<span class=o>)</span> ...
</span></span><span class=line><span class=cl>Scanning processes...
</span></span><span class=line><span class=cl>Scanning candidates...
</span></span><span class=line><span class=cl>Scanning linux images...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Running kernel seems to be up-to-date.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Restarting services...
</span></span><span class=line><span class=cl> systemctl restart fail2ban.service falcon-sensor.service
</span></span><span class=line><span class=cl>Service restarts being deferred:
</span></span><span class=line><span class=cl> systemctl restart networkd-dispatcher.service
</span></span><span class=line><span class=cl> systemctl restart unattended-upgrades.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>No containers need to be restarted.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>No user sessions are running outdated binaries.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>No VM guests are running outdated hypervisor <span class=o>(</span>qemu<span class=o>)</span> binaries on this host.
</span></span><span class=line><span class=cl>Successfully removed the splunk-otel-collector package</span></span></code></pre></div></div></div></div></div><h2 id=opentelemetry-collector-ã®ãƒ‡ãƒ—ãƒ­ã‚¤>OpenTelemetry collector ã®ãƒ‡ãƒ—ãƒ­ã‚¤</h2><p>Linux EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã€Splunk Distribution ã® OpenTelemetry ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ã‚‡ã†ã€‚</p><p>ã“ã‚Œã¯<code>curl</code>ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒã‚¤ãƒŠãƒªã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ç‰¹å®šã®å¼•æ•°ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã§å¯èƒ½ã§ã™ã€‚
ã“ã‚Œã‚‰ã®å¼•æ•°ã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ realmã€ä½¿ç”¨ã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã€
ãŠã‚ˆã³ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã‚’ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«æŒ‡ç¤ºã—ã¾ã™ã€‚</p><blockquote><p>Splunk Observability Cloud ã«ãŠã‘ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã¨ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã¾ãŸã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å€‹åˆ¥ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã§ã‚ã‚Šã€åŒã˜ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä»–ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®è¨­å®šã¨é‡è¤‡ã—ãªã„è¨­å®šã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚</p></blockquote><div class=tab-panel data-tab-group=R-tabs-c1d753ff0601879d96c81b318050e6da><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-a499a1ce972fe7d8cfa104265d69884d aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c1d753ff0601879d96c81b318050e6da","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-aaae144c567e3c174e38c8b15db13c0f aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c1d753ff0601879d96c81b318050e6da","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-a499a1ce972fe7d8cfa104265d69884d data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--realm <span class=nv>$REALM</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--mode agent <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--without-instrumentation <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--deployment-environment otel-<span class=nv>$INSTANCE</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-- <span class=nv>$ACCESS_TOKEN</span></span></span></code></pre></div></div></div><div id=R-tab-id-aaae144c567e3c174e38c8b15db13c0f data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Splunk OpenTelemetry Collector Version: latest
</span></span><span class=line><span class=cl>Memory Size in MIB: <span class=m>512</span>
</span></span><span class=line><span class=cl>Realm: us1
</span></span><span class=line><span class=cl>Ingest Endpoint: https://ingest.us1.signalfx.com
</span></span><span class=line><span class=cl>API Endpoint: https://api.us1.signalfx.com
</span></span><span class=line><span class=cl>HEC Endpoint: https://ingest.us1.signalfx.com/v1/log
</span></span><span class=line><span class=cl>etc.</span></span></code></pre></div></div></div></div></div><p>è©³ç´°ã«ã¤ã„ã¦ã¯ã€<a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/collector-linux/install-linux.html#otel-install-linux rel=external>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ãŸ Linux ç”¨ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a>
ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><h2 id=ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå®Ÿè¡Œä¸­ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª>ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå®Ÿè¡Œä¸­ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª</h2><p>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</p><blockquote><p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒãƒ³ãƒ‰ã‚’çµ‚äº†ã™ã‚‹ã«ã¯ã€Ctrl + C ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><div class=tab-panel data-tab-group=R-tabs-c0dea386582701268766e4e2507fdacc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-56dc22099ee07062d5c1df98d7bdc7c2 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c0dea386582701268766e4e2507fdacc","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-eb33ded88947d2c344a85dcd7f3a2f01 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c0dea386582701268766e4e2507fdacc","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-56dc22099ee07062d5c1df98d7bdc7c2 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-eb33ded88947d2c344a85dcd7f3a2f01 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>â— splunk-otel-collector.service - Splunk OpenTelemetry Collector
</span></span><span class=line><span class=cl>     Loaded: loaded <span class=o>(</span>/lib/systemd/system/splunk-otel-collector.service<span class=p>;</span> enabled<span class=p>;</span> vendor preset: enabled<span class=o>)</span>
</span></span><span class=line><span class=cl>    Drop-In: /etc/systemd/system/splunk-otel-collector.service.d
</span></span><span class=line><span class=cl>             â””â”€service-owner.conf
</span></span><span class=line><span class=cl>     Active: active <span class=o>(</span>running<span class=o>)</span> since Fri 2024-12-20 00:13:14 UTC<span class=p>;</span> 45s ago
</span></span><span class=line><span class=cl>   Main PID: <span class=m>14465</span> <span class=o>(</span>otelcol<span class=o>)</span>
</span></span><span class=line><span class=cl>      Tasks: <span class=m>9</span> <span class=o>(</span>limit: 19170<span class=o>)</span>
</span></span><span class=line><span class=cl>     Memory: 117.4M
</span></span><span class=line><span class=cl>        CPU: 681ms
</span></span><span class=line><span class=cl>     CGroup: /system.slice/splunk-otel-collector.service
</span></span><span class=line><span class=cl>             â””â”€14465 /usr/bin/otelcol</span></span></code></pre></div></div></div></div></div><h2 id=ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•>ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•</h2><p><code>journalctl</code>ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ­ã‚°ã‚’è¡¨ç¤ºã§ãã¾ã™ï¼š</p><blockquote><p>ãƒ­ã‚°ã®ç›£è¦–ã‚’çµ‚äº†ã™ã‚‹ã«ã¯ã€Ctrl + C ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><div class=tab-panel data-tab-group=R-tabs-ae3f0403640989f629e02099f251830b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b54d93d3755da7b4f506ef4a299620b6 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-ae3f0403640989f629e02099f251830b","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-e68ef4c90911d6758be75e160137f6ed aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-ae3f0403640989f629e02099f251830b","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-b54d93d3755da7b4f506ef4a299620b6 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo journalctl -u splunk-otel-collector -f -n <span class=m>100</span></span></span></code></pre></div></div></div><div id=R-tab-id-e68ef4c90911d6758be75e160137f6ed data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 systemd<span class=o>[</span>1<span class=o>]</span>: Started Splunk OpenTelemetry Collector.
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:483: Set config to /etc/otel/collector/agent_config.yaml
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:539: Set memory limit to <span class=m>460</span> MiB
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:524: Set soft memory limit <span class=nb>set</span> to <span class=m>460</span> MiB
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:373: Set garbage collection target percentage <span class=o>(</span>GOGC<span class=o>)</span> to <span class=m>400</span>
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:414: <span class=nb>set</span> <span class=s2>&#34;SPLUNK_LISTEN_INTERFACE&#34;</span> to <span class=s2>&#34;127.0.0.1&#34;</span>
</span></span><span class=line><span class=cl>etc.</span></span></code></pre></div></div></div></div></div><h2 id=ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®è¨­å®š>ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®è¨­å®š</h2><p>ã“ã®ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒä½¿ç”¨ã—ã¦ã„ã‚‹è¨­å®šã¯ã©ã“ã§è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><p>ãã®è¨­å®šã¯<code>/etc/otel/collector</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚Šã¾ã™ã€‚ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’<code>agent</code>ãƒ¢ãƒ¼ãƒ‰ã§
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãŸã‚ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã¯<code>agent_config.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚Šã¾ã™ã€‚</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=netã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤>.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=å‰ææ¡ä»¶>å‰ææ¡ä»¶</h2><p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å‰ã«ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«.NET 8 SDK ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><div class=tab-panel data-tab-group=R-tabs-748ab4691760a445608d96a7ec308cb1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4157d25c5b6c154af06bd23084f4c143 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-748ab4691760a445608d96a7ec308cb1","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-4bb65f893b7dfdae024b2fc10597dfe3 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-748ab4691760a445608d96a7ec308cb1","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-4157d25c5b6c154af06bd23084f4c143 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  sudo apt-get install -y dotnet-sdk-8.0</span></span></code></pre></div></div></div><div id=R-tab-id-4bb65f893b7dfdae024b2fc10597dfe3 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Hit:1 http://us-west-1.ec2.archive.ubuntu.com/ubuntu jammy InRelease
</span></span><span class=line><span class=cl>Hit:2 http://us-west-1.ec2.archive.ubuntu.com/ubuntu jammy-updates InRelease
</span></span><span class=line><span class=cl>Hit:3 http://us-west-1.ec2.archive.ubuntu.com/ubuntu jammy-backports InRelease
</span></span><span class=line><span class=cl>Hit:4 http://security.ubuntu.com/ubuntu jammy-security InRelease
</span></span><span class=line><span class=cl>Ign:5 https://splunk.jfrog.io/splunk/otel-collector-deb release InRelease
</span></span><span class=line><span class=cl>Hit:6 https://splunk.jfrog.io/splunk/otel-collector-deb release Release
</span></span><span class=line><span class=cl>Reading package lists... Done
</span></span><span class=line><span class=cl>Reading package lists... Done
</span></span><span class=line><span class=cl>Building dependency tree... Done
</span></span><span class=line><span class=cl>Reading state information... Done
</span></span><span class=line><span class=cl>The following additional packages will be installed:
</span></span><span class=line><span class=cl>  aspnetcore-runtime-8.0 aspnetcore-targeting-pack-8.0 dotnet-apphost-pack-8.0 dotnet-host-8.0 dotnet-hostfxr-8.0 dotnet-runtime-8.0 dotnet-targeting-pack-8.0 dotnet-templates-8.0 liblttng-ust-common1
</span></span><span class=line><span class=cl>  liblttng-ust-ctl5 liblttng-ust1 netstandard-targeting-pack-2.1-8.0
</span></span><span class=line><span class=cl>The following NEW packages will be installed:
</span></span><span class=line><span class=cl>  aspnetcore-runtime-8.0 aspnetcore-targeting-pack-8.0 dotnet-apphost-pack-8.0 dotnet-host-8.0 dotnet-hostfxr-8.0 dotnet-runtime-8.0 dotnet-sdk-8.0 dotnet-targeting-pack-8.0 dotnet-templates-8.0
</span></span><span class=line><span class=cl>  liblttng-ust-common1 liblttng-ust-ctl5 liblttng-ust1 netstandard-targeting-pack-2.1-8.0
</span></span><span class=line><span class=cl><span class=m>0</span> upgraded, <span class=m>13</span> newly installed, <span class=m>0</span> to remove and <span class=m>0</span> not upgraded.
</span></span><span class=line><span class=cl>Need to get <span class=m>138</span> MB of archives.
</span></span><span class=line><span class=cl>After this operation, <span class=m>495</span> MB of additional disk space will be used.
</span></span><span class=line><span class=cl>etc.</span></span></code></pre></div></div></div></div></div><p>è©³ç´°ã«ã¤ã„ã¦ã¯ã€<a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux-ubuntu-install?tabs=dotnet8&pivots=os-linux-ubuntu-2404" rel=external>Ubuntu ã«.NET SDK ã¾ãŸã¯.NET Runtime ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a>
ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><h2 id=net-ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª>.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª</h2><p>ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/docker-k8s-otel/helloworld</span></span></code></pre></div><p>ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ãªã€ŒHello Worldã€.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä¸»è¦ãªãƒ­ã‚¸ãƒƒã‚¯ã¯
HelloWorldController.cs ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚Šã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HelloWorldController</span> <span class=p>:</span> <span class=n>ControllerBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>HelloWorldController</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HelloWorldController</span><span class=p>(</span><span class=n>ILogger</span><span class=p>&lt;</span><span class=n>HelloWorldController</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [HttpGet(&#34;/hello/{name?}&#34;)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Hello</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>IsNullOrEmpty</span><span class=p>(</span><span class=n>name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=n>logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>&#34;/hello endpoint invoked anonymously&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=s>&#34;Hello, World!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>&#34;/hello endpoint invoked by {name}&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>String</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;Hello, {0}!&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h2 id=net-ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ>.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ</h2><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-7f4eeedcea0e19ab2bb03fe389d9d70c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-f6bb69bdb43ae0bb5b3a59464ebb3654 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-7f4eeedcea0e19ab2bb03fe389d9d70c","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-6b97632adeda1a0178e910a9fd1a45ee aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-7f4eeedcea0e19ab2bb03fe389d9d70c","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-f6bb69bdb43ae0bb5b3a59464ebb3654 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet build</span></span></code></pre></div></div></div><div id=R-tab-id-6b97632adeda1a0178e910a9fd1a45ee data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>MSBuild version 17.8.5+b5265ef37 <span class=k>for</span> .NET
</span></span><span class=line><span class=cl>  Determining projects to restore...
</span></span><span class=line><span class=cl>  All projects are up-to-date <span class=k>for</span> restore.
</span></span><span class=line><span class=cl>  helloworld -&gt; /home/splunk/workshop/docker-k8s-otel/helloworld/bin/Debug/net8.0/helloworld.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Build succeeded.
</span></span><span class=line><span class=cl>    <span class=m>0</span> Warning<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=m>0</span> Error<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Time Elapsed 00:00:02.04</span></span></code></pre></div></div></div></div></div><p>ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ãŸã‚‰ã€æ¬¡ã®ã‚ˆã†ã«å®Ÿè¡Œã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-ba95965326e680055d304e4900a98f44><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-f9b08167523143b96d2cf51a254ef3ee aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-ba95965326e680055d304e4900a98f44","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-563527799225cee8b0a34f2e936a872a aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-ba95965326e680055d304e4900a98f44","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-f9b08167523143b96d2cf51a254ef3ee data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet run</span></span></code></pre></div></div></div><div id=R-tab-id-563527799225cee8b0a34f2e936a872a data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Building...
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime<span class=o>[</span>14<span class=o>]</span>
</span></span><span class=line><span class=cl>      Now listening on: http://localhost:8080
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      Application started. Press Ctrl+C to shut down.
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      Hosting environment: Development
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      Content root path: /home/splunk/workshop/docker-k8s-otel/helloworld</span></span></code></pre></div></div></div></div></div><p>å®Ÿè¡Œã—ãŸã‚‰ã€Ubuntu ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã® SSH æ¥ç¶šã‚’ 2 ã¤ç›®ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§é–‹ãã€curl ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-89281805f3700ca2fe49eb91c327ffdf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-9ff4b9a4f4e66e13133dabc073ef8f22 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-89281805f3700ca2fe49eb91c327ffdf","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-4a5a08ea20c41b44234a67a54de8381a aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-89281805f3700ca2fe49eb91c327ffdf","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-9ff4b9a4f4e66e13133dabc073ef8f22 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello</span></span></code></pre></div></div></div><div id=R-tab-id-4a5a08ea20c41b44234a67a54de8381a data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Hello, World!</span></span></code></pre></div></div></div></div></div><p>åå‰ã‚’æ¸¡ã™ã“ã¨ã‚‚ã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-6b3b4251dcb770bfb72a69e9a6756dcb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-cf1f3559bd2819ecc438b68ac2f07295 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-6b3b4251dcb770bfb72a69e9a6756dcb","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-58eee56bf6ce540b1c235c5ed9c425bb aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-6b3b4251dcb770bfb72a69e9a6756dcb","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-cf1f3559bd2819ecc438b68ac2f07295 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello/Tom</span></span></code></pre></div></div></div><div id=R-tab-id-58eee56bf6ce540b1c235c5ed9c425bb data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Hello, Tom!</span></span></code></pre></div></div></div></div></div><blockquote><p>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚€å‰ã«ã€Ctrl + C ã‚’æŠ¼ã—ã¦ Helloworld ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã—ã¦ãã ã•ã„ã€‚</p></blockquote><h2 id=æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h2><p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ OpenTelemetry ã§è¨ˆè£…ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ 3 ã¤ã®æ–¹æ³•ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><p><a href=#R-image-26ee47ee2ec25d4f55a225b1584fecde class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/NetInstrumentation.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-26ee47ee2ec25d4f55a225b1584fecde><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/NetInstrumentation.png></a></p><p>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€<a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/otel-dotnet/instrumentation/instrument-dotnet-application.html rel=external>Splunk Observability Cloud ç”¨ã®.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨ˆè£…</a>
ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetryã§netã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨ˆè£…ã™ã‚‹>OpenTelemetryã§.NETã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨ˆè£…ã™ã‚‹</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<h2 id=splunk-distribution-of-opentelemetry-ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰>Splunk Distribution of OpenTelemetry ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h2><p>ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯ã€NuGet ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã›ãšã€Splunk Distribution of OpenTelemetry ã‚’
æ‰‹å‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><p>æœ€æ–°ã®<code>splunk-otel-dotnet-install.sh</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚
ã“ã‚Œã‚’ä½¿ç”¨ã—ã¦.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨ˆè£…ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/docker-k8s-otel/helloworld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -sSfL https://github.com/signalfx/splunk-otel-dotnet/releases/latest/download/splunk-otel-dotnet-install.sh -O</span></span></code></pre></div><p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ã‚»ã‚¹ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€<a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/otel-dotnet/instrumentation/instrument-dotnet-application.html#install-the-splunk-distribution-of-opentelemetry-net-manually rel=external>Splunk Distribution of OpenTelemetry .NET ã®æ‰‹å‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a>
ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p><h2 id=ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«>ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h2><p>ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™</p><div class=tab-panel data-tab-group=R-tabs-cad19e7147a47b3e85664d2956350640><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-f6b81d379c46a5e35b077131c558361a aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-cad19e7147a47b3e85664d2956350640","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-bad7fdde9a066c6d097175743ba0b7d9 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-cad19e7147a47b3e85664d2956350640","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-f6b81d379c46a5e35b077131c558361a data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sh ./splunk-otel-dotnet-install.sh</span></span></code></pre></div></div></div><div id=R-tab-id-bad7fdde9a066c6d097175743ba0b7d9 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Downloading v1.8.0 <span class=k>for</span> linux-glibc <span class=o>(</span>/tmp/tmp.m3tSdtbmge/splunk-opentelemetry-dotnet-linux-glibc-x64.zip<span class=o>)</span>...</span></span></code></pre></div></div></div></div></div><blockquote><p>æ³¨æ„ï¼šä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹éš›ã«ã¯ã€ARCHITECTURE ç’°å¢ƒå¤‰æ•°ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ARCHITECTURE</span><span class=o>=</span>x64 sh ./splunk-otel-dotnet-install.sh</span></span></code></pre></div></blockquote><h2 id=è¨ˆè£…ã®æœ‰åŠ¹åŒ–>è¨ˆè£…ã®æœ‰åŠ¹åŒ–</h2><p>æ¬¡ã«ã€OpenTelemetry è¨ˆè£…ã‚’æœ‰åŠ¹åŒ–ã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. <span class=nv>$HOME</span>/.splunk-otel-dotnet/instrument.sh</span></span></code></pre></div><h2 id=ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã®è¨­å®š>ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã®è¨­å®š</h2><p>ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç’°å¢ƒã‚’è¨­å®šã—ã¦ã€ãƒ‡ãƒ¼ã‚¿ãŒ Splunk Observability Cloud å†…ã®ç‹¬è‡ªã®
ç’°å¢ƒã«æµã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span><span class=o>=</span>deployment.environment<span class=o>=</span>otel-<span class=nv>$INSTANCE</span></span></span></code></pre></div><h2 id=è¨ˆè£…ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ>è¨ˆè£…ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ</h2><p>ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet run</span></span></code></pre></div><h2 id=ãƒãƒ£ãƒ¬ãƒ³ã‚¸>ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h2><p>Linux ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ C#ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ã©ã®ã‚ˆã†ã«ç¢ºèªã§ãã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><details><summary><b>ç­”ãˆã‚’è¦‹ã‚‹ã«ã¯ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯</b></summary><p>ã“ã‚Œã‚’è¡Œã†æ–¹æ³•ã¯ 2 ã¤ã‚ã‚Šã¾ã™ï¼š</p><ol><li><code>dotnet run</code>ã‚³ãƒãƒ³ãƒ‰ã®é–‹å§‹æ™‚ã«<code>OTEL_TRACES_EXPORTER=otlp,console</code>ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒˆãƒ¬ãƒ¼ã‚¹ãŒ OTLP çµŒç”±ã§ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ã¨ã¨ã‚‚ã«ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚æ›¸ãè¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</li></ol><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>OTEL_TRACES_EXPORTER</span><span class=o>=</span>otlp,console dotnet run</span></span></code></pre></div><ol start=2><li>ã‚ã‚‹ã„ã¯ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã«ãƒ‡ãƒãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã‚’è¿½åŠ ã—ã€ãã‚Œã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒˆãƒ¬ãƒ¼ã‚¹ãŒã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ­ã‚°ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</li></ol><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>jaeger, otlp, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlphttp, signalfx, debug]</span></span></span></code></pre></div></details><h2 id=ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹</h2><p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œä¸­ã«ãªã£ãŸã‚‰ã€2 ã¤ç›®ã® SSH ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ä½¿ç”¨ã—ã¦ curl ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello</span></span></code></pre></div><p>ä»¥å‰ã¨åŒæ§˜ã«ã€<code>Hello, World!</code>ãŒè¿”ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚</p><p>ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒˆãƒ¬ãƒ¼ã‚¹ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¾ãŸã¯ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ­ã‚°ã«æ›¸ãè¾¼ã¾ã‚Œã¦ã„ã‚‹ã®ã‚’ç¢ºèªã§ãã‚‹ã¯ãšã§ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>info: Program<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      /hello endpoint invoked anonymously
</span></span><span class=line><span class=cl>Activity.TraceId:            c7bbf57314e4856447508cd8addd49b0
</span></span><span class=line><span class=cl>Activity.SpanId:             1c92ac653c3ece27
</span></span><span class=line><span class=cl>Activity.TraceFlags:         Recorded
</span></span><span class=line><span class=cl>Activity.ActivitySourceName: Microsoft.AspNetCore
</span></span><span class=line><span class=cl>Activity.DisplayName:        GET /hello/<span class=o>{</span>name?<span class=o>}</span>
</span></span><span class=line><span class=cl>Activity.Kind:               Server
</span></span><span class=line><span class=cl>Activity.StartTime:          2024-12-20T00:45:25.6551267Z
</span></span><span class=line><span class=cl>Activity.Duration:           00:00:00.0006464
</span></span><span class=line><span class=cl>Activity.Tags:
</span></span><span class=line><span class=cl>    server.address: localhost
</span></span><span class=line><span class=cl>    server.port: <span class=m>8080</span>
</span></span><span class=line><span class=cl>    http.request.method: GET
</span></span><span class=line><span class=cl>    url.scheme: http
</span></span><span class=line><span class=cl>    url.path: /hello
</span></span><span class=line><span class=cl>    network.protocol.version: 1.1
</span></span><span class=line><span class=cl>    user_agent.original: curl/7.81.0
</span></span><span class=line><span class=cl>    http.route: /hello/<span class=o>{</span>name?<span class=o>}</span>
</span></span><span class=line><span class=cl>    http.response.status_code: <span class=m>200</span>
</span></span><span class=line><span class=cl>Resource associated with Activity:
</span></span><span class=line><span class=cl>    splunk.distro.version: 1.8.0
</span></span><span class=line><span class=cl>    telemetry.distro.name: splunk-otel-dotnet
</span></span><span class=line><span class=cl>    telemetry.distro.version: 1.8.0
</span></span><span class=line><span class=cl>    service.name: helloworld
</span></span><span class=line><span class=cl>    os.type: linux
</span></span><span class=line><span class=cl>    os.description: Ubuntu 22.04.5 LTS
</span></span><span class=line><span class=cl>    os.build_id: 6.8.0-1021-aws
</span></span><span class=line><span class=cl>    os.name: Ubuntu
</span></span><span class=line><span class=cl>    os.version: 22.04
</span></span><span class=line><span class=cl>    host.name: derek-1
</span></span><span class=line><span class=cl>    host.id: 20cf15fcc7054b468647b73b8f87c556
</span></span><span class=line><span class=cl>    process.owner: splunk
</span></span><span class=line><span class=cl>    process.pid: <span class=m>16997</span>
</span></span><span class=line><span class=cl>    process.runtime.description: .NET 8.0.11
</span></span><span class=line><span class=cl>    process.runtime.name: .NET
</span></span><span class=line><span class=cl>    process.runtime.version: 8.0.11
</span></span><span class=line><span class=cl>    container.id: <span class=m>2</span>
</span></span><span class=line><span class=cl>    telemetry.sdk.name: opentelemetry
</span></span><span class=line><span class=cl>    telemetry.sdk.language: dotnet
</span></span><span class=line><span class=cl>    telemetry.sdk.version: 1.9.0
</span></span><span class=line><span class=cl>    deployment.environment: otel-derek-1</span></span></code></pre></div><h2 id=splunk-observability-cloud-ã§ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª>Splunk Observability Cloud ã§ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª</h2><p>ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ãŸã®ã§ã€ãƒˆãƒ¬ãƒ¼ã‚¹ãŒ<strong>Splunk Observability Cloud</strong>ã«é€ä¿¡ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆå›ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸå ´åˆã€ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§ã«æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</p><p>APM ã«ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã—ã€Environment ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã‚ãªãŸã®ç’°å¢ƒï¼ˆã¤ã¾ã‚Š<code>otel-instancename</code>ï¼‰ã‚’é¸æŠã—ã¾ã™ã€‚</p><p>ã™ã¹ã¦ãŒæ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒªã‚¹ãƒˆã«<code>helloworld</code>ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ï¼š</p><p><a href=#R-image-ec055fd2911cbaff6a2c7873244bdf65 class=lightbox-link><img alt="APM Overview" class="lazy lightbox figure-image" loading=lazy src=../images/apm_overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ec055fd2911cbaff6a2c7873244bdf65><img alt="APM Overview" class="lazy lightbox lightbox-image" loading=lazy src=../images/apm_overview.png></a></p><p>å³å´ã®<strong>Service Map</strong>ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p><p><a href=#R-image-99b84429f75583261676dc75a2b1ea78 class=lightbox-link><img alt="Service Map" class="lazy lightbox figure-image" loading=lazy src=../images/service_map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-99b84429f75583261676dc75a2b1ea78><img alt="Service Map" class="lazy lightbox lightbox-image" loading=lazy src=../images/service_map.png></a></p><p>æ¬¡ã«ã€å³å´ã®<strong>Traces</strong>ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚ŒãŸãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><p><a href=#R-image-3387aa870012d6694346ba82c38fcea6 class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3387aa870012d6694346ba82c38fcea6><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/traces.png></a></p><p>å€‹åˆ¥ã®ãƒˆãƒ¬ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ï¼š</p><p><a href=#R-image-afb13bc014eb8578d9389a45d53e5b46 class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-afb13bc014eb8578d9389a45d53e5b46><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/trace.png></a></p><blockquote><p>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚€å‰ã«ã€Ctrl + C ã‚’æŠ¼ã—ã¦ Helloworld ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã—ã¦ãã ã•ã„ã€‚</p></blockquote><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®dockeråŒ–>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®DockeråŒ–</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®å¾ŒåŠã§ã¯ã€.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚</p><p>ã—ã‹ã—ã€ã©ã®ã‚ˆã†ã«ãã‚Œã‚’è¡Œã†ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><p>æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã® Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã¯
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€ŒDocker åŒ–ã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ãŠã‚Šã€ãƒ—ãƒ­ã‚»ã‚¹ã¯<code>Dockerfile</code>ã®ä½œæˆã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚</p><p>ã—ã‹ã—ã€ã¾ãšé‡è¦ãªç”¨èªã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ã€‚</p><h2 id=é‡è¦ãªç”¨èª>é‡è¦ãªç”¨èª</h2><h3 id=docker-ã¨ã¯ä½•ã§ã™ã‹>Docker ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ</h3><blockquote><p>ã€ŒDocker ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã¨å‘¼ã°ã‚Œã‚‹ç·©ã„åˆ†é›¢ç’°å¢ƒã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã¦å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚åˆ†é›¢ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ã‚ˆã‚Šã€æŒ‡å®šã•ã‚ŒãŸãƒ›ã‚¹ãƒˆä¸Šã§åŒæ™‚ã«å¤šãã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã¯è»½é‡ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œã«å¿…è¦ãªã™ã¹ã¦ã‚’å«ã‚“ã§ã„ã‚‹ãŸã‚ã€ãƒ›ã‚¹ãƒˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã«ä¾å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã€</p></blockquote><p>ã‚½ãƒ¼ã‚¹: <a href=https://docs.docker.com/get-started/docker-overview/ rel=external>https://docs.docker.com/get-started/docker-overview/</a></p><h3 id=ã‚³ãƒ³ãƒ†ãƒŠã¨ã¯ä½•ã§ã™ã‹>ã‚³ãƒ³ãƒ†ãƒŠã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ</h3><blockquote><p>ã€Œã‚³ãƒ³ãƒ†ãƒŠã¯ã€ã‚¢ãƒ—ãƒªã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã”ã¨ã®åˆ†é›¢ã•ã‚ŒãŸãƒ—ãƒ­ã‚»ã‚¹ã§ã™ã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯&mldr;ç‹¬è‡ªã®åˆ†é›¢ã•ã‚ŒãŸç’°å¢ƒã§å®Ÿè¡Œã•ã‚Œã€ãƒã‚·ãƒ³ä¸Šã®ä»–ã®ã™ã¹ã¦ã®ã‚‚ã®ã‹ã‚‰å®Œå…¨ã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚ã€</p></blockquote><p>ã‚½ãƒ¼ã‚¹: <a href=https://docs.docker.com/get-started/docker-concepts/the-basics/what-is-a-container/ rel=external>https://docs.docker.com/get-started/docker-concepts/the-basics/what-is-a-container/</a></p><h3 id=ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã¯ä½•ã§ã™ã‹>ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ</h3><blockquote><p>ã€Œã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒã‚¤ãƒŠãƒªã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ãŠã‚ˆã³è¨­å®šã‚’å«ã‚€æ¨™æº–åŒ–ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚ã€</p></blockquote><h3 id=dockerfile>Dockerfile</h3><blockquote><p>ã€ŒDockerfile ã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã€ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã€èµ·å‹•ã‚³ãƒãƒ³ãƒ‰ãªã©ã«é–¢ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ€ãƒ¼ã¸ã®æŒ‡ç¤ºã‚’æä¾›ã—ã¾ã™ã€‚ã€</p></blockquote><h2 id=dockerfile-ã®ä½œæˆ>Dockerfile ã®ä½œæˆ</h2><p><code>/home/splunk/workshop/docker-k8s-otel/helloworld</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«<code>Dockerfile</code>ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk/workshop/docker-k8s-otel/helloworld</span></span></code></pre></div><p>ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã«ã¯ vi ã¾ãŸã¯ nano ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚vi ã‚’ä½¿ç”¨ã—ãŸä¾‹ã‚’ç¤ºã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi Dockerfile</span></span></code></pre></div><p>æ–°ã—ãé–‹ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ã¾ã™ï¼š</p><blockquote><p>ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã‚‹å‰ã«ã€vi ã§ã€Œiã€ã‚’æŠ¼ã—ã¦æŒ¿å…¥ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã£ã¦ãã ã•ã„ã€‚</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/aspnet:8.0 AS base</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/sdk:8.0 AS build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /src</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> <span class=o>[</span><span class=s2>&#34;helloworld.csproj&#34;</span>, <span class=s2>&#34;helloworld/&#34;</span><span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet restore <span class=s2>&#34;./helloworld/./helloworld.csproj&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;/src/helloworld&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet build <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> build AS publish</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet publish <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/publish /p:UseAppHost<span class=o>=</span>false<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>publish /app/publish .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;helloworld.dll&#34;</span><span class=p>]</span></span></span></code></pre></div><blockquote><p>vi ã§ã®å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€<code>esc</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã€<code>:wq!</code>ã¨å…¥åŠ›ã—ã¦ã‹ã‚‰<code>enter/return</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><p>ã“ã‚Œã¯ã™ã¹ã¦ä½•ã‚’æ„å‘³ã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿè©³ã—ãè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><h2 id=dockerfile-ã®è©³ç´°è§£èª¬>Dockerfile ã®è©³ç´°è§£èª¬</h2><p>ã“ã®ä¾‹ã§ã¯ã€ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ Dockerfile ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆãƒ—ãƒ­ã‚»ã‚¹ã‚’ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«åˆ†ã‘ã¦ã„ã¾ã™ï¼š</p><ul><li>Baseï¼ˆãƒ™ãƒ¼ã‚¹ï¼‰</li><li>Buildï¼ˆãƒ“ãƒ«ãƒ‰ï¼‰</li><li>Publishï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ï¼‰</li><li>Finalï¼ˆæœ€çµ‚ï¼‰</li></ul><p>ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã‚ˆã‚Šè¤‡é›‘ã§ã™ãŒã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆç”¨ã«ã‚ˆã‚Š
è»½é‡ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã§ã¯ã€
ã“ã‚Œã‚‰ã®å„ã‚¹ãƒ†ãƒ¼ã‚¸ã®ç›®çš„ã‚’èª¬æ˜ã—ã¾ã™ã€‚</p><h3 id=ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¸>ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¸</h3><p>ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯ã€ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å®šç¾©ã—ã€
ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒãƒ¼ãƒˆã‚’å…¬é–‹ã—ã¾ã™ã€‚
ã“ã‚Œã¯ Microsoft ã®<code>mcr.microsoft.com/dotnet/aspnet:8.0</code>ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/aspnet:8.0 AS base</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span></span></span></code></pre></div><p>ãªãŠã€<code>mcr.microsoft.com/dotnet/aspnet:8.0</code>ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã¯.NET runtime ã®ã¿ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€
SDK ã¯å«ã¾ã‚Œã¦ã„ãªã„ãŸã‚ã€æ¯”è¼ƒçš„è»½é‡ã§ã™ã€‚ã“ã‚Œã¯ Debian 12 Linux
distribution ãŒãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã¾ã™ã€‚ASP.NET Core Runtime Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è©³ç´°ã«ã¤ã„ã¦ã¯
<a href=https://github.com/dotnet/dotnet-docker/blob/main/README.aspnet.md rel=external>GitHub</a>ã§ç¢ºèªã§ãã¾ã™ã€‚</p><h3 id=build-ã‚¹ãƒ†ãƒ¼ã‚¸>Build ã‚¹ãƒ†ãƒ¼ã‚¸</h3><p>Dockerfile ã®æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ build ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã™ã€‚ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯ã€
<code>mcr.microsoft.com/dotnet/sdk:8.0</code>ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‚ Debian 12 ãŒãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã¾ã™ãŒã€
runtime ã ã‘ã§ãªãå®Œå…¨ãª<a href=https://github.com/dotnet/dotnet-docker/blob/main/README.sdk.md rel=external>.NET SDK</a>ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯<code>.csproj</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ build ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚³ãƒ”ãƒ¼ã—ã€ãã®å¾Œ<code>dotnet restore</code>ã‚’ä½¿ç”¨ã—ã¦
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½¿ç”¨ã™ã‚‹ä¾å­˜é–¢ä¿‚ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p><p>æ¬¡ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ build ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ã‚³ãƒ”ãƒ¼ã—ã€
<code>dotnet build</code>ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãã®ä¾å­˜é–¢ä¿‚ã‚’
<code>.dll</code>ãƒã‚¤ãƒŠãƒªã®ã‚»ãƒƒãƒˆã«ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/sdk:8.0 AS build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /src</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> <span class=o>[</span><span class=s2>&#34;helloworld.csproj&#34;</span>, <span class=s2>&#34;helloworld/&#34;</span><span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet restore <span class=s2>&#34;./helloworld/./helloworld.csproj&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;/src/helloworld&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet build <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/build</span></span></code></pre></div><h3 id=publish-ã‚¹ãƒ†ãƒ¼ã‚¸>Publish ã‚¹ãƒ†ãƒ¼ã‚¸</h3><p>3 ç•ªç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ publish ã§ã€ã“ã‚Œã¯ Microsoft ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã¯ãªã build ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã¯ã€<code>dotnet publish</code>ã‚’ä½¿ç”¨ã—ã¦
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãã®ä¾å­˜é–¢ä¿‚ã‚’ deployment ç”¨ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> build AS publish</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet publish <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/publish /p:UseAppHost<span class=o>=</span>false</span></span></code></pre></div><h3 id=final-ã‚¹ãƒ†ãƒ¼ã‚¸>Final ã‚¹ãƒ†ãƒ¼ã‚¸</h3><p>4 ç•ªç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã€ã“ã‚Œã¯ base
ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã¾ã™ï¼ˆbuild ã¨ publish ã‚¹ãƒ†ãƒ¼ã‚¸ã‚ˆã‚Šã‚‚è»½é‡ï¼‰ã€‚publish ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ã®å‡ºåŠ›ã‚’ã‚³ãƒ”ãƒ¼ã—ã€
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® entry point ã‚’å®šç¾©ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> base AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>publish /app/publish .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;helloworld.dll&#34;</span><span class=p>]</span></span></span></code></pre></div><h2 id=docker-ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰>Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰</h2><p><code>Dockerfile</code>ãŒã§ããŸã®ã§ã€ã“ã‚Œã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å«ã‚€ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’
ãƒ“ãƒ«ãƒ‰ã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-fbb15c82ce6982b13cb647f9182a18a8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2921a1865f47d4f20d3607b4807e5730 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-fbb15c82ce6982b13cb647f9182a18a8","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-4fd24dcf3afc2f0b1db8c9023a753edb aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-fbb15c82ce6982b13cb647f9182a18a8","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-2921a1865f47d4f20d3607b4807e5730 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t helloworld:1.0 .</span></span></code></pre></div></div></div><div id=R-tab-id-4fd24dcf3afc2f0b1db8c9023a753edb data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
</span></span><span class=line><span class=cl>            Install the buildx component to build images with BuildKit:
</span></span><span class=line><span class=cl>            https://docs.docker.com/go/buildx/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Sending build context to Docker daemon  281.1kB
</span></span><span class=line><span class=cl>Step 1/19 : FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
</span></span><span class=line><span class=cl>8.0: Pulling from dotnet/aspnet
</span></span><span class=line><span class=cl>af302e5c37e9: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>91ab5e0aabf0: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>1c1e4530721e: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>1f39ca6dcc3a: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>ea20083aa801: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>64c242a4f561: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>Digest: sha256:587c1dd115e4d6707ff656d30ace5da9f49cec48e627a40bbe5d5b249adc3549
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> mcr.microsoft.com/dotnet/aspnet:8.0
</span></span><span class=line><span class=cl> ---&gt; 0ee5d7ddbc3b
</span></span><span class=line><span class=cl>Step 2/19 : USER app
</span></span><span class=line><span class=cl>etc,</span></span></code></pre></div></div></div></div></div><p>ã“ã‚Œã¯ã€ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®<code>Dockerfile</code>ã‚’ä½¿ç”¨ã—ã¦<code>helloworld:1.0</code>ã®ã‚¿ã‚°ã§ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚ˆã† Docker ã«æŒ‡ç¤ºã—ã¾ã™ã€‚</p><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§æ­£å¸¸ã«ä½œæˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-696bd68f45988a9c62a2b3bc2c61fb32><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-7ebb208713741ebb820b7c8471541377 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-696bd68f45988a9c62a2b3bc2c61fb32","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-01eee1b005a92fd21c6ad7d15bad2319 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-696bd68f45988a9c62a2b3bc2c61fb32","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-7ebb208713741ebb820b7c8471541377 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images</span></span></code></pre></div></div></div><div id=R-tab-id-01eee1b005a92fd21c6ad7d15bad2319 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
</span></span><span class=line><span class=cl>helloworld   1.0       db19077b9445   <span class=m>20</span> seconds ago   217MB</span></span></code></pre></div></div></div></div></div><h2 id=docker-ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆ>Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆ</h2><blockquote><p>ç¶šè¡Œã™ã‚‹å‰ã«ã€ä»¥å‰ã«é–‹å§‹ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p></blockquote><p>Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --name helloworld <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--detach <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--expose <span class=m>8080</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--network<span class=o>=</span>host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>helloworld:1.0</span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼š<code>--network=host</code>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚ã¦ã€Docker ã‚³ãƒ³ãƒ†ãƒŠãŒ
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯å¾Œã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ
localhost ä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«é‡è¦ã§ã™ã€‚</p></blockquote><p>Docker ã‚³ãƒ³ãƒ†ãƒŠãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š</p><div class=tab-panel data-tab-group=R-tabs-b6e44071c9625d71185e6951e0514c3d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-9362b7328cad43cc1f61da8225735469 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b6e44071c9625d71185e6951e0514c3d","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-7015d4d44936c76cde18cfb5517ab723 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-b6e44071c9625d71185e6951e0514c3d","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-9362b7328cad43cc1f61da8225735469 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps</span></span></code></pre></div></div></div><div id=R-tab-id-7015d4d44936c76cde18cfb5517ab723 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE            COMMAND                  CREATED       STATUS       PORTS     NAMES
</span></span><span class=line><span class=cl>5f5b9cd56ac5   helloworld:1.0   <span class=s2>&#34;dotnet helloworld.dâ€¦&#34;</span>   <span class=m>2</span> mins ago    Up <span class=m>2</span> mins              helloworld</span></span></code></pre></div></div></div></div></div><p>ä»¥å‰ã¨åŒæ§˜ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-0ab9aaa1ea1ab43a890c299e960fc6e0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-a8430e6274d77bb29a5da324bb0f53c9 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-0ab9aaa1ea1ab43a890c299e960fc6e0","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-f49559b2615d61f009d81ba086813ae7 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-0ab9aaa1ea1ab43a890c299e960fc6e0","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-a8430e6274d77bb29a5da324bb0f53c9 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello/Docker</span></span></code></pre></div></div></div><div id=R-tab-id-f49559b2615d61f009d81ba086813ae7 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Hello, Docker!</span></span></code></pre></div></div></div></div></div><p>ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚ã“ã“ã¾ã§åˆ°é”ã—ãŸã¨ã„ã†ã“ã¨ã¯ã€.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® Docker åŒ–ã«æˆåŠŸã—ãŸã¨ã„ã†ã“ã¨ã§ã™ã€‚</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=dockerfileã«è¨ˆè£…ã‚’è¿½åŠ ã™ã‚‹>Dockerfileã«è¨ˆè£…ã‚’è¿½åŠ ã™ã‚‹</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ­£å¸¸ã« Docker åŒ–ã—ãŸã®ã§ã€æ¬¡ã« OpenTelemetry ã«ã‚ˆã‚‹è¨ˆè£… ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚</p><p>ã“ã‚Œã¯ã€Linux ã§å®Ÿè¡Œã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨ˆè£…ã—ãŸéš›ã®æ‰‹é †ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€
æ³¨æ„ã™ã¹ãã„ãã¤ã‹ã®é‡è¦ãªé•ã„ãŒã‚ã‚Šã¾ã™ã€‚</p><h2 id=dockerfile-ã®æ›´æ–°>Dockerfile ã®æ›´æ–°</h2><p><code>/home/splunk/workshop/docker-k8s-otel/helloworld</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®<code>Dockerfile</code>ã‚’æ›´æ–°ã—ã¾ã—ã‚‡ã†ã€‚</p><p>Dockerfile ã§.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸå¾Œã€ä»¥ä¸‹ã®æ“ä½œã‚’è¡Œã„ãŸã„ã¨æ€ã„ã¾ã™ï¼š</p><ul><li><code>splunk-otel-dotnet-install.sh</code>ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã™ã‚‹ãŸã‚ã«å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’è¿½åŠ ã™ã‚‹</li><li>Splunk OTel .NET ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</li><li>ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</li></ul><p>Dockerfile ã®ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¸ã«ä»¥ä¸‹ã‚’è¿½åŠ ã§ãã¾ã™ã€‚vi ã§ Dockerfile ã‚’é–‹ãã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/workshop/docker-k8s-otel/helloworld/Dockerfile</span></span></code></pre></div><blockquote><p>vi ã§ã¯ã€Œiã€ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã¾ã™
&lsquo;NEW CODE&rsquo;ã¨ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã‚‹è¡Œã‚’ Dockerfile ã®ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼š</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># CODE ALREADY IN YOUR DOCKERFILE:</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/sdk:8.0 AS build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /src</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> <span class=o>[</span><span class=s2>&#34;helloworld.csproj&#34;</span>, <span class=s2>&#34;helloworld/&#34;</span><span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet restore <span class=s2>&#34;./helloworld/./helloworld.csproj&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;/src/helloworld&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet build <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: add dependencies for splunk-otel-dotnet-install.sh</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> apt-get install -y unzip<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: download Splunk OTel .NET installer</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> curl -sSfL https://github.com/signalfx/splunk-otel-dotnet/releases/latest/download/splunk-otel-dotnet-install.sh -O<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: install the distribution</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> sh ./splunk-otel-dotnet-install.sh</span></span></code></pre></div><p>æ¬¡ã«ã€ä»¥ä¸‹ã®å¤‰æ›´ã§ Dockerfile ã®æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¾ã™ï¼š</p><ul><li>ãƒ“ãƒ«ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰æœ€çµ‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã«/root/.splunk-otel-dotnet/ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹</li><li>entrypoint.sh ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã‚³ãƒ”ãƒ¼ã™ã‚‹</li><li><code>OTEL_SERVICE_NAME</code>ã¨<code>OTEL_RESOURCE_ATTRIBUTES</code>ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹</li><li><code>ENTRYPOINT</code>ã‚’<code>entrypoint.sh</code>ã«è¨­å®šã™ã‚‹</li></ul><p>æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ã¯ã€æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¸å…¨ä½“ã‚’ä»¥ä¸‹ã®å†…å®¹ã§ç½®ãæ›ãˆã‚‹ã“ã¨ã§ã™ï¼š</p><blockquote><p><strong>é‡è¦</strong> Dockerfile ã®<code>$INSTANCE</code>ã‚’ã‚ãªãŸã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã¯<code>echo $INSTANCE</code>ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ç¢ºèªã§ãã¾ã™ã€‚</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># CODE ALREADY IN YOUR DOCKERFILE</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: Copy instrumentation file tree</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;//home/app/.splunk-otel-dotnet&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>build /root/.splunk-otel-dotnet/ .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># CODE ALREADY IN YOUR DOCKERFILE</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>publish /app/publish .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: copy the entrypoint.sh script</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> entrypoint.sh .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: set OpenTelemetry environment variables</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>OTEL_SERVICE_NAME</span><span class=o>=</span>helloworld
</span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span><span class=o>=</span><span class=s1>&#39;deployment.environment=otel-$INSTANCE&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: replace the prior ENTRYPOINT command with the following two lines</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span> <span class=s2>&#34;entrypoint.sh&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;helloworld.dll&#34;</span><span class=p>]</span></span></span></code></pre></div><blockquote><p>vi ã§ã®å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€<code>esc</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã€<code>:wq!</code>ã¨å…¥åŠ›ã—ã¦ã‹ã‚‰<code>enter/return</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><p>ã“ã‚Œã‚‰ã™ã¹ã¦ã®å¤‰æ›´ã®å¾Œã€Dockerfile ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã™ï¼š</p><blockquote><p><strong>é‡è¦</strong> ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è‡ªåˆ†ã® Dockerfile ã«ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã™ã‚‹å ´åˆã¯ã€
Dockerfile ã®<code>$INSTANCE</code>ã‚’ã‚ãªãŸã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã¯<code>echo $INSTANCE</code>ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ç¢ºèªã§ãã¾ã™ã€‚</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/aspnet:8.0 AS base</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/sdk:8.0 AS build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /src</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> <span class=o>[</span><span class=s2>&#34;helloworld.csproj&#34;</span>, <span class=s2>&#34;helloworld/&#34;</span><span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet restore <span class=s2>&#34;./helloworld/./helloworld.csproj&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;/src/helloworld&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet build <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: add dependencies for splunk-otel-dotnet-install.sh</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> apt-get install -y unzip<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: download Splunk OTel .NET installer</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> curl -sSfL https://github.com/signalfx/splunk-otel-dotnet/releases/latest/download/splunk-otel-dotnet-install.sh -O<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: install the distribution</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> sh ./splunk-otel-dotnet-install.sh<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> build AS publish</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet publish <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/publish /p:UseAppHost<span class=o>=</span>false<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: Copy instrumentation file tree</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;//home/app/.splunk-otel-dotnet&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>build /root/.splunk-otel-dotnet/ .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>publish /app/publish .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: copy the entrypoint.sh script</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> entrypoint.sh .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: set OpenTelemetry environment variables</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>OTEL_SERVICE_NAME</span><span class=o>=</span>helloworld
</span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span><span class=o>=</span><span class=s1>&#39;deployment.environment=otel-$INSTANCE&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: replace the prior ENTRYPOINT command with the following two lines</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span> <span class=s2>&#34;entrypoint.sh&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;helloworld.dll&#34;</span><span class=p>]</span></span></span></code></pre></div><h2 id=entrypointsh-ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ>entrypoint.sh ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ</h2><p>ã¾ãŸã€<code>/home/splunk/workshop/docker-k8s-otel/helloworld</code>ãƒ•ã‚©ãƒ«ãƒ€ã«<code>entrypoint.sh</code>ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’
ä»¥ä¸‹ã®å†…å®¹ã§ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/workshop/docker-k8s-otel/helloworld/entrypoint.sh</span></span></code></pre></div><p>æ¬¡ã«ã€æ–°ã—ãä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># Read in the file of environment settings</span>
</span></span><span class=line><span class=cl>. /<span class=nv>$HOME</span>/.splunk-otel-dotnet/instrument.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Then run the CMD</span>
</span></span><span class=line><span class=cl><span class=nb>exec</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span></span></span></code></pre></div><blockquote><p>vi ã§ã®å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€<code>esc</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã€<code>:wq!</code>ã¨å…¥åŠ›ã—ã¦ã‹ã‚‰<code>enter/return</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><p><code>entrypoint.sh</code>ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€è¨ˆè£…ã«å«ã¾ã‚Œã‚‹ instrument.sh ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç’°å¢ƒå¤‰æ•°ã‚’<strong>ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã«</strong>å–å¾—ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾ã—ã¦ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã“ã¨ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚</p><blockquote><p>ã€Œãªãœ Linux ãƒ›ã‚¹ãƒˆä¸Šã§ OpenTelemetry .NET instrumentation ã‚’æœ‰åŠ¹åŒ–ã—ãŸã¨ãã®ã‚ˆã†ã«ã€
Dockerfile ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å«ã‚ã‚‹ã ã‘ã§ã¯ã ã‚ãªã®ã‹ï¼Ÿã€ã¨ç–‘å•ã«æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>RUN</span> . <span class=nv>$HOME</span>/.splunk-otel-dotnet/instrument.sh</span></span></code></pre></div><p>ã“ã®æ–¹æ³•ã®å•é¡Œç‚¹ã¯ã€å„ Dockerfile RUN ã‚¹ãƒ†ãƒƒãƒ—ãŒæ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã¨æ–°ã—ã„ã‚·ã‚§ãƒ«ã§å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã§ã™ã€‚
ã‚ã‚‹ã‚·ã‚§ãƒ«ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã‚ˆã†ã¨ã—ã¦ã‚‚ã€å¾Œã§è¦‹ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
ã“ã®å•é¡Œã¯ã€ã“ã“ã§è¡Œã£ãŸã‚ˆã†ã«ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§è§£æ±ºã•ã‚Œã¾ã™ã€‚
ã“ã®å•é¡Œã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€ã“ã¡ã‚‰ã®<a href=https://stackoverflow.com/questions/55921914/how-to-source-a-script-with-environment-variables-in-a-docker-build-process rel=external>Stack Overflow ã®æŠ•ç¨¿</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p></blockquote><h2 id=docker-ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰>Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰</h2><p>OpenTelemetry .NET instrumentation ã‚’å«ã‚€æ–°ã—ã„ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t helloworld:1.1 .</span></span></code></pre></div><blockquote><p>æ³¨ï¼šä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨åŒºåˆ¥ã™ã‚‹ãŸã‚ã«ã€ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆ1.1ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠ ID ã‚’å–å¾—ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps -a</span></span></code></pre></div><p>æ¬¡ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rm &lt;old container id&gt; --force</span></span></code></pre></div><p>æ¬¡ã«ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ ID ã‚’å–å¾—ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images <span class=p>|</span> grep 1.0</span></span></code></pre></div><p>æœ€å¾Œã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å¤ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤ã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker image rm &lt;old image id&gt;</span></span></code></pre></div></blockquote><h2 id=ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ</h2><p>æ–°ã—ã„ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --name helloworld <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--detach <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--expose <span class=m>8080</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--network<span class=o>=</span>host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>helloworld:1.1</span></span></code></pre></div><p>ä»¥ä¸‹ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello</span></span></code></pre></div><p>ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ•°å›å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚</p><p>1 åˆ†ã»ã©çµŒéã—ãŸã‚‰ã€Splunk Observability Cloud ã«æ–°ã—ã„ãƒˆãƒ¬ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><blockquote><p>ã‚ãªãŸã®ç‰¹å®šã®ç’°å¢ƒã§ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’æ¢ã™ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚</p></blockquote><h2 id=ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°>ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2><p>Splunk Observability Cloud ã«ãƒˆãƒ¬ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>ã¾ãšã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ç”¨ã«é–‹ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>æ¬¡ã«ã€ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ãƒ‡ãƒãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒˆãƒ¬ãƒ¼ã‚¹ãŒã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ­ã‚°ã«æ›¸ãè¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, http_forwarder, zpages, smartagent]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>jaeger, otlp, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># NEW CODE: ãƒ‡ãƒãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã‚’ã“ã“ã«è¿½åŠ </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlphttp, signalfx, debug]</span></span></span></code></pre></div><p>ãã®å¾Œã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’å†èµ·å‹•ã—ã¦è¨­å®šå¤‰æ›´ã‚’é©ç”¨ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p><code>journalctl</code>ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ­ã‚°ã‚’è¡¨ç¤ºã§ãã¾ã™ï¼š</p><blockquote><p>ãƒ­ã‚°ã®è¿½è·¡ã‚’çµ‚äº†ã™ã‚‹ã«ã¯ã€Ctrl + C ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo journalctl -u splunk-otel-collector -f -n <span class=m>100</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=k8sã§opentelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«>K8sã§OpenTelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<h2 id=ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ãƒ‘ãƒ¼ãƒˆ-1-ã®æŒ¯ã‚Šè¿”ã‚Š>ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ãƒ‘ãƒ¼ãƒˆ 1 ã®æŒ¯ã‚Šè¿”ã‚Š</h2><p>ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®ã“ã®æ™‚ç‚¹ã§ã€ä»¥ä¸‹ã‚’æ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼š</p><ul><li>Linux ãƒ›ã‚¹ãƒˆã« Splunk distribution of OpenTelemetry ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤</li><li>Splunk Observability Cloud ã«ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†è¨­å®š</li><li>.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€OpenTelemetry ã§è¨ˆè£…</li><li>.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Docker åŒ–ã—ã€o11y cloud ã«ãƒˆãƒ¬ãƒ¼ã‚¹ãŒæµã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª</li></ul><p>ä¸Šè¨˜ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’<strong>å®Œäº†ã—ã¦ã„ãªã„</strong>å ´åˆã¯ã€ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®æ®‹ã‚Šã®éƒ¨åˆ†ã«é€²ã‚€å‰ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /home/splunk/workshop/docker-k8s-otel/docker/Dockerfile /home/splunk/workshop/docker-k8s-otel/helloworld/
</span></span><span class=line><span class=cl>cp /home/splunk/workshop/docker-k8s-otel/docker/entrypoint.sh /home/splunk/workshop/docker-k8s-otel/helloworld/</span></span></code></pre></div><blockquote><p><strong>é‡è¦</strong> ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚³ãƒ”ãƒ¼ã•ã‚ŒãŸã‚‰ã€<code>/home/splunk/workshop/docker-k8s-otel/helloworld/Dockerfile</code> ã‚’
ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã§é–‹ãã€Dockerfile ã® <code>$INSTANCE</code> ã‚’ã‚ãªãŸã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã¯ <code>echo $INSTANCE</code> ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ç¢ºèªã§ãã¾ã™ã€‚</p></blockquote><h2 id=ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ãƒ‘ãƒ¼ãƒˆ-2-ã®ç´¹ä»‹>ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ãƒ‘ãƒ¼ãƒˆ 2 ã®ç´¹ä»‹</h2><p>ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®æ¬¡ã®éƒ¨åˆ†ã§ã¯ã€Kubernetes ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚
ãã®ãŸã‚ã€Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã« Splunk distribution of OpenTelemetry ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’
ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>ã¾ãšã€ã„ãã¤ã‹ã®é‡è¦ãªç”¨èªã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ã€‚</p><h3 id=é‡è¦ãªç”¨èª>é‡è¦ãªç”¨èª</h3><h4 id=kubernetes-ã¨ã¯ä½•ã§ã™ã‹>Kubernetes ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ</h4><p><em>ã€ŒKubernetes ã¯ã€å®£è¨€çš„ãªè¨­å®šã¨è‡ªå‹•åŒ–ã®ä¸¡æ–¹ã‚’ä¿ƒé€²ã™ã‚‹ã€ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒãƒ¼ã‚¿ãƒ–ãƒ«ã§æ‹¡å¼µå¯èƒ½ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚ã€</em></p><p>Source: <a href=https://kubernetes.io/docs/concepts/overview/ rel=external>https://kubernetes.io/docs/concepts/overview/</a></p><p>Dockerfile ã«å°ã•ãªä¿®æ­£ã‚’åŠ ãˆãŸå¾Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã«ä»¥å‰ãƒ“ãƒ«ãƒ‰ã—ãŸ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’
Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚</p><h4 id=helm-ã¨ã¯ä½•ã§ã™ã‹>Helm ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ</h4><p>Helm ã¯ Kubernetes ç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã™ã€‚</p><p><em>ã€Œæœ€ã‚‚è¤‡é›‘ãª Kubernetes ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã ã¨ã—ã¦ã‚‚ã€å®šç¾©ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å½¹ç«‹ã¡ã¾ã™ã€</em></p><h4 id=helm-ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«>Helm ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h4><p>ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå†…ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã§ã¯ãªãã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ç‹¬è‡ªã®
<code>helm</code>ã‚³ãƒãƒ³ãƒ‰ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚</p><p>ã¾ãšã€helm ãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼šã¾ã™ã€‚ã€</p><p>Source: <a href=https://helm.sh/ rel=external>https://helm.sh/</a></p><p>Helm ã‚’ä½¿ç”¨ã—ã¦ K8s ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã« OpenTelemetry ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚</p><h4 id=helm-ã®åˆ©ç‚¹>Helm ã®åˆ©ç‚¹</h4><ul><li>è¤‡é›‘æ€§ã®ç®¡ç†<ul><li>æ•°åã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªãã€å˜ä¸€ã® values.yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†</li></ul></li><li>ç°¡å˜ãªæ›´æ–°<ul><li>ã‚¤ãƒ³ãƒ—ãƒ¬ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</li></ul></li><li>ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚µãƒãƒ¼ãƒˆ<ul><li>helm rollback ã‚’ä½¿ç”¨ã—ã¦ãƒªãƒªãƒ¼ã‚¹ã®å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯</li></ul></li></ul><h2 id=ãƒ›ã‚¹ãƒˆã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«>ãƒ›ã‚¹ãƒˆã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h2><p>å…ˆã«é€²ã‚€å‰ã«ã€Linux ãƒ›ã‚¹ãƒˆã«å…ˆã»ã©ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ã‚‡ã†ï¼š
\</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh<span class=p>;</span>
</span></span><span class=line><span class=cl>sudo sh /tmp/splunk-otel-collector.sh --uninstall</span></span></code></pre></div><h2 id=helm-ã‚’åˆ©ç”¨ã—ã¦-collector-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹>Helm ã‚’åˆ©ç”¨ã—ã¦ Collector ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h2><p>ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã®ä»£ã‚ã‚Šã«ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¦ collector ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p><p>ã¾ãšåˆã‚ã«ã€Helm ãƒªãƒã‚¸ãƒˆãƒªã«ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart</span></span></code></pre></div><p>ãƒªãƒã‚¸ãƒˆãƒªãŒæœ€æ–°ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo update</span></span></code></pre></div><p>helm ãƒãƒ£ãƒ¼ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ã€<code>/home/splunk</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«<code>values.yaml</code>ã¨ã„ã†åå‰ã®æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># swith to the /home/splunk dir</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /home/splunk
</span></span><span class=line><span class=cl><span class=c1># create a values.yaml file in vi</span>
</span></span><span class=line><span class=cl>vi values.yaml</span></span></code></pre></div><blockquote><p>Press â€˜iâ€™ to enter into insert mode in vi before pasting the text below.ã€€&ldquo;i"ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ vi ã¯ã‚¤ãƒ³ã‚µãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚ãƒšãƒ¼ã‚¹ãƒˆå‰ã«æŠ¼ä¸‹ã—ã¦ãã ã•ã„</p></blockquote><p>ãã—ã¦ã€ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>root_path</span><span class=p>:</span><span class=w> </span><span class=l>/hostfs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>disk</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>exclude_mount_points</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>match_type</span><span class=p>:</span><span class=w> </span><span class=l>regexp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mount_points</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/var/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/snap/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/boot/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/boot</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/opt/orbstack/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/mnt/machines/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/Users/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>load</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>network</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>paging</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>processes</span><span class=p>:</span><span class=w> </span><span class=kc>null</span></span></span></code></pre></div><blockquote><p>vi ã§ã®å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€<code>esc</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã€<code>:wq!</code>ã¨å…¥åŠ›ã—ã¦ã‹ã‚‰<code>enter/return</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><p>æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-87c05e571bf00d7cc4ab868675a7b7e1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-0d731341be6727ed0e84f48d2b09a97a aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-87c05e571bf00d7cc4ab868675a7b7e1","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-2103bf52850cd0c1ed3e2b6a160c839b aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-87c05e571bf00d7cc4ab868675a7b7e1","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-0d731341be6727ed0e84f48d2b09a97a data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  helm install splunk-otel-collector --version 0.136.0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=otel-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f values.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-2103bf52850cd0c1ed3e2b6a160c839b data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri Dec <span class=m>20</span> 01:01:43 <span class=m>2024</span>
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>1</span>
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm us1.</span></span></code></pre></div></div></div></div></div><h2 id=ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå®Ÿè¡Œä¸­ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª>ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå®Ÿè¡Œä¸­ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª</h2><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-065f6c89e65094c5801be22ba954d2dd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-84a6453f361b27c2abf2985c1256da51 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-065f6c89e65094c5801be22ba954d2dd","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-4f4cc2c609bdf9abd7bbac0388f91f9b aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-065f6c89e65094c5801be22ba954d2dd","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-84a6453f361b27c2abf2985c1256da51 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div id=R-tab-id-4f4cc2c609bdf9abd7bbac0388f91f9b data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                                                         READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-8xvk8                            1/1     Running   <span class=m>0</span>          49s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-d54857c89-tx7qr   1/1     Running   <span class=m>0</span>          49s</span></span></code></pre></div></div></div></div></div><h2 id=o11y-cloud-ã§-k8s-ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ç¢ºèª>O11y Cloud ã§ K8s ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ç¢ºèª</h2><p>Splunk Observability Cloud ã§ã€<strong>Infrastructure</strong> -> <strong>Kubernetes</strong> -> <strong>Kubernetes Clusters</strong>ã«ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã—ã€
ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åï¼ˆ<code>$INSTANCE-cluster</code>ï¼‰ã‚’æ¤œç´¢ã—ã¾ã™ï¼š</p><p><a href=#R-image-fee52e7d53772486929977d53c41d061 class=lightbox-link><img alt="Kubernetes node" class="lazy lightbox figure-image" loading=lazy src=../images/k8snode.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fee52e7d53772486929977d53c41d061><img alt="Kubernetes node" class="lazy lightbox lightbox-image" loading=lazy src=../images/k8snode.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/09/08</span></span></footer></article><article class=default><header class=headline></header><h1 id=ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’k8sã«ãƒ‡ãƒ—ãƒ­ã‚¤>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’K8sã«ãƒ‡ãƒ—ãƒ­ã‚¤</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<h2 id=dockerfile-ã®æ›´æ–°>Dockerfile ã®æ›´æ–°</h2><p>Kubernetes ã§ã¯ã€ç’°å¢ƒå¤‰æ•°ã¯é€šå¸¸ã€Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã«çµ„ã¿è¾¼ã‚€ã®ã§ã¯ãªã<code>.yaml</code>ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚ãã“ã§ã€Dockerfile ã‹ã‚‰ä»¥ä¸‹ã® 2 ã¤ã®ç’°å¢ƒå¤‰æ•°ã‚’å‰Šé™¤ã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/workshop/docker-k8s-otel/helloworld/Dockerfile</span></span></code></pre></div><p>æ¬¡ã«ã€ä»¥ä¸‹ã® 2 ã¤ã®ç’°å¢ƒå¤‰æ•°ã‚’å‰Šé™¤ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>OTEL_SERVICE_NAME</span><span class=o>=</span>helloworld
</span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span><span class=o>=</span><span class=s1>&#39;deployment.environment=otel-$INSTANCE&#39;</span></span></span></code></pre></div><blockquote><p>vi ã§ã®å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€<code>esc</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã€<code>:wq!</code>ã¨å…¥åŠ›ã—ã¦ã‹ã‚‰<code>enter/return</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><h2 id=æ–°ã—ã„-docker-ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰>æ–°ã—ã„ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰</h2><p>ç’°å¢ƒå¤‰æ•°ã‚’é™¤å¤–ã—ãŸæ–°ã—ã„ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk/workshop/docker-k8s-otel/helloworld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker build -t helloworld:1.2 .</span></span></code></pre></div><blockquote><p>Note: we&rsquo;ve used a different version (1.2) to distinguish the image from our earlier version.
To clean up the older versions, run the following command to get the container id:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps -a</span></span></code></pre></div><p>Then run the following command to delete the container:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rm &lt;old container id&gt; --force</span></span></code></pre></div><p>Now we can get the container image id:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images <span class=p>|</span> grep 1.1</span></span></code></pre></div><p>Finally, we can run the following command to delete the old image:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker image rm &lt;old image id&gt;</span></span></code></pre></div></blockquote><h2 id=docker-ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’-kubernetes-ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ>Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ Kubernetes ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h2><p>é€šå¸¸ã§ã‚ã‚Œã°ã€Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ Docker Hub ãªã©ã®ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚
ã—ã‹ã—ã€ä»Šå›ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯ã€k3s ã«ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å›é¿ç­–ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Import the image into k3d</span>
</span></span><span class=line><span class=cl>sudo k3d image import helloworld:1.2 --cluster <span class=nv>$INSTANCE</span>-cluster</span></span></code></pre></div><h2 id=net-ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤>.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤</h2><blockquote><p>ãƒ’ãƒ³ãƒˆï¼švi ã§ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚‹ã«ã¯ã€Œiã€ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚å¤‰æ›´ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ã€<code>esc</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã€<code>:wq!</code>ã¨å…¥åŠ›ã—ã¦ã‹ã‚‰<code>enter/return</code>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚</p></blockquote><p>.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ K8s ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã«ã€<code>/home/splunk</code>ã«<code>deployment.yaml</code>ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/deployment.yaml</span></span></code></pre></div><p>ãã—ã¦ä»¥ä¸‹ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/library/helloworld:1.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span></span></span></code></pre></div><details class="box cstyle notices tip expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<i class="fa-fw fas fa-lightbulb"></i>
Kubernetes ã«ãŠã‘ã‚‹ Deployment ã¨ã¯ï¼Ÿ</summary><div class=box-content><p>deployment.yaml ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€deployment ãƒªã‚½ãƒ¼ã‚¹ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ kubernetes è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ Kubernetes ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®åŸºç›¤ã¨ãªã‚Šã¾ã™ï¼deployment è¨­å®šã¯ deployment ã® <strong><em>æœ›ã¾ã—ã„çŠ¶æ…‹</em></strong> ã‚’å®šç¾©ã—ã€Kubernetes ãŒ <strong><em>å®Ÿéš›ã®çŠ¶æ…‹</em></strong> ãŒãã‚Œã¨ä¸€è‡´ã™ã‚‹ã‚ˆã†ä¿è¨¼ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ pod ã®è‡ªå·±ä¿®å¾©ãŒå¯èƒ½ã«ãªã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç°¡å˜ãªæ›´æ–°ã‚„ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p></div></details><p>æ¬¡ã«ã€åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«<code>service.yaml</code>ã¨ã„ã†åå‰ã® 2 ã¤ç›®ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/service.yaml</span></span></code></pre></div><p>ãã—ã¦ä»¥ä¸‹ã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span></span></span></code></pre></div><details class="box cstyle notices tip expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<i class="fa-fw fas fa-lightbulb"></i>
Kubernetes ã«ãŠã‘ã‚‹ Service ã¨ã¯ï¼Ÿ</summary><div class=box-content><p>Kubernetes ã® Service ã¯æŠ½è±¡åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚ã‚Šã€ä»²ä»‹è€…ã®ã‚ˆã†ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚Pod ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®å›ºå®š IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ DNS åã‚’æä¾›ã—ã€æ™‚é–“ã®çµŒéã¨ã¨ã‚‚ã« Pod ãŒè¿½åŠ ã€å‰Šé™¤ã€ã¾ãŸã¯äº¤æ›ã•ã‚Œã¦ã‚‚åŒã˜ã¾ã¾ã§ã™ã€‚</p></div></details><p>ã“ã‚Œã‚‰ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-a43db78916c3a6c518f1b91923415205><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-86bfda41fa814cb7804f473f1b46a7f2 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a43db78916c3a6c518f1b91923415205","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-37fd1bde453420f2379a8721a5b86544 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a43db78916c3a6c518f1b91923415205","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-86bfda41fa814cb7804f473f1b46a7f2 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># create the deployment</span>
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># create the service</span>
</span></span><span class=line><span class=cl>kubectl apply -f service.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-37fd1bde453420f2379a8721a5b86544 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/helloworld created
</span></span><span class=line><span class=cl>service/helloworld created</span></span></code></pre></div></div></div></div></div><h2 id=ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆ</h2><p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€ã¾ãš IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-13ee530b1c9eb1816ce9a4142a6ca889><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-0d8861c5abbb0e414397623dfe7de584 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-13ee530b1c9eb1816ce9a4142a6ca889","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-2b84c53bf36a5a29658d978a90eb2c75 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-13ee530b1c9eb1816ce9a4142a6ca889","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-0d8861c5abbb0e414397623dfe7de584 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe svc helloworld <span class=p>|</span> grep IP:</span></span></code></pre></div></div></div><div id=R-tab-id-2b84c53bf36a5a29658d978a90eb2c75 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>IP:                10.43.102.103</span></span></code></pre></div></div></div></div></div><p>ãã®å¾Œã€å‰ã®ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰è¿”ã•ã‚ŒãŸ Cluster IP ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
ä¾‹ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://10.43.102.103:8080/hello/Kubernetes</span></span></code></pre></div><h2 id=opentelemetry-ã®è¨­å®š>OpenTelemetry ã®è¨­å®š</h2><p>.NET OpenTelemetry è¨ˆè£…ã¯ã™ã§ã« Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡å…ˆã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>å…ˆã»ã©ä½œæˆã—ãŸ<code>deployment.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ï¼š</p><blockquote><p><strong>é‡è¦</strong> ä»¥ä¸‹ã® YAML ã®<code>$INSTANCE</code>ã‚’ã‚ãªãŸã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã¯<code>echo $INSTANCE</code>ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ç¢ºèªã§ãã¾ã™ã€‚</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;helloworld&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=otel-$INSTANCE&#34;</span></span></span></code></pre></div><p>å®Œå…¨ãª<code>deployment.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆ<code>$INSTANCE</code>ã§ã¯ãªã<strong>ã‚ãªãŸã®</strong>ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼‰ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/library/helloworld:1.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;helloworld&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=otel-$INSTANCE&#34;</span></span></span></code></pre></div><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å¤‰æ›´ã‚’é©ç”¨ã—ã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-bd9fb42124fffeb3fc048e6ce8ad0513><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2df3d4ef39a8d61e5396e550f011d577 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-bd9fb42124fffeb3fc048e6ce8ad0513","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-5b109c4b7c42bbd6737c75e548f52f78 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-bd9fb42124fffeb3fc048e6ce8ad0513","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-2df3d4ef39a8d61e5396e550f011d577 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-5b109c4b7c42bbd6737c75e548f52f78 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/helloworld configured</span></span></code></pre></div></div></div></div></div><p>ãã®å¾Œã€<code>curl</code>ã‚’ä½¿ç”¨ã—ã¦ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p><p>1 åˆ†ã»ã©çµŒéã™ã‚‹ã¨ã€o11y cloud ã§ãƒˆãƒ¬ãƒ¼ã‚¹ãŒæµã‚Œã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã‚‹ã¯ãšã§ã™ã€‚ãŸã ã—ã€ã‚ˆã‚Šæ—©ããƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™&mldr;</p><h2 id=ãƒãƒ£ãƒ¬ãƒ³ã‚¸>ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h2><p>é–‹ç™ºè€…ã¨ã—ã¦ã€ãƒˆãƒ¬ãƒ¼ã‚¹ ID ã‚’ç´ æ—©ãå–å¾—ã™ã‚‹ã‹ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¦‹ãŸã„å ´åˆã€deployment.yaml ãƒ•ã‚¡ã‚¤ãƒ«ã«ã©ã®ã‚ˆã†ãªç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ã§ãã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><details><summary><b>ç­”ãˆã‚’è¦‹ã‚‹ã«ã¯ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯</b></summary><p>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 4ã€Œ.NET Application ã‚’ OpenTelemetry ã§è¨ˆè£…ã™ã‚‹ã€ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§æ€ã„å‡ºã—ã¦ã„ãŸã ã‘ã‚Œã°ã€<code>OTEL_TRACES_EXPORTER</code>ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã£ã¦ trace ã‚’ console ã«æ›¸ãè¾¼ã‚€ãƒˆãƒªãƒƒã‚¯ã‚’ãŠè¦‹ã›ã—ã¾ã—ãŸã€‚ã“ã®å¤‰æ•°ã‚’ deployment.yaml ã«è¿½åŠ ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å† deploy ã—ã¦ã€helloworld ã‚¢ãƒ—ãƒªã‹ã‚‰ log ã‚’ tail ã™ã‚‹ã“ã¨ã§ã€trace id ã‚’å–å¾—ã—ã¦ Splunk Observability Cloud ã§ trace ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€debug exporter ã®ä½¿ç”¨ã«ã¤ã„ã¦ã‚‚èª¬æ˜ã—ã¾ã™ã€‚ã“ã‚Œã¯ K8s ç’°å¢ƒã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ debug ã™ã‚‹éš›ã®å…¸å‹çš„ãªæ–¹æ³•ã§ã™ã€‚ï¼‰</p><p>ã¾ãšã€vi ã§ deployment.yaml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi deployment.yaml</span></span></code></pre></div><p>æ¬¡ã«ã€<code>OTEL_TRACES_EXPORTER</code>ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;helloworld&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=YOURINSTANCE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># NEW VALUE HERE:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_TRACES_EXPORTER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;otlp,console&#34;</span></span></span></code></pre></div><p>å¤‰æ›´ã‚’ä¿å­˜ã—ã¦ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å† deploy ã—ã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-0402eab808a10d8814dc822c6ba91567><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b34fbf67bed0ab5bf648088cb42a1897 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-0402eab808a10d8814dc822c6ba91567","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-76def43d69b162d05d9f1a9674214101 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-0402eab808a10d8814dc822c6ba91567","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-b34fbf67bed0ab5bf648088cb42a1897 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-76def43d69b162d05d9f1a9674214101 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/helloworld configured</span></span></code></pre></div></div></div></div></div><p>helloworld ã® log ã‚’ tail ã—ã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-b63b67de348ea7cc4e988847d7368a31><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b41884afba60ee820e23176d9dba938b aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b63b67de348ea7cc4e988847d7368a31","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-1cc509f95c78bc9cb2123c037ccb72d5 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-b63b67de348ea7cc4e988847d7368a31","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-b41884afba60ee820e23176d9dba938b data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>helloworld -f</span></span></code></pre></div></div></div><div id=R-tab-id-1cc509f95c78bc9cb2123c037ccb72d5 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>info: HelloWorldController<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      /hello endpoint invoked by K8s9
</span></span><span class=line><span class=cl>Activity.TraceId:            5bceb747cc7b79a77cfbde285f0f09cb
</span></span><span class=line><span class=cl>Activity.SpanId:             ac67afe500e7ad12
</span></span><span class=line><span class=cl>Activity.TraceFlags:         Recorded
</span></span><span class=line><span class=cl>Activity.ActivitySourceName: Microsoft.AspNetCore
</span></span><span class=line><span class=cl>Activity.DisplayName:        GET hello/<span class=o>{</span>name?<span class=o>}</span>
</span></span><span class=line><span class=cl>Activity.Kind:               Server
</span></span><span class=line><span class=cl>Activity.StartTime:          2025-02-04T15:22:48.2381736Z
</span></span><span class=line><span class=cl>Activity.Duration:           00:00:00.0027334
</span></span><span class=line><span class=cl>Activity.Tags:
</span></span><span class=line><span class=cl>    server.address: 10.43.226.224
</span></span><span class=line><span class=cl>    server.port: <span class=m>8080</span>
</span></span><span class=line><span class=cl>    http.request.method: GET
</span></span><span class=line><span class=cl>    url.scheme: http
</span></span><span class=line><span class=cl>    url.path: /hello/K8s9
</span></span><span class=line><span class=cl>    network.protocol.version: 1.1
</span></span><span class=line><span class=cl>    user_agent.original: curl/7.81.0
</span></span><span class=line><span class=cl>    http.route: hello/<span class=o>{</span>name?<span class=o>}</span>
</span></span><span class=line><span class=cl>    http.response.status_code: <span class=m>200</span>
</span></span><span class=line><span class=cl>Resource associated with Activity:
</span></span><span class=line><span class=cl>    splunk.distro.version: 1.8.0
</span></span><span class=line><span class=cl>    telemetry.distro.name: splunk-otel-dotnet
</span></span><span class=line><span class=cl>    telemetry.distro.version: 1.8.0
</span></span><span class=line><span class=cl>    os.type: linux
</span></span><span class=line><span class=cl>    os.description: Debian GNU/Linux <span class=m>12</span> <span class=o>(</span>bookworm<span class=o>)</span>
</span></span><span class=line><span class=cl>    os.build_id: 6.2.0-1018-aws
</span></span><span class=line><span class=cl>    os.name: Debian GNU/Linux
</span></span><span class=line><span class=cl>    os.version: <span class=m>12</span>
</span></span><span class=line><span class=cl>    host.name: helloworld-69f5c7988b-dxkwh
</span></span><span class=line><span class=cl>    process.owner: app
</span></span><span class=line><span class=cl>    process.pid: <span class=m>1</span>
</span></span><span class=line><span class=cl>    process.runtime.description: .NET 8.0.12
</span></span><span class=line><span class=cl>    process.runtime.name: .NET
</span></span><span class=line><span class=cl>    process.runtime.version: 8.0.12
</span></span><span class=line><span class=cl>    container.id: 39c2061d7605d8c390b4fe5f8054719f2fe91391a5c32df5684605202ca39ae9
</span></span><span class=line><span class=cl>    telemetry.sdk.name: opentelemetry
</span></span><span class=line><span class=cl>    telemetry.sdk.language: dotnet
</span></span><span class=line><span class=cl>    telemetry.sdk.version: 1.9.0
</span></span><span class=line><span class=cl>    service.name: helloworld
</span></span><span class=line><span class=cl>    deployment.environment: otel-jen-tko-1b75</span></span></code></pre></div></div></div></div></div><p>æ¬¡ã«ã€åˆ¥ã® terminal window ã§ curl ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ trace ã‚’ç”Ÿæˆã—ã¾ã™ã€‚log ã‚’ tail ã—ã¦ã„ã‚‹ console ã§ trace id ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚<code>Activity.TraceId:</code>ã®å€¤ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€APM ã® Trace æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/10/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º>OpenTelemetryã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ç”¨ã—ã¦ K8s ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã« Splunk Distribution of OpenTelemetry ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’
ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ãŸã€‚ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã‚’ã„ãã¤ã‹ã®ä¾‹ã§
èª¬æ˜ã—ã¾ã™ã€‚</p><h2 id=ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®å–å¾—>ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®å–å¾—</h2><p>ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å‰ã«ã€ç¾åœ¨ã®è¨­å®šãŒã©ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’
ã©ã®ã‚ˆã†ã«ç¢ºèªã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><p>Kubernetes ç’°å¢ƒã§ã¯ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã¯ Config Map ã‚’ä½¿ç”¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«å­˜åœ¨ã™ã‚‹ config map ã‚’ç¢ºèªã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-406645ca713994e73255ba9c7ecc66c0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-bf61bb2cf82eeadaf8c1586a057a0fee aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-406645ca713994e73255ba9c7ecc66c0","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-a6a95b8d020ef2614cebcf4aa78bdbb2 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-406645ca713994e73255ba9c7ecc66c0","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-bf61bb2cf82eeadaf8c1586a057a0fee data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-a6a95b8d020ef2614cebcf4aa78bdbb2 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                                                 DATA   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-otel-k8s-cluster-receiver   <span class=m>1</span>      3h37m
</span></span><span class=line><span class=cl>splunk-otel-collector-otel-agent                  <span class=m>1</span>      3h37m</span></span></code></pre></div></div></div></div></div><blockquote><p>ãªãœ 2 ã¤ã® config map ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p></blockquote><p>æ¬¡ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã® config map ã‚’è¡¨ç¤ºã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-5369d5f2e8d68a483b072808654fd64a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-0ac65d6b42cb411e7134b7feb467d6b7 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-5369d5f2e8d68a483b072808654fd64a","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-62be8339ecffce429b06ca09404f9290 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-5369d5f2e8d68a483b072808654fd64a","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-0ac65d6b42cb411e7134b7feb467d6b7 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-agent</span></span></code></pre></div></div></div><div id=R-tab-id-62be8339ecffce429b06ca09404f9290 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Name:         splunk-otel-collector-otel-agent
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Labels:       <span class=nv>app</span><span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/instance<span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/managed-by<span class=o>=</span>Helm
</span></span><span class=line><span class=cl>              app.kubernetes.io/name<span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/version<span class=o>=</span>0.113.0
</span></span><span class=line><span class=cl>              <span class=nv>chart</span><span class=o>=</span>splunk-otel-collector-0.113.0
</span></span><span class=line><span class=cl>              helm.sh/chart<span class=o>=</span>splunk-otel-collector-0.113.0
</span></span><span class=line><span class=cl>              <span class=nv>heritage</span><span class=o>=</span>Helm
</span></span><span class=line><span class=cl>              <span class=nv>release</span><span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>Annotations:  meta.helm.sh/release-name: splunk-otel-collector
</span></span><span class=line><span class=cl>              meta.helm.sh/release-namespace: default
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Data</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>relay:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>exporters:
</span></span><span class=line><span class=cl>  otlphttp:
</span></span><span class=line><span class=cl>    headers:
</span></span><span class=line><span class=cl>      X-SF-Token: <span class=si>${</span><span class=nv>SPLUNK_OBSERVABILITY_ACCESS_TOKEN</span><span class=si>}</span>
</span></span><span class=line><span class=cl>    metrics_endpoint: https://ingest.us1.signalfx.com/v2/datapoint/otlp
</span></span><span class=line><span class=cl>    traces_endpoint: https://ingest.us1.signalfx.com/v2/trace/otlp
</span></span><span class=line><span class=cl>    <span class=o>(</span>followed by the rest of the collector config in yaml format<span class=o>)</span></span></span></code></pre></div></div></div></div></div><h2 id=k8s-ã§ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’æ›´æ–°ã™ã‚‹æ–¹æ³•>K8s ã§ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’æ›´æ–°ã™ã‚‹æ–¹æ³•</h2><p>Linux ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’å®Ÿè¡Œã—ãŸä»¥å‰ã®ä¾‹ã§ã¯ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã¯
<code>/etc/otel/collector/agent_config.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã§åˆ©ç”¨å¯èƒ½ã§ã—ãŸã€‚ãã®å ´åˆã«ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’
å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Œã°ã€å˜ç´”ã«ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã€å¤‰æ›´ã‚’ä¿å­˜ã—ã¦ã‹ã‚‰
ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’å†èµ·å‹•ã™ã‚Œã°ã‚ˆã‹ã£ãŸã®ã§ã™ã€‚</p><p>K8s ã§ã¯ã€å°‘ã—ç•°ãªã‚‹å‹•ä½œã‚’ã—ã¾ã™ã€‚<code>agent_config.yaml</code>ã‚’ç›´æ¥å¤‰æ›´ã™ã‚‹ä»£ã‚ã‚Šã«ã€
helm ãƒãƒ£ãƒ¼ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹<code>values.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§
ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚</p><p><a href=https://github.com/signalfx/splunk-otel-collector-chart/blob/main/helm-charts/splunk-otel-collector/values.yaml rel=external>GitHub</a>ã® values.yaml ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€
åˆ©ç”¨å¯èƒ½ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><h2 id=infrastructure-events-monitoring-ã®è¿½åŠ >Infrastructure Events Monitoring ã®è¿½åŠ </h2><p>æœ€åˆã®ä¾‹ã¨ã—ã¦ã€K8s ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã® infrastructure events monitoring ã‚’æœ‰åŠ¹ã«ã—ã¾ã—ã‚‡ã†ã€‚</p><blockquote><p>ã“ã‚Œã«ã‚ˆã‚Šã€charts ã® Events Feed ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸€éƒ¨ã¨ã—ã¦ Kubernetes ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
cluster receiver ã¯ã€kubernetes-events
monitor ã‚’ä½¿ç”¨ã—ã¦ Smart Agent receiver ã§è¨­å®šã•ã‚Œã€custom ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯<a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/collector-kubernetes/kubernetes-config-logs.html#collect-kubernetes-events rel=external>Collect Kubernetes events</a>ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p></blockquote><p>ã“ã‚Œã¯<code>values.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š</p><blockquote><p>ãƒ’ãƒ³ãƒˆï¼švi ã§ã®é–‹ãæ–¹ã¨ä¿å­˜æ–¹æ³•ã¯å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ã‚ã‚Šã¾ã™ã€‚</p></blockquote><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>agent:</span></span></span></code></pre></div><p>ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿å­˜ã•ã‚ŒãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å¤‰æ›´ã‚’é©ç”¨ã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-d49cb0fe6fcfe4185992df492d3facc9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-662c7fb2f44bc8a47eeca949cb8f1dc8 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-d49cb0fe6fcfe4185992df492d3facc9","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-4acfab75467f17e7e075b1a7bf3b5464 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-d49cb0fe6fcfe4185992df492d3facc9","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-662c7fb2f44bc8a47eeca949cb8f1dc8 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=otel-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f values.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-4acfab75467f17e7e075b1a7bf3b5464 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Release <span class=s2>&#34;splunk-otel-collector&#34;</span> has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri Dec <span class=m>20</span> 01:17:03 <span class=m>2024</span>
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>2</span>
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm us1.</span></span></code></pre></div></div></div></div></div><p>ãã®å¾Œã€config map ã‚’è¡¨ç¤ºã—ã¦å¤‰æ›´ãŒé©ç”¨ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-c9e03f33f7bcb152849c68d0f861caf8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-048250ebd294bf4f10d9a4e8e8b98949 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c9e03f33f7bcb152849c68d0f861caf8","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-dfdc57fdaaa61d5b3ce30bc0f71d4e15 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c9e03f33f7bcb152849c68d0f861caf8","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-048250ebd294bf4f10d9a4e8e8b98949 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-k8s-cluster-receiver</span></span></code></pre></div></div></div><div id=R-tab-id-dfdc57fdaaa61d5b3ce30bc0f71d4e15 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><code>smartagent/kubernetes-events</code>ãŒ agent config ã«å«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  smartagent/kubernetes-events:
</span></span><span class=line><span class=cl>    alwaysClusterReporter: <span class=nb>true</span>
</span></span><span class=line><span class=cl>    type: kubernetes-events
</span></span><span class=line><span class=cl>    whitelistedEvents:
</span></span><span class=line><span class=cl>    - involvedObjectKind: Pod
</span></span><span class=line><span class=cl>      reason: Created
</span></span><span class=line><span class=cl>    - involvedObjectKind: Pod
</span></span><span class=line><span class=cl>      reason: Unhealthy
</span></span><span class=line><span class=cl>    - involvedObjectKind: Pod
</span></span><span class=line><span class=cl>      reason: Failed
</span></span><span class=line><span class=cl>    - involvedObjectKind: Job
</span></span><span class=line><span class=cl>      reason: FailedCreate</span></span></code></pre></div></div></div></div></div><blockquote><p>ã“ã‚Œã‚‰ã®ç‰¹å®šã®å¤‰æ›´ãŒé©ç”¨ã•ã‚Œã‚‹ã®ã¯
cluster receiver config map ãªã®ã§ã€ãã¡ã‚‰ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</p></blockquote><h2 id=debug-exporter-ã®è¿½åŠ >Debug Exporter ã®è¿½åŠ </h2><p>collector ã«é€ä¿¡ã•ã‚Œã‚‹ trace ã¨ log ã‚’ç¢ºèªã—ã¦ã€
Splunk ã«é€ä¿¡ã™ã‚‹å‰ã«æ¤œæŸ»ã—ãŸã„ã¨ã—ã¾ã™ã€‚ã“ã®ç›®çš„ã®ãŸã‚ã« debug exporter ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã¯
OpenTelemetry é–¢é€£ã®å•é¡Œã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å½¹ç«‹ã¡ã¾ã™ã€‚</p><p>values.yaml ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸‹éƒ¨ã«ä»¥ä¸‹ã®ã‚ˆã†ã« debug exporter ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span></span></span></code></pre></div><p>ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿å­˜ã•ã‚ŒãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å¤‰æ›´ã‚’é©ç”¨ã§ãã¾ã™ï¼š</p><div class=tab-panel data-tab-group=R-tabs-36cd4f2ad2924aa630e46d419b5f2c0f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-058c7f162a601bc9551d8452bd1b1618 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-36cd4f2ad2924aa630e46d419b5f2c0f","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-ed6bc7e08a36253e8f42daa0f80e8d7c aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-36cd4f2ad2924aa630e46d419b5f2c0f","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-058c7f162a601bc9551d8452bd1b1618 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=otel-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f values.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-ed6bc7e08a36253e8f42daa0f80e8d7c data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Release <span class=s2>&#34;splunk-otel-collector&#34;</span> has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri Dec <span class=m>20</span> 01:32:03 <span class=m>2024</span>
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>3</span>
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm us1.</span></span></code></pre></div></div></div></div></div><p>curl ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ•°å›å®Ÿè¡Œã—ã¦ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ agent collector ã® log ã‚’ tail ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>component</span><span class=o>=</span>otel-collector-agent -f</span></span></code></pre></div><p>ä»¥ä¸‹ã®ã‚ˆã†ãª trace ãŒ agent collector ã® log ã«æ›¸ãè¾¼ã¾ã‚Œã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã‚‹ã¯ãšã§ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>2024-12-20T01:43:52.929Z info Traces {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 2}
2024-12-20T01:43:52.929Z info ResourceSpans #0
Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
Resource attributes:
     -&gt; splunk.distro.version: Str(1.8.0)
     -&gt; telemetry.distro.name: Str(splunk-otel-dotnet)
     -&gt; telemetry.distro.version: Str(1.8.0)
     -&gt; os.type: Str(linux)
     -&gt; os.description: Str(Debian GNU/Linux 12 (bookworm))
     -&gt; os.build_id: Str(6.8.0-1021-aws)
     -&gt; os.name: Str(Debian GNU/Linux)
     -&gt; os.version: Str(12)
     -&gt; host.name: Str(derek-1)
     -&gt; process.owner: Str(app)
     -&gt; process.pid: Int(1)
     -&gt; process.runtime.description: Str(.NET 8.0.11)
     -&gt; process.runtime.name: Str(.NET)
     -&gt; process.runtime.version: Str(8.0.11)
     -&gt; container.id: Str(78b452a43bbaa3354a3cb474010efd6ae2367165a1356f4b4000be031b10c5aa)
     -&gt; telemetry.sdk.name: Str(opentelemetry)
     -&gt; telemetry.sdk.language: Str(dotnet)
     -&gt; telemetry.sdk.version: Str(1.9.0)
     -&gt; service.name: Str(helloworld)
     -&gt; deployment.environment: Str(otel-derek-1)
     -&gt; k8s.pod.ip: Str(10.42.0.15)
     -&gt; k8s.pod.labels.app: Str(helloworld)
     -&gt; k8s.pod.name: Str(helloworld-84865965d9-nkqsx)
     -&gt; k8s.namespace.name: Str(default)
     -&gt; k8s.pod.uid: Str(38d39bc6-1309-4022-a569-8acceef50942)
     -&gt; k8s.node.name: Str(derek-1)
     -&gt; k8s.cluster.name: Str(derek-1-cluster)</code></pre></div><p>ãã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ãª log ã‚¨ãƒ³ãƒˆãƒªã‚‚ç¢ºèªã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>2024-12-20T01:43:53.215Z info Logs {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource logs&#34;: 1, &#34;log records&#34;: 2}
2024-12-20T01:43:53.215Z info ResourceLog #0
Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
Resource attributes:
     -&gt; splunk.distro.version: Str(1.8.0)
     -&gt; telemetry.distro.name: Str(splunk-otel-dotnet)
     -&gt; telemetry.distro.version: Str(1.8.0)
     -&gt; os.type: Str(linux)
     -&gt; os.description: Str(Debian GNU/Linux 12 (bookworm))
     -&gt; os.build_id: Str(6.8.0-1021-aws)
     -&gt; os.name: Str(Debian GNU/Linux)
     -&gt; os.version: Str(12)
     -&gt; host.name: Str(derek-1)
     -&gt; process.owner: Str(app)
     -&gt; process.pid: Int(1)
     -&gt; process.runtime.description: Str(.NET 8.0.11)
     -&gt; process.runtime.name: Str(.NET)
     -&gt; process.runtime.version: Str(8.0.11)
     -&gt; container.id: Str(78b452a43bbaa3354a3cb474010efd6ae2367165a1356f4b4000be031b10c5aa)
     -&gt; telemetry.sdk.name: Str(opentelemetry)
     -&gt; telemetry.sdk.language: Str(dotnet)
     -&gt; telemetry.sdk.version: Str(1.9.0)
     -&gt; service.name: Str(helloworld)
     -&gt; deployment.environment: Str(otel-derek-1)
     -&gt; k8s.node.name: Str(derek-1)
     -&gt; k8s.cluster.name: Str(derek-1-cluster)</code></pre></div><p>ãŸã ã—ã€Splunk Observability Cloud ã«æˆ»ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ trace ã¨ log ãŒ
ã‚‚ã¯ã‚„ãã“ã«é€ä¿¡ã•ã‚Œã¦ã„ãªã„ã“ã¨ã«æ°—ã¥ãã§ã—ã‚‡ã†ã€‚</p><p>ãªãœãã†ãªã£ãŸã¨æ€ã„ã¾ã™ã‹ï¼Ÿæ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=troubleshoot-opentelemetry-collector-issues>Troubleshoot OpenTelemetry Collector Issues</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<p>å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€debug ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã‚’ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®è¨­å®šã«è¿½åŠ ã—ã€
ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ãƒ­ã‚°ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä¸€éƒ¨ã«ã—ã¾ã—ãŸã€‚æœŸå¾…é€šã‚Šã«ã€debug å‡ºåŠ›ãŒ
ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ãƒ­ã‚°ã«æ›¸ãè¾¼ã¾ã‚Œã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã¾ã™ã€‚</p><p>ã—ã‹ã—ã€ãƒˆãƒ¬ãƒ¼ã‚¹ãŒ o11y cloud ã«é€ä¿¡ã•ã‚Œãªããªã£ã¦ã„ã¾ã™ã€‚ãªãœãªã®ã‹ã‚’æŠŠæ¡ã—ã¦ä¿®æ­£ã—ã¾ã—ã‚‡ã†ã€‚</p><h2 id=ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ç¢ºèªã™ã‚‹>ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ç¢ºèªã™ã‚‹</h2><p><code>values.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€šã˜ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã¯ã€
config map ã‚’ç¢ºèªã—ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«å®Ÿéš›ã«é©ç”¨ã•ã‚ŒãŸè¨­å®šã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒå½¹ç«‹ã¡ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-agent</span></span></code></pre></div><p>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã®ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>k8sattributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filter/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>fluentforward</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>k8sattributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>smartagent/signalfx-forwarder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>zipkin</span></span></span></code></pre></div><p>å•é¡ŒãŒã‚ã‹ã‚Šã¾ã™ã‹ï¼Ÿdebug ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã®ã¿ãŒãƒˆãƒ¬ãƒ¼ã‚¹ã¨ãƒ­ã‚°ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
ä»¥å‰ã®ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®šã«ã‚ã£ãŸ<code>otlphttp</code>ã¨<code>signalfx</code>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ãŒãªããªã£ã¦ã„ã¾ã™ã€‚
ã“ã‚ŒãŒã€ã‚‚ã† o11y cloud ã§ãƒˆãƒ¬ãƒ¼ã‚¹ãŒè¦‹ãˆãªããªã£ãŸç†ç”±ã§ã™ã€‚ãƒ­ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ã¤ã„ã¦ã‚‚ã€<code>splunk_hec/platform_logs</code>
ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã¾ã™ã€‚</p><blockquote><p>ã©ã®ã‚ˆã†ãªç‰¹å®šã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ãŒä»¥å‰å«ã¾ã‚Œã¦ã„ãŸã‹ã‚’ã©ã®ã‚ˆã†ã«çŸ¥ã£ãŸã‹ï¼Ÿãã‚Œã‚’è¦‹ã¤ã‘ã‚‹ã«ã¯ã€
ä»¥å‰ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’å…ƒã«æˆ»ã—ã¦ã‹ã‚‰ã€config map ã‚’ç¢ºèªã—ã¦
ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å…ƒã€…ä½•ãŒå«ã¾ã‚Œã¦ã„ãŸã‹ã‚’è¦‹ã‚‹ã“ã¨ã‚‚ã§ãã¾ã—ãŸã€‚ã‚ã‚‹ã„ã¯ã€
<a href=https://github.com/signalfx/splunk-otel-collector-chart/blob/main/examples/default/rendered_manifests/configmap-agent.yaml rel=external>splunk-otel-collector-chart ã® GitHub ãƒªãƒã‚¸ãƒˆãƒª</a>
ã®ä¾‹ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã‚‚ã§ãã€ã“ã‚Œã«ã‚ˆã‚Š Helm ãƒãƒ£ãƒ¼ãƒˆã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šãŒåˆ†ã‹ã‚Šã¾ã™ã€‚</p></blockquote><h2 id=ã“ã‚Œã‚‰ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã¯ã©ã®ã‚ˆã†ã«å‰Šé™¤ã•ã‚ŒãŸã®ã‹>ã“ã‚Œã‚‰ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã¯ã©ã®ã‚ˆã†ã«å‰Šé™¤ã•ã‚ŒãŸã®ã‹ï¼Ÿ</h2><p><code>values.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ãŸã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span></span></span></code></pre></div><p><code>helm upgrade</code>ã‚’ä½¿ã£ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«<code>values.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é©ç”¨ã—ãŸã¨ãã€
ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã¯ä»¥å‰ã®ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã¨ãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸã€‚
ã“ã‚ŒãŒç™ºç”Ÿã™ã‚‹ã¨ã€ãƒªã‚¹ãƒˆã‚’å«ã‚€<code>yaml</code>è¨­å®šã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€
ä¾‹ãˆã°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã®ãƒªã‚¹ãƒˆã¯ã€<code>values.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«
å«ã‚ãŸã‚‚ã®ï¼ˆdebug ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã®ã¿ï¼‰ã§ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚</p><h2 id=å•é¡Œã‚’ä¿®æ­£ã—ã¾ã—ã‚‡ã†>å•é¡Œã‚’ä¿®æ­£ã—ã¾ã—ã‚‡ã†</h2><p>æ—¢å­˜ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å ´åˆã€è¨­å®šã®ãã®éƒ¨åˆ†ã‚’å®Œå…¨ã«å†å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã—ãŸãŒã£ã¦ã€<code>values.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¬¡ã®ã‚ˆã†ã«æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>splunk_hec/platform_logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span></span></span></code></pre></div><p>å¤‰æ›´ã‚’é©ç”¨ã—ã¾ã—ã‚‡ã†ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=otel-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f values.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div><p>ãã‚Œã‹ã‚‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ config map ã‚’ç¢ºèªã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-agent</span></span></code></pre></div><p>ä»Šåº¦ã¯ã€ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã®ä¸¡æ–¹ã«ã¤ã„ã¦å®Œå…¨ã«å®šç¾©ã•ã‚ŒãŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  pipelines:
</span></span><span class=line><span class=cl>    logs:
</span></span><span class=line><span class=cl>      exporters:
</span></span><span class=line><span class=cl>      - splunk_hec/platform_logs
</span></span><span class=line><span class=cl>      - debug
</span></span><span class=line><span class=cl>      processors:
</span></span><span class=line><span class=cl>      ...
</span></span><span class=line><span class=cl>    traces:
</span></span><span class=line><span class=cl>      exporters:
</span></span><span class=line><span class=cl>      - otlphttp
</span></span><span class=line><span class=cl>      - signalfx
</span></span><span class=line><span class=cl>      - debug
</span></span><span class=line><span class=cl>      processors:
</span></span><span class=line><span class=cl>      ...</span></span></code></pre></div><h2 id=ãƒ­ã‚°å‡ºåŠ›ã®ç¢ºèª>ãƒ­ã‚°å‡ºåŠ›ã®ç¢ºèª</h2><p><strong>Splunk Distribution of OpenTelemetry .NET</strong>ã¯ã€ãƒ­ã‚°ã«ä½¿ç”¨ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã‚‚ä½¿ç”¨ã—ã¦ã„ã‚‹ï¼‰ã‹ã‚‰ã€ãƒˆãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å¼·åŒ–ã•ã‚ŒãŸãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p><p>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã¯ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã§å¼·åŒ–ã•ã‚Œã€ãã®å¾Œ
OpenTelemetry Collector ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã« OTLP å½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚</p><p>debug ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ã«ã‚ˆã£ã¦ã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚ŒãŸãƒ­ã‚°ã‚’è©³ã—ãè¦‹ã¦ã€ãã‚ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ­ã‚°ã‚’ tail ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>component</span><span class=o>=</span>otel-collector-agent -f</span></span></code></pre></div><p>ãƒ­ã‚°ã‚’ tail ã—ãŸã‚‰ã€curl ã‚’ä½¿ã£ã¦ã•ã‚‰ã«ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚ãã†ã™ã‚‹ã¨
æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>2024-12-20T21:56:30.858Z info Logs {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource logs&#34;: 1, &#34;log records&#34;: 1}
2024-12-20T21:56:30.858Z info ResourceLog #0
Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
Resource attributes:
     -&gt; splunk.distro.version: Str(1.8.0)
     -&gt; telemetry.distro.name: Str(splunk-otel-dotnet)
     -&gt; telemetry.distro.version: Str(1.8.0)
     -&gt; os.type: Str(linux)
     -&gt; os.description: Str(Debian GNU/Linux 12 (bookworm))
     -&gt; os.build_id: Str(6.8.0-1021-aws)
     -&gt; os.name: Str(Debian GNU/Linux)
     -&gt; os.version: Str(12)
     -&gt; host.name: Str(derek-1)
     -&gt; process.owner: Str(app)
     -&gt; process.pid: Int(1)
     -&gt; process.runtime.description: Str(.NET 8.0.11)
     -&gt; process.runtime.name: Str(.NET)
     -&gt; process.runtime.version: Str(8.0.11)
     -&gt; container.id: Str(5bee5b8f56f4b29f230ffdd183d0367c050872fefd9049822c1ab2aa662ba242)
     -&gt; telemetry.sdk.name: Str(opentelemetry)
     -&gt; telemetry.sdk.language: Str(dotnet)
     -&gt; telemetry.sdk.version: Str(1.9.0)
     -&gt; service.name: Str(helloworld)
     -&gt; deployment.environment: Str(otel-derek-1)
     -&gt; k8s.node.name: Str(derek-1)
     -&gt; k8s.cluster.name: Str(derek-1-cluster)
ScopeLogs #0
ScopeLogs SchemaURL:
InstrumentationScope HelloWorldController
LogRecord #0
ObservedTimestamp: 2024-12-20 21:56:28.486804 +0000 UTC
Timestamp: 2024-12-20 21:56:28.486804 +0000 UTC
SeverityText: Information
SeverityNumber: Info(9)
Body: Str(/hello endpoint invoked by {name})
Attributes:
     -&gt; name: Str(Kubernetes)
Trace ID: 78db97a12b942c0252d7438d6b045447
Span ID: 5e9158aa42f96db3
Flags: 1
 {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;}</code></pre></div><p>ã“ã®ä¾‹ã§ã¯ã€Trace ID ã¨ Span ID ãŒ
OpenTelemetry .NET è¨ˆè£…ã«ã‚ˆã£ã¦ãƒ­ã‚°å‡ºåŠ›ã«è‡ªå‹•çš„ã«æ›¸ãè¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€
Splunk Observability Cloud ã§ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’é–¢é€£ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p><p>ãŸã ã—ã€Helm ã‚’ä½¿ã£ã¦ K8s ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã« OpenTelemetry collector ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€
ãƒ­ã‚°åé›†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å«ã‚ã‚‹å ´åˆã€OpenTelemetry collector ã¯ File Log receiver ã‚’ä½¿ç”¨ã—ã¦
ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ãƒ­ã‚°ã‚’è‡ªå‹•çš„ã«ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹ã“ã¨ã‚’è¦šãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚</p><p>ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é‡è¤‡ãƒ­ã‚°ãŒã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ã¯
ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ 2 ã¤ã®ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ï¼š</p><p><a href=#R-image-9ec4d966977326b4382050bc6746d94b class=lightbox-link><img alt="Duplicate Log Entries" class="lazy lightbox figure-image" loading=lazy src=../images/duplicate_logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9ec4d966977326b4382050bc6746d94b><img alt="Duplicate Log Entries" class="lazy lightbox lightbox-image" loading=lazy src=../images/duplicate_logs.png></a></p><p>ã“ã‚Œã‚’ã©ã®ã‚ˆã†ã«å›é¿ã—ã¾ã™ã‹ï¼Ÿ</p><h2 id=k8s-ã§ã®é‡è¤‡ãƒ­ã‚°ã®å›é¿>K8s ã§ã®é‡è¤‡ãƒ­ã‚°ã®å›é¿</h2><p>é‡è¤‡ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã€<code>OTEL_LOGS_EXPORTER</code>ç’°å¢ƒå¤‰æ•°ã‚’<code>none</code>ã«è¨­å®šã—ã¦ã€
Splunk Distribution of OpenTelemetry .NET ãŒ OTLP ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«ãƒ­ã‚°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãªã„ã‚ˆã†ã«ã§ãã¾ã™ã€‚
ã“ã‚Œã¯ã€<code>deployment.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«<code>OTEL_LOGS_EXPORTER</code>ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§å®Ÿè¡Œã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;helloworld&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=otel-$INSTANCE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_LOGS_EXPORTER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;none&#34;</span></span></span></code></pre></div><p>ãã‚Œã‹ã‚‰æ¬¡ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># update the deployment</span>
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div><p><code>OTEL_LOGS_EXPORTER</code>ç’°å¢ƒå¤‰æ•°ã‚’<code>none</code>ã«è¨­å®šã™ã‚‹ã®ã¯ç°¡å˜ã§ã™ã€‚ã—ã‹ã—ã€Trace ID ã¨
Span ID ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸ stdout ãƒ­ã‚°ã«æ›¸ãè¾¼ã¾ã‚Œãªã„ãŸã‚ã€
ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’é–¢é€£ä»˜ã‘ã‚‹ã“ã¨ãŒã§ããªããªã‚Šã¾ã™ã€‚</p><p>ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ã«ã¯ã€
<code>/home/splunk/workshop/docker-k8s-otel/helloworld/SplunkTelemetryConfigurator.cs</code>ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ä¾‹ã®ã‚ˆã†ãªã€ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚¬ãƒ¼ã‚’å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p><p>æ¬¡ã®ã‚ˆã†ã«<code>Program.cs</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=k>using</span> <span class=nn>SplunkTelemetry</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.Extensions.Logging.Console</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>builder</span> <span class=p>=</span> <span class=n>WebApplication</span><span class=p>.</span><span class=n>CreateBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Services</span><span class=p>.</span><span class=n>AddControllers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SplunkTelemetryConfigurator</span><span class=p>.</span><span class=n>ConfigureLogger</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=n>Logging</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>app</span> <span class=p>=</span> <span class=n>builder</span><span class=p>.</span><span class=n>Build</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=p>.</span><span class=n>MapControllers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=p>.</span><span class=n>Run</span><span class=p>();</span></span></span></code></pre></div><p>ãã®å¾Œã€ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚°è¨­å®šã‚’å«ã‚€æ–°ã—ã„ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk/workshop/docker-k8s-otel/helloworld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker build -t helloworld:1.3 .</span></span></code></pre></div><p>ãã‚Œã‹ã‚‰æ›´æ–°ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ Kubernetes ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Import the image into k3d</span>
</span></span><span class=line><span class=cl>sudo k3d image import helloworld:1.3 --cluster <span class=nv>$INSTANCE</span>-cluster</span></span></code></pre></div><p>æœ€å¾Œã«ã€<code>deployment.yaml</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã® 1.3 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/library/helloworld:1.3</span></span></span></code></pre></div><p>ãã‚Œã‹ã‚‰å¤‰æ›´ã‚’é©ç”¨ã—ã¾ã™ï¼š</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># update the deployment</span>
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div><p>ã“ã‚Œã§é‡è¤‡ã—ãŸãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒæ’é™¤ã•ã‚ŒãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ãã—ã¦
æ®‹ã‚Šã®ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¯ JSON ã¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã€span ã¨ trace ID ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š</p><p><a href=#R-image-1ef083f03bc1b1f4c4b17f99512cef8f class=lightbox-link><img alt="JSON Format Logs" class="lazy lightbox figure-image" loading=lazy src=../images/logs_json_format.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1ef083f03bc1b1f4c4b17f99512cef8f><img alt="JSON Format Logs" class="lazy lightbox lightbox-image" loading=lazy src=../images/logs_json_format.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/10/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;<p>ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã§ã¯ã€ä»¥ä¸‹ã®æ¦‚å¿µã«ã¤ã„ã¦ãƒãƒ³ã‚ºã‚ªãƒ³ã§ä½“é¨“ã—ã¾ã—ãŸï¼š</p><ul><li>Linux ãƒ›ã‚¹ãƒˆã«<strong>Splunk Distribution of the OpenTelemetry Collector</strong>ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã€‚</li><li><strong>Splunk Distribution of OpenTelemetry .NET</strong>ã§.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨ˆè£…ã™ã‚‹æ–¹æ³•ã€‚</li><li>.NET ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€ŒDocker åŒ–ã€ã—ã€<strong>Splunk Distribution of OpenTelemetry .NET</strong>ã§è¨ˆè£…ã™ã‚‹æ–¹æ³•ã€‚</li><li>Helm ã‚’ä½¿ç”¨ã—ã¦ Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«<strong>Splunk Distribution of the OpenTelemetry Collector</strong>ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã€‚</li><li>ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦å•é¡Œã‚’ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹æ–¹æ³•ã€‚</li></ul><p>ä»–ã®è¨€èªã¨ç’°å¢ƒã§ OpenTelemetry ãŒã©ã®ã‚ˆã†ã«è¨ˆè£…ã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€
<a href=https://github.com/signalfx/splunk-opentelemetry-examples rel=external>Splunk OpenTelemetry Examples GitHub ãƒªãƒã‚¸ãƒˆãƒª</a>ã‚’ã”è¦§ãã ã•ã„ã€‚</p><p>å°†æ¥ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã‚’ç‹¬è‡ªã«å®Ÿè¡Œã™ã‚‹ã«ã¯ã€ã“ã‚Œã‚‰ã®æ‰‹é †ã‚’å‚ç…§ã—ã¦ã€Splunk Show ã®<strong>Splunk4Rookies - Observability</strong>
ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ EC2 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¦ãã ã•ã„ã€‚</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/16</span></span></footer></article></section></div></main></div><script src=/observability-workshop/js/clipboard/clipboard.min.js?1765303813 defer></script><script src=/observability-workshop/js/perfect-scrollbar/perfect-scrollbar.min.js?1765303813 defer></script><script src=/observability-workshop/js/theme.min.js?1765303813 defer></script></body></html>