<!doctype html><html id=R-html lang=ja dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 9.0.3+9bc97fdf9eaf3af61af9bcc11db2e010de83af95"><meta name=description content="Splunk を使用したオブザーバビリティソリューションの構築方法をご紹介します。"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Splunk Observability Workshops :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Splunk を使用したオブザーバビリティソリューションの構築方法をご紹介します。"><meta property="og:url" content="https://splunk.github.io/observability-workshop/ja/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Splunk Observability Workshops :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Splunk を使用したオブザーバビリティソリューションの構築方法をご紹介します。"><meta property="og:locale" content="ja"><meta property="og:type" content="website"><meta itemprop=name content="Splunk Observability Workshops :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Splunk を使用したオブザーバビリティソリューションの構築方法をご紹介します。"><meta itemprop=dateModified content="2025-09-29T12:26:47+01:00"><meta itemprop=wordCount content="757"><title>Splunk Observability Workshops :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/index.html rel=alternate hreflang=x-default><link href=https://splunk.github.io/observability-workshop/index.html rel=alternate hreflang=en><link href=https://splunk.github.io/observability-workshop/ja/index.html rel=alternate hreflang=ja><link href=https://splunk.github.io/observability-workshop/ja/index.html rel=canonical type=text/html title="Splunk Observability Workshops :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/images/favicon.ico?1769792814 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/css/auto-complete/auto-complete.min.css?1769792814 rel=stylesheet><script src=/observability-workshop/js/auto-complete/auto-complete.min.js?1769792814 defer></script><script src=/observability-workshop/js/search-lunr.min.js?1769792814 defer></script><script src=/observability-workshop/js/search.min.js?1769792814 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/searchindex.ja.js?1769792814"</script><script src=/observability-workshop/js/lunr/lunr.min.js?1769792814 defer></script><script src=/observability-workshop/js/lunr/lunr.stemmer.support.min.js?1769792814 defer></script><script src=/observability-workshop/js/lunr/lunr.multi.min.js?1769792814 defer></script><script src=/observability-workshop/js/lunr/tinyseg.js?1769792814 defer></script><script src=/observability-workshop/js/lunr/lunr.ja.min.js?1769792814 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["ja"]</script><link href=/observability-workshop/fonts/fontawesome/css/all.min.css?1769792814 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/fonts/fontawesome/css/all.min.css?1769792814 rel=stylesheet></noscript><link href=/observability-workshop/css/perfect-scrollbar/perfect-scrollbar.min.css?1769792814 rel=stylesheet><link href=/observability-workshop/css/theme.min.css?1769792814 rel=stylesheet><link href=/observability-workshop/css/format-print.min.css?1769792814 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/ja/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`テキストをクリップボードにコピー`,window.T_Copied_to_clipboard=`テキストをクリップボードにコピーしました!`,window.T_Link_copied_to_clipboard=`リンクをクリップボードにコピーしました!`,window.T_Reset_view=`ビューのリセット`,window.T_View_reset=`リセットを見る`,window.T_No_results_found=`"{0}" の結果が見つかりません`,window.T_N_results_found=`"{0}" で {1} 件の結果が見つかりました`,window.T_Browser_unsupported_feature=`このブラウザはこの機能をサポートしていません`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({appplicationName:"observability-workshop",realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",recorder:"splunk",features:{video:!0}})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-origin=/observability-workshop/ja/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="メニュー (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="目次 (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#splunk-observabilityワークショップへようこそ>Splunk Observabilityワークショップへようこそ</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Splunk Observability Workshops</span><meta itemprop=position content="1"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/observability-workshop/ja/index.print.html title="章全体を印刷する (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle"><span><i class="fa-fw fas fa-chevron-left"></i></span></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/observability-workshop/ja/splunk4rookies/index.html title="Splunk4Rookies ワークショップ (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=更に><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable page" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=splunk-observability-workshops>Splunk Observability Workshops</h1><h2 id=splunk-observabilityワークショップへようこそ>Splunk Observabilityワークショップへようこそ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Splunk Observability Cloud の監視、分析、対応ツールを使用して、アプリケーションとインフラストラクチャをリアルタイムで把握することができます。</p><p>このワークショップでは、メトリクス、トレース、ログを取り込み、監視し、可視化し、分析するためのクラス最高のオブザーバビリティ（可観測性）プラットフォームについて説明します。</p><p><a href=#R-image-063d11a7e1afd113f70c9b76bbf89b21 class=lightbox-link><img alt=gif class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/images/observability-hero-dashboard.gif style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-063d11a7e1afd113f70c9b76bbf89b21><img alt=gif class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/images/observability-hero-dashboard.gif></a></p><details open class="box cstyle notices default" style=--VARIABLE-BOX-color:#4f62ad><summary class=box-label tabindex=-1><i class="fab fa-wpexplorer"></i>
OpenTelemetry</summary><div class=box-content><p>このワークショップで<a href=https://opentelemetry.io rel=external>OpenTelemetry</a>をアプリケーションやインフラの分析に役立つテレメトリデータ（メトリクス、トレース、ログ）の計装、生成、収集、エクスポートに使用します。</p></div></details><details open class="box cstyle notices default" style=--VARIABLE-BOX-color:#4078c0><summary class=box-label tabindex=-1><i class="fab fa-github"></i>
GitHub</summary><div class=box-content><p>このドキュメントには、issue や pull request で <a href=https://github.com/splunk/observability-workshop rel=external>貢献</a> することができます。より良いワークショップにするために、是非ご協力ください。</p></div></details><details open class="box cstyle notices default" style=--VARIABLE-BOX-color:#1DA1F2><summary class=box-label tabindex=-1><i class="fab fa-twitter"></i>
Twitter</summary><div class=box-content><p><a href=https://twitter.com/splunk rel=external>Splunk</a>のTwitterチャンネルでは、アップデート情報や興味深い読み物を紹介しています。</p></div></details><ul class=card-container><li><article class="card card-popout" aria-labelledby=R-card-e901e3b8217ea902f74352201db96593><div class=card-content><div class=card-title id=R-card-e901e3b8217ea902f74352201db96593><a href=/observability-workshop/ja/splunk4rookies/index.html>Splunk4Rookies ワークショップ</a></div><div class=card-content-text>以下は初心者向けワークショップです。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-42f3883796cf76245541ac04941106b1><div class=card-content><div class=card-title id=R-card-42f3883796cf76245541ac04941106b1><a href=/observability-workshop/ja/ninja-workshops/index.html>Splunk4Ninjas Workshops</a></div><div class=card-content-text>The following workshops require Ninja skills, wax on, wax off.</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-0f02b5dbe10d4e465b54dd9b88f9b393><div class=card-content><div class=card-title id=R-card-0f02b5dbe10d4e465b54dd9b88f9b393><a href=/observability-workshop/ja/other/index.html>その他のワークショップ</a></div><div class=card-content-text>Pet Clinic Java ワークショップ
JavaアプリケーションをつかったSplunk Oservabilityのワークショップです
OpenTelemetry Collector
OpenTelemetry Collectorのコンセプトを学び、Splunk Observability Cloudにデータを送信する方法を理解しましょう。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-8c2056c32abd465efcce18e3d2483c73><div class=card-content><div class=card-title id=R-card-8c2056c32abd465efcce18e3d2483c73><a href=/observability-workshop/ja/resources/index.html>リソース</a></div><div class=card-content-text>よくある質問とその回答
オブザーバビリティ、DevOps、インシデント対応、Splunk On-Callに関連する一般的な質問とその回答を集めました。
ディメンション、プロパティ、タグ
ディメンションとプロパティの比較で、どちらかを使うべきかというのはよく議論されます。
OpenTelemetryでのタグ付け
大規模な組織で OpenTelemetry を展開する際には、タグ付けのための標準化された命名規則を定義し、規則が遵守されるようにガバナンスプロセスを確立することが重要です。</div></div></article></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/09/29</span></span></footer></article><section><h1 class=a11y-only>Splunk Observability Workshopsのサブセクション</h1><article class=default><header class=headline></header><h1 id=splunk4rookies-ワークショップ>Splunk4Rookies ワークショップ</h1><ul><li><p><a href=/observability-workshop/ja/splunk4rookies/observability-cloud/index.html>Observability Cloud</a></p><p>このワークショップでは、Splunk Observability Cloudがフロントエンドアプリケーションからバックエンドサービスまで、ユーザー体験の視点からどのように即座に可視性を提供するかをお見せします - Splunk Observability Cloudの最も魅力的な機能と差別化要因を体験していただきます。
{class=&ldquo;children children-type-tree children-sort-&rdquo;}</p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>Splunk4Rookies ワークショップのサブセクション</h1><article class=default><header class=headline></header><h1 id=observability-cloud>Observability Cloud</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Authors
</span><span class=badge-content>Robert Castley & Pieter Hagen</span></span><p>このワークショップでは、Splunk Observability Cloud がフロントエンドアプリケーションからバックエンドサービスまで、ユーザー体験に関する即時の可視性をどのように提供するかをデモンストレーションします。他の可観測性ソリューションと一線を画す、プラットフォームの最も強力な機能をいくつか体験していただきます：</p><ul><li><strong>インフラ監視（Infrastructure Monitoring, IM）</strong></li><li><strong>完全で忠実な Real User Monitoring（RUM）</strong></li><li><strong>Application Performance Monitoring（APM）による End to End の NoSample で完全忠実なトレースの可視性</strong></li><li><strong>コード入力を必要としないログクエリ</strong></li><li><strong>外形監視・合成監視（Synthetic Monitoring）</strong></li><li><strong>タグ分析とエラースタックによる根本原因分析</strong></li><li><strong>Related Contents によるコンポーネント間のシームレスなナビゲーション</strong></li></ul><p>Splunk Observability Cloud のコアとなる強みの一つは、テレメトリデータを統合し、エンドユーザーエクスペリエンスとアプリケーションスタック全体の包括的な全体像を作成する能力です。</p><p>このワークショップでは、AWS EC2 インスタンス上にデプロイされたマイクロサービスベースの e コマースアプリケーションに焦点を当てます。ユーザーは商品を閲覧し、カートに商品を追加し、注文を完了できます。このアプリケーションは、詳細なパフォーマンスデータを取得するために OpenTelemetry で計装されています。</p><p><strong>OpenTelemetry とは？</strong></p><p><a href=https://opentelemetry.io/ rel=external>OpenTelemetry</a> は、メトリクス、トレース、ログなどのテレメトリデータの計装、生成、収集、エクスポートを支援するために設計されたオープンソースのツール、API、ソフトウェア開発キット（SDK）のコレクションです。このデータにより、ソフトウェアのパフォーマンスと動作の詳細な分析が可能になります。</p><p>OpenTelemetry コミュニティは急速に成長しており、Splunk、Google、Microsoft、Amazon などの大手企業からのサポートを受けています。現在、Cloud Native Computing Foundation において、Kubernetes に次いで 2 番目に多くのコントリビューターを抱えています。</p><p><a href=#R-image-f096c3f920feb3a83089ea4f6a9ad3f8 class=lightbox-link><img alt="Full Stack" class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/images/splunk-full-stack.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f096c3f920feb3a83089ea4f6a9ad3f8><img alt="Full Stack" class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/images/splunk-full-stack.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article><section><h1 class=a11y-only>Observability Cloudのサブセクション</h1><article class=default><header class=headline></header><h1 id=ワークショップ概要>ワークショップ概要</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;<p><strong>はじめに</strong><br>このワークショップの目的は、Splunk Observability Cloud を使用して問題のトラブルシューティングを行い、根本原因を特定する実践的な経験を提供することです。私たちは、Kubernetes 上で動作する完全に計装されたマイクロサービスベースのアプリケーションを用意しており、これが<strong>メトリクス、トレース、ログ</strong>を Splunk Observability Cloud にリアルタイム分析のために送信します。</p><p><strong>対象者</strong><br>このワークショップは、Splunk Observability Cloud の実践的な知識を得たいと考えている方を対象としています。Observability Cloud を含む Splunk Platform に関する事前知識がほとんど、または全くない方向けに設計されています。</p><p><strong>必要なもの</strong><br>ノートパソコンと外部ウェブサイトにアクセスできるブラウザが必要です。ワークショップは対面または Zoom を通じて参加できます。Zoom クライアントをインストールしていない場合でも、ブラウザを使用して参加できます。</p><p><strong>ワークショップ概要</strong><br>この 3 時間のセッションでは、ストリーミング分析と NoSample で完全に忠実な分散トレースを提供する唯一のプラットフォームである Splunk Observability の基礎を、インタラクティブなハンズオン形式で説明します。以下が期待できる内容です：</p><ul><li><p><strong>OpenTelemetry</strong><br>最新の Observability に OpenTelemetry が不可欠である理由と、システムの可視性をどのように向上させるかを学びます。</p></li><li><p><strong>Splunk Observability ユーザーインターフェイスツアー</strong><br>Splunk Observability Cloud のインターフェイスのガイド付きツアーで、APM、RUM、Log Observer、Synthetics、Infrastructure という 5 つの主要コンポーネントの操作方法を紹介します。</p></li><li><p><strong>実際のユーザーデータを生成</strong><br>オンラインブティックというウェブサイトでシミュレートされた小売体験に飛び込みます。ブラウザ、モバイル、またはタブレットを使用して、サイトを探索し、メトリクス（問題はありますか？）、トレース（問題はどこにありますか？）、ログ（何が問題を引き起こしていますか？）を含む実際のユーザーデータを生成します。</p></li><li><p><strong>Splunk Real User Monitoring（RUM）</strong><br>参加者のブラウザセッションから収集された実際のユーザーデータを分析します。あなたの課題は、パフォーマンスの悪いセッションを特定し、トラブルシューティングプロセスを開始することです。</p></li><li><p><strong>Splunk Application Performance Monitoring（APM）</strong><br>RUM トレース（フロントエンド）を APM トレース（バックエンド）にリンクすることで、<strong>End to End を可視化する能力</strong>を理解しましょう。様々なサービスからのテレメトリが Splunk Observability Cloud でどのように取得され、視覚化されるかを探り、異常とエラーを検出します。</p></li><li><p><strong>Splunk Log Observer（LO）</strong><br><strong>Related Content</strong> 機能を活用してコンポーネント間を簡単に移動する方法を学びます。このワークショップでは、APM トレースから関連するログに移動して、問題についてより深い洞察を得ます。</p></li><li><p><strong>Splunk Synthetics</strong><br>Synthetics がアプリケーションの 24 時間 365 日のモニタリングにどのように役立つかを発見します。オンラインブティックウェブサイトのパフォーマンスと可用性を監視するために、毎分実行される簡単な合成テストの設定方法を説明します。</p></li></ul><p>このセッションを終えると、Splunk Observability Cloud の実践的な経験と、アプリケーションスタック全体の問題をトラブルシューティングして解決する方法についての確かな理解が得られるでしょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetryとは何かなぜ重要なのか>OpenTelemetryとは何か、なぜ重要なのか？</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;<h2 id=opentelemetry>OpenTelemetry<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>クラウドコンピューティング、マイクロサービスアーキテクチャ、そして複雑化するビジネス要件の増加に伴い、可観測性の必要性はかつてないほど高まっています。可観測性とは、システムの出力を調査することで、そのシステムの内部状態を理解する能力です。ソフトウェアの文脈では、これは<strong>メトリクス</strong>、<strong>トレース</strong>、<strong>ログ</strong>を含むテレメトリデータを調査することでシステムの内部状態を理解できることを意味します。</p><p>システムを観測可能にするには、計装が必要です。つまり、コードはトレース、メトリクス、ログを発行する必要があります。この計装データは、<strong>Splunk Observability Cloud</strong>などの可観測性バックエンドに送信される必要があります。</p><table><thead><tr><th style=text-align:center>メトリクス</th><th style=text-align:center>トレース</th><th style=text-align:center>ログ</th></tr></thead><tbody><tr><td style=text-align:center><em><strong>問題がありますか？</strong></em></td><td style=text-align:center><em><strong>問題はどこですか？</strong></em></td><td style=text-align:center><em><strong>問題は何ですか？</strong></em></td></tr></tbody></table><p>OpenTelemetry は 2 つの重要なことを行います：</p><ul><li>独自のデータフォーマットやツールに縛られるのではなく、生成したデータを<strong>所有</strong>できるようにします。</li><li><strong>単一の</strong>API セットと規約を学ぶことができます</li></ul><p>これら 2 つの要素が組み合わさることで、今日の現代的なコンピューティング環境で必要な柔軟性をチームや組織に提供します。</p><p>可観測性を始めるにあたっては、重要な質問を含め多くの変数を考慮する必要があります： <em>「どのようにしてデータを可観測性ツールに取り込むのか？」</em> OpenTelemetry の業界全体での採用は、この質問に答えることをこれまで以上に容易にしています。</p><h2 id=なぜ重要なのか>なぜ重要なのか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry は完全にオープンソースで無料で使用できます。過去のモニタリングや可観測性ツールは、独自のエージェントに大きく依存していたため、追加のツールを変更したり設定したりするために必要な労力は、インフラレベルからアプリケーションレベルまで、システム全体に大規模な変更を必要としていました。</p><p>OpenTelemetry はベンダー中立であり、可観測性分野の多くの業界リーダーにサポートされているため、採用者は計装にわずかな変更を加えるだけで、サポートされている可観測性ツール間をいつでも切り替えることができます。これは、Linux のように様々なディストリビューションが設定やアドオンをバンドルしていても、基本的にはすべてがコミュニティ主導の OpenTelemetry プロジェクトに基づいているため、どの OpenTelemetry ディストリビューションを使用しても変わりません。</p><p>Splunk は完全に OpenTelemetry にコミットしており、お客様があらゆる種類、あらゆる構造、あらゆるソースから、あらゆる規模で、すべてリアルタイムで<strong>すべての</strong>データを収集して使用できるようにしています。OpenTelemetry は基本的にモニタリングの環境を変え、IT チームや DevOps チームがすべての質問とすべてのアクションにデータをもたらすことを可能にしています。これらのワークショップでこれを体験することになります。</p><p><a href=#R-image-69bff40fc10e63aa5fd8866078cb7823 class=lightbox-link><img alt="OpenTelemetry ロゴ" class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/2-opentelemetry/images/otel.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-69bff40fc10e63aa5fd8866078cb7823><img alt="OpenTelemetry ロゴ" class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/2-opentelemetry/images/otel.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=ui---クイックツアー->UI - クイックツアー 🚌</h1><p>Splunk Observability Cloud の様々なコンポーネントについて簡単な説明から始めます。これは UI に慣れてもらうことを目的としています。</p><ol><li><strong>Splunk Observability Cloud へのサインイン</strong></li><li><strong>Real User Monitoring (RUM)</strong></li><li><strong>Application Performance Monitoring (APM)</strong></li><li><strong>Log Observer</strong></li><li><strong>Synthetics</strong></li><li><strong>Infrastructure Monitoring（IM）</strong></li></ol><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ヒント</summary><div class=box-content><p>このワークショップを進める最も簡単な方法は以下を使用することです:</p><ul><li>このページの右上にある左右の矢印（<strong>&lt;</strong> | <strong>></strong>）</li><li>キーボードの左（◀️）と右（▶️）のカーソルキー</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>3. UI - クイックツアーのサブセクション</h1><article class=default><header class=headline></header><h1 id=はじめに>はじめに</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;<h3 id=1-splunk-observability-cloud-にサインインする>1. Splunk Observability Cloud にサインインする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Splunk が主催するワークショップの場合、Workshop Org に招待するメールを受け取っているはずです。このメールは下のスクリーンショットのようになっています。見つからない場合は、迷惑メールフォルダを確認するか、インストラクターにお知らせください。また、<a href=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/1-homepage/99-login-faq/index.html><strong>ログイン FAQ</strong></a>で他の解決策を確認することもできます。</p><p>進めるには、<strong>Join Now</strong>（参加する）ボタンをクリックするか、メールに記載されているリンクをクリックしてください。</p><p>登録プロセスをすでに完了している場合は、残りの手順をスキップして直接 Splunk Observability Cloud にログインできます：</p><ul><li><a href=https://app.eu0.signalfx.com rel=external><strong>https://app.eu0.signalfx.com (EMEA)</strong></a></li><li><a href=https://app.us1.signalfx.com rel=external><strong>https://app.us1.signalfx.com (APAC/AMER)</strong></a></li></ul><p><a href=#R-image-ddfedc9751bd51950a3a3dcdae186426 class=lightbox-link><img alt=メール class="lazy lightbox figure-image" loading=lazy src="/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/1-homepage/images/invite-email.png?width=25vw" style=height:auto;width:25vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ddfedc9751bd51950a3a3dcdae186426><img alt=メール class="lazy lightbox lightbox-image" loading=lazy src="/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/1-homepage/images/invite-email.png?width=25vw"></a></p><p>Splunk Observability Cloud を初めて使用する場合は、登録フォームが表示されます。フルネームと希望するパスワードを入力してください。パスワードの要件は次のとおりです：</p><ul><li>8 文字から 32 文字の間である</li><li>少なくとも 1 つの大文字を含む</li><li>少なくとも 1 つの数字を含む</li><li>少なくとも 1 つの記号（例：!@#$%^&*()_+）を含む</li></ul><p>利用規約に同意するためのチェックボックスをクリックし、<strong>SIGN IN NOW</strong>（今すぐサインイン）ボタンをクリックします。</p><p><a href=#R-image-7a7ae54045cb2b2fc2ba56ae4fb5b6d8 class=lightbox-link><img alt=ユーザー設定 class="lazy lightbox figure-image" loading=lazy src="/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/1-homepage/images/enter-password.png?width=25vw" style=height:auto;width:25vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7a7ae54045cb2b2fc2ba56ae4fb5b6d8><img alt=ユーザー設定 class="lazy lightbox lightbox-image" loading=lazy src="/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/1-homepage/images/enter-password.png?width=25vw"></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>1. はじめにのサブセクション</h1><article class=default><header class=headline></header><h1 id=ホームページ>ホームページ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5分</span>
</span>&nbsp;<p>Splunk Observability Cloud に登録してログインすると、ホームページ（ランディングページ）に移動します。ここでは、開始に役立ついくつかの便利な機能が見つかります。</p><p><a href=#R-image-5845cc953ffac88fa4556c45df4a72c5 class=lightbox-link><img alt=ホームページ class="lazy lightbox figure-image" loading=lazy src=../images/home-screen.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5845cc953ffac88fa4556c45df4a72c5><img alt=ホームページ class="lazy lightbox lightbox-image" loading=lazy src=../images/home-screen.png></a></p><ol><li><strong>データ探索パネル:</strong> どの統合が有効になっているかを表示し、管理者の場合は追加の統合を追加できます。</li><li><strong>ドキュメントパネル:</strong> Splunk Observability Cloud の使用を開始するためのトレーニングビデオとドキュメントへのリンク。</li><li><strong>最近のアクティビティパネル:</strong> 最近作成/訪問したダッシュボードやディテクターにすぐにアクセスできます。</li><li><strong>メインメニューパネル:</strong> Splunk Observability Cloud のコンポーネントを操作します。</li><li><strong>組織切り替え:</strong> 複数の組織のメンバーである場合は、組織間を簡単に切り替えることができます。</li><li><strong>メインメニューの展開/縮小:</strong> スペースが限られている場合にメインメニューを展開 <strong>&#187;</strong> / 折りたたむ <strong>&#171;</strong> ことができます。</li></ol><p>最初の演習から始めましょう：</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>メインメニューを展開し、<strong>設定</strong>をクリックします。</li><li><strong>組織切り替え</strong>で、複数の組織にアクセスできるかどうかを確認します。</li></ul></div></details><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ヒント</summary><div class=box-content><p>以前に Splunk Observability を使用したことがある場合は、以前に使用した組織に配置されている可能性があります。正しいワークショップ組織にいることを確認してください。複数の組織へのアクセス権がある場合は、インストラクターに確認してください。</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>オンボーディングガイダンス</strong>をクリックします（ここでオンボーディングパネルの表示/非表示を切り替えることができます。製品に十分に精通していて、より多くの情報を表示するためにスペースを使用できる場合に便利です）。</li><li><strong>ホームページ</strong>のオンボーディングコンテンツを非表示にします。</li><li>メニューの下部で、お好みのテーマ：<strong>Light</strong>、<strong>Dark</strong>、または**System(Auto)**モードを選択します。</li><li>これが<strong>Log out</strong>オプションがある場所であることにも気づきましたか？どうかログアウトしないでください 😊！</li><li><strong>&lt;</strong> をクリックしてメインメニューに戻ります。</li></ul></div></details><p>次に、<strong>Splunk Real User Monitoring (RUM)</strong> を確認しましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=real-user-monitoring概要>Real User Monitoring概要</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>Splunk RUM は業界で唯一のエンドツーエンドの<strong>NoSample</strong>（サンプリングなし）RUM ソリューションで、すべての Web およびモバイルセッションの完全なユーザーエクスペリエンスに関する可視性を提供し、発生時にすべてのフロントエンドトレースとバックエンドのメトリクス、トレース、ログを独自に組み合わせます。IT オペレーションとエンジニアリングチームは、エラーの範囲を迅速に特定し、優先順位を付け、分離し、パフォーマンスが実際のユーザーにどのように影響するかを測定し、すべてのユーザー操作のビデオ再構築とともにパフォーマンスメトリクスを相関させることでエンドユーザーエクスペリエンスを最適化できます。</p><p><strong>完全なユーザーセッション分析：</strong> ストリーミング分析により、シングルページおよびマルチページアプリからの完全なユーザーセッションをキャプチャし、すべてのリソース、画像、ルート変更、API コールの顧客への影響を測定します。<br><strong>問題をより迅速に関連付ける：</strong> 無限のカーディナリティと完全なトランザクション分析により、複雑な分散システム全体で問題をより迅速に特定し関連付けることができます。<br><strong>レイテンシーとエラーの分離：</strong> 各コード変更とデプロイメントに対するレイテンシー、エラー、パフォーマンスの低下を簡単に特定します。コンテンツ、画像、サードパーティの依存関係がお客様にどのように影響するかを測定します。<br><strong>ページパフォーマンスのベンチマークと改善：</strong> コアウェブバイタルを活用して、ページ読み込み体験、インタラクティビティ、視覚的安定性を測定し改善します。影響力のある JavaScript エラーを見つけて修正し、最初に改善すべきページを簡単に理解します。<br><strong>意味のあるメトリクスの探索：</strong> 特定のワークフロー、カスタムタグ、未インデックス化タグの自動提案に関するメトリクスを使用して、顧客への影響を即座に視覚化し、問題の根本原因をすばやく見つけます。<br><strong>エンドユーザーエクスペリエンスの最適化：</strong> すべてのユーザー操作のビデオ再構築とともにパフォーマンスメトリクスを相関させて、エンドユーザーエクスペリエンスを最適化します。</p><p><a href=#R-image-a6de17dfe4fd66eb654417ae2649aa46 class=lightbox-link><img alt=アーキテクチャ概要 class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/2-rum-home/images/rum-architecture.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a6de17dfe4fd66eb654417ae2649aa46><img alt=アーキテクチャ概要 class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/2-rum-home/images/rum-architecture.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article><section><h1 class=a11y-only>2. RUM概要のサブセクション</h1><article class=default><header class=headline></header><h1 id=real-user-monitoring-ホームページ>Real User Monitoring ホームページ</h1><p>メインメニューの<strong>RUM</strong>をクリックすると、RUM のメインホームページ（ランディングページ）に移動します。このページの主な概念は、選択したすべての RUM アプリケーションの全体的な状態を、フルダッシュボードまたはコンパクトビューのいずれかで一目で提供することです。</p><p>使用する状態ダッシュボードのタイプに関係なく、RUM ホームページは 3 つの明確なセクションで構成されています：</p><p><a href=#R-image-c9a7bef95fa5f01e6ca3fcb7e8e9f759 class=lightbox-link><img alt=RUMページ class="lazy lightbox figure-image" loading=lazy src=../images/rum-main.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c9a7bef95fa5f01e6ca3fcb7e8e9f759><img alt=RUMページ class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-main.png></a></p><ol><li><strong>オンボーディングペイン:</strong> Splunk RUM の使用を開始するためのトレーニングビデオとドキュメントへのリンク。（画面のスペースが必要な場合、このペインを非表示にすることができます。）</li><li><strong>フィルターペイン:</strong> 時間枠、環境、アプリケーション、ソースタイプでフィルタリングします。</li><li><strong>アプリケーションサマリーペイン:</strong> RUM データを送信するすべてのアプリケーションの概要。</li></ol><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
RUM環境とアプリケーション、およびソースタイプ</summary><div class=box-content><ul><li>Splunk Observability は、RUM トレースの一部として送信される<strong>Environment</strong>タグ（ウェブサイトやモバイルアプリとの各操作で作成される）を使用して、「本番環境」や「開発環境」などの異なる環境からのデータを分離します。</li><li>さらに <strong>アプリケーション(App)</strong> タグによる分離も可能です。これにより、同じ環境で実行されている別々のブラウザ/モバイルアプリケーションを区別することができます。</li><li>Splunk RUM はブラウザとモバイルアプリケーションの両方で利用可能です。<strong>Source タイプ</strong>を使用してそれらを区別することも可能ですが、このワークショップではブラウザベースの RUM のみを使用します。</li></ul></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>時間ウィンドウが <strong>-15m</strong> に設定されていることを確認します</li><li>ドロップダウンボックスからワークショップの環境を選択します。命名規則は <strong>[ワークショップ名]-workshop</strong> です（これを選択すると、ワークショップ RUM アプリケーションが表示されます）</li><li><strong>App</strong>名を選択します。命名規則は <strong>[ワークショップ名]-store</strong> で、<strong>Source</strong>は<strong>すべて</strong>のままにしておきます</li><li><strong>JavaScript Errors</strong>タイルで、<strong>TypeError</strong>エントリ：<em>Cannot read properties of undefined (reading &lsquo;Prcie&rsquo;)</em> をクリックして詳細を確認します。ウェブサイトのどの部分でエラーが発生したかを素早く示してくれることに注意してください。これにより、迅速に修正することができます。</li><li>ペインを閉じます。</li><li>3 番目のタイルは<strong>Web Vitals</strong>を報告します。これはユーザーエクスペリエンスの 3 つの重要な側面である<strong>読み込み、対話性、視覚的安定性</strong>に焦点を当てたメトリクスです。</li></ul><div class=tab-panel data-tab-group=R-tabs-5f68f0bcd1e33d41bfbcc05c04b27d4a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-01ff53b6caadcc2938bbdf546ef9ea3b aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-5f68f0bcd1e33d41bfbcc05c04b27d4a","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-f6bbe7c9e6c421c561df22e91f784310 aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-5f68f0bcd1e33d41bfbcc05c04b27d4a","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-01ff53b6caadcc2938bbdf546ef9ea3b data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>Web Vitals メトリクスに基づいて、現在のウェブサイトのパフォーマンスをどのように評価しますか？</strong></p></div></div><div id=R-tab-id-f6bbe7c9e6c421c561df22e91f784310 data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>Web Vitals メトリクス</strong>によれば、サイトの初期読み込みは良好であり、<strong>Good</strong>と評価されています</p></div></div></div></div><ul><li>最後のタイル、<strong>Most recent alerts</strong> タイルは、アプリケーションに対してアラートが発生しているかどうかを表示します。</li><li>アプリケーション名の前にある下向き矢印 <strong>⌵</strong> をクリックして、ビューをコンパクトスタイルに切り替えます。このビューでもすべての主要情報が利用可能であることに注目してください。コンパクトビューの任意の場所をクリックすると、フルビューに戻ります。</li></ul></div></details><p>次に、<strong>Splunk Application Performance Monitoring（APM）</strong> を確認しましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=application-performance-monitoring概要>Application Performance Monitoring概要</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>Splunk APM は、モノリスとマイクロサービス全体で問題をより迅速に解決するために、すべてのサービスとその依存関係の<strong>NoSample</strong>（サンプリングなし）エンドツーエンドの可視性を提供します。チームは新しいデプロイメントからの問題をすぐに検出し、問題の原因の範囲を特定して分離することで自信を持ってトラブルシューティングを行い、バックエンドサービスがエンドユーザーとビジネスワークフローにどのように影響するかを理解することでサービスのパフォーマンスを最適化できます。</p><p><strong>リアルタイム監視とアラート：</strong> Splunk は標準でサービスダッシュボードを提供し、急激な変化があった場合に RED メトリクス（レート、エラー、期間）を自動的に検出してアラートを発します。
<strong>動的テレメトリマップ：</strong> 現代の本番環境でのサービスパフォーマンスをリアルタイムで簡単に視覚化できます。インフラストラクチャ、アプリケーション、エンドユーザー、およびすべての依存関係からのサービスパフォーマンスのエンドツーエンドの可視性により、新しい問題の範囲をすばやく特定し、より効果的にトラブルシューティングを行うことができます。<br><strong>インテリジェントなタグ付けと分析：</strong> ビジネス、インフラストラクチャ、アプリケーションからのすべてのタグを 1 か所で表示し、レイテンシーやエラーの新しい傾向を特定のタグ値と簡単に比較できます。<br><strong>AI によるトラブルシューティングが最も影響の大きい問題を特定：</strong> 個々のダッシュボードを手動で掘り下げる代わりに、より効率的に問題を分離します。サービスと顧客に最も影響を与える異常とエラーの原因を自動的に特定します。<br><strong>完全な分散トレースがすべてのトランザクションを分析：</strong> クラウドネイティブ環境の問題をより効果的に特定します。Splunk 分散トレースは、バックエンドとフロントエンドからのすべてのトランザクションをインフラストラクチャ、ビジネスワークフロー、アプリケーションのコンテキストで視覚化し相関付けます。<br><strong>フルスタック相関：</strong> Splunk Observability 内では、APM がトレース、メトリクス、ログ、プロファイリングをリンクし、スタック全体のすべてのコンポーネントとその依存関係のパフォーマンスを簡単に理解できるようにします。<br><strong>データベースクエリパフォーマンスの監視：</strong> SQL および NoSQL データベースからの遅いクエリと高実行クエリがサービス、エンドポイント、ビジネスワークフローにどのように影響するかを簡単に特定できます — 計装は不要です。</p><p><a href=#R-image-bdd3987af015d3d12622dc803d2acb2f class=lightbox-link><img alt=アーキテクチャ概要 class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/3-apm-home/images/arch-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bdd3987af015d3d12622dc803d2acb2f><img alt=アーキテクチャ概要 class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/3-apm-home/images/arch-overview.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article><section><h1 class=a11y-only>3. APM概要のサブセクション</h1><article class=default><header class=headline></header><h1 id=application-performance-monitoring-ホームページ>Application Performance Monitoring ホームページ</h1><p>メインメニューの<strong>APM</strong>をクリックすると、APM ホームページが表示されます。APM ホームページは 3 つの明確なセクションで構成されています：</p><p><a href=#R-image-8c51b6af73315a1231ebebbb6778a69b class=lightbox-link><img alt=APMページ class="lazy lightbox figure-image" loading=lazy src=../images/apm-main.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8c51b6af73315a1231ebebbb6778a69b><img alt=APMページ class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-main.png></a></p><ol><li><strong>オンボーディングペイン:</strong> Splunk APM の使用を開始するためのトレーニングビデオとドキュメントへのリンク。</li><li><strong>APM 概要ペイン:</strong> トップサービスとトップビジネスワークフローのリアルタイムメトリクス。</li><li><strong>機能ペイン:</strong> サービス、タグ、トレース、データベースクエリパフォーマンス、コードプロファイリングの詳細分析へのリンク。</li></ol><p><strong>APM 概要</strong>ペインは、アプリケーションの健全性の高レベルの概要を提供します。これにはアプリケーション内のサービス、レイテンシー、エラーの概要が含まれます。また、エラー率別のトップサービスとエラー率別のトップビジネスワークフローのリストも含まれています（ビジネスワークフローは、特定のアクティビティやトランザクションに関連するトレースコレクションの開始から終了までの旅程であり、エンドツーエンドの KPI の監視やルート原因とボトルネックの特定を可能にします）。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
環境について</summary><div class=box-content><p>複数のアプリケーションを簡単に区別するために、Splunk は <strong>Environment</strong> を使用します。ワークショップ環境の命名規則は <strong>[ワークショップ名]-workshop</strong> です。インストラクターが選択する正しい環境を提供します。</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>作業している時間ウィンドウが過去 15 分（<strong>-15m</strong>）に設定されていることを確認します。</li><li>ドロップダウンボックスからワークショップ名を選択して、環境をワークショップ用に変更し、それのみが選択されていることを確認します。</li></ul><div class=tab-panel data-tab-group=R-tabs-2d3039b6274c6be82398580af6f47651><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-773ee27ffcbbc5246826cbcf43afd650 aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-2d3039b6274c6be82398580af6f47651","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-d25ee8ca4cfd5071bdf8b1a99d6079ff aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-2d3039b6274c6be82398580af6f47651","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-773ee27ffcbbc5246826cbcf43afd650 data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>エラー率別のトップサービスチャートから何を結論づけることができますか？</strong></p></div></div><div id=R-tab-id-d25ee8ca4cfd5071bdf8b1a99d6079ff data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>paymentservice</strong>はエラー率が高い</p></div></div></div></div></div></details><p>概要ページを下にスクロールすると、一部のサービスの横に<strong>Inferred Service</strong>と表示されていることに気づくでしょう。</p><p>Splunk APM は、リモートサービスを呼び出すスパンが必要な情報を持っている場合、リモートサービスまたは推測されたサービスの存在を推測できます。推測されるサービスの例としては、データベース、HTTP エンドポイント、メッセージキューなどがあります。推測されたサービスは計装されていませんが、サービスマップとサービスリストに表示されます。</p><p>次に、<strong>Splunk ログオブザーバー（LO）</strong> を確認しましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=log-observer概要>Log Observer概要</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>Log Observer Connect を使用すると、Splunk プラットフォームからの同じログデータをシームレスに直感的で<strong>コード不要</strong>のインターフェースに取り込み、問題を迅速に見つけて修正するのに役立ちます。ログベースの分析を簡単に実行し、Splunk Infrastructure Monitoring のリアルタイムメトリクスと Splunk APM トレースを 1 か所でシームレスに関連付けることができます。</p><p><strong>エンドツーエンドの可視性：</strong> Splunk プラットフォームの強力なロギング機能と Splunk Observability Cloud のトレースおよびリアルタイムメトリクスを組み合わせることで、ハイブリッド環境のより深い洞察とより多くのコンテキストを得ることができます。<br><strong>迅速かつ簡単なログベースの調査を実行：</strong> すでに Splunk Cloud Platform または Enterprise に取り込まれているログを、シンプルで直感的なインターフェース（SPL を知る必要はありません！）でカスタマイズ可能な標準搭載のダッシュボードとともに再利用することによって実現します。<br><strong>より高いスケールの経済性と運用効率を実現：</strong> チーム間でログ管理を一元化し、データとチームのサイロを壊し、全体的により良いサポートを得ることによって実現します。</p><p><a href=#R-image-0dcf429e9a8781a80f70e0be15cfb1ed class=lightbox-link><img alt=ロゴグラフ class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/4-log-observer-home/images/logo-image-loop.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0dcf429e9a8781a80f70e0be15cfb1ed><img alt=ロゴグラフ class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/4-log-observer-home/images/logo-image-loop.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>4. Log Observer概要のサブセクション</h1><article class=default><header class=headline></header><h1 id=log-observerホームページ>Log Observerホームページ</h1><p>メインメニューの<strong>Log Observer</strong>をクリックすると、Log Observer ホームページが表示されます。Log Observer ホームページは 4 つの明確なセクションで構成されています：</p><p><a href=#R-image-c42bb73de629cf445b22b66cdc07a5bb class=lightbox-link><img alt=LOページ class="lazy lightbox figure-image" loading=lazy src=../images/log-observer-main.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c42bb73de629cf445b22b66cdc07a5bb><img alt=LOページ class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer-main.png></a></p><ol><li><strong>オンボーディングペイン:</strong> SplunkLog Observer の使用を開始するためのトレーニングビデオとドキュメントへのリンク。</li><li><strong>フィルターバー:</strong> 時間、インデックス、フィールドでフィルタリングし、クエリを保存することもできます。</li><li><strong>ログテーブルペイン:</strong> 現在のフィルター条件に一致するログエントリのリスト。</li><li><strong>フィールドペイン:</strong> 現在選択されているインデックスで利用可能なフィールドのリスト。</li></ol><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Splunk Index</summary><div class=box-content><p>一般的に、Splunk では、「Index」はデータが保存される指定された場所を指します。これはデータのフォルダやコンテナのようなものです。Splunk では、「Index」はデータが保存される指定された場所を指します。これはデータのフォルダやコンテナのようなものです。Splunk 内のデータは、検索や分析が容易になるように整理され構造化されています。特定のタイプのデータを保存するために異なるインデックスを作成できます。たとえば、Web サーバーログ用のインデックス、アプリケーションログ用の別のインデックスなどがあります。</p></div></details><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ヒント</summary><div class=box-content><p>以前に Splunk Enterprise または Splunk Cloud を使用したことがある場合は、おそらくログから調査を開始することに慣れているでしょう。以下の演習で見るように、Splunk Observability Cloud でも同様のことができます。ただし、このワークショップでは、調査に<strong>OpenTelemetry</strong>のすべてのシグナルを使用します。</p></div></details><p>簡単な検索演習を行いましょう：</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><p>時間枠を <strong>-15m</strong> に設定します。</p></li><li><p>フィルターバーで<span class="btn cstyle button noicon" style=--VARIABLE-BOX-color:gray><span><span class=title>Add Filter</span></span></span>をクリックし、ダイアログで<strong>Field</strong>をクリックします。</p></li><li><p><strong>cardType</strong>と入力して選択します。</p></li><li><p><strong>トップ値</strong>の下で<strong>visa</strong>をクリックし、次に <strong>=</strong> をクリックしてフィルターに追加します。</p><p><a href=#R-image-a4ab80dbbcd1ddf420a6be53535106ac class=lightbox-link><img alt=ロゴ検索 class="lazy lightbox figure-image" loading=lazy src="../images/log-filter-bar.png?width=920px" style=height:auto;width:920px></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a4ab80dbbcd1ddf420a6be53535106ac><img alt=ロゴ検索 class="lazy lightbox lightbox-image" loading=lazy src="../images/log-filter-bar.png?width=920px"></a></p></li><li><p>ログテーブルのログエントリの 1 つをクリックして、エントリに<code>cardType: "visa"</code>が含まれていることを確認します。</p></li><li><p>出荷されたすべての注文を見つけましょう。フィルターバーの<strong>Clear All</strong>をクリックして、前のフィルターを削除します。</p></li><li><p>フィルターバーで再び<span class="btn cstyle button noicon" style=--VARIABLE-BOX-color:gray><span><span class=title>Add Filter</span></span></span>をクリックし、<strong>キーワード</strong>を選択します。次に**キーワードを入力&mldr;**ボックスに<code>order:</code>と入力し、Enter キーを押します。</p></li><li><p>これで「order:」という単語を含むログ行のみが表示されるはずです。まだたくさんのログ行があるので、さらにフィルタリングしましょう。</p></li><li><p>別のフィルターを追加します。今回は<strong>Field</strong>ボックスを選択し、<strong>Find a field &mldr;</strong> 検索ボックスに<code>severity</code>と入力して選択します。
<a href=#R-image-5356d15b74fd2abc258daee0eaf89609 class=lightbox-link><img alt=重要度 class="lazy left lightbox figure-image" loading=lazy src="../images/find-severity.png?width=15vw&classes=left" style=height:auto;width:15vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5356d15b74fd2abc258daee0eaf89609><img alt=重要度 class="lazy left lightbox lightbox-image" loading=lazy src="../images/find-severity.png?width=15vw&classes=left"></a></p></li><li><p>注文ログ行には重要度が割り当てられていないため、ダイアログボックスの下部にある<span class="btn cstyle button noicon" style=--VARIABLE-BOX-color:gray><span><span class=title><strong>Exclude all logs with this field</strong></span></span></span>をクリックしてください。これにより、他のログが削除されます。</p></li><li><p>上部にオンボーディングコンテンツがまだ表示されている場合は、<strong>Exclude all logs with this field</strong>ボタンを見るためにページを下にスクロールする必要があるかもしれません。</p></li><li><p>これで、過去 15 分間に販売された注文のリストが表示されるはずです。</p></li></ul></div></details><p>次に、<strong>Splunk Synthetics</strong>を確認しましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=synthetics概要>Synthetics概要</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>Splunk Synthetic Monitoring は、URL、API、重要な Web サービス全体に可視性を提供し、問題をより迅速に解決します。IT オペレーションとエンジニアリングチームは、問題の検出、アラート、優先順位付けを簡単に行い、複数ステップのユーザージャーニーをシミュレートし、新しいコードデプロイメントからのビジネスへの影響を測定し、ステップバイステップのガイド付き推奨事項を使用して Web パフォーマンスを最適化し、より良いデジタルエクスペリエンスを確保できます。</p><p><strong>可用性の確保：</strong> ユーザーエクスペリエンスを構成する複数ステップのワークフローをシミュレートするカスタマイズ可能なブラウザテストで、重要なサービス、URL、API の健全性と可用性を事前に監視し、アラートを出します。<br><strong>メトリクスの改善：</strong> コアウェブバイタルとモダンパフォーマンスメトリクスにより、ユーザーはすべてのパフォーマンス欠陥を 1 か所で表示し、ページ読み込み、インタラクティビティ、視覚的安定性を測定して改善し、JavaScript エラーを見つけて修正してページパフォーマンスを向上させることができます。<br><strong>フロントエンドからバックエンドまで：</strong> Splunk APM、Infrastructure Monitoring、On-Call、ITSI との統合により、チームはエンドポイントの稼働時間をバックエンドサービス、基盤となるインフラストラクチャ、およびインシデント対応の調整との関連で表示し、単一の UI 内で環境全体をトラブルシューティングできます。<br><strong>検出とアラート：</strong> エンドユーザー体験を監視してシミュレートし、顧客に影響を与える前に API、サービスエンドポイント、重要なビジネストランザクションの問題を検出、通信、解決します。<br><strong>ビジネスパフォーマンス：</strong> 主要なビジネストランザクションの複数ステップのユーザーフローを簡単に定義し、数分で重要なユーザージャーニーの記録とテストを開始します。稼働時間とパフォーマンスの SLA と SLO を追跡・報告します。<br><strong>フィルムストリップとビデオ再生：</strong> 画面録画、フィルムストリップ、スクリーンショットを、最新のパフォーマンススコア、競合ベンチマーキング、メトリクスとともに表示して、人工的なエンドユーザー体験を視覚化します。ビジュアルコンテンツを配信する速度を最適化し、ページの安定性とインタラクティビティを向上させて、より良いデジタルエクスペリエンスをデプロイします。</p><p><a href=#R-image-38abe3836ad4525a088fa2a447a93fb5 class=lightbox-link><img alt=Synthetics概要 class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/5-synthetics-home/images/synthetic-tests.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-38abe3836ad4525a088fa2a447a93fb5><img alt=Synthetics概要 class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/5-synthetics-home/images/synthetic-tests.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>5. Synthetics概要のサブセクション</h1><article class=default><header class=headline></header><h1 id=syntheticsホームページ>Syntheticsホームページ</h1><p>メインメニューの<strong>Synthetics</strong>をクリックします。これにより、Synthetics ホームページに移動します。このページには、役立つ情報を提供するか、Synthetic テストを選択または作成できる 3 つの明確なセクションがあります。</p><p><a href=#R-image-5269ae91472e4ab8dcc7b96c84c3572e class=lightbox-link><img alt=Syntheticメイン class="lazy lightbox figure-image" loading=lazy src=../images/synthetics-main.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5269ae91472e4ab8dcc7b96c84c3572e><img alt=Syntheticメイン class="lazy lightbox lightbox-image" loading=lazy src=../images/synthetics-main.png></a></p><ol><li><strong>オンボーディングペイン:</strong> SplunkSynthetics の使用を開始するためのトレーニングビデオとドキュメントへのリンク。</li><li><strong>テストペイン:</strong> 設定されているすべてのテスト（<strong>ブラウザ</strong>、<strong>API</strong>、<strong>稼働時間</strong>）のリスト。</li><li><strong>テスト作成ペイン:</strong> 新しい Synthetic テストを作成するためのドロップダウン。</li></ol><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
情報</summary><div class=box-content><p>ワークショップの一環として、実行しているアプリケーションに対するデフォルトのブラウザテストを作成しています。テストペイン（<strong>2</strong>）でそれを見つけることができます。名前は<strong>Workshop Browser Test for</strong>で、その後にワークショップの名前が続きます（インストラクターがそれを提供しているはずです）。</p></div></details><p>ツアーを続けるために、ワークショップの自動ブラウザテストの結果を見てみましょう。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>テストペインで、ワークショップの名前を含む行をクリックします。結果は次のようになります：</li></ul><p><a href=#R-image-19f7ad107e704be49bb0710bb57b67bb class=lightbox-link><img alt=Synthetics概要 class="lazy lightbox figure-image" loading=lazy src=../images/synthetics-test-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-19f7ad107e704be49bb0710bb57b67bb><img alt=Synthetics概要 class="lazy lightbox lightbox-image" loading=lazy src=../images/synthetics-test-overview.png></a></p><ul><li>注意：Synthetic テストページでは、最初のペインに過去 1 日、8 日、30 日間のサイトのパフォーマンスが表示されます。上のスクリーンショットに示すように、テストが過去に十分遡って開始された場合のみ、対応するチャートに有効なデータが含まれます。ワークショップでは、これはワークショップが作成された時期によって異なります。</li><li>パフォーマンス KPI ドロップダウンで、デフォルトの 4 時間から過去 1 時間に時間を変更します。</li></ul><div class=tab-panel data-tab-group=R-tabs-44d6942417861018a2169b26ce8e9b51><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d98f91cda9ab497692b3ac9b202744a6 aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-44d6942417861018a2169b26ce8e9b51","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-c439258e2efa967793f785f80bd38852 aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-44d6942417861018a2169b26ce8e9b51","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-d98f91cda9ab497692b3ac9b202744a6 data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>テストはどのくらいの頻度で、どこから実行されていますか？</strong></p></div></div><div id=R-tab-id-c439258e2efa967793f785f80bd38852 data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>テストは<strong>1 分間隔</strong>でラウンドロビン方式により<strong>フランクフルト、ロンドン、パリ</strong>から実行されています</p></div></div></div></div></div></details><p>次に、<strong>Splunk インフラストラクチャモニタリング（IM）</strong> を使用して、アプリケーションが実行されているインフラストラクチャを調べてみましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=インフラストラクチャ概要>インフラストラクチャ概要</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>Splunk Infrastructure Monitoring（IM）は、ハイブリッドクラウド環境向けの市場をリードする監視および可観測性サービスです。特許取得済みのストリーミングアーキテクチャに基づいて構築されており、従来のソリューションよりもはるかに短時間で、より高い精度でインフラストラクチャ、サービス、アプリケーション全体のパフォーマンスを視覚化および分析するための<strong>リアルタイム</strong>ソリューションをエンジニアリングチームに提供します。</p><p><strong>OpenTelemetry 標準化：</strong> データの完全な制御を提供し、ベンダーロックインから解放し、独自のエージェントの実装から解放します。<br><strong>Splunk の OTel コレクター：</strong> シームレスなインストールと動的な構成により、スタック全体を数秒で自動検出し、クラウド、サービス、システム全体の可視性を提供します。<br><strong>300 以上の使いやすい標準コンテンツ：</strong> 事前構築されたナビゲーターとダッシュボードにより、環境全体の即時の視覚化を提供し、すべてのデータとリアルタイムで対話できます。<br><strong>Kubernetes ナビゲーター：</strong> ノード、ポッド、コンテナの包括的な標準的な階層ビューを即座に提供します。わかりやすいインタラクティブなクラスターマップで、最も初心者の Kubernetes ユーザーでもすぐに使いこなせます。<br><strong>AutoDetect アラートとディテクター：</strong> 最も重要なメトリクスを標準で自動的に識別し、テレメトリデータが取り込まれた瞬間から正確にアラートを出すディテクターのアラート条件を作成し、重要な通知のために数秒でリアルタイムのアラート機能を使用します。<br><strong>ダッシュボード内のログビュー：</strong> 共通のフィルターと時間制御を使用して、ログメッセージとリアルタイムメトリクスを 1 ページに組み合わせ、より迅速なコンテキスト内トラブルシューティングを実現します。<br><strong>メトリクスパイプライン管理：</strong> 再計装なしに取り込み時点でメトリクスの量を制御し、必要なデータのみを保存して分析するための集約およびデータ削除ルールのセットを使用します。メトリクスの量を削減し、可観測性のコストを最適化します。</p><p><a href=#R-image-ad4a72ec7c8b932ecae7f26dabb19958 class=lightbox-link><img alt=インフラストラクチャ概要 class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/6-infrastructure-home/images/infrastructure-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ad4a72ec7c8b932ecae7f26dabb19958><img alt=インフラストラクチャ概要 class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/3-quick-tour/6-infrastructure-home/images/infrastructure-overview.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=ショッピングに行きましょう->ショッピングに行きましょう 💶</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<details open class="box cstyle notices orange"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-user"></i>
ペルソナ</summary><div class=box-content><p>あなたは次の目新しいアイテムを有名なオンラインブティックショップで購入したいと思っている<strong>おしゃれな都会人</strong>です。オンラインブティックはあなたのヒップスターな要求すべてを満たすための場所だと聞いています。</p></div></details><p>この演習の目的は、オンラインブティックウェブアプリケーションと対話することです。これは Splunk Observability Cloud の機能を実演するために使用されるサンプルアプリケーションです。このアプリケーションは簡単な E コマースサイトで、商品の閲覧、カートへの追加、そして精算が可能です。</p><p>このアプリケーションはすでにデプロイされており、インストラクターがオンラインブティックウェブサイトへのリンクを提供します。例：</p><ul><li><strong>http://&lt;s4r-workshop-i-xxx.splunk>.show:81/</strong>。アプリケーションは<strong>80</strong>および<strong>443</strong>ポートでも実行されているので、そちらを使用するか、ポート<strong>81</strong>が到達不能な場合はそれらを使用することもできます。</li></ul><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習 - ショッピングに行きましょう</summary><div class=box-content><ul><li>オンラインブティックへのリンクが得られたら、いくつかの商品を閲覧し、カートに追加し、最後に精算を行ってください。</li><li>この演習を数回繰り返し、可能であれば異なるブラウザ、モバイルデバイス、またはタブレットを使用してください。これによりより多くのデータが生成され、探索できるようになります。</li></ul></div></details><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ヒント</summary><div class=box-content><p>ページの読み込みを待っている間は、ページ上でマウスカーソルを動かしてください。これにより、このワークショップの後半で探索するためのより多くのデータが生成されます。</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習 (続き)</summary><div class=box-content><ul><li>精算プロセスについて何か気づいたことはありますか？完了までに時間がかかったように思えましたが、最終的には完了しましたか？こうした場合は、<strong>注文確認 ID</strong>をコピーしてローカルに保存してください。後で必要になります。</li><li>ショッピングに使用したブラウザセッションを閉じてください。</li></ul></div></details><p>これは、ユーザーエクスペリエンスが悪い場合の感覚で、これは潜在的な顧客満足度の問題であるため、すぐにトラブルシューティングを行う必要があります。</p><p><a href=#R-image-9a4dea170669a8fc3e8414da4b6537e4 class=lightbox-link><img alt=オンラインブティック class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/4-online-boutique/images/shop.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9a4dea170669a8fc3e8414da4b6537e4><img alt=オンラインブティック class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/splunk4rookies/observability-cloud/4-online-boutique/images/shop.png></a></p><p><strong>Splunk RUM</strong>でデータがどのように見えるか確認してみましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><article class=default><header class=headline></header><h1 id=splunk-rum>Splunk RUM</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<details open class="box cstyle notices orange"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-user"></i>
ペルソナ</summary><div class=box-content><p>あなたは<strong>フロントエンドエンジニア</strong>または<strong>SRE</strong>で、パフォーマンス問題の最初のトリアージを行うよう任されています。オンラインブティックアプリケーションに関する潜在的な顧客満足度の問題を調査するよう依頼されました。</p></div></details><p>すべての参加者のブラウザセッションから受信したテレメトリによって提供された実際のユーザーデータを調査します。目標は、パフォーマンスの悪かったブラウザ、モバイル、またはタブレットセッションを見つけて、トラブルシューティングプロセスを開始することです。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>5. Splunk RUMのサブセクション</h1><article class=default><header class=headline></header><h1 id=1-rumダッシュボード>1. RUMダッシュボード</h1><p>Splunk Observability Cloud のメインメニューから、<strong>RUM</strong>をクリックします。RUM ホームページに到着します。このビューについては、先ほどの短い紹介ですでに説明しました。</p><p><a href=#R-image-e6483622782b61473870dabe06c3d8a8 class=lightbox-link><img alt=複数のアプリ class="lazy lightbox figure-image" loading=lazy src=../images/rum-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e6483622782b61473870dabe06c3d8a8><img alt=複数のアプリ class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-dashboard.png></a></p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>ドロップダウンが以下のように設定/選択されていることを確認して、ワークショップを選択してください：<ul><li><strong>時間枠</strong>は <strong>-15m</strong> に設定されていること。</li><li>選択されている<strong>Environment</strong>は <strong>[ワークショップ名]-workshop</strong> であること。</li><li>選択されている<strong>App</strong>は <strong>[ワークショップ名]-store</strong> であること。</li><li><strong>Source</strong>は<strong>All</strong>に設定されていること。</li></ul></li><li>次に、<strong>Page Views / JavaScript Errors</strong>チャートの上にある <strong>[ワークショップ名]-store</strong> をクリックします。</li><li>これにより、<strong>UX Metrics</strong>、<strong>Front-end Health</strong>、<strong>Back-end Health</strong>、<strong>Custom Events</strong>ごとにメトリクスを分類し、過去のメトリクス（デフォルトでは 1 時間）と比較する新しいダッシュボードビューが表示されます。</li></ul></div></details><p><a href=#R-image-4206055e6ca4e7dbe31def264bcc4b18 class=lightbox-link><img alt=RUMダッシュボード class="lazy lightbox figure-image" loading=lazy src=../images/rum-metrics-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4206055e6ca4e7dbe31def264bcc4b18><img alt=RUMダッシュボード class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-metrics-dashboard.png></a></p><ul><li><strong>UX Metrics:</strong> ページビュー、ページロード、Web バイタルメトリクス。</li><li><strong>Front-end Health:</strong> JavaScript エラーとロングタスクの期間と数の内訳。</li><li><strong>Back-end Health:</strong> ネットワークエラー、リクエスト、最初のバイトまでの時間。</li><li><strong>Custom Events:</strong> Custom Events の RED メトリクス（レート、エラー、期間）。</li></ul><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>各タブ（<strong>UX Metrics</strong>、<strong>Front-end Health</strong>、<strong>Back-end Health</strong>、<strong>Custom Events</strong>）をクリックしてデータを調べます。</li></ul><div class=tab-panel data-tab-group=R-tabs-c165ff46de3539a21d46550cfae8f216><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-bf690c31bc128dcb6acb62d952489c05 aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c165ff46de3539a21d46550cfae8f216","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-0f7aaef02ba0ca429fcad2bc3b7b7438 aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c165ff46de3539a21d46550cfae8f216","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-bf690c31bc128dcb6acb62d952489c05 data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>「Custom Events」タブのチャートを調べると、<strong>どのチャート</strong>が<strong>レイテンシースパイクを</strong>明確に示していますか？</p></div></div><div id=R-tab-id-0f7aaef02ba0ca429fcad2bc3b7b7438 data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>それは <strong>「Custom Event Latency」</strong> チャートです</p></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=2-tag-spotlight>2. Tag Spotlight</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><p><strong>Custom Events</strong>タブを選択して、そのタブにいることを確認します。</p></li><li><p><strong>Custom Event Latency</strong>チャートを見てください。ここに表示されているメトリクスはアプリケーションのレイテンシーを示しています。横の比較メトリクスは、1 時間前（上部のフィルターバーで選択されています）と比較したレイテンシーを示しています。</p></li><li><p>チャートタイトルの下にある<strong>すべて表示</strong>リンクをクリックします。</p></li></ul></div></details><p><a href=#R-image-e4e4ff60e5722f25360b88ede01ed2c8 class=lightbox-link><img alt="RUM Tag Spotlight" class="lazy lightbox figure-image" loading=lazy src=../images/rum-tag-spotlight.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e4e4ff60e5722f25360b88ede01ed2c8><img alt="RUM Tag Spotlight" class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-tag-spotlight.png></a></p><p>このダッシュボードビューでは、RUM データに関連付けられたすべてのタグが表示されます。タグはデータを識別するために使用されるキーと値のペアです。この場合、タグは OpenTelemetry 計装によって自動的に生成されます。タグはデータをフィルタリングし、チャートやテーブルを作成するために使用されます。Tag Spotlight ビューでは、ユーザーセッションを詳しく調べることができます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>時間枠を<strong>過去 1 時間</strong>に変更します。</li><li><strong>Add filters</strong>をクリックし、<strong>OS Version</strong>を選択し、<strong>!=<strong>をクリックして</strong>Synthetics</strong>と<strong>RUMLoadGen</strong>を選択し、<span class="btn cstyle button blue noicon"><span><span class=title>フィルターを適用</span></span></span>ボタンをクリックします。</li><li><strong>Custom Events Name</strong>チャートを見つけ、リスト内の<strong>PlaceOrder</strong>を見つけてクリックし、<strong>Add to filter</strong>を選択します。</li><li>上部のグラフに大きなスパイクがあることに注目してください。</li><li><strong>User Session</strong>タブをクリックします。</li><li><strong>Duration</strong>の見出しを 2 回クリックして、セッションを期間で並べ替えます（最も長いものが上部に表示されます）。</li><li>テーブルの上にある<i class="fa-fw fas fa-cog"></i>をクリックし、追加の列のリストから<strong>Sf Geo City</strong>を選択し、<span class="btn cstyle button blue noicon"><span><span class=title>保存</span></span></span>をクリックします。</li></ul></div></details><p>これで、最も長い期間の降順でソートされたユーザーセッションテーブルができました。このテーブルには、サイトでショッピングしたすべてのユーザーの都市も含まれています。OS バージョン、ブラウザバージョンなど、さらにフィルターを適用してデータを絞り込むこともできます。</p><p><a href=#R-image-65178cfe87c255b1727938787e584655 class=lightbox-link><img alt="RUMTag Spotlight" class="lazy lightbox figure-image" loading=lazy src=../images/rum-user-sessions.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-65178cfe87c255b1727938787e584655><img alt="RUMTag Spotlight" class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-user-sessions.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=3-セッションリプレイ>3. セッションリプレイ</h1><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
セッション</summary><div class=box-content><p>セッションは、ユーザーがアプリケーションと対話する際に実行するアクションに対応するトレースの集まりです。デフォルトでは、セッションはセッションでキャプチャされた最後のイベントから 15 分経過するまで続きます。最大セッション時間は 4 時間です。</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>User Session</strong>テーブルで、最も長い<strong>Duration</strong>（20 秒以上）の上位の<strong>Session ID</strong>をクリックすると、RUM セッションビューに移動します。</li></ul></div></details><p><a href=#R-image-2af5eee548bb6a172839e361a2182aa4 class=lightbox-link><img alt=RUMセッション class="lazy lightbox figure-image" loading=lazy src=../images/rum-session.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2af5eee548bb6a172839e361a2182aa4><img alt=RUMセッション class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-session.png></a></p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>RUM セッションリプレイ<span class="btn cstyle button transparent"><span><i class="fa-fw fas fa-play"></i> <span class=title>Replay</span></span></span>ボタンをクリックします。RUM セッションリプレイでは、ユーザーセッションを再生して確認することができます。これはユーザーが体験した内容を正確に確認するための優れた方法です。</li><li>ボタンをクリックしてリプレイを開始します。</li></ul></div></details><p>RUM セッションリプレイでは情報を編集することができます。デフォルトではテキストが編集されます。画像も編集することができます（このワークショップ例では実施済み）。これは、機密情報が含まれるセッションを再生する場合に役立ちます。また、再生速度を変更したり、再生を一時停止したりすることもできます。</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ヒント</summary><div class=box-content><p>セッションを再生する際、マウスの動きがキャプチャされていることに注目してください。これは、ユーザーがどこに注意を向けているかを確認するのに役立ちます。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=4-ユーザーセッション>4. ユーザーセッション</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>右上隅の<strong>X</strong>をクリックして、RUM セッションリプレイを閉じます。</li><li>スパンの長さに注目してください。これは注文を完了するのにかかった時間で、良くありません！</li><li>ページを下にスクロールすると、<strong>タグ</strong>メタデータ（Tag Spotlight で使用されるもの）が表示されます。タグの後に、ウォーターフォールが表示され、読み込まれたページオブジェクト（HTML、CSS、画像、JavaScript など）が表示されます。</li><li>ページを下にスクロールし続けて、青い<strong>APM</strong>リンク（URL の末尾に<code>/cart/checkout</code>があるもの）まで移動し、その上にカーソルを置きます。</li></ul></div></details><p><a href=#R-image-083c55fa7269f49220af671f44bb995f class=lightbox-link><img alt=RUMセッション class="lazy lightbox figure-image" loading=lazy src=../images/rum-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-083c55fa7269f49220af671f44bb995f><img alt=RUMセッション class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-waterfall.png></a></p><p>これにより APM パフォーマンスサマリーが表示されます。このエンドツーエンド（RUM から APM）のビューは、問題のトラブルシューティングを行う際に非常に便利です。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>上のスクリーンショットのように、<strong>paymentservice</strong>と<strong>checkoutservice</strong>がエラー状態にあることがわかります。</li><li><strong>ワークフロー名</strong>の下にある<code>front-end:/cart/checkout</code>をクリックすると、<strong>APM サービスマップ</strong>が表示されます。</li></ul></div></details><p><a href=#R-image-a2924eb8664906d2b05f26f597f3e056 class=lightbox-link><img alt=RUMからAPMへ class="lazy lightbox figure-image" loading=lazy src=../images/rum-to-apm.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a2924eb8664906d2b05f26f597f3e056><img alt=RUMからAPMへ class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-to-apm.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=splunk-apm>Splunk APM</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<details open class="box cstyle notices orange"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-user"></i>
ペルソナ</summary><div class=box-content><p>あなたは<strong>バックエンド開発者</strong>で、SRE が発見した問題の調査を手伝うよう依頼されました。SRE はユーザーエクスペリエンスの低下を特定し、あなたにその問題を調査するよう依頼しました。</p></div></details><p>RUM トレース（フロントエンド）から APM トレース（バックエンド）にジャンプすることで、完全なエンドツーエンドの可視性の力を発見します。すべてのサービスはテレメトリ（トレースとスパン）を送信しており、Splunk Observability Cloud はこれを視覚化、分析し、異常やエラーを検出するために使用できます。</p><p>RUM と APM は同じコインの表と裏です。RUM はアプリケーションのクライアント側からの視点であり、APM はサーバー側からの視点です。このセクションでは、APM を使用して掘り下げ、問題がどこにあるかを特定します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>6. Splunk APMのサブセクション</h1><article class=default><header class=headline></header><h1 id=1-apm探索>1. APM探索</h1><p>APM サービスマップは、APM で計装された（インストルメンテーション）サービスと推測されるサービスの間の依存関係と接続を表示します。このマップは、時間範囲、環境、ワークフロー、サービス、タグフィルターでの選択に基づいて動的に生成されます。</p><p>RUM ウォーターフォールで APM リンクをクリックすると、そのワークフロー名（<code>frontend:/cart/checkout</code>）に関連するサービスを表示するために、サービスマップビューに自動的にフィルターが追加されました。</p><p>ワークフローに関連するサービスは<strong>Service Map</strong>で確認できます。サイドペインの<strong>Business Workflow</strong>の下には、選択したワークフローのチャートが表示されています。<strong>Service Map</strong>とビジネスワークフローチャートは同期しています。<strong>Service Map</strong>でサービスを選択すると、<strong>Business Workflow</strong>ペインのチャートが更新され、選択したサービスのメトリクスが表示されます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>サービスマップで<strong>paymentservice</strong>をクリックします。</li></ul></div></details><p><a href=#R-image-5e1a92a9c686f641e22049b964053345 class=lightbox-link><img alt=APM探索 class="lazy lightbox figure-image" loading=lazy src=../images/apm-business-workflow.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5e1a92a9c686f641e22049b964053345><img alt=APM探索 class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-business-workflow.png></a></p><p>Splunk APM はまた、リアルタイムで発生している問題を確認し、問題がサービス、特定のエンドポイント、または基盤となるインフラストラクチャに関連しているかどうかを迅速に判断するのに役立つ組み込みの <strong>Service Centric View(サービス中心ビュー)</strong> も提供しています。より詳しく見てみましょう。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>右側のペインで、青色の<strong>paymentservice</strong>をクリックします。</li></ul></div></details><p><a href=#R-image-b6ec2a1682965f1e3ca89e132a558eca class=lightbox-link><img alt=APMサービス class="lazy lightbox figure-image" loading=lazy src=../images/apm-service.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b6ec2a1682965f1e3ca89e132a558eca><img alt=APMサービス class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-service.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=2-apmサービスビュー>2. APMサービスビュー</h1><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
サービスビュー</summary><div class=box-content><p>サービスオーナーとして、Splunk APM のサービスビューを使用して、単一のパネルでサービスの健全性の完全なビューを取得できます。サービスビューには、可用性、依存関係、リクエスト、エラー、および期間（RED）メトリクス、ランタイムメトリクス、インフラストラクチャメトリクス、Tag Spotlight、エンドポイント、および選択したサービスのログのためのサービスレベルインジケーター（SLI）が含まれています。また、サービスビューからサービスのコードプロファイリングとメモリプロファイリングにすぐにアクセスすることもできます。</p></div></details><p><a href=#R-image-1bcc83f250745576aef782d6bf77095c class=lightbox-link><img alt=サービスダッシュボード class="lazy lightbox figure-image" loading=lazy src=../images/apm-service-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1bcc83f250745576aef782d6bf77095c><img alt=サービスダッシュボード class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-service-dashboard.png></a></p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>時間</strong>ボックスを確認すると、ダッシュボードは以前に選択した APM トレースが完了するまでにかかった時間に関連するデータのみを表示していることがわかります（チャートは静的であることに注意してください）。</li><li><strong>時間</strong>ボックスで時間枠を <strong>-1h</strong> に変更します。</li><li>これらのチャートはパフォーマンスの問題を素早く特定するのに非常に役立ちます。このダッシュボードを使用して、サービスの健全性を監視できます。</li><li>ページを下にスクロールして<strong>Infrustructure Metrics</strong>を展開します。ここでホストと Pod のメトリクスが表示されます。</li><li><strong>Runtime Metrics</strong>は、Node.js で書かれたサービスにはプロファイリングデータが利用できないため、使用できません。</li><li>では、探索ビューに戻りましょう。ブラウザの戻るボタンを押してください。</li></ul></div></details><p><a href=#R-image-b039c55c52630f737df90d109ca90603 class=lightbox-link><img alt=APM探索 class="lazy lightbox figure-image" loading=lazy src=../images/apm-business-workflow.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b039c55c52630f737df90d109ca90603><img alt=APM探索 class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-business-workflow.png></a></p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-b679d91cd5569d648390904e332ded52><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-e14521986f4a46ddb7f17b57f7539038 aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b679d91cd5569d648390904e332ded52","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-059a857370bb2ba0c396a3e160fd06eb aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-b679d91cd5569d648390904e332ded52","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-e14521986f4a46ddb7f17b57f7539038 data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>サービスマップで<strong>paymentservice</strong>の上にカーソルを置いてください。ポップアップサービスチャートからどのような結論を導き出せますか？</p></div></div><div id=R-tab-id-059a857370bb2ba0c396a3e160fd06eb data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>エラーの割合が非常に高い。</strong></p></div></div></div></div></div></details><p><a href=#R-image-e66c4b4053c6202bb7e95dcf601e4e50 class=lightbox-link><img alt=APMサービスチャート class="lazy lightbox figure-image" loading=lazy src=../images/apm-service-popup-chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e66c4b4053c6202bb7e95dcf601e4e50><img alt=APMサービスチャート class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-service-popup-chart.png></a></p><p>このエラー率にパターンがあるかどうかを理解する必要があります。そのための便利なツール、<strong>Tag Spotlight</strong>があります。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=3-apm-tag-spotlight>3. APM Tag Spotlight</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>paymentservice</strong>のタグを表示するには、<strong>paymentservice</strong>をクリックし、右側の機能ペインの<strong>Tag Spotlight</strong>をクリックします（画面の解像度によっては下にスクロールする必要があるかもしれません）。</li><li><strong>Tag Spotlight</strong>に入ったら、フィルターアイコンから<strong>Show tags with no values</strong>チェックボックスがオフになっていることを確認してください。</li></ul></div></details><p><a href=#R-image-652945e68f225731756f243842587ab2 class=lightbox-link><img alt="APM Tag Spotlight" class="lazy lightbox figure-image" loading=lazy src=../images/apm-tag-spotlight.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-652945e68f225731756f243842587ab2><img alt="APM Tag Spotlight" class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-tag-spotlight.png></a></p><p><strong>Tag Spotlight</strong>のビューは、チャートとカードの両方で設定可能です。デフォルトでは<strong>リクエストとエラー</strong>に設定されています。</p><p>また、カードに表示されるタグメトリクスを設定することも可能です。以下の任意の組み合わせを選択できます：</p><ul><li>Requests</li><li>Errors</li><li>Root Cause errors</li><li>P50 Latency</li><li>P90 Latency</li><li>P99 Latency</li></ul><p>改めて、フィルターアイコンから<strong>Show tags with no values</strong>チェックボックスがオフになっていることを確認してください。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-1dc3a1b9e9e1bf3a1218a58470c4429e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-5422a48482dce9be468d28e94af482bc aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1dc3a1b9e9e1bf3a1218a58470c4429e","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-96cfc7741cbff79237cfbdf70ffa676e aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-1dc3a1b9e9e1bf3a1218a58470c4429e","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-5422a48482dce9be468d28e94af482bc data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>どのカードが問題を特定するタグを明らかにしていますか？</strong></p></div></div><div id=R-tab-id-96cfc7741cbff79237cfbdf70ffa676e data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>「Version」カードです。<code>v350.10</code>に対するリクエスト数がエラー数と一致しています（つまり 100%）</strong></p></div></div></div></div></div></details><p><strong>paymentservice</strong>の問題を引き起こしているバージョンを特定したので、エラーについてさらに詳しい情報が見つかるか確認してみましょう。ページ上部の <strong>← Tag Spotlight</strong> をクリックして、サービスマップに戻ります。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=4-apmサービスブレイクダウン>4. APMサービスブレイクダウン</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>サービスマップで<strong>paymentservice</strong>を選択します。</li><li>右側のペインで<span class="btn cstyle button grey noicon"><span><span class=title>Breakdown</span></span></span>をクリックします。</li><li>リストから<code>tenant.level</code>を選択します。</li><li>サービスマップに戻り、<strong>gold</strong>をクリックします。</li><li><span class="btn cstyle button grey noicon"><span><span class=title>Breakdown</span></span></span>をクリックして<code>version</code>を選択します。これはサービスバージョンを表示するタグです。</li><li>これを<strong>silver</strong>と<strong>bronze</strong>についても繰り返します。</li></ul><div class=tab-panel data-tab-group=R-tabs-8595e1d11be7bb4209082dc1fc1c203c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d4e1626b663ecffe3255e636e0ef4c95 aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-8595e1d11be7bb4209082dc1fc1c203c","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-3bde40984055b06b2fba0699c096c103 aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-8595e1d11be7bb4209082dc1fc1c203c","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-d4e1626b663ecffe3255e636e0ef4c95 data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>表示されている内容からどのような結論が導き出せますか？</strong></p></div></div><div id=R-tab-id-3bde40984055b06b2fba0699c096c103 data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>すべての<code>tenant.level</code>が<code>v350.10</code>の影響を受けています</strong></p></div></div></div></div></div></details><p>これで<strong>paymentservice</strong>が<strong>gold</strong>、<strong>silver</strong>、<strong>bronze</strong>の 3 つのサービスに分解されているのが確認できます。各テナントは 2 つのサービスに分解されており、それぞれのバージョン（<code>v350.10</code>と<code>v350.9</code>）に対応しています。</p><p><a href=#R-image-7d6091b42a2da4b8d52d2fe7d6a93aee class=lightbox-link><img alt=APMサービスブレイクダウン class="lazy lightbox figure-image" loading=lazy src=../images/apm-service-breakdown.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7d6091b42a2da4b8d52d2fe7d6a93aee><img alt=APMサービスブレイクダウン class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-service-breakdown.png></a></p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
スパンタグ</summary><div class=box-content><p>スパンタグを使用してサービスを分解することは非常に強力な機能です。これにより、異なる顧客、異なるバージョン、異なる地域などに対して、サービスがどのようにパフォーマンスを発揮しているかを確認できます。この演習では、<strong>paymentservice</strong>の<code>v350.10</code>がすべての顧客に問題を引き起こしていることを特定しました。</p></div></details><p>次に、何が起きているかを確認するためにトレースを詳しく調べる必要があります。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=5-apmトレースアナライザー>5. APMトレースアナライザー</h1><p>Splunk APM はすべてのサービスの<strong>NoSample</strong>（サンプリングなし）エンドツーエンドの可視性を提供するため、Splunk APM はすべてのトレースをキャプチャします。このワークショップでは、<strong>Order Confirmation ID</strong>がタグとして利用可能です。これは、ワークショップの前半で遭遇した不良なユーザー体験の正確なトレースを検索するためにこれを使用できることを意味します。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
トレースアナライザー</summary><div class=box-content><p>Splunk Observability Cloud は、アプリケーション監視データを探索するためのいくつかのツールを提供しています。<strong>Trace Analyzer</strong>は、未知または新しい問題を調査するための高カーディナリティ、高粒度の検索と探索が必要なシナリオに適しています。</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>paymentservice</strong>の外側のボックスを選択した状態で、右側のペインで<strong>Trace</strong>をクリックします。</li><li><strong>Trace Analyzer</strong>を使用していることを確認するため、<span class="btn cstyle button transparent noicon"><span><span class=title>ク Switch to Classic View</span></span></span>ボタンが表示されていることを確認します。表示されていない場合は、<span class="btn cstyle button blue noicon"><span><span class=title>Switch to Trace Analyzer</span></span></span>をクリックします。</li><li><strong>時間範囲</strong>を<strong>過去 15 分</strong>に設定します。</li><li><strong>Sample Ratio</strong>が<code>1:10</code>ではなく<code>1:1</code>に設定されていることを確認します。</li></ul></div></details><p><a href=#R-image-8a99a2fe37965b5bedfa62c4ba97fa4f class=lightbox-link><img alt=APMトレースアナライザー class="lazy lightbox figure-image" loading=lazy src=../images/apm-trace-analyzer.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8a99a2fe37965b5bedfa62c4ba97fa4f><img alt=APMトレースアナライザー class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-trace-analyzer.png></a></p><p><strong>Trace & Error count</strong>ビューは、積み上げ棒グラフで合計トレース数とエラーのあるトレース数を表示します。マウスを使用して、利用可能な時間枠内の特定の期間を選択できます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>Trace & Error count</strong>と表示されているドロップダウンメニューをクリックし、<strong>Trace Duration</strong>に変更します</li></ul></div></details><p><a href=#R-image-4f7b1225ec760b721f700fe87c668498 class=lightbox-link><img alt=APMトレースアナライザーヒートマップ class="lazy lightbox figure-image" loading=lazy src=../images/apm-trace-analyzer-heat-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4f7b1225ec760b721f700fe87c668498><img alt=APMトレースアナライザーヒートマップ class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-trace-analyzer-heat-map.png></a></p><p><strong>Trace Duration</strong>ビューは、期間ごとのトレースのヒートマップを表示します。ヒートマップは 3 次元のデータを表しています：</p><ul><li>x 軸の時間</li><li>y 軸のトレース期間</li><li>ヒートマップの色合いで表される 1 秒あたりのトレース（またはリクエスト）数</li></ul><p>マウスを使ってヒートマップ上の領域を選択し、特定の時間帯とトレース期間の範囲にフォーカスすることができます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>Trace Duration</strong>から<strong>Trace & Error count</strong>に戻します。</li><li>時間選択で<strong>過去 1 時間</strong>を選択します。</li><li>ほとんどのトレースにエラー（赤）があり、エラーのないトレース（青）は限られていることに注意してください。</li><li><strong>Sample Ratio</strong>が<code>1:10</code>ではなく<code>1:1</code>に設定されていることを確認します。</li><li><strong>Add filters</strong>をクリックし、<code>orderId</code>と入力してリストから<strong>orderId</strong>を選択します。</li><li>ワークショップの前半でショッピングを行った際の<strong>Order Confirmation ID</strong>を貼り付けて Enter キーを押します。もし ID を記録していない場合は、インストラクターに確認してください。
<a href=#R-image-b78272dbb83fa8dc7db45231cbf842ea class=lightbox-link><img alt=期間別トレース class="lazy lightbox figure-image" loading=lazy src=../images/apm-trace-by-duration.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b78272dbb83fa8dc7db45231cbf842ea><img alt=期間別トレース class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-trace-by-duration.png></a></li></ul></div></details><p>これで、非常に長いチェックアウト待ちという不良なユーザーエクスペリエンスに遭遇した正確なトレースまでフィルタリングできました。</p><p>このトレースを表示することの二次的な利点は、トレースが最大 13 か月間アクセス可能であることです。これにより、開発者は後の段階でこの問題に戻り、このトレースを引き続き表示することができます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>リスト内のトレースをクリックします。</li></ul></div></details><p>次に、トレースウォーターフォールを確認していきます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=6-apmウォーターフォール>6. APMウォーターフォール</h1><p><strong>トレースアナライザー</strong>から<strong>トレースウォーターフォール</strong>に到達しました。トレースは同じトレース ID を共有するスパンの集まりで、アプリケーションとその構成サービスによって処理される一意のトランザクションを表します。</p><p>Splunk APM の各スパンは、単一の操作をキャプチャします。Splunk APM は、スパンがキャプチャする操作がエラーになった場合、そのスパンをエラースパンとみなします。</p><p><a href=#R-image-677df9c3fcb9e2223d26a13312bb5272 class=lightbox-link><img alt=トレースウォーターフォール class="lazy lightbox figure-image" loading=lazy src=../images/apm-trace-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-677df9c3fcb9e2223d26a13312bb5272><img alt=トレースウォーターフォール class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-trace-waterfall.png></a></p><p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>ウォーターフォール内の任意の<code>paymentservice:grpc.hipstershop.PaymentService/Charge</code>スパンの横にある<span class="btn cstyle button red noicon"><span><span class=title>!</span></span></span>をクリックします。</li></ul><div class=tab-panel data-tab-group=R-tabs-415fede37663af97e19d4ef095d8b168><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c9e202a1691d3f224d280117be78d491 aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-415fede37663af97e19d4ef095d8b168","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-566aacb1c8d5c1d0804556b5157769c7 aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-415fede37663af97e19d4ef095d8b168","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-c9e202a1691d3f224d280117be78d491 data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>スパン詳細で報告されているエラーメッセージとバージョンは何ですか？</strong></p></div></div><div id=R-tab-id-566aacb1c8d5c1d0804556b5157769c7 data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong><code>Invalid request</code>（無効なリクエスト）と<code>v350.10</code>です</strong>。</p></div></div></div></div></div></details>問題を引き起こしている<strong>paymentservice</strong>のバージョンを特定したので、エラーについてさらに詳しい情報が見つかるか確認してみましょう。ここで<strong>関連ログ</strong>の出番です。</p><p>関連コンテンツ(Related Contents)は、APM、インフラストラクチャモニタリング、および Log Observer が可観測性クラウド全体でフィルターを渡すことを可能にする特定のメタデータに依存しています。関連ログが機能するためには、ログに以下のメタデータが必要です：</p><ul><li><code>service.name</code></li><li><code>deployment.environment</code></li><li><code>host.name</code></li><li><code>trace_id</code></li><li><code>span_id</code></li></ul><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>トレースウォーターフォール</strong>の一番下で<strong>Logs (1)<strong>をクリックします。これは、このトレースに</strong>関連ログ</strong>があることを示しています。</li><li>ポップアップの<strong>Logs for trace xxx</strong>（トレース xxx のログ）エントリをクリックすると、<strong>Log Observer</strong>で完全なトレースのログが開きます。</li></ul></div></details><p><a href=#R-image-dd9e03f26d06eb6b64411c5c937fb956 class=lightbox-link><img alt=関連ログ class="lazy lightbox figure-image" loading=lazy src=../images/apm-related-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dd9e03f26d06eb6b64411c5c937fb956><img alt=関連ログ class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-related-logs.png></a></p><p>次に、ログのエラーについてさらに詳しく調べてみましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=splunk-log-observer>Splunk Log Observer</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<details open class="box cstyle notices orange"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-user"></i>
ペルソナ</summary><div class=box-content><p><strong>バックエンド開発者</strong>の役割を継続して、アプリケーションのログを調査して問題の根本原因を特定する必要があります。</p></div></details><p>APM トレースに関連するコンテンツ（ログ）を使用して、Splunk Log Observer でさらに掘り下げ、問題が正確に何であるかを理解します。</p><p>関連コンテンツは、あるコンポーネントから別のコンポーネントにジャンプできる強力な機能で、<strong>メトリクス</strong>、<strong>トレース</strong>、<strong>ログ</strong>で利用可能です。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>7. Splunk Log Observerのサブセクション</h1><article class=default><header class=headline></header><h1 id=1-ログフィルタリング>1. ログフィルタリング</h1><p><strong>Log Observer (LO)<strong>は、複数の方法で使用できます。クイックツアーでは、LO の</strong>コード不要インターフェース</strong>を使用して、ログ内の特定のエントリを検索しました。しかし、このセクションでは、<strong>関連コンテンツ</strong>リンクを使用して APM のトレースから LO に到達したと想定しています。</p><p>これの利点は、RUM と APM 間のリンクと同様に、以前のアクションのコンテキスト内でログを見ていることです。この場合、コンテキストはトレースの時間枠（<strong>1</strong>）と<strong>trace_id</strong>に設定されたフィルター（<strong>2</strong>）です。</p><p><a href=#R-image-9681ee9e52fda08bb095d85321c386af class=lightbox-link><img alt=トレースログ class="lazy lightbox figure-image" loading=lazy src=../images/log-observer-trace-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9681ee9e52fda08bb095d85321c386af><img alt=トレースログ class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer-trace-logs.png></a></p><p>このビューには、エンドユーザーとオンラインブティックのやり取りによって開始されたバックエンドトランザクションに参加した<strong>すべての</strong>アプリケーションまたはサービスからの<strong>すべての</strong>ログ行が含まれます。</p><p>私たちのオンラインブティックのような小さなアプリケーションでさえ、見つかるログの膨大な量により、調査している実際のインシデントに関連する特定のログ行を見つけることが難しくなる場合があります。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><p>ログ内のエラーメッセージだけに焦点を当てる必要があります：</p><ul><li><strong>Group By</strong>（グループ化）ドロップダウンボックスをクリックし、フィルターを使用して<strong>Severity</strong>（重要度）を見つけます。</li><li>選択したら<span class="btn cstyle button blue noicon"><span><span class=title>Apply</span></span></span>ボタンをクリックします（チャートの凡例がデバッグ、エラー、情報を表示するように変わることに注意してください）。
<a href=#R-image-addc7706a9772906ca453979fa6089a6 class=lightbox-link><img alt=凡例 class="lazy lightbox figure-image" loading=lazy src=../images/severity-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-addc7706a9772906ca453979fa6089a6><img alt=凡例 class="lazy lightbox lightbox-image" loading=lazy src=../images/severity-logs.png></a></li><li>エラーログのみを選択するには、凡例の「error」（<strong>1</strong>）という単語をクリックし、<strong>Add to filter</strong>を選択します。次に<span class="btn cstyle button blue noicon"><span><span class=title>Run Search</span></span></span>をクリックします。</li><li>複数のサービスにエラー行がある場合は、<code>sf_service=paymentservice</code>などのサービス名もフィルターに追加できますが、今回のケースでは必要ありません。
<a href=#R-image-4450299a6e06c46f285b41f08cde7c72 class=lightbox-link><img alt=エラーログ class="lazy lightbox figure-image" loading=lazy src=../images/log-observer-errors.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4450299a6e06c46f285b41f08cde7c72><img alt=エラーログ class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer-errors.png></a></li></ul></div></details><p>次に、ログエントリの詳細を見ていきます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=2-ログエントリの表示>2. ログエントリの表示</h1><p>特定のログ行を見る前に、これまでに行ったことと、可観測性の 3 本柱に基づいてなぜここにいるのかを簡単に振り返ってみましょう：</p><table><thead><tr><th style=text-align:center>メトリクス</th><th style=text-align:center>トレース</th><th style=text-align:center>ログ</th></tr></thead><tbody><tr><td style=text-align:center><em><strong>問題がありますか？</strong></em></td><td style=text-align:center><em><strong>問題はどこですか？</strong></em></td><td style=text-align:center><em><strong>問題は何ですか？</strong></em></td></tr></tbody></table><ul><li>メトリクスを使用して、アプリケーションに<strong>問題がある</strong>ことを特定しました。これはサービスダッシュボードのエラー率が、あるべき値よりも高かったことから明らかでした。</li><li>トレースとスパンタグを使用して、<strong>問題がどこにあるか</strong>を見つけました。<strong>paymentservice</strong>には<code>v350.9</code>と<code>v350.10</code>の 2 つのバージョンがあり、<code>v350.10</code>のエラー率は <strong>100%</strong> でした。</li><li><strong>paymentservice</strong>の<code>v350.10</code>からのこのエラーが、複数の再試行とオンラインブティックのチェックアウトからの応答の長い遅延を引き起こしたことを確認しました。</li><li>トレースから、<strong>関連コンテンツ</strong>の力を使用して、失敗した<strong>paymentservice</strong>バージョンのログエントリに到達しました。これで、<strong>問題が何であるか</strong>を特定できます。</li></ul><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>ログテーブルのエラーエントリをクリックします（リストに別のサービスからのまれなエラーもある場合は、<code>hostname: "paymentservice-xxxx"</code>と表示されていることを確認してください）。</li></ul><div class=tab-panel data-tab-group=R-tabs-df5861c57536d6ebd6134f92071db7bd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-9ec3ee928781cf4f875d9d764744e56a aria-expanded=true data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-df5861c57536d6ebd6134f92071db7bd","R-tab-1aa3f84abb25d49b8ed243c3170a5eae")'>
<span class=tab-nav-text>質問</span>
</button>
<button aria-controls=R-tab-id-aad3bac1f77ac99d08df1844b1269406 aria-expanded=false data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-df5861c57536d6ebd6134f92071db7bd","R-tab-c08a41c4be1582f12e5db69330df48ee")'>
<span class=tab-nav-text>回答</span></button></div><div class=tab-content-container><div id=R-tab-id-9ec3ee928781cf4f875d9d764744e56a data-tab-item=R-tab-1aa3f84abb25d49b8ed243c3170a5eae class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>メッセージに基づいて、問題を解決するために<strong>開発チームに何を伝えますか？</strong></p></div></div><div id=R-tab-id-aad3bac1f77ac99d08df1844b1269406 data-tab-item=R-tab-c08a41c4be1582f12e5db69330df48ee class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>開発チームは、有効な API トークンでコンテナを再構築してデプロイするか、<code>v350.9</code>にロールバックする必要があります</strong>。</p></div></div></div></div><p><a href=#R-image-f26bea283e78de78c2443f3687b8ffd7 class=lightbox-link><img alt=ログメッセージ class="lazy lightbox figure-image" loading=lazy src=../images/log-observer-log-message.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f26bea283e78de78c2443f3687b8ffd7><img alt=ログメッセージ class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer-log-message.png></a></p><ul><li>ログメッセージペインの<strong>X</strong>をクリックして閉じます。</li></ul></div></details><details open class="box cstyle notices blue"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-wine-bottle"></i>
おめでとうございます</summary><div class=box-content><p>Splunk Observability Cloud を<strong>正常に</strong>使用して、オンラインブティックでショッピング中に不良なユーザーエクスペリエンスを体験した理由を理解しました。RUM、APM、ログを使用して、サービス環境で何が起こったかを理解し、その後、可観測性の 3 本柱である<strong>メトリクス</strong>、<strong>トレース</strong>、<strong>ログ</strong>に基づいて根本原因を見つけました。</p><p>また、アプリケーションの動作パターンを検出するために<strong>Tag Spotlight</strong>で<strong>インテリジェントなタグ付けと分析</strong>を使用する方法と、問題のコンテキストを維持しながら異なるコンポーネント間を迅速に移動するために<strong>関連コンテンツ</strong>の<strong>フルスタック相関</strong>パワーを使用する方法も学びました。</p></div></details><p>ワークショップの次のパートでは、<strong>問題発見モード</strong>から<strong>緩和</strong>、<strong>防止</strong>、<strong>プロセス改善モード</strong>に移行します。</p><p>次は、カスタムダッシュボードでのログチャートの作成です。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=3-ログタイムラインチャート>3. ログタイムラインチャート</h1><p>Log Observer で特定のビューを持った後、そのビューをダッシュボードで使用できると、将来的に問題の検出や解決にかかる時間を短縮するのに非常に役立ちます。ワークショップの一環として、これらのチャートを使用する例示的なカスタムダッシュボードを作成します。</p><p><strong>ログタイムライン</strong>チャートの作成を見ていきましょう。ログタイムラインチャートは、時間経過に伴うログメッセージを視覚化するために使用されます。ログメッセージの頻度を確認し、パターンを特定するための優れた方法です。また、環境全体でのログメッセージの分布を確認するための素晴らしい方法でもあります。これらのチャートはカスタムダッシュボードに保存できます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><p>まず、関心のある列のみに情報量を減らします：</p><ul><li><strong>ログテーブル</strong>の上にあるテーブル設定<i class="fa-fw fas fa-cog"></i>アイコンをクリックして<strong>Table Setting</strong>を開き、<code>_raw</code>のチェックを外し、次のフィールドが選択されていることを確認します：<code>k8s.pod.name</code>、<code>message</code>、<code>version</code>。
<a href=#R-image-afe5b1ad3648b0172a4f423b3457e902 class=lightbox-link><img alt=ログテーブル設定 class="lazy lightbox figure-image" loading=lazy src=../images/log-observer-table.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-afe5b1ad3648b0172a4f423b3457e902><img alt=ログテーブル設定 class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer-table.png></a></li><li>時間選択から固定時間を削除し、<strong>過去 15 分</strong>に設定します。</li><li>すべてのトレースでこれを機能させるには、フィルターから<code>trace_id</code>を削除し、フィールド<code>sf_service=paymentservice</code>と<code>sf_environment=[WORKSHOPNAME]</code>を追加します。</li><li><strong>Save</strong>をクリックし、<strong>Save to Dashboard</strong>を選択します。
<a href=#R-image-ba1b87db8274ee4d28391b5fa253a156 class=lightbox-link><img alt=保存する class="lazy lightbox figure-image" loading=lazy src=../images/save-query.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ba1b87db8274ee4d28391b5fa253a156><img alt=保存する class="lazy lightbox lightbox-image" loading=lazy src=../images/save-query.png></a></li><li>表示されるチャート作成ダイアログボックスで、<strong>Chart name</strong>として<code>ログタイムライン</code>を使用します。</li><li><span class="btn cstyle button blue noicon"><span><span class=title>Select Dashboard</span></span></span>をクリックし、ダッシュボード選択ダイアログボックスで<span class="btn cstyle button blue noicon"><span><span class=title>New Dashboard</span></span></span>をクリックします。</li><li><strong>New Dashboard</strong>ダイアログボックスに、新しいダッシュボードの名前を入力します（説明を入力する必要はありません）。次の形式を使用します：<code>イニシャル - サービスヘルスダッシュボード</code>、そして<span class="btn cstyle button blue noicon"><span><span class=title>Save</span></span></span>をクリックします。</li><li>リスト内で新しいダッシュボードが強調表示されていることを確認し（<strong>1</strong>）、<span class="btn cstyle button blue noicon"><span><span class=title>OK</span></span></span>（<strong>2</strong>）をクリックします。
<a href=#R-image-bb40c2dc42d27201fa738b00a1cd3ad1 class=lightbox-link><img alt=ダッシュボードの保存 class="lazy lightbox figure-image" loading=lazy src=../images/dashboard-save.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bb40c2dc42d27201fa738b00a1cd3ad1><img alt=ダッシュボードの保存 class="lazy lightbox lightbox-image" loading=lazy src=../images/dashboard-save.png></a></li><li><strong>Chart Type</strong>として<strong>Log timeline</strong>が選択されていることを確認します。
<a href=#R-image-c0dba84645c3539938812e029d8c117d class=lightbox-link><img alt=ログタイムライン class="lazy left lightbox figure-image" loading=lazy src="../images/log-timeline.png?classes=left&width=25vw" style=height:auto;width:25vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c0dba84645c3539938812e029d8c117d><img alt=ログタイムライン class="lazy left lightbox lightbox-image" loading=lazy src="../images/log-timeline.png?classes=left&width=25vw"></a></li><li><span class="btn cstyle button transparent noicon"><span><span class=title>Save</span></span></span>ボタンをクリックします（この時点では<strong>Save and go to dashboard</strong>をクリック<strong>しないで</strong>ください）。</li></ul></div></details><p>次に、<strong>ログビュー</strong>チャートを作成します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=4-ログビューチャート>4. ログビューチャート</h1><p>ログで使用できる次のチャートタイプは<strong>ログビュー</strong>チャートタイプです。このチャートでは、事前定義されたフィルターに基づいてログメッセージを確認できます。</p><p>前回のログタイムラインチャートと同様に、このチャートのバージョンをカスタマーヘルスサービスダッシュボードに追加します：</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>前回の演習後、まだ<strong>Log Observer</strong>にいることを確認してください。</li><li>フィルターは前回の演習と同じで、時間選択が<strong>過去 15 分</strong>に設定され、severity=error、<code>sf_service=paymentservice</code>、<code>sf_environment=[WORKSHOPNAME]</code>でフィルタリングされている必要があります。</li><li>必要なフィールドのみを含むヘッダーがあることを確認してください。</li><li>再度<strong>Save</strong>をクリックし、<strong>Save to Dashvoard</strong>をクリックします。</li><li>これによりチャート作成ダイアログが再度表示されます。</li><li><strong>Chart name</strong>として<strong>ログビュー</strong>を使用します。</li><li>今回は<span class="btn cstyle button blue noicon"><span><span class=title>Select Dashboard</span></span></span>をクリックし、前回の演習で作成したダッシュボードを検索します。検索ボックス（<strong>1</strong>）にあなたのイニシャルを入力することから始めることができます。
<a href=#R-image-0c11f43da3718f7f26d43ad53e93e409 class=lightbox-link><img alt=ダッシュボードの検索 class="lazy lightbox figure-image" loading=lazy src=../images/search-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0c11f43da3718f7f26d43ad53e93e409><img alt=ダッシュボードの検索 class="lazy lightbox lightbox-image" loading=lazy src=../images/search-dashboard.png></a></li><li>あなたのダッシュボード名をクリックして強調表示し（<strong>2</strong>）、<span class="btn cstyle button blue noicon"><span><span class=title>OK</span></span></span>（<strong>3</strong>）をクリックします。</li><li>これによりチャート作成ダイアログに戻ります。</li><li><strong>Chart type</strong>として<strong>Log view</strong>が選択されていることを確認します。
<a href=#R-image-2ceaaf95c303d73246381cf4f2bf611b class=lightbox-link><img alt=ログビュー class="lazy left lightbox figure-image" loading=lazy src="../images/log-view.png?classes=left&width=30vw" style=height:auto;width:30vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2ceaaf95c303d73246381cf4f2bf611b><img alt=ログビュー class="lazy left lightbox lightbox-image" loading=lazy src="../images/log-view.png?classes=left&width=30vw"></a></li><li>ダッシュボードを表示するには、<span class="btn cstyle button blue noicon"><span><span class=title>Save and go to dashboard</span></span></span>をクリックします。</li><li>結果は以下のダッシュボードと同様になるはずです：
<a href=#R-image-356a95c6b33ba3ef7807f428863dc797 class=lightbox-link><img alt=カスタムダッシュボード class="lazy lightbox figure-image" loading=lazy src=../images/log-observer-custom-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-356a95c6b33ba3ef7807f428863dc797><img alt=カスタムダッシュボード class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer-custom-dashboard.png></a></li><li>この演習の最後のステップとして、あなたのダッシュボードをワークショップチームページに追加しましょう。これにより、ワークショップの後半で簡単に見つけることができます。</li><li>ページ上部で、あなたのダッシュボード名の左にある <strong><em>&mldr;</em></strong> をクリックします。
<a href=#R-image-d04abd4faea6661fbf69fff4f9daad4f class=lightbox-link><img alt=リンク class="lazy lightbox figure-image" loading=lazy src=../images/linking.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d04abd4faea6661fbf69fff4f9daad4f><img alt=リンク class="lazy lightbox lightbox-image" loading=lazy src=../images/linking.png></a></li><li>ドロップダウンから<strong>Links to Team</strong>を選択します。</li><li>次の<strong>Links to Team</strong>ダイアログボックスで、インストラクターが提供したワークショップチームを見つけて<span class="btn cstyle button blue noicon"><span><span class=title>Done</span></span></span>をクリックします。</li></ul></div></details><p>次のセッションでは、Splunk Synthetics を見て、Web ベースのアプリケーションのテストを自動化する方法を確認します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=splunk-synthetics>Splunk Synthetics</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<details open class="box cstyle notices orange"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-user"></i>
ペルソナ</summary><div class=box-content><p><strong>SRE</strong>の帽子を再び被って、オンラインブティックの監視を設定するよう依頼されました。アプリケーションが 24 時間 365 日、利用可能で良好なパフォーマンスを発揮していることを確認する必要があります。</p></div></details><p>アプリケーションを 24 時間 365 日監視し、問題が発生したときにアラートを受け取ることができたらいいと思いませんか？ここで Synthetics の出番です。オンラインブティックを通じて典型的なユーザージャーニーのパフォーマンスと可用性を毎分チェックする簡単なテストを紹介します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>8. Splunk Syntheticsのサブセクション</h1><article class=default><header class=headline></header><h1 id=1-syntheticsダッシュボード>1. Syntheticsダッシュボード</h1><p>Splunk Observability Cloud のメインメニューから、<strong>Synthetics</strong>をクリックします。<strong>All</strong>または<strong>Browser tests</strong>をクリックして、アクティブなテストのリストを表示します。</p><p>RUM セクションでの調査中に、<strong>Place order</strong>トランザクションに問題があることがわかりました。Synthetics テストからもこれを確認できるか見てみましょう。テストの 4 ページ目の<strong>First byte time</strong>というメトリクスを使用します。これは<strong>Place order</strong>ステップです。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>Search</strong>ボックスに <strong>[ワークショップ名]</strong> を入力し、あなたのワークショップのテストを選択します（インストラクターがどれを選択するか指示します）。</li><li><strong>Performance KPIs</strong>の下で、時間選択を<strong>過去 1 時間</strong>に設定して Enter キーを押します。</li><li><strong>Location</strong>をクリックし、ドロップダウンから<strong>Page</strong>を選択します。次のフィルターには、テストの一部であるページが表示されます。</li><li><strong>Duration</strong>をクリックし、<strong>Duration</strong>の選択を解除して<strong>First byte time</strong>を選択します。
<a href=#R-image-77b0b2d48a219054ad175910659d5e3b class=lightbox-link><img alt=トランザクションフィルター class="lazy lightbox figure-image" loading=lazy src=../images/synthetics-transaction-filter.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-77b0b2d48a219054ad175910659d5e3b><img alt=トランザクションフィルター class="lazy lightbox lightbox-image" loading=lazy src=../images/synthetics-transaction-filter.png></a></li><li>凡例を見て、<strong>First byte time - Page 4</strong>の色に注目してください。</li><li><strong>First byte time - Page 4</strong>の最も高いデータポイントを選択します。これで、この特定のテスト実行の<strong>Run results</strong>に移動します。</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=2-syntheticsテスト詳細>2. Syntheticsテスト詳細</h1><p>現在、単一の Synthetic Browser テストの結果を見ています。このテストは<strong>ビジネストランザクション</strong>に分割されています。これは、ビジネス上重要なユーザーフローを表す、論理的に関連する 1 つ以上の操作のグループと考えてください。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
情報</summary><div class=box-content><p>以下のスクリーンショットにはエラーを示す赤いバナーは含まれていませんが、あなたの実行結果には表示されている場合があります。これは、場合によってはテスト実行が失敗することがあり、ワークショップに影響しないため予期されることです。</p></div></details><p><a href=#R-image-b535cd56c896d93cb96c5a67e2b9e618 class=lightbox-link><img alt=ウォーターフォール class="lazy lightbox figure-image" loading=lazy src=../images/synth-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b535cd56c896d93cb96c5a67e2b9e618><img alt=ウォーターフォール class="lazy lightbox lightbox-image" loading=lazy src=../images/synth-waterfall.png></a></p><ol><li><strong>フィルムストリップ：</strong> サイトのパフォーマンスのスクリーンショットのセットを提供し、ページがリアルタイムでどのように応答するかを確認できます。</li><li><strong>ビデオ：</strong> 特定のテスト実行の場所とデバイスからあなたのサイトを読み込もうとするユーザーが体験する内容を正確に確認できます。</li><li><strong>ブラウザテストメトリクス：</strong> ウェブサイトのパフォーマンスの全体像を提供するビューです。</li><li><strong>Synthetic トランザクション：</strong> サイトとの対話を構成する Synthetic トランザクションのリスト</li><li><strong>ウォーターフォールチャート</strong> ウォーターフォールチャートは、テストランナーとテスト対象サイトの間の対話を視覚的に表現したものです。</li></ol><p>デフォルトでは、Splunk Synthetics はテストのスクリーンショットとビデオキャプチャを提供します。これは問題のデバッグに役立ちます。例えば、大きな画像の読み込みが遅い、ページのレンダリングが遅いなどを確認できます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>マウスを使用してフィルムストリップを左右にスクロールし、テスト実行中にサイトがどのようにレンダリングされていたかを確認します。</li><li>ビデオペインで、再生ボタン <strong>▶</strong> を押してテスト再生を見ます。省略記号 <strong>⋮</strong> をクリックすると、<em>再生速度</em>の変更、<em>ピクチャーインピクチャー</em>での表示、さらにビデオの<em>ダウンロード</em>もできます。</li><li>Synthetic トランザクションペインの<em>ビジネストランザクション</em>ヘッダーの下で、最初のボタン<span class="btn cstyle button blue noicon"><span><span class=title><strong>Home</strong></span></span></span>をクリックします。</li><li>下のウォーターフォールにはページを構成するすべてのオブジェクトが表示されます。最初の行は HTML 自体です。次の行は、ページを構成するオブジェクト（HTML、CSS、JavaScript、画像、フォントなど）です。</li><li>ウォーターフォールで<strong>GET</strong> <em>splunk-otel-web.js</em>の行を見つけます。</li><li><strong>></strong> ボタンをクリックしてメタデータセクションを開き、リクエスト/レスポンスヘッダー情報を確認します。</li><li>Synthetic トランザクションペインで、2 番目のビジネストランザクション<span class="btn cstyle button blue noicon"><span><span class=title><strong>Shop</strong></span></span></span>をクリックします。フィルムストリップが調整され、新しいトランザクションの先頭に移動することに注意してください。</li><li>他のすべてのトランザクションについても同じことを繰り返し、最後に<span class="btn cstyle button blue noicon"><span><span class=title><strong>Place Order</strong></span></span></span>トランザクションを選択します。</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=3-syntheticsからapmへ>3. SyntheticsからAPMへ</h1><p>今、以下のような表示が見えているはずです。</p><p><a href=#R-image-d57a2bf470727c7bbd80dc8bac912784 class=lightbox-link><img alt=注文する class="lazy lightbox figure-image" loading=lazy src=../images/run-results-place-order.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d57a2bf470727c7bbd80dc8bac912784><img alt=注文する class="lazy lightbox lightbox-image" loading=lazy src=../images/run-results-place-order.png></a></p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>ウォーターフォールで<strong>POST checkout</strong>で始まるエントリを見つけます。</li><li>その前にある <strong>></strong> ボタンをクリックして、メタデータセクションを展開します。収集されたメタデータを観察し、<strong>Server-Timing</strong>ヘッダーに注目してください。このヘッダーにより、テスト実行をバックエンドトレースに関連付けることができます。</li><li>ウォーターフォールの<strong>POST checkout</strong>行にある青い<i class="fa-fw fas fa-link"></i> <strong>APM</strong>リンクをクリックします。</li></ul></div></details><p><a href=#R-image-bfcab6e76ab3aa6e76b47f34c1765c91 class=lightbox-link><img alt=APMトレース class="lazy lightbox figure-image" loading=lazy src=../images/apm-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bfcab6e76ab3aa6e76b47f34c1765c91><img alt=APMトレース class="lazy lightbox lightbox-image" loading=lazy src=../images/apm-trace.png></a></p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><strong>paymentservice</strong>に対して 1 つ以上のエラーが表示されていることを確認します（<strong>1</strong>）。</li><li>同じエラーであることを確認するには、<strong>ログ</strong>の関連コンテンツをクリックします（<strong>2</strong>）。</li><li>前回の演習を繰り返して、エラーのみにフィルタリングします。</li><li>エラーログを表示して、無効なトークンによる支払い失敗を確認します。</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=4-synthetics-detector>4. Synthetics Detector</h1><p>これらのテストを 24 時間 365 日実行できるため、テストが失敗したり、合意した SLA よりも長く実行され始めた場合に、ソーシャルメディアやアップタイムウェブサイトから通知される前に、早期に警告を受けるための理想的なツールです。</p><p><a href=#R-image-78f339f9cd2626eddf1cc747b3626bec class=lightbox-link><img alt=ソーシャルメディア class="lazy lightbox figure-image" loading=lazy src=../images/social-media-post.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-78f339f9cd2626eddf1cc747b3626bec><img alt=ソーシャルメディア class="lazy lightbox lightbox-image" loading=lazy src=../images/social-media-post.png></a></p><p>そのような事態を防ぐために、テストが 1.1 分以上かかっているかどうかを検知しましょう。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li><p>左側のメニューから Synthetics ホームページに戻ります</p></li><li><p>ワークショップのテストを再度選択し、ページ上部の<span class="btn cstyle button transparent noicon"><span><span class=title>Create Detector</span></span></span>ボタンをクリックします。<br><a href=#R-image-6ca1d78d87889ff832ea5a296c867712 class=lightbox-link><img alt="synth Detector" class="lazy lightbox figure-image" loading=lazy src=../images/synth-detector.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6ca1d78d87889ff832ea5a296c867712><img alt="synth Detector" class="lazy lightbox lightbox-image" loading=lazy src=../images/synth-detector.png></a></p></li><li><p><strong>New Synthetics Detector</strong>というテキスト（<strong>1</strong>）を編集し、<code>イニシャル -</code> [ワークショップ名]に置き換えます。</p></li><li><p><span class="btn cstyle button transparent noicon"><span><span class=title>Run Duration</span></span></span>と<span class="btn cstyle button transparent noicon"><span><span class=title>Static threashold</span></span></span>が選択されていることを確認します。</p></li><li><p><strong>Trigger threasholt</strong>（<strong>2</strong>）を<code>65,000</code>〜<code>68,000</code>に設定し、Enter キーを押してチャートを更新します。上図のように、しきい値ラインを切る複数のスパイクがあることを確認してください（実際のレイテンシーに合わせてしきい値を少し調整する必要があるかもしれません）。</p></li><li><p>残りはデフォルトのままにします。</p></li><li><p>スパイクの下に赤と白の三角形の列が表示されるようになったことに注意してください（<strong>3</strong>）。赤い三角形は、テストが指定されたしきい値を超えたことを Detector が検出したことを知らせ、白い三角形は結果がしきい値を下回ったことを示します。各赤い三角形がアラートをトリガーします。</p></li><li><p>アラートの重大度（<strong>4</strong>）は、ドロップダウンを別のレベルに変更することで変更できます。また、アラート方法も変更できます。<strong>受信者を追加しないでください</strong>。アラートストームの対象になる可能性があります！</p></li><li><p><span class="btn cstyle button blue noicon"><span><span class=title>Actibate</span></span></span>をクリックして、 Detector をデプロイします。</p></li><li><p>新しく作成した Detector を見るには、<span class="btn cstyle button transparent noicon"><span><span class=title>Edit Test</span></span></span>ボタンをクリックします。</p></li><li><p>ページの下部にアクティブな Detector のリストがあります。</p><p><a href=#R-image-b2fd15786b39065d3ca45b9b811b561c class=lightbox-link><img alt=Detectorのリスト class="lazy lightbox figure-image" loading=lazy src=../images/detector-list.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b2fd15786b39065d3ca45b9b811b561c><img alt=Detectorのリスト class="lazy lightbox lightbox-image" loading=lazy src=../images/detector-list.png></a></p></li><li><p>あなたの Detector が見つからず、<em>新しい Synthetics Detector</em>という名前のものが表示されている場合は、あなたの名前で正しく保存されていない可能性があります。<em>新しい Synthetics Detector</em>のリンクをクリックして、名前の変更をやり直してください。</p></li><li><p><span class="btn cstyle button transparent noicon"><span><span class=title>閉じる</span></span></span>ボタンをクリックして編集モードを終了します。</p></li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/09/30</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=カスタムサービスヘルスダッシュボード->カスタムサービスヘルスダッシュボード 🏥</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<details open class="box cstyle notices orange"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-user"></i>
ペルソナ</summary><div class=box-content><p><strong>SRE</strong>の帽子が似合っているので、引き続き着用して<strong>paymentservice</strong>用のカスタムサービスヘルスダッシュボードの構築を依頼されたと想定します。要件は RED メトリクス、ログ、Synthetic テスト期間の結果を表示することです。</p></div></details><p>開発チームと SRE チームが、アプリケーションやサービスの健全性の概要を必要とすることは一般的です。これらは多くの場合、壁に取り付けられた TV に表示されます。Splunk Observability Cloud は、カスタムダッシュボードを作成することでこれに最適なソリューションを提供しています。</p><p>このセクションでは、チームのモニターや TV に表示するための<strong>サービスヘルスダッシュボード</strong>を構築します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>9. サービスヘルスダッシュボードのサブセクション</h1><article class=default><header class=headline></header><h1 id=ダッシュボードの強化>ダッシュボードの強化</h1><p>Log Observer 演習ですでにいくつかの便利なログチャートをダッシュボードに保存したので、そのダッシュボードを拡張していきます。</p><p><a href=#R-image-57b70eca8d6e7361a5e4214fecc8cb5f class=lightbox-link><img alt=壁掛け class="lazy lightbox figure-image" loading=lazy src=../images/wall-mount.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-57b70eca8d6e7361a5e4214fecc8cb5f><img alt=壁掛け class="lazy lightbox lightbox-image" loading=lazy src=../images/wall-mount.png></a></p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>2 つのログチャートがあるダッシュボードに戻るには、メインメニューから<strong>Dashboard</strong>をクリックすると、チームダッシュボードビューに移動します。<strong>Dashboard</strong>の下にある<strong>Search Dashboard</strong>をクリックして、あなたのサービスヘルスダッシュボードグループを検索します。</li><li>名前をクリックすると、以前に保存したダッシュボードが表示されます。
<a href=#R-image-d69da74d4e5bf6d66ac0f60b90b1942e class=lightbox-link><img alt=ログリスト class="lazy lightbox figure-image" loading=lazy src=../../7-log-observer/images/log-observer-custom-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d69da74d4e5bf6d66ac0f60b90b1942e><img alt=ログリスト class="lazy lightbox lightbox-image" loading=lazy src=../../7-log-observer/images/log-observer-custom-dashboard.png></a></li><li>ログ情報は便利ですが、チームにとって意味のあるものにするにはさらに情報が必要なので、もう少し情報を追加しましょう。</li><li>最初のステップは、ダッシュボードに説明チャートを追加することです。<span class="btn cstyle button grey noicon"><span><span class=title>New text note</span></span></span>をクリックし、ノート内のテキストを次のテキストに置き換えてから、<span class="btn cstyle button blue noicon"><span><span class=title>Save and Close</span></span></span>ボタンをクリックし、チャートに<strong>手順</strong>と名前をつけます。</li></ul><details open class="box cstyle notices grey"><summary class=box-label tabindex=-1>テキストノートで使用する情報</summary><div class=box-content><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>これは**支払いサービス**のためのカスタムヘルスダッシュボードです。
</span></span><span class=line><span class=cl>ログのエラーに注意してください。
</span></span><span class=line><span class=cl>詳細については[リンク](https://https://www.splunk.com/en_us/products/observability.html)をご覧ください。</span></span></code></pre></div></div></details><ul><li>チャートが適切な順序になっていません。チャートを役立つように並べ替えましょう。</li><li><strong>手順</strong>チャートの上端にマウスを移動すると、マウスポインタが <strong>☩</strong> に変わります。これにより、ダッシュボード内でチャートをドラッグできるようになります。<strong>手順</strong>チャートを左上の位置にドラッグし、右端をドラッグしてページの 1/3 のサイズにリサイズします。</li><li><strong>ログタイムラインビュー</strong>チャートを<strong>手順</strong>チャートの横にドラッグして追加し、ページの残りの 2/3 を埋めるようにリサイズして、2 つのチャートの横にエラー率チャートを配置し、ページ全体を埋めるようにリサイズします。</li><li>次に、<strong>ログライン</strong>チャートをページの幅にリサイズし、少なくとも 2 倍の長さになるようにリサイズします。</li><li>以下のダッシュボードに似た形になっているはずです：
<a href=#R-image-c18b0f7c7eee13464d786b9b81e2af33 class=lightbox-link><img alt=初期ダッシュボード class="lazy lightbox figure-image" loading=lazy src=../images/initial-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c18b0f7c7eee13464d786b9b81e2af33><img alt=初期ダッシュボード class="lazy lightbox lightbox-image" loading=lazy src=../images/initial-dashboard.png></a></li></ul></div></details><p>これは素晴らしいですね。引き続き、より意味のあるチャートを追加していきましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article><article class=default><header class=headline></header><h1 id=カスタムチャートの追加>カスタムチャートの追加</h1><p>ワークショップのこのパートでは、ダッシュボードに追加するチャートを作成し、また以前に構築したディテクターにリンクします。これにより、テストの動作を確認し、1 つ以上のテスト実行が SLA を違反した場合にアラートを受け取ることができます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
演習</summary><div class=box-content><ul><li>ダッシュボードの上部にある <strong>+</strong> をクリックし、<strong>チャート</strong>を選択します。
<a href=#R-image-06239f1a2858f0c430025cfb44b73656 class=lightbox-link><img alt=新しいチャート画面 class="lazy lightbox figure-image" loading=lazy src=../images/new-chart.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-06239f1a2858f0c430025cfb44b73656><img alt=新しいチャート画面 class="lazy lightbox lightbox-image" loading=lazy src=../images/new-chart.png></a></li><li>まず、<span class="btn cstyle button grey noicon"><span><span class=title>Untitled Chart</span></span></span>入力フィールドを使用して、チャートに<strong>全体テスト所要時間</strong>という名前を付けます。</li><li>この演習では棒グラフまたは柱状グラフが必要なので、チャートオプションボックスの 3 番目のアイコン<i class="fa-fw fas fa-chart-bar"></i>をクリックします。</li><li><strong>Plot editor</strong>の<strong>Signal</strong>ボックスに<code>synthetics.run.duration.time.ms</code>（これはテストの実行時間です）と入力し、Enter キーを押します。</li><li>現在、異なる色の棒が表示されています。テストが実行される各リージョンごとに異なる色になっています。これは必要ないので、分析を追加することでその動作を変更できます。</li><li><span class="btn cstyle button blue noicon"><span><span class=title>Add Analytics</span></span></span>ボタンをクリックします。</li><li>ドロップダウンから<strong>Mean</strong>オプションを選択し、<code>mean:aggregation</code>を選択してダイアログボックスの外をクリックします。メトリクスが集計されるため、チャートが単色に変わることに注目してください。</li><li>x 軸は現在、時間を表していません。これを変更するには、プロットラインの最後にある設定<i class="fa-fw fas fa-cog"></i>アイコンをクリックします。次のダイアログが開きます：
<a href=#R-image-9ac1bba43d4b8ffd4ae9f96053b8b26e class=lightbox-link><img alt=シグナル設定 class="lazy lightbox figure-image" loading=lazy src=../images/signal-setup.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9ac1bba43d4b8ffd4ae9f96053b8b26e><img alt=シグナル設定 class="lazy lightbox lightbox-image" loading=lazy src=../images/signal-setup.png></a></li><li>ドロップダウンボックスの<strong>Display Units</strong>（<strong>2</strong>）を<strong>none</strong>から <strong>Time (autoscaling)/Milliseconds(ms)</strong> に変更します。ドロップダウンが<strong>Millisecond</strong>に変わり、チャートの x 軸がテスト所要時間を表すようになります。</li><li>設定<i class="fa-fw fas fa-cog"></i>アイコンをクリックするか、<span class="btn cstyle button noicon" style=--VARIABLE-BOX-color:gray><span><span class=title>Close</span></span></span>ボタンをクリックして、ダイアログを閉じます。</li><li><span class="btn cstyle button blue noicon"><span><span class=title>Link Detectir</span></span></span>ボタンをクリックし、以前に作成したディテクターの名前の入力を開始して、ディテクターを追加します。</li><li>ディテクター名をクリックして選択します。</li><li>チャートの周りに色付きの枠が表示され、アラートのステータスが示されます。また、以下のようにダッシュボードの上部にベルアイコンが表示されることに注目してください：
<a href=#R-image-4ddf5250d6c5ed31e203899989026d26 class=lightbox-link><img alt=ディテクター追加済み class="lazy lightbox figure-image" loading=lazy src=../images/detector-added.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4ddf5250d6c5ed31e203899989026d26><img alt=ディテクター追加済み class="lazy lightbox lightbox-image" loading=lazy src=../images/detector-added.png></a></li><li><span class="btn cstyle button blue noicon"><span><span class=title>Save and Close</span></span></span>ボタンをクリックします。</li><li>ダッシュボードで、チャートを移動して以下のスクリーンショットのように表示させます：
<a href=#R-image-d19d724f5be600623112e72be0952569 class=lightbox-link><img alt=サービスヘルスダッシュボード class="lazy lightbox figure-image" loading=lazy src=../images/service-health-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d19d724f5be600623112e72be0952569><img alt=サービスヘルスダッシュボード class="lazy lightbox lightbox-image" loading=lazy src=../images/service-health-dashboard.png></a></li><li>最後のタスクとして、ページ上部（<strong>Event Overlay</strong>の横）にある 3 つのドット <strong>&mldr;</strong> をクリックし、<strong>View fullscreen</strong>をクリックします。これは壁掛けテレビモニターで使用するビューです（元に戻るには Esc キーを押します）。</li></ul></div></details><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ヒント</summary><div class=box-content><p>時間があれば、RUM メトリクスを使用してダッシュボードにもう 1 つのカスタムチャートを追加してみてください。既製の<strong>RUM アプリケーション</strong>ダッシュボードグループからチャートをコピーすることができます。または、RUM メトリクス<code>rum.client_error.count</code>を使用して、アプリケーションのクライアントエラー数を表示するチャートを作成することもできます。</p></div></details><p>最後に、ワークショップのまとめを行います。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/02</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=ワークショップ-まとめ->ワークショップ まとめ 🎁</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>おめでとうございます。<strong>Splunk4Rookies - Observability Cloud ワークショップ</strong>を修了しました。今日は Splunk Observability Cloud を使用してアプリケーションとインフラストラクチャを監視する方法に慣れました。</p><p>この修了証をあなたの<span class="badge cstyle blue badge-with-title"><span class=badge-title><i class="fab fa-fw fa-linkedin-in"></i></span><span class=badge-content><a href='https://www.linkedin.com/profile/add?startTask=CERTIFICATION_NAME&name=Splunk4Rookies%20-%20Observability%20Cloud&organizationId=20226&issueYear
=2026&issueMonth=1&certUrl=https%3A%2F%2Fsplunk.github.io%2Fobservability-workshop%2Fsplunk4rookies%2Fobservability-cloud%2Fimages%2Fcertificate.png' style=color:#fff target=_blank>LinkedIn</a>
</span></span>プロフィールに追加して成果をアピールしましょう。</p><p>私たちが学んだことと次にできることを振り返ってみましょう。</p><p><a href=#R-image-6ff3a36fda1da6dca1458c5cddd21435 class=lightbox-link><img alt=シャンパン class="lazy lightbox figure-image" loading=lazy src="/observability-workshop/ja/splunk4rookies/observability-cloud/10-wrap-up/images/champagne.png?width=45vw" style=height:auto;width:45vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6ff3a36fda1da6dca1458c5cddd21435><img alt=シャンパン class="lazy lightbox lightbox-image" loading=lazy src="/observability-workshop/ja/splunk4rookies/observability-cloud/10-wrap-up/images/champagne.png?width=45vw"></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/04/30</span></span></footer></article><section><h1 class=a11y-only>10. ワークショップ まとめのサブセクション</h1><article class=default><header class=headline></header><h1 id=主要なポイント>主要なポイント</h1><p>このワークショップを通じて、Splunk Observability Cloud と OpenTelemetry シグナル（<strong>メトリクス</strong>、<strong>トレース</strong>、<strong>ログ</strong>）の組み合わせが、検出までの平均時間（<strong>MTTD</strong>）と解決までの平均時間（<strong>MTTR</strong>）をどのように短縮できるかを見てきました。</p><ul><li>メインユーザーインターフェイスとそのコンポーネント、<em>ランディング、インフラストラクチャ、APM、RUM、Synthetics、ダッシュボード</em>ページ、そして<em>設定</em>ページについて理解を深めました。</li><li>時間に応じて、<em>インフラストラクチャ</em>の演習を行い、Kubernetes ナビゲーターで使用される<em>メトリクス</em>を確認し、Kubernetes クラスターで見つかった関連サービスを見ました：</li></ul><p><a href=#R-image-c0e433306ba01ff5d399669bf4dc6dfc class=lightbox-link><img alt=Kubernetes class="lazy lightbox figure-image" loading=lazy src=../images/infra.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c0e433306ba01ff5d399669bf4dc6dfc><img alt=Kubernetes class="lazy lightbox lightbox-image" loading=lazy src=../images/infra.png></a></p><ul><li>ユーザーが何を体験しているかを理解し、RUM と APM を使用して特に長いページ読み込みのトラブルシューティングを行いました。フロントエンドとバックエンド全体でトレースをたどり、ログエントリーまで追跡しました。
RUM の<em>セッション再生</em>と APM の<em>依存関係マップ</em>を使用し、ブレークダウン機能を使って問題の原因を発見しました：</li></ul><p><a href=#R-image-4a6d283ec23f7f169939660f8f7f30e5 class=lightbox-link><img alt=rumとapm class="lazy lightbox figure-image" loading=lazy src=../images/rum-apm.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4a6d283ec23f7f169939660f8f7f30e5><img alt=rumとapm class="lazy lightbox lightbox-image" loading=lazy src=../images/rum-apm.png></a></p><ul><li>RUM と APM の両方で<em>Tag Spotlight</em>を使用して、影響範囲を理解し、パフォーマンス問題とエラーのトレンドやコンテキストを検出しました。APM の<em>トレースウォーターフォール</em>で<em>スパン</em>を詳しく調べ、サービスがどのように相互作用し、エラーを見つけました：</li></ul><p><a href=#R-image-646178220bed5f7cdb0bb3ba6284af85 class=lightbox-link><img alt=タグとウォーターフォール class="lazy lightbox figure-image" loading=lazy src=../images/tag-spotlight-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-646178220bed5f7cdb0bb3ba6284af85><img alt=タグとウォーターフォール class="lazy lightbox lightbox-image" loading=lazy src=../images/tag-spotlight-waterfall.png></a></p><ul><li><em>関連コンテンツ</em>機能を使用して、<em>トレース</em>から<em>トレース</em>に関連する<em>ログ</em>への直接のリンクをたどり、フィルターを使用して問題の正確な原因まで掘り下げました。</li></ul><p><a href=#R-image-85361fdd463d22b3116cf2ba55fb50a0 class=lightbox-link><img alt=ログ class="lazy lightbox figure-image" loading=lazy src=../images/log.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-85361fdd463d22b3116cf2ba55fb50a0><img alt=ログ class="lazy lightbox lightbox-image" loading=lazy src=../images/log.png></a></p><ul><li><p>次に、Web とモバイルトラフィックをシミュレートできる Synthetics を調べ、利用可能な Synthetics テストを使用して、まず RUM/APM と Log Observer での発見を確認し、次にテストの実行時間が SLA を超えた場合にアラートを受け取るための<em>ディテクター</em>を作成しました。</p></li><li><p>最後の演習では、開発者と SRE のために TV スクリーンで継続的に表示するヘルスダッシュボードを作成しました：</p></li></ul><p><a href=#R-image-9495bac1cd4e4593ec5407fa68ad056b class=lightbox-link><img alt=synthとTV class="lazy lightbox figure-image" loading=lazy src=../images/synth-tv.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9495bac1cd4e4593ec5407fa68ad056b><img alt=synthとTV class="lazy lightbox lightbox-image" loading=lazy src=../images/synth-tv.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article></section></section></section><article class=default><header class=headline></header><h1 id=splunk4ninjas-workshops>Splunk4Ninjas Workshops</h1><ul class=card-container><li><article class="card card-popout" aria-labelledby=R-card-a7346f37caa2467e97bc805c015be7f8><div class=card-content><div class=card-title id=R-card-a7346f37caa2467e97bc805c015be7f8><a href=/observability-workshop/ja/ninja-workshops/1-automatic-discovery/index.html>自動ディスカバリーワークショップ</a></div><div class=card-content-text>Java アプリケーション向けの Splunk 自動ディスカバリーおよび設定機能の活用方法を学びます。これらのワークショップでは、ゼロコード計装を使用して、モノリスおよび Kubernetes デプロイメント全体でメトリクス、トレース、ログを即座に生成し、包括的なオブザーバビリティを実現する方法をデモンストレーションします。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-c93d3afa9e42727cd5a01075c05384b4><div class=card-content><div class=card-title id=R-card-c93d3afa9e42727cd5a01075c05384b4><a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/index.html>OpenTelemetry Collector ワークショップ</a></div><div class=card-content-text>OpenTelemetry Collector の基本概念
OpenTelemetry Collector の概念と、Splunk Observability Cloud へデータを送信する方法を学びます。
Advanced OpenTelemetry Collector
OpenTelemetry Collector の設定をゼロから行う練習を行い、いくつかの高度な設定シナリオを体験します。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-6c1ffa7f5fd2acd943eecf9830bd4e60><div class=card-content><div class=card-title id=R-card-6c1ffa7f5fd2acd943eecf9830bd4e60><a href=/observability-workshop/ja/ninja-workshops/4-synthetics-scripting/index.html>Splunk Synthetic Scripting</a></div><div class=card-content-text>ユーザーフロー、ビジネストランザクション、API 全体のパフォーマンス問題をプロアクティブに検出・修正し、より優れたデジタルエクスペリエンスを提供します。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-d3844cc9a281fa0ce1acc0a885fa05f8><div class=card-content><div class=card-title id=R-card-d3844cc9a281fa0ce1acc0a885fa05f8><a href=/observability-workshop/ja/ninja-workshops/6-lambda-kinesis/index.html>Lambdaトレーシング</a></div><div class=card-content-text>このワークショップでは、AWS Lambdaで実行される小規模なサーバーレスアプリケーションの分散トレースを構築し、AWS Kinesisを介してメッセージをproduceおよびconsumeする方法を学びます</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-c079beb4c236bf50fadf0e848c1b494b><div class=card-content><div class=card-title id=R-card-c079beb4c236bf50fadf0e848c1b494b><a href=/observability-workshop/ja/ninja-workshops/8-docker-k8s-otel/index.html>OpenTelemetry、Docker、K8sを実践で学ぶ</a></div><div class=card-content-text>このワークショップでは、これらの概念を説明するためにシンプルな.NETアプリケーションを使用します。さあ、始めましょう！ワークショップの終わりまでに、OpenTelemetryを使用した.NETアプリケーションの計装の実践経験を積み、そのアプリケーションのDocker化およびKubernetesへのデプロイを行います。また、Helmを使用したOpenTelemetryコレクターのデプロイ、コレクター設定のカスタマイズ、コレクター設定の問題のトラブルシューティングの経験も得られます。</div></div></article></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/09/29</span></span></footer></article><section><h1 class=a11y-only>Splunk4Ninjas Workshopsのサブセクション</h1><article class=default><header class=headline></header><h1 id=自動ディスカバリーワークショップ>自動ディスカバリーワークショップ</h1><ul class=card-container><li><article class="card card-popout" aria-labelledby=R-card-75c9da584b94293997063c98dfb33edc><div class=card-content><div class=card-title id=R-card-75c9da584b94293997063c98dfb33edc><a href=/observability-workshop/ja/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html>PetClinic モノリスワークショップ</a></div><div class=card-content-text>Spring PetClinic サンプルアプリケーションを使用して、Java アプリケーション向けの Splunk Observability Cloud の自動ディスカバリーおよび設定機能をデモンストレーションするハンズオンワークショップです。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-50ab8c7184ad7a055eb3ae2553ccb703><div class=card-content><div class=card-title id=R-card-50ab8c7184ad7a055eb3ae2553ccb703><a href=/observability-workshop/ja/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/index.html>PetClinic Kubernetes ワークショップ</a></div><div class=card-content-text>Kubernetes で実行される Java ベースのアプリケーション向けの自動ディスカバリーおよび設定を有効にする方法を学びます。リアルタイムモニタリングを体験し、エンドツーエンドの可視性でアプリケーションの動作を最大限に活用しましょう。</div></div></article></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>自動ディスカバリーワークショップのサブセクション</h1><article class=default><header class=headline></header><h1 id=petclinic-モノリスワークショップ>PetClinic モノリスワークショップ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>30 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><p>このワークショップの目的は、<strong>Splunk Observability Cloud</strong> プラットフォームの以下のコンポーネントを設定するための基本的な手順を説明することです：</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Automatic Discovery for Java (APM)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Real User Monitoring (RUM)</li><li>RUM から APM への相関</li><li>Splunk Log Observer (LO)</li></ul><p>また、サンプル Java アプリケーション（Spring PetClinic）のクローン（ダウンロード）方法、およびアプリケーションのコンパイル、パッケージ化、実行方法についても説明します。</p><p>アプリケーションが起動して実行されると、<strong>Splunk APM</strong> 製品で使用される Java 2.x 向けの<strong>自動ディスカバリーおよび設定</strong>機能により、メトリクス、トレース、ログが即座に表示されるようになります。</p><p>その後、<strong>Splunk OpenTelemetry Javascript Libraries (RUM)</strong> を使用して PetClinic のエンドユーザーインターフェース（アプリケーションがレンダリングする HTML ページ）を計装します。これにより、エンドユーザーが実行するすべてのクリックやページ読み込みに対して RUM トレースが生成されます。</p><p>最後に、PetClinic アプリケーションログへのトレースメタデータの自動インジェクションによって生成されたログを確認します。</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info"></i>
前提条件</summary><div class=box-content><ul><li>ポート <code>2222</code> へのアウトバウンド SSH アクセス</li><li>ポート <code>8083</code> へのアウトバウンド HTTP アクセス</li><li><code>bash</code> シェルおよび <code>vi/vim</code> エディタの基本的な知識</li></ul></div></details><p><a href=#R-image-1b2b6caf06d5501ac0cff143adee681d class=lightbox-link><img alt="PetClinic Exercise" class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/images/petclinic-exercise.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1b2b6caf06d5501ac0cff143adee681d><img alt="PetClinic Exercise" class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/images/petclinic-exercise.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>PetClinic モノリスワークショップのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-のインストール>OpenTelemetry Collector のインストール</h1><p>Splunk OpenTelemetry Collector は、インフラストラクチャとアプリケーションの計装における中核コンポーネントです。その役割は以下のデータを収集して送信することです：</p><ul><li>インフラストラクチャメトリクス（ディスク、CPU、メモリなど）</li><li>Application Performance Monitoring (APM) トレース</li><li>プロファイリングデータ</li><li>ホストおよびアプリケーションのログ</li></ul><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
既存の OpenTelemetry Collector の削除</summary><div class=box-content><p>Splunk IM ワークショップを完了している場合は、続行する前に Kubernetes で実行中の Collector を削除してください。以下のコマンドを実行して削除できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div><p>EC2 インスタンスには、古いバージョンの Collector がすでにインストールされている場合があります。Collector をアンインストールするには、以下のコマンドを実行してください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh
</span></span><span class=line><span class=cl>sudo sh /tmp/splunk-otel-collector.sh --uninstall</span></span></code></pre></div></div></details><p>インスタンスが正しく設定されていることを確認するために、このワークショップに必要な環境変数が正しく設定されているか確認する必要があります。ターミナルで以下のコマンドを実行してください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/check_env.sh</span></span></code></pre></div><p>出力で、以下のすべての環境変数が存在し、値が設定されていることを確認してください。不足している場合は、インストラクターに連絡してください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL
</span></span><span class=line><span class=cl>INSTANCE</span></span></code></pre></div><p>これで Collector のインストールに進むことができます。インストールスクリプトには、いくつかの追加パラメータが渡されます：</p><ul><li><code>--with-instrumentation</code> - Splunk ディストリビューションの OpenTelemetry Java からエージェントをインストールします。これにより、PetClinic Java アプリケーションの起動時に自動的にロードされます。設定は不要です！</li><li><code>--deployment-environment</code> - リソース属性 <code>deployment.environment</code> を指定された値に設定します。これは UI でビューをフィルタリングするために使用されます。</li><li><code>--enable-profiler</code> - Java アプリケーションのプロファイラを有効にします。これによりアプリケーションの CPU プロファイルが生成されます。</li><li><code>--enable-profiler-memory</code> - Java アプリケーションのプロファイラを有効にします。これによりアプリケーションのメモリプロファイルが生成されます。</li><li><code>--enable-metrics</code> - Micrometer メトリクスのエクスポートを有効にします</li><li><code>--hec-token</code> - Collector が使用する HEC トークンを設定します</li><li><code>--hec-url</code> - Collector が使用する HEC URL を設定します</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span> --mode agent --without-fluentd --with-instrumentation --deployment-environment <span class=nv>$INSTANCE</span>-petclinic --enable-profiler --enable-profiler-memory --enable-metrics --hec-token <span class=nv>$HEC_TOKEN</span> --hec-url <span class=nv>$HEC_URL</span></span></span></code></pre></div><p>次に、Collector にパッチを適用して、AWS インスタンス ID ではなくインスタンスのホスト名を公開するようにします。これにより、UI でのデータのフィルタリングが容易になります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p><code>agent_config.yaml</code> にパッチを適用したら、Collector を再起動する必要があります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p>インストールが完了したら、<strong>Hosts with agent installed</strong> ダッシュボードに移動して、ホストからのデータを確認できます。<strong>Dashboards → Hosts with agent installed</strong> の順に移動してください。</p><p>ダッシュボードフィルタを使用して <code>host.name</code> を選択し、ワークショップインスタンスのホスト名を入力または選択してください（これはターミナルセッションのコマンドプロンプトから取得できます）。ホストのデータが流れていることを確認したら、APM コンポーネントの作業を開始する準備が整いました。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=spring-petclinic-アプリケーションのビルド>Spring PetClinic アプリケーションのビルド</h1><p>APM をセットアップするために最初に必要なのは&mldr;そう、アプリケーションです。この演習では、Spring PetClinic アプリケーションを使用します。これは、Spring フレームワーク（Springboot）で構築された非常に人気のあるサンプル Java アプリケーションです。</p><p>まず、PetClinic の GitHub リポジトリをクローンし、その後アプリケーションのコンパイル、ビルド、パッケージ化、テストを行います：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/spring-projects/spring-petclinic</span></span></code></pre></div><p><code>spring-petclinic</code> ディレクトリに移動します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> spring-petclinic
</span></span><span class=line><span class=cl>git checkout b26f235250627a235a2974a22f2317dbef27338d</span></span></code></pre></div><p>Docker を使用して、PetClinic が使用する MySQL データベースを起動します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -e <span class=nv>MYSQL_USER</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>petclinic -p 3306:3306 docker.io/biarms/mysql:5.7</span></span></code></pre></div><p>次に、PetClinic アプリケーションにシンプルなトラフィックを生成する Locust を実行する別のコンテナを起動します。Locust は、Web アプリケーションにトラフィックを生成するために使用できるシンプルな負荷テストツールです。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --network<span class=o>=</span><span class=s2>&#34;host&#34;</span> -d -p 8090:8090 -v ~/workshop/petclinic:/mnt/locust docker.io/locustio/locust -f /mnt/locust/locustfile.py --headless -u <span class=m>1</span> -r <span class=m>1</span> -H http://127.0.0.1:8083</span></span></code></pre></div><p>次に、<code>maven</code> を使用して PetClinic をコンパイル、ビルド、パッケージ化します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
情報</summary><div class=box-content><p>初回実行時は数分かかり、アプリケーションをコンパイルする前に多くの依存関係をダウンロードします。以降のビルドはより高速になります。</p></div></details><p>ビルドが完了したら、実行しているインスタンスのパブリック IP アドレスを取得する必要があります。以下のコマンドを実行して取得できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://ifconfig.me</span></span></code></pre></div><p>IP アドレスが返されます。アプリケーションが実行されていることを確認するために必要になるので、この IP アドレスをメモしておいてください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=3-real-user-monitoring>3. Real User Monitoring</h1><p>Real User Monitoring (RUM) の計装では、ページに OpenTelemetry Javascript スニペット <a href=https://github.com/signalfx/splunk-otel-js-web rel=external><strong>https://github.com/signalfx/splunk-otel-js-web</strong></a> を追加します。ウィザードを使用して <strong>Data Management → Add Integration → RUM Instrumentation → Browser Instrumentation</strong> の順に進みます。</p><p>インストラクターがドロップダウンから使用するトークンを指示します。<strong>Next</strong> をクリックしてください。以下の形式で <strong>App name</strong> と <strong>Environment</strong> を入力します：</p><ul><li><code>&lt;INSTANCE>-petclinic-service</code> - <code>&lt;INSTANCE></code> を先ほどメモした値に置き換えてください。</li><li><code>&lt;INSTANCE>-petclinic-env</code> - <code>&lt;INSTANCE></code> を先ほどメモした値に置き換えてください。</li></ul><p>ウィザードは、ページの <code>&lt;head></code> セクションの先頭に配置する必要がある HTML コードスニペットを表示します。以下は例です（このスニペットは使用せず、ウィザードが生成したものを使用してください）：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>IMPORTANT: Replace the <span class=p>&lt;</span><span class=nt>version</span><span class=p>&gt;</span> placeholder in the src URL with a
</span></span><span class=line><span class=cl>version from https://github.com/signalfx/splunk-otel-js-web/releases
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*/
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>Spring PetClinic アプリケーションは、アプリケーションのすべてのページで再利用される単一の HTML ページを「レイアウト」ページとして使用しています。Splunk RUM 計装ライブラリを挿入するには、すべてのページで自動的に読み込まれるため、この場所が最適です。</p><p>それでは、レイアウトページを編集しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi src/main/resources/templates/fragments/layout.html</span></span></code></pre></div><p>次に、上記で生成したスニペットをページの <code>&lt;head></code> セクションに挿入します。コメントは含めず、ソース URL の <code>&lt;version></code> を <code>latest</code> に置き換えてください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!doctype html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>th:fragment</span><span class=o>=</span><span class=s>&#34;layout (template, menu)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>...</span></span></code></pre></div><p>コード変更が完了したら、アプリケーションを再ビルドして再度実行する必要があります。<code>maven</code> コマンドを実行して PetClinic をコンパイル/ビルド/パッケージ化します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>次に、ブラウザを使用してアプリケーション <code>http://&lt;IP_ADDRESS>:8083</code> にアクセスし、実際のユーザートラフィックを生成します。</p><p>RUM で、上記の RUM スニペットで定義された環境にフィルタリングし、ダッシュボードをクリックして開きます。</p><p>RUM トレースをドリルダウンすると、スパン内に APM へのリンクが表示されます。トレース ID をクリックすると、現在の RUM トレースに対応する APM トレースに移動します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=java-向け自動ディスカバリーおよび設定>Java 向け自動ディスカバリーおよび設定</h1><p>以下のコマンドでアプリケーションを起動できます。<code>mysql</code> プロファイルをアプリケーションに渡していることに注目してください。これにより、先ほど起動した MySQL データベースを使用するようアプリケーションに指示します。また、<code>otel.service.name</code> と <code>otel.resource.attributes</code> をインスタンス名を使用した論理名に設定しています。これらは UI でのフィルタリングにも使用されます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p><code>http://&lt;IP_ADDRESS>:8083</code>（<code>&lt;IP_ADDRESS></code> を先ほど取得した IP アドレスに置き換えてください）にアクセスして、アプリケーションが実行されていることを確認できます。</p><p>Collector をインストールした際、<strong>AlwaysOn Profiling</strong> と <strong>Metrics</strong> を有効にするように設定しました。これにより、Collector はアプリケーションの CPU およびメモリプロファイルを自動的に生成し、Splunk Observability Cloud に送信します。</p><p>PetClinic アプリケーションを起動すると、Collector がアプリケーションを自動的に検出し、トレースとプロファイリングのために計装するのが確認できます。</p><div class=tab-panel data-tab-group=R-tabs-95838742e43fd3e178082aa8531f4955><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-146112fc294128e4315f74d3e9a7174a aria-expanded=true data-tab-item=R-tab-022e401a0cdb9f22931069a5fda6aa70 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-95838742e43fd3e178082aa8531f4955","R-tab-022e401a0cdb9f22931069a5fda6aa70")'>
<span class=tab-nav-text>出力例</span></button></div><div class=tab-content-container><div id=R-tab-id-146112fc294128e4315f74d3e9a7174a data-tab-item=R-tab-022e401a0cdb9f22931069a5fda6aa70 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/lib/splunk-instrumentation/splunk-otel-javaagent.jar
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:58:970 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-2.6.0-otel-2.6.0
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT10S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><p>Splunk APM UI にアクセスして、アプリケーションコンポーネント、トレース、プロファイリング、DB Query パフォーマンス、メトリクスを確認できます。左側のメニューから <strong>APM</strong> をクリックし、<strong>Environment</strong> ドロップダウンをクリックして、ご自身の環境（例：<code>&lt;INSTANCE>-petclinic</code>、<code>&lt;INSTANCE></code> は先ほどメモした値に置き換えてください）を選択します。</p><p>検証が完了したら、<code>Ctrl-c</code> を押してアプリケーションを停止できます。</p><p>リソース属性は、報告されるすべてのスパンに追加できます。例えば <code>version=0.314</code> のように指定します。カンマ区切りのリソース属性リストも定義できます（例：<code>key1=val1,key2=val2</code>）。</p><p>新しいリソース属性を使用して PetClinic を再度起動しましょう。実行コマンドにリソース属性を追加すると、Collector のインストール時に定義された内容が上書きされることに注意してください。新しいリソース属性 <code>version=0.314</code> を追加しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Splunk APM UI に戻り、最近のトレースをドリルダウンすると、スパン内に新しい <code>version</code> 属性が表示されます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=4-log-observer>4. Log Observer</h1><p>Splunk Log Observer コンポーネントでは、Splunk OpenTelemetry Collector が Spring PetClinic アプリケーションからログを自動的に収集し、OTLP エクスポーターを使用して Splunk Observability Cloud に送信します。その際、ログイベントに <code>trace_id</code>、<code>span_id</code>、トレースフラグを付与します。</p><p>Log Observer は、アプリケーションとインフラストラクチャからのログをリアルタイムで表示します。ログの検索、フィルタリング、分析を行って、問題のトラブルシューティングや環境の監視が可能です。</p><p>PetClinic Web アプリケーションに戻り、<strong>Error</strong> リンクを数回クリックしてください。これにより、PetClinic アプリケーションログにいくつかのログメッセージが生成されます。</p><p><a href=#R-image-e0420653c47adefba40fbbd1be7f1302 class=lightbox-link><img alt="PetClinic Error" class="lazy lightbox figure-image" loading=lazy src=../images/petclinic-error.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e0420653c47adefba40fbbd1be7f1302><img alt="PetClinic Error" class="lazy lightbox lightbox-image" loading=lazy src=../images/petclinic-error.png></a></p><p>左側のメニューから <strong>Log Observer</strong> をクリックし、<strong>Index</strong> が <strong>splunk4rookies-workshop</strong> に設定されていることを確認してください。</p><p>次に、<strong>Add Filter</strong> をクリックし、フィールド <code>service.name</code> を検索して、値 <code>&lt;INSTANCE>-petclinic-service</code> を選択し、<code>=</code>（include）をクリックします。これで、PetClinic アプリケーションからのログメッセージのみが表示されるはずです。</p><p>PetClinic アプリケーションの <strong>Error</strong> リンクをクリックして生成されたログエントリの1つを選択してください。ログメッセージと、ログメッセージに自動的にインジェクションされたトレースメタデータが表示されます。また、APM と Infrastructure の Related Content が利用可能であることにも注目してください。</p><p><a href=#R-image-4c581264acc037aa72f75a3ccb73537b class=lightbox-link><img alt="Log Observer" class="lazy lightbox figure-image" loading=lazy src=../images/log-observer.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4c581264acc037aa72f75a3ccb73537b><img alt="Log Observer" class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer.png></a></p><p>これでワークショップは終了です。多くの内容をカバーしました。この時点で、メトリクス、トレース（APM と RUM）、ログ、データベースクエリパフォーマンス、コードプロファイリングが Splunk Observability Cloud に報告されているはずです。しかも、PetClinic アプリケーションのコードを変更することなく実現できました（RUM を除く）。</p><p><strong>おめでとうございます！</strong></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=kubernetes-上の-spring-petclinic-springboot-ベースのマイクロサービス>Kubernetes 上の Spring PetClinic SpringBoot ベースのマイクロサービス</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>90 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Pieter Hagen</span></span><p>このワークショップの目的は、Java 向けの Splunk <strong>自動ディスカバリーおよび設定</strong>機能を紹介することです。</p><p>ワークショップのシナリオは、Kubernetes にシンプルな（<strong>計装されていない</strong>）Java マイクロサービスアプリケーションをインストールすることで作成されます。</p><p>既存の Java ベースのデプロイメント向けに自動ディスカバリー機能付きの Splunk OpenTelemetry Collector をインストールする簡単な手順に従うことで、メトリクス、トレース、ログを <strong>Splunk Observability Cloud</strong> に送信することがいかに簡単かを確認できます。</p><details open class="box cstyle notices splunk"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-circle-info"></i>
前提条件</summary><div class=box-content><ul><li>ポート <strong>2222</strong> へのアウトバウンド SSH アクセス</li><li>ポート <strong>81</strong> へのアウトバウンド HTTP アクセス</li><li>Linux コマンドラインの基本的な知識</li></ul></div></details><p>このワークショップでは、以下のコンポーネントをカバーします：</p><ul><li>Splunk Infrastructure Monitoring (<strong>IM</strong>)</li><li>Splunk automatic discovery and configuration for Java (<strong>APM</strong>)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Log Observer (<strong>LO</strong>)</li><li>Splunk Real User Monitoring (<strong>RUM</strong>)</li></ul><p><em>Splunk Synthetics は少し寂しそうですが、他のワークショップでカバーしています</em> <i class="fa-fw fas fa-heart"></i></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><section><h1 class=a11y-only>PetClinic Kubernetes ワークショップのサブセクション</h1><article class=default><header class=headline></header><h1 id=アーキテクチャ>アーキテクチャ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>Spring PetClinic Java アプリケーションは、フロントエンドとバックエンドのサービスで構成されるシンプルなマイクロサービスアプリケーションです。フロントエンドサービスは、バックエンドサービスと対話するための Web インターフェースを提供する Spring Boot アプリケーションです。バックエンドサービスは、MySQL データベースと対話するための RESTful API を提供する Spring Boot アプリケーションです。</p><p>このワークショップを終えるころには、Kubernetes で実行される Java ベースのアプリケーション向けの<strong>自動ディスカバリーおよび設定</strong>を有効にする方法をより深く理解できるようになります。</p><p>以下の図は、Splunk OpenTelemetry Operator と自動ディスカバリーおよび設定を有効にした状態で Kubernetes 上で実行される Spring PetClinic Java アプリケーションのアーキテクチャを詳しく示しています。</p><p><a href=#R-image-cc774f02ffa677c0ff431581ba0b95e9 class=lightbox-link><img alt="Splunk Otel Architecture" class="lazy lightbox figure-image" loading=lazy src=../images/auto-instrumentation-java-diagram.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cc774f02ffa677c0ff431581ba0b95e9><img alt="Splunk Otel Architecture" class="lazy lightbox lightbox-image" loading=lazy src=../images/auto-instrumentation-java-diagram.png></a></p><hr><p><strong>Josh Voravong</strong> が作成した<a href=https://github.com/signalfx/splunk-otel-collector-chart/blob/main/examples/enable-operator-and-auto-instrumentation/spring-petclinic-java.md rel=external><strong>サンプル</strong></a>に基づいています。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=ワークショップインスタンスの準備>ワークショップインスタンスの準備</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>インストラクターが、このワークショップで使用するインスタンスのログイン情報を提供します。</p><p>インスタンスに初めてログインすると、以下のような Splunk ロゴが表示されます。ワークショップインスタンスへの接続に問題がある場合は、インストラクターにお問い合わせください。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ ssh -p 2222 splunk@&lt;IP-ADDRESS&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>███████╗██████╗ ██╗     ██╗   ██╗███╗   ██╗██╗  ██╗    ██╗
</span></span><span class=line><span class=cl>██╔════╝██╔══██╗██║     ██║   ██║████╗  ██║██║ ██╔╝    ╚██╗
</span></span><span class=line><span class=cl>███████╗██████╔╝██║     ██║   ██║██╔██╗ ██║█████╔╝      ╚██╗
</span></span><span class=line><span class=cl>╚════██║██╔═══╝ ██║     ██║   ██║██║╚██╗██║██╔═██╗      ██╔╝
</span></span><span class=line><span class=cl>███████║██║     ███████╗╚██████╔╝██║ ╚████║██║  ██╗    ██╔╝
</span></span><span class=line><span class=cl>╚══════╝╚═╝     ╚══════╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═╝    ╚═╝
</span></span><span class=line><span class=cl>Last login: Mon Feb  5 11:04:54 2024 from [Redacted]
</span></span><span class=line><span class=cl>splunk@show-no-config-i-0d1b29d967cb2e6ff ~ $</span></span></code></pre></div><p>インスタンスが正しく設定されていることを確認するために、このワークショップに必要な環境変数が正しく設定されているか確認する必要があります。ターミナルで以下のスクリプトを実行し、環境変数が存在し、実際の有効な値が設定されていることを確認してください：</p><div class=tab-panel data-tab-group=R-tabs-4a23247c04f01e9784866bc2a1702941><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2f1149f0cebbe80229462ab0d51b4474 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4a23247c04f01e9784866bc2a1702941","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-57a16ced2178ae3a6a68104fc87b3482 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4a23247c04f01e9784866bc2a1702941","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-2f1149f0cebbe80229462ab0d51b4474 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/check_env.sh</span></span></code></pre></div></div></div><div id=R-tab-id-57a16ced2178ae3a6a68104fc87b3482 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ACCESS_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>REALM</span> <span class=o>=</span> &lt;e.g. eu0, us1, us2, jp0, au0 etc.&gt;
</span></span><span class=line><span class=cl><span class=nv>RUM_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>HEC_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>HEC_URL</span> <span class=o>=</span> https://&lt;...&gt;/services/collector/event
</span></span><span class=line><span class=cl><span class=nv>INSTANCE</span> <span class=o>=</span> &lt;instance_name&gt;</span></span></code></pre></div></div></div></div></div><p><code>INSTANCE</code> 環境変数の値をメモしておいてください。後で <strong>Splunk Observability Cloud</strong> でデータをフィルタリングする際に使用します。</p><p>このワークショップでは、上記の環境変数が<strong>すべて</strong>必要です。値が不足しているものがある場合は、インストラクターに連絡してください。</p><details open class="box cstyle notices splunk"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-circle-info"></i>
既存の OpenTelemetry Collector の削除</summary><div class=box-content><p>この EC2 インスタンスを使用して以前に Splunk Observability ワークショップを完了している場合は、
既存の Splunk OpenTelemetry Collector のインストールが削除されていることを確認する必要があります。
これは以下のコマンドを実行することで行えます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><section><h1 class=a11y-only>2. 準備のサブセクション</h1><article class=default><header class=headline></header><h1 id=splunk-opentelemetry-collector-のデプロイ>Splunk OpenTelemetry Collector のデプロイ</h1><p>オブザーバビリティシグナル（<strong>メトリクス、トレース</strong>、<strong>ログ</strong>）を <strong>Splunk Observability Cloud</strong> に送信するには、Kubernetes クラスターに Splunk OpenTelemetry Collector をデプロイする必要があります。</p><p>このワークショップでは、Splunk OpenTelemetry Collector Helm Chart を使用します。まず、Helm chart リポジトリを Helm に追加し、<code>helm repo update</code> を実行して最新バージョンを確認します：</p><div class=tab-panel data-tab-group=R-tabs-f8b0c551acfe02ec02d5ed077358c934><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-22866bf122ce9bd8da2806897e35bad1 aria-expanded=true data-tab-item=R-tab-62904166d08e5d1c0cd759a707578288 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-f8b0c551acfe02ec02d5ed077358c934","R-tab-62904166d08e5d1c0cd759a707578288")'>
<span class=tab-nav-text>Install Helm Chart</span>
</button>
<button aria-controls=R-tab-id-7c4d95b816a5c8c338a83ee5b5cccf94 aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-f8b0c551acfe02ec02d5ed077358c934","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-22866bf122ce9bd8da2806897e35bad1 data-tab-item=R-tab-62904166d08e5d1c0cd759a707578288 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div id=R-tab-id-7c4d95b816a5c8c338a83ee5b5cccf94 data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>&#34;splunk-otel-collector-chart&#34; has been added to your repositories
</span></span><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>Hang tight while we grab the latest from your chart repositories...
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;splunk-otel-collector-chart&#34; chart repository
</span></span><span class=line><span class=cl>Update Complete. ⎈Happy Helming!⎈</span></span></code></pre></div></div></div></div></div><p><strong>Splunk Observability Cloud</strong> では、Kubernetes 上での OpenTelemetry Collector のセットアップを案内する UI ウィザードが提供されていますが、時間の都合上、以下の Helm install コマンドを使用します。自動ディスカバリーおよび設定とコードプロファイリング用のオペレーターを有効にするための追加パラメータが設定されています。</p><ul><li><code>--set="operator.enabled=true"</code> - 自動ディスカバリーおよび設定を処理するための OpenTelemetry オペレーターをインストールします。</li><li><code>--set="splunkObservability.profilingEnabled=true"</code> - オペレーター経由でコードプロファイリングを有効にします。</li></ul><p>Collector をインストールするには、以下のコマンドを実行してください。これを編集<strong>しないでください</strong>：</p><div class=tab-panel data-tab-group=R-tabs-e88b6f38d9d6973585d76996342b1560><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-29e97c1ac7130b6029c561b1b9ccbd49 aria-expanded=true data-tab-item=R-tab-5ade205167430c5bf55768631515900b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-e88b6f38d9d6973585d76996342b1560","R-tab-5ade205167430c5bf55768631515900b")'>
<span class=tab-nav-text>Helm Install</span>
</button>
<button aria-controls=R-tab-id-9d1514cf909a0a0d4d1a780b58e61baa aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-e88b6f38d9d6973585d76996342b1560","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-29e97c1ac7130b6029c561b1b9ccbd49 data-tab-item=R-tab-5ade205167430c5bf55768631515900b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector --version 0.136.0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;operatorcrds.install=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;operator.enabled=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.profilingEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;agent.service.enabled=true&#34;</span>  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=nv>$INSTANCE</span><span class=s2>-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-9d1514cf909a0a0d4d1a780b58e61baa data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>LAST DEPLOYED: Fri Apr 19 09:39:54 2024
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Platform endpoint &#34;https://http-inputs-o11y-workshop-eu0.splunkcloud.com:443/services/collector/event&#34;.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm eu0.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[INFO] You&#39;ve enabled the operator&#39;s auto-instrumentation feature (operator.enabled=true)! The operator can automatically instrument Kubernetes hosted applications.
</span></span><span class=line><span class=cl>  - Status: Instrumentation language maturity varies. See `operator.instrumentation.spec` and documentation for utilized instrumentation details.
</span></span><span class=line><span class=cl>  - Splunk Support: We offer full support for Splunk distributions and best-effort support for native OpenTelemetry distributions of auto-instrumentation libraries.</span></span></code></pre></div></div></div></div></div><p>続行する前に、Pod が <strong>Running</strong> として報告されていることを確認してください（通常約30秒かかります）。</p><div class=tab-panel data-tab-group=R-tabs-58877974ceaaaaebc173e3252c200ad3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-0779c0e9dc25691ec02b091c4f61ccb4 aria-expanded=true data-tab-item=R-tab-380f56daf2c41382fed5e183e4f1fbe1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-58877974ceaaaaebc173e3252c200ad3","R-tab-380f56daf2c41382fed5e183e4f1fbe1")'>
<span class=tab-nav-text>kubectl get pods</span>
</button>
<button aria-controls=R-tab-id-e072082343b795bc0d3c0d59d4114c14 aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-58877974ceaaaaebc173e3252c200ad3","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-0779c0e9dc25691ec02b091c4f61ccb4 data-tab-item=R-tab-380f56daf2c41382fed5e183e4f1fbe1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods <span class=p>|</span> grep splunk-otel</span></span></code></pre></div></div></div><div id=R-tab-id-e072082343b795bc0d3c0d59d4114c14 data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6bd5567d95-5f8cj     1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-tspd2                               1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-operator-69d476cb7-j7zwd                  2/2     Running   0          10m</span></span></code></pre></div></div></div></div></div><p>Splunk OpenTelemetry Collector からエラーが報告されていないことを確認してください（<code>ctrl + c</code> で終了）。または、インストール済みの<strong>素晴らしい</strong> <code>k9s</code> ターミナル UI を使用するとボーナスポイントです！</p><div class=tab-panel data-tab-group=R-tabs-7082ae6df8aae825ef8bec53f418ee4d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-609d051766fad4968fd9ea2493ab9ad6 aria-expanded=true data-tab-item=R-tab-66b92e950fb2f856e1fdec23c736e201 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-7082ae6df8aae825ef8bec53f418ee4d","R-tab-66b92e950fb2f856e1fdec23c736e201")'>
<span class=tab-nav-text>kubectl logs</span>
</button>
<button aria-controls=R-tab-id-0bdc695997425b938f263c9db4ac3ad6 aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-7082ae6df8aae825ef8bec53f418ee4d","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-609d051766fad4968fd9ea2493ab9ad6 data-tab-item=R-tab-66b92e950fb2f856e1fdec23c736e201 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-0bdc695997425b938f263c9db4ac3ad6 data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2021-03-21T16:11:10.900Z        INFO    service/service.go:364  Starting receivers...
</span></span><span class=line><span class=cl>2021-03-21T16:11:10.900Z        INFO    builder/receivers_builder.go:70 Receiver is starting... {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;prometheus&#34;, &#34;component_name&#34;: &#34;prometheus&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:75 Receiver started.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;prometheus&#34;, &#34;component_name&#34;: &#34;prometheus&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:70 Receiver is starting... {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    k8sclusterreceiver@v0.21.0/watcher.go:195       Configured Kubernetes MetadataExporter  {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;, &#34;exporter_name&#34;: &#34;signalfx&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:75 Receiver started.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    healthcheck/handler.go:128      Health Check state change       {&#34;component_kind&#34;: &#34;extension&#34;, &#34;component_type&#34;: &#34;health_check&#34;, &#34;component_name&#34;: &#34;health_check&#34;, &#34;status&#34;: &#34;ready&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    service/service.go:267  Everything is ready. Begin running and processing data.
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    k8sclusterreceiver@v0.21.0/receiver.go:59       Starting shared informers and wait for initial cache sync.      {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.281Z        INFO    k8sclusterreceiver@v0.21.0/receiver.go:75       Completed syncing shared informer caches.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
失敗したインストールの削除</summary><div class=box-content><p>OpenTelemetry Collector のインストールでエラーが発生した場合は、
以下のコマンドでインストールを削除してやり直すことができます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=petclinic-アプリケーションのデプロイ>PetClinic アプリケーションのデプロイ</h1><p>アプリケーションの最初のデプロイメントでは、ビルド済みのコンテナを使用して、観測を開始したい Kubernetes で実行される通常の Java マイクロサービスベースのアプリケーションという基本シナリオを作成します。それでは、アプリケーションをデプロイしましょう：</p><div class=tab-panel data-tab-group=R-tabs-93f6ab88238dd2b87a66b8e0f4d9b159><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-21ee3605f66e99e40e93379b0a378f9c aria-expanded=true data-tab-item=R-tab-8666ad26e93cd530823e6e5a5c706f5a class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-93f6ab88238dd2b87a66b8e0f4d9b159","R-tab-8666ad26e93cd530823e6e5a5c706f5a")'>
<span class=tab-nav-text>kubectl apply</span>
</button>
<button aria-controls=R-tab-id-2a8855a243e0350cb6d72bfc5f6d3a0d aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-93f6ab88238dd2b87a66b8e0f4d9b159","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-21ee3605f66e99e40e93379b0a378f9c data-tab-item=R-tab-8666ad26e93cd530823e6e5a5c706f5a class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/petclinic/deployment.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-2a8855a243e0350cb6d72bfc5f6d3a0d data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/config-server created
</span></span><span class=line><span class=cl>service/config-server created
</span></span><span class=line><span class=cl>deployment.apps/discovery-server created
</span></span><span class=line><span class=cl>service/discovery-server created
</span></span><span class=line><span class=cl>deployment.apps/api-gateway created
</span></span><span class=line><span class=cl>service/api-gateway created
</span></span><span class=line><span class=cl>service/api-gateway-external created
</span></span><span class=line><span class=cl>deployment.apps/customers-service created
</span></span><span class=line><span class=cl>service/customers-service created
</span></span><span class=line><span class=cl>deployment.apps/vets-service created
</span></span><span class=line><span class=cl>service/vets-service created
</span></span><span class=line><span class=cl>deployment.apps/visits-service created
</span></span><span class=line><span class=cl>service/visits-service created
</span></span><span class=line><span class=cl>deployment.apps/admin-server created
</span></span><span class=line><span class=cl>service/admin-server created
</span></span><span class=line><span class=cl>service/petclinic-db created
</span></span><span class=line><span class=cl>deployment.apps/petclinic-db created
</span></span><span class=line><span class=cl>configmap/petclinic-db-initdb-config created
</span></span><span class=line><span class=cl>deployment.apps/petclinic-loadgen-deployment created
</span></span><span class=line><span class=cl>configmap/scriptfile created</span></span></code></pre></div></div></div></div></div><p>この時点で、Pod が実行されていることを確認してデプロイメントを検証できます。コンテナのダウンロードと起動が必要なため、数分かかる場合があります。</p><div class=tab-panel data-tab-group=R-tabs-42ebf715270b5d25470418012fc13ef1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b29ab22b504cfb83f7f524cd965cf79d aria-expanded=true data-tab-item=R-tab-380f56daf2c41382fed5e183e4f1fbe1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-42ebf715270b5d25470418012fc13ef1","R-tab-380f56daf2c41382fed5e183e4f1fbe1")'>
<span class=tab-nav-text>kubectl get pods</span>
</button>
<button aria-controls=R-tab-id-399686868d4131bd6025cbfd47572e54 aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-42ebf715270b5d25470418012fc13ef1","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-b29ab22b504cfb83f7f524cd965cf79d data-tab-item=R-tab-380f56daf2c41382fed5e183e4f1fbe1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div id=R-tab-id-399686868d4131bd6025cbfd47572e54 data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                                                            READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-655dcd9b6b-dcvkb     1/1     Running   <span class=m>0</span>          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-dg2vj                               1/1     Running   <span class=m>0</span>          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-operator-57cbb8d7b4-dk5wf                 2/2     Running   <span class=m>0</span>          114s
</span></span><span class=line><span class=cl>petclinic-db-64d998bb66-2vzpn                                   1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>api-gateway-d88bc765-jd5lg                                      1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>visits-service-7f97b6c579-bh9zj                                 1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>admin-server-76d8b956c5-mb2zv                                   1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>customers-service-847db99f79-mzlg2                              1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>vets-service-7bdcd7dd6d-2tcfd                                   1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>petclinic-loadgen-deployment-5d69d7f4dd-xxkn4                   1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>config-server-67f7876d48-qrsr5                                  1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>discovery-server-554b45cfb-bqhgt                                1/1     Running   <span class=m>0</span>          58s</span></span></code></pre></div></div></div></div></div><p><code>kubectl get pods</code> の出力が、上記の Output タブに示されている出力と一致することを確認してください。すべてのサービスが <strong>Running</strong> と表示されていることを確認してください（または <code>k9s</code> を使用してステータスを継続的に監視できます）。</p><p>アプリケーションをテストするには、インスタンスのパブリック IP アドレスを取得する必要があります。以下のコマンドを実行して取得できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://ifconfig.me</span></span></code></pre></div><p><strong>http://&lt;IP_ADDRESS>:81</strong>（<strong>&lt;IP_ADDRESS></strong> を上記で取得した IP アドレスに置き換えてください）にアクセスして、アプリケーションが実行されていることを確認してください。PetClinic アプリケーションが実行されているのが確認できるはずです。アプリケーションはポート <strong>80</strong> と <strong>443</strong> でも実行されているので、これらを使用するか、ポート <strong>81</strong> に到達できない場合はそちらを使用してください。</p><p><a href=#R-image-e2f143c42f8b53b1a877e9bb0c5ed03b class=lightbox-link><img alt="Pet shop" class="lazy lightbox figure-image" loading=lazy src=../../images/petclinic.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e2f143c42f8b53b1a877e9bb0c5ed03b><img alt="Pet shop" class="lazy lightbox lightbox-image" loading=lazy src=../../images/petclinic.png></a></p><p><strong>All Owners</strong> <strong>(1)</strong> タブと <strong>Veterinarians</strong> <strong>(2)</strong> タブにアクセスして、各ページに名前のリストが表示されることを確認し、アプリケーションが正しく動作していることを確認してください。</p><p><a href=#R-image-622fed26a186004a73fb395940db8f53 class=lightbox-link><img alt=Owners class="lazy lightbox figure-image" loading=lazy src=../../images/petclinic-owners.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-622fed26a186004a73fb395940db8f53><img alt=Owners class="lazy lightbox lightbox-image" loading=lazy src=../../images/petclinic-owners.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=kubernetes-クラスターメトリクスの確認>Kubernetes クラスターメトリクスの確認</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>インストールが完了したら、<strong>Splunk Observability Cloud</strong> にログインして、Kubernetes クラスターからメトリクスが流れてきていることを確認できます。</p><p>左側のメニューから <strong>Infrastructure</strong> をクリックし、<strong>Kubernetes</strong> を選択してから、<strong>Kubernetes nodes</strong> タイルを選択します。</p><p><a href=#R-image-74bbc9377df10f04c422936810e3bdc5 class=lightbox-link><img alt=NavigatorList class="lazy lightbox figure-image" loading=lazy src=../images/navigatorlist.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-74bbc9377df10f04c422936810e3bdc5><img alt=NavigatorList class="lazy lightbox lightbox-image" loading=lazy src=../images/navigatorlist.png></a></p><p><strong>Kubernetes nodes</strong> の概要画面に入ったら、<strong>Time</strong> フィルタを <strong>-1h</strong> から過去15分 <strong>(-15m)</strong> に変更して最新のデータに焦点を当て、次に <strong>Table</strong> を選択してメトリクスを報告しているすべてのノードをリスト表示します。</p><p>次に、<strong>Refine by:</strong> パネルで <strong>Cluster name</strong> を選択し、リストからご自身のクラスターを選択します。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>特定のクラスターを識別するには、セットアップ中に実行したシェルスクリプト出力の <code>INSTANCE</code> 値を使用してください。この一意の識別子により、リスト内の他のノードの中からワークショップクラスターを見つけることができます。</p></div></details><p>これにより、ご自身のクラスターのノードのみを表示するようにリストがフィルタリングされます。</p><p><a href=#R-image-ca4d7512d592efafe4bad7f365a31d54 class=lightbox-link><img alt="K8s Nodes" class="lazy lightbox figure-image" loading=lazy src=../images/k8s-nodes.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ca4d7512d592efafe4bad7f365a31d54><img alt="K8s Nodes" class="lazy lightbox lightbox-image" loading=lazy src=../images/k8s-nodes.png></a></p><p><strong>K8s node logs</strong> ビューに切り替えて、ノードからのログを確認します。</p><p><a href=#R-image-cb80e29213b062f72ab48a98f900a02d class=lightbox-link><img alt=Logs class="lazy lightbox figure-image" loading=lazy src=../images/k8s-peek-at-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cb80e29213b062f72ab48a98f900a02d><img alt=Logs class="lazy lightbox lightbox-image" loading=lazy src=../images/k8s-peek-at-logs.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/12/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=apmの自動検出と設定のセットアップ>APMの自動検出と設定のセットアップ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10分</span>
</span>&nbsp;<p>このセクションでは、Kubernetes 上で実行されている Java サービスに対して<strong>自動検出と設定</strong>を有効化します。これにより、OpenTelemetry Collector が Pod アノテーションを検索し、Java アプリケーションに Splunk OpenTelemetry Java エージェントで計装を行う必要があることを示します。これにより、クラスター上で実行されている Java サービスからトレース、スパン、およびプロファイリングデータを取得できるようになります。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
自動検出と設定</summary><div class=box-content><p>自動検出と設定は、<strong>コード変更や再コンパイルを必要とせず</strong>にアプリケーションから<strong>トレース、スパン、およびプロファイリング</strong>データを取得するように設計されていることを理解することが重要です。</p><p>これは APM を始めるための優れた方法ですが、手動計装 の<strong>代替ではありません</strong>。手動計装では、カスタムスパン、タグ、ログをアプリケーションに追加でき、トレースにより多くのコンテキストと詳細を提供できます。</p></div></details><p>Java アプリケーションの場合、OpenTelemetry Collector は<code>instrumentation.opentelemetry.io/inject-java</code>というアノテーションを検索します。</p><p>このアノテーションの値は<code>true</code>に設定するか、OpenTelemetry Collector の<code>namespace/daemonset</code>（例：<code>default/splunk-otel-collector</code>）に設定できます。これにより、名前空間をまたいで動作することができ、このワークショップではこれを使用します。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
deployment.yamlの使用</summary><div class=box-content><p>Pod が自動的にトレースを送信するようにしたい場合は、以下に示すように<code>deployment.yaml</code>にアノテーションを追加できます。これにより、初期デプロイメント時に計装ライブラリが追加されます。時間を節約するために、以下の Pod に対してこれを実施済みです：</p><ul><li><strong>admin-server</strong></li><li><strong>config-server</strong></li><li><strong>discovery-server</strong></li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class=l>spring-petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>instrumentation.opentelemetry.io/inject-java</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;default/splunk-otel-collector&#34;</span></span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>4. 自動検出と設定のサブセクション</h1><article class=default><header class=headline></header><h1 id=デプロイメントのパッチ適用>デプロイメントのパッチ適用</h1><p><strong>自動検出と設定</strong>を構成するには、デプロイメントに計装アノテーションを追加するためのパッチを適用する必要があります。パッチが適用されると、OpenTelemetry Collectorが自動検出と設定ライブラリを注入し、Podが再起動されてトレースとプロファイリングデータの送信が開始されます。まず、以下を実行して<code>api-gateway</code>に<code>splunk-otel-java</code>イメージがないことを確認します：</p><div class=tab-panel data-tab-group=R-tabs-a9b6f8887c046f51cf69d8136bbd4ea3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c82ce47a010c97834175399ff69616fd aria-expanded=true data-tab-item=R-tab-147de2e4d489d131e220c244ab59800a class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a9b6f8887c046f51cf69d8136bbd4ea3","R-tab-147de2e4d489d131e220c244ab59800a")'>
<span class=tab-nav-text>Describe api-gateway</span>
</button>
<button aria-controls=R-tab-id-a28d0791f2973bd8bb5c93712b868144 aria-expanded=false data-tab-item=R-tab-397382ef4cd20471e3d9c9fecb6c01a7 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a9b6f8887c046f51cf69d8136bbd4ea3","R-tab-397382ef4cd20471e3d9c9fecb6c01a7")'>
<span class=tab-nav-text>Describe Output</span></button></div><div class=tab-content-container><div id=R-tab-id-c82ce47a010c97834175399ff69616fd data-tab-item=R-tab-147de2e4d489d131e220c244ab59800a class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span> grep Image:</span></span></code></pre></div></div></div><div id=R-tab-id-a28d0791f2973bd8bb5c93712b868144 data-tab-item=R-tab-397382ef4cd20471e3d9c9fecb6c01a7 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Image:         quay.io/phagen/spring-petclinic-api-gateway:0.0.2</span></span></code></pre></div></div></div></div></div><p>次に、デプロイメントにアノテーションを追加して、すべてのサービスのJava自動検出と設定を有効にします。以下のコマンドは、すべてのデプロイメントにパッチを適用します。これにより、OpenTelemetry Operatorが<code>splunk-otel-java</code>イメージをPodに注入します：</p><div class=tab-panel data-tab-group=R-tabs-1bcc6f09b42585abfcd8acbf67ca3c1b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-495ba9f22aabf2675c1b05c4024dda66 aria-expanded=true data-tab-item=R-tab-095a030c413da2306699957e31df046b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1bcc6f09b42585abfcd8acbf67ca3c1b","R-tab-095a030c413da2306699957e31df046b")'>
<span class=tab-nav-text>Patch all PetClinic services</span>
</button>
<button aria-controls=R-tab-id-91e99bbf031460890609a8cfc6876e9e aria-expanded=false data-tab-item=R-tab-c7f3c9adf1663130bcb611eae74c77dc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-1bcc6f09b42585abfcd8acbf67ca3c1b","R-tab-c7f3c9adf1663130bcb611eae74c77dc")'>
<span class=tab-nav-text>Patch Output</span></button></div><div class=tab-content-container><div id=R-tab-id-495ba9f22aabf2675c1b05c4024dda66 data-tab-item=R-tab-095a030c413da2306699957e31df046b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get deployments -l app.kubernetes.io/part-of<span class=o>=</span>spring-petclinic -o name <span class=p>|</span> xargs -I % kubectl patch % -p <span class=s2>&#34;{\&#34;spec\&#34;: {\&#34;template\&#34;:{\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;instrumentation.opentelemetry.io/inject-java\&#34;:\&#34;default/splunk-otel-collector\&#34;}}}}}&#34;</span></span></span></code></pre></div></div></div><div id=R-tab-id-91e99bbf031460890609a8cfc6876e9e data-tab-item=R-tab-c7f3c9adf1663130bcb611eae74c77dc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/config-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/admin-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/customers-service patched
</span></span><span class=line><span class=cl>deployment.apps/visits-service patched
</span></span><span class=line><span class=cl>deployment.apps/discovery-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/vets-service patched
</span></span><span class=line><span class=cl>deployment.apps/api-gateway patched</span></span></code></pre></div></div></div></div></div><p><strong>config-server</strong>、<strong>discovery-server</strong>、<strong>admin-server</strong>については、すでにパッチが適用されているため変更はありません。</p><p><code>api-gateway</code> Podのコンテナイメージを再度確認するには、以下のコマンドを実行します：</p><div class=tab-panel data-tab-group=R-tabs-3b80ea6654db2cc91e61817b841e0367><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2e059f9e48a0994a2a4a90a911479d03 aria-expanded=true data-tab-item=R-tab-147de2e4d489d131e220c244ab59800a class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-3b80ea6654db2cc91e61817b841e0367","R-tab-147de2e4d489d131e220c244ab59800a")'>
<span class=tab-nav-text>Describe api-gateway</span>
</button>
<button aria-controls=R-tab-id-2b7e6e549e17c259acff450db0a652a8 aria-expanded=false data-tab-item=R-tab-397382ef4cd20471e3d9c9fecb6c01a7 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-3b80ea6654db2cc91e61817b841e0367","R-tab-397382ef4cd20471e3d9c9fecb6c01a7")'>
<span class=tab-nav-text>Describe Output</span></button></div><div class=tab-content-container><div id=R-tab-id-2e059f9e48a0994a2a4a90a911479d03 data-tab-item=R-tab-147de2e4d489d131e220c244ab59800a class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span> grep Image:</span></span></code></pre></div></div></div><div id=R-tab-id-2b7e6e549e17c259acff450db0a652a8 data-tab-item=R-tab-397382ef4cd20471e3d9c9fecb6c01a7 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Image:         ghcr.io/signalfx/splunk-otel-java/splunk-otel-java:v1.30.0
</span></span><span class=line><span class=cl>Image:         quay.io/phagen/spring-petclinic-api-gateway:0.0.2</span></span></code></pre></div></div></div></div></div><p><code>api-gateway</code>に新しいイメージが追加され、<code>ghcr.io</code>から<code>splunk-otel-java</code>がプルされます（注：2つの<code>api-gateway</code>コンテナが表示される場合、元のコンテナがまだ終了処理中の可能性があるため、数秒待ってください）。</p><p><strong>Splunk Observability Cloud</strong>のKubernetes Navigatorに戻ります。数分後、Podがオペレーターによって再起動され、自動検出と設定コンテナが追加されることが確認できます。以下のスクリーンショットのような表示になります：</p><p><a href=#R-image-ea9491b5c9fa1ca165d78cdfc049854a class=lightbox-link><img alt=restart class="lazy lightbox figure-image" loading=lazy src=../../images/k8s-navigator-restarted-pods.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ea9491b5c9fa1ca165d78cdfc049854a><img alt=restart class="lazy lightbox lightbox-image" loading=lazy src=../../images/k8s-navigator-restarted-pods.png></a></p><p>Kubernetes NavigatorでPodが緑色になるまで待ってから、次のセクションに進んでください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=splunk-apmでのデータの表示>Splunk APMでのデータの表示</h1><p>左側のメニューで<strong>APM</strong>をクリックして、新しく計装されたサービスからのトレースによって生成されたデータを確認します。</p><p>ドロップダウンボックスで<strong>Environment</strong>フィルター <strong>(1)</strong> をワークショップインスタンスの名前に変更します。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>これは**<code>&lt;INSTANCE>-workshop</code><strong>になります。ここで</strong><code>INSTANCE</code>**は、先ほど実行したシェルスクリプトの値です。これのみが選択されていることを確認してください。</p></div></details><p><a href=#R-image-5b3d487ab4562d3227001e5190ae6f64 class=lightbox-link><img alt=apm class="lazy lightbox figure-image" loading=lazy src=../../images/zero-config-first-services-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5b3d487ab4562d3227001e5190ae6f64><img alt=apm class="lazy lightbox lightbox-image" loading=lazy src=../../images/zero-config-first-services-overview.png></a></p><p><strong>Service Map</strong> <strong>(2)</strong> ペインをクリックして、次のセクションの準備をします。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=apm-features>APM Features</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>前のセクションで見てきたように、サービスで<strong>自動検出と設定</strong>を有効にすると、トレースが<strong>Splunk Observability Cloud</strong>に送信されます。</p><p>これらのトレースにより、Splunkは自動的に<strong>Service Maps</strong>と<strong>RED Metrics</strong>を生成します。これらは、サービスの動作とサービス間の相互作用を理解するための最初のステップです。</p><p>次のセクションでは、トレース自体と、コードに触れることなくサービスの動作を理解するのに役立つ情報を詳しく見ていきます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>5. APM Featuresのサブセクション</h1><article class=default><header class=headline></header><h1 id=apm-service-map>APM Service Map</h1><p><a href=#R-image-db8283e914fd70bfa07aa9c6f8911d35 class=lightbox-link><img alt="apm map" class="lazy lightbox figure-image" loading=lazy src=../../images/zero-config-first-services-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-db8283e914fd70bfa07aa9c6f8911d35><img alt="apm map" class="lazy lightbox lightbox-image" loading=lazy src=../../images/zero-config-first-services-map.png></a></p><p>上記のマップは、すべてのサービス間のすべての相互作用を示しています。PetClinic Microserviceアプリケーションが起動して完全に同期するまで数分かかるため、マップはまだ中間状態にある可能性があります。時間フィルタを**-2m<strong>と入力してカスタム時間の</strong>2分<strong>に減らすと役立ちます。画面右上の</strong>Refresh<strong>ボタン</strong>(1)**をクリックできます。赤い円で示される初期起動関連のエラーは最終的に消えます。</p><p>次に、各サービスで利用可能なメトリクスを調べるために、リクエスト、エラー、期間（RED）メトリクスダッシュボードを見てみましょう。</p><p>この演習では、サービスオペレーションが高いレイテンシやエラーを示している場合に使用する一般的なシナリオを使用します。</p><p>依存関係マップで<strong>customers-service</strong>をクリックし、<strong>Services</strong>ドロップダウンボックス**(1)<strong>で<code>customers-service</code>が選択されていることを確認します。次に、サービス名に隣接するOperationsドロップダウン</strong>(2)**から<code>GET /owners</code>を選択します。</p><p>これにより、以下に示すように<code>GET /owners</code>でフィルタリングされたワークフローが表示されます：</p><p><a href=#R-image-2f187748347545900c2e062d65d009ed class=lightbox-link><img alt="select a trace" class="lazy lightbox figure-image" loading=lazy src=../../images/select-workflow.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2f187748347545900c2e062d65d009ed><img alt="select a trace" class="lazy lightbox lightbox-image" loading=lazy src=../../images/select-workflow.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=apm-trace>APM Trace</h1><p>トレースを選択するには、<code>Service Requests & Errors</code>チャート**(1)**の線を選択します。関連するトレースの選択肢が表示されます。</p><p>関連するトレースのリストが表示されたら、青い**(2)** Trace ID Linkをクリックします。選択するトレースがServicesカラムに記載されている3つのサービスと同じものであることを確認してください。</p><p><a href=#R-image-179d1fecd30575e85fd30c9eb0a572d7 class=lightbox-link><img alt=workflow-trace-pick class="lazy lightbox figure-image" loading=lazy src=../../images/selecting-a-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-179d1fecd30575e85fd30c9eb0a572d7><img alt=workflow-trace-pick class="lazy lightbox lightbox-image" loading=lazy src=../../images/selecting-a-trace.png></a></p><p>これにより、ウォーターフォールビューで選択されたトレースが表示されます：</p><p>ここにはいくつかのセクションがあります：</p><ul><li>Waterfall Pane <strong>(1)</strong>：トレースとスパンとして表示されるすべてのインストルメントされた関数が、その期間表示と順序/関係とともに表示されます。</li><li>Trace Info Pane <strong>(2)</strong>：選択されたスパン情報が表示されます（Waterfall Pane内でスパンの周りにボックスでハイライトされています）。</li><li>Span Pane <strong>(3)</strong>：選択されたスパンで送信されたすべてのタグを見つけることができます。下にスクロールしてすべてを確認できます。</li><li>Process Pane：スパンを作成したプロセスに関連するタグが表示されます（スクリーンショットに含まれていないため、下にスクロールして確認してください）。</li><li>Trace Properties：ペインの右上にあり、デフォルトでは折りたたまれています。</li></ul><p><a href=#R-image-99a8128e2fbe4851c4d4cb0e9b8e9f33 class=lightbox-link><img alt=waterfall class="lazy lightbox figure-image" loading=lazy src=../../images/waterfall-view.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-99a8128e2fbe4851c4d4cb0e9b8e9f33><img alt=waterfall class="lazy lightbox lightbox-image" loading=lazy src=../../images/waterfall-view.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=apm-span>APM Span</h1><p>スパンを調べる際、トレーシングの上で<strong>自動検出と設定</strong>を使用すると、<strong>コード変更なし</strong>で得られるいくつかの標準機能を見てみましょう：</p><p>まず、Waterfall Paneで、以下のスクリーンショットに示すように<code>customers-service:SELECT petclinic</code>または類似のスパンが選択されていることを確認してください：</p><p><a href=#R-image-c3622486f60f882b5861c333b5eabb91 class=lightbox-link><img alt=DB-query class="lazy lightbox figure-image" loading=lazy src=../../images/db-query.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c3622486f60f882b5861c333b5eabb91><img alt=DB-query class="lazy lightbox lightbox-image" loading=lazy src=../../images/db-query.png></a></p><ul><li>基本的なレイテンシ情報は、インストルメントされた関数または呼び出しのバーとして表示されます。上記の例では、17.8ミリ秒かかりました。</li><li>いくつかの類似したスパン**(1)**は、スパンが複数回繰り返される場合にのみ表示されます。この場合、例では10回の繰り返しがあります。<code>10x</code>をクリックすると、すべてのスパンが順番に表示されるように表示/非表示を切り替えることができます。</li><li><strong>Inferred Services</strong>：インストルメントされていない外部システムへの呼び出しは、グレーの「推測された」スパンとして表示されます。この例のInferred Serviceまたはスパンは、上記に示すようにMysqlデータベース <code>mysql:petclinic SELECT petclinic</code> **(2)**への呼び出しです。</li><li><strong>Span Tags</strong>：Tag Paneには、自動検出と設定によって生成された標準タグが表示されます。この場合、スパンはデータベースを呼び出しているため、<code>db.statement</code>タグ**(3)**が含まれています。このタグは、このスパン中に実行されたデータベース呼び出しで使用されるDBクエリステートメントを保持します。これはDB-Query Performance機能で使用されます。DB-Query Performanceについては次のセクションで見ていきます。</li><li><strong>Always-on Profiling</strong>：システムがスパンのライフサイクル中にプロファイリングデータをキャプチャするように設定されている<strong>場合</strong>、スパンのタイムラインでキャプチャされたコールスタックの数が表示されます。上記の例では、<code>customer-service:GET /owners</code>スパンに対して18個のコールスタックがあることがわかります。<strong>(4)</strong></li></ul><p>次のセクションでプロファイリングを見ていきます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=service-centric-view>Service Centric View</h1><p>Splunk APMは、エンジニアに1つの集中ビューでサービスパフォーマンスの深い理解を提供する<strong>Service Centric Views</strong>を提供します。すべてのサービスにわたって、エンジニアはサービスの基盤となるインフラストラクチャからのエラーやボトルネックを迅速に特定し、新しいデプロイによるパフォーマンス低下を特定し、すべてのサードパーティ依存関係の健全性を可視化できます。</p><p><code>api-gateway</code>のこのダッシュボードを表示するには、左側のメニューから<strong>APM</strong>をクリックし、リストの<code>api-gateway</code>サービスをクリックします。これにより、Service Centric Viewダッシュボードが表示されます：</p><p><a href=#R-image-994e039727d9903b34da922917a80778 class=lightbox-link><img alt=service_maps class="lazy lightbox figure-image" loading=lazy src=../../images/service-view.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-994e039727d9903b34da922917a80778><img alt=service_maps class="lazy lightbox lightbox-image" loading=lazy src=../../images/service-view.png></a></p><p>インストルメントされた各サービスで利用可能なこのビューは、<strong>Service metrics</strong>、<strong>Error breakdown</strong>、<strong>Runtime metrics (Java)</strong>、<strong>Infrastructure metrics</strong>の概要を提供します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=always-on-profiling--db-query-performance>Always-On Profiling & DB Query Performance</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>前の章で見てきたように、APMを使用して、コードに触れることなく、さまざまなサービス間のインタラクションをトレースすることができ、問題をより迅速に特定できます。</p><p>トレーシングに加えて、<strong>automatic discovery and configuration</strong>は、問題をさらに迅速に発見するのに役立つ追加機能を最初から提供します。このセクションでは、そのうちの2つを見ていきます：</p><ul><li><strong>Always-on Profiling and Java Metrics</strong></li><li><strong>Database Query Performance</strong></li></ul><p><strong>Always-on Profiling</strong>または<strong>Database Query Performance</strong>についてさらに深く学びたい場合は、<a href=/en/scenarios/debug_problems/><strong>Debug Problems in Microservices</strong></a>という別のNinja Workshopがありますので、そちらをご覧ください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>6. Advanced Featuresのサブセクション</h1><article class=default><header class=headline></header><h1 id=always-on-profiling--metrics>Always-On Profiling & Metrics</h1><p>先ほどHelmチャートを使用してSplunk Distribution of the OpenTelemetry Collectorをインストールした際、<strong>AlwaysOn Profiling</strong>と<strong>Metrics</strong>を有効にするように設定しました。これにより、OpenTelemetry JavaはアプリケーションのCPUとメモリのプロファイリングを自動的に生成し、Splunk Observability Cloudに送信します。</p><p>PetClinicアプリケーションをデプロイしてアノテーションを設定すると、collectorは自動的にアプリケーションを検出し、トレースとプロファイリングのためにインストルメントします。これを確認するために、次のスクリプトを実行して、インストルメントしているJavaコンテナの1つの起動ログを調べることができます：</p><p>ログには、Javaの自動検出と設定によって取得されたフラグが表示されます：</p><p><div class=tab-panel data-tab-group=R-tabs-318c55ea259ed715d89da56a8c321ea6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b5d63ac7a263e6c90d92fec535c6ab9c aria-expanded=true data-tab-item=R-tab-c3d2921cc9f4b101462512ad1f1676da class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-318c55ea259ed715d89da56a8c321ea6","R-tab-c3d2921cc9f4b101462512ad1f1676da")'>
<span class=tab-nav-text>Run the script</span>
</button>
<button aria-controls=R-tab-id-ce82dca542351b3c3f50970afefc6ff4 aria-expanded=false data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-318c55ea259ed715d89da56a8c321ea6","R-tab-587b796170a9abac4701cd8aa1bb38cb")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div id=R-tab-id-b5d63ac7a263e6c90d92fec535c6ab9c data-tab-item=R-tab-c3d2921cc9f4b101462512ad1f1676da class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-logs data-lang=logs>.  ~/workshop/petclinic/scripts/get_logs.sh</code></pre></div></div></div><div id=R-tab-id-ce82dca542351b3c3f50970afefc6ff4 data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2024/02/15 09:42:00 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:01 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:02 Connected to tcp://discovery-server:8761
</span></span><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS:  -javaagent:/otel-auto-instrumentation-java/javaagent.jar
</span></span><span class=line><span class=cl>Picked up _JAVA_OPTIONS: -Dspring.profiles.active=docker,mysql -Dsplunk.profiler.call.stack.interval=150
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:056 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.30.1-otel-1.32.1
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:768 +0000] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:480 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:506 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:510 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:515 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT0.15S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:518 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div>私たちが注目しているのは、<code>com.splunk.opentelemetry.profiler.ConfigurationLogger</code>によって書き込まれたセクション、つまり<strong>Profiling Configuration</strong>です。</p><p><code>splunk.profiler.directory</code>など、制御できるさまざまな設定を確認できます。これは、エージェントがSplunkに送信する前にコールスタックを書き込む場所です。（これは、コンテナの設定方法によって異なる場合があります。）</p><p>変更したいもう1つのパラメータは<code>splunk.profiler.call.stack.interval</code>です。これは、システムがCPU Stack traceをキャプチャする頻度です。Pet Clinicアプリケーションのような短いスパンがある場合は、このインターバル設定を短くすることをお勧めします。デモアプリケーションでは、デフォルトのインターバル値を変更しなかったため、スパンに常にCPU Call Stackが関連付けられているとは限りません。</p><p>これらのパラメータを設定する方法は<a href=https://help.splunk.com/en/splunk-observability-cloud/manage-data/available-data-sources/supported-integrations-in-splunk-observability-cloud/apm-instrumentation/instrument-a-java-application/configure-the-java-agent#profiling-configuration-java rel=external>こちら</a>で確認できます。以下の例では、<code>deployment.yaml</code>でコールスタックのより高い収集レートを設定する方法を示しています。これは、JAVA_OPTIONS configセクションでこの値を設定することで行います。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>JAVA_OPTIONS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Xdebug -Dsplunk.profiler.call.stack.interval=150&#34;</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=trace-waterfall内のalways-on-profiling>Trace Waterfall内のAlways-On Profiling</h1><p>APM Waterfall ビューでオリジナルの Trace & Span <strong>(1)</strong>（または類似のもの）を選択し、右側のペインから**Memory Stack Traces (2)**を選択してください：</p><p><a href=#R-image-c8f5abee95dea78982632a6d5237936d class=lightbox-link><img alt="profiling from span" class="lazy lightbox figure-image" loading=lazy src=../../images/flamechart-in-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c8f5abee95dea78982632a6d5237936d><img alt="profiling from span" class="lazy lightbox lightbox-image" loading=lazy src=../../images/flamechart-in-waterfall.png></a></p><p>ペインに Memory Stack Trace Flame Graph **(3)**が表示されます。スクロールするか、ペインの右側をドラッグして拡大できます。</p><p>AlwaysOn Profiling は、アプリケーションのコードのスナップショット、つまりスタックトレースを常に取得しています。何千ものスタックトレースを読まなければならないことを想像してみてください！それは現実的ではありません。これを支援するために、AlwaysOn Profiling はプロファイリングデータを集約して要約し、<strong>Flame Graph</strong>と呼ばれるビューで Call Stacks を探索する便利な方法を提供します。これは、アプリケーションからキャプチャされたすべてのスタックトレースの要約を表します。Flame Graph を使用して、パフォーマンスの問題を引き起こしている可能性のあるコードの行を発見し、コードに加えた変更が意図した効果を持っているかどうかを確認できます。</p><p>Always-on Profiling をさらに詳しく調べるには、<strong>Memory Stack Traces</strong>の下の Profiling Pane で上の画像で参照されている Span **(3)**を選択してください。これにより、Always-on Profiling のメイン画面が開き、Memory ビューがあらかじめ選択されています：</p><p><a href=#R-image-f3561d64560bd75c63616222c2278371 class=lightbox-link><img alt="Profiling main" class="lazy lightbox figure-image" loading=lazy src=../../images/profiling-memory.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f3561d64560bd75c63616222c2278371><img alt="Profiling main" class="lazy lightbox lightbox-image" loading=lazy src=../../images/profiling-memory.png></a></p><ul><li>Time フィルタは、選択したスパンの時間枠に設定されます <strong>(1)</strong></li><li>Java Memory Metric Charts **(2)**では、<code>Heap Memoryのモニター</code>、<code>Memory Allocation Rate</code>や<code>Garbage Collecting</code> Metrics などの<code>Application Activity</code>を確認できます。</li><li>スパン **(3)**に関連するメトリクスと Stack Traces のみにフォーカス/表示する機能。これにより、必要に応じて Java アプリケーションで実行されているバックグラウンドアクティビティをフィルタで除外できます。</li><li>識別された Java Function calls **(4)**により、その関数から呼び出されたメソッドにドリルダウンできます。</li><li>プロファイルされたサービスのスタックトレースに基づく階層の視覚化を持つ Flame Graph <strong>(5)</strong>。</li><li>サービスが複数のバージョンを起動する場合に備えて、Service instance **(6)**を選択する機能。</li></ul><p>さらなる調査のために、UI ではスタックトレースをクリックして、呼び出された関数と、フレームチャートから関連する行を確認できます。これを使用して、コーディングプラットフォームで実際のコードの行を表示できます（もちろん、お好みのコーディングプラットフォームによって異なります）。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=database-query-performance>Database Query Performance</h1><p>Database Query Performanceを使用すると、Splunk APMで直接、データベースクエリがサービスの可用性に与える影響をモニターできます。これにより、データベースをインストルメントすることなく、長時間実行されるクエリ、最適化されていないクエリ、または重いクエリを迅速に特定し、それらが引き起こしている可能性のある問題を軽減できます。</p><p>データベースクエリのパフォーマンスを確認するには、ブラウザで戻るか、メニューバーのAPMセクションに移動してAPMの<strong>Service Map</strong>ページに移動し、<strong>Service Map</strong>タイルをクリックします。</p><p>Dependency mapで推論されたデータベースサービス <code>mysql:petclinic</code> Inferred Database serverを選択し <strong>(1)</strong>、次に右側のペインをスクロールして<strong>Database Query Performance</strong> Pane **(2)**を見つけます。</p><p><a href=#R-image-57718a7a165a2b19c4d07319f024e970 class=lightbox-link><img alt="DB-query from map" class="lazy lightbox figure-image" loading=lazy src=../../images/db-query-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-57718a7a165a2b19c4d07319f024e970><img alt="DB-query from map" class="lazy lightbox lightbox-image" loading=lazy src=../../images/db-query-map.png></a></p><p>マップで選択したサービスが実際に（推論された）データベースサーバーである場合、このペインには期間に基づく上位90%（P90）のデータベースコールが表示されます。db-queryパフォーマンス機能をさらに詳しく調べるには、ペインの上部にある<strong>Database Query Performance</strong>という単語のどこかをクリックします。</p><p>これにより、DB-query Performanceの概要画面が表示されます：</p><p><a href=#R-image-d44690c392d79748d33507300e3bde66 class=lightbox-link><img alt="DB-query full" class="lazy lightbox figure-image" loading=lazy src=../../images/db-query-full.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d44690c392d79748d33507300e3bde66><img alt="DB-query full" class="lazy lightbox lightbox-image" loading=lazy src=../../images/db-query-full.png></a></p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Database Query Normalization</summary><div class=box-content><p>デフォルトでは、Splunk APMインストルメンテーションはデータベースクエリをサニタイズして、<code>db.statements</code>からシークレットや個人を特定できる情報（PII）などの機密データを削除またはマスクします。データベースクエリの正規化をオフにする方法は<a href=https://help.splunk.com/en/splunk-observability-cloud/monitor-application-performance/monitor-database-query-performance/troubleshoot-database-query-performance#turn-off-database-query-normalization rel=external>こちら</a>で確認できます。</p></div></details><p>この画面には、Splunk Observability Cloudに送信されたTraces & Spansに基づいて、アプリケーションからデータベースに対して実行されたすべてのDatabase queries **(1)**が表示されます。時間ブロック間で比較したり、Total Time、P90 Latency & Requests **(2)**でソートしたりできることに注意してください。</p><p>リスト内の各Database queryについて、時間ウィンドウ中の最高レイテンシ、コールの総数、および1秒あたりのリクエスト数 **(3)**が表示されます。これにより、クエリを最適化できる場所を特定できます。</p><p>右側のペイン **(5)**の2つのチャートを使用して、Database Callsを含むトレースを選択できます。Tag Spotlightペイン **(6)**を使用して、エンドポイントやタグに基づいて、データベースコールに関連するタグを確認します。</p><p>クエリの詳細ビューを表示する必要がある場合：</p><p><a href=#R-image-24c28ed9691f2680a3a17b7d9a38a2ed class=lightbox-link><img alt=details class="lazy lightbox figure-image" loading=lazy src=../../images/query-details.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-24c28ed9691f2680a3a17b7d9a38a2ed><img alt=details class="lazy lightbox lightbox-image" loading=lazy src=../../images/query-details.png></a></p><p>特定のQuery **(1)**をクリックします。これにより、Query Details pane **(2)**が開き、より詳細な調査に使用できます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=log-observer>Log Observer</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>この時点まで、<strong>コード変更は一切なく</strong>、トレーシング、プロファイリング、データベースクエリパフォーマンスのデータが Splunk Observability Cloud に送信されています。</p><p>次に、<strong>Splunk Log Observer</strong> を使用して Spring PetClinic アプリケーションからログデータを取得します。</p><p><strong>Splunk OpenTelemetry Collector</strong> は、Spring PetClinic アプリケーションからログを自動的に収集し、OTLP エクスポーターを使用して Splunk Observability Cloud に送信します。その際、ログイベントには <code>trace_id</code>、<code>span_id</code>、トレースフラグが付与されます。</p><p><strong>Splunk Log Observer</strong> を使用してログを表示し、ログ情報をサービスやトレースと自動的に関連付けます。</p><p>この機能は <a href=https://help.splunk.com/en/splunk-observability-cloud/data-tools/related-content rel=external><strong>Related Content</strong></a> と呼ばれています。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>7. Log Observerのサブセクション</h1><article class=default><header class=headline></header><h1 id=ログを確認する>ログを確認する</h1><p>ログを表示するには、左側のメニューで <a href=#R-image-09ba0e1c852803de59b4bac00192a00b class=lightbox-link><img alt=Logo class="inline lazy lightbox figure-image" loading=lazy src="../images/logo-icon.png?classes=inline&height=25px" style=height:25px;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-09ba0e1c852803de59b4bac00192a00b><img alt=Logo class="inline lazy lightbox lightbox-image" loading=lazy src="../images/logo-icon.png?classes=inline&height=25px"></a> <strong>Log Observer</strong> をクリックします。Log Observer に入ったら、フィルターバーの <strong>Index</strong> が <strong>splunk4rookies-workshop</strong> に設定されていることを確認してください。<strong>(1)</strong></p><p>次に、<strong>Add Filter</strong> をクリックし、<em>Fields</em> <strong>(2)</strong> オプションを使用して <code>deployment.environment</code> フィールド <strong>(3)</strong> を検索します。ドロップダウンリストから、あなたのワークショップインスタンスを選択し <strong>(4)</strong>、<code>=</code> (含める) をクリックします。これで、PetClinic アプリケーションからのログメッセージのみが表示されます。</p><p><a href=#R-image-4566e3b2eebba0c57e23cb74047edc7f class=lightbox-link><img alt="Log Observer sort" class="lazy lightbox figure-image" loading=lazy src=../../images/log-observer-sort.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4566e3b2eebba0c57e23cb74047edc7f><img alt="Log Observer sort" class="lazy lightbox lightbox-image" loading=lazy src=../../images/log-observer-sort.png></a></p><p>次に、<code>service.name</code> フィールドを検索し、値 <code>customers-service</code> を選択して <code>=</code> (含める) をクリックします。これがフィルターバー <strong>(1)</strong> に表示されます。次に、<strong>Run Search</strong> ボタン <strong>(2)</strong> をクリックします。</p><p><a href=#R-image-247bdfab8e163bb8ccfff34225e3a466 class=lightbox-link><img alt="Log Observer run" class="lazy lightbox figure-image" loading=lazy src=../../images/log-observer-run.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-247bdfab8e163bb8ccfff34225e3a466><img alt="Log Observer run" class="lazy lightbox lightbox-image" loading=lazy src=../../images/log-observer-run.png></a></p><p>これによりログエントリがリフレッシュされ、<code>customers-service</code> からのエントリのみが表示されるように絞り込まれます。</p><p><a href=#R-image-9da5af76392d23226432f702b3cfdaa1 class=lightbox-link><img alt="Log Observer" class="lazy lightbox figure-image" loading=lazy src=../../images/log-observer-trace-info.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9da5af76392d23226432f702b3cfdaa1><img alt="Log Observer" class="lazy lightbox lightbox-image" loading=lazy src=../../images/log-observer-trace-info.png></a></p><p><em>&ldquo;Saving pet&rdquo;</em> で始まるエントリ <strong>(1)</strong> をクリックします。サイドペーンが開き、関連するトレースIDやスパンID <strong>(2)</strong> を含む詳細情報を確認できます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=related-content>Related Content</h1><p>下部のペインには、関連するコンテンツが表示されます。以下のスクリーンショットでは、APM がこのログ行に関連するトレースを見つけたことがわかります <strong>(1)</strong>:</p><p><a href=#R-image-8ba75f72d532c353e047a747feca6217 class=lightbox-link><img alt=RC class="lazy lightbox figure-image" loading=lazy src=../../images/log-apm-rc.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8ba75f72d532c353e047a747feca6217><img alt=RC class="lazy lightbox lightbox-image" loading=lazy src=../../images/log-apm-rc.png></a></p><p><strong>Trace for 960432ac9f16b98be84618778905af50</strong> <strong>(2)</strong> をクリックすると、このログ行が生成された特定のトレースの APM ウォーターフォールに移動します:</p><p><a href=#R-image-2a09cc939f956b33a4d9abd84909057a class=lightbox-link><img alt="waterfall logs" class="lazy lightbox figure-image" loading=lazy src=../../images/waterfall-with-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2a09cc939f956b33a4d9abd84909057a><img alt="waterfall logs" class="lazy lightbox lightbox-image" loading=lazy src=../../images/waterfall-with-logs.png></a></p><p>ログに関する <strong>Related Content</strong> ペーンが表示されていることに注意してください <strong>(1)</strong>。これをクリックすると、Log Observer に戻り、このトレースの一部であるすべてのログ行が表示されます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=real-user-monitoring>Real User Monitoring</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>アプリケーションに Real User Monitoring (RUM) インストルメンテーションを有効にするには、コードベースに Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web rel=external><strong>https://github.com/signalfx/splunk-otel-js-web</strong></a> スニペットを追加する必要があります。</p><p>Spring PetClinic アプリケーションは、アプリケーションのすべてのビューで再利用される単一の <a href=https://github.com/spring-petclinic/spring-petclinic-microservices/blob/main/spring-petclinic-api-gateway/src/main/resources/static/index.html rel=external><strong>index</strong></a> HTML ページを使用しています。これは、Splunk RUM インストルメンテーションライブラリを挿入するのに最適な場所です。すべてのページで自動的に読み込まれるためです。</p><p><code>api-gateway</code> サービスはすでにインストルメンテーションを実行しており、RUM トレースを Splunk Observability Cloud に送信しています。次のセクションでデータを確認します。</p><p>スニペットを確認したい場合は、ブラウザでページを右クリックして <strong>View Page Source</strong> を選択することで、ページソースを表示できます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;/env.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>realm</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_REALM</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Realm:&#39;</span><span class=p>,</span> <span class=nx>realm</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>auth</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_AUTH</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>appName</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_APP_NAME</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>environmentName</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_ENVIRONMENT</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>realm</span> <span class=o>&amp;&amp;</span> <span class=nx>auth</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>realm</span><span class=o>:</span> <span class=nx>realm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=nx>auth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>applicationName</span><span class=o>:</span> <span class=nx>appName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=nx>environmentName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>version</span><span class=o>:</span> <span class=s1>&#39;1.0.0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>SplunkSessionRecorder</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>applicationName</span><span class=o>:</span> <span class=nx>appName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>realm</span><span class=o>:</span> <span class=nx>realm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=nx>auth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>recorder</span><span class=o>:</span> <span class=s2>&#34;splunk&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nx>features</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>video</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>Provider</span> <span class=o>=</span> <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>provider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>tracer</span><span class=o>=</span><span class=nx>Provider</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=s1>&#39;appModuleLoader&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Realm or auth is empty, provide default values or skip initialization
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Realm or auth is empty. Skipping Splunk Rum initialization.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>     <span class=c>&lt;!-- Section added for  RUM --&gt;</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>8. Real User Monitoringのサブセクション</h1><article class=default><header class=headline></header><h1 id=select-the-rum-view-for-the-petclinic-app>Select the RUM view for the Petclinic App</h1><p>左側のメニューで <strong>RUM</strong> をクリックして、RUM の簡単な概要ツアーを始めましょう。次に、<strong>Environment</strong> フィルター <strong>(1)</strong> をドロップダウンボックスから変更し、ワークショップインスタンスの名前 <strong><code>&lt;INSTANCE>-workshop</code></strong> <strong>(1)</strong> を選択します (ここで <strong><code>INSTANCE</code></strong> は、以前に実行したシェルスクリプトの値です)。これのみが選択されていることを確認してください。</p><p>次に、<strong>App</strong> <strong>(2)</strong> ドロップダウンボックスをアプリの名前に変更します。これは <strong><code>&lt;INSTANCE>-store</code></strong> になります。</p><p><a href=#R-image-ca4a5955b62cde2693bc7a6f5f4d73b3 class=lightbox-link><img alt="rum select" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-env-select.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ca4a5955b62cde2693bc7a6f5f4d73b3><img alt="rum select" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-env-select.png></a></p><p><strong>Environment</strong> と <strong>App</strong> を選択すると、アプリケーションの RUM ステータスを示す概要ページが表示されます。(Summary Dashboard が単一行の数値だけの場合は、縮小表示になっています。アプリケーション名の前にある <strong>> (1)</strong> をクリックして展開できます)。JavaScript エラーが発生した場合は、以下のように表示されます:</p><p><a href=#R-image-b84c753ad4ccc808c4ced9cd7faf261d class=lightbox-link><img alt="rum overview" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b84c753ad4ccc808c4ced9cd7faf261d><img alt="rum overview" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-overview.png></a></p><p>続けるには、青いリンク (ワークショップ名) をクリックして詳細ページに移動します。これにより、UX Metrics、Front-end Health、Back-end Health、Custom Events によるインタラクションの内訳が表示され、過去のメトリクス (デフォルトでは 1 時間) と比較される新しいダッシュボードビューが表示されます。</p><p><a href=#R-image-8de20829bc4da134ba4b4220daf4264d class=lightbox-link><img alt="rum  main" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-main.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8de20829bc4da134ba4b4220daf4264d><img alt="rum  main" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-main.png></a>
通常、最初のチャートには 1 つの線のみがあります。Petclinic ショップに関連するリンクをクリックしてください。
この例では http://198.19.249.202:81 です:</p><p>これにより、Tag Spotlight ページに移動します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=rum-trace-waterfall-view--linking-to-apm>RUM trace Waterfall view & linking to APM</h1><p>TAG Spotlight ビューでは、RUM データに関連付けられたすべてのタグが表示されます。タグは、データを識別するために使用されるキーバリューペアです。この場合、タグは OpenTelemetry インストルメンテーションによって自動的に生成されます。タグは、データをフィルタリングし、チャートやテーブルを作成するために使用されます。Tag Spotlight ビューでは、動作の傾向を検出し、ユーザーセッションにドリルダウンできます。</p><p><a href=#R-image-d692a195e22f7fe83f95233d5ed7377d class=lightbox-link><img alt="RUM TAG" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-tag-spotlight.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d692a195e22f7fe83f95233d5ed7377d><img alt="RUM TAG" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-tag-spotlight.png></a></p><p>User Sessions <strong>(1)</strong> をクリックすると、タイムウィンドウ中に発生したユーザーセッションのリストが表示されます。</p><p>セッションの 1 つを見たいので、<em>Duration</em> <strong>(2)</strong> をクリックして期間でソートし、長いものの 1 つのリンク <strong>(3)</strong> をクリックしてください:</p><p><a href=#R-image-c553000c1238444344d29ed3fe0c6c9d class=lightbox-link><img alt="User sessions" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-user-sessions.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c553000c1238444344d29ed3fe0c6c9d><img alt="User sessions" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-user-sessions.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=rum-trace-waterfall-view--linking-to-apm>RUM trace Waterfall view & linking to APM</h1><p>RUM トレースウォーターフォールを見ています。これは、ユーザーが petclinic アプリケーションのページにアクセスしたときに、ユーザーデバイス上で何が起こったかを示します。</p><p>ウォーターフォールを下にスクロールして、右側の <strong>#!/owners/details</strong> セグメント <strong>(1)</strong> を見つけてクリックすると、Vets リクエストの処理中に発生したアクションのリストが表示されます。HTTP リクエストには、リターンコードの前に青い <strong>APM</strong> リンクがあることに注意してください。1 つを選択し、APM リンクをクリックします。これにより、Kubernetes でホストされているこのバックエンドサービスコールの APM 情報が表示されます。</p><p><a href=#R-image-c6172fa5db396c0c1fff2372b20e1b5e class=lightbox-link><img alt="rum apm link" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c6172fa5db396c0c1fff2372b20e1b5e><img alt="rum apm link" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-trace.png></a></p><p>リクエストで何が起こったかを確認するためにドリルダウンしたい場合は、Trace ID の URL をクリックしてください。</p><p>これにより、RUM からのリクエストに関連するトレースが表示されます:</p><p><a href=#R-image-96462ff88d2bdee6eef9766286c43ab4 class=lightbox-link><img alt="RUm-apm linked" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-apm-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-96462ff88d2bdee6eef9766286c43ab4><img alt="RUm-apm linked" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-apm-waterfall.png></a></p><p>サービスへのエントリーポイントに <strong>RUM (1)</strong> 関連コンテンツリンクが追加されており、バックエンドサービスで何が起こったかを確認した後、RUM セッションに戻ることができるようになっていることがわかります。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=workshop-wrap-up->Workshop Wrap-up 🎁</h1><p>おめでとうございます。<strong>Get the Most Out of Your Existing Kubernetes Java Applications Using Automatic Discovery and Configuration With OpenTelemetry</strong> ワークショップを完了しました。</p><p>今日、既存の Kubernetes 上の Java アプリケーションにトレース、コードプロファイリング、データベースクエリパフォーマンスを追加することがいかに簡単かを学びました。</p><p><strong>Automatic Discovery and Configuration</strong> を使用して、コードや設定に一切触れることなく、アプリケーションとインフラストラクチャの可観測性を即座に向上させました。</p><p>また、シンプルな設定変更により、さらに多くの可観測性 (<strong>logging</strong> や <strong>RUM</strong>) をアプリケーションに追加して、エンドツーエンドの可観測性を提供できることも学びました。</p><p><a href=#R-image-6d341088d15bae31fd7e35bb28903b8d class=lightbox-link><img alt=Champagne class="lazy lightbox figure-image" loading=lazy src="/observability-workshop/ja/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/9-wrap-up/images/champagne.png?width=45vw" style=height:auto;width:45vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6d341088d15bae31fd7e35bb28903b8d><img alt=Champagne class="lazy lightbox lightbox-image" loading=lazy src="/observability-workshop/ja/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/9-wrap-up/images/champagne.png?width=45vw"></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-ワークショップ>OpenTelemetry Collector ワークショップ</h1><ul class=card-container><li><article class="card card-popout" aria-labelledby=R-card-0cb2ed459a83eee154cda94c00ba3e7f><div class=card-content><div class=card-title id=R-card-0cb2ed459a83eee154cda94c00ba3e7f><a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/index.html>OpenTelemetry Collector の基本概念</a></div><div class=card-content-text>OpenTelemetry Collector の概念と、Splunk Observability Cloud へデータを送信する方法を学びます。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-be81941c806d36e24515fb2bfbbb00ca><div class=card-content><div class=card-title id=R-card-be81941c806d36e24515fb2bfbbb00ca><a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/index.html>Advanced OpenTelemetry Collector</a></div><div class=card-content-text>OpenTelemetry Collector の設定をゼロから行う練習を行い、いくつかの高度な設定シナリオを体験します。</div></div></article></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><section><h1 class=a11y-only>OpenTelemetry Collector ワークショップのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-でオブザーバビリティをクラウドネイティブに>OpenTelemetry でオブザーバビリティをクラウドネイティブに</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>1 hour</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><h2 id=概要>概要<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry を始めたばかりの組織では、まずオブザーバビリティバックエンドに直接データを送信することから始めることが多いでしょう。これは初期テストには有効ですが、OpenTelemetry Collector をオブザーバビリティアーキテクチャの一部として使用することで多くのメリットがあり、本番環境へのデプロイには推奨されています。</p><p>このワークショップでは、OpenTelemetry Collector の使用に焦点を当て、Splunk Observability Cloud で使用するための Receiver、Processor、Exporter の設定の基本から始めます。参加者は初心者から、分散プラットフォームのビジネスオブザーバビリティニーズを解決するためのカスタムコンポーネントを追加できるレベルまで到達します。</p><h3 id=ninja-セクション>Ninja セクション<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>ワークショップを通じて、展開可能な <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong> セクション</span></span> があります。これらはより実践的で、ワークショップ中または自分の時間に探求できる詳細な技術情報を提供します。</p><p>OpenTelemetry プロジェクトは頻繁に開発が行われているため、これらのセクションの内容が古くなる可能性があることに注意してください。詳細が同期していない場合はリンクが提供されます。更新が必要な箇所を見つけた場合はお知らせください。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> テストしてみよう！</span></span></summary><div class=box-content><p><strong>このワークショップを完了すると、正式に OpenTelemetry Collector Ninja になれます！</strong></p></div></details><hr><h2 id=対象者>対象者<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このインタラクティブなワークショップは、OpenTelemetry Collector のアーキテクチャとデプロイについて詳しく学びたい開発者およびシステム管理者を対象としています。</p><h2 id=前提条件>前提条件<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ul><li>データ収集の基本的な理解があること</li><li>コマンドラインと vim/vi の経験があること</li><li>Ubuntu 20.04 LTS または 22.04 LTS を実行しているインスタンス/ホスト/VM があること<ul><li>最小要件は AWS/EC2 t2.micro（1 CPU、1GB RAM、8GB ストレージ）です</li></ul></li></ul><h2 id=学習目標>学習目標<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このワークショップを終えると、参加者は以下ができるようになります</p><ul><li>OpenTelemetry のコンポーネントを理解する</li><li>Receiver、Processor、Exporter を使用してデータを収集・分析する</li><li>OpenTelemetry を使用するメリットを理解する</li><li>ビジネスニーズを解決するカスタムコンポーネントを構築する</li></ul><h2 id=opentelemetry-アーキテクチャ>OpenTelemetry アーキテクチャ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>OpenTelemetry Collector の基本概念のサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-contrib-のインストール>OpenTelemetry Collector Contrib のインストール</h1><h2 id=opentelemetry-collector-contrib-ディストリビューションのダウンロード>OpenTelemetry Collector Contrib ディストリビューションのダウンロード<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry Collector をインストールする最初のステップは、ダウンロードです。このラボでは、<code>wget</code> コマンドを使用して OpenTelemetry の GitHub リポジトリから <code>.deb</code> パッケージをダウンロードします。</p><p>お使いのプラットフォーム用の <code>.deb</code> パッケージを <a href=https://github.com/open-telemetry/opentelemetry-collector-releases/releases rel=external><strong>OpenTelemetry Collector Contrib リリースページ</strong></a> から取得します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.111.0/otelcol-contrib_0.111.0_linux_amd64.deb</span></span></code></pre></div><h2 id=opentelemetry-collector-contrib-ディストリビューションのインストール>OpenTelemetry Collector Contrib ディストリビューションのインストール<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><code>dpkg</code> を使用して <code>.deb</code> パッケージをインストールします。インストールが成功した場合の出力例は、下の <strong>dpkg Output</strong> タブを確認してください</p><div class=tab-panel data-tab-group=R-tabs-449c915b775f3524db6c289479c12eca><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-7c9cd73742f1da724cd1c441919c99cd aria-expanded=true data-tab-item=R-tab-14b7d76f2abce310837a677aad65c1ad class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-449c915b775f3524db6c289479c12eca","R-tab-14b7d76f2abce310837a677aad65c1ad")'>
<span class=tab-nav-text>インストール</span>
</button>
<button aria-controls=R-tab-id-7f5f68713d5a74032e3df04f12d9e5f1 aria-expanded=false data-tab-item=R-tab-d3493584dcb14c60dcd3149a9642bb6f class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-449c915b775f3524db6c289479c12eca","R-tab-d3493584dcb14c60dcd3149a9642bb6f")'>
<span class=tab-nav-text>dpkg 出力</span></button></div><div class=tab-content-container><div id=R-tab-id-7c9cd73742f1da724cd1c441919c99cd data-tab-item=R-tab-14b7d76f2abce310837a677aad65c1ad class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dpkg -i otelcol-contrib_0.111.0_linux_amd64.deb</span></span></code></pre></div></div></div><div id=R-tab-id-7f5f68713d5a74032e3df04f12d9e5f1 data-tab-item=R-tab-d3493584dcb14c60dcd3149a9642bb6f class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Selecting previously unselected package otelcol-contrib.
</span></span><span class=line><span class=cl>(Reading database ... 89232 files and directories currently installed.)
</span></span><span class=line><span class=cl>Preparing to unpack otelcol-contrib_0.111.0_linux_amd64.deb ...
</span></span><span class=line><span class=cl>Unpacking otelcol-contrib (0.111.0) ...
</span></span><span class=line><span class=cl>Setting up otelcol-contrib (0.111.0) ...
</span></span><span class=line><span class=cl>Created symlink /etc/systemd/system/multi-user.target.wants/otelcol-contrib.service → /lib/systemd/system/otelcol-contrib.service.</span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>1. インストールのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-contrib-のインストール>OpenTelemetry Collector Contrib のインストール</h1><h2 id=collector-が動作していることを確認する>Collector が動作していることを確認する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Collector が動作しているはずです。<code>systemctl</code> コマンドを使用して root として確認します。ステータス表示を終了するには <code>q</code> を押してください。</p><div class=tab-panel data-tab-group=R-tabs-5c046161197a731a6d6b544fcb2addad><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-ec665f68545dac9016e686168b2970f7 aria-expanded=true data-tab-item=R-tab-4c2ea9b6feee78084d69f1a6877eb09c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-5c046161197a731a6d6b544fcb2addad","R-tab-4c2ea9b6feee78084d69f1a6877eb09c")'>
<span class=tab-nav-text>コマンド</span>
</button>
<button aria-controls=R-tab-id-b1419bd933828fba13d6739bee74654b aria-expanded=false data-tab-item=R-tab-161e52648ec172424c85f660dc71e964 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-5c046161197a731a6d6b544fcb2addad","R-tab-161e52648ec172424c85f660dc71e964")'>
<span class=tab-nav-text>ステータス出力</span></button></div><div class=tab-content-container><div id=R-tab-id-ec665f68545dac9016e686168b2970f7 data-tab-item=R-tab-4c2ea9b6feee78084d69f1a6877eb09c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status otelcol-contrib</span></span></code></pre></div></div></div><div id=R-tab-id-b1419bd933828fba13d6739bee74654b data-tab-item=R-tab-161e52648ec172424c85f660dc71e964 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>● otelcol-contrib.service - OpenTelemetry Collector Contrib
</span></span><span class=line><span class=cl>     Loaded: loaded (/lib/systemd/system/otelcol-contrib.service; enabled; vendor preset: enabled)
</span></span><span class=line><span class=cl>     Active: active (running) since Mon 2024-10-07 10:27:49 BST; 52s ago
</span></span><span class=line><span class=cl>   Main PID: 17113 (otelcol-contrib)
</span></span><span class=line><span class=cl>      Tasks: 13 (limit: 19238)
</span></span><span class=line><span class=cl>     Memory: 34.8M
</span></span><span class=line><span class=cl>        CPU: 155ms
</span></span><span class=line><span class=cl>     CGroup: /system.slice/otelcol-contrib.service
</span></span><span class=line><span class=cl>             └─17113 /usr/bin/otelcol-contrib --config=/etc/otelcol-contrib/config.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]: Descriptor:
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]:      -&gt; Name: up
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]:      -&gt; Description: The scraping was successful
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]:      -&gt; Unit:
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]:      -&gt; DataType: Gauge
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]: NumberDataPoints #0
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]: StartTimestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]: Timestamp: 2024-10-07 09:28:36.942 +0000 UTC
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]: Value: 1.000000
</span></span><span class=line><span class=cl>Oct 07 10:28:36 petclinic-rum-testing otelcol-contrib[17113]:         {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;metrics&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div></div></div></div></div><p>このワークショップでは、設定ファイルの変更、環境変数の設定、Collector の再起動を複数回行うため、Collector サービスを停止し、起動時の自動起動を無効にする必要があります。</p><div class=tab-panel data-tab-group=R-tabs-dbbaef04f788db4c30c8d3d7cb459bb5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-a3fb4e77bc19ad07096f8b23a5dc1cf2 aria-expanded=true data-tab-item=R-tab-4c2ea9b6feee78084d69f1a6877eb09c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-dbbaef04f788db4c30c8d3d7cb459bb5","R-tab-4c2ea9b6feee78084d69f1a6877eb09c")'>
<span class=tab-nav-text>コマンド</span></button></div><div class=tab-content-container><div id=R-tab-id-a3fb4e77bc19ad07096f8b23a5dc1cf2 data-tab-item=R-tab-4c2ea9b6feee78084d69f1a6877eb09c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl stop otelcol-contrib <span class=o>&amp;&amp;</span> sudo systemctl disable otelcol-contrib</span></span></code></pre></div></div></div></div></div><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Open Telemetry Collector Builder (ocb) を使用して独自の Collector をビルドする</span></span></summary><div class=box-content><p>このパートでは、システムに以下がインストールされている必要があります</p><ul><li><p>Golang（最新バージョン）</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /tmp
</span></span><span class=line><span class=cl>wget https://golang.org/dl/go1.20.linux-amd64.tar.gz
</span></span><span class=line><span class=cl>sudo tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz</span></span></code></pre></div><p><code>.profile</code> を編集して、以下の環境変数を追加します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOROOT</span><span class=o>=</span>/usr/local/go
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOPATH</span><span class=o>=</span><span class=nv>$HOME</span>/go
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$GOPATH</span>/bin:<span class=nv>$GOROOT</span>/bin:<span class=nv>$PATH</span></span></span></code></pre></div><p>シェルセッションを更新します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>source</span> ~/.profile</span></span></code></pre></div><p>Go のバージョンを確認します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go version</span></span></code></pre></div></li><li><p>ocb のインストール</p><ul><li><p><a href=https://github.com/open-telemetry/opentelemetry-collector/releases/tag/cmd%2Fbuilder%2Fv0.80.0 rel=external>プロジェクトリリース</a>から ocb バイナリをダウンロードし、以下のコマンドを実行します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mv ocb_0.80.0_darwin_arm64 /usr/bin/ocb
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> /usr/bin/ocb</span></span></code></pre></div><p>別の方法として、golang ツールチェーンを使用してローカルでバイナリをビルドすることもできます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go install go.opentelemetry.io/collector/cmd/builder@v0.80.0
</span></span><span class=line><span class=cl>mv <span class=k>$(</span>go env GOPATH<span class=k>)</span>/bin/builder /usr/bin/ocb</span></span></code></pre></div></li></ul></li><li><p>（オプション）Docker</p></li></ul><h2 id=なぜ独自の-collector-をビルドするのか>なぜ独自の Collector をビルドするのか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Collector のデフォルトディストリビューション（core と contrib）は、提供する機能が多すぎるか少なすぎるかのどちらかです。</p><p>また、contrib Collector を本番環境で実行することは推奨されません。これは、インストールされるコンポーネントの量が多く、そのほとんどがデプロイメントに必要ないためです。</p><h2 id=独自の-collector-をビルドするメリットは>独自の Collector をビルドするメリットは？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>独自の Collector バイナリ（一般的にディストリビューションと呼ばれる）を作成することは、必要なものだけをビルドすることを意味します。</p><p>これには以下のメリットがあります</p><ol><li>より小さなサイズのバイナリ</li><li>脆弱性に対して既存の Go スキャナーを使用できる</li><li>組織と連携できる内部コンポーネントを含めることができる</li></ol><h2 id=collector-をビルドする際の考慮事項は>Collector をビルドする際の考慮事項は？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>さて、いくつかのデメリットがなければ 🥷 Ninja ゾーンとは言えません</p><ol><li>Go の経験が推奨される（必須ではないが）</li><li>Splunk サポート<strong>なし</strong></li><li>ディストリビューションとライフサイクル管理の責任</li></ol><p>プロジェクトは安定性に向けて取り組んでいますが、変更によってワークフローが壊れないとは限らないことに注意することが重要です。Splunk のチームは、より高いサポートと安定性を提供しており、デプロイメントのニーズに応じたキュレーションされた体験を提供できます。</p><h2 id=ninja-ゾーン>Ninja ゾーン<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>必要なツールがすべてインストールされたら、<code>otelcol-builder.yaml</code> という名前の新しいファイルを作成し、以下のディレクトリ構造に従います</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>└── otelcol-builder.yaml</span></span></code></pre></div><p>ファイルを作成したら、いくつかの追加メタデータとともにインストールするコンポーネントのリストを追加する必要があります。</p><p>この例では、入門用の設定に必要なコンポーネントのみをインストールするビルダーマニフェストを作成します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>otelcol-ninja</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>A custom build of the Open Telemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>output_path</span><span class=p>:</span><span class=w> </span><span class=l>./dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/extension/ballastextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/extension/zpagesextension  v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/httpforwarder v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/loggingexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/splunkhecexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/signalfxexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/batchprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/memorylimiterprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/receiver/otlpreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/zipkinreceiver v0.80.0</span></span></span></code></pre></div><p>yaml ファイルが <em>ocb</em> 用に更新されたら、以下のコマンドを実行します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocb --config<span class=o>=</span>otelcol-builder.yaml</span></span></code></pre></div><p>これにより、以下のディレクトリ構造が作成されます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>├── dist
</span></span><span class=line><span class=cl>│   ├── components.go
</span></span><span class=line><span class=cl>│   ├── components_test.go
</span></span><span class=line><span class=cl>│   ├── go.mod
</span></span><span class=line><span class=cl>│   ├── go.sum
</span></span><span class=line><span class=cl>│   ├── main.go
</span></span><span class=line><span class=cl>│   ├── main_others.go
</span></span><span class=line><span class=cl>│   ├── main_windows.go
</span></span><span class=line><span class=cl>│   └── otelcol-ninja
</span></span><span class=line><span class=cl>└── otelcol-builder.yaml</span></span></code></pre></div><h3 id=参考資料>参考資料<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><ol><li><a href=https://opentelemetry.io/docs/collector/custom-collector/ rel=external>https://opentelemetry.io/docs/collector/custom-collector/</a></li></ol></div></details><hr><h2 id=デフォルト設定>デフォルト設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry は YAML ファイルを通じて設定されます。これらのファイルには、ニーズに合わせて変更できるデフォルト設定があります。提供されるデフォルト設定を見てみましょう</p><div class=tab-panel data-tab-group=R-tabs-849bb3391da19e7599f329971437328f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-f5aa84f4f06798a0604cec832e95702e aria-expanded=true data-tab-item=R-tab-4c2ea9b6feee78084d69f1a6877eb09c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-849bb3391da19e7599f329971437328f","R-tab-4c2ea9b6feee78084d69f1a6877eb09c")'>
<span class=tab-nav-text>コマンド</span>
</button>
<button aria-controls=R-tab-id-a8f8855c7ea52d20a09e0a33449a2e5b aria-expanded=false data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-849bb3391da19e7599f329971437328f","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-f5aa84f4f06798a0604cec832e95702e data-tab-item=R-tab-4c2ea9b6feee78084d69f1a6877eb09c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-a8f8855c7ea52d20a09e0a33449a2e5b data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># To limit exposure to denial of service attacks, change the host in endpoints below from 0.0.0.0 to a specific network interface.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># See https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/security-best-practices.md#safeguards-against-denial-of-service-attacks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4317</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4318</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55678</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6832</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6831</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14268</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>9411</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div><p>おめでとうございます！OpenTelemetry Collector のダウンロードとインストールに成功しました。OTel Ninja への道を順調に歩んでいます。しかしまず、設定ファイルと OpenTelemetry Collector の異なるディストリビューションについて説明していきましょう。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>Splunk は独自の、完全にサポートされた OpenTelemetry Collector ディストリビューションを提供しています。このディストリビューションは、<a href=https://github.com/signalfx/splunk-otel-collector rel=external><strong>Splunk GitHub リポジトリ</strong></a>からインストールするか、Splunk Observability Cloud のウィザードを使用してコピー＆ペーストするだけの簡単なインストールスクリプトを作成できます。このディストリビューションには、OpenTelemetry Collector Contrib ディストリビューションでは利用できない多くの追加機能と拡張が含まれています。</p><ul><li>Splunk Distribution of the OpenTelemetry Collector は本番環境でテスト済みです。大多数のお客様が本番環境で使用しています。</li><li>このディストリビューションを使用するお客様は、SLA 内で Splunk の公式サポートから直接サポートを受けることができます。</li><li>お客様は、メトリクスとトレース収集のコア設定体験に対する将来の破壊的変更を心配することなく、Splunk Distribution of the OpenTelemetry Collector を使用または移行できます（OpenTelemetry ログ収集の設定はベータ版です）。Collector のメトリクスには破壊的変更がある可能性があります。</li></ul></div></details><p>これから設定ファイルの各セクションを説明し、ホストメトリクスを Splunk Observability Cloud に送信するように変更していきます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><p>OpenTelemetry Collector がインストールできたので、OpenTelemetry Collector の拡張機能について見ていきましょう。拡張機能はオプションであり、主にテレメトリデータの処理を伴わないタスクに使用されます。拡張機能の例としては、ヘルスモニタリング、サービスディスカバリ、データ転送などがあります。</p><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;: &#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style E fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><section><h1 class=a11y-only>2. Extensionsのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=health-check>Health Check<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>拡張機能は、インストール手順で参照した同じ <code>config.yaml</code> ファイルで設定します。<code>config.yaml</code> ファイルを編集して拡張機能を設定しましょう。<strong>pprof</strong> と <strong>zpages</strong> 拡張機能はデフォルトの <code>config.yaml</code> ファイルに既に設定されていることに注意してください。このワークショップでは、Collector のヘルス状態にアクセスできるよう、すべてのネットワークインターフェースでポートを公開するように <strong>health_check</strong> 拡張機能のみを更新します。</p><div class=tab-panel data-tab-group=R-tabs-92575192ccc36a5381363445715dd1ed><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-86e8e153bd9f4d4a71dff1ea13571ed2 aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-92575192ccc36a5381363445715dd1ed","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div id=R-tab-id-86e8e153bd9f4d4a71dff1ea13571ed2 data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=R-tabs-eebdae11b2e2a9985d5a8f1e47974668><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b40e432ec8f673d78e1c98d3d2304b45 aria-expanded=true data-tab-item=R-tab-152f0ce564aa5e1309a89e848db53185 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-eebdae11b2e2a9985d5a8f1e47974668","R-tab-152f0ce564aa5e1309a89e848db53185")'>
<span class=tab-nav-text>Extensions Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-b40e432ec8f673d78e1c98d3d2304b45 data-tab-item=R-tab-152f0ce564aa5e1309a89e848db53185 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span></span></span></code></pre></div></div></div></div></div><p>Collector を起動します</p><div class=tab-panel data-tab-group=R-tabs-02a078d709a602c4d9f9fbbb822c4dd8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c1b003bd4197a3febbe3df7ff1e46a1b aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-02a078d709a602c4d9f9fbbb822c4dd8","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div id=R-tab-id-c1b003bd4197a3febbe3df7ff1e46a1b data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><p>この拡張機能により、OpenTelemetry Collector のステータスを確認するためにプローブできる HTTP URL が有効になります。この拡張機能は、Kubernetes で liveness プローブや readiness プローブとして使用できます。<code>curl</code> コマンドについて詳しく知るには、<a href=https://curl.se/docs/manpage.html rel=external>curl man page</a> を確認してください。</p><p>新しいターミナルセッションを開き、インスタンスに SSH 接続して以下のコマンドを実行します</p><div class=tab-panel data-tab-group=R-tabs-f7a720c6877d79a30621ee3f218ac0a4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-19b1a8af747e5129723ae1c5467fcf0e aria-expanded=true data-tab-item=R-tab-e2d1c201ce0c8c47d452167742abc308 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-f7a720c6877d79a30621ee3f218ac0a4","R-tab-e2d1c201ce0c8c47d452167742abc308")'>
<span class=tab-nav-text>curl Command</span>
</button>
<button aria-controls=R-tab-id-060231410f84e7428b85c28c891d99de aria-expanded=false data-tab-item=R-tab-6e431ae9119cd9664129d3c3aafa7ce3 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-f7a720c6877d79a30621ee3f218ac0a4","R-tab-6e431ae9119cd9664129d3c3aafa7ce3")'>
<span class=tab-nav-text>curl Output</span></button></div><div class=tab-content-container><div id=R-tab-id-19b1a8af747e5129723ae1c5467fcf0e data-tab-item=R-tab-e2d1c201ce0c8c47d452167742abc308 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:13133</span></span></code></pre></div></div></div><div id=R-tab-id-060231410f84e7428b85c28c891d99de data-tab-item=R-tab-6e431ae9119cd9664129d3c3aafa7ce3 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;status&#34;:&#34;Server available&#34;,&#34;upSince&#34;:&#34;2024-10-07T11:00:08.004685295+01:00&#34;,&#34;uptime&#34;:&#34;12.56420005s&#34;}</span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=performance-profiler>Performance Profiler<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/pprofextension/README.md rel=external><strong>Performance Profiler</strong></a> 拡張機能は、golang の net/http/pprof エンドポイントを有効にします。これは通常、開発者がパフォーマンスプロファイルを収集し、サービスの問題を調査するために使用されます。<strong>このワークショップではこれを扱いません</strong>。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-extensions>OpenTelemetry Collector Extensions</h1><h2 id=zpages>zPages<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/extension/zpagesextension/README.md rel=external><strong>zPages</strong></a> は、外部エクスポーターの代わりにインプロセスで使用できる機能です。組み込まれると、バックグラウンドでトレースとメトリクス情報を収集・集約し、リクエストされたときにウェブページでこのデータを提供します。zPages は、Collector が期待どおりに動作していることを確認するための非常に便利な診断機能です。</p><div class=tab-panel data-tab-group=R-tabs-b6492a49fc18df09235627ae2a1abf24><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d6e7a102cdcfb46521bb404d4ef5e035 aria-expanded=true data-tab-item=R-tab-552e9e5a9146ffc544b495bfe6a66c36 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b6492a49fc18df09235627ae2a1abf24","R-tab-552e9e5a9146ffc544b495bfe6a66c36")'>
<span class=tab-nav-text>ServiceZ</span>
</button>
<button aria-controls=R-tab-id-f2adfda939fa35842571dbb7527980e4 aria-expanded=false data-tab-item=R-tab-41646adfc5c13ab129b70c2240c1db3d class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-b6492a49fc18df09235627ae2a1abf24","R-tab-41646adfc5c13ab129b70c2240c1db3d")'>
<span class=tab-nav-text>PipelineZ</span>
</button>
<button aria-controls=R-tab-id-b7afb47814cad27f84b125a6dc1ee8c1 aria-expanded=false data-tab-item=R-tab-3fbf781f7e065ca41160f534cc231df0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-b6492a49fc18df09235627ae2a1abf24","R-tab-3fbf781f7e065ca41160f534cc231df0")'>
<span class=tab-nav-text>ExtensionZ</span></button></div><div class=tab-content-container><div id=R-tab-id-d6e7a102cdcfb46521bb404d4ef5e035 data-tab-item=R-tab-552e9e5a9146ffc544b495bfe6a66c36 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>ServiceZ</strong> は、Collector サービスの概要と、pipelinez、extensionz、featurez の各 zPages へのクイックアクセスを提供します。このページには、ビルド情報とランタイム情報も表示されます。</p><p>サンプル URL: <a href=http://localhost:55679/debug/servicez rel=external><strong>http://localhost:55679/debug/servicez</strong></a>（<code>localhost</code> をご自身の環境に合わせて変更してください）。</p><p><a href=#R-image-cec8b4ba79e1fe4b011fa8270ec51d4d class=lightbox-link><img alt=ServiceZ class="lazy lightbox figure-image" loading=lazy src=../../images/servicez.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cec8b4ba79e1fe4b011fa8270ec51d4d><img alt=ServiceZ class="lazy lightbox lightbox-image" loading=lazy src=../../images/servicez.png></a></p></div></div><div id=R-tab-id-f2adfda939fa35842571dbb7527980e4 data-tab-item=R-tab-41646adfc5c13ab129b70c2240c1db3d class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>PipelineZ</strong> は、Collector で実行されているパイプラインに関する洞察を提供します。タイプ、データが変更されるかどうかの情報を確認でき、各パイプラインで使用されているレシーバー、プロセッサー、エクスポーターの情報も確認できます。</p><p>サンプル URL: <a href=http://localhost:55679/debug/pipelinez rel=external><strong>http://localhost:55679/debug/pipelinez</strong></a>（<code>localhost</code> をご自身の環境に合わせて変更してください）。</p><p><a href=#R-image-55135749c356b92287dfc9933c3485b1 class=lightbox-link><img alt=PipelineZ class="lazy lightbox figure-image" loading=lazy src=../../images/pipelinez.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-55135749c356b92287dfc9933c3485b1><img alt=PipelineZ class="lazy lightbox lightbox-image" loading=lazy src=../../images/pipelinez.png></a></p></div></div><div id=R-tab-id-b7afb47814cad27f84b125a6dc1ee8c1 data-tab-item=R-tab-3fbf781f7e065ca41160f534cc231df0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>ExtensionZ</strong> は、Collector でアクティブな拡張機能を表示します。</p><p>サンプル URL: <a href=http://localhost:55679/debug/extensionz rel=external><strong>http://localhost:55679/debug/extensionz</strong></a>（<code>localhost</code> をご自身の環境に合わせて変更してください）。</p><p><a href=#R-image-bcd4fa8c73088ce06bc25f849003c8a1 class=lightbox-link><img alt=ExtensionZ class="lazy lightbox figure-image" loading=lazy src=../../images/extensionz.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bcd4fa8c73088ce06bc25f849003c8a1><img alt=ExtensionZ class="lazy lightbox lightbox-image" loading=lazy src=../../images/extensionz.png></a></p></div></div></div></div><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> storage 拡張機能でデータの耐久性を向上させる</span></span></summary><div class=box-content><p>このためには、使用しているディストリビューションに <code>file_storage</code> 拡張機能がインストールされていることを確認する必要があります。これは、<code>otelcol-contrib components</code> コマンドを実行することで確認でき、以下のような結果が表示されるはずです</p><div class=tab-panel data-tab-group=R-tabs-9b0a2fb2368544385cc25ec961c07f48><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-1b3e53d2976fc3086e67af5e2bbaa76e aria-expanded=true data-tab-item=R-tab-293717097f4a71a9db50f219169437b8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9b0a2fb2368544385cc25ec961c07f48","R-tab-293717097f4a71a9db50f219169437b8")'>
<span class=tab-nav-text>Truncated Output</span>
</button>
<button aria-controls=R-tab-id-bdfc869378c0540b4f0d540f85e8d3aa aria-expanded=false data-tab-item=R-tab-6d20673ef09b9c1f8566526724ee50d7 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9b0a2fb2368544385cc25ec961c07f48","R-tab-6d20673ef09b9c1f8566526724ee50d7")'>
<span class=tab-nav-text>Full Output</span></button></div><div class=tab-content-container><div id=R-tab-id-1b3e53d2976fc3086e67af5e2bbaa76e data-tab-item=R-tab-293717097f4a71a9db50f219169437b8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># ... truncated for clarity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>file_storage</span></span></span></code></pre></div></div></div><div id=R-tab-id-bdfc869378c0540b4f0d540f85e8d3aa data-tab-item=R-tab-6d20673ef09b9c1f8566526724ee50d7 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>buildinfo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>otelcol-contrib</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>OpenTelemetry Collector Contrib</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus_simple</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>influxdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>purefa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>purefb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>receiver_creator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mongodbatlas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>vcenter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>expvar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jmx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>skywalking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>udplog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>carbon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafkametrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memcached</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>windowseventlog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsecscontainermetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>iis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nsxt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>aerospike</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>httpcheck</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8sobjects</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mongodb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>hostmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>statsd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsxray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cloudfoundry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>collectd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>couchdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kubeletstats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>journald</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>riak</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>splunk_hec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>active_directory_ds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscloudwatch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sqlquery</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>windowsperfcounters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>flinkmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudpubsub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>podman_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>wavefront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sqlserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>solace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tcplog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscontainerinsightreceiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsfirehose</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bigip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filelog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudspanner</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cloudflare</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pulsar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zipkin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>opencensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azureeventhub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>fluentforward</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlpjsonfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>syslog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cumulativetodelta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>groupbyattrs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>groupbytrace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8sattributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>experimental_metricsgeneration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>metricstransform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>deltatorate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>spanmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>span</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>redaction</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>servicegraph</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>transform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>probabilistic_sampler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tail_sampling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>carbon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>f5cloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mezmo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>skywalking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsxray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>dynatrace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>loki</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azuredataexplorer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azuremonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>instana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>loadbalancing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sentry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>splunk_hec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tanzuobservability</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zipkin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>alibabacloud_logservice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>clickhouse</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheusremotewrite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscloudwatchlogs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudpubsub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger_thrift</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logzio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sumologic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlemanagedprometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>opencensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awskinesis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>coralogix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>influxdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logicmonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tencentcloud_logservice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsemf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pulsar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zpages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bearertokenauth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>oidc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>host_observer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sigv4auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file_storage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_ballast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>oauth2client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsproxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>http_forwarder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaegerremotesampling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_observer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pprof</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>asapclient</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>basicauth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>headers_setter</span></span></span></code></pre></div></div></div></div></div><p>この拡張機能は、エクスポーターが設定されたエンドポイントにデータを送信できない場合に、エクスポーターがデータをディスクにキューイングする機能を提供します。</p><p>拡張機能を設定するには、以下の情報を含めるように設定を更新する必要があります。まず、/tmp/otel-data ディレクトリを作成し、読み書き権限を付与してください</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/otel-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/otel-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_rebound</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rebound_needed_threshold_mib</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rebound_trigger_threshold_mib</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ... truncated for clarity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages, file_storage]</span></span></span></code></pre></div><h2 id=なぜデータをディスクにキューイングするのか>なぜデータをディスクにキューイングするのか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>これにより、Collector はネットワークの中断（さらには Collector の再起動）を乗り越えて、データがアップストリームプロバイダーに送信されることを保証できます。</p><h2 id=データをディスクにキューイングする際の考慮事項>データをディスクにキューイングする際の考慮事項<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ディスクのパフォーマンスにより、データスループットのパフォーマンスに影響を与える可能性があります。</p><h3 id=参考資料>参考資料<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><ol><li><a href=https://community.splunk.com/t5/Community-Blog/Data-Persistence-in-the-OpenTelemetry-Collector/ba-p/624583 rel=external>https://community.splunk.com/t5/Community-Blog/Data-Persistence-in-the-OpenTelemetry-Collector/ba-p/624583</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/storage/filestorage rel=external>https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/storage/filestorage</a></li></ol></div></details><hr><h2 id=設定の確認>設定の確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>拡張機能について学んだので、設定の変更を確認しましょう。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>設定を確認する</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-238c87de03e45204467ba67db3bebe5b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4373db2f08bf3ce65a0e9e37c39160c8 aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-238c87de03e45204467ba67db3bebe5b","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-4373db2f08bf3ce65a0e9e37c39160c8 data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=hl><span class=lnt> 5
</span></span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># See https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/security-best-practices.md#safeguards-against-denial-of-service-attacks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4317</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4318</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55678</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6832</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6831</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14268</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>9411</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><p>拡張機能について確認したので、次はワークショップのデータパイプライン部分に進みましょう。パイプラインは、Collector 内でデータが辿る経路を定義し、受信から始まり、さらなる処理や変更を経て、最終的にエクスポーターを通じて Collector を出ていきます。</p><p>OpenTelemetry Collector のデータパイプラインは、<strong>レシーバー</strong>、<strong>プロセッサー</strong>、<strong>エクスポーター</strong>で構成されています。まずはレシーバーから始めます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><p>ワークショップの Receiver セクションへようこそ！ここは OpenTelemetry Collector のデータパイプラインの出発点です。早速始めましょう。</p><p>Receiver は、プッシュベースまたはプルベースであり、データを Collector に取り込む方法です。Receiver は1つ以上のデータソースをサポートできます。一般的に、Receiver は指定された形式でデータを受け取り、内部形式に変換してから、該当するパイプラインで定義された Processor と Exporter に渡します。</p><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style M fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><section><h1 class=a11y-only>3. Receiversのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=host-metrics-receiver>Host Metrics Receiver<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/hostmetricsreceiver/README.md rel=external><strong>Host Metrics Receiver</strong></a> は、さまざまなソースからスクレイピングしたホストシステムに関するメトリクスを生成します。これは、Collector がエージェントとしてデプロイされる場合に使用することを想定しており、このワークショップでもその方法を採用します。</p><p><code>/etc/otel-contrib/config.yaml</code> ファイルを更新して、<strong>hostmetrics</strong> Receiver を設定しましょう。以下の YAML を <strong>receivers</strong> セクションの下に挿入してください。インデントはスペース2つで行います。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otelcol-contrib/config.yaml</span></span></code></pre></div><div class=tab-panel data-tab-group=R-tabs-4863a1af491d41ad997ef5d51d25a92b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4910170b292fd8832ee2fd21bf832f39 aria-expanded=true data-tab-item=R-tab-d4d9df34006b2c5d7545d2f1f4e741e2 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4863a1af491d41ad997ef5d51d25a92b","R-tab-d4d9df34006b2c5d7545d2f1f4e741e2")'>
<span class=tab-nav-text>Host Metrics Receiver Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-4910170b292fd8832ee2fd21bf832f39 data-tab-item=R-tab-d4d9df34006b2c5d7545d2f1f4e741e2 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># process:</span></span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=prometheus-receiver>Prometheus Receiver<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><strong>prometheus</strong> という別の Receiver があることにも気づくでしょう。<a href=https://prometheus.io/docs/introduction/overview/ rel=external><strong>Prometheus</strong></a> は、OpenTelemetry Collector が使用するオープンソースのツールキットです。この Receiver は、OpenTelemetry Collector 自体からメトリクスをスクレイピングするために使用されます。これらのメトリクスは、Collector の健全性を監視するために使用できます。</p><p><code>prometheus</code> Receiver を変更して、Collector 自体からメトリクスを収集するためのものであることを明確にしましょう。Receiver の名前を <code>prometheus</code> から <code>prometheus/internal</code> に変更することで、その Receiver が何をしているかがより明確になります。設定ファイルを以下のように更新してください</p><div class=tab-panel data-tab-group=R-tabs-d9bff09371d257d156a18dfbbb3166db><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d9002609618ac5763db3801f283043a5 aria-expanded=true data-tab-item=R-tab-9f44d03ea283a5e0ba757b4cfcb8e9c2 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-d9bff09371d257d156a18dfbbb3166db","R-tab-9f44d03ea283a5e0ba757b4cfcb8e9c2")'>
<span class=tab-nav-text>Prometheus Receiver Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-d9002609618ac5763db3801f283043a5 data-tab-item=R-tab-9f44d03ea283a5e0ba757b4cfcb8e9c2 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class="line hl"><span class=cl><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span></span></span></code></pre></div></div></div></div></div><h2 id=ダッシュボード例---prometheus-メトリクス>ダッシュボード例 - Prometheus メトリクス<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>以下のスクリーンショットは、Prometheus internal Receiver が OpenTelemetry Collector から収集するメトリクスの一部を表示するダッシュボード例です。ここでは、受け入れられたスパン、メトリクス、ログレコードと送信されたものを確認できます。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>以下のスクリーンショットは、Splunk Observability Cloud の標準（OOTB）ダッシュボードで、Splunk OpenTelemetry Collector のインストール状況を簡単に監視できます。</p></div></details><p><a href=#R-image-fd93a938470eab92980d131cb2ef0924 class=lightbox-link><img alt=otel-charts class="lazy lightbox figure-image" loading=lazy src=../../images/otel-charts.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fd93a938470eab92980d131cb2ef0924><img alt=otel-charts class="lazy lightbox lightbox-image" loading=lazy src=../../images/otel-charts.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-receivers>OpenTelemetry Collector Receivers</h1><h2 id=その他の-receiver>その他の Receiver<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>デフォルト設定には、<strong>otlp</strong>、<strong>opencensus</strong>、<strong>jaeger</strong>、<strong>zipkin</strong> などの他の Receiver があることに気づくでしょう。これらは他のソースからテレメトリデータを受信するために使用されます。このワークショップではこれらの Receiver については取り上げませんので、そのままにしておいてください。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Receiver を動的に作成する</span></span></summary><div class=box-content><p>Docker コンテナ、Kubernetes Pod、SSH セッションなどの短期間のタスクを監視するために、<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator rel=external>receiver creator</a> と <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/observer rel=external>observer extensions</a> を使用して、これらのサービスが起動するときに新しい Receiver を作成できます。</p><h2 id=何が必要ですか>何が必要ですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>receiver creator とそれに関連する observer extension を使い始めるには、それらが Collector のビルドマニフェストに含まれている必要があります。</p><p>詳細は <a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/1-installation/index.html>installation</a> を参照してください。</p><h2 id=考慮すべき事項>考慮すべき事項<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>一部の短期間のタスクでは、<em>username</em> や <em>password</em> などの追加設定が必要な場合があります。
これらの値は <a href=https://opentelemetry.io/docs/collector/configuration/#configuration-environment-variables rel=external>環境変数</a> で参照するか、
<code>${file:./path/to/database/password}</code> のようなスキーム展開構文を使用できます。
この方法を採用する場合は、組織のシークレット管理のベストプラクティスに従ってください。</p><h2 id=ninja-ゾーン>Ninja ゾーン<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>この Ninja ゾーンに必要なことは2つだけです</p><ol><li>ビルダーマニフェストに receiver creator と observer extension が追加されていることを確認します。</li><li>検出されたエンドポイントとマッチングするために使用できる設定を作成します。</li></ol><p>テンプレート化された設定を作成するには、以下のようにします</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>watch_observers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>host_observer]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;port&#34; &amp;&amp; port == 6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>${env:HOST_REDIS_PASSWORD}</span></span></span></code></pre></div><p>その他の例については、<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator#examples rel=external>receiver creator の例</a> を参照してください。</p></div></details><hr><h2 id=設定の確認>設定の確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Receiver について説明しましたので、設定の変更を確認しましょう。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>設定を確認する</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-67c7e87c79dde7b4f68283204e5b5157><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d0fa5096ce2609d2db235281b279b633 aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-67c7e87c79dde7b4f68283204e5b5157","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-d0fa5096ce2609d2db235281b279b633 data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=hl><span class=lnt>13
</span></span><span class=hl><span class=lnt>14
</span></span><span class=hl><span class=lnt>15
</span></span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=hl><span class=lnt>19
</span></span><span class=hl><span class=lnt>20
</span></span><span class=hl><span class=lnt>21
</span></span><span class=hl><span class=lnt>22
</span></span><span class=hl><span class=lnt>23
</span></span><span class=hl><span class=lnt>24
</span></span><span class=hl><span class=lnt>25
</span></span><span class=hl><span class=lnt>26
</span></span><span class=hl><span class=lnt>27
</span></span><span class=hl><span class=lnt>28
</span></span><span class=hl><span class=lnt>29
</span></span><span class=hl><span class=lnt>30
</span></span><span class=hl><span class=lnt>31
</span></span><span class=hl><span class=lnt>32
</span></span><span class=hl><span class=lnt>33
</span></span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=hl><span class=lnt>45
</span></span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># To limit exposure to denial of service attacks, change the host in endpoints below from 0.0.0.0 to a specific network interface.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># See https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/security-best-practices.md#safeguards-against-denial-of-service-attacks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4317</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4318</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55678</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6832</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6831</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14268</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>9411</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><p>Receiver を通じてデータが OpenTelemetry Collector にどのように取り込まれるかを確認しました。次は、Collector が受信したデータをどのように処理するかを見ていきましょう。</p><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
警告</summary><div class=box-content><p><code>/etc/otelcol-contrib/config.yaml</code> はまだ完成していないため、この時点では Collector を再起動<strong>しないでください</strong>。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><p><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/README.md rel=external><strong>Processors</strong></a> は、データを受信してからエクスポートするまでの間に実行されます。Processors はオプションですが、一部は推奨されています。OpenTelemetry contrib Collector には <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor rel=external><strong>多数の Processors</strong></a> が含まれています。</p><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style Processors fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><section><h1 class=a11y-only>4. Processorsのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=batch-processor>Batch Processor<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>デフォルトでは、<strong>batch</strong> processor のみが有効になっています。この processor は、データをエクスポートする前にバッチ処理するために使用されます。これは、exporter へのネットワーク呼び出しの回数を減らすのに役立ちます。このワークショップでは、Collector にハードコードされている以下のデフォルト値を継承します</p><ul><li><code>send_batch_size</code>（デフォルト = 8192）：タイムアウトに関係なくバッチが送信されるスパン、メトリクスデータポイント、またはログレコードの数。send_batch_size はトリガーとして機能し、バッチのサイズには影響しません。パイプラインの次のコンポーネントに送信されるバッチサイズの制限を強制する必要がある場合は、send_batch_max_size を参照してください。</li><li><code>timeout</code>（デフォルト = 200ms）：サイズに関係なくバッチが送信されるまでの時間。ゼロに設定すると、send_batch_max_size のみに従ってデータが即座に送信されるため、send_batch_size は無視されます。</li><li><code>send_batch_max_size</code>（デフォルト = 0）：バッチサイズの上限。0 はバッチサイズに上限がないことを意味します。このプロパティは、大きなバッチを小さな単位に分割することを保証します。send_batch_size 以上である必要があります。</li></ul><p>Batch processor の詳細については、<a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/batchprocessor/README.md rel=external><strong>Batch Processor のドキュメント</strong></a>を参照してください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=resource-detection-processor>Resource Detection Processor<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><strong>resourcedetection</strong> processor は、ホストからリソース情報を検出し、テレメトリデータのリソース値にこの情報を追加または上書きするために使用できます。</p><p>デフォルトでは、ホスト名は可能であれば FQDN に設定され、それ以外の場合は OS が提供するホスト名がフォールバックとして使用されます。このロジックは <code>hostname_sources</code> 設定オプションを使用して変更できます。FQDN を取得せずに OS が提供するホスト名を使用するには、<code>hostname_sources</code> を <code>os</code> に設定します。</p><div class=tab-panel data-tab-group=R-tabs-1249bd95af9e91b0f0e90acf1479747a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-6def0379584d1920f46544327b321e82 aria-expanded=true data-tab-item=R-tab-b892811c417d9a038325e7378a05c132 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1249bd95af9e91b0f0e90acf1479747a","R-tab-b892811c417d9a038325e7378a05c132")'>
<span class=tab-nav-text>System Resource Detection Processor Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-6def0379584d1920f46544327b321e82 data-tab-item=R-tab-b892811c417d9a038325e7378a05c132 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span></span></span></code></pre></div></div></div></div></div><p>ワークショップインスタンスが AWS/EC2 インスタンスで実行されている場合、EC2 メタデータ API から以下のタグを収集できます（これは他のプラットフォームでは利用できません）。</p><ul><li><code>cloud.provider ("aws")</code></li><li><code>cloud.platform ("aws_ec2")</code></li><li><code>cloud.account.id</code></li><li><code>cloud.region</code></li><li><code>cloud.availability_zone</code></li><li><code>host.id</code></li><li><code>host.image.id</code></li><li><code>host.name</code></li><li><code>host.type</code></li></ul><p>これらのタグをメトリクスに追加するために、別の processor を作成します。</p><div class=tab-panel data-tab-group=R-tabs-9fd9daea72964972072d6eb7149495df><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-073aca87d40d17e762db54ab273061bc aria-expanded=true data-tab-item=R-tab-cfb68818ad6985dd73e8c42294095dee class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9fd9daea72964972072d6eb7149495df","R-tab-cfb68818ad6985dd73e8c42294095dee")'>
<span class=tab-nav-text>EC2 Resource Detection Processor Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-073aca87d40d17e762db54ab273061bc data-tab-item=R-tab-cfb68818ad6985dd73e8c42294095dee class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span></span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-processors>OpenTelemetry Collector Processors</h1><h2 id=attributes-processor>Attributes Processor<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>attributes processor は、スパン、ログ、またはメトリクスの属性を変更します。この processor は、指定されたアクションに含めるか除外するかを決定するために、入力データをフィルタリングおよびマッチングする機能もサポートしています。</p><p>設定で指定された順序で実行されるアクションのリストを受け取ります。サポートされているアクションは以下の通りです</p><ul><li><code>insert</code>：キーがまだ存在しない入力データに新しい属性を挿入します。</li><li><code>update</code>：キーが存在する入力データの属性を更新します。</li><li><code>upsert</code>：insert または update を実行します。キーがまだ存在しない入力データに新しい属性を挿入し、キーが存在する入力データの属性を更新します。</li><li><code>delete</code>：入力データから属性を削除します。</li><li><code>hash</code>：既存の属性値をハッシュ化（SHA1）します。</li><li><code>extract</code>：正規表現ルールを使用して入力キーからルールで指定されたターゲットキーに値を抽出します。ターゲットキーがすでに存在する場合は上書きされます。</li></ul><p>すべてのホストメトリクスに <code>participant.name</code> という新しい属性を <code>insert</code> する attributes processor を作成します。値にはあなたの名前（例：<code>marge_simpson</code>）を設定します。</p><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
警告</summary><div class=box-content><p><code>INSERT_YOUR_NAME_HERE</code> を必ずあなたの名前に置き換えてください。また、名前にスペースを<strong>使用しない</strong>ようにしてください。</p></div></details><p>ワークショップの後半で、Splunk Observability Cloud でメトリクスをフィルタリングするためにこの属性を使用します。</p><div class=tab-panel data-tab-group=R-tabs-635480f32aeea06e227da30950713224><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-763cdf0acb64ae5a587e14552a2773e0 aria-expanded=true data-tab-item=R-tab-99b4d39895514cfa032ce15a26ea7099 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-635480f32aeea06e227da30950713224","R-tab-99b4d39895514cfa032ce15a26ea7099")'>
<span class=tab-nav-text>Attributes Processor Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-763cdf0acb64ae5a587e14552a2773e0 data-tab-item=R-tab-99b4d39895514cfa032ce15a26ea7099 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span></span></span></code></pre></div></div></div></div></div><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> connector を使用して内部インサイトを取得する</span></span></summary><div class=box-content><p>Collector への最新の追加機能の1つは <a href=https://opentelemetry.io/docs/collector/configuration/#connectors rel=external><strong>connector</strong></a> の概念で、あるパイプラインの出力を別のパイプラインの入力に接続できます。</p><p>これが有益な例として、一部のサービスはエクスポートされるデータポイントの量、エラーステータスを含むログの数、または特定のデプロイ環境から送信されるデータ量に基づいてメトリクスを出力します。count connector はこれをすぐに使える形で対処するのに役立ちます。</p><h2 id=processor-の代わりに-connector-を使用する理由>processor の代わりに connector を使用する理由<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>processor は処理したデータを渡す必要があるため、追加データを生成する点で制限があり、追加情報を公開するのが困難です。connector は受信したデータを出力する必要がないため、求めているインサイトを作成する機会を提供します。</p><p>例えば、デプロイ環境属性を持たないログ、メトリクス、トレースの数をカウントする connector を作成できます。</p><p>デプロイ環境別にデータ使用量を分類できる非常にシンプルな例です。</p><h2 id=connector-に関する考慮事項>connector に関する考慮事項<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>connector は、あるパイプラインからエクスポートされ、別のパイプラインで受信されたデータのみを受け入れます。これは、connector を活用するために Collector の設定をどのように構成するかを検討する必要があることを意味します。</p><h2 id=参考資料>参考資料<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ol><li><a href=https://opentelemetry.io/docs/collector/configuration/#connectors rel=external><strong>https://opentelemetry.io/docs/collector/configuration/#connectors</strong></a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector rel=external><strong>https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector</strong></a></li></ol></div></details><hr><h2 id=設定の確認>設定の確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>processors について説明しました。設定の変更を確認しましょう。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>設定を確認する</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-e5cb49ad76074e83d46abc459d1479e1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b003ed0e48e13f34b512ca26748ce69a aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-e5cb49ad76074e83d46abc459d1479e1","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-b003ed0e48e13f34b512ca26748ce69a data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=hl><span class=lnt> 69
</span></span><span class=hl><span class=lnt> 70
</span></span><span class=hl><span class=lnt> 71
</span></span><span class=hl><span class=lnt> 72
</span></span><span class=hl><span class=lnt> 73
</span></span><span class=hl><span class=lnt> 74
</span></span><span class=hl><span class=lnt> 75
</span></span><span class=hl><span class=lnt> 76
</span></span><span class=hl><span class=lnt> 77
</span></span><span class=hl><span class=lnt> 78
</span></span><span class=hl><span class=lnt> 79
</span></span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># To limit exposure to denial of service attacks, change the host in endpoints below from 0.0.0.0 to a specific network interface.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># See https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/security-best-practices.md#safeguards-against-denial-of-service-attacks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4317</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4318</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55678</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6832</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6831</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14268</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>9411</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-exporters>OpenTelemetry Collector Exporters</h1><p>Exporter はプッシュ型またはプル型で、1つ以上のバックエンド/宛先にデータを送信する方法です。Exporter は1つ以上のデータソースをサポートする場合があります。</p><p>このワークショップでは、<a href=https://opentelemetry.io/docs/specs/otel/protocol/exporter/ rel=external><strong>otlphttp</strong></a> exporter を使用します。OpenTelemetry Protocol (OTLP) は、テレメトリデータを送信するためのベンダー中立で標準化されたプロトコルです。OTLP exporter は、OTLP プロトコルを実装しているサーバーにデータを送信します。OTLP exporter は <a href=https://grpc.io/ rel=external><strong>gRPC</strong></a> と <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview rel=external><strong>HTTP</strong></a>/<a href=https://www.json.org/json-en.html rel=external><strong>JSON</strong></a> の両方のプロトコルをサポートしています。</p><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style Exporters fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Collector
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><section><h1 class=a11y-only>5. Exportersのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-exporters>OpenTelemetry Collector Exporters</h1><h2 id=otlp-http-exporter>OTLP HTTP Exporter<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>HTTP 経由で Splunk Observability Cloud にメトリクスを送信するには、<strong>otlphttp</strong> exporter を設定する必要があります。</p><p><code>/etc/otelcol-contrib/config.yaml</code> ファイルを編集して、<strong>otlphttp</strong> exporter を設定しましょう。以下の YAML を <strong>exporters</strong> セクションの下に挿入してください。インデントは2スペースで行ってください。</p><p>また、ディスクがいっぱいにならないように、logging exporter の詳細度を変更します。デフォルトの <code>detailed</code> は非常に冗長です。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=l>otlphttp/splunk:</span></span></span></code></pre></div><p>次に、<code>metrics_endpoint</code> を定義してターゲット URL を設定する必要があります。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>Splunk 主催のワークショップに参加されている場合、使用しているインスタンスにはすでに Realm 環境変数が設定されています。設定ファイルでその環境変数を参照します。それ以外の場合は、新しい環境変数を作成して Realm を設定する必要があります。例</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;us1&#34;</span></span></span></code></pre></div></div></details><p>使用する URL は <code>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</code> です。（Splunk は、データレジデンシーのために世界中の主要な地理的場所に Realm を持っています）。</p><p><strong>otlphttp</strong> exporter は、<code>traces_endpoint</code> と <code>logs_endpoint</code> のターゲット URL を定義することで、トレースとログを送信するように設定することもできます。これらの設定は、このワークショップの範囲外です。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span></span></span></code></pre></div><p>デフォルトでは、すべてのエンドポイントで <code>gzip</code> 圧縮が有効になっています。これは、exporter 設定で <code>compression: none</code> を設定することで無効にできます。このワークショップでは、データを送信する最も効率的な方法であるため、圧縮を有効のままにしてデフォルトを使用します。</p><p>Splunk Observability Cloud にメトリクスを送信するには、アクセストークンを使用する必要があります。これは、Splunk Observability Cloud UI で新しいトークンを作成することで行えます。トークンの作成方法の詳細については、<a href=https://docs.splunk.com/Observability/admin/authentication-tokens/org-tokens.html rel=external>Create a token</a> を参照してください。トークンは <strong>INGEST</strong> タイプである必要があります。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>Splunk 主催のワークショップに参加されている場合、使用しているインスタンスにはすでにアクセストークンが設定されています（環境変数として設定されています）。設定ファイルでその環境変数を参照します。それ以外の場合は、新しいトークンを作成して環境変数として設定する必要があります。例</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span>&lt;replace-with-your-token&gt;</span></span></code></pre></div></div></details><p>トークンは、<code>headers:</code> セクションの下に <code>X-SF-TOKEN: ${env:ACCESS_TOKEN}</code> を挿入することで設定ファイルに定義されます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span></span></span></code></pre></div><h2 id=設定の確認>設定の確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Exporter について説明したので、設定の変更を確認しましょう</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>Review your configuration</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-57b1f3f524141afc6713ce8070f4ea58><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-baa2ce82ccdbbf36bdc801a491c53b30 aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-57b1f3f524141afc6713ce8070f4ea58","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-baa2ce82ccdbbf36bdc801a491c53b30 data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=hl><span class=lnt> 83
</span></span><span class=hl><span class=lnt> 84
</span></span><span class=hl><span class=lnt> 85
</span></span><span class=hl><span class=lnt> 86
</span></span><span class=hl><span class=lnt> 87
</span></span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># To limit exposure to denial of service attacks, change the host in endpoints below from 0.0.0.0 to a specific network interface.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># See https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/security-best-practices.md#safeguards-against-denial-of-service-attacks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4317</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4318</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55678</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6832</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6831</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14268</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>9411</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><p>もちろん、<strong>OTLP</strong> プロトコルをサポートする他のソリューションを指すように <code>metrics_endpoint</code> を簡単に設定できます。</p><p>次に、<code>config.yaml</code> の service セクションで、設定した receivers、processors、exporters を有効にする必要があります。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><p><strong>Service</strong> セクションは、receivers、processors、exporters、extensions セクションで定義された設定に基づいて、Collector でどのコンポーネントを有効にするかを設定するために使用します。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
情報</summary><div class=box-content><p>コンポーネントが設定されていても、<strong>Service</strong> セクション内で定義されていない場合、そのコンポーネントは<strong>有効になりません</strong>。</p></div></details><p>service セクションは3つのサブセクションで構成されています</p><ul><li>extensions</li><li>pipelines</li><li>telemetry</li></ul><p>デフォルト設定では、extension セクションは <code>health_check</code>、<code>pprof</code>、<code>zpages</code> を有効にするよう設定されています。これらは先ほど Extensions モジュールで設定しました。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></div><p>それでは、Metric Pipeline を設定しましょう！</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>6. Serviceのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=hostmetrics-receiver>Hostmetrics Receiver<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップの Receivers セクションで、さまざまなソースからスクレイプされるホストシステムに関するメトリクスを生成する <a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/3-receivers/index.html#host-metrics-receiver><strong>Host Metrics Receiver</strong></a> を定義したことを思い出してください。この receiver を有効にするには、metrics パイプラインに <code>hostmetrics</code> receiver を含める必要があります。</p><p><code>metrics</code> パイプラインで、metrics の <code>receivers</code> セクションに <code>hostmetrics</code> を追加します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=prometheus-internal-receiver>Prometheus Internal Receiver<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップの前半で、Collector 内部のメトリクスを収集していることを反映するために <code>prometheus</code> receiver の名前を <code>prometheus/internal</code> に変更しました。</p><p>ここで、metrics パイプラインで <code>prometheus/internal</code> receiver を有効にする必要があります。<code>metrics</code> パイプラインの <code>receivers</code> セクションに <code>prometheus/internal</code> を含めるように更新します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=resource-detection-processor>Resource Detection Processor<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>また、Collector がインスタンスのホスト名と AWS/EC2 メタデータをキャプチャできるように、<code>resourcedetection/system</code> と <code>resourcedetection/ec2</code> processor を追加しました。ここで、metrics パイプラインでこれら2つの processor を有効にする必要があります。</p><p><code>metrics</code> パイプラインの <code>processors</code> セクションに <code>resourcedetection/system</code> と <code>resourcedetection/ec2</code> を含めるように更新します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=attributes-processor>Attributes Processor<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>また、このワークショップの Processors セクションで、Collector がすべてのメトリクスに <code>participant.name</code> という新しい属性を挿入するように <code>attributes/conf</code> processor を追加しました。ここで、metrics パイプラインでこれを有効にする必要があります。</p><p><code>metrics</code> パイプラインの <code>processors</code> セクションに <code>attributes/conf</code> を含めるように更新します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-service>OpenTelemetry Collector Service</h1><h2 id=otlp-http-exporter>OTLP HTTP Exporter<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップの Exporters セクションで、メトリクスを Splunk Observability Cloud に送信するための <code>otlphttp</code> exporter を設定しました。ここで、metrics パイプラインでこれを有効にする必要があります。</p><p><code>metrics</code> パイプラインの <code>exporters</code> セクションに <code>otlphttp/splunk</code> を含めるように更新します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug, otlphttp/splunk]</span></span></span></code></pre></div><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Collector の内部を観察する</span></span></summary><div class=box-content><p>Collector は、実行中のコンポーネントからの追加シグナルを含む、自身の動作に関する内部シグナルをキャプチャします。
これは、データフローに関する判断を行うコンポーネントが、その情報をメトリクスまたはトレースとして公開する方法を必要とするためです。</p><h2 id=なぜ-collector-を監視するのか>なぜ Collector を監視するのか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>これは「監視者を誰が監視するのか？」という、鶏と卵のような問題ですが、この情報を公開できることは重要です。Collector の歴史において興味深い点は、Go メトリクス SDK が安定版と見なされる前から存在していたため、当面の間、Collector はこの機能を提供するために Prometheus エンドポイントを公開しているということです。</p><h2 id=考慮事項>考慮事項<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>組織内で実行中の各 Collector の内部使用状況を監視すると、大量の新しい Metric Time Series (MTS) が発生する可能性があります。Splunk ディストリビューションでは、これらのメトリクスが厳選されており、予想される増加を予測するのに役立ちます。</p><h2 id=ninja-zone>Ninja Zone<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Collector の内部オブザーバビリティを公開するために、いくつかの追加設定を調整できます</p><div class=tab-panel data-tab-group=R-tabs-e6daf22544e085fc2ecdc310de53f533><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2120ceeb61b49f6bd364f2ecddfbc761 aria-expanded=true data-tab-item=R-tab-b7b7f11d9c9c56d1979ca775dec8b62b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-e6daf22544e085fc2ecdc310de53f533","R-tab-b7b7f11d9c9c56d1979ca775dec8b62b")'>
<span class=tab-nav-text>telemetry schema</span>
</button>
<button aria-controls=R-tab-id-b1b404a6a32859ad29d3eb88178c792a aria-expanded=false data-tab-item=R-tab-55b005c9d9b0488c209e03663dcdc6fa class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-e6daf22544e085fc2ecdc310de53f533","R-tab-55b005c9d9b0488c209e03663dcdc6fa")'>
<span class=tab-nav-text>example-config.yml</span></button></div><div class=tab-content-container><div id=R-tab-id-2120ceeb61b49f6bd364f2ecddfbc761 data-tab-item=R-tab-b7b7f11d9c9c56d1979ca775dec8b62b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>&lt;info|warn|error&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>development</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>&lt;console|json&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_caller</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_stacktrace</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>output_paths</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>&lt;stdout|stderr&gt;, paths...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>error_output_paths</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>&lt;stdout|stderr&gt;, paths...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initial_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>&lt;none|basic|normal|detailed&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Address binds the promethues endpoint to scrape</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>&lt;hostname:port&gt;</span></span></span></code></pre></div></div></div><div id=R-tab-id-b1b404a6a32859ad29d3eb88178c792a data-tab-item=R-tab-55b005c9d9b0488c209e03663dcdc6fa class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_stacktrace</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initial_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>instance.name</span><span class=p>:</span><span class=w> </span><span class=l>${env:INSTANCE}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>localhost:8888</span></span></span></code></pre></div></div></div></div></div><h2 id=参考資料>参考資料<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ol><li><a href=https://opentelemetry.io/docs/collector/configuration/#service rel=external>https://opentelemetry.io/docs/collector/configuration/#service</a></li></ol></div></details><hr><h2 id=最終設定>最終設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>最終設定を確認する</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-e28d743b617d783af414bd5972ce8d1f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-9f69de17b73ad1d5d352a3c9da6e91c1 aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-e28d743b617d783af414bd5972ce8d1f","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-9f69de17b73ad1d5d352a3c9da6e91c1 data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># To limit exposure to denial of service attacks, change the host in endpoints below from 0.0.0.0 to a specific network interface.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># See https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/security-best-practices.md#safeguards-against-denial-of-service-attacks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4317</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>4318</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55678</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6832</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>6831</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14268</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>9411</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug, otlphttp/splunk]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ヒント</summary><div class=box-content><p>Collector を再起動する前に、設定ファイルを検証することをお勧めします。<code>config.yaml</code> ファイルの内容を <strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong> に貼り付けることで検証できます。</p><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><strong>Screenshot</strong></span><span class=badge-content style=background-color:green>OTelBin</span></span></summary><div class=box-content><p><a href=#R-image-9a36daabe74a01a6297f7bb08926bb3d class=lightbox-link><img alt=otelbin-validator class="lazy lightbox figure-image" loading=lazy src=../../images/otelbin.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9a36daabe74a01a6297f7bb08926bb3d><img alt=otelbin-validator class="lazy lightbox lightbox-image" loading=lazy src=../../images/otelbin.png></a></p></div></details></div></details><p>これで動作する設定ができたので、Collector を起動して <a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/2-extensions/index.html#zpages>zPages</a> が何を報告しているか確認しましょう。</p><div class=tab-panel data-tab-group=R-tabs-b3ca03cd4dc5a8bef8a8d0db9f884406><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-7d13a076cba7ee5461bdb67205cf55ff aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b3ca03cd4dc5a8bef8a8d0db9f884406","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div id=R-tab-id-7d13a076cba7ee5461bdb67205cf55ff data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><p>ブラウザで zPages を開きます：<a href=http://localhost:55679/debug/pipelinez rel=external><strong>http://localhost:55679/debug/pipelinez</strong></a>（<code>localhost</code> を自分の環境に合わせて変更してください）。
<a href=#R-image-00b45e7f51a64cd58770d4781c2aac66 class=lightbox-link><img alt=pipelinez-full-config class="lazy lightbox figure-image" loading=lazy src=../../images/pipelinez-full-config.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-00b45e7f51a64cd58770d4781c2aac66><img alt=pipelinez-full-config class="lazy lightbox lightbox-image" loading=lazy src=../../images/pipelinez-full-config.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=データの可視化>データの可視化</h1><h2 id=splunk-observability-cloud>Splunk Observability Cloud<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry Collector からメトリクスを Splunk Observability Cloud に送信する設定が完了したので、Splunk Observability Cloud でデータを確認してみましょう。Splunk Observability Cloud への招待を受け取っていない場合は、インストラクターがログイン資格情報を提供します。</p><p>その前に、少し面白くするためにインスタンスでストレステストを実行してみましょう。これによりダッシュボードが活性化されます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install stress
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span> stress -c <span class=m>2</span> -t 40<span class=p>;</span> stress -d <span class=m>5</span> -t 40<span class=p>;</span> stress -m <span class=m>20</span> -t 40<span class=p>;</span> <span class=k>done</span></span></span></code></pre></div><p>Splunk Observability Cloud にログインしたら、左側のナビゲーションを使用してメインメニューから <strong>Dashboards</strong> に移動します。これによりチームビューが表示されます。このビューの上部にある <strong>All Dashboards</strong> をクリックします</p><p><a href=#R-image-4a43e28e9c3b1ea011f82c317114e125 class=lightbox-link><img alt=menu-dashboards class="lazy lightbox figure-image" loading=lazy src=../images/menu-dashboards.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4a43e28e9c3b1ea011f82c317114e125><img alt=menu-dashboards class="lazy lightbox lightbox-image" loading=lazy src=../images/menu-dashboards.png></a></p><p>検索ボックスで <strong>OTel Contrib</strong> を検索します</p><p><a href=#R-image-f08d27deba06ca51f2fb68a47aa6a7c2 class=lightbox-link><img alt=search-dashboards class="lazy lightbox figure-image" loading=lazy src=../images/search-dashboards.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f08d27deba06ca51f2fb68a47aa6a7c2><img alt=search-dashboards class="lazy lightbox lightbox-image" loading=lazy src=../images/search-dashboards.png></a></p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
情報</summary><div class=box-content><p>ダッシュボードが存在しない場合は、インストラクターがすぐに追加できます。Splunk 主催のワークショップに参加していない場合は、インポートするダッシュボードグループをこのページの下部で見つけることができます。</p></div></details><p><strong>OTel Contrib Dashboard</strong> ダッシュボードをクリックして開き、次にダッシュボード上部の <strong>Participant Name</strong> ボックスをクリックして、<code>config.yaml</code> で <code>participant.name</code> に設定した名前をドロップダウンリストから選択するか、名前を入力して検索します</p><p><a href=#R-image-55df81d4465ff3a47db517c45b0077c6 class=lightbox-link><img alt=select-conf-attendee-name class="lazy lightbox figure-image" loading=lazy src=../images/select-participant-name.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-55df81d4465ff3a47db517c45b0077c6><img alt=select-conf-attendee-name class="lazy lightbox lightbox-image" loading=lazy src=../images/select-participant-name.png></a></p><p>これで、OpenTelemetry Collector を設定したホストのホストメトリクスを確認できます。</p><p><a href=#R-image-1157f868e48e0e492aef81f9590ac782 class=lightbox-link><img alt=participant-dashboard class="lazy lightbox figure-image" loading=lazy src=../images/participant-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1157f868e48e0e492aef81f9590ac782><img alt=participant-dashboard class="lazy lightbox lightbox-image" loading=lazy src=../images/participant-dashboard.png></a></p><details open class="box cstyle attachments info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Download Dashboard Group JSON for importing</summary><div class=box-content><ul><li><a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/7-visualisation/OpenTelemetry-Contrib-Dashboard-Group.json>OpenTelemetry-Contrib-Dashboard-Group.json</a> (40 KB)</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-開発>OpenTelemetry Collector 開発</h1><h2 id=カスタムコンポーネントの開発>カスタムコンポーネントの開発<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry Collector 用のコンポーネントを構築するには、3つの主要な部分が必要です</p><ol><li>Configuration - <em>ユーザーに公開される設定値</em></li><li>Factory - <em>提供された値を使用してコンポーネントを作成する</em></li><li>Business Logic - <em>コンポーネントが実行する必要がある処理</em></li></ol><p>ここでは、プロジェクトの重要な DevOps メトリクスを追跡できるように、Jenkins と連携するコンポーネントを構築する例を使用します。</p><p>測定しようとしているメトリクスは以下の通りです</p><ol><li>Lead time for changes - <em>&ldquo;コミットが本番環境にデプロイされるまでにかかる時間&rdquo;</em></li><li>Change failure rate - <em>&ldquo;本番環境で障害を引き起こすデプロイメントの割合&rdquo;</em></li><li>Deployment frequency - <em>"[チーム]が本番環境に正常にリリースする頻度"</em></li><li>Mean time to recover - <em>"[チーム]が本番環境の障害から復旧するまでにかかる時間"</em></li></ol><p>これらの指標は、ソフトウェア開発チームのパフォーマンスを示すために、Google の DevOps Research and Assessment（DORA）[^1] チームによって特定されました。<em>Jenkins CI</em> を選択した理由は、同じオープンソースソフトウェアのエコシステム内にとどまることで、将来ベンダーが管理する CI ツールが採用するための例として機能できるからです。</p><h2 id=計装-vs-コンポーネント>計装 vs コンポーネント<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>組織内のオブザーバビリティのレベルを向上させる際に考慮すべきことがあります。いくつかのトレードオフが生じるためです。</p><table><thead><tr><th></th><th>メリット</th><th>デメリット</th></tr></thead><tbody><tr><td><strong>（自動）計装</strong></td><td>システムを監視するために外部 API を監視する必要がありません。</td><td>計装を変更するにはプロジェクトへの変更が必要です。</td></tr><tr><td></td><td>システムオーナー/開発者がオブザーバビリティを変更する権限を持てます。</td><td>追加のランタイム依存関係が必要です。</td></tr><tr><td></td><td>システムコンテキストを理解し、キャプチャしたデータを <em>Exemplars</em> と関連付けることができます。</td><td>システムのパフォーマンスに影響を与える可能性があります。</td></tr><tr><td><strong>コンポーネント</strong></td><td>データ名やセマンティクスへの変更をシステムのリリースサイクルとは独立して展開できます。</td><td>API の破壊的な変更には、システムと Collector の間で調整されたリリースが必要です。</td></tr><tr><td></td><td>収集されるデータの更新/拡張は、ユーザーにとってシームレスな変更です。</td><td>キャプチャされたデータのセマンティクスが、新しいシステムリリースと一致しない形で予期せず壊れる可能性があります。</td></tr><tr><td></td><td>サポートチームがオブザーバビリティの実践について深い理解を持つ必要がありません。</td><td>システムから外部に公開された情報のみを表面化できます。</td></tr></tbody></table><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>8. Developのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-開発>OpenTelemetry Collector 開発</h1><h2 id=プロジェクトのセットアップ-hahahugoshortcode256s0hbhb>プロジェクトのセットアップ <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong></span></span><span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>このワークショップセクションを完了するまでの時間は、経験によって異なります。</p><p>行き詰まった場合やインストラクターに沿って進めたい場合は、<a href=https://github.com/splunk/collector-workshop-example rel=external><strong>こちら</strong></a>に完全なソリューションがあります。</p></div></details><p>新しい <em>Jenkins CI</em> レシーバーの開発を始めるには、まず Golang プロジェクトをセットアップする必要があります。
新しい Golang プロジェクトを作成する手順は以下の通りです</p><ol><li><code>${HOME}/go/src/jenkinscireceiver</code> という名前の新しいディレクトリを作成し、そのディレクトリに移動します<ol><li>実際のディレクトリ名や場所は厳密ではなく、独自の開発ディレクトリを選択して作成できます。</li></ol></li><li><code>go mod init splunk.conf/workshop/example/jenkinscireceiver</code> を実行して golang モジュールを初期化します<ol><li>これにより <code>go.mod</code> というファイルが作成され、直接的および間接的な依存関係を追跡するために使用されます</li><li>最終的には、インポートされる依存関係のチェックサム値である <code>go.sum</code> が生成されます。</li></ol></li></ol><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>go.mod を確認する</span></span></summary><div class=box-content><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>module splunk.conf/workshop/example/jenkinscireceiver
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>go 1.20</span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-開発>OpenTelemetry Collector 開発</h1><h2 id=configuration-の構築>Configuration の構築<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コンポーネントの Configuration 部分は、ユーザーがコンポーネントに対して入力を行う方法です。そのため、設定に使用される値は以下の条件を満たす必要があります</p><ol><li>そのフィールドが何を制御するかをユーザーが直感的に理解できること</li><li>必須と任意を明確にすること</li><li>一般的な名前とフィールドを再利用すること</li><li>オプションをシンプルに保つこと</li></ol><div class=tab-panel data-tab-group=R-tabs-8552f64cc6bccd42281fa19fec4c8706><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-1cf53bf2fcc30e84e5e1c50b972e05b9 aria-expanded=true data-tab-item=R-tab-ea614e7854d52692156e1a019727d7ea class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-8552f64cc6bccd42281fa19fec4c8706","R-tab-ea614e7854d52692156e1a019727d7ea")'>
<span class=tab-nav-text>bad config</span>
</button>
<button aria-controls=R-tab-id-d3d084515297275f490337b31c5b3811 aria-expanded=false data-tab-item=R-tab-c4230d82955d70d5d9d9c8cd4bb074a6 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-8552f64cc6bccd42281fa19fec4c8706","R-tab-c4230d82955d70d5d9d9c8cd4bb074a6")'>
<span class=tab-nav-text>good config</span></button></div><div class=tab-content-container><div id=R-tab-id-1cf53bf2fcc30e84e5e1c50b972e05b9 data-tab-item=R-tab-ea614e7854d52692156e1a019727d7ea class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jenkins_server_addr</span><span class=p>:</span><span class=w> </span><span class=l>hostname</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jenkins_server_api_port</span><span class=p>:</span><span class=w> </span><span class=m>8089</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>filter_builds_by</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-awesome-build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=l>amber</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>track</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.1</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.2</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.3</span><span class=p>:</span><span class=w> </span><span class=kc>no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.4</span><span class=p>:</span><span class=w> </span><span class=kc>no</span></span></span></code></pre></div></div></div><div id=R-tab-id-d3d084515297275f490337b31c5b3811 data-tab-item=R-tab-c4230d82955d70d5d9d9c8cd4bb074a6 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Required Values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=l>http://my-jenkins-server:8089</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>auth</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>authenticator</span><span class=p>:</span><span class=w> </span><span class=l>basicauth/jenkins</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Optional Values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.3</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.4</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div></div></div></div></div><p>悪い設定例は、設定のベストプラクティスの逆を行うことがコンポーネントの使いやすさにどのように影響するかを示しています。フィールド値が何であるべきかが明確ではなく、既存のプロセッサにプッシュできる機能が含まれており、フィールド名が Collector に存在する他のコンポーネントと一貫していません。</p><p>良い設定例は、必須の値をシンプルに保ち、他のコンポーネントからフィールド名を再利用し、コンポーネントが Jenkins と Collector 間の相互作用のみに焦点を当てることを確保しています。</p><p>コードタブは、私たちが追加する必要がある量と、Collector 内の共有ライブラリによってすでに提供されているものを示しています。これらはビジネスロジックに到達したときにより詳細に説明します。Configuration は小さく始まり、追加機能が必要になるとビジネスロジックが含まれるようになると変更されます。</p><h2 id=コードを書く>コードを書く<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Configuration に必要なコードを実装するために、以下の内容で <code>config.go</code> という新しいファイルを作成します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Config</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// HTTPClientSettings contains all the values</span>
</span></span><span class=line><span class=cl>    <span class=c1>// that are commonly shared across all HTTP interactions</span>
</span></span><span class=line><span class=cl>    <span class=c1>// performed by the collector.</span>
</span></span><span class=line><span class=cl>    <span class=nx>confighttp</span><span class=p>.</span><span class=nx>HTTPClientSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ScraperControllerSettings will allow us to schedule</span>
</span></span><span class=line><span class=cl>    <span class=c1>// how often to check for updates to builds.</span>
</span></span><span class=line><span class=cl>    <span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// MetricsBuilderConfig contains all the metrics</span>
</span></span><span class=line><span class=cl>    <span class=c1>// that can be configured.</span>
</span></span><span class=line><span class=cl>    <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-開発>OpenTelemetry Collector 開発</h1><h2 id=コンポーネントのレビュー>コンポーネントのレビュー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Jenkins からメトリクスをキャプチャするために必要なコンポーネントの種類を振り返ります</p><div class=tab-panel data-tab-group=R-tabs-5aef44aedfae35a97f8101be59ea8013><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-038d034788383343aa9ad136d62289d8 aria-expanded=true data-tab-item=R-tab-63e4e92bb7d207ca577b11c07f827279 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-5aef44aedfae35a97f8101be59ea8013","R-tab-63e4e92bb7d207ca577b11c07f827279")'>
<span class=tab-nav-text>Extension</span>
</button>
<button aria-controls=R-tab-id-2fa5fc7c261dc779437f695a6a71bd92 aria-expanded=false data-tab-item=R-tab-a9d093d11bc6e98b0c8e586ffa545c85 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-5aef44aedfae35a97f8101be59ea8013","R-tab-a9d093d11bc6e98b0c8e586ffa545c85")'>
<span class=tab-nav-text>Receiver</span>
</button>
<button aria-controls=R-tab-id-66ebfdd45c3faa6a84ef36402d82d03f aria-expanded=false data-tab-item=R-tab-e22b6495595f2c4ad67a830d1be05c6e class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-5aef44aedfae35a97f8101be59ea8013","R-tab-e22b6495595f2c4ad67a830d1be05c6e")'>
<span class=tab-nav-text>Processor</span>
</button>
<button aria-controls=R-tab-id-1abeb5b88332d8a18fec89b986d919ae aria-expanded=false data-tab-item=R-tab-d353b8720fcbebe4385ef7a23a43aa22 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-5aef44aedfae35a97f8101be59ea8013","R-tab-d353b8720fcbebe4385ef7a23a43aa22")'>
<span class=tab-nav-text>Exporter</span>
</button>
<button aria-controls=R-tab-id-6ba30c0621dbfd173589895ff947ab6b aria-expanded=false data-tab-item=R-tab-654b8c5e6c23b010e809ba5bb38a47cf class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-5aef44aedfae35a97f8101be59ea8013","R-tab-654b8c5e6c23b010e809ba5bb38a47cf")'>
<span class=tab-nav-text><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Connectors</span></span></span></button></div><div class=tab-content-container><div id=R-tab-id-038d034788383343aa9ad136d62289d8 data-tab-item=R-tab-63e4e92bb7d207ca577b11c07f827279 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>Extension が解決するビジネスユースケースは以下の通りです</p><ol><li>ランタイム設定が必要な共有機能を持つこと</li><li>Collector のランタイムを観測することを間接的に支援すること</li></ol><p>詳細は <a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/2-extensions/index.html><strong>Extensions の概要</strong></a> を参照してください。</p></div></div><div id=R-tab-id-2fa5fc7c261dc779437f695a6a71bd92 data-tab-item=R-tab-a9d093d11bc6e98b0c8e586ffa545c85 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Receiver が解決するビジネスユースケースは以下の通りです</p><ul><li>リモートソースからデータをフェッチする</li><li>リモートソースからデータを受信する</li></ul><p>これは一般的に <em>pull</em> 型と <em>push</em> 型のデータ収集と呼ばれ、詳細は <a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/3-receivers/index.html>Receiver の概要</a> で読むことができます。</p></div></div><div id=R-tab-id-66ebfdd45c3faa6a84ef36402d82d03f data-tab-item=R-tab-e22b6495595f2c4ad67a830d1be05c6e class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Processor が解決するビジネスユースケースは以下の通りです</p><ul><li>データ、フィールド、または値の追加や削除</li><li>データを観測し、意思決定を行う</li><li>バッファリング、キューイング、並び替え</li></ul><p>留意すべき点は、Processor を流れるデータタイプは、下流のコンポーネントに同じデータタイプを転送する必要があるということです。詳細は <a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/4-processors/index.html>Processor の概要</a> をお読みください。</p></div></div><div id=R-tab-id-1abeb5b88332d8a18fec89b986d919ae data-tab-item=R-tab-d353b8720fcbebe4385ef7a23a43aa22 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Exporter が解決するビジネスユースケースは以下の通りです</p><ul><li>ツール、サービス、またはストレージにデータを送信する</li></ul><p>OpenTelemetry Collector は「バックエンド」、つまりオールインワンのオブザーバビリティスイートになることを望んでおらず、むしろ OpenTelemetry を創設した原則を維持しています。つまり、すべての人のためのベンダーに依存しないオブザーバビリティです。詳細を再確認するには、<a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/5-exporters/index.html><strong>Exporter の概要</strong></a> をお読みください。</p></div></div><div id=R-tab-id-6ba30c0621dbfd173589895ff947ab6b data-tab-item=R-tab-654b8c5e6c23b010e809ba5bb38a47cf class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>これはワークショップで見逃されたコンポーネントタイプです。比較的新しい Collector への追加であるためです。Connector を考える最良の方法は、異なるテレメトリタイプとパイプライン間で使用できる Processor のようなものです。つまり、Connector はログとしてデータを受け入れ、メトリクスを出力したり、あるパイプラインからメトリクスを受け入れ、観測したデータに関するメトリクスを提供したりできます。</p><p>Connector が解決するビジネスケースは以下の通りです</p><ul><li>異なるテレメトリタイプ間の変換<ul><li>ログからメトリクス</li><li>トレースからメトリクス</li><li>メトリクスからログ</li></ul></li><li>受信データを観測し、独自のデータを生成する<ul><li>メトリクスを受け入れ、データの分析メトリクスを生成する。</li></ul></li></ul><p><a href=/observability-workshop/ja/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/4-processors/index.html>Processor の概要</a> の <strong>Ninja</strong> セクションに簡単な概要がありました。新しい Connector コンポーネントの更新についてはプロジェクトを確認してください。</p></div></div></div></div><p>コンポーネントの概要から、Jenkins 用のプルベースのレシーバーを開発することが明確です。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-開発>OpenTelemetry Collector 開発</h1><h3 id=メトリクスの設計>メトリクスの設計<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>レシーバーでキャプチャしたメトリクスを定義およびエクスポートするために、<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/cmd/mdatagen rel=external><strong>mdatagen</strong></a> を使用します。これは、YAML で定義されたメトリクスをコードに変換する Collector 用に開発されたツールです。</p><div class=tab-panel data-tab-group=R-tabs-55604fe2ab251d9f3c7b1e4bad1ec5ea><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-fa57a6d1e23fd8818d14567e52ac59fd aria-expanded=true data-tab-item=R-tab-b1d90847e9ac9d08a6205ad8f09fd5a9 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-55604fe2ab251d9f3c7b1e4bad1ec5ea","R-tab-b1d90847e9ac9d08a6205ad8f09fd5a9")'>
<span class=tab-nav-text>metadata.yaml</span>
</button>
<button aria-controls=R-tab-id-c7831f7e33cfac3fb44c898f876f0816 aria-expanded=false data-tab-item=R-tab-fa95711d3528c54a10a4bd5a3303bf8c class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-55604fe2ab251d9f3c7b1e4bad1ec5ea","R-tab-fa95711d3528c54a10a4bd5a3303bf8c")'>
<span class=tab-nav-text>gen.go</span></button></div><div class=tab-content-container><div id=R-tab-id-fa57a6d1e23fd8818d14567e52ac59fd data-tab-item=R-tab-b1d90847e9ac9d08a6205ad8f09fd5a9 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Type defines the name to reference the component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># in the configuration file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>jenkins</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Status defines the component type and the stability level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class=l>receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>development</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>metrics]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Attributes are the expected fields reported</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># with the exported values.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job.name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The name of the associated Jenkins job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job.status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Shows if the job had passed, or failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>success</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>unknown</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Metrics defines all the pontentially exported values from this receiver.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.jobs.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Provides a count of the total number of configured jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{Count}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.job.duration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Show the duration of the job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.status</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.job.commit_delta</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The calculation difference of the time job was finished minus commit timestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.status</span></span></span></code></pre></div></div></div><div id=R-tab-id-c7831f7e33cfac3fb44c898f876f0816 data-tab-item=R-tab-fa95711d3528c54a10a4bd5a3303bf8c class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// To generate the additional code needed to capture metrics,</span>
</span></span><span class=line><span class=cl><span class=c1>// the following command to be run from the shell:</span>
</span></span><span class=line><span class=cl><span class=c1>//  go generate -x ./...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//go:generate go run github.com/open-telemetry/opentelemetry-collector-contrib/cmd/mdatagen@v0.80.0 metadata.yaml</span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// There is no code defined within this file.</span></span></span></code></pre></div></div></div></div></div><p>次のセクションに進む前に、これらのファイルをプロジェクトフォルダー内に作成してください。</p><h2 id=factory-の構築>Factory の構築<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Factory は、オブジェクト（この場合は <code>jenkinscireceiver</code>）を提供された設定で動的に作成できるようにするソフトウェアデザインパターンです。より現実世界の例を使うと、電話ショップに行き、自分の説明と正確に一致する電話を求め、それを提供してもらうようなものです。</p><p><code>go generate -x ./...</code> コマンドを実行すると、定義されたメトリクスをエクスポートするために必要なすべてのコードを含む新しいフォルダー <code>jenkinscireceiver/internal/metadata</code> が作成されます。必要なコードは以下の通りです</p><div class=tab-panel data-tab-group=R-tabs-928f61869994a1d431e7a7cf03f992c3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d07c64532234482da2176ab705332d5f aria-expanded=true data-tab-item=R-tab-5aa589ba734396f6c25f293ea24fc1d0 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-928f61869994a1d431e7a7cf03f992c3","R-tab-5aa589ba734396f6c25f293ea24fc1d0")'>
<span class=tab-nav-text>factory.go</span>
</button>
<button aria-controls=R-tab-id-7069a5bf88647201871a5d61365f1fcc aria-expanded=false data-tab-item=R-tab-b4bda758a2aef091432646c354b4dc59 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-928f61869994a1d431e7a7cf03f992c3","R-tab-b4bda758a2aef091432646c354b4dc59")'>
<span class=tab-nav-text>config.go</span>
</button>
<button aria-controls=R-tab-id-18d3ac0d8f4d416f5402c623d71dc62c aria-expanded=false data-tab-item=R-tab-aafe740d5e6d08f015cd912160286b41 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-928f61869994a1d431e7a7cf03f992c3","R-tab-aafe740d5e6d08f015cd912160286b41")'>
<span class=tab-nav-text>scraper.go</span>
</button>
<button aria-controls=R-tab-id-0a2be746dbb06a84475e261ae96afb4c aria-expanded=false data-tab-item=R-tab-6f5be00aa7a4344a722aa8fc34d13ab9 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-928f61869994a1d431e7a7cf03f992c3","R-tab-6f5be00aa7a4344a722aa8fc34d13ab9")'>
<span class=tab-nav-text>build-config.yaml</span>
</button>
<button aria-controls=R-tab-id-b8d41440ff5338c4c6cb897cb4fbcdb6 aria-expanded=false data-tab-item=R-tab-5d31a174f263a0433738ed5261095688 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-928f61869994a1d431e7a7cf03f992c3","R-tab-5d31a174f263a0433738ed5261095688")'>
<span class=tab-nav-text>project layout</span></button></div><div class=tab-content-container><div id=R-tab-id-d07c64532234482da2176ab705332d5f data-tab-item=R-tab-5aa589ba734396f6c25f293ea24fc1d0 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/component&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewFactory</span><span class=p>()</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>Factory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>receiver</span><span class=p>.</span><span class=nf>NewFactory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>newDefaultConfig</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>receiver</span><span class=p>.</span><span class=nf>WithMetrics</span><span class=p>(</span><span class=nx>newMetricsReceiver</span><span class=p>,</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsStability</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newMetricsReceiver</span><span class=p>(</span><span class=nx>_</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>,</span> <span class=nx>cfg</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>consumer</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>)</span> <span class=p>(</span><span class=nx>receiver</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert the configuration into the expected type</span>
</span></span><span class=line><span class=cl>    <span class=nx>conf</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>cfg</span><span class=p>.(</span><span class=o>*</span><span class=nx>Config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;can not convert config&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>sc</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>conf</span><span class=p>,</span> <span class=nx>set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraperControllerReceiver</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;</span><span class=nx>conf</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>set</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>consumer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>AddScraper</span><span class=p>(</span><span class=nx>sc</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-7069a5bf88647201871a5d61365f1fcc data-tab-item=R-tab-b4bda758a2aef091432646c354b4dc59 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Config</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// HTTPClientSettings contains all the values</span>
</span></span><span class=line><span class=cl>    <span class=c1>// that are commonly shared across all HTTP interactions</span>
</span></span><span class=line><span class=cl>    <span class=c1>// performed by the collector.</span>
</span></span><span class=line><span class=cl>    <span class=nx>confighttp</span><span class=p>.</span><span class=nx>HTTPClientSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ScraperControllerSettings will allow us to schedule</span>
</span></span><span class=line><span class=cl>    <span class=c1>// how often to check for updates to builds.</span>
</span></span><span class=line><span class=cl>    <span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// MetricsBuilderConfig contains all the metrics</span>
</span></span><span class=line><span class=cl>    <span class=c1>// that can be configured.</span>
</span></span><span class=line><span class=cl>    <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newDefaultConfig</span><span class=p>()</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Config</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ScraperControllerSettings</span><span class=p>:</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewDefaultScraperControllerSettings</span><span class=p>(</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>HTTPClientSettings</span><span class=p>:</span>        <span class=nx>confighttp</span><span class=p>.</span><span class=nf>NewDefaultHTTPClientSettings</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>MetricsBuilderConfig</span><span class=p>:</span>      <span class=nx>metadata</span><span class=p>.</span><span class=nf>DefaultMetricsBuilderConfig</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-18d3ac0d8f4d416f5402c623d71dc62c data-tab-item=R-tab-aafe740d5e6d08f015cd912160286b41 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>scraper</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>cfg</span> <span class=o>*</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>)</span> <span class=p>(</span><span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>Scraper</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create a our scraper with our values</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>:=</span> <span class=nx>scraper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// To be filled in later</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraper</span><span class=p>(</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>scrape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>pmetrics</span><span class=p>.</span><span class=nf>NewMetrics</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-0a2be746dbb06a84475e261ae96afb4c data-tab-item=R-tab-6f5be00aa7a4344a722aa8fc34d13ab9 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>dist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>otelcol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Conf workshop collector&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>output_path</span><span class=p>:</span><span class=w> </span><span class=l>./dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v0.0.0-experimental</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/basicauthextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/receiver/otlpreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>splunk.conf/workshop/example/jenkinscireceiver v0.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./jenkinscireceiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/batchprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/loggingexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlphttpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># This replace is a go directive that allows for redefine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># where to fetch the code to use since the default would be from a remote project.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>replaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>splunk.conf/workshop/example/jenkinscireceiver =&gt; ./jenkinscireceiver</span></span></span></code></pre></div></div></div><div id=R-tab-id-b8d41440ff5338c4c6cb897cb4fbcdb6 data-tab-item=R-tab-5d31a174f263a0433738ed5261095688 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>├── build-config.yaml
</span></span><span class=line><span class=cl>└── jenkinscireceiver
</span></span><span class=line><span class=cl>    ├── go.mod
</span></span><span class=line><span class=cl>    ├── config.go
</span></span><span class=line><span class=cl>    ├── factory.go
</span></span><span class=line><span class=cl>    ├── scraper.go
</span></span><span class=line><span class=cl>    └── internal
</span></span><span class=line><span class=cl>      └── metadata</span></span></code></pre></div></div></div></div></div><p>これらのファイルを期待される内容でプロジェクトに書き込んだら、<code>go mod tidy</code> を実行します。これにより、すべてのリモート依存関係がフェッチされ、<code>go.mod</code> が更新され、<code>go.sum</code> ファイルが生成されます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-開発>OpenTelemetry Collector 開発</h1><h2 id=ビジネスロジックの構築>ビジネスロジックの構築<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>この時点で、現在何もしないカスタムコンポーネントがあるため、Jenkins からこのデータをキャプチャするために必要なロジックを追加する必要があります。</p><p>ここから、実行する必要があるステップは以下の通りです</p><ol><li>Jenkins に接続するクライアントを作成する</li><li>設定されたすべてのジョブをキャプチャする</li><li>設定されたジョブの最後のビルドのステータスを報告する</li><li>コミットのタイムスタンプとジョブ完了の時間差を計算する</li></ol><p>変更は <code>scraper.go</code> に対して行われます。</p><div class=tab-panel data-tab-group=R-tabs-6baddf4bf2f89b47b83ad5d0ca166cad><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-ccbd7043cd8019c44e4ebc0e309b52ba aria-expanded=true data-tab-item=R-tab-e6caaeba69313021097a6d23f5219e15 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-6baddf4bf2f89b47b83ad5d0ca166cad","R-tab-e6caaeba69313021097a6d23f5219e15")'>
<span class=tab-nav-text><ol><li>Add Jenkins client</li></ol></span></button>
<button aria-controls=R-tab-id-0bb1dd7dde7ff857d0d0f53f2a420eda aria-expanded=false data-tab-item=R-tab-577ba80910e4dfcb4e3e9abe5506eace class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-6baddf4bf2f89b47b83ad5d0ca166cad","R-tab-577ba80910e4dfcb4e3e9abe5506eace")'>
<span class=tab-nav-text><ol start=2><li>Capture all configured jobs</li></ol></span></button>
<button aria-controls=R-tab-id-f8b4f827767879c692f59f463d9c7f9e aria-expanded=false data-tab-item=R-tab-244ea624a2547544c8f517690b672fd5 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-6baddf4bf2f89b47b83ad5d0ca166cad","R-tab-244ea624a2547544c8f517690b672fd5")'>
<span class=tab-nav-text><ol start=3><li>Report the status of each job</li></ol></span></button>
<button aria-controls=R-tab-id-4f6c7cd3a66cf1866d14a9e0e7a2007a aria-expanded=false data-tab-item=R-tab-938c78fab74f4685403ec8d68561f6d1 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-6baddf4bf2f89b47b83ad5d0ca166cad","R-tab-938c78fab74f4685403ec8d68561f6d1")'>
<span class=tab-nav-text><ol start=4><li>Report the delta</li></ol></span></button></div><div class=tab-content-container><div id=R-tab-id-ccbd7043cd8019c44e4ebc0e309b52ba data-tab-item=R-tab-e6caaeba69313021097a6d23f5219e15 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>Jenkins サーバーに接続できるようにするために、<a href=https://pkg.go.dev/github.com/yosida95/golang-jenkins rel=external>&ldquo;github.com/yosida95/golang-jenkins&rdquo;</a> パッケージを使用します。このパッケージは、Jenkins サーバーからデータを読み取るために必要な機能を提供します。</p><p>次に、<a href=https://pkg.go.dev/go.opentelemetry.io/collector/receiver/scraperhelper rel=external>&ldquo;go.opentelemetry.io/collector/receiver/scraperhelper&rdquo;</a> ライブラリのヘルパー関数を利用して、コンポーネントの起動が完了した後に Jenkins サーバーに接続できるように start 関数を作成します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>jenkins</span> <span class=s>&#34;github.com/yosida95/golang-jenkins&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/component&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/pdata/pmetric&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>scraper</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mb</span>     <span class=o>*</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilder</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span> <span class=o>*</span><span class=nx>jenkins</span><span class=p>.</span><span class=nx>Jenkins</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>cfg</span> <span class=o>*</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>)</span> <span class=p>(</span><span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>Scraper</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>scraper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>mb</span> <span class=p>:</span> <span class=nx>metadata</span><span class=p>.</span><span class=nf>NewMetricsBuilder</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span><span class=p>,</span> <span class=nx>set</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraper</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>scrape</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>WithStart</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>h</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Host</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>cfg</span><span class=p>.</span><span class=nf>ToClient</span><span class=p>(</span><span class=nx>h</span><span class=p>,</span> <span class=nx>set</span><span class=p>.</span><span class=nx>TelemetrySettings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=c1>// The collector provides a means of injecting authentication</span>
</span></span><span class=line><span class=cl>            <span class=c1>// on our behalf, so this will ignore the libraries approach</span>
</span></span><span class=line><span class=cl>            <span class=c1>// and use the configured http client with authentication.</span>
</span></span><span class=line><span class=cl>            <span class=nx>s</span><span class=p>.</span><span class=nx>client</span> <span class=p>=</span> <span class=nx>jenkins</span><span class=p>.</span><span class=nf>NewJenkins</span><span class=p>(</span><span class=kc>nil</span><span class=p>,</span> <span class=nx>cfg</span><span class=p>.</span><span class=nx>Endpoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>SetHTTPClient</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>        <span class=p>}),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nf>NewMetrics</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>これで Jenkins レシーバーを初期化するために必要なすべてのセットアップコードが完了しました。</p></div></div><div id=R-tab-id-0bb1dd7dde7ff857d0d0f53f2a420eda data-tab-item=R-tab-577ba80910e4dfcb4e3e9abe5506eace class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>ここからは、入力を待っていた <code>scrape</code> メソッドに焦点を当てます。このメソッドは、設定で構成された間隔（デフォルトでは毎分）で実行されます。</p><p>設定されたジョブの数をキャプチャしたい理由は、Jenkins サーバーの成長を確認し、オンボードしたプロジェクトの数を測定できるようにするためです。これを行うために、Jenkins クライアントを呼び出してすべてのジョブをリストし、エラーが報告された場合はメトリクスなしでそれを返し、そうでなければメトリクスビルダーからデータを出力します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure</span>
</span></span><span class=line><span class=cl>    <span class=c1>// all captured data points within this scrape have the same value.</span>
</span></span><span class=line><span class=cl>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-f8b4f827767879c692f59f463d9c7f9e data-tab-item=R-tab-244ea624a2547544c8f517690b672fd5 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>前のステップでは、すべてのジョブをキャプチャし、ジョブの数を報告することができました。このステップでは、各ジョブを調べ、報告された値を使用してメトリクスをキャプチャします。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure</span>
</span></span><span class=line><span class=cl>    <span class=c1>// all captured data points within this scrape have the same value.</span>
</span></span><span class=line><span class=cl>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>job</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>jobs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure we have valid results to start off with</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>build</span>  <span class=p>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// This will check the result of the job, however,</span>
</span></span><span class=line><span class=cl>        <span class=c1>// since the only defined attributes are</span>
</span></span><span class=line><span class=cl>        <span class=c1>// `success`, `failure`, and `unknown`.</span>
</span></span><span class=line><span class=cl>        <span class=c1>// it is assume that anything did not finish</span>
</span></span><span class=line><span class=cl>        <span class=c1>// with a success or failure to be an unknown status.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=nx>build</span><span class=p>.</span><span class=nx>Result</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;aborted&#34;</span><span class=p>,</span> <span class=s>&#34;not_built&#34;</span><span class=p>,</span> <span class=s>&#34;unstable&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;success&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusSuccess</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;failure&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusFailed</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobDurationDataPoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>int64</span><span class=p>(</span><span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span><span class=p>.</span><span class=nx>Duration</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>job</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-4f6c7cd3a66cf1866d14a9e0e7a2007a data-tab-item=R-tab-938c78fab74f4685403ec8d68561f6d1 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>最後のステップは、コミットからジョブ完了までにかかった時間を計算し、DORA メトリクスを推測するのに役立てることです。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure</span>
</span></span><span class=line><span class=cl>    <span class=c1>// all captured data points within this scrape have the same value.</span>
</span></span><span class=line><span class=cl>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>job</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>jobs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure we have valid results to start off with</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>build</span>  <span class=p>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Previous step here</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure that the `ChangeSet` has values</span>
</span></span><span class=line><span class=cl>        <span class=c1>// set so there is a valid value for us to reference</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>build</span><span class=p>.</span><span class=nx>ChangeSet</span><span class=p>.</span><span class=nx>Items</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Making the assumption that the first changeset</span>
</span></span><span class=line><span class=cl>        <span class=c1>// item is the most recent change.</span>
</span></span><span class=line><span class=cl>        <span class=nx>change</span> <span class=o>:=</span> <span class=nx>build</span><span class=p>.</span><span class=nx>ChangeSet</span><span class=p>.</span><span class=nx>Items</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Record the difference from the build time</span>
</span></span><span class=line><span class=cl>        <span class=c1>// compared against the change timestamp.</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobCommitDeltaDataPoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>int64</span><span class=p>(</span><span class=nx>build</span><span class=p>.</span><span class=nx>Timestamp</span><span class=o>-</span><span class=nx>change</span><span class=p>.</span><span class=nx>Timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>job</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>これらのステップがすべて完了すると、カスタム Jenkins CI レシーバーの構築が完了です！</p><h2 id=次のステップ>次のステップ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コンポーネントから欲しい機能がおそらくもっとあるでしょう。例えば</p><ul><li>ジョブが使用したブランチ名を含めることはできますか？</li><li>ジョブのプロジェクト名を含めることはできますか？</li><li>プロジェクトの累積ジョブ期間をどのように計算しますか？</li><li>変更が機能することをどのように検証しますか？</li></ul><p>この時間を使って、遊んでみたり、壊してみたり、変更したり、ビルドからログをキャプチャしてみたりしてください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=advanced-opentelemetry-collector>Advanced OpenTelemetry Collector</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>75 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Authors
</span><span class=badge-content>Robert Castley, Charity Anderson, Pieter Hagen, & Geoff Higginbottom</span></span><p>このワークショップの目的は、OpenTelemetry Collector の設定ファイルを作成・変更する際の自信を深めることです。最小限の <code>agent.yaml</code> と <code>gateway.yaml</code> ファイルから始め、いくつかの高度な実際のシナリオに対応できるよう段階的に構築していきます。</p><p>このワークショップの重要なポイントは、テレメトリーデータをサードパーティベンダーのバックエンドに送信するのではなく、ローカルに保存するよう OpenTelemetry Collector を設定する方法を学ぶことです。このアプローチはデバッグやトラブルシューティングを簡素化するだけでなく、本番システムへのデータ送信を避けたいテストや開発環境にも最適です。</p><p>このワークショップを最大限に活用するために、以下の知識が必要です</p><ul><li>OpenTelemetry Collector とその設定ファイル構造の基本的な理解</li><li>YAML ファイルの編集スキル</li></ul><p>このワークショップのすべての内容はローカルで実行できるよう設計されており、実践的でアクセスしやすい学習体験を提供します。それでは、構築を始めましょう！</p><h2 id=ワークショップの概要>ワークショップの概要<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このワークショップでは、以下のトピックを取り上げます</p><ul><li><strong>Agent と Gateway をローカルでセットアップ</strong>: メトリクス、トレース、ログが Agent 経由で Gateway に送られることをテストします。</li><li><strong>Agent の耐障害性を強化</strong>: フォールトトレランスのための基本設定を行います。</li><li><strong>Processor の設定</strong>:<ul><li>特定のスパン（例：ヘルスチェック）をドロップしてノイズをフィルタリングします。</li><li>不要なタグを削除し、機密データを処理します。</li><li>エクスポート前にパイプラインで OTTL（OpenTelemetry Transformation Language）を使用してデータを変換します。</li></ul></li><li><strong>Connector の設定</strong>:<ul><li>受信した値に基づいて、データを異なるエンドポイントにルーティングします。</li></ul></li></ul><p>このワークショップを終了すると、さまざまな実際のユースケースに対応する OpenTelemetry Collector の設定に精通しているでしょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/28</span></span></footer></article><section><h1 class=a11y-only>Advanced OpenTelemetry Collectorのサブセクション</h1><article class=default><header class=headline></header><h1 id=前提条件>前提条件</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h3 id=前提条件>前提条件<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><ul><li><code>vi</code>、<code>vim</code>、<code>nano</code>、またはお好みのテキストエディタを使用して YAML ファイルを編集するスキル</li><li>サポートされている環境<ul><li>提供される Splunk Workshop インスタンス（推奨）。<code>ssh</code> アクセス用にポート <code>2222</code> への外部アクセスが必要です。</li><li>Apple Mac（Apple Silicon）。<code>jq</code> のインストールが必要です - <a href=https://jqlang.org/download/ rel=external><strong>https://jqlang.org/download/</strong></a></li></ul></li></ul><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>ディレクトリの作成</strong>: 環境内で新しいディレクトリを作成し、そのディレクトリに移動します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir advanced-otel-workshop <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=nb>cd</span> advanced-otel-workshop</span></span></code></pre></div><p>このワークショップの残りの部分では、このディレクトリを <code>[WORKSHOP]</code> と呼びます。</p><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
既存の OpenTelemetry Collector を削除してください</summary><div class=box-content><p>Splunk IM ワークショップを完了している場合は、続行する前に Kubernetes で実行中の Collector を削除してください。以下のコマンドを実行して削除できます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div><p>その場合、EC2 インスタンスでこのワークショップと干渉する可能性のあるサービスが実行されている場合があるため、以下のコマンドを実行してそれらが存在する場合は停止してください</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete ~/workshop/apm/deployment.yaml</span></span></code></pre></div></div></details><p><strong>ワークショップバイナリのダウンロード</strong>: <code>[WORKSHOP]</code> ディレクトリに移動し、OpenTelemetry Collector、Load Generator バイナリ、およびセットアップスクリプトをダウンロードします</p><div class=tab-panel data-tab-group=R-tabs-59670e0a324c9a73e72cdea7794ee3c0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-90aaf00226d22481cb17b258576545f1 aria-expanded=true data-tab-item=R-tab-82857c7966640c0cfd614ba8cc6f34f0 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-59670e0a324c9a73e72cdea7794ee3c0","R-tab-82857c7966640c0cfd614ba8cc6f34f0")'>
<span class=tab-nav-text>Splunk Workshop Instance</span>
</button>
<button aria-controls=R-tab-id-7b91979ee521b45bad0631fff0a24a74 aria-expanded=false data-tab-item=R-tab-720c44a46151d66d4db2d011603e7e1f class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-59670e0a324c9a73e72cdea7794ee3c0","R-tab-720c44a46151d66d4db2d011603e7e1f")'>
<span class=tab-nav-text>Apple Silicon</span></button></div><div class=tab-content-container><div id=R-tab-id-90aaf00226d22481cb17b258576545f1 data-tab-item=R-tab-82857c7966640c0cfd614ba8cc6f34f0 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L https://github.com/signalfx/splunk-otel-collector/releases/download/v0.136.0/otelcol_linux_amd64 -o otelcol <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/loadgen/build/loadgen-linux-amd64 -o loadgen <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/setup-workshop.sh -o setup-workshop.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>chmod +x setup-workshop.sh</span></span></code></pre></div></div></div><div id=R-tab-id-7b91979ee521b45bad0631fff0a24a74 data-tab-item=R-tab-720c44a46151d66d4db2d011603e7e1f class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L https://github.com/signalfx/splunk-otel-collector/releases/download/v0.136.0/otelcol_darwin_arm64 -o otelcol <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/loadgen/build/loadgen-darwin-arm64 -o loadgen <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/setup-workshop.sh -o setup-workshop.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>chmod +x setup-workshop.sh</span></span></code></pre></div></div></div></div></div><p><code>setup-workshop.sh</code> スクリプトを実行します。このスクリプトは正しい権限を設定し、<strong>Agent</strong> と <strong>Gateway</strong> の初期設定も作成します</p><div class=tab-panel data-tab-group=R-tabs-0a3aa64b760c970170496a99aa3ebf34><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-7b477805ea31470288166f985d3e0a32 aria-expanded=true data-tab-item=R-tab-ed1ba283b4cfb63aa90843a7e81a1de7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-0a3aa64b760c970170496a99aa3ebf34","R-tab-ed1ba283b4cfb63aa90843a7e81a1de7")'>
<span class=tab-nav-text>Setup Workshop</span>
</button>
<button aria-controls=R-tab-id-edc9767833745b839da6a9c86aba41fa aria-expanded=false data-tab-item=R-tab-f3e2501fbfa01a9bf4df67b1c72e5d24 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-0a3aa64b760c970170496a99aa3ebf34","R-tab-f3e2501fbfa01a9bf4df67b1c72e5d24")'>
<span class=tab-nav-text>Verify Setup</span></button></div><div class=tab-content-container><div id=R-tab-id-7b477805ea31470288166f985d3e0a32 data-tab-item=R-tab-ed1ba283b4cfb63aa90843a7e81a1de7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./setup-workshop.sh</span></span></code></pre></div></div></div><div id=R-tab-id-edc9767833745b839da6a9c86aba41fa data-tab-item=R-tab-f3e2501fbfa01a9bf4df67b1c72e5d24 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>███████╗██████╗ ██╗     ██╗   ██╗███╗   ██╗██╗  ██╗    ██╗
</span></span><span class=line><span class=cl>██╔════╝██╔══██╗██║     ██║   ██║████╗  ██║██║ ██╔╝    ╚██╗
</span></span><span class=line><span class=cl>███████╗██████╔╝██║     ██║   ██║██╔██╗ ██║█████╔╝      ╚██╗
</span></span><span class=line><span class=cl>╚════██║██╔═══╝ ██║     ██║   ██║██║╚██╗██║██╔═██╗      ██╔╝
</span></span><span class=line><span class=cl>███████║██║     ███████╗╚██████╔╝██║ ╚████║██║  ██╗    ██╔╝
</span></span><span class=line><span class=cl>╚══════╝╚═╝     ╚══════╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═╝    ╚═╝
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Welcome to the Splunk Advanced OpenTelemetry Workshop!
</span></span><span class=line><span class=cl>======================================================
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>macOS detected. Removing quarantine attributes...
</span></span><span class=line><span class=cl>otelcol version v0.126.0
</span></span><span class=line><span class=cl>Usage: loadgen [OPTIONS]
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>  -base       Send base traces (enabled by default)
</span></span><span class=line><span class=cl>  -health     Send health traces
</span></span><span class=line><span class=cl>  -security   Send security traces
</span></span><span class=line><span class=cl>  -logs       Enable logging of random quotes to quotes.log
</span></span><span class=line><span class=cl>  -json       Output logs in JSON format (only applicable with -logs)
</span></span><span class=line><span class=cl>  -count      Number of traces or logs to send (default: infinite)
</span></span><span class=line><span class=cl>  -h, --help  Display this help message
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Example:
</span></span><span class=line><span class=cl>  loadgen -health -security -count 10   Send 10 health and security traces
</span></span><span class=line><span class=cl>  loadgen -logs -json -count 5          Write 5 random quotes in JSON format to quotes.log
</span></span><span class=line><span class=cl>Creating workshop directories...
</span></span><span class=line><span class=cl>✓ Created subdirectories:
</span></span><span class=line><span class=cl>  ├── 1-agent-gateway
</span></span><span class=line><span class=cl>  ├── 2-building-resilience
</span></span><span class=line><span class=cl>  ├── 3-dropping-spans
</span></span><span class=line><span class=cl>  ├── 4-sensitive-data
</span></span><span class=line><span class=cl>  ├── 5-transform-data
</span></span><span class=line><span class=cl>  ├── 6-routing-data
</span></span><span class=line><span class=cl>  └── 7-sum-count
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Creating configuration files for 1-agent-gateway...
</span></span><span class=line><span class=cl>Creating OpenTelemetry Collector agent configuration file: 1-agent-gateway/agent.yaml
</span></span><span class=line><span class=cl>✓ Configuration file created successfully: 1-agent-gateway/agent.yaml
</span></span><span class=line><span class=cl>✓ File size:     4355 bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Creating OpenTelemetry Collector gateway configuration file: 1-agent-gateway/gateway.yaml
</span></span><span class=line><span class=cl>✓ Configuration file created successfully: 1-agent-gateway/gateway.yaml
</span></span><span class=line><span class=cl>✓ File size:     3376 bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>✓ Completed configuration files for 1-agent-gateway
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Creating configuration files for 2-building-resilience...
</span></span><span class=line><span class=cl>Creating OpenTelemetry Collector agent configuration file: 2-building-resilience/agent.yaml
</span></span><span class=line><span class=cl>✓ Configuration file created successfully: 2-building-resilience/agent.yaml
</span></span><span class=line><span class=cl>✓ File size:     4355 bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Creating OpenTelemetry Collector gateway configuration file: 2-building-resilience/gateway.yaml
</span></span><span class=line><span class=cl>✓ Configuration file created successfully: 2-building-resilience/gateway.yaml
</span></span><span class=line><span class=cl>✓ File size:     3376 bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>✓ Completed configuration files for 2-building-resilience
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Workshop environment setup complete!
</span></span><span class=line><span class=cl>Configuration files created in the following directories:
</span></span><span class=line><span class=cl>  1-agent-gateway/
</span></span><span class=line><span class=cl>    ├── agent.yaml
</span></span><span class=line><span class=cl>    └── gateway.yaml
</span></span><span class=line><span class=cl>  2-building-resilience/
</span></span><span class=line><span class=cl>    ├── agent.yaml
</span></span><span class=line><span class=cl>    └── gateway.yaml</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=R-tabs-48a74a26eeb134a4fa3bd7e4257e4da1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2b6f54ce85eb1d17c83cac4bcef2c971 aria-expanded=true data-tab-item=R-tab-b40a1b49bd294b76ac2b8778c756092f class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-48a74a26eeb134a4fa3bd7e4257e4da1","R-tab-b40a1b49bd294b76ac2b8778c756092f")'>
<span class=tab-nav-text>Initial Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-2b6f54ce85eb1d17c83cac4bcef2c971 data-tab-item=R-tab-b40a1b49bd294b76ac2b8778c756092f class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>├── 1-agent-gateway
</span></span><span class=line><span class=cl>├── 2-building-resilience
</span></span><span class=line><span class=cl>├── 3-dropping-spans
</span></span><span class=line><span class=cl>├── 4-sensitive-data
</span></span><span class=line><span class=cl>├── 5-transform-data
</span></span><span class=line><span class=cl>├── 6-routing-data
</span></span><span class=line><span class=cl>├── 7-sum-count
</span></span><span class=line><span class=cl>├── loadgen
</span></span><span class=line><span class=cl>├── otelcol
</span></span><span class=line><span class=cl>└── setup-workshop.sh</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=1-agent-設定の確認>1. Agent 設定の確認</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>ようこそ！このセクションでは、<strong>Agent</strong> と <strong>Gateway</strong> の両方を含む完全に機能する OpenTelemetry セットアップから始めます。</p><p>まず、設定ファイルを簡単に確認して、全体的な構造に慣れ、テレメトリーパイプラインを制御する重要なセクションを確認します。</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>ワークショップを通じて、複数のターミナルウィンドウを使用します。整理しやすくするために、各ターミナルに固有の名前または色を付けてください。これにより、演習中にターミナルを簡単に識別して切り替えることができます。</p><p>これらのターミナルを <strong>Agent</strong>、<strong>Gateway</strong>、<strong>Loadgen</strong>、<strong>Test</strong> と呼びます。</p></div></details><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ol><li><p>最初のターミナルウィンドウを作成し、<strong>Agent</strong> と名前を付けます。最初の演習用ディレクトリ <code>[WORKSHOP]/1-agent-gateway</code> に移動し、必要なファイルが生成されていることを確認します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> 1-agent-gateway
</span></span><span class=line><span class=cl>ls -l</span></span></code></pre></div></li><li><p>ディレクトリに以下のファイルが表示されるはずです。表示されない場合は、<strong>前提条件</strong> セクションで説明されている <code>setup-workshop.sh</code> スクリプトを再実行してください</p><div class=tab-panel data-tab-group=R-tabs-9eacec6fc3b42e9dc7a2474cf6c60631><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-0d0a01455b75da439d3b53d539c7f736 aria-expanded=true data-tab-item=R-tab-3ea4b283eb322e1c6373d63f91d032be class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9eacec6fc3b42e9dc7a2474cf6c60631","R-tab-3ea4b283eb322e1c6373d63f91d032be")'>
<span class=tab-nav-text>Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-0d0a01455b75da439d3b53d539c7f736 data-tab-item=R-tab-3ea4b283eb322e1c6373d63f91d032be class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></li></ol></div></details><h3 id=agent-設定の理解>Agent 設定の理解<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>このワークショップで使用する <code>agent.yaml</code> ファイルの主要なコンポーネントを確認しましょう。メトリクス、トレース、ログをサポートするために重要な追加が行われています。</p><h4 id=receiver>Receiver<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p><code>receivers</code> セクションは、<strong>Agent</strong> がテレメトリーデータを取り込む方法を定義します。このセットアップでは、3種類の Receiver が設定されています</p><ul><li><p><strong>Host Metrics Receiver</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>                         </span><span class=c># Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>3600s        </span><span class=w> </span><span class=c># Collection Interval (1hr)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w>                             </span><span class=c># CPU Scraper</span></span></span></code></pre></div><p>ローカルシステムから1時間ごとに CPU 使用率を収集します。これを使用してサンプルメトリクスデータを生成します。</p></li><li><p><strong>OTLP Receiver（HTTP プロトコル）</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otlp</span><span class=p>:</span><span class=w>                                </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>http</span><span class=p>:</span><span class=w>                            </span><span class=c># Configure HTTP protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span><span class=w>       </span><span class=c># Endpoint to bind to</span></span></span></code></pre></div><p>Agent がポート <code>4318</code> で HTTP 経由でメトリクス、トレース、ログを受信できるようにします。これは、今後の演習で Collector にデータを送信するために使用されます。</p></li><li><p><strong>FileLog Receiver</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log             </span><span class=w> </span><span class=c># The file to read log data from</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include_file_path</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>            </span><span class=c># Include file path in the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>include_file_name</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>           </span><span class=c># Exclude file name from the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource</span><span class=p>:</span><span class=w>                          </span><span class=c># Add custom resource attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>com.splunk.source</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log </span><span class=w> </span><span class=c># Source of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>com.splunk.sourcetype</span><span class=p>:</span><span class=w> </span><span class=l>quotes   </span><span class=w> </span><span class=c># Source type of the log data</span></span></span></code></pre></div><p>Agent がローカルログファイル（<code>quotes.log</code>）を tail し、<code>source</code> や <code>sourceType</code> などのメタデータで強化された構造化ログイベントに変換できるようにします。</p></li></ul><h4 id=exporter>Exporter<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><ul><li><p><strong>Debug Exporter</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                               </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed               </span><span class=w> </span><span class=c># Enabled detailed debug output</span></span></span></code></pre></div></li><li><p><strong>OTLPHTTP Exporter</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                            </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w>  </span><span class=c># Gateway OTLP endpoint</span></span></span></code></pre></div><p><code>debug</code> Exporter はワークショップ中の可視性とデバッグのためにデータをコンソールに送信し、<code>otlphttp</code> Exporter はすべてのテレメトリーをローカルの <strong>Gateway</strong> インスタンスに転送します。</p><p><strong>このデュアルエクスポート戦略により、生データをローカルで確認しながら、さらなる処理とエクスポートのためにダウンストリームに送信することができます。</strong></p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>1. Agent Configurationのサブセクション</h1><article class=default><header class=headline></header><h1 id=11-gateway-設定の確認>1.1 Gateway 設定の確認</h1><p><strong>OpenTelemetry Gateway</strong> は、テレメトリーデータの受信、処理、エクスポートのための中央ハブとして機能します。テレメトリーソース（アプリケーションやサービスなど）と Splunk Observability Cloud のようなオブザーバビリティバックエンドの間に位置します。</p><p>テレメトリートラフィックを集中化することで、Gateway はデータのフィルタリング、エンリッチメント、変換、および1つ以上の宛先へのルーティングなどの高度な機能を実現します。個々のサービスからテレメトリー処理をオフロードすることで負担を軽減し、分散システム全体で一貫した標準化されたデータを確保します。</p><p>これにより、オブザーバビリティパイプラインの管理、スケーリング、分析が容易になります。特に複雑なマルチサービス環境では効果的です。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>2つ目のターミナルウィンドウを開くか作成し、<strong>Gateway</strong> と名前を付けます。最初の演習ディレクトリ <code>[WORKSHOP]/1-agent-gateway</code> に移動し、<code>gateway.yaml</code> ファイルの内容を確認します。</p><p>このファイルは、<strong>Gateway</strong> モードでデプロイされた OpenTelemetry Collector のコア構造を示しています。</p></div></details><h3 id=gateway-設定の理解>Gateway 設定の理解<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>このワークショップで <strong>Gateway</strong> モードの OpenTelemetry Collector がどのように設定されているかを定義する <code>gateway.yaml</code> ファイルを確認しましょう。この <strong>Gateway</strong> は、<strong>Agent</strong> からテレメトリーを受信し、処理してから検査または転送のためにエクスポートする役割を担います。</p><ul><li><p><strong>OTLP Receiver（カスタムポート）</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span></span></span></code></pre></div><p>ポート <code>5318</code> は <strong>Agent</strong> 設定の <code>otlphttp</code> Exporter と一致しており、<strong>Agent</strong> が送信するすべてのテレメトリーデータが <strong>Gateway</strong> で受け入れられることを保証します。</p></li></ul><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>このポートの分離により、競合を回避し、Agent と Gateway の役割間の責任を明確に保ちます。</p></div></details><ul><li><p><strong>File Exporter</strong></p><p><strong>Gateway</strong> は3つの File Exporter を使用して、テレメトリーデータをローカルファイルに出力します。これらの Exporter は以下のように定義されています</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>                        </span><span class=c># List of exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                          </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed          </span><span class=w> </span><span class=c># Enable detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces.out&#34;</span><span class=w>  </span><span class=c># Path for OTLP JSON output for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/metrics</span><span class=p>:</span><span class=w>                   </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-metrics.out&#34;</span><span class=w> </span><span class=c># Path for OTLP JSON output for metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/logs</span><span class=p>:</span><span class=w>                      </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-logs.out&#34;</span><span class=w>    </span><span class=c># Path for OTLP JSON output for logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span></span></span></code></pre></div><p>各 Exporter は、特定のシグナルタイプを対応するファイルに書き込みます。</p><p>これらのファイルは Gateway が起動すると作成され、Agent がデータを送信すると実際のテレメトリーが書き込まれます。これらのファイルをリアルタイムで監視して、パイプラインを通過するテレメトリーの流れを観察できます。</p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=12-設定の検証とテスト>1.2 設定の検証とテスト</h1><p>次に、<strong>Gateway</strong> と <strong>Agent</strong> を起動します。<strong>Agent</strong> は起動時に自動的に <strong>Host Metrics</strong> を送信するよう設定されています。これにより、データが <strong>Agent</strong> から <strong>Gateway</strong> に正しくルーティングされることを確認します。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gateway</strong>: <strong>Gateway ターミナル</strong> ウィンドウで、以下のコマンドを実行して <strong>Gateway</strong> を起動します</p><div class=tab-panel data-tab-group=R-tabs-5b4de62e1df75841ef7f6d9730d73e82><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-1713b6caf1d36881fe0cc07f72c897b6 aria-expanded=true data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-5b4de62e1df75841ef7f6d9730d73e82","R-tab-dc146ad677dc5dd9c26a2a6537f98eb7")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div id=R-tab-id-1713b6caf1d36881fe0cc07f72c897b6 data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p>すべてが正しく設定されている場合、Collector が起動し、出力に <code>Everything is ready. Begin running and processing data.</code> と表示されます。以下のような出力になります</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-06-09T09:22:11.944+0100    info    service@v0.126.0/service.go:289 Everything is ready. Begin running and processing data. {&#34;resource&#34;: {}}</span></span></code></pre></div><p><strong>Gateway</strong> が実行されると、ポート <code>5318</code> で受信データをリッスンし、受信したデータを以下のファイルにエクスポートします</p><ul><li><code>gateway-traces.out</code></li><li><code>gateway-metrics.out</code></li><li><code>gateway-logs.out</code></li></ul><p><strong>Agent の起動</strong>: <strong>Agent ターミナル</strong> ウィンドウで、Agent 設定を使用して Agent を起動します</p><div class=tab-panel data-tab-group=R-tabs-35e313217a06d5280cb7aa5fcaa32ae3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4be4c12a08c4717f1d676668738b1d2a aria-expanded=true data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-35e313217a06d5280cb7aa5fcaa32ae3","R-tab-e2d8debf4ffe3bb6331201655f536d9d")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div id=R-tab-id-4be4c12a08c4717f1d676668738b1d2a data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>CPU メトリクスの確認</strong>:</p><ol><li><strong>Agent</strong> が起動すると、すぐに <strong>CPU</strong> メトリクスの送信を開始することを確認します。</li><li><strong>Agent</strong> と <strong>Gateway</strong> の両方がデバッグ出力にこのアクティビティを表示します。出力は以下のスニペットのようになります</li></ol><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>NumberDataPoints #31
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>     -&gt; cpu: Str(cpu3)
</span></span><span class=line><span class=cl>     -&gt; state: Str(wait)
</span></span><span class=line><span class=cl>StartTimestamp: 2025-07-07 16:49:42 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-07-09 09:36:21.190226459 +0000 UTC
</span></span><span class=line><span class=cl>Value: 77.380000
</span></span><span class=line><span class=cl>        {&#34;resource&#34;: {}, &#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;exporter&#34;, &#34;otelcol.signal&#34;: &#34;metrics&#34;}</span></span></code></pre></div><p>この段階で、<strong>Agent</strong> は1時間ごとまたは再起動ごとに <strong>CPU</strong> メトリクスを収集し、Gateway に送信し続けます。<strong>Gateway</strong> はこれらのメトリクスを処理し、<code>gateway-metrics.out</code> という名前のファイルにエクスポートします。このファイルは、パイプラインサービスの一部としてエクスポートされたメトリクスを保存します。</p><p><strong>Gateway にデータが到着したことの確認</strong>: CPU メトリクス（特に <code>cpu0</code>）が Gateway に正常に到達したことを確認するために、<code>jq</code> コマンドを使用して <code>gateway-metrics.out</code> ファイルを検査します。</p><p>以下のコマンドは、<code>system.cpu.time</code> メトリクスをフィルタリングして抽出し、<code>cpu0</code> に焦点を当てます。メトリクスの状態（例：<code>user</code>、<code>system</code>、<code>idle</code>、<code>interrupt</code>）と対応する値を表示します。</p><p>3つ目のターミナルウィンドウを開くか作成し、<strong>Tests</strong> と名前を付けます。<strong>Tests ターミナル</strong> で以下のコマンドを実行して <code>system.cpu.time</code> メトリクスを確認します</p><div class=tab-panel data-tab-group=R-tabs-a1ffacdbd8a8810033522f80e0e78262><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-910b43cf66c24df20951a63804d6fad2 aria-expanded=true data-tab-item=R-tab-fe622e84764bc6f08467fa0eea9b5ec6 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a1ffacdbd8a8810033522f80e0e78262","R-tab-fe622e84764bc6f08467fa0eea9b5ec6")'>
<span class=tab-nav-text>Check CPU Metrics</span>
</button>
<button aria-controls=R-tab-id-5885c4681cc01601693efa3647677d5e aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a1ffacdbd8a8810033522f80e0e78262","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-910b43cf66c24df20951a63804d6fad2 data-tab-item=R-tab-fe622e84764bc6f08467fa0eea9b5ec6 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceMetrics[].scopeMetrics[].metrics[] | select(.name == &#34;system.cpu.time&#34;) | .sum.dataPoints[] | select(.attributes[0].value.stringValue == &#34;cpu0&#34;) | {cpu: .attributes[0].value.stringValue, state: .attributes[1].value.stringValue, value: .asDouble}&#39;</span> gateway-metrics.out</span></span></code></pre></div></div></div><div id=R-tab-id-5885c4681cc01601693efa3647677d5e data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>123407.02</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>64866.6</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;idle&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>216427.87</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;interrupt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>Agent</strong> と <strong>Gateway</strong> のプロセスを、それぞれのターミナルで <code>Ctrl-C</code> を押して停止してください。</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=2-耐障害性の構築>2. 耐障害性の構築</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>OpenTelemetry Collector の <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/19bc7d6ee854c0c1b5c97d8d348e5b9d1199e8aa/extension/storage/filestorage/README.md rel=external><strong>FileStorage Extension</strong></a> は、より耐障害性の高いテレメトリーパイプラインを構築するための重要なコンポーネントです。これにより、Collector は処理中のデータを確実にチェックポイントし、リトライを効率的に管理し、貴重なテレメトリーを失うことなく一時的な障害を適切に処理できます。</p><p>FileStorage を有効にすると、Collector は中間状態をディスクに永続化できるため、ネットワークの中断、バックエンドの停止、または Collector の再起動時にもトレース、メトリクス、ログが失われないことが保証されます。つまり、ネットワーク接続が切断されたり、バックエンドが一時的に利用できなくなったりしても、Collector はテレメトリーの受信とバッファリングを継続し、接続が復旧すると配信をシームレスに再開します。</p><p>FileStorage Extension をパイプラインに統合することで、オブザーバビリティスタックの耐久性を強化し、接続が不安定な環境でも高品質なテレメトリー取り込みを維持できます。<details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>このソリューションは、接続ダウンタイムが短い場合（最大15分）のメトリクスに対して機能します。ダウンタイムがこれを超えると、Splunk Observability Cloud はデータポイントの順序が乱れないようにデータをドロップする可能性があります。</p><p>ログについては、今後の Splunk OpenTelemetry Collector リリースで完全なエンタープライズ対応ソリューションを実装する計画があります。</p></div></details></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article><section><h1 class=a11y-only>2. Building Resilienceのサブセクション</h1><article class=default><header class=headline></header><h1 id=21-file-storage-の設定>2.1 File Storage の設定</h1><p>この演習では、<code>agent.yaml</code> ファイルの <code>extensions:</code> セクションを更新します。このセクションは OpenTelemetry 設定 YAML の一部であり、OpenTelemetry Collector の動作を拡張または変更するオプションのコンポーネントを定義します。</p><p>これらのコンポーネントはテレメトリーデータを直接処理しませんが、Collector の機能を向上させる貴重な機能とサービスを提供します。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong><em>すべての</em> ターミナルウィンドウを <code>2-building-resilience</code> ディレクトリに移動し、<code>clear</code> コマンドを実行してください。</strong></p></div></details><p>ディレクトリ構造は以下のようになります</p><div class=tab-panel data-tab-group=R-tabs-078326b341ecca3dc33c992d7b1af088><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4ba6208fb5753687bb71d663a68dd016 aria-expanded=true data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-078326b341ecca3dc33c992d7b1af088","R-tab-5a476a4994a778a4fb1b2011e6c9054c")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-4ba6208fb5753687bb71d663a68dd016 data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong><code>agent.yaml</code> の更新</strong>: <strong>Agent ターミナル</strong> ウィンドウで、既存の <code>health_check</code> Extension の下に <code>file_storage</code> Extension を追加します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage/checkpoint</span><span class=p>:</span><span class=w>             </span><span class=c># Extension Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./checkpoint-dir&#34;</span><span class=w>      </span><span class=c># Define directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>create_directory</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>             </span><span class=c># Create directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>1s                       </span><span class=w> </span><span class=c># Timeout for file operations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>                        </span><span class=c># Compaction settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                   </span><span class=c># Start compaction at Collector startup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Define compaction directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./checkpoint-dir/tmp&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_transaction_size</span><span class=p>:</span><span class=w> </span><span class=m>65536</span><span class=w>      </span><span class=c># Max. size limit before compaction occurs</span></span></span></code></pre></div><p><strong>Exporter への <code>file_storage</code> の追加</strong>: <code>otlphttp</code> Exporter を変更して、リトライとキューイングメカニズムを設定し、障害が発生した場合にデータが保持され再送信されるようにします。<code>endpoint: "http://localhost:5318"</code> の下に以下を追加し、インデントが <code>endpoint</code> と一致していることを確認してください</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>retry_on_failure</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                    </span><span class=c># Enable retry on failure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sending_queue</span><span class=p>:</span><span class=w>                     </span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                    </span><span class=c># Enable sending queue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>num_consumers</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>                </span><span class=c># No. of consumers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>queue_size</span><span class=p>:</span><span class=w> </span><span class=m>10000</span><span class=w>                </span><span class=c># Max. queue size</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>file_storage/checkpoint</span><span class=w> </span><span class=c># File storage extension</span></span></span></code></pre></div><p><strong><code>services</code> セクションの更新</strong>: 既存の <code>extensions:</code> セクションに <code>file_storage/checkpoint</code> Extension を追加します。設定は以下のようになります</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>file_storage/checkpoint           </span><span class=w> </span><span class=c># Enabled extensions for this collector</span></span></span></code></pre></div><p><strong><code>metrics</code> パイプラインの更新</strong>: この演習では、デバッグとログのノイズを減らすために、Metric パイプラインから <code>hostmetrics</code> Receiver をコメントアウトします。設定は以下のようになります</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># - hostmetrics                    # Hostmetric reciever (cpu only)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span></span></span></code></pre></div></div></details><p><strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong> を使用して <strong>Agent</strong> 設定を検証してください。参考までに、パイプラインの <code>metrics:</code> セクションは以下のようになります</p><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP3(&amp;ensp;file&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-metrics
    subgraph &#34; &#34;
      subgraph subID1[**Metrics**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; EXP1
      PRO3 --&gt; EXP3
      PRO3 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=22-耐障害性テスト用の環境セットアップ>2.2 耐障害性テスト用の環境セットアップ</h1><p>次に、<strong>File Storage</strong> 設定をテストする準備として環境を設定します。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gateway の起動</strong>: <strong>Gateway ターミナル</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-1b5f1277161ec25c781235056aa3ab6d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-5df3363892a366c9e792271498d3a4b3 aria-expanded=true data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1b5f1277161ec25c781235056aa3ab6d","R-tab-dc146ad677dc5dd9c26a2a6537f98eb7")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div id=R-tab-id-5df3363892a366c9e792271498d3a4b3 data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Agent の起動</strong>: <strong>Agent ターミナル</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-3a52d2038128da0ef55ecd282ebec883><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-dcd504dd5e841fcfc086e939b67f88e9 aria-expanded=true data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-3a52d2038128da0ef55ecd282ebec883","R-tab-e2d8debf4ffe3bb6331201655f536d9d")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div id=R-tab-id-dcd504dd5e841fcfc086e939b67f88e9 data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>5つのテストスパンを送信</strong>: <strong>Loadgen ターミナル</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-39272ec5bf7ca11a5954b470af8152cb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-6b57c693755f8e6e536620a3b2b881f6 aria-expanded=true data-tab-item=R-tab-5386e98c2a18696103b86ab3f8520915 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-39272ec5bf7ca11a5954b470af8152cb","R-tab-5386e98c2a18696103b86ab3f8520915")'>
<span class=tab-nav-text>Start Load Generator</span></button></div><div class=tab-content-container><div id=R-tab-id-6b57c693755f8e6e536620a3b2b881f6 data-tab-item=R-tab-5386e98c2a18696103b86ab3f8520915 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>5</span></span></span></code></pre></div></div></div></div></div><p><strong>Agent</strong> と <strong>Gateway</strong> の両方がデバッグログを表示し、<strong>Gateway</strong> が <code>./gateway-traces.out</code> ファイルを作成するはずです。</p><p>すべてが正常に機能している場合、システムの耐障害性のテストに進むことができます。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=23-障害のシミュレーション>2.3 障害のシミュレーション</h1><p><strong>Agent</strong> の耐障害性を評価するために、一時的な <strong>Gateway</strong> の停止をシミュレートし、<strong>Agent</strong> がそれをどのように処理するかを観察します</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>ネットワーク障害のシミュレーション</strong>: <strong>Gateway ターミナル</strong> で <code>Ctrl-C</code> を使用して <strong>Gateway</strong> を停止し、Gateway のコンソールが停止したことを示すまで待ちます。<strong>Agent</strong> は引き続き実行されますが、Gateway にデータを送信できません。<strong>Gateway ターミナル</strong> の出力は以下のようになります</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-07-09T10:22:37.941Z        info    service@v0.126.0/service.go:345 Shutdown complete.      {&#34;resource&#34;: {}}</span></span></code></pre></div><p><strong>トレースの送信</strong>: <strong>Loadgen ターミナル</strong> ウィンドウで、<code>loadgen</code> を使用してさらに5つのトレースを送信します。</p><div class=tab-panel data-tab-group=R-tabs-3333e67afbc5b86233fe63be12bc3729><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-fff7e262b49777cec97db8de0f2ffd26 aria-expanded=true data-tab-item=R-tab-5386e98c2a18696103b86ab3f8520915 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-3333e67afbc5b86233fe63be12bc3729","R-tab-5386e98c2a18696103b86ab3f8520915")'>
<span class=tab-nav-text>Start Load Generator</span></button></div><div class=tab-content-container><div id=R-tab-id-fff7e262b49777cec97db8de0f2ffd26 data-tab-item=R-tab-5386e98c2a18696103b86ab3f8520915 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>5</span></span></span></code></pre></div></div></div></div></div><p>Agent のリトライメカニズムが有効になり、データを再送信しようと継続的に試みていることに注目してください。Agent のコンソール出力には、以下のようなメッセージが繰り返し表示されます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T14:22:47.020+0100  info  internal/retry_sender.go:126  Exporting failed. Will retry the request after interval.  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;otlphttp&#34;, &#34;error&#34;: &#34;failed to make an HTTP request: Post \&#34;http://localhost:5318/v1/traces\&#34;: dial tcp 127.0.0.1:5318: connect: connection refused&#34;, &#34;interval&#34;: &#34;9.471474933s&#34;}</span></span></code></pre></div><p><strong>Agent の停止</strong>: <strong>Agent ターミナル</strong> ウィンドウで、<code>Ctrl-C</code> を使用して Agent を停止します。Agent のコンソールが停止を確認するまで待ちます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-07-09T10:25:59.344Z        info    service@v0.126.0/service.go:345 Shutdown complete.      {&#34;resource&#34;: {}}</span></span></code></pre></div></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p>Agent を停止すると、リトライ用にメモリに保持されているメトリクス、トレース、ログは失われます。ただし、FileStorage Extension を設定しているため、ターゲットエンドポイントでまだ受け入れられていないすべてのテレメトリーはディスクに安全にチェックポイントされています。</p><p>Agent の停止は、Agent が再起動されたときにシステムがどのように復旧するかを明確に示すための重要なステップです。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=24-復旧>2.4 復旧</h1><p>この演習では、<strong>Gateway</strong> Collector を再起動することで、<strong>OpenTelemetry Collector</strong> がネットワーク障害からどのように復旧するかをテストします。<strong>Gateway</strong> が再び利用可能になると、<strong>Agent</strong> は最後にチェックポイントされた状態からデータの送信を再開し、データ損失がないことを保証します。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gateway の再起動</strong>: <strong>Gateway ターミナル</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-948651eaf2188193f6c20fd67eeed32b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-33e062084ba7f2ab1b45ec4cd8648537 aria-expanded=true data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-948651eaf2188193f6c20fd67eeed32b","R-tab-dc146ad677dc5dd9c26a2a6537f98eb7")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div id=R-tab-id-33e062084ba7f2ab1b45ec4cd8648537 data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Agent の再起動</strong>: <strong>Agent ターミナル</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-373bb555ff7f6c01953a6140ddf94bde><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4dd207d2e7c0af399442d4002e827f6d aria-expanded=true data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-373bb555ff7f6c01953a6140ddf94bde","R-tab-e2d8debf4ffe3bb6331201655f536d9d")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div id=R-tab-id-4dd207d2e7c0af399442d4002e827f6d data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><blockquote><p><strong>Agent</strong> が起動して実行されると、<strong>File_Storage</strong> Extension がチェックポイントフォルダー内のバッファされたデータを検出します。最後のチェックポイントフォルダーから保存されたスパンをデキューし始め、データが失われないことを保証します。</p></blockquote><p><strong>Agent デバッグ出力の確認:</strong> <strong>Agent</strong> のデバッグ出力は変化<strong>せず</strong>、以下の行を表示し続け、新しいデータがエクスポートされていないことを示していることに注意してください</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-07-11T08:31:58.176Z        info    service@v0.126.0/service.go:289 Everything is ready. Begin running and processing data.   {&#34;resource&#34;: {}}</span></span></code></pre></div><p><strong>Gateway デバッグ出力の確認</strong>
<strong>Gateway</strong> のデバッグ画面から、以前見逃されていたトレースを追加のアクションなしで受信し始めていることが確認できるはずです。例</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>   -&gt; user.name: Str(Luke Skywalker)
</span></span><span class=line><span class=cl>   -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>   -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>   -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>   -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>   -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>   -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>   -&gt; payment.amount: Double(75.75)
</span></span><span class=line><span class=cl>      {&#34;resource&#34;: {}, &#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;}</span></span></code></pre></div><p><strong><code>gateway-traces.out</code> ファイルの確認:</strong> <code>jq</code> を使用して、再作成された <code>gateway-traces.out</code> 内のトレース数をカウントします。<strong>Gateway</strong> がダウンしていたときに送信した数と一致するはずです。</p><div class=tab-panel data-tab-group=R-tabs-9f71f774095cc7679238ab57168c9c14><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b1fa4aafa852a43e20bf9fe4e727e54a aria-expanded=true data-tab-item=R-tab-4e2ba08c3a1a44c321b4ef1ba3812149 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9f71f774095cc7679238ab57168c9c14","R-tab-4e2ba08c3a1a44c321b4ef1ba3812149")'>
<span class=tab-nav-text>Check Gateway Traces Out File</span>
</button>
<button aria-controls=R-tab-id-cdc325db83b17261c1180b376abb547d aria-expanded=false data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9f71f774095cc7679238ab57168c9c14","R-tab-587b796170a9abac4701cd8aa1bb38cb")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div id=R-tab-id-b1fa4aafa852a43e20bf9fe4e727e54a data-tab-item=R-tab-4e2ba08c3a1a44c321b4ef1ba3812149 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans | length | &#34;\(.) resourceSpans found&#34;&#39;</span> gateway-traces.out</span></span></code></pre></div></div></div><div id=R-tab-id-cdc325db83b17261c1180b376abb547d data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;5 resourceSpans found&#34;</span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>Agent</strong> と <strong>Gateway</strong> のプロセスを、それぞれのターミナルで <code>Ctrl-C</code> を押して停止してください。</p></div></details><h3 id=まとめ>まとめ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>この演習では、<code>file_storage</code> Extension の設定、<code>otlp</code> Exporter のリトライメカニズムの有効化、および一時的なデータ保存用のファイルベースのキューの使用により、OpenTelemetry Collector の耐障害性を強化する方法を示しました。</p><p>ファイルベースのチェックポイントとキューの永続化を実装することで、テレメトリーパイプラインが一時的な中断から適切に復旧できることを保証し、本番環境でより堅牢で信頼性の高いものにします。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=3-spanのドロップ>3. Spanのドロップ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>このセクションでは、<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/filterprocessor/README.md rel=external><strong>Filter Processor</strong></a> を使用して、特定の条件に基づいてSpanを選択的にドロップする方法を説明します。</p><p>具体的には、Span名に基づいてトレースをドロップします。これは、ヘルスチェックや内部通信トレースなどの不要なSpanをフィルタリングするためによく使用されます。今回は、ヘルスチェックリクエストに関連付けられることが多く、通常は非常に「<strong>ノイジー</strong>」な <code>"/_healthz"</code> を含むSpanをフィルタリングします。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>すべてのターミナルウィンドウを <code>3-dropping-spans</code> ディレクトリに移動し、<code>clear</code> コマンドを実行してください。</strong></p></div></details><p><code>2-building-resilience</code> ディレクトリから <code>*.yaml</code> を <code>3-dropping-spans</code> にコピーします。更新後のディレクトリ構造は次のようになります</p><div class=tab-panel data-tab-group=R-tabs-1cabf39c90af415d0b83cba66f7b8786><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-5bd96ce1dc1d28a96662813d52c12b3c aria-expanded=true data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1cabf39c90af415d0b83cba66f7b8786","R-tab-5a476a4994a778a4fb1b2011e6c9054c")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-5bd96ce1dc1d28a96662813d52c12b3c data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>次に、<strong>filter processor</strong> と対応するパイプラインを設定します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>3. Spanのドロップのサブセクション</h1><article class=default><header class=headline></header><h1 id=31-設定>3.1 設定</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gateway terminal</strong> ウィンドウに切り替えて、<code>gateway.yaml</code> ファイルを開きます。以下の設定で <code>processors</code> セクションを更新します</p><ol><li><p><strong><code>filter</code> プロセッサを追加する</strong>
<code>/_healthz</code> という名前のSpanを除外するようにGatewayを設定します。<code>error_mode: ignore</code> ディレクティブは、フィルタリング中に発生したエラーを無視し、パイプラインがスムーズに動作し続けることを保証します。<code>traces</code> セクションはフィルタリングルールを定義し、<code>/_healthz</code> という名前のSpanを除外対象として指定します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>filter/health</span><span class=p>:</span><span class=w>                       </span><span class=c># Defines a filter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                </span><span class=w> </span><span class=c># Ignore errors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                            </span><span class=c># Filtering rules for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>span</span><span class=p>:</span><span class=w>                            </span><span class=c># Exclude spans named &#34;/_healthz&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span>- <span class=s1>&#39;name == &#34;/_healthz&#34;&#39;</span></span></span></code></pre></div></li><li><p><strong><code>traces</code> パイプラインに <code>filter</code> プロセッサを追加する</strong>
<code>traces</code> パイプラインに <code>filter/health</code> プロセッサを追加します。最適なパフォーマンスを得るために、フィルターはできるだけ早い段階に配置します。<code>memory_limiter</code> の直後、<code>batch</code> プロセッサの前に配置してください。設定は次のようになります</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filter/health            </span><span class=w> </span><span class=c># Filters data based on rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces</span></span></span></code></pre></div></li></ol><p>この設定により、ヘルスチェック関連のSpan（<code>/_healthz</code>）がパイプラインの早い段階でフィルタリングされ、テレメトリーデータの不要なノイズが削減されます。</p></div></details><p><strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong> を使用してAgent設定を検証します。参考として、パイプラインの <code>traces:</code> セクションは次のようになります</p><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(filter&lt;br&gt;fa:fa-microchip&lt;br&gt;health):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;file&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO4
      PRO4 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=32-filter-processorのテスト>3.2 Filter Processorのテスト</h1><p>設定をテストするには、<code>"/_healthz"</code> という名前のSpanを含むトレースデータを生成する必要があります。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gatewayを起動する</strong>：<strong>Gateway terminal</strong> ウィンドウで <strong>Gateway</strong> を起動します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config ./gateway.yaml</span></span></code></pre></div><p><strong>Agentを起動する</strong>：<strong>Agent terminal</strong> ウィンドウで <strong>Agent</strong> を起動します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config ./agent.yaml</span></span></code></pre></div><p><strong>Loadgenを起動する</strong>：<strong>Loadgen terminal</strong> ウィンドウで、次のコマンドを実行してヘルスチェックSpanを有効にした状態でロードジェネレーターを起動します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -health -count <span class=m>5</span></span></span></code></pre></div><p><strong>Agent terminal</strong> のデバッグ出力に <code>_healthz</code> Spanが表示されます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>InstrumentationScope healthz 1.0.0
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>   Trace ID       : 0cce8759b5921c8f40b346b2f6e2f4b6
</span></span><span class=line><span class=cl>   Parent ID      :
</span></span><span class=line><span class=cl>   ID             : bc32bd0e4ddcb174
</span></span><span class=line><span class=cl>   Name           : /_healthz
</span></span><span class=line><span class=cl>   Kind           : Server
</span></span><span class=line><span class=cl>   Start time     : 2025-07-11 08:47:50.938703979 +0000 UTC
</span></span><span class=line><span class=cl>   End time       : 2025-07-11 08:47:51.938704091 +0000 UTC
</span></span><span class=line><span class=cl>   Status code    : Ok
</span></span><span class=line><span class=cl>   Status message : Success</span></span></code></pre></div><p>これらは、先ほど設定したFilter Processorによってドロップされるため、<strong>Gateway</strong> のデバッグ出力には表示されません。</p><p><strong><code>agent.out</code> を確認する</strong>：<strong>Test terminal</strong> で <code>jq</code> を使用して、<strong>Agent</strong> が受信したSpanの名前を確認します</p><div class=tab-panel data-tab-group=R-tabs-4cb724a19840a231c01d70b9ece643c2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-544fd145199a51c05503b5d89c0d6d93 aria-expanded=true data-tab-item=R-tab-acf06dfba3409686305aa9022a3341eb class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4cb724a19840a231c01d70b9ece643c2","R-tab-acf06dfba3409686305aa9022a3341eb")'>
<span class=tab-nav-text>Check spans in agent.out</span>
</button>
<button aria-controls=R-tab-id-acb6702c4d1b97d366311eb7b331950a aria-expanded=false data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4cb724a19840a231c01d70b9ece643c2","R-tab-587b796170a9abac4701cd8aa1bb38cb")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div id=R-tab-id-544fd145199a51c05503b5d89c0d6d93 data-tab-item=R-tab-acf06dfba3409686305aa9022a3341eb class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[] | &#34;Span \(input_line_number) found with name \(.name)&#34;&#39;</span> ./agent.out</span></span></code></pre></div></div></div><div id=R-tab-id-acb6702c4d1b97d366311eb7b331950a data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 6 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 7 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 8 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 9 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 10 found with name /_healthz&#34;</span></span></code></pre></div></div></div></div></div><p><strong>Gateway のデバッグ出力を確認する</strong>：<code>jq</code> を使用して、<strong>Gateway</strong> が受信したSpanの名前を確認します</p><div class=tab-panel data-tab-group=R-tabs-737f42e7b4aa55157c3fbce4a86fc332><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-970d412724efb6527a51649235b6119b aria-expanded=true data-tab-item=R-tab-a9bb81bd9bb8c45ad95832f29cf5b7e3 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-737f42e7b4aa55157c3fbce4a86fc332","R-tab-a9bb81bd9bb8c45ad95832f29cf5b7e3")'>
<span class=tab-nav-text>Check spans in gateway-traces.out</span>
</button>
<button aria-controls=R-tab-id-f933e905711fbf5efddf27a0c6a2fbc7 aria-expanded=false data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-737f42e7b4aa55157c3fbce4a86fc332","R-tab-587b796170a9abac4701cd8aa1bb38cb")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div id=R-tab-id-970d412724efb6527a51649235b6119b data-tab-item=R-tab-a9bb81bd9bb8c45ad95832f29cf5b7e3 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[] | &#34;Span \(input_line_number) found with name \(.name)&#34;&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div id=R-tab-id-f933e905711fbf5efddf27a0c6a2fbc7 data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><code>gateway-metrics.out</code> ファイルには <code>/_healthz</code> という名前のSpanは含まれません。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with name /movie-validator&#34;</span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Filter Processorで最適なパフォーマンスを確保するには、受信データの形式を十分に理解し、設定を厳密にテストしてください。<strong>できるだけ具体的なフィルタリング条件を使用</strong>して、重要なデータを誤ってドロップするリスクを最小限に抑えてください。</p><p>この設定は、さまざまな属性、タグ、またはカスタム条件に基づいてSpanをフィルタリングするように拡張でき、特定のオブザーバビリティ要件に合わせて OpenTelemetry Collector の柔軟性と効率を向上させることができます。</p></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>Agent</strong> と <strong>Gateway</strong> プロセスを、それぞれのターミナルで <code>Ctrl-C</code> を押して停止してください。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=4-機密データの秘匿化>4. 機密データの秘匿化</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>このセクションでは、OpenTelemetry Collector を設定して、テレメトリーSpanから特定のタグを削除し、機密データを秘匿化する方法を学びます。これは、クレジットカード番号、個人データ、その他のセキュリティ関連の詳細など、処理またはエクスポートする前に匿名化する必要がある機密情報を保護するために重要です。</p><p>OpenTelemetry Collector の主要なプロセッサの設定について説明します</p><ul><li><strong><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/attributesprocessor/README.md rel=external>Attributes Processor</a></strong>：特定のSpan属性を変更または削除します。</li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/redactionprocessor/README.md rel=external><strong>Redaction Processor</strong></a>：機密データが保存または送信される前にサニタイズされることを保証します。</li></ul><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>すべてのターミナルウィンドウを <code>4-sensitive-data</code> ディレクトリに移動し、<code>clear</code> コマンドを実行してください。</strong></p></div></details><p><code>3-dropping-spans</code> ディレクトリから <code>*.yaml</code> を <code>4-sensitive-data</code> にコピーします。更新後のディレクトリ構造は次のようになります</p><div class=tab-panel data-tab-group=R-tabs-c94232565ce7c72637b7c44df28d863d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-e378cf74fc892f8ceb2abaa38395add8 aria-expanded=true data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c94232565ce7c72637b7c44df28d863d","R-tab-5a476a4994a778a4fb1b2011e6c9054c")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-e378cf74fc892f8ceb2abaa38395add8 data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>4. 機密データのサブセクション</h1><article class=default><header class=headline></header><h1 id=41-設定>4.1 設定</h1><p>このステップでは、<code>agent.yaml</code> を修正して <code>attributes</code> と <code>redaction</code> プロセッサを追加します。これらのプロセッサは、Span属性内の機密データがログに記録またはエクスポートされる前に適切に処理されるようにします。</p><p>以前、コンソールに表示されたSpan属性の一部に個人情報や機密データが含まれていることに気づいたかもしれません。これから、この情報を効果的にフィルタリングおよび秘匿化するために必要なプロセッサを設定します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Agent terminal</strong> ウィンドウに切り替えて、エディタで <code>agent.yaml</code> ファイルを開きます。テレメトリーデータのセキュリティとプライバシーを強化するために、2つのプロセッサを追加します。</p><p><strong>1. <code>attributes</code> プロセッサを追加する</strong>：<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/attributesprocessor rel=external><strong>Attributes Processor</strong></a> を使用すると、Span属性（タグ）の値を更新、削除、またはハッシュ化して変更できます。これは、機密情報をエクスポートする前に難読化する場合に特に便利です。</p><p>このステップでは</p><ol><li><code>user.phone_number</code> 属性を静的な値（<code>"UNKNOWN NUMBER"</code>）に<strong>更新</strong>します。</li><li><code>user.email</code> 属性を<strong>ハッシュ化</strong>して、元のメールアドレスが公開されないようにします。</li><li><code>user.password</code> 属性を<strong>削除</strong>して、Spanから完全に取り除きます。</li></ol><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/update</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>                           </span><span class=c># Actions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.phone_number        </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update                </span><span class=w> </span><span class=c># Update action</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UNKNOWN NUMBER&#34;</span><span class=w>        </span><span class=c># New value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.email               </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>hash                  </span><span class=w> </span><span class=c># Hash the email value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.password            </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete                </span><span class=w> </span><span class=c># Delete the password</span></span></span></code></pre></div><p><strong>2. <code>redaction</code> プロセッサを追加する</strong>：<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/redactionprocessor rel=external><strong>Redaction Processor</strong></a> は、クレジットカード番号やその他の個人識別情報（PII）などの定義済みパターンに基づいて、Span属性内の機密データを検出して秘匿化します。</p><p>このステップでは</p><ul><li><p>すべての属性が処理されるように <code>allow_all_keys: true</code> を設定します（<code>false</code> に設定すると、明示的に許可されたキーのみが保持されます）。</p></li><li><p><strong>Visa</strong> と <strong>MasterCard</strong> のクレジットカード番号を検出して秘匿化するための正規表現を <code>blocked_values</code> で定義します。</p></li><li><p><code>summary: debug</code> オプションは、デバッグ目的で秘匿化プロセスに関する詳細情報をログに記録します。</p></li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>redaction/redact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>allow_all_keys</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>               </span><span class=c># If false, only allowed keys will be retained</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>blocked_values</span><span class=p>:</span><span class=w>                    </span><span class=c># List of regex patterns to block</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b4[0-9]{3}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>       </span><span class=c># Visa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b5[1-5][0-9]{2}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>  </span><span class=c># MasterCard</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>debug                    </span><span class=w> </span><span class=c># Show debug details about redaction</span></span></span></code></pre></div><p><strong><code>traces</code> パイプラインを更新する</strong>：両方のプロセッサを <code>traces</code> パイプラインに統合します。最初は redaction プロセッサをコメントアウトしておいてください（後の演習で有効にします）。設定は次のようになります</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- redaction/redact               # Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></details><p><strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong> を使用してAgent設定を検証します。参考として、パイプラインの <code>traces:</code> セクションは次のようになります</p><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRML(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRRD(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRRS(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRUP(attributes&lt;br&gt;fa:fa-microchip&lt;br&gt;update):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;debug&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP3(file&lt;br&gt;fa:fa-upload):::exporter

    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRML
      PRML --&gt; PRUP
      PRUP --&gt; PRRD
      PRRD --&gt; PRRS
      PRRS --&gt; EXP2
      PRRS --&gt; EXP3
      PRRS --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=42-attribute-processorのテスト>4.2 Attribute Processorのテスト</h1><p>この演習では、<strong>Agent</strong> がエクスポートする前に、Spanデータから <code>user.account_password</code> を<strong>削除</strong>し、<code>user.phone_number</code> <strong>属性</strong>を<strong>更新</strong>し、<code>user.email</code> を<strong>ハッシュ化</strong>します。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gatewayを起動する</strong>：<strong>Gateway terminal</strong> ウィンドウで <strong>Gateway</strong> を起動します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div><p><strong>Agentを起動する</strong>：<strong>Agent terminal</strong> ウィンドウで <strong>Agent</strong> を起動します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p><strong>Load Generatorを起動する</strong>：<strong>Loadgen terminal</strong> ウィンドウで <code>loadgen</code> を起動します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p><strong>デバッグ出力を確認する</strong>：<strong>Agent</strong> と <strong>Gateway</strong> の両方で、<code>user.account_password</code> が削除され、<code>user.phone_number</code> と <code>user.email</code> が更新されていることを確認します</p><div class=tab-panel data-tab-group=R-tabs-c26d1759f254f9079c993de8d6b36a5b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-720e250a31cabe33783d0ff0e942457c aria-expanded=true data-tab-item=R-tab-544b1806b43b802fec2d6ad565a4b9ad class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c26d1759f254f9079c993de8d6b36a5b","R-tab-544b1806b43b802fec2d6ad565a4b9ad")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button aria-controls=R-tab-id-872c41d281858715cec5e1398c81502b aria-expanded=false data-tab-item=R-tab-8269dab52767aefab4c11aaa5d8bb8c8 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c26d1759f254f9079c993de8d6b36a5b","R-tab-8269dab52767aefab4c11aaa5d8bb8c8")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div id=R-tab-id-720e250a31cabe33783d0ff0e942457c data-tab-item=R-tab-544b1806b43b802fec2d6ad565a4b9ad class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>   -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>   -&gt; user.phone_number: Str(UNKNOWN NUMBER)
</span></span><span class=line><span class=cl>   -&gt; user.email: Str(62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287)
</span></span><span class=line><span class=cl>   -&gt; payment.amount: Double(51.71)
</span></span><span class=line><span class=cl>   -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>   -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>   -&gt; user.mastercard: Str(5555 5555 5555 4444)</span></span></code></pre></div></div></div><div id=R-tab-id-872c41d281858715cec5e1398c81502b data-tab-item=R-tab-8269dab52767aefab4c11aaa5d8bb8c8 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>    -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>    -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>    -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>    -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>    -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>    -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>    -&gt; payment.amount: Double(95.22)</span></span></code></pre></div></div></div></div></div><p><strong>ファイル出力を確認する</strong>：<code>jq</code> を使用して、<code>gateway-traces.out</code> で <code>user.account_password</code> が削除され、<code>user.phone_number</code> と <code>user.email</code> が更新されていることを検証します</p><div class=tab-panel data-tab-group=R-tabs-724276c3d09189ed6ae989f323536487><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-ca101bbf3af860288da4db361a2f1588 aria-expanded=true data-tab-item=R-tab-a1f23743b82743728073a9be5706f4e0 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-724276c3d09189ed6ae989f323536487","R-tab-a1f23743b82743728073a9be5706f4e0")'>
<span class=tab-nav-text>Validate attribute changes</span>
</button>
<button aria-controls=R-tab-id-0bb87720326bc75f9bc30155250638b4 aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-724276c3d09189ed6ae989f323536487","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-ca101bbf3af860288da4db361a2f1588 data-tab-item=R-tab-a1f23743b82743728073a9be5706f4e0 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[].attributes[] | select(.key == &#34;user.password&#34; or .key == &#34;user.phone_number&#34; or .key == &#34;user.email&#34;) | {key: .key, value: .value.stringValue}&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div id=R-tab-id-0bb87720326bc75f9bc30155250638b4 data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><code>user.account_password</code> が削除され、<code>user.phone_number</code> と <code>user.email</code> が更新されていることに注目してください</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;UNKNOWN NUMBER&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>Agent</strong> と <strong>Gateway</strong> プロセスを、それぞれのターミナルで <code>Ctrl-C</code> を押して停止してください。</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=43-redaction-processorのテスト>4.3 Redaction Processorのテスト</h1><p><code>redaction</code> プロセッサは、テレメトリーデータからどの属性と値を<strong>許可</strong>または<strong>削除</strong>するかを正確に制御できます。</p><p>この演習では、<strong>Agent</strong> がエクスポートする前に、Spanデータの <code>user.visa</code> と <code>user.mastercard</code> の値を<strong>秘匿化</strong>します。<details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gatewayを起動する</strong>：<strong>Gateway terminal</strong> ウィンドウで <strong>Gateway</strong> を起動します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div><p><strong><code>redaction/redact</code> プロセッサを有効にする</strong>：<strong>Agent terminal</strong> ウィンドウで、<code>agent.yaml</code> を編集して前の演習で追加した <code>#</code> を削除します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redaction/redact              </span><span class=w> </span><span class=c># Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div><p><strong>Agentを起動する</strong>：<strong>Agent terminal</strong> ウィンドウで <strong>Agent</strong> を起動します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p><strong>Load Generatorを起動する</strong>：<strong>Loadgen terminal</strong> ウィンドウで <code>loadgen</code> を起動します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p><strong>デバッグ出力を確認する</strong>：<strong>Agent</strong> と <strong>Gateway</strong> の両方で、<code>user.visa</code> と <code>user.mastercard</code> の値が更新されていることを確認します。<code>user.amex</code> 属性の値は、<code>blocked_values</code> に一致する正規表現パターンが追加されていないため、秘匿化されて<strong>いない</strong>ことに注意してください。</p><div class=tab-panel data-tab-group=R-tabs-8ab32905cf042e9cfb244562e2d76d80><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-8b75f02107cfc2757921e823dc7cd24a aria-expanded=true data-tab-item=R-tab-544b1806b43b802fec2d6ad565a4b9ad class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-8ab32905cf042e9cfb244562e2d76d80","R-tab-544b1806b43b802fec2d6ad565a4b9ad")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button aria-controls=R-tab-id-43fca39c7abbdc637cc7c395e37d3668 aria-expanded=false data-tab-item=R-tab-8269dab52767aefab4c11aaa5d8bb8c8 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-8ab32905cf042e9cfb244562e2d76d80","R-tab-8269dab52767aefab4c11aaa5d8bb8c8")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div id=R-tab-id-8b75f02107cfc2757921e823dc7cd24a data-tab-item=R-tab-544b1806b43b802fec2d6ad565a4b9ad class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>   -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>   -&gt; user.phone_number: Str(UNKNOWN NUMBER)
</span></span><span class=line><span class=cl>   -&gt; user.email: Str(62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287)
</span></span><span class=line><span class=cl>   -&gt; payment.amount: Double(69.71)
</span></span><span class=line><span class=cl>   -&gt; user.visa: Str(****)
</span></span><span class=line><span class=cl>   -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>   -&gt; user.mastercard: Str(****)
</span></span><span class=line><span class=cl>   -&gt; redaction.masked.keys: Str(user.mastercard,user.visa)
</span></span><span class=line><span class=cl>   -&gt; redaction.masked.count: Int(2)</span></span></code></pre></div></div></div><div id=R-tab-id-43fca39c7abbdc637cc7c395e37d3668 data-tab-item=R-tab-8269dab52767aefab4c11aaa5d8bb8c8 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>    -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>    -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>    -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>    -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>    -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>    -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>    -&gt; payment.amount: Double(65.54)</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>redaction プロセッサに <code>summary:debug</code> を含めると、デバッグ出力に、どの一致するキー値が秘匿化されたか、およびマスクされた値の数に関するサマリー情報が含まれます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>     -&gt; redaction.masked.keys: Str(user.mastercard,user.visa)
</span></span><span class=line><span class=cl>     -&gt; redaction.masked.count: Int(2)</span></span></code></pre></div></div></details><p><strong>ファイル出力を確認する</strong>：<code>jq</code> を使用して、<code>gateway-traces.out</code> で <code>user.visa</code> と <code>user.mastercard</code> が更新されていることを検証します。</p><div class=tab-panel data-tab-group=R-tabs-c070f8c32a086e83bda2cd113c1f8512><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b589591988b39fec6c794b04d92ba878 aria-expanded=true data-tab-item=R-tab-a1f23743b82743728073a9be5706f4e0 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c070f8c32a086e83bda2cd113c1f8512","R-tab-a1f23743b82743728073a9be5706f4e0")'>
<span class=tab-nav-text>Validate attribute changes</span>
</button>
<button aria-controls=R-tab-id-aa72777a4f06776f8f1bc800f651e25a aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c070f8c32a086e83bda2cd113c1f8512","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-b589591988b39fec6c794b04d92ba878 data-tab-item=R-tab-a1f23743b82743728073a9be5706f4e0 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[].attributes[] | select(.key == &#34;user.visa&#34; or .key == &#34;user.mastercard&#34; or .key == &#34;user.amex&#34;) | {key: .key, value: .value.stringValue}&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div id=R-tab-id-aa72777a4f06776f8f1bc800f651e25a data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><code>blocked_values</code> に一致する正規表現パターンが追加されていないため、<code>user.amex</code> は秘匿化されていないことに注意してください</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;****&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;****&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>これらは、<code>attributes</code> と <code>redaction</code> プロセッサを設定して機密データを保護する方法のほんの一例です。</p></div></details></p><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>Agent</strong> と <strong>Gateway</strong> プロセスを、それぞれのターミナルで <code>Ctrl-C</code> を押して停止してください。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=5-transform-data>5. Transform Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/transformprocessor/README.md rel=external><strong>Transform Processor</strong></a> を使用すると、パイプラインを流れるテレメトリデータ（ログ、メトリクス、トレース）を変更できます。<strong>OpenTelemetry Transformation Language (OTTL)</strong> を使用して、アプリケーションコードを変更することなく、データのフィルタリング、エンリッチメント、変換をその場で行うことができます。</p><p>この演習では、<code>gateway.yaml</code> を更新して、次の処理を行う <strong>Transform Processor</strong> を追加します</p><ul><li>ログリソース属性の <strong>フィルタリング</strong></li><li>JSON構造化ログデータの属性への <strong>パース</strong></li><li>ログメッセージ本文に基づくログ重大度レベルの <strong>設定</strong></li></ul><p>以前のログで <code>SeverityText</code> や <code>SeverityNumber</code> が未定義だったことにお気づきかもしれません。これは <code>filelog</code> レシーバーの典型的な動作です。ただし、重大度はログ本文内に埋め込まれています。例</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-01-31 15:49:29 [WARN] - Do or do not, there is no try.)</span></span></code></pre></div><p>ログには、ログ本文内にJSONとしてエンコードされた構造化データが含まれていることがよくあります。これらのフィールドを属性として抽出することで、インデックス作成、フィルタリング、クエリの効率が向上します。下流のシステムで手動でJSONをパースする代わりに、OTTLを使用してテレメトリパイプラインレベルで自動的に変換できます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>すべてのターミナルウィンドウを <code>5-transform-data</code> ディレクトリに移動し、<code>clear</code> コマンドを実行してください。</strong></p></div></details><p><code>4-sensitve-data</code> ディレクトリから <code>*.yaml</code> を <code>5-transform-data</code> にコピーします。更新後のディレクトリ構造は次のようになります</p><div class=tab-panel data-tab-group=R-tabs-9398e47eaade945cea77d5a20b1e994d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-6284c020af943df6ddc0628e11d39464 aria-expanded=true data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9398e47eaade945cea77d5a20b1e994d","R-tab-5a476a4994a778a4fb1b2011e6c9054c")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-6284c020af943df6ddc0628e11d39464 data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>5. Transform Dataのサブセクション</h1><article class=default><header class=headline></header><h1 id=51-configuration>5.1 Configuration</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong><code>transform</code> プロセッサーを追加する</strong>: <strong>Gateway terminal</strong> ウィンドウに切り替え、<code>gateway.yaml</code> を編集して次の <code>transform</code> プロセッサーを追加します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>transform/logs</span><span class=p>:</span><span class=w>                      </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>log_statements</span><span class=p>:</span><span class=w>                    </span><span class=c># Log Processing Statements</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>resource             </span><span class=w> </span><span class=c># Log Context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statements</span><span class=p>:</span><span class=w>                    </span><span class=c># List of attribute keys to keep</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>keep_keys(attributes, [&#34;com.splunk.sourcetype&#34;, &#34;host.name&#34;, &#34;otelcol.service.mode&#34;])</span></span></span></code></pre></div><p><code>-context: resource</code> キーを使用することで、ログの <code>resourceLog</code> 属性をターゲットにしています。</p><p>この設定により、関連するリソース属性（<code>com.splunk.sourcetype</code>、<code>host.name</code>、<code>otelcol.service.mode</code>）のみが保持され、ログの効率が向上し、不要なメタデータが削減されます。</p><p><strong>ログ重大度マッピング用のコンテキストブロックを追加する</strong>: ログレコードの <code>severity_text</code> と <code>severity_number</code> フィールドを適切に設定するために、<code>log_statements</code> 内に <code>log</code> コンテキストブロックを追加します。この設定では、ログ本文から <code>level</code> 値を抽出し、<code>severity_text</code> にマッピングし、ログレベルに基づいて対応する <code>severity_number</code> を割り当てます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>      </span>- <span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>log                  </span><span class=w> </span><span class=c># Log Context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statements</span><span class=p>:</span><span class=w>                    </span><span class=c># Transform Statements Array</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(cache, ParseJSON(body)) where IsMatch(body, &#34;^\\{&#34;) </span><span class=w> </span><span class=c># Parse JSON log body into a cache object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>flatten(cache, &#34;&#34;)                                       </span><span class=w> </span><span class=c># Flatten nested JSON structure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>merge_maps(attributes, cache, &#34;upsert&#34;)                  </span><span class=w> </span><span class=c># Merge cache into attributes, updating existing keys</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_text, attributes[&#34;level&#34;])                  </span><span class=w> </span><span class=c># Set severity_text from the &#34;level&#34; attribute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 1) where severity_text == &#34;TRACE&#34;   </span><span class=w> </span><span class=c># Map severity_text to severity_number</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 5) where severity_text == &#34;DEBUG&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 9) where severity_text == &#34;INFO&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 13) where severity_text == &#34;WARN&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 17) where severity_text == &#34;ERROR&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 21) where severity_text == &#34;FATAL&#34;</span></span></span></code></pre></div><p><code>merge_maps</code> 関数は、2つのマップ（辞書）を1つに結合するために使用されます。この場合、<code>cache</code> オブジェクト（ログ本文からパースされたJSONデータを含む）を <code>attributes</code> マップにマージします。</p><ul><li><strong>パラメータ</strong>:<ul><li><code>attributes</code>: データがマージされるターゲットマップ</li><li><code>cache</code>: パースされたJSONデータを含むソースマップ</li><li><code>"upsert"</code>: このモードは、<code>attributes</code> マップにすでにキーが存在する場合、その値が <code>cache</code> の値で更新されることを保証します。キーが存在しない場合は、挿入されます。</li></ul></li></ul><p>このステップは、ログ本文からのすべての関連フィールド（例：<code>level</code>、<code>message</code> など）が <code>attributes</code> マップに追加され、さらなる処理やエクスポートで利用可能になることを保証するため、非常に重要です。</p><p><strong>主要な変換の概要</strong>:</p><ul><li><strong>Parse JSON</strong>: ログ本文から構造化データを抽出します。</li><li><strong>Flatten JSON</strong>: ネストされたJSONオブジェクトをフラットな構造に変換します。</li><li><strong>Merge Attributes</strong>: 抽出されたデータをログ属性に統合します。</li><li><strong>Map Severity Text</strong>: ログの level 属性から severity_text を割り当てます。</li><li><strong>Assign Severity Numbers</strong>: 重大度レベルを標準化された数値に変換します。</li></ul><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><code>resource</code> 用のコンテキストブロックと <code>log</code> 用のコンテキストブロックの2つを含む <strong>単一の</strong> <code>transform</code> プロセッサーが必要です。</p></div></details><p>この設定により、ログの重大度が正しく抽出、標準化され、効率的な処理のために構造化されます。</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>すべてのJSONフィールドをトップレベルの属性にマッピングするこの方法は、<strong>OTTLのテストとデバッグ</strong>のみに使用してください。本番環境では高いカーディナリティが発生します。</p></div></details><p><strong><code>logs</code> パイプラインを更新する</strong>: <code>logs:</code> パイプラインに <code>transform/logs:</code> プロセッサーを追加し、設定が次のようになるようにします</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>                         </span><span class=c># Logs pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>transform/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/logs</span></span></span></code></pre></div></div></details><p><a href=https://otelbin.io/ rel=external><strong>https://otelbin.io</strong></a> を使用して Agent の設定を検証します。参考として、パイプラインの <code>logs:</code> セクションは次のようになります</p><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(transform&lt;br&gt;fa:fa-microchip&lt;br&gt;logs):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(file&lt;br&gt;fa:fa-upload&lt;br&gt;logs):::exporter
      EXP2(&amp;ensp;&amp;ensp;debug&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; PRO5
      PRO5 --&gt; EXP2
      PRO5 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=52-setup-environment>5.2 Setup Environment</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gateway を起動する</strong>: <strong>Gateway terminal</strong> で以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-4a4608370991af33b04c4d326cabedb6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2dfd5a5b2d9d0c001e84e613968816b5 aria-expanded=true data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4a4608370991af33b04c4d326cabedb6","R-tab-dc146ad677dc5dd9c26a2a6537f98eb7")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div id=R-tab-id-2dfd5a5b2d9d0c001e84e613968816b5 data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Agent を起動する</strong>: <strong>Agent terminal</strong> で以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-ca561e3de257992de7c615e52f6914c6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-e169c3565eb4357714c3524fc24aa172 aria-expanded=true data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-ca561e3de257992de7c615e52f6914c6","R-tab-e2d8debf4ffe3bb6331201655f536d9d")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div id=R-tab-id-e169c3565eb4357714c3524fc24aa172 data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Load Generator を起動する</strong>: <strong>Loadgen terminal</strong> ウィンドウで、次のコマンドを実行して <strong>JSON を有効</strong>にした Load Generator を起動します</p><div class=tab-panel data-tab-group=R-tabs-7b3765c98adf026f742e1dac4e12d8a6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-92718289adda51577b2c0d17fb50f1d6 aria-expanded=true data-tab-item=R-tab-f39d270d077420f218253d70fb4d013a class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-7b3765c98adf026f742e1dac4e12d8a6","R-tab-f39d270d077420f218253d70fb4d013a")'>
<span class=tab-nav-text>Log Generator</span></button></div><div class=tab-content-container><div id=R-tab-id-92718289adda51577b2c0d17fb50f1d6 data-tab-item=R-tab-f39d270d077420f218253d70fb4d013a class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -logs -json -count <span class=m>5</span></span></span></code></pre></div></div></div></div></div><p><code>loadgen</code> は JSON 形式で 5 行のログを <code>./quotes.log</code> に書き込みます。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=53-test-transform-processor>5.3 Test Transform Processor</h1><p>このテストでは、<strong>Agent</strong> によってエクスポートされる前に、<code>com.splunk/source</code> と <code>os.type</code> のメタデータがログリソース属性から <strong>削除</strong> されていることを確認します。さらに、このテストでは以下を確認します</p><ol><li>重大度情報を抽出するためにログ本文がパースされていること<ul><li><code>SeverityText</code> と <code>SeverityNumber</code> が <code>LogRecord</code> に設定されていること</li></ul></li><li>ログ本文の JSON フィールドがログ <code>attributes</code> に昇格していること</li></ol><p>これにより、エクスポート前に適切なメタデータフィルタリング、重大度マッピング、および構造化ログのエンリッチメントが行われることが保証されます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>デバッグ出力を確認する</strong>: <strong>Agent</strong> と <strong>Gateway</strong> の両方で、<code>com.splunk/source</code> と <code>os.type</code> が削除されていることを確認します</p><div class=tab-panel data-tab-group=R-tabs-3451b8ee4d4c076afe4ff7a07aacad7a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b2c276ef55a46af3b39852789b93e50d aria-expanded=true data-tab-item=R-tab-e35301d59bcd0f79d44c5c0a86f077c6 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-3451b8ee4d4c076afe4ff7a07aacad7a","R-tab-e35301d59bcd0f79d44c5c0a86f077c6")'>
<span class=tab-nav-text>Gateway Debug Output</span>
</button>
<button aria-controls=R-tab-id-ebbc45c087dfb5075534e1039329a7ea aria-expanded=false data-tab-item=R-tab-42538fea3c4f3a8e2d3b752dbdb349e9 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-3451b8ee4d4c076afe4ff7a07aacad7a","R-tab-42538fea3c4f3a8e2d3b752dbdb349e9")'>
<span class=tab-nav-text>Agent Debug Output</span></button></div><div class=tab-content-container><div id=R-tab-id-b2c276ef55a46af3b39852789b93e50d data-tab-item=R-tab-e35301d59bcd0f79d44c5c0a86f077c6 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>   -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>   -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>   -&gt; otelcol.service.mode: Str(agent)</span></span></code></pre></div></div></div><div id=R-tab-id-ebbc45c087dfb5075534e1039329a7ea data-tab-item=R-tab-42538fea3c4f3a8e2d3b752dbdb349e9 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>   -&gt; com.splunk.source: Str(./quotes.log)
</span></span><span class=line><span class=cl>   -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>   -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>   -&gt; os.type: Str(linux)
</span></span><span class=line><span class=cl>   -&gt; otelcol.service.mode: Str(agent)</span></span></code></pre></div></div></div></div></div><p><strong>Agent</strong> と <strong>Gateway</strong> の両方で、<code>LogRecord</code> の <code>SeverityText</code> と <code>SeverityNumber</code> がログ本文の重大度 <code>level</code> で定義されていることを確認します。また、本文の JSON フィールドがトップレベルのログ <code>Attributes</code> としてアクセスできることを確認します</p><div class=tab-panel data-tab-group=R-tabs-7b19b7f39ff6bfc0161c345e71dfe699><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-68863f8721ac4bc03a9c6f644cb8b4a7 aria-expanded=true data-tab-item=R-tab-e35301d59bcd0f79d44c5c0a86f077c6 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-7b19b7f39ff6bfc0161c345e71dfe699","R-tab-e35301d59bcd0f79d44c5c0a86f077c6")'>
<span class=tab-nav-text>Gateway Debug Output</span>
</button>
<button aria-controls=R-tab-id-3c1cc762d9c2f35275115f711751d79d aria-expanded=false data-tab-item=R-tab-ead80b063f3a982e1fec2398ed5eb0e3 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-7b19b7f39ff6bfc0161c345e71dfe699","R-tab-ead80b063f3a982e1fec2398ed5eb0e3")'>
<span class=tab-nav-text>Agemt Debug Output</span></button></div><div class=tab-content-container><div id=R-tab-id-68863f8721ac4bc03a9c6f644cb8b4a7 data-tab-item=R-tab-e35301d59bcd0f79d44c5c0a86f077c6 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>SeverityText: WARN
</span></span><span class=line><span class=cl>SeverityNumber: Warn(13)
</span></span><span class=line><span class=cl>Body: Str({&#34;level&#34;:&#34;WARN&#34;,&#34;message&#34;:&#34;Your focus determines your reality.&#34;,&#34;movie&#34;:&#34;SW&#34;,&#34;timestamp&#34;:&#34;2025-03-07 11:17:26&#34;})
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>     -&gt; level: Str(WARN)
</span></span><span class=line><span class=cl>     -&gt; message: Str(Your focus determines your reality.)
</span></span><span class=line><span class=cl>     -&gt; movie: Str(SW)
</span></span><span class=line><span class=cl>     -&gt; timestamp: Str(2025-03-07 11:17:26)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div></div></div><div id=R-tab-id-3c1cc762d9c2f35275115f711751d79d data-tab-item=R-tab-ead80b063f3a982e1fec2398ed5eb0e3 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str({&#34;level&#34;:&#34;WARN&#34;,&#34;message&#34;:&#34;Your focus determines your reality.&#34;,&#34;movie&#34;:&#34;SW&#34;,&#34;timestamp&#34;:&#34;2025-03-07 11:17:26&#34;})
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div></div></div></div></div><p><strong>ファイル出力を確認する</strong>: 新しい <code>gateway-logs.out</code> ファイルでデータが変換されていることを確認します</p><div class=tab-panel data-tab-group=R-tabs-2958839889315d52b404e5d5696cb0d6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-e9d730a2a819e6f4a0c3f529528941a3 aria-expanded=true data-tab-item=R-tab-58659ac8bbb7a3ec80b7df1029812298 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-2958839889315d52b404e5d5696cb0d6","R-tab-58659ac8bbb7a3ec80b7df1029812298")'>
<span class=tab-nav-text>jq Query</span>
</button>
<button aria-controls=R-tab-id-9f607ddf6f8366f1173d9c652ab3caff aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-2958839889315d52b404e5d5696cb0d6","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-e9d730a2a819e6f4a0c3f529528941a3 data-tab-item=R-tab-58659ac8bbb7a3ec80b7df1029812298 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;[.resourceLogs[].scopeLogs[].logRecords[] | {severityText, severityNumber, body: .body.stringValue}]&#39;</span> gateway-logs.out</span></span></code></pre></div></div></div><div id=R-tab-id-9f607ddf6f8366f1173d9c652ab3caff data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;DEBUG\&#34;,\&#34;message\&#34;:\&#34;All we have to decide is what to do with the time that is given us.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;WARN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>13</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;WARN\&#34;,\&#34;message\&#34;:\&#34;The Force will be with you. Always.\&#34;,\&#34;movie\&#34;:\&#34;SW\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>17</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;ERROR\&#34;,\&#34;message\&#34;:\&#34;One does not simply walk into Mordor.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;DEBUG\&#34;,\&#34;message\&#34;:\&#34;Do or do not, there is no try.\&#34;,\&#34;movie\&#34;:\&#34;SW\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>17</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;ERROR\&#34;,\&#34;message\&#34;:\&#34;There is some good in this world, and it&#39;s worth fighting for.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p>それぞれのターミナルで <code>Ctrl-C</code> を押して、<strong>Agent</strong> と <strong>Gateway</strong> のプロセスを停止してください。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=6-routing-data>6. Routing Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>OpenTelemetry の <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/routingconnector rel=external><strong>Routing Connector</strong></a> は、特定の条件に基づいてデータ（<code>traces</code>、<code>metrics</code>、または <code>logs</code>）を異なるパイプライン/宛先に振り分けることができる強力な機能です。これは、テレメトリデータのサブセットに異なる処理やエクスポートロジックを適用したい場合に特に有用です。</p><p>例えば、<em>本番環境</em> のデータを1つのエクスポーターに送信し、<em>テスト</em> や <em>開発</em> のデータを別のエクスポーターに振り分けることができます。同様に、サービス名、環境、スパン名などの属性に基づいて特定のスパンをルーティングし、カスタムの処理やストレージロジックを適用することもできます。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>すべてのターミナルウィンドウを <code>6-routing-data</code> ディレクトリに移動し、<code>clear</code> コマンドを実行してください。</strong></p></div></details><p><code>5-transform-data</code> ディレクトリから <code>*.yaml</code> を <code>6-routing-data</code> にコピーします。更新後のディレクトリ構造は次のようになります</p><div class=tab-panel data-tab-group=R-tabs-c69023946c717860fe91e208326329d2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-cfd5909873bb6f2dbe4ada60accf020f aria-expanded=true data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c69023946c717860fe91e208326329d2","R-tab-5a476a4994a778a4fb1b2011e6c9054c")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-cfd5909873bb6f2dbe4ada60accf020f data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>次に、Routing Connector とそれぞれのパイプラインを設定します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>6. Routing Dataのサブセクション</h1><article class=default><header class=headline></header><h1 id=61-configure-the-routing-connector>6.1 Configure the Routing Connector</h1><p>この演習では、<code>gateway.yaml</code> で <strong>Routing Connector</strong> を設定します。Routing Connector はメトリクス、トレース、ログを任意の属性に基づいてルーティングできますが、ここでは <code>deployment.environment</code> 属性に基づくトレースルーティングに焦点を当てます（ただし、任意のスパン/ログ/メトリクス属性を使用できます）。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>新しい <code>file</code> エクスポーターを追加する</strong>: <code>routing</code> コネクターには、ルーティング用に異なるターゲットが必要です。<strong>Gateway terminal</strong> で、<code>gateway.yaml</code> の <code>exporters</code> セクションに 2 つの新しいファイルエクスポーター <code>file/traces/route1-regular</code> と <code>file/traces/route2-security</code> を作成し、データが正しく振り分けられるようにします</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/route1-regular</span><span class=p>:</span><span class=w>                     </span><span class=c># Exporter for regular traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-route1-regular.out&#34;</span><span class=w>   </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/route2-security</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter for security traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-route2-security.out&#34;</span><span class=w>  </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                                 </span><span class=c># Overwrite the file each time</span></span></span></code></pre></div><p><strong>ルーティングを有効にする</strong>: <code>routing</code> コネクターを追加します。OpenTelemetry の設定ファイルでは、<code>connectors</code> はレシーバーやプロセッサーと同様に専用のセクションを持っています。</p><p><code>#connectors:</code> セクションを見つけてコメントを解除します。次に、<code>connectors:</code> セクションの下に以下を追加します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>routing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default_pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/route1-regular] </span><span class=w> </span><span class=c># Default pipeline if no rule matches</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                         </span><span class=w> </span><span class=c># Ignore errors in routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w>                                      </span><span class=c># Define routing rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Routes spans to a target pipeline if the resourceSpan attribute matches the rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>statement</span><span class=p>:</span><span class=w> </span><span class=l>route() where attributes[&#34;deployment.environment&#34;] == &#34;security-applications&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/route2-security]    </span><span class=w> </span><span class=c># Security target pipeline</span></span></span></code></pre></div></div></details><p>設定ファイルのデフォルトパイプラインは、キャッチオールとして機能します。ルーティングルールテーブルのルールに一致しないすべてのデータ（この場合はスパン）のルーティング先となります。このテーブルには、<code>["deployment.environment"] == "security-applications"</code> ルールに一致するスパンのターゲットパイプラインが定義されています。</p><p><code>routing</code> の設定が完了したら、次のステップはこれらのルーティングルールを適用する <code>pipelines</code> を設定することです。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=62-configuring-the-pipelines>6.2 Configuring the Pipelines</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>元の <code>traces</code> パイプラインをルーティングを使用するように更新する</strong>:</p><ol><li><p><code>routing</code> を有効にするには、元の <code>traces</code> パイプラインを更新して、<code>routing</code> のみをエクスポーターとして使用します。これにより、すべてのスパンデータが <strong>Routing Connector</strong> を経由して評価され、接続されたパイプラインに転送されます。また、<strong>すべての</strong> プロセッサーを削除し、空の配列（<code>[]</code>）に置き換えます。これは、<code>traces/route1-regular</code> と <code>traces/route2-security</code> パイプラインで処理されるようになり、各ルートに対してカスタム動作が可能になるためです。<code>traces:</code> の設定は次のようになります</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>traces</span><span class=p>:</span><span class=w>                       </span><span class=c># Traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>              </span><span class=c># Processors for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>routing</span></span></span></code></pre></div></li></ol><p><strong>既存の <code>traces</code> パイプラインの下に <code>route1-regular</code> と <code>route2-security</code> の両方のトレースパイプラインを追加する</strong>:</p><ol><li><p><strong>Route1-regular パイプラインを設定する</strong>: このパイプラインは、コネクターのルーティングテーブルに<strong>一致しない</strong>すべてのスパンを処理します。
これは唯一のレシーバーとして <code>routing</code> を使用し、元の traces パイプラインからの <code>connection</code> を通じてデータを受信することに注意してください。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/route1-regular</span><span class=p>:</span><span class=w>         </span><span class=c># Default pipeline for unmatched spans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                   </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter            </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode         </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                     </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/route1-regular</span><span class=w> </span><span class=c># File Exporter for unmatched spans</span></span></span></code></pre></div></li><li><p><strong>route2-security パイプラインを追加する</strong>: このパイプラインは、ルーティングルールの <code>"[deployment.environment"] == "security-applications"</code> ルールに一致するすべてのスパンを処理します。このパイプラインもレシーバーとして <code>routing</code> を使用しています。このパイプラインを <code>traces/route1-regular</code> の下に追加します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/route2-security</span><span class=p>:</span><span class=w>         </span><span class=c># Default pipeline for unmatched spans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                    </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter             </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode          </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                      </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/route2-security</span><span class=w> </span><span class=c># File exporter for unmatched spans</span></span></span></code></pre></div></li></ol></div></details><p><strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong> を使用して Agent の設定を検証します。参考として、パイプラインの <code>traces:</code> セクションは次のようになります</p><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      PRO6(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
      EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP4(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
      ROUTE1(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-export
      ROUTE2(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
      ROUTE3(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
    %% Links
    subID1:::sub-traces
    subID2:::sub-traces
    subID3:::sub-traces
    subgraph &#34; &#34;
    direction LR
      subgraph subID1[**Traces**]
      REC1 --&gt; ROUTE1
      end
      subgraph subID2[**Traces/route2-security**]
      ROUTE1 --&gt; ROUTE2
      ROUTE2 --&gt; PRO1
      PRO1 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
      subgraph subID3[**Traces/route1-regular**]
      ROUTE1 --&gt; ROUTE3
      ROUTE3 --&gt; PRO2
      PRO2 --&gt; PRO4
      PRO4 --&gt; PRO6
      PRO6 --&gt; EXP3
      PRO6 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=63-test-routing-connector>6.3 Test Routing Connector</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>このセクションでは、<strong>Gateway</strong> 用に設定した <code>routing</code> ルールをテストします。期待される結果は、<code>"[deployment.environment"] == "security-applications"</code> ルールに一致する <code>loadgen</code> によって生成された <code>span</code> が <code>gateway-traces-route2-security.out</code> ファイルに送信されることです。</p><p><strong>Gateway を起動する</strong>: <strong>Gateway terminal</strong> ウィンドウで <strong>Gateway</strong> を起動します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config gateway.yaml</span></span></code></pre></div><p><strong>Agent を起動する</strong>: <strong>Agent terminal</strong> ウィンドウで <strong>Agent</strong> を起動します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config agent.yaml</span></span></code></pre></div><p><strong>通常のスパンを送信する</strong>: <strong>Loadgen terminal</strong> ウィンドウで <code>loadgen</code> を使用して通常のスパンを送信します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p><strong>Agent</strong> と <strong>Gateway</strong> の両方でデバッグ情報が表示されます。Gateway は新しい <code>gateway-traces-route1-regular.out</code> ファイルも生成します。これが通常のスパンの指定された宛先になりました。</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p><code>gateway-traces-route1-regular.out</code> を確認すると、<code>loadgen</code> によって送信された <code>span</code> が含まれています。また、空の <code>gateway-traces-route2-security..out</code> ファイルも表示されます。これは、ルーティング設定が、一致するスパンがまだ処理されていなくても、すぐに出力ファイルを作成するためです。</p></div></details><p><strong>セキュリティスパンを送信する</strong>: <strong>Loadgen terminal</strong> ウィンドウで <code>security</code> フラグを使用してセキュリティスパンを送信します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -security -count <span class=m>1</span></span></span></code></pre></div><p>再び、<strong>Agent</strong> と <strong>Gateway</strong> の両方で、送信したスパンを含むデバッグ情報が表示されるはずです。今回は、<strong>Gateway</strong> が <code>gateway-traces-route2-security.out</code> ファイルに行を書き込みます。これは、<code>deployment.environment</code> リソース属性が <code>"security-applications"</code> に一致するスパン用に指定されたファイルです。</p><div class=tab-panel data-tab-group=R-tabs-09fd4e556c1ece9c27e2022f52067d4b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-a23bd819fd4e175da9a4dddbe7080495 aria-expanded=true data-tab-item=R-tab-ad0c2b09920ec6396d478d255cb39b4d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-09fd4e556c1ece9c27e2022f52067d4b","R-tab-ad0c2b09920ec6396d478d255cb39b4d")'>
<span class=tab-nav-text>Validate resource attribute matches</span>
</button>
<button aria-controls=R-tab-id-fc8f54437645597fb6ad58613cb322a7 aria-expanded=false data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-09fd4e556c1ece9c27e2022f52067d4b","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div id=R-tab-id-a23bd819fd4e175da9a4dddbe7080495 data-tab-item=R-tab-ad0c2b09920ec6396d478d255cb39b4d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[] as $resource | $resource.scopeSpans[].spans[] | {spanId: .spanId, deploymentEnvironment: ($resource.resource.attributes[] | select(.key == &#34;deployment.environment&#34;) | .value.stringValue)}&#39;</span> gateway-traces-route2-security.out</span></span></code></pre></div></div></div><div id=R-tab-id-fc8f54437645597fb6ad58613cb322a7 data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;cb799e92e26d5782&#34;</span><span class=p>,</span><span class=nt>&#34;deploymentEnvironment&#34;</span><span class=p>:</span><span class=s2>&#34;security-applications&#34;</span><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>このシナリオを複数回繰り返すことができ、各トレースは対応する出力ファイルに書き込まれます。</p></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p>それぞれのターミナルで <code>Ctrl-C</code> を押して、<strong>Agent</strong> と <strong>Gateway</strong> のプロセスを停止してください。</p></div></details><h2 id=まとめ>まとめ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このセクションでは、異なるスパンを送信し、その宛先を確認することで、Gateway のルーティングコネクターを正常にテストしました。</p><ul><li><p><strong>通常のスパン</strong> は <code>gateway-traces-route1-regular.out</code> に正しくルーティングされ、一致する <code>deployment.environment</code> 属性を持たないスパンがデフォルトパイプラインに従うことが確認されました。</p></li><li><p><strong>セキュリティ関連のスパン</strong> は <code>gateway-traces-route2-security.out</code> にルーティングされ、<code>"deployment.environment": "security-applications"</code> に基づくルーティングルールが期待どおりに機能することが実証されました。</p></li></ul><p>出力ファイルを検査することで、OpenTelemetry Collector が <em>スパン属性を正しく評価し、適切な宛先にルーティングしている</em> ことを確認しました。これにより、ルーティングルールが異なるユースケース向けにテレメトリデータを効果的に分離して振り分けることができることが検証されました。</p><p>追加のルーティングルールを定義して、異なる属性に基づいてスパン、メトリクス、ログをさらに分類することで、このアプローチを拡張できます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=7-count-connector-でメトリクスを作成する>7. Count Connector でメトリクスを作成する</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>このセクションでは、<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector rel=external><strong>Count Connector</strong></a> を使用して、ログから属性値を抽出し、意味のあるメトリクスに変換する方法を説明します。</p><p>具体的には、Count Connector を使用して、ログに出現する「Star Wars」と「Lord of the Rings」の名言の数を追跡し、測定可能なデータポイントに変換します。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p><strong>すべてのターミナルウィンドウを <code>7-sum-count</code> ディレクトリに変更し、<code>clear</code> コマンドを実行してください。</strong></p></div></details><p><code>6-routing-data</code> ディレクトリから <code>*.yaml</code> を <code>7-sum-count</code> にコピーしてください。更新後のディレクトリ構造は以下のようになります</p><div class=tab-panel data-tab-group=R-tabs-1d5295368b2e5068ab2d69ede40d027d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-97a2f45fae16b69a4e806c9df51253a6 aria-expanded=true data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1d5295368b2e5068ab2d69ede40d027d","R-tab-5a476a4994a778a4fb1b2011e6c9054c")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div id=R-tab-id-97a2f45fae16b69a4e806c9df51253a6 data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div><ul><li><strong>agent.yaml を更新</strong>して、ログを読み取る頻度を変更します。
<code>agent.yaml</code> 内の <code>filelog/quotes</code> レシーバーを見つけ、<code>poll_interval</code> 属性を追加してください</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>poll_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s                </span><span class=w> </span><span class=c># Only read every ten seconds</span></span></span></code></pre></div></div></details><p>遅延を設定する理由は、OpenTelemetry Collector の Count Connector が各処理インターバル内でのみログをカウントするためです。つまり、データが読み取られるたびに、次のインターバルでカウントがゼロにリセットされます。デフォルトの <code>Filelog receiver</code> インターバル 200ms では、loadgen が書き込むすべての行を読み取り、カウントが1になります。このインターバルを設定することで、複数のエントリをカウントできるようになります。</p><p>以下に示すように、条件を省略することで、Collector は各読み取りインターバルの累計カウントを維持できます。ただし、バックエンドは長期間にわたってカウントを追跡できるため、累計カウントはバックエンドに任せるのがベストプラクティスです。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><strong>Count Connector を追加する</strong></li></ul><p>設定の connectors セクションに Count Connector を追加し、使用するメトリクスカウンターを定義します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>connectors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logs.full.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Running count of all logs read in interval&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logs.sw.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;StarWarsCount&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>attributes[&#34;movie&#34;] == &#34;SW&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logs.lotr.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;LOTRCount&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>attributes[&#34;movie&#34;] == &#34;LOTR&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>logs.error.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ErrorCount&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>attributes[&#34;level&#34;] == &#34;ERROR&#34;</span></span></span></code></pre></div><ul><li><p><strong>メトリクスカウンターの説明</strong></p><ul><li><code>logs.full.count</code>：各読み取りインターバルで処理されたログの総数を追跡します。
このメトリクスにはフィルタリング条件がないため、システムを通過するすべてのログがカウントに含まれます。</li><li><code>logs.sw.count</code>：Star Wars 映画の名言を含むログをカウントします。</li><li><code>logs.lotr.count</code>：Lord of the Rings 映画の名言を含むログをカウントします。</li><li><code>logs.error.count</code>：読み取りインターバルで重大度レベルが ERROR のログをカウントする、実際のシナリオを表します。</li></ul></li><li><p><strong>パイプラインで Count Connector を設定する</strong>
以下のパイプライン設定では、connector exporter が <code>logs</code> セクションに追加され、connector receiver が <code>metrics</code> セクションに追加されています。</p></li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redaction/redact              </span><span class=w> </span><span class=c># Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>count                          </span><span class=w> </span><span class=c># Count Connector that receives count metric from logs count exporter in logs pipeline.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- hostmetrics                    # Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>transform/logs                </span><span class=w> </span><span class=c># Transform logs processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>count                         </span><span class=w> </span><span class=c># Count Connector that exports count as a metric to metrics pipeline.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></details><p>ログは属性に基づいてカウントされます。ログデータが属性ではなくログボディに格納されている場合は、パイプラインで <code>Transform</code> プロセッサーを使用して、キー/バリューのペアを抽出し、属性として追加する必要があります。</p><p>このワークショップでは、<code>05-transform-data</code> セクションで既に <code>merge_maps(attributes, cache, "upsert")</code> を追加しています。これにより、関連するすべてのデータが処理用のログ属性に含まれるようになります。</p><p>属性を作成するフィールドを選択する際は注意が必要です。すべてのフィールドを無差別に追加することは、本番環境では一般的に理想的ではありません。不要なデータの乱雑さを避けるため、本当に必要なフィールドのみを選択してください。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong> を使用して agent 設定を<strong>検証</strong>してください。参考として、パイプラインの <code>logs</code> と <code>metrics:</code> セクションは以下のようになります</li></ul><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
    REC1(otlp&lt;br&gt;fa:fa-download):::receiver
    REC2(filelog&lt;br&gt;fa:fa-download&lt;br&gt;quotes):::receiver
    REC3(otlp&lt;br&gt;fa:fa-download):::receiver
    PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
    PRO2(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
    PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
    PRO4(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
    PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
    PRO6(batch&lt;br&gt;fa:fa-microchip):::processor
    PRO7(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
    PRO8(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
    PRO9(transfrom&lt;br&gt;fa:fa-microchip&lt;br&gt;logs):::processor
    EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    EXP2(&amp;emsp;&amp;emsp;otlphttp&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload):::exporter
    EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    EXP4(&amp;emsp;&amp;emsp;otlphttp&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload):::exporter
    ROUTE1(&amp;nbsp;count&amp;nbsp;&lt;br&gt;fa:fa-route):::con-export
    ROUTE2(&amp;nbsp;count&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive

    %% Links
    subID1:::sub-logs
    subID2:::sub-metrics
    subgraph &#34; &#34;
      direction LR
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO7
      PRO7 --&gt; PRO3
      PRO3 --&gt; PRO9
      PRO9 --&gt; PRO5
      PRO5 --&gt; ROUTE1
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end

      subgraph subID2[**Metrics**]
      direction LR
      ROUTE1 --&gt; ROUTE2
      ROUTE2 --&gt; PRO2
      REC3 --&gt; PRO2
      PRO2 --&gt; PRO8
      PRO8 --&gt; PRO4
      PRO4 --&gt; PRO6
      PRO6 --&gt; EXP3
      PRO6 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><section><h1 class=a11y-only>7. Count & Sum Connectorのサブセクション</h1><article class=default><header class=headline></header><h1 id=71-count-connector-のテスト>7.1 Count Connector のテスト</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gateway を起動する</strong>
<strong>Gateway terminal</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-509ec1b52c65068967055a400a8ca1c8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-3d1e0f41209b3ae0a4bd3ded70baba0a aria-expanded=true data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-509ec1b52c65068967055a400a8ca1c8","R-tab-dc146ad677dc5dd9c26a2a6537f98eb7")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div id=R-tab-id-3d1e0f41209b3ae0a4bd3ded70baba0a data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Agent を起動する</strong>
<strong>Agent terminal</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-879a42fccb71f7dca3a1fd65c1e71e69><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-5f2c5e9a0edc8ad9d5cbbebc728bed64 aria-expanded=true data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-879a42fccb71f7dca3a1fd65c1e71e69","R-tab-e2d8debf4ffe3bb6331201655f536d9d")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div id=R-tab-id-5f2c5e9a0edc8ad9d5cbbebc728bed64 data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Loadgen で12行のログを送信する</strong>
<strong>Spans terminal</strong> ウィンドウで、12行のログを送信します。これらは2つのインターバルで読み取られるはずです。以下の <code>loadgen</code> コマンドを実行してください</p><div class=tab-panel data-tab-group=R-tabs-5640ae056bfe9ea3d75de0ed5a016f6c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-af86730f7c1efbebedfc3497864b0fed aria-expanded=true data-tab-item=R-tab-c04840259ee1732c29330a07b53ce556 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-5640ae056bfe9ea3d75de0ed5a016f6c","R-tab-c04840259ee1732c29330a07b53ce556")'>
<span class=tab-nav-text>Loadgen</span></button></div><div class=tab-content-container><div id=R-tab-id-af86730f7c1efbebedfc3497864b0fed data-tab-item=R-tab-c04840259ee1732c29330a07b53ce556 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -logs -json -count <span class=m>12</span></span></span></code></pre></div></div></div></div></div><p><strong>Agent</strong> と <strong>Gateway</strong> の両方がデバッグ情報を表示し、データを処理していることを示します。<code>loadgen</code> が完了するまで待ちます。</p><p><strong>メトリクスが生成されたことを確認する</strong>
ログが処理されると、<strong>Agent</strong> がメトリクスを生成して <strong>Gateway</strong> に転送し、Gateway がそれらを <code>gateway-metrics.out</code> に書き込みます。</p><p>出力に <code>logs.full.count</code>、<code>logs.sw.count</code>、<code>logs.lotr.count</code>、<code>logs.error.count</code> のメトリクスが含まれているか確認するには、以下の <strong>jq</strong> クエリを実行します</p><div class=tab-panel data-tab-group=R-tabs-41f4c540521188f29a85447a6dab50cd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-6d59641f5dc87bc2477909de40691d89 aria-expanded=true data-tab-item=R-tab-5bcdc0d6fffb60ccb3e52026507edd53 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-41f4c540521188f29a85447a6dab50cd","R-tab-5bcdc0d6fffb60ccb3e52026507edd53")'>
<span class=tab-nav-text>jq query command</span>
</button>
<button aria-controls=R-tab-id-b154756baf2ca3e4714b30329ffe3257 aria-expanded=false data-tab-item=R-tab-845b9df504b40e63fe9060457ddcf4e9 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-41f4c540521188f29a85447a6dab50cd","R-tab-845b9df504b40e63fe9060457ddcf4e9")'>
<span class=tab-nav-text>jq example output</span></button></div><div class=tab-content-container><div id=R-tab-id-6d59641f5dc87bc2477909de40691d89 data-tab-item=R-tab-5bcdc0d6fffb60ccb3e52026507edd53 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceMetrics[].scopeMetrics[].metrics[]
</span></span></span><span class=line><span class=cl><span class=s1>    | select(.name == &#34;logs.full.count&#34; or .name == &#34;logs.sw.count&#34; or .name == &#34;logs.lotr.count&#34; or .name == &#34;logs.error.count&#34;)
</span></span></span><span class=line><span class=cl><span class=s1>    | {name: .name, value: (.sum.dataPoints[0].asInt // &#34;-&#34;)}&#39;</span> gateway-metrics.out</span></span></code></pre></div></div></div><div id=R-tab-id-b154756baf2ca3e4714b30329ffe3257 data-tab-item=R-tab-845b9df504b40e63fe9060457ddcf4e9 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.sw.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.lotr.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.full.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;4&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.error.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.error.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.sw.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.lotr.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;6&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;logs.full.count&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;8&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>注：<code>logs.full.count</code> は通常 <code>logs.sw.count</code> + <code>logs.lotr.count</code> と等しくなりますが、<code>logs.error.count</code> はランダムな数値になります。</p></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p>それぞれのターミナルで <code>Ctrl-C</code> を押して <strong>Agent</strong> と <strong>Gateway</strong> のプロセスを停止してください。</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=72-sum-connector-でメトリクスを作成する>7.2 Sum Connector でメトリクスを作成する</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>このセクションでは、<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/sumconnector rel=external><strong>Sum Connector</strong></a> がスパンから値を抽出してメトリクスに変換する方法を説明します。</p><p>具体的には、ベーススパンからクレジットカードの請求額を取得し、Sum Connector を活用して合計請求額をメトリクスとして取得します。</p><p>この connector は、スパン、スパンイベント、メトリクス、データポイント、およびログレコードから属性値を収集（<strong>sum</strong>）するために使用できます。各個別の値をキャプチャし、メトリクスに変換して転送します。ただし、これらのメトリクスと属性を使用して計算やさらなる処理を行うのは<strong>バックエンド</strong>の役割です。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Agent terminal</strong> ウィンドウに切り替えて、エディターで <code>agent.yaml</code> ファイルを開きます。</p><ul><li><strong>Sum Connector を追加する</strong>
設定の connectors セクションに Sum Connector を追加し、メトリクスカウンターを定義します</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>sum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spans</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=nt>user.card-charge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>source_attribute</span><span class=p>:</span><span class=w> </span><span class=l>payment.amount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>conditions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>attributes[&#34;payment.amount&#34;] != &#34;NULL&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.name</span></span></span></code></pre></div></div></details><p>上記の例では、スパン内の <code>payment.amount</code> 属性をチェックしています。有効な値がある場合、<strong>Sum</strong> connector は <code>user.card-charge</code> というメトリクスを生成し、<code>user.name</code> を属性として含めます。これにより、バックエンドは請求サイクルなどの長期間にわたってユーザーの合計請求額を追跡して表示できます。</p><p>以下のパイプライン設定では、connector exporter が traces セクションに追加され、connector receiver が metrics セクションに追加されています。</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><strong>パイプラインで Count Connector を設定する</strong></li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>redaction/redact              </span><span class=w> </span><span class=c># Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>sum                           </span><span class=w> </span><span class=c># Sum connector which aggregates payment.amount from spans and sends to metrics pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>sum                           </span><span class=w> </span><span class=c># Receives metrics from the sum exporter in the traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>count                         </span><span class=w> </span><span class=c># Receives count metric from logs count exporter in logs pipeline.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- hostmetrics                   # Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>transform/logs                </span><span class=w> </span><span class=c># Transform logs processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>count                         </span><span class=w> </span><span class=c># Count Connector that exports count as a metric to metrics pipeline.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div><ul><li><strong><a href=https://www.otelbin.io/ rel=external>otelbin.io</a></strong> を使用して agent 設定を<strong>検証</strong>してください。参考として、パイプラインの <code>traces</code> と <code>metrics:</code> セクションは以下のようになります</li></ul><pre class="mermaid actionbar-wrapper align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
    REC1(otlp&lt;br&gt;fa:fa-download&lt;br&gt; ):::receiver
    REC3(otlp&lt;br&gt;fa:fa-download&lt;br&gt; ):::receiver
    PRO1(memory_limiter&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO2(memory_limiter&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
    PRO4(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
    PRO5(batch&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO6(batch&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO7(resourcedetection&lt;br&gt;fa:fa-microchip&lt;br&gt; ):::processor
    PRO8(resourcedetection&lt;br&gt;fa:fa-microchip&lt;br&gt;):::processor

    PROA(attributes&lt;br&gt;fa:fa-microchip&lt;br&gt;redact):::processor
    PROB(redaction&lt;br&gt;fa:fa-microchip&lt;br&gt;update):::processor
    EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    EXP2(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    EXP4(&amp;emsp;&amp;emsp;otlphttp&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    EXP5(&amp;emsp;&amp;emsp;otlphttp&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt; ):::exporter
    ROUTE1(&amp;nbsp;sum&amp;nbsp;&lt;br&gt;fa:fa-route&lt;br&gt; ):::con-export
    ROUTE2(&amp;nbsp;count&amp;nbsp;&lt;br&gt;fa:fa-route&lt;br&gt; ):::con-receive
    ROUTE3(&amp;nbsp;sum&amp;nbsp;&lt;br&gt;fa:fa-route&lt;br&gt; ):::con-receive

    %% Links
    subID1:::sub-traces
    subID2:::sub-metrics
    subgraph &#34; &#34;
      direction LR
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PROA
      PROA --&gt; PROB
      PROB --&gt; PRO7
      PRO7 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      PRO5 --&gt; EXP5
      PRO5 --&gt; ROUTE1
      end

      subgraph subID2[**Metrics**]
      direction LR
      ROUTE1 --&gt; ROUTE3
      ROUTE3 --&gt; PRO2
      ROUTE2 --&gt; PRO2
      REC3 --&gt; PRO2
      PRO2 --&gt; PRO8
      PRO8 --&gt; PRO4
      PRO4 --&gt; PRO6
      PRO6 --&gt; EXP3
      PRO6 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article><article class=default><header class=headline></header><h1 id=73-sum-connector-のテスト>7.3 Sum Connector のテスト</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Gateway を起動する</strong>
<strong>Gateway terminal</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-913b557c958b889161f5ff5536eb451e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4a5c81d5f79706bd1912d5113778e56f aria-expanded=true data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-913b557c958b889161f5ff5536eb451e","R-tab-dc146ad677dc5dd9c26a2a6537f98eb7")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div id=R-tab-id-4a5c81d5f79706bd1912d5113778e56f data-tab-item=R-tab-dc146ad677dc5dd9c26a2a6537f98eb7 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Agent を起動する</strong>
<strong>Agent terminal</strong> ウィンドウで以下を実行します</p><div class=tab-panel data-tab-group=R-tabs-a04dad57afa3fe7ec9b90948aa235e64><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-85532577aad85c597b9fffbdd6c31ab5 aria-expanded=true data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a04dad57afa3fe7ec9b90948aa235e64","R-tab-e2d8debf4ffe3bb6331201655f536d9d")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div id=R-tab-id-85532577aad85c597b9fffbdd6c31ab5 data-tab-item=R-tab-e2d8debf4ffe3bb6331201655f536d9d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Loadgen を起動する</strong>
<strong>Spans terminal</strong> ウィンドウで、以下の <code>loadgen</code> コマンドを使用して8つのスパンを送信します</p><div class=tab-panel data-tab-group=R-tabs-be61d41b9d2781ee9cddccb38378d29e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2260afd817e024d3135d20482b18b83c aria-expanded=true data-tab-item=R-tab-c04840259ee1732c29330a07b53ce556 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-be61d41b9d2781ee9cddccb38378d29e","R-tab-c04840259ee1732c29330a07b53ce556")'>
<span class=tab-nav-text>Loadgen</span></button></div><div class=tab-content-container><div id=R-tab-id-2260afd817e024d3135d20482b18b83c data-tab-item=R-tab-c04840259ee1732c29330a07b53ce556 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>8</span></span></span></code></pre></div></div></div></div></div><p><strong>Agent</strong> と <strong>Gateway</strong> の両方がデバッグ情報を表示し、データを処理していることを示します。loadgen が完了するまで待ちます。</p><p><strong>メトリクスを確認する</strong>
スパンを処理する際、<strong>Agent</strong> はメトリクスを生成して <strong>Gateway</strong> に転送します。<strong>Gateway</strong> はそれらを <code>gateway-metrics.out</code> に書き込みます。</p><p>メトリクス出力に <code>user.card-charge</code> が存在し、それぞれに <code>user.name</code> 属性があることを確認するには、以下の jq クエリを実行します</p><div class=tab-panel data-tab-group=R-tabs-1241ea4f3f0cb915fc13957cb062ef1a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-abb88a9ebefc3ef68dd9bab134f6deba aria-expanded=true data-tab-item=R-tab-5bcdc0d6fffb60ccb3e52026507edd53 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1241ea4f3f0cb915fc13957cb062ef1a","R-tab-5bcdc0d6fffb60ccb3e52026507edd53")'>
<span class=tab-nav-text>jq query command</span>
</button>
<button aria-controls=R-tab-id-0dd1d26a0e02e8d23f7b6b5df4fe4286 aria-expanded=false data-tab-item=R-tab-845b9df504b40e63fe9060457ddcf4e9 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-1241ea4f3f0cb915fc13957cb062ef1a","R-tab-845b9df504b40e63fe9060457ddcf4e9")'>
<span class=tab-nav-text>jq example output</span></button></div><div class=tab-content-container><div id=R-tab-id-abb88a9ebefc3ef68dd9bab134f6deba data-tab-item=R-tab-5bcdc0d6fffb60ccb3e52026507edd53 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -r <span class=s1>&#39;.resourceMetrics[].scopeMetrics[].metrics[] | select(.name == &#34;user.card-charge&#34;) | .sum.dataPoints[] | &#34;\(.attributes[] | select(.key == &#34;user.name&#34;).value.stringValue)\t\(.asDouble)&#34;&#39;</span> gateway-metrics.out <span class=p>|</span> <span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span><span class=s1>$&#39;\t&#39;</span> <span class=nb>read</span> -r name charge<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>printf</span> <span class=s2>&#34;%-20s %s\n&#34;</span> <span class=s2>&#34;</span><span class=nv>$name</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$charge</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span></span></span></code></pre></div></div></div><div id=R-tab-id-0dd1d26a0e02e8d23f7b6b5df4fe4286 data-tab-item=R-tab-845b9df504b40e63fe9060457ddcf4e9 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>George Lucas         67.49
</span></span><span class=line><span class=cl>Frodo Baggins        87.14
</span></span><span class=line><span class=cl>Thorin Oakenshield   90.98
</span></span><span class=line><span class=cl>Luke Skywalker       51.37
</span></span><span class=line><span class=cl>Luke Skywalker       65.56
</span></span><span class=line><span class=cl>Thorin Oakenshield   67.5
</span></span><span class=line><span class=cl>Thorin Oakenshield   66.66
</span></span><span class=line><span class=cl>Peter Jackson        94.39</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p>それぞれのターミナルで <code>Ctrl-C</code> を押して <strong>Agent</strong> と <strong>Gateway</strong> のプロセスを停止してください。</p></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/23</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=8-まとめ>8. まとめ</h1><p><a href=#R-image-6968c6beb19648355e84a277cd6f29dd class=lightbox-link><img alt="Well done" class="lazy lightbox figure-image" loading=lazy src=../images/welldone.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6968c6beb19648355e84a277cd6f29dd><img alt="Well done" class="lazy lightbox lightbox-image" loading=lazy src=../images/welldone.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/09</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=splunk-synthetic-scripting>Splunk Synthetic Scripting</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>45 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><p>問題がユーザーに影響を与える前に、Web アプリケーションのパフォーマンスをプロアクティブにモニタリングします。<strong>Splunk Synthetic Monitoring</strong> を使用すると、技術チームとビジネスチームは詳細なテストを作成し、開発サイクルのあらゆる段階で Web サイト、Web アプリケーション、リソースの速度と信頼性を継続的にモニタリングできます。</p><p><strong>Splunk Synthetic Monitoring</strong> は、唯一の完全なオブザーバビリティスイートである Splunk Observability Cloud の一部として、稼働時間と Web パフォーマンス最適化のための最も包括的で詳細な機能を提供します。</p><p>API、サービスエンドポイント、エンドユーザーエクスペリエンスのモニタリングを簡単にセットアップできます。<strong>Splunk Synthetic Monitoring</strong> を使用すると、基本的な稼働時間とパフォーマンスモニタリングを超えて、問題のプロアクティブな検出と修正、Web パフォーマンスの最適化、顧客への最高のユーザーエクスペリエンス提供に集中できます。</p><p><strong>Splunk Synthetic Monitoring</strong> では以下のことが可能です:</p><ul><li>重要なユーザーフロー、ビジネストランザクション、API エンドポイント全体で問題を迅速に検出・解決</li><li>インテリジェントな Web 最適化エンジンにより、Web パフォーマンスの問題が顧客に影響を与える前に防止</li><li>すべてのページリソースとサードパーティ依存関係のパフォーマンスを改善</li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>Splunk Synthetic Scriptingのサブセクション</h1><article class=default><header class=headline></header><h1 id=1-real-browser-test>1. Real Browser Test</h1><h2 id=はじめに>はじめに<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このワークショップでは、<a href=https://developer.chrome.com/docs/devtools/recorder/ rel=external>Chrome DevTools Recorder</a> を使用して、Splunk デモインスタンスに対する Synthetic トランザクションを作成する方法を説明します。</p><p>Chrome DevTools Recorder からエクスポートした JSON を使用して、Splunk Synthetic Monitoring の Real Browser Test を作成します。</p><p>また、<a href=https://docs.splunk.com/Observability/synthetics/api-test/api-test.html rel=external>API Test</a> や <a href=https://docs.splunk.com/Observability/synthetics/uptime-test/uptime-test.html rel=external>Uptime Test</a> など、他の Splunk Synthetic Monitoring チェックについても学びます。</p><h2 id=前提条件>前提条件<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ul><li>Google Chrome ブラウザがインストールされていること</li><li>Splunk Observability Cloud へのアクセス権があること</li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>1. Real Browser Testのサブセクション</h1><article class=default><header class=headline></header><h1 id=11-テストの記録>1.1 テストの記録</h1><h2 id=開始-url-を開く>開始 URL を開く<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップの開始 URL を Chrome で開きます。以下の適切なリンクをクリックして、新しいタブでサイトを開きます。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>ワークショップの開始 URL は <strong>EMEA</strong> と <strong>AMER/APAC</strong> で異なります。お住まいの地域に応じて正しい URL を使用してください。</p><div class=tab-panel data-tab-group=R-tabs-a8995a14a8ef64f36ad65fcf6897e146><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-1bff948f50801f1764b1b643d6788fbe aria-expanded=true data-tab-item=R-tab-5b8e181ae4ed60064b941335c8f8d52d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a8995a14a8ef64f36ad65fcf6897e146","R-tab-5b8e181ae4ed60064b941335c8f8d52d")'>
<span class=tab-nav-text>EMEA Workshop URL</span>
</button>
<button aria-controls=R-tab-id-bba067d1797f244b5e8ebfc2cc6255c0 aria-expanded=false data-tab-item=R-tab-150c518dae317cc990820080b7da7358 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a8995a14a8ef64f36ad65fcf6897e146","R-tab-150c518dae317cc990820080b7da7358")'>
<span class=tab-nav-text>AMER/APAC Workshop URL</span></button></div><div class=tab-content-container><div id=R-tab-id-1bff948f50801f1764b1b643d6788fbe data-tab-item=R-tab-5b8e181ae4ed60064b941335c8f8d52d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><a href=https://online-boutique-eu.splunko11y.com/ rel=external>https://online-boutique-eu.splunko11y.com/</a></p></div></div><div id=R-tab-id-bba067d1797f244b5e8ebfc2cc6255c0 data-tab-item=R-tab-150c518dae317cc990820080b7da7358 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><a href=https://online-boutique-us.splunko11y.com/ rel=external>https://online-boutique-us.splunko11y.com/</a></p></div></div></div></div></div></details><h2 id=chrome-devtools-recorder-を開く>Chrome DevTools Recorder を開く<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>次に、（上記で開いた新しいタブで）Developer Tools を開きます。Windows では <code>Ctrl + Shift + I</code>、Mac では <code>Cmd + Option + I</code> を押し、トップレベルメニューまたは <strong>More tools</strong> フライアウトメニューから <strong>Recorder</strong> を選択します。</p><p><a href=#R-image-7c3e67db7e7ccb57e4081d0c203949cb class=lightbox-link><img alt="Open Recorder" class="lazy lightbox figure-image" loading=lazy src=../../img/open-recorder.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7c3e67db7e7ccb57e4081d0c203949cb><img alt="Open Recorder" class="lazy lightbox lightbox-image" loading=lazy src=../../img/open-recorder.png></a></p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
注意</summary><div class=box-content><p>サイトの要素はビューポートの幅によって変わる場合があります。記録する前に、作成するテストの種類（デスクトップ、タブレット、モバイル）に応じてブラウザウィンドウを適切な幅に設定してください。必要に応じて、DevTools の「dock side」を別ウィンドウとしてポップアウトさせると便利です。</p></div></details><h2 id=新しい記録を作成>新しい記録を作成<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>DevTools ウィンドウで Recorder パネルを開いた状態で、<span class="btn cstyle button blue noicon"><span><span class=title>Create a new recording</span></span></span> ボタンをクリックして開始します。</p><p><a href=#R-image-f64f73bc8ef4689080beedfd53de92f3 class=lightbox-link><img alt=Recorder class="lazy lightbox figure-image" loading=lazy src=../../img/recorder.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f64f73bc8ef4689080beedfd53de92f3><img alt=Recorder class="lazy lightbox lightbox-image" loading=lazy src=../../img/recorder.png></a></p><p><strong>Recording Name</strong> には、イニシャルを接頭辞として使用します（例: <strong><code>&lt;your initials></code> - Online Boutique</strong>）。<strong>Start Recording</strong> をクリックして、アクションの記録を開始します。</p><p><a href=#R-image-f9f98b3a25602932417aef47347b55dc class=lightbox-link><img alt="Recording Name" class="lazy lightbox figure-image" loading=lazy src=../../img/recording-name.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f9f98b3a25602932417aef47347b55dc><img alt="Recording Name" class="lazy lightbox lightbox-image" loading=lazy src=../../img/recording-name.png></a></p><p>記録が開始されたら、サイトで以下のアクションを実行します:</p><ul><li><strong>Vintage Camera Lens</strong> をクリック</li><li><strong>Add to Cart</strong> をクリック</li><li><strong>Place Order</strong> をクリック</li><li>Recorder パネルの <strong>End recording</strong> をクリック</li></ul><p><a href=#R-image-1162ee025db3fb6271188aae08f5d9de class=lightbox-link><img alt="End Recording" class="lazy lightbox figure-image" loading=lazy src=../../img/end-recording.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1162ee025db3fb6271188aae08f5d9de><img alt="End Recording" class="lazy lightbox lightbox-image" loading=lazy src=../../img/end-recording.png></a></p><h2 id=記録のエクスポート>記録のエクスポート<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><strong>Export</strong> ボタンをクリックします:</p><p><a href=#R-image-54789db16f630a54a6928286457777f9 class=lightbox-link><img alt="Export button" class="lazy lightbox figure-image" loading=lazy src=../../img/export-button.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-54789db16f630a54a6928286457777f9><img alt="Export button" class="lazy lightbox lightbox-image" loading=lazy src=../../img/export-button.png></a></p><p>フォーマットとして <strong>JSON</strong> を選択し、<strong>Save</strong> をクリックします。</p><p><a href=#R-image-42769928ee72dbe6b87e45b177550108 class=lightbox-link><img alt="Export JSON" class="lazy lightbox figure-image" loading=lazy src=../../img/export-json.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-42769928ee72dbe6b87e45b177550108><img alt="Export JSON" class="lazy lightbox lightbox-image" loading=lazy src=../../img/export-json.png></a></p><p><a href=#R-image-876c15a1c48f0e1f6130ab08992d0853 class=lightbox-link><img alt="Save JSON" class="lazy lightbox figure-image" loading=lazy src=../../img/save-json.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-876c15a1c48f0e1f6130ab08992d0853><img alt="Save JSON" class="lazy lightbox lightbox-image" loading=lazy src=../../img/save-json.png></a></p><p><strong>おめでとうございます！</strong> Chrome DevTools Recorder を使用した記録の作成に成功しました。次に、この記録を使用して Splunk Synthetic Monitoring で Real Browser Test を作成します。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
JSON ファイルを表示するにはここをクリック</summary><div class=box-content><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;RWC - Online Boutique&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;steps&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;setViewport&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;width&#34;</span><span class=p>:</span> <span class=mi>1430</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;height&#34;</span><span class=p>:</span> <span class=mi>1016</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;deviceScaleFactor&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;isMobile&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;hasTouch&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;isLandscape&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Online Boutique&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;div:nth-of-type(2) &gt; div:nth-of-type(2) a &gt; div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div/div/div[2]/div[2]/div/a/div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/div:nth-of-type(2) &gt; div:nth-of-type(2) a &gt; div&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mi>170</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mi>180</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/product/66VCHSJNUP&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;aria/ADD TO CART&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div[1]/div/div[2]/div/form/div/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;text/Add to Cart&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mf>35.0078125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mf>46.4140625</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/cart&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;click&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;target&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;selectors&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;aria/PLACE ORDER&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;div &gt; div &gt; div.py-3 button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;xpath//html/body/main/div/div/div[4]/div/form/div[4]/button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;pierce/div &gt; div &gt; div.py-3 button&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>[</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;text/Place order&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetY&#34;</span><span class=p>:</span> <span class=mf>29.8125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;offsetX&#34;</span><span class=p>:</span> <span class=mf>66.8203125</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;assertedEvents&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;navigation&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://online-boutique-eu.splunko11y.com/cart/checkout&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=12-real-browser-test-の作成>1.2 Real Browser Test の作成</h1><p>Splunk Observability Cloud で <strong>Synthetics</strong> に移動し、<span class="btn cstyle button blue noicon"><span><span class=title>Add new test</span></span></span> をクリックします。</p><p>ドロップダウンから <strong>Browser test</strong> を選択します。</p><p><a href=#R-image-0eb998e0a7b914b3f78fd354d48b812f class=lightbox-link><img alt="Add new test" class="lazy lightbox figure-image" loading=lazy src=../../img/add-new-test.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0eb998e0a7b914b3f78fd354d48b812f><img alt="Add new test" class="lazy lightbox lightbox-image" loading=lazy src=../../img/add-new-test.png></a></p><p><strong>Browser test content</strong> 設定ページが表示されます。</p><p><a href=#R-image-500267321e725377b86f01478e02a387 class=lightbox-link><img alt="New Test" class="lazy lightbox figure-image" loading=lazy src=../../img/new-test.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-500267321e725377b86f01478e02a387><img alt="New Test" class="lazy lightbox lightbox-image" loading=lazy src=../../img/new-test.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=13-json-のインポート>1.3 JSON のインポート</h1><p>テストの設定を開始するには、Chrome DevTools Recorder からエクスポートした JSON をインポートする必要があります。<span class="btn cstyle button transparent noicon"><span><span class=title><strong>Import</strong></span></span></span> ボタンを有効にするには、まずテストに名前を付ける必要があります（例: <strong><code>&lt;your initials></code> - Online Boutique</strong>）。</p><p><a href=#R-image-5dc893ad7d74ab4b5c303bc7288b7a3a class=lightbox-link><img alt=Import class="lazy lightbox figure-image" loading=lazy src=../../img/import.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5dc893ad7d74ab4b5c303bc7288b7a3a><img alt=Import class="lazy lightbox lightbox-image" loading=lazy src=../../img/import.png></a></p><p><span class="btn cstyle button transparent noicon"><span><span class=title><strong>Import</strong></span></span></span> ボタンが有効になったら、クリックして Chrome DevTools Recorder からエクスポートした JSON ファイルをドロップするか、ファイルをアップロードします。</p><p><a href=#R-image-c985db9f46ba3a14f3748f6dba120b76 class=lightbox-link><img alt="Import JSON" class="lazy lightbox figure-image" loading=lazy src=../../img/import-json.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c985db9f46ba3a14f3748f6dba120b76><img alt="Import JSON" class="lazy lightbox lightbox-image" loading=lazy src=../../img/import-json.png></a></p><p>JSON ファイルがアップロードされたら、<span class="btn cstyle button blue noicon"><span><span class=title>Continue to edit steps</span></span></span> をクリックします。</p><p><a href=#R-image-ab98aad4ee907abf8c5ec3db8e4a1fcf class=lightbox-link><img alt="Import Complete" class="lazy lightbox figure-image" loading=lazy src=../../img/import-complete.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ab98aad4ee907abf8c5ec3db8e4a1fcf><img alt="Import Complete" class="lazy lightbox lightbox-image" loading=lazy src=../../img/import-complete.png></a></p><p><a href=#R-image-1c8642670acbbc9f2beaa81d4c47f261 class=lightbox-link><img alt="Edit Steps" class="lazy lightbox figure-image" loading=lazy src=../../img/edit-steps.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1c8642670acbbc9f2beaa81d4c47f261><img alt="Edit Steps" class="lazy lightbox lightbox-image" loading=lazy src=../../img/edit-steps.png></a></p><p>テストを編集する前に、まず設定を構成します。<span class="btn cstyle button blue noicon"><span><span class=title>&lt; Return to test</span></span></span> をクリックします。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=14-設定>1.4 設定</h1><p>シンプル設定では、テストの基本を構成できます:</p><ul><li><strong>Name</strong>: テストの名前（例: RWC - Online Boutique）</li><li><strong>Details</strong>:<ul><li><strong>Locations</strong>: テストを実行するロケーション</li><li><strong>Device</strong>: 異なるデバイスと接続速度をエミュレート。選択したデバイスに合わせてビューポートも調整されます</li><li><strong>Frequency</strong>: テストの実行頻度</li><li><strong>Round-robin</strong>: 複数のロケーションを選択した場合、すべてのロケーションで同時に実行するのではなく、一度に1つのロケーションからテストを実行します</li><li><strong>Active</strong>: テストをアクティブまたは非アクティブに設定</li></ul></li></ul><p>![Return to Test]このワークショップでは、モニタリングを行うロケーションを設定します。<strong>Locations</strong> フィールドをクリックすると、グローバルロケーションのリスト（合計50以上）が表示されます。</p><p><a href=#R-image-010626444d6b5908336de579165024a9 class=lightbox-link><img alt="Global Locations" class="lazy lightbox figure-image" loading=lazy src=../../img/global-locations.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-010626444d6b5908336de579165024a9><img alt="Global Locations" class="lazy lightbox lightbox-image" loading=lazy src=../../img/global-locations.png></a></p><p>以下のロケーションを選択します:</p><ul><li><strong>AWS - N. Virginia</strong></li><li><strong>AWS - London</strong></li><li><strong>AWS - Melbourne</strong></li></ul><p>完了したら、下にスクロールして <span class="btn cstyle button blue noicon"><span><span class=title>Submit</span></span></span> をクリックしてテストを保存します。</p><p>これで、選択した3つのロケーションから5分ごとにテストが実行されるようスケジュールされます。スケジュールの作成には数分かかります。</p><p>テストのスケジュール作成を待つ間、<span class="btn cstyle button transparent noicon"><span><span class=title>Edit test</span></span></span> をクリックして Advanced 設定を確認しましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=15-advanced-設定>1.5 Advanced 設定</h1><p><strong>Advanced</strong> をクリックします。これらの設定はオプションで、テストをさらに詳細に構成するために使用できます。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>このワークショップでは、これらの設定は情報提供のみを目的としており、実際には使用しません。</p></div></details><p><a href=#R-image-d6acd324b0c5c7f1361a545ace7c6ff3 class=lightbox-link><img alt="Advanced Settings" class="lazy lightbox figure-image" loading=lazy src=../../img/advanced-settings.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d6acd324b0c5c7f1361a545ace7c6ff3><img alt="Advanced Settings" class="lazy lightbox lightbox-image" loading=lazy src=../../img/advanced-settings.png></a></p><ul><li><strong>Security</strong>:<ul><li><strong>TLS/SSL validation</strong>: 有効にすると、SSL/TLS 証明書の有効期限切れ、無効なホスト名、信頼できない発行者の検証を強制します</li><li><strong>Authentication</strong>: 企業ネットワーク内など、追加のセキュリティプロトコルを必要とするサイトで認証するための資格情報を追加します。Authentication フィールドで <a href=https://docs.splunk.com/Observability/synthetics/test-config/global-variables.html rel=external>concealed global variables</a> を使用することで、資格情報のセキュリティレイヤーを追加し、チェック間で資格情報を共有しやすくなります</li></ul></li><li><strong>Custom Content</strong>:<ul><li><strong>Custom headers</strong>: 各リクエストで送信するカスタムヘッダーを指定します。たとえば、リクエストに特定のヘッダーを送信することで、バックエンドの分析からリクエストを除外するヘッダーを追加できます。カスタムヘッダーを使用して Cookie を設定することもできます</li><li><strong>Cookies</strong>: テスト開始前にブラウザに Cookie を設定します。たとえば、ポップアップモーダルがランダムに表示されてテストに干渉するのを防ぐために Cookie を設定できます。設定された Cookie は、チェックの開始 URL のドメインに適用されます。Splunk Synthetics Monitoring は public suffix list を使用してドメインを判定します</li><li><strong>Host overrides</strong>: あるホストから別のホストにリクエストをリルーティングするホストオーバーライドルールを追加します。たとえば、既存の本番サイトを開発サイトや特定の CDN エッジノードから読み込まれたページリソースに対してテストするホストオーバーライドを作成できます</li></ul></li></ul><p>次に、テストステップを編集して、各ステップにより意味のある名前を付けます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=16-テストステップの編集>1.6 テストステップの編集</h1><p>ステップを編集するには、<span class="btn cstyle button transparent noicon"><span><span class=title>+ Edit steps or synthetic transactions</span></span></span> ボタンをクリックします。ここから、各ステップに意味のある名前を付けていきます。</p><p><a href=#R-image-e1c2f000d4dccc2d4d9e70c0eb352151 class=lightbox-link><img alt="Edit steps" class="lazy lightbox figure-image" loading=lazy src=../../img/edit-steps.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e1c2f000d4dccc2d4d9e70c0eb352151><img alt="Edit steps" class="lazy lightbox lightbox-image" loading=lazy src=../../img/edit-steps.png></a></p><p>4つのステップそれぞれに意味のある名前を付けます。</p><ul><li><strong>Step 1</strong>: <strong>Go to URL</strong> というテキストを <strong>HomePage - Online Boutique</strong> に置き換えます</li><li><strong>Step 2</strong>: <strong>Select Vintage Camera Lens</strong> と入力します</li><li><strong>Step 3</strong>: <strong>Add to Cart</strong> と入力します</li><li><strong>Step 4</strong>: <strong>Place Order</strong> と入力します</li></ul><p><a href=#R-image-315aa8c3aa25675a99db9c3f8efee04d class=lightbox-link><img alt="Step names" class="lazy lightbox figure-image" loading=lazy src=../../img/step-names.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-315aa8c3aa25675a99db9c3f8efee04d><img alt="Step names" class="lazy lightbox lightbox-image" loading=lazy src=../../img/step-names.png></a></p><p><span class="btn cstyle button blue noicon"><span><span class=title>&lt; Return to test</span></span></span> をクリックしてテスト設定ページに戻り、<span class="btn cstyle button blue noicon"><span><span class=title>Save</span></span></span> をクリックしてテストを保存します。</p><p>テストダッシュボードに戻り、テスト結果が表示され始めます。</p><p><a href=#R-image-ba994679a3a0083b1627766bc77d55a5 class=lightbox-link><img alt=Scatterplot class="lazy lightbox figure-image" loading=lazy src=../../img/scatterplot.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ba994679a3a0083b1627766bc77d55a5><img alt=Scatterplot class="lazy lightbox lightbox-image" loading=lazy src=../../img/scatterplot.png></a></p><p><strong>おめでとうございます！</strong> Splunk Synthetic Monitoring で Real Browser Test の作成に成功しました。次に、テスト結果をより詳しく見ていきます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=17-テスト結果の表示>1.7 テスト結果の表示</h1><p>前のステップの散布図で、いずれかのドットをクリックしてテスト実行データにドリルダウンします。できれば、最新のテスト実行（最も右側）を選択してください。</p><p><a href=#R-image-9fac4913bb4856ddd5626b94ae1aef42 class=lightbox-link><img alt=Drilldown class="lazy lightbox figure-image" loading=lazy src=../../img/drilldown.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9fac4913bb4856ddd5626b94ae1aef42><img alt=Drilldown class="lazy lightbox lightbox-image" loading=lazy src=../../img/drilldown.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=api-test>API Test</h1><p>API Test は、API エンドポイントの機能とパフォーマンスを柔軟にチェックする方法を提供します。API ファーストの開発へのシフトにより、フロントエンドのコア機能を提供するバックエンドサービスをモニタリングする必要性が高まっています。</p><p>マルチステップの API インタラクションのテストに興味がある場合でも、エンドポイントのパフォーマンスを可視化したい場合でも、API Test は目標の達成を支援します。</p><p><a href=#R-image-e4a8de41d43767605e50b3f4ad2a0ed5 class=lightbox-link><img alt="API test result" class="lazy lightbox figure-image" loading=lazy src=../img/api-test-result.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e4a8de41d43767605e50b3f4ad2a0ed5><img alt="API test result" class="lazy lightbox lightbox-image" loading=lazy src=../img/api-test-result.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><section><h1 class=a11y-only>2. API Testのサブセクション</h1><article class=default><header class=headline></header><h1 id=global-variables>Global Variables</h1><h2 id=global-variables>Global Variables<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>API テストを実行するために使用するグローバル変数を確認します。歯車アイコンの下にある <strong>Global Variables</strong> をクリックします。<code>env.encoded_auth</code> という名前のグローバル変数を使用して、Spotify API トランザクションを構築します。</p><p><a href=#R-image-0f6be91082613c0a9af3a0116ab9fddb class=lightbox-link><img alt=placeholder class="lazy lightbox figure-image" loading=lazy src=../../img/global-variables.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0f6be91082613c0a9af3a0116ab9fddb><img alt=placeholder class="lazy lightbox lightbox-image" loading=lazy src=../../img/global-variables.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=新しい-api-テストの作成>新しい API テストの作成</h1><h2 id=新しい-api-テストを作成>新しい API テストを作成<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><span class="btn cstyle button blue noicon"><span><span class=title>Add new test</span></span></span> ボタンをクリックし、ドロップダウンから <strong>API test</strong> を選択して新しい API テストを作成します。テスト名には <strong>イニシャル</strong> に続けて <strong>Spotify API</strong> と入力します（例: <strong>RWC - Spotify API</strong>）。</p><p><a href=#R-image-fea9b7cb8fb6cdbc9efc519a5ed462c6 class=lightbox-link><img alt=placeholder class="lazy lightbox figure-image" loading=lazy src=../../img/new-api-check.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fea9b7cb8fb6cdbc9efc519a5ed462c6><img alt=placeholder class="lazy lightbox lightbox-image" loading=lazy src=../../img/new-api-check.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=認証リクエスト>認証リクエスト</h1><h2 id=認証リクエストの追加>認証リクエストの追加<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><span class="btn cstyle button transparent noicon"><span><span class=title>+ Add requests</span></span></span> をクリックし、リクエストステップ名を入力します（例: <strong>Authenticate with Spotify API</strong>）。</p><p><a href=#R-image-a0a90b1900227f418af917bf5a6d7930 class=lightbox-link><img alt=placeholder class="lazy lightbox figure-image" loading=lazy src=../../img/add-request.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a0a90b1900227f418af917bf5a6d7930><img alt=placeholder class="lazy lightbox lightbox-image" loading=lazy src=../../img/add-request.png></a></p><p>Request セクションを展開し、ドロップダウンからリクエストメソッドを <strong>POST</strong> に変更して、以下の URL を入力します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>https://accounts.spotify.com/api/token</span></span></code></pre></div><p><strong>Payload body</strong> セクションに以下を入力します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>grant_type=client_credentials</span></span></code></pre></div><p>次に、以下のキー/値のペアで2つのリクエストヘッダーを追加します:</p><ul><li><strong>CONTENT-TYPE: application/x-www-form-urlencoded</strong></li><li><strong>AUTHORIZATION: Basic {{env.encoded_auth}}</strong></li></ul><p><strong>Validation</strong> セクションを展開し、以下の抽出を追加します:</p><ul><li><strong>Extract</strong> from <strong>Response body</strong> <strong>JSON</strong> <strong>$.access_token</strong> <strong>as</strong> <strong>access_token</strong></li></ul><p>これにより、Spotify API から受信した JSON ペイロードを解析し、アクセストークンを抽出してカスタム変数として保存します。</p><p><a href=#R-image-5d564a05a5e5883f8d798584769aa19a class=lightbox-link><img alt="Add payload token" class="lazy lightbox figure-image" loading=lazy src=../../img/add-payload-token.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5d564a05a5e5883f8d798584769aa19a><img alt="Add payload token" class="lazy lightbox lightbox-image" loading=lazy src=../../img/add-payload-token.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=検索リクエスト>検索リクエスト</h1><h2 id=検索リクエストの追加>検索リクエストの追加<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><span class="btn cstyle button transparent noicon"><span><span class=title>+ Add Request</span></span></span> をクリックして次のステップを追加します。ステップ名を <strong>Search for Tracks named &ldquo;Up around the bend&rdquo;</strong> とします。</p><p><strong>Request</strong> セクションを展開し、リクエストメソッドを <strong>GET</strong> に変更して、以下の URL を入力します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>https://api.spotify.com/v1/search?q=Up%20around%20the%20bend&amp;type=track&amp;offset=0&amp;limit=5</span></span></code></pre></div><p>次に、以下のキー/値のペアで2つのリクエストヘッダーを追加します:</p><ul><li><strong>CONTENT-TYPE: application/json</strong></li><li><strong>AUTHORIZATION: Bearer {{custom.access_token}}</strong></li></ul><p><a href=#R-image-59a50c259dcc2bbea4c0cd988a02c870 class=lightbox-link><img alt="Add search request" class="lazy lightbox figure-image" loading=lazy src=../../img/add-search-request.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-59a50c259dcc2bbea4c0cd988a02c870><img alt="Add search request" class="lazy lightbox lightbox-image" loading=lazy src=../../img/add-search-request.png></a></p><p><strong>Validation</strong> セクションを展開し、以下の抽出を追加します:</p><ul><li><strong>Extract</strong> from <strong>Response body</strong> <strong>JSON</strong> <strong>$.tracks.items[0].id</strong> <strong>as</strong> <strong>track.id</strong></li></ul><p><a href=#R-image-c7fc4962fdbbe824beed3e7c6e21e2dc class=lightbox-link><img alt="Add search payload" class="lazy lightbox figure-image" loading=lazy src=../../img/add-search-payload.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c7fc4962fdbbe824beed3e7c6e21e2dc><img alt="Add search payload" class="lazy lightbox lightbox-image" loading=lazy src=../../img/add-search-payload.png></a></p><p><span class="btn cstyle button blue noicon"><span><span class=title>< Return to test</span></span></span> をクリックしてテスト設定ページに戻ります。次に <span class="btn cstyle button blue noicon"><span><span class=title>Save</span></span></span> をクリックして API テストを保存します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article><article class=default><header class=headline></header><h1 id=結果の表示>結果の表示</h1><h2 id=結果の表示>結果の表示<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>テストがプロビジョニングされて実行されるまで数分待ちます。テストが正常に実行されたら、実行をクリックしてテスト結果を表示します:</p><p><a href=#R-image-432a039e14532ae6ff8c75d0680bdc4b class=lightbox-link><img alt="API test result" class="lazy lightbox figure-image" loading=lazy src=../../img/api-test-result.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-432a039e14532ae6ff8c75d0680bdc4b><img alt="API test result" class="lazy lightbox lightbox-image" loading=lazy src=../../img/api-test-result.png></a></p><h2 id=6-リソース>6. リソース<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ul><li><p><a href=https://docs.splunk.com/Observability/synthetics/api-test/set-up-api-test.html rel=external>API テストの作成方法</a></p></li><li><p><a href=https://docs.splunk.com/Observability/synthetics/api-test/api-test.html rel=external>API Test 概要</a></p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=aws-lambda関数の分散トレーシング>AWS Lambda関数の分散トレーシング</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>45 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Guy-Francis Kono</span></span><p>このワークショップでは、AWS Lambda で実行される小規模なサーバーレスアプリケーションの分散トレースを構築し、AWS Kinesis を介してメッセージを produce および consume する方法を学びます。</p><p>まず、OpenTelemetry の自動計装がどのようにトレースをキャプチャし、選択した宛先にエクスポートするかを確認します。</p><p>次に、手動計装によってコンテキスト伝播を有効にする方法を見ていきます。</p><p>このワークショップのために、Splunk は AWS/EC2 上の Ubuntu Linux インスタンスを事前に構成しています。このインスタンスにアクセスするには、ワークショップインストラクターが提供する URL にアクセスしてください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/29</span></span></footer></article><section><h1 class=a11y-only>Lambdaトレーシングのサブセクション</h1><article class=default><header class=headline></header><h1 id=セットアップ>セットアップ</h1><p><a href=#R-image-d8525cb14a643b4b7e9d114ee680709f class=lightbox-link><img alt=手動計装されていないLambdaアプリケーション class="lazy lightbox figure-image" loading=lazy src=../images/01-Architecture.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d8525cb14a643b4b7e9d114ee680709f><img alt=手動計装されていないLambdaアプリケーション class="lazy lightbox lightbox-image" loading=lazy src=../images/01-Architecture.png></a></p><h2 id=前提条件>前提条件<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=observability-ワークショップインスタンス>Observability ワークショップインスタンス<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Observability ワークショップは、多くの場合、Splunk が提供する事前設定済みの Ubuntu EC2 インスタンス上で実施されます。</p><p>ワークショップのインストラクターから、割り当てられたワークショップインスタンスの認証情報が提供されます。</p><p>インスタンスには以下の環境変数が既に設定されているはずです：</p><ul><li><strong>ACCESS_TOKEN</strong></li><li><strong>REALM</strong><ul><li><em>これらはワークショップ用の Splunk Observability Cloud の <strong>Access Token</strong> と <strong>Realm</strong> です。</em></li><li><em>これらは OpenTelemetry Collector によって、データを正しい Splunk Observability Cloud 組織に転送するために使用されます。</em></li></ul></li></ul><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i><br></summary><div class=box-content><p><em>また、Multipass を使用してローカルの Observability ワークショップインスタンスをデプロイすることもできます。</em></p></div></details><h3 id=aws-command-line-interface-awscli>AWS Command Line Interface (awscli)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>AWS Command Line Interface、または<code>awscli</code>は、AWS リソースと対話するために使用される API です。このワークショップでは、特定のスクリプトがデプロイするリソースと対話するために使用されます。</p><p>Splunk が提供するワークショップインスタンスには、既に <strong>awscli</strong> がインストールされているはずです。</p><ul><li><p>インスタンスに <strong>aws</strong> コマンドがインストールされているか、次のコマンドで確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>which aws</span></span></code></pre></div><ul><li><em>予想される出力は <strong>/usr/local/bin/aws</strong> です</em></li></ul></li><li><p>インスタンスに <strong>aws</strong> コマンドがインストールされていない場合は、次のコマンドを実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install awscli</span></span></code></pre></div></li></ul><h3 id=terraform>Terraform<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Terraform は、リソースを構成ファイルで定義することで、デプロイ、管理、破棄するための Infrastructure as Code（IaC）プラットフォームです。Terraform は HCL を使用してこれらのリソースを定義し、さまざまなプラットフォームやテクノロジのための複数のプロバイダーをサポートしています。</p><p>このワークショップでは、コマンドラインで Terraform を使用して、以下のリソースをデプロイします：</p><ol><li>AWS API Gateway</li><li>Lambda 関数</li><li>Kinesis Stream</li><li>CloudWatch ロググループ</li><li>S3 バケット<ul><li><em>およびその他のサポートリソース</em></li></ul></li></ol><p>Splunk が提供するワークショップインスタンスには、既に <strong>terraform</strong> がインストールされているはずです。</p><ul><li><p>インスタンスに <strong>terraform</strong> コマンドがインストールされているか確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>which terraform</span></span></code></pre></div><ul><li><em>予想される出力は <strong>/usr/local/bin/terraform</strong> です</em></li></ul></li><li><p>インスタンスに <strong>terraform</strong> コマンドがインストールされていない場合は、以下の Terraform が推奨するインストールコマンドを実行してください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget -O- https://apt.releases.hashicorp.com/gpg <span class=p>|</span> sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class=k>$(</span>lsb_release -cs<span class=k>)</span><span class=s2> main&#34;</span> <span class=p>|</span> sudo tee /etc/apt/sources.list.d/hashicorp.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo apt update <span class=o>&amp;&amp;</span> sudo apt install terraform</span></span></code></pre></div></li></ul><h3 id=ワークショップディレクトリ-o11y-lambda-workshop>ワークショップディレクトリ (o11y-lambda-workshop)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>ワークショップディレクトリ <code>o11y-lambda-workshop</code> は、今日使用する例の Lambda ベースのアプリケーションの自動計装と手動計装の両方を完了するための、すべての設定ファイルとスクリプトを含むリポジトリです。</p><ul><li><p>ホームディレクトリにワークショップディレクトリがあることを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> <span class=o>&amp;&amp;</span> ls</span></span></code></pre></div><ul><li><em>予想される出力には <strong>o11y-lambda-workshop</strong> が含まれるはずです</em></li></ul></li><li><p><strong>o11y-lambda-workshop</strong> ディレクトリがホームディレクトリにない場合は、次のコマンドでクローンします：</p></li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/gkono-splunk/o11y-lambda-workshop.git</span></span></code></pre></div><h3 id=aws--terraform-変数>AWS & Terraform 変数<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><h4 id=aws>AWS<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>AWS の CLI では、サービスによってデプロイされたリソースにアクセスし管理するための認証情報が必要です。このワークショップでは、Terraform と Python スクリプトの両方がタスクを実行するためにこれらの変数を必要とします。</p><ul><li><p>このワークショップのために <strong>awscli</strong> を <em><strong>access key ID</strong></em>、<em><strong>secret access key</strong></em> および <em><strong>region</strong></em> で構成します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws configure</span></span></code></pre></div><ul><li><p><em>このコマンドは以下のようなプロンプトを表示するはずです：</em></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>AWS Access Key ID <span class=o>[</span>None<span class=o>]</span>: XXXXXXXXXXXXXXXX
</span></span><span class=line><span class=cl>AWS Secret Acces Key <span class=o>[</span>None<span class=o>]</span>: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</span></span><span class=line><span class=cl>Default region name <span class=o>[</span>None<span class=o>]</span>: us-east-1
</span></span><span class=line><span class=cl>Default outoput format <span class=o>[</span>None<span class=o>]</span>:</span></span></code></pre></div></li></ul></li><li><p>インスタンスで <strong>awscli</strong> が設定されていない場合は、次のコマンドを実行し、インストラクターから提供される値を入力してください。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aws configure</span></span></code></pre></div></li></ul><h4 id=terraform-1>Terraform<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>Terraform では、機密情報や動的データを.tf 設定ファイルにハードコーディングさせない、またはそれらの値をリソース定義全体で再利用できるようにするため、変数の受け渡しをサポートしています。</p><p>このワークショップでは、OpenTelemetry Lambda layer の適切な値で Lambda 関数をデプロイするため、Splunk Observability Cloud の取り込み値のため、そして環境とリソースを独自で即座に認識できるようにするための変数を Terraform で必要とします。</p><p>Terraform 変数(variable)は以下の方法で定義されます：</p><ul><li>変数を <em><strong>main.tf</strong></em> ファイルまたは <em><strong>variables.tf</strong></em> に定義する</li><li>以下のいずれかの方法で変数の値を設定する：<ul><li>ホストレベルで環境変数を設定し、その定義と同じ変数名を使用して、接頭辞として <em><strong>TF_VAR</strong></em> をつける</li><li><em><strong>terraform.tfvars</strong></em> ファイルに変数の値を設定する</li><li>terraform apply 実行時に引数として値を渡す</li></ul></li></ul><p>このワークショップでは、<em><strong>variables.tf</strong></em> と <em><strong>terraform.tfvars</strong></em> ファイルの組み合わせを使用して変数を設定します。</p><ul><li><p><strong>vi</strong> または <strong>nano</strong> のいずれかを使用して、<strong>auto</strong> または <strong>manual</strong> ディレクトリにある <em><strong>terraform.tfvars</strong></em> ファイルを開きます</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi ~/o11y-lambda-workshop/auto/terraform.tfvars</span></span></code></pre></div></li><li><p>変数に値を設定します。<strong>CHANGEME</strong> プレースホルダーをインストラクターから提供された値に置き換えてください。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>o11y_access_token</span> <span class=o>=</span> <span class=s2>&#34;CHANGEME&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>o11y_realm</span>        <span class=o>=</span> <span class=s2>&#34;CHANGEME&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>otel_lambda_layer</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;CHANGEME&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>prefix</span>            <span class=o>=</span> <span class=s2>&#34;CHANGEME&#34;</span></span></span></code></pre></div><ul><li><em>引用符（"）や括弧 ( [ ] ) はそのまま残し、プレースホルダー<code>CHANGEME</code>のみを変更してください。</em></li><li><em><strong>prefix</strong></em> は、他の参加者のリソースと区別するため、任意の文字列で設定する固有の識別子です。氏名やメールアドレスのエイリアスを使用することをお勧めします。</li><li><em><strong>prefix</strong> には小文字のみを使用してください。S3 のような特定の AWS リソースでは、大文字を使用するとエラーが発生します。</em></li></ul></li><li><p>ファイルを保存してエディタを終了します。</p></li><li><p>最後に、編集した <em><strong>terraform.tfvars</strong></em> ファイルを他のディレクトリにコピーします。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp ~/o11y-lambda-workshop/auto/terraform.tfvars ~/o11y-lambda-workshop/manual</span></span></code></pre></div><ul><li><em>これは、自動計装と手動計装の両方の部分で同じ値を使用するためです</em></li></ul></li></ul><h3 id=ファイル権限>ファイル権限<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>他のすべてのファイルはそのままでよいですが、<code>auto</code>と<code>manual</code>の両方にある<strong>send_message.py</strong>スクリプトは、ワークショップの一部として実行する必要があります。そのため、期待通りに実行するには、適切な権限が必要です。以下の手順に従って設定してください。</p><ul><li><p>まず、<code>o11y-lambda-workshop</code>ディレクトリにいることを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop</span></span></code></pre></div></li><li><p>次に、以下のコマンドを実行して<code>send_message.py</code>スクリプトに実行権限を設定します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo chmod <span class=m>755</span> auto/send_message.py manual/send_message.py</span></span></code></pre></div></li></ul><p>これで前提条件が整いましたので、ワークショップを始めることができます！</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/29</span></span></footer></article><article class=default><header class=headline></header><h1 id=自動計装>自動計装</h1><p>ワークショップの最初の部分では、OpenTelemetry による自動計装がどのようにして OpenTelemetry Collector に関数がどの言語で書かれているかを自動検出させ、それらの関数のトレースの取得を開始させるかを示します。</p><h3 id=自動計装ワークショップディレクトリとコンテンツ>自動計装ワークショップディレクトリとコンテンツ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>まず、<code>o11y-lambda-workshop/auto</code>ディレクトリとそのファイルの一部を見てみましょう。ここにはワークショップの自動計装部分のすべてのコンテンツがあります。</p><h4 id=auto-ディレクトリ><code>auto</code> ディレクトリ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><ul><li><p>以下のコマンドを実行して <strong>o11y-lambda-workshop/auto</strong> ディレクトリに移動します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop/auto</span></span></code></pre></div></li><li><p>このディレクトリの内容を確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ls</span></span></code></pre></div><ul><li><p><em>出力には以下のファイルとディレクトリが含まれるはずです：</em></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>handler             outputs.tf          terraform.tf        variables.tf
</span></span><span class=line><span class=cl>main.tf             send_message.py     terraform.tfvars</span></span></code></pre></div></li><li><p><em>出力には以下のファイルとディレクトリが含まれるはずです：</em></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>get_logs.py    main.tf       send_message.py
</span></span><span class=line><span class=cl>handler        outputs.tf    terraform.tf</span></span></code></pre></div></li></ul></li></ul><h4 id=maintf-ファイル><code>main.tf</code> ファイル<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><ul><li><p><code>main.tf</code> ファイルをより詳しく見てみましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat main.tf</span></span></code></pre></div></li></ul><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-question"></i>
ワークショップの質問</summary><div class=box-content><ul><li>このテンプレートによってどの AWS リソースが作成されているか特定できますか？</li><li>OpenTelemetry 計装がどこでセットアップされているか特定できますか？<ul><li><em>ヒント: Lambda 関数の定義を調べてください</em></li></ul></li><li>以前に設定した環境変数によってどの計装情報が提供されているか判断できますか？</li></ul></div></details><p>各 Lambda 関数の環境変数が設定されているセクションが見つかるはずです。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>environment <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>variables</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>SPLUNK_ACCESS_TOKEN</span> <span class=o>=</span> var.o11y_access_token
</span></span><span class=line><span class=cl>    <span class=nv>SPLUNK_REALM</span> <span class=o>=</span> var.o11y_realm
</span></span><span class=line><span class=cl>    <span class=nv>OTEL_SERVICE_NAME</span> <span class=o>=</span> <span class=s2>&#34;producer-lambda&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span> <span class=o>=</span> <span class=s2>&#34;deployment.environment=</span><span class=si>${</span><span class=nv>var</span><span class=p>.prefix</span><span class=si>}</span><span class=s2>-lambda-shop&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>AWS_LAMBDA_EXEC_WRAPPER</span> <span class=o>=</span> <span class=s2>&#34;/opt/nodejs-otel-handler&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>KINESIS_STREAM</span> <span class=o>=</span> aws_kinesis_stream.lambda_streamer.name
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><p>これらの環境変数を使用することで、いくつかの方法で自動計装を構成しています：</p><ul><li><p>環境変数を設定して、データのエクスポート先となる Splunk Observability Cloud 組織を OpenTelemetry collector に伝えています。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>SPLUNK_ACCESS_TOKEN</span> <span class=o>=</span> var.o11y_access_token
</span></span><span class=line><span class=cl><span class=nv>SPLUNK_ACCESS_TOKEN</span> <span class=o>=</span> var.o11y_realm</span></span></code></pre></div></li><li><p>また、OpenTelemetry が関数/サービスを識別し、それが属する環境/アプリケーションを認識するのに役立つ変数も設定しています。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>OTEL_SERVICE_NAME</span> <span class=o>=</span> <span class=s2>&#34;producer-lambda&#34;</span> <span class=c1># consumer関数の場合はconsumer-lambda</span>
</span></span><span class=line><span class=cl><span class=nv>OTEL_RESOURCE_ATTRIBUTES</span> <span class=o>=</span> <span class=s2>&#34;deployment.environment=</span><span class=si>${</span><span class=nv>var</span><span class=p>.prefix</span><span class=si>}</span><span class=s2>-lambda-shop&#34;</span></span></span></code></pre></div></li><li><p>コード言語に基づいて、関数のハンドラーに自動的にトレースデータを取得するために適用する必要があるラッパーを OpenTelemetry に知らせる環境変数を設定しています。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>AWS_LAMBDA_EXEC_WRAPPER - <span class=s2>&#34;/opt/nodejs-otel-handler&#34;</span></span></span></code></pre></div></li><li><p><code>producer-lambda</code>関数の場合、レコードを配置する Kinesis ストリームを関数に知らせるための環境変数を設定しています。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KINESIS_STREAM</span> <span class=o>=</span> aws_kinesis_stream.lambda_streamer.name</span></span></code></pre></div></li><li><p>これらの値は、「前提条件」セクションで設定した環境変数、および、この Terraform 構成ファイルの一部としてデプロイされるリソースから取得されます。</p></li></ul><p>また、各関数に Splunk OpenTelemetry Lambda layer を設定する引数も確認できるはずです</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>layers</span> <span class=o>=</span> var.otel_lambda_layer</span></span></code></pre></div><ul><li><p>OpenTelemetry Lambda layer は、Lambda 関数の呼び出し時に計測データを収集、処理、およびエクスポートするために必要なライブラリと依存関係を含むパッケージです。</p></li><li><p>すべての OpenTelemetry サポート言語のライブラリと依存関係を持つ一般的な OTel Lambda layer がありますが、関数をさらに軽量化するための言語固有の Lambda layer も存在します。</p><ul><li><em>各 AWS リージョンの関連する Splunk OpenTelemetry Lambda layer ARN（Amazon Resource Name）と最新バージョンは<a href=https://github.com/signalfx/lambda-layer-versions/blob/main/splunk-apm/splunk-apm.md rel=external>こちら</a>で確認できます</em></li></ul></li></ul><h4 id=producermjs-ファイル><code>producer.mjs</code> ファイル<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>次に、<code>producer-lambda</code>関数のコードを見てみましょう：</p><ul><li><p>以下のコマンドを実行して<code>producer.mjs</code>ファイルの内容を表示します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-workshop/auto/handler/producer.mjs</span></span></code></pre></div><ul><li>この NodeJS モジュールにはプロデューサー関数のコードが含まれています。</li><li>基本的に、この関数はメッセージを受け取り、そのメッセージを対象の Kinesis ストリームにレコードとして配置します</li></ul></li></ul><h3 id=lambda-関数のデプロイとトレースデータの生成>Lambda 関数のデプロイとトレースデータの生成<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><code>auto</code>ディレクトリの内容に慣れたところで、ワークショップ用のリソースをデプロイし、Lambda 関数からトレースデータを生成していきます。</p><h4 id=autoディレクトリで-terraform-を初期化する><code>auto</code>ディレクトリで Terraform を初期化する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p><code>main.tf</code>ファイルで定義されたリソースをデプロイするには、まず Terraform がそのファイルと同じフォルダで初期化されていることを確認する必要があります。</p><ul><li><p><code>auto</code> ディレクトリにいることを確認します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pwd</span></span></code></pre></div><ul><li><em>予想される出力は <strong>~/o11y-lambda-workshop/auto</strong> です</em></li></ul></li><li><p><code>auto</code> ディレクトリにいない場合は、次のコマンドを実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop/auto</span></span></code></pre></div></li><li><p>次のコマンドを実行して、このディレクトリで Terraform を初期化します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform init</span></span></code></pre></div><ul><li>このコマンドは同じフォルダにいくつかの要素を作成します：<ul><li><code>.terraform.lock.hcl</code> ファイル：リソースを提供するために使用するプロバイダーを記録します</li><li><code>.terraform</code> ディレクトリ：プロバイダーの構成を保存します</li></ul></li><li>上記のファイルに加えて、<code>apply</code> サブコマンドを使用して terraform を実行すると、デプロイされたリソースの状態を追跡するために <code>terraform.tfstate</code> ファイルが作成されます。</li><li>これらにより、Terraform は <code>auto</code> ディレクトリの <code>main.tf</code> ファイル内で定義されたとおりに、リソースの作成、状態、破棄を管理できます</li></ul></li></ul><h4 id=lambda-関数とその他の-aws-リソースをデプロイする>Lambda 関数とその他の AWS リソースをデプロイする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>このディレクトリで Terraform を初期化したら、リソースのデプロイに進むことができます。</p><ul><li><p>まず、<strong>terraform plan</strong> コマンドを実行して、Terraform が問題なくリソースを作成できることを確認します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform plan</span></span></code></pre></div><ul><li><em>これにより、リソースをデプロイするプランといくつかのデータが出力され、意図したとおりに動作することを確認できます。</em></li><li><em>プランに表示される値の一部は、作成後に判明するか、セキュリティ上の理由でマスクされていることに注意してください。</em></li></ul></li><li><p>次に、<strong>terraform apply</strong> コマンドを実行して、<strong>main.tf</strong> ファイルから Lambda 関数とその他のサポートリソースをデプロイします：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform apply</span></span></code></pre></div><ul><li><p><em><strong>Enter a value:</strong> プロンプトが表示されたら <strong>yes</strong> と応答します</em></p></li><li><p>これにより、以下のような出力が得られます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Outputs:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>base_url</span> <span class=o>=</span> <span class=s2>&#34;https://______.amazonaws.com/serverless_stage/producer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>consumer_function_name</span> <span class=o>=</span> <span class=s2>&#34;_____-consumer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>consumer_log_group_arn</span> <span class=o>=</span> <span class=s2>&#34;arn:aws:logs:us-east-1:############:log-group:/aws/lambda/______-consumer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>consumer_log_group_name</span> <span class=o>=</span> <span class=s2>&#34;/aws/lambda/______-consumer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>environment</span> <span class=o>=</span> <span class=s2>&#34;______-lambda-shop&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>lambda_bucket_name</span> <span class=o>=</span> <span class=s2>&#34;lambda-shop-______-______&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>producer_function_name</span> <span class=o>=</span> <span class=s2>&#34;______-producer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>producer_log_group_arn</span> <span class=o>=</span> <span class=s2>&#34;arn:aws:logs:us-east-1:############:log-group:/aws/lambda/______-producer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>producer_log_group_name</span> <span class=o>=</span> <span class=s2>&#34;/aws/lambda/______-producer&#34;</span></span></span></code></pre></div><ul><li><em>Terraform 出力は <strong>outputs.tf</strong> ファイルで定義されています。</em></li><li><em>これらの出力は、ワークショップの他の部分でもプログラム的に使用されます。</em></li></ul></li></ul></li></ul><h4 id=producer-lambda-url-base_url-にトラフィックを送信する><code>producer-lambda</code> URL (<code>base_url</code>) にトラフィックを送信する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>デプロイした Lambda 関数からトレースを取得し始めるには、トラフィックを生成する必要があります。<code>producer-lambda</code>関数のエンドポイントにメッセージを送信し、それを Kinesis ストリームにレコードとして配置し、その後<code>consumer-lambda</code>関数によってストリームから取得されるようにします。</p><ul><li><p><code>auto</code> ディレクトリにいることを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pwd</span></span></code></pre></div><ul><li><em>予想される出力は <strong>~/o11y-lambda-workshop/auto</strong> です</em></li></ul></li><li><p><code>auto</code> ディレクトリにいない場合は、次のコマンドを実行します</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop/auto</span></span></code></pre></div></li></ul><p><code>send_message.py</code> スクリプトは、コマンドラインで入力を受け取り、JSON ディクショナリに追加し、while ループの一部として <code>producer-lambda</code> 関数のエンドポイントに繰り返し送信する Python スクリプトです。</p><ul><li><p>Run the <code>send_message.py</code> script as a background process</p><ul><li><em><code>--name</code> と <code>--superpower</code> 引数が必要です</em></li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nohup ./send_message.py --name CHANGEME --superpower CHANGEME <span class=p>&amp;</span></span></span></code></pre></div><ul><li><p>メッセージが成功した場合は、以下のような出力が表示されるはずです</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>1<span class=o>]</span> <span class=m>79829</span>
</span></span><span class=line><span class=cl>user@host manual % appending output to nohup.out</span></span></code></pre></div><ul><li><em>ここで重要な情報は 2 つあります:</em><ul><li><em>1 行目のプロセス ID（この例では <code>79829</code>）、および</em></li><li><em><code>appending output to nohup.out</code> メッセージ</em></li></ul></li><li><em><code>nohup</code> コマンドはスクリプトがバックグラウンドに送られた時に切断されないようにします。また、コマンドからの curl 出力を、現在いるフォルダと同じフォルダにある nohup.out ファイルにキャプチャします。</em></li><li><em><code>&</code> はシェルプロセスにこのプロセスをバックグラウンドで実行するよう指示し、シェルが他のコマンドを実行できるようにします。</em></li></ul></li></ul></li><li><p>次に、<code>response.logs</code> ファイルの内容を確認して、<code>producer-lambda</code> エンドポイントへのリクエストが成功したことを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat response.logs</span></span></code></pre></div><ul><li>メッセージが成功していれば、画面に印刷された行の中に次の出力が表示されるはずです：</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Message placed in the Event Stream: {prefix}-lambda_stream&#34;</span><span class=o>}</span></span></span></code></pre></div><ul><li>失敗した場合は、次のように表示されます：</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Internal server error&#34;</span><span class=o>}</span></span></span></code></pre></div></li></ul><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p>この場合は、ワークショップ進行役の一人に支援を求めてください。</p></div></details><h4 id=lambda-関数のログを表示する>Lambda 関数のログを表示する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>次に、Lambda 関数のログを確認しましょう。</p><ul><li><p><strong>producer-lambda</strong> ログを表示するには、<strong>producer.logs</strong> ファイルを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat producer.logs</span></span></code></pre></div></li><li><p><strong>consumer-lambda</strong> ログを表示するには、<strong>consumer.logs</strong> ファイルを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat consumer.logs</span></span></code></pre></div></li></ul><p>ログを注意深く調べてください。</p><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-question"></i>
ワークショップの質問</summary><div class=box-content><ul><li>OpenTelemetry が読み込まれているのが見えますか？<code>splunk-extension-wrapper</code>のある行に注目してください<ul><li><ul><li><em><strong>splunk-extension-wrapper</strong>が読み込まれているのを見るために<code>head -n 50 producer.logs</code>または<code>head -n 50 consumer.logs</code>の実行を検討してください。</em></li></ul></li></ul></li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/29</span></span></footer></article><article class=default><header class=headline></header><h1 id=splunk-apmlambda関数およびトレース>Splunk APM、Lambda関数およびトレース</h1><p>Lambda 関数は相当量のトレースデータを生成しているはずで、それを確認する必要があります。Lambda 関数のリソース定義で構成された環境変数と OpenTelemetry Lambda layer の組み合わせにより、Splunk APM で関数とトレースを表示する準備が整いました。</p><h4 id=splunk-apm-概要で環境名を確認する>Splunk APM 概要で環境名を確認する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>まず、Splunk APM が受信しているトレースデータから<code>Environment</code>を認識していることを確認しましょう。これは<code>main.tf</code>の Lambda 関数定義で設定した<code>OTEL_RESOURCE_ATTRIBUTES</code>変数の一部として設定した<code>deployment.name</code>です。これは先ほど実行した<code>terraform apply</code>コマンドの出力の 1 つでもありました。</p><p>Splunk Observability Cloud で：</p><ul><li><p>左側のメインメニューから<code>APM</code>ボタンをクリックします。これにより Splunk APM 概要に移動します。</p></li><li><p><code>Environment:</code>ドロップダウンからあなたの APM 環境を選択します。</p><ul><li><em>APM 環境は<code>PREFIX-lambda-shop</code>形式になっているはずです。<code>PREFIX</code>は前提条件セクションで設定した環境変数から取得されます</em></li></ul></li></ul><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>トレースが Splunk APM に表示されるまで数分かかる場合があります。環境のリストにあなたの環境名が表示されるまで、ブラウザの更新ボタンを押してみてください</p></div></details><p><a href=#R-image-74592cb7dbb50c20e69989d06e3cba2f class=lightbox-link><img alt="Splunk APM, Environment Name" class="lazy lightbox figure-image" loading=lazy src=../images/02-Auto-APM-EnvironmentName.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-74592cb7dbb50c20e69989d06e3cba2f><img alt="Splunk APM, Environment Name" class="lazy lightbox lightbox-image" loading=lazy src=../images/02-Auto-APM-EnvironmentName.png></a></p><h4 id=環境のサービスマップを表示する>環境のサービスマップを表示する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>Environment ドロップダウンから環境名を選択したら、Lambda 関数のサービスマップを確認できます。</p><ul><li>APM 概要ページの右側にある<code>Service Map</code>ボタンをクリックします。これによりサービスマップビューに移動します。</li></ul><p><a href=#R-image-84634c6a9a50c789c1bd1fa88ac86b63 class=lightbox-link><img alt="Splunk APM、サービスマップボタン" class="lazy lightbox figure-image" loading=lazy src=../images/03-Auto-ServiceMapButton.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-84634c6a9a50c789c1bd1fa88ac86b63><img alt="Splunk APM、サービスマップボタン" class="lazy lightbox lightbox-image" loading=lazy src=../images/03-Auto-ServiceMapButton.png></a></p><p><code>producer-lambda</code>関数とそのレコードを配置するために Kinesis ストリームに対して行っている呼び出しが表示されるはずです。</p><p><a href=#R-image-38656ad8efcf5fa527870f855a9535d0 class=lightbox-link><img alt="Splunk APM、サービスマップ" class="lazy lightbox figure-image" loading=lazy src=../images/04-Auto-ServiceMap.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-38656ad8efcf5fa527870f855a9535d0><img alt="Splunk APM、サービスマップ" class="lazy lightbox lightbox-image" loading=lazy src=../images/04-Auto-ServiceMap.png></a></p><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-question"></i>
ワークショップの質問</summary><div class=box-content><p>あなたの<code>consumer-lambda</code>関数はどうなっていますか？</p></div></details><h4 id=lambda-関数からのトレースを調査する>Lambda 関数からのトレースを調査する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><ul><li><code>Traces</code>ボタンをクリックしてトレースアナライザーを表示します。</li></ul><p><a href=#R-image-43e5a183dbbbae80e7616a402f95799d class=lightbox-link><img alt="Splunk APM、トレースボタン" class="lazy lightbox figure-image" loading=lazy src=../images/05-Auto-TraceButton.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-43e5a183dbbbae80e7616a402f95799d><img alt="Splunk APM、トレースボタン" class="lazy lightbox lightbox-image" loading=lazy src=../images/05-Auto-TraceButton.png></a></p><p>このページでは、<code>producer-lambda</code>関数の OpenTelemetry Lambda layer から取り込まれたトレースを確認できます。</p><p><a href=#R-image-81868cbb8383588a5feb0ccad500759d class=lightbox-link><img alt="Splunk APM、トレースアナライザー" class="lazy lightbox figure-image" loading=lazy src=../images/06-Auto-TraceAnalyzer.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-81868cbb8383588a5feb0ccad500759d><img alt="Splunk APM、トレースアナライザー" class="lazy lightbox lightbox-image" loading=lazy src=../images/06-Auto-TraceAnalyzer.png></a></p><ul><li>リストからハイパーリンクされた<code>Trace ID</code>をクリックして、調査するトレースを選択します。</li></ul><p><a href=#R-image-e233d8a4e030c2472ba737f72aa0ded7 class=lightbox-link><img alt="Splunk APM、トレースとスパン" class="lazy lightbox figure-image" loading=lazy src=../images/07-Auto-TraceNSpans.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e233d8a4e030c2472ba737f72aa0ded7><img alt="Splunk APM、トレースとスパン" class="lazy lightbox lightbox-image" loading=lazy src=../images/07-Auto-TraceNSpans.png></a></p><p><code>producer-lambda</code>関数が Kinesis ストリームにレコードを配置しているのが確認できます。しかし、<code>consumer-lambda</code>関数のアクションが見当たりません！</p><p>これはトレースコンテキストが伝播されていないためです。このワークショップの時点では、Kinesis サービスはトレースコンテキスト伝播をすぐには対応していません。分散トレースは Kinesis サービスで止まっており、そのコンテキストがストリームを通じて自動的に伝播されないため、それ以上先を見ることができません。</p><p>少なくとも、今はまだ&mldr;</p><p>次のセクションでこの問題にどう対処するか見ていきましょう。しかしその前に、後片付けをしましょう！</p><h3 id=クリーンアップ>クリーンアップ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>この自動計装演習の一部としてデプロイしたリソースはクリーンアップする必要があります。同様に、<code>producer-lambda</code>エンドポイントに対してトラフィックを生成していたスクリプトも、まだ実行中であれば停止する必要があります。以下の手順に従ってクリーンアップを行ってください。</p><h4 id=send_messageの停止><code>send_message</code>の停止<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><ul><li><p><code>send_message.py</code>スクリプトがまだ実行中の場合は、次のコマンドで停止します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fg</span></span></code></pre></div><ul><li>これによりバックグラウンドプロセスがフォアグラウンドに移動します。</li><li>次に<code>[CONTROL-C]</code>を押してプロセスを終了できます。</li></ul></li></ul><h4 id=全ての-aws-リソースを破棄する>全ての AWS リソースを破棄する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>Terraform は個々のリソースの状態をデプロイメントとして管理するのに優れています。定義に変更があっても、デプロイされたリソースを更新することもできます。しかし、一からやり直すために、リソースを破棄し、このワークショップの手動計装部分の一部として再デプロイします。</p><p>以下の手順に従ってリソースを破棄してください：</p><ul><li><p><code>auto</code>ディレクトリにいることを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pwd</span></span></code></pre></div><ul><li><em>期待される出力は <strong>~/o11y-lambda-workshop/auto</strong> です</em></li></ul></li><li><p><code>auto</code>ディレクトリにいない場合は、以下のコマンドを実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop/auto</span></span></code></pre></div></li><li><p>先ほどデプロイした Lambda 関数とその他の AWS リソースを破棄します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform destroy</span></span></code></pre></div><ul><li><code>Enter a value:</code>プロンプトが表示されたら<code>yes</code>と応答します</li><li>これによりリソースが破棄され、クリーンな環境が残ります</li></ul></li></ul><p>このプロセスにより、私たちの活動の結果として作成されたファイルとディレクトリは残ります。それらについては心配する必要はありません。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/29</span></span></footer></article><article class=default><header class=headline></header><h1 id=手動計装>手動計装</h1><p>ワークショップの第 2 部では、OpenTelemetry による手動計装が計測データ収集を強化する方法を実演することに焦点を当てます。より具体的には、今回のケースでは、<code>producer-lambda</code>関数から<code>consumer-lambda</code>関数にトレースコンテキストデータを伝播させることができるようになります。これにより、現在は自動コンテキスト伝播をサポートしていない Kinesis ストリームを介しても、2 つの関数間の関係を見ることができるようになります。</p><h3 id=手動計装ワークショップディレクトリとコンテンツ>手動計装ワークショップディレクトリとコンテンツ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>再度、作業ディレクトリとそのファイルの一部を確認することから始めます。今回は <code>o11y-lambda-workshop/manual</code> ディレクトリです。ここにはワークショップの手動計装部分のすべてのコンテンツがあります。</p><h4 id=manual-ディレクトリ><code>manual</code> ディレクトリ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><ul><li><p>以下のコマンドを実行して <code>o11y-lambda-workshop/manual</code> ディレクトリに移動します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop/manual</span></span></code></pre></div></li><li><p><code>ls</code> コマンドでこのディレクトリの内容を確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ls</span></span></code></pre></div><ul><li><p><em>出力には以下のファイルとディレクトリが含まれるはずです：</em></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>handler             outputs.tf          terraform.tf        variables.tf
</span></span><span class=line><span class=cl>main.tf             send_message.py     terraform.tfvars</span></span></code></pre></div></li></ul></li></ul><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-question"></i>
ワークショップの質問</summary><div class=box-content><p>このディレクトリと最初に始めた auto ディレクトリに何か違いがありますか？</p></div></details><h4 id=auto-と-manual-のファイルを比較する><code>auto</code> と <code>manual</code> のファイルを比較する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>見た目が同じように見えるこれらのファイルが実際に同じかどうか確認しましょう。</p><ul><li><p><code>auto</code> と <code>manual</code> ディレクトリの <code>main.tf</code> ファイルを比較します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>diff ~/o11y-lambda-workshop/auto/main.tf ~/o11y-lambda-workshop/manual/main.tf</span></span></code></pre></div><ul><li>違いはありません！<em>(違いがあるはずはありません。もし違いがあれば、ワークショップ進行役に支援を求めてください)</em></li></ul></li><li><p>次に、<code>producer.mjs</code> ファイルを比較してみましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>diff ~/o11y-lambda-workshop/auto/handler/producer.mjs ~/o11y-lambda-workshop/manual/handler/producer.mjs</span></span></code></pre></div><ul><li>ここにはかなりの違いがあります！</li></ul></li><li><p>ファイル全体を表示してその内容を調べたい場合は以下を実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-workshop/handler/producer.mjs</span></span></code></pre></div><ul><li>必要な手動計装タスクを処理するために、いくつかの OpenTelemetry オブジェクトを関数に直接インポートしていることに注目してください。</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>context</span><span class=p>,</span> <span class=nx>propagation</span><span class=p>,</span> <span class=nx>trace</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@opentelemetry/api&#34;</span><span class=p>;</span></span></span></code></pre></div><ul><li>プロデューサー関数でコンテキストを伝播するために、<a href=https://www.npmjs.com/package/@opentelemetry/api rel=external>@opentelemetry/api</a> から次のオブジェクトをインポートしています：<ul><li>context</li><li>propagation</li><li>trace</li></ul></li></ul></li><li><p>最後に、<code>consumer.mjs</code> ファイルを比較します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>diff ~/o11y-lambda-workshop/auto/handler/consumer.mjs ~/o11y-lambda-workshop/manual/handler/consumer.mjs</span></span></code></pre></div><ul><li><p>ここにもいくつかの注目すべき違いがあります。より詳しく見てみましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat handler/consumer.mjs</span></span></code></pre></div><ul><li>このファイルでは、次の <a href=https://www.npmjs.com/package/@opentelemetry/api rel=external>@opentelemetry/api</a> オブジェクトをインポートしています：<ul><li>propagation</li><li>trace</li><li>ROOT_CONTEXT</li></ul></li><li>これらを使用して、プロデューサー関数から伝播されたトレースコンテキストを抽出します</li><li>その後、抽出したトレースコンテキストに <code>name</code> と <code>superpower</code> に基づいた新しいスパン属性を追加します</li></ul></li></ul></li></ul><h4 id=プロデューサー関数からのトレースコンテキスト伝播>プロデューサー関数からのトレースコンテキスト伝播<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>以下のコードはプロデューサー関数内で次のステップを実行します：</p><ol><li>このトレース用のトレーサーを取得する</li><li>コンテキストキャリアオブジェクトを初期化する</li><li>アクティブスパンのコンテキストをキャリアオブジェクトに注入する</li><li>Kinesis ストリームに配置しようとしているレコードを修正し、アクティブスパンのコンテキストをコンシューマーに運ぶキャリアを含める</li></ol><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>context</span><span class=p>,</span> <span class=nx>propagation</span><span class=p>,</span> <span class=nx>trace</span><span class=p>,</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@opentelemetry/api&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>tracer</span> <span class=o>=</span> <span class=nx>trace</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=s1>&#39;lambda-app&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>tracer</span><span class=p>.</span><span class=nx>startActiveSpan</span><span class=p>(</span><span class=s1>&#39;put-record&#39;</span><span class=p>,</span> <span class=kr>async</span><span class=p>(</span><span class=nx>span</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>carrier</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=nx>propagation</span><span class=p>.</span><span class=nx>inject</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>active</span><span class=p>(),</span> <span class=nx>carrier</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>eventBody</span> <span class=o>=</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span> <span class=s1>&#39;base64&#39;</span><span class=p>).</span><span class=nx>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=s2>&#34;{\&#34;tracecontext\&#34;: &#34;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>carrier</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;, \&#34;record\&#34;: &#34;</span> <span class=o>+</span> <span class=nx>eventBody</span> <span class=o>+</span> <span class=s2>&#34;}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=sb>`Record with Trace Context added:
</span></span></span><span class=line><span class=cl><span class=sb>      </span><span class=si>${</span><span class=nx>data</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>kinesis</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=nx>PutRecordCommand</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>StreamName</span><span class=o>:</span> <span class=nx>streamName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>PartitionKey</span><span class=o>:</span> <span class=s2>&#34;1234&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>Data</span><span class=o>:</span> <span class=nx>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}),</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span> <span class=o>=</span> <span class=sb>`Message placed in the Event Stream: </span><span class=si>${</span><span class=nx>streamName</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=nx>span</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span></span></span></code></pre></div><h4 id=コンシューマー関数でのトレースコンテキスト抽出>コンシューマー関数でのトレースコンテキスト抽出<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>以下のコードはコンシューマー関数内で次のステップを実行します：</p><ol><li><code>producer-lambda</code>から取得したコンテキストをキャリアオブジェクトに抽出する</li><li>現在のコンテキストからトレーサーを抽出する</li><li>抽出したコンテキスト内でトレーサーを使用して新しいスパンを開始する</li><li>ボーナス：メッセージからの値を含むカスタム属性など、追加の属性をスパンに追加する！</li><li>完了したら、スパンを終了する</li></ol><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>propagation</span><span class=p>,</span> <span class=nx>trace</span><span class=p>,</span> <span class=nx>ROOT_CONTEXT</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;@opentelemetry/api&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>carrier</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span> <span class=nx>message</span> <span class=p>).</span><span class=nx>tracecontext</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>parentContext</span> <span class=o>=</span> <span class=nx>propagation</span><span class=p>.</span><span class=nx>extract</span><span class=p>(</span><span class=nx>ROOT_CONTEXT</span><span class=p>,</span> <span class=nx>carrier</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>tracer</span> <span class=o>=</span> <span class=nx>trace</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>OTEL_SERVICE_NAME</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>span</span> <span class=o>=</span> <span class=nx>tracer</span><span class=p>.</span><span class=nx>startSpan</span><span class=p>(</span><span class=s2>&#34;Kinesis.getRecord&#34;</span><span class=p>,</span> <span class=kc>undefined</span><span class=p>,</span> <span class=nx>parentContext</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;span.kind&#34;</span><span class=p>,</span> <span class=s2>&#34;server&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>body</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span> <span class=nx>message</span> <span class=p>).</span><span class=nx>record</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;custom.tag.name&#34;</span><span class=p>,</span> <span class=nx>body</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>superpower</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;custom.tag.superpower&#34;</span><span class=p>,</span> <span class=nx>body</span><span class=p>.</span><span class=nx>superpower</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>      <span class=nx>span</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span></span></span></code></pre></div><p>これでどのような違いが生まれるか見てみましょう！</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/13</span></span></footer></article><article class=default><header class=headline></header><h1 id=lambda関数のデプロイとトレースデータの生成>Lambda関数のデプロイとトレースデータの生成</h1><p>トレースデータを収集したい関数やサービスに手動計装を適用する方法がわかったので、Lambda 関数を再度デプロイして、<code>producer-lambda</code>エンドポイントに対するトラフィックを生成していきましょう。</p><h4 id=manual-ディレクトリで-terraform-を初期化する><code>manual</code> ディレクトリで Terraform を初期化する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>新しいディレクトリにいるので、ここでもう一度 Terraform を初期化する必要があります。</p><ul><li><p><code>manual</code> ディレクトリにいることを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pwd</span></span></code></pre></div><ul><li><em>予想される出力は <strong>~/o11y-lambda-workshop/manual</strong> です</em></li></ul></li><li><p><code>manual</code> ディレクトリにいない場合は、次のコマンドを実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop/manual</span></span></code></pre></div></li><li><p>次のコマンドを実行して、このディレクトリで Terraform を初期化します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform init</span></span></code></pre></div></li></ul><h4 id=lambda-関数とその他の-aws-リソースをデプロイする>Lambda 関数とその他の AWS リソースをデプロイする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>それでは、これらのリソースを再度デプロイしましょう！</p><ul><li><p>問題がないことを確認するために、<strong>terraform plan</strong> コマンドを実行します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform plan</span></span></code></pre></div></li><li><p>続いて、<strong>terraform apply</strong> コマンドを使用して <strong>main.tf</strong> ファイルから Lambda 関数とその他のサポートリソースをデプロイします：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform apply</span></span></code></pre></div><ul><li><p><em><strong>Enter a value:</strong> プロンプトが表示されたら <strong>yes</strong> と応答します</em></p></li><li><p>これにより、以下のような出力が得られます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Outputs:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>base_url</span> <span class=o>=</span> <span class=s2>&#34;https://______.amazonaws.com/serverless_stage/producer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>consumer_function_name</span> <span class=o>=</span> <span class=s2>&#34;_____-consumer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>consumer_log_group_arn</span> <span class=o>=</span> <span class=s2>&#34;arn:aws:logs:us-east-1:############:log-group:/aws/lambda/______-consumer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>consumer_log_group_name</span> <span class=o>=</span> <span class=s2>&#34;/aws/lambda/______-consumer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>environment</span> <span class=o>=</span> <span class=s2>&#34;______-lambda-shop&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>lambda_bucket_name</span> <span class=o>=</span> <span class=s2>&#34;lambda-shop-______-______&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>producer_function_name</span> <span class=o>=</span> <span class=s2>&#34;______-producer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>producer_log_group_arn</span> <span class=o>=</span> <span class=s2>&#34;arn:aws:logs:us-east-1:############:log-group:/aws/lambda/______-producer&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>producer_log_group_name</span> <span class=o>=</span> <span class=s2>&#34;/aws/lambda/______-producer&#34;</span></span></span></code></pre></div></li></ul></li></ul><p>見ての通り、base_url の最初の部分とログループ ARN 以外は、このワークショップの自動計装部分をこの同じ時点まで実行したときと出力は概ね同じはずです。</p><h4 id=producer-lambda-エンドポイント-base_url-にトラフィックを送信する><code>producer-lambda</code> エンドポイント (base_url) にトラフィックを送信する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>もう一度、<code>name</code> と <code>superpower</code> をメッセージとしてエンドポイントに送信します。これはトレースコンテキストとともに、Kinesis ストリーム内のレコードに追加されます。</p><ul><li><p><code>manual</code> ディレクトリにいることを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pwd</span></span></code></pre></div><ul><li><em>予想される出力は <strong>~/o11y-lambda-workshop/manual</strong> です</em></li></ul></li><li><p><code>manual</code> ディレクトリにいない場合は、次のコマンドを実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop/manual</span></span></code></pre></div></li><li><p><code>send_message.py</code> スクリプトをバックグラウンドプロセスとして実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nohup ./send_message.py --name CHANGEME --superpower CHANGEME <span class=p>&amp;</span></span></span></code></pre></div></li><li><p>次に、response.logs ファイルの内容を確認して、<strong>producer-lambda</strong>エンドポイントへの呼び出しが成功しているか確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat response.logs</span></span></code></pre></div><ul><li><p>メッセージが成功していれば、画面に表示される行の中に次の出力が表示されるはずです：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Message placed in the Event Stream: hostname-eventStream&#34;</span><span class=o>}</span></span></span></code></pre></div></li><li><p>失敗した場合は、次のように表示されます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Internal server error&#34;</span><span class=o>}</span></span></span></code></pre></div></li></ul></li></ul><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
重要</summary><div class=box-content><p>これが発生した場合は、ワークショップ進行役の一人に支援を求めてください。</p></div></details><h4 id=lambda-関数のログの確認>Lambda 関数のログの確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>ログがどのようになっているか見てみましょう。</p><ul><li><p><strong>producer.logs</strong> ファイルを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat producer.logs</span></span></code></pre></div></li><li><p>そして <strong>consumer.logs</strong> ファイルを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat consumer.logs</span></span></code></pre></div></li></ul><p>ログを注意深く調べてください。</p><h5 id=ワークショップの質問><em>ワークショップの質問</em><span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h5><blockquote><p>違いに気づきましたか？</p></blockquote><h4 id=consumer-lambda-ログからのトレース-id-のコピー><code>consumer-lambda</code> ログからのトレース ID のコピー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>今回は、consumer-lambda のロググループが、我々が伝播した<code>tracecontext</code>とともに、メッセージを<code>record</code>としてログに記録しているのが確認できます。</p><p>トレース ID をコピーするには：</p><ul><li><code>Kinesis Message</code>ログの 1 つを見てみましょう。その中には<code>data</code>ディクショナリがあります</li><li>ネストされた<code>tracecontext</code>ディクショナリを見るために、<code>data</code>をより詳しく見てください</li><li><code>tracecontext</code>ディクショナリ内には、<code>traceparent</code>というキーと値のペアがあります</li><li><code>traceparent</code>キーと値のペアには、私たちが探しているトレース ID が含まれています<ul><li><code>-</code>で区切られた 4 つの値のグループがあります。トレース ID は 2 番目の文字グループです</li></ul></li><li><strong>トレース ID をコピーして保存してください。</strong> このワークショップの後のステップで必要になります</li></ul><p><a href=#R-image-1b875bd47411ddf48318d29271d08e82 class=lightbox-link><img alt="Lambda Consumer Logs、手動計装" class="lazy lightbox figure-image" loading=lazy src=../images/08-Manual-ConsumerLogs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1b875bd47411ddf48318d29271d08e82><img alt="Lambda Consumer Logs、手動計装" class="lazy lightbox lightbox-image" loading=lazy src=../images/08-Manual-ConsumerLogs.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/29</span></span></footer></article><article class=default><header class=headline></header><h1 id=splunk-apmlambda関数とトレース再び>Splunk APM、Lambda関数とトレース、再び！</h1><p>ログの外部でコンテキスト伝播の結果を確認するために、もう一度<a href=https://app.us1.signalfx.com/#/apm rel=external>Splunk APM UI</a>を参照します。</p><h4 id=splunk-apm-サービスマップで-lambda-関数を表示する>Splunk APM サービスマップで Lambda 関数を表示する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>もう一度 APM で環境のサービスマップを確認してみましょう。</p><p>Splunk Observability Cloud で：</p><ul><li><p>メインメニューの<code>APM</code>ボタンをクリックします。</p></li><li><p><code>Environment:</code>ドロップダウンからあなたの APM 環境を選択します。</p></li><li><p>APM 概要ページの右側にある<code>Service Map</code>ボタンをクリックします。これによりサービスマップビューに移動します。</p></li></ul><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
> <em>注意：トレースが Splunk APM に表示されるまで数分かかる場合があります。環境のリストにあなたの環境名が表示されるまで、ブラウザの更新ボタンを押してみてください</em></summary></details><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-question"></i>
ワークショップの質問</summary><div class=box-content><p>違いに気づきましたか？</p></div></details><ul><li>今回は、伝播されたコンテキストによってリンクされた<code>producer-lambda</code>と<code>consumer-lambda</code>関数が見えるはずです！</li></ul><p><a href=#R-image-630a5d9c860cd4a3e910d452ea25d5f6 class=lightbox-link><img alt="Splunk APM、サービスマップ" class="lazy lightbox figure-image" loading=lazy src=../images/09-Manual-ServiceMap.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-630a5d9c860cd4a3e910d452ea25d5f6><img alt="Splunk APM、サービスマップ" class="lazy lightbox lightbox-image" loading=lazy src=../images/09-Manual-ServiceMap.png></a></p><h4 id=トレース-id-で-lambda-トレースを調査する>トレース ID で Lambda トレースを調査する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>次に、環境に関連するトレースをもう一度確認します。</p><ul><li>コンシューマー関数のログからコピーしたトレース ID を、Traces 下の<code>View Trace ID</code>検索ボックスに貼り付け、<code>Go</code>をクリックします</li></ul><p><a href=#R-image-1fd9cab84a43f1fc2cc86134862c2ee5 class=lightbox-link><img alt="Splunk APM、トレースボタン" class="lazy lightbox figure-image" loading=lazy src=../images/10-Manual-TraceButton.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1fd9cab84a43f1fc2cc86134862c2ee5><img alt="Splunk APM、トレースボタン" class="lazy lightbox lightbox-image" loading=lazy src=../images/10-Manual-TraceButton.png></a></p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>トレース ID は、私たちが伝播したトレースコンテキストの一部でした。</p></div></details><p>最も一般的な 2 つの伝播規格について読むことができます：</p><ol><li><a href=https:///www.w3.org/TR/trace-context/#traceparent-header rel=external>W3C</a></li><li><a href=https://github.com/openzipkin/b3-propagation#overall-process rel=external>B3</a></li></ol><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-question"></i>
ワークショップの質問</summary><div class=box-content><p>私たちはどちらを使用していますか？</p><ul><li><em>私たちの NodeJS 関数をサポートする Splunk Distribution of Opentelemetry JS は、<a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/nodejs/splunk-nodejs-otel-distribution.html#defaults-of-the-splunk-distribution-of-opentelemetry-js rel=external>デフォルト</a>で<code>W3C</code>標準を使用しています</em></li></ul></div></details><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-question"></i>
ワークショップの質問</summary><div class=box-content><p>ボーナス質問：W3C ヘッダーと B3 ヘッダーを混在させるとどうなりますか？</p></div></details><p><a href=#R-image-0d927dae94b6986aa053b8f8cbb60833 class=lightbox-link><img alt="Splunk APM、IDによるトレース" class="lazy lightbox figure-image" loading=lazy src=../images/11-Manual-TraceByID.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0d927dae94b6986aa053b8f8cbb60833><img alt="Splunk APM、IDによるトレース" class="lazy lightbox lightbox-image" loading=lazy src=../images/11-Manual-TraceByID.png></a></p><p><code>consumer-lambda</code>スパンをクリックしてください。</p><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-question"></i>
ワークショップの質問</summary><div class=box-content><p>あなたのメッセージからの属性を見つけることができますか？</p></div></details><p><a href=#R-image-e2f44c229adb027ba26d40dd204bc468 class=lightbox-link><img alt="Splunk APM、スパンタグ" class="lazy lightbox figure-image" loading=lazy src=../images/12-Manual-SpanTags.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e2f44c229adb027ba26d40dd204bc468><img alt="Splunk APM、スパンタグ" class="lazy lightbox lightbox-image" loading=lazy src=../images/12-Manual-SpanTags.png></a></p><h3 id=クリーンアップ>クリーンアップ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>いよいよワークショップの最後に来ました。後片付けをしましょう！</p><h4 id=send_messageの停止><code>send_message</code>の停止<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><ul><li><p><code>send_message.py</code>スクリプトがまだ実行中の場合は、次のコマンドで停止します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>fg</span></span></code></pre></div><ul><li>これによりバックグラウンドプロセスがフォアグラウンドに移動します。</li><li>次に<code>[CONTROL-C]</code>を押してプロセスを終了できます。</li></ul></li></ul><h4 id=すべての-aws-リソースを破棄する>すべての AWS リソースを破棄する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>Terraform は個々のリソースの状態をデプロイメントとして管理するのに優れています。定義に変更があっても、デプロイされたリソースを更新することもできます。しかし、一からやり直すために、リソースを破棄し、このワークショップの手動計装部分の一部として再デプロイします。</p><p>以下の手順に従ってリソースを破棄してください：</p><ul><li><p><code>manual</code>ディレクトリにいることを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pwd</span></span></code></pre></div><ul><li><em>予想される出力は <strong>~/o11y-lambda-workshop/manual</strong> です</em></li></ul></li><li><p><code>manual</code>ディレクトリにいない場合は、次のコマンドを実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-workshop/manual</span></span></code></pre></div></li><li><p>以前にデプロイした Lambda 関数とその他の AWS リソースを破棄します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform destroy</span></span></code></pre></div><ul><li><code>Enter a value:</code>プロンプトが表示されたら<code>yes</code>と応答します</li><li>これにより、リソースが破棄され、クリーンな環境が残ります</li></ul></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/13</span></span></footer></article><article class=default><header class=headline></header><h1 id=結論>結論</h1><p>Lambda Tracing ワークショップを終えたことをおめでとうございます！自動計装を手動のステップで補完して、<code>producer-lambda</code>関数のコンテキストを Kinesis ストリーム内のレコードを介して<code>consumer-lambda</code>関数に送信する方法を見てきました。これにより、期待される分散トレースを構築し、Splunk APM で両方の関数間の関係をコンテキスト化することができました。</p><p><a href=#R-image-93a59c32a15defbfc872d90f9c020d7a class=lightbox-link><img alt=完全に計装されたLambdaアプリケーション class="lazy lightbox figure-image" loading=lazy src=../images/13-Architecture_Instrumented.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-93a59c32a15defbfc872d90f9c020d7a><img alt=完全に計装されたLambdaアプリケーション class="lazy lightbox lightbox-image" loading=lazy src=../images/13-Architecture_Instrumented.png></a></p><p>これで、2 つの異なる関数を手動でリンクしてトレースを構築することができます。これは、自動計装や第三者のシステムがコンテキスト伝播を標準でサポートしていない場合や、より関連性の高いトレース分析のためにカスタム属性をトレースに追加したい場合に役立ちます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/13</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetrydockerk8sを実践で学ぶ>OpenTelemetry、Docker、K8sを実践で学ぶ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Derek Mitchell</span></span><p>このワークショップでは、以下の項目について実践経験を積むことができます：</p><ul><li>Linux および Kubernetes 環境で、Splunk ディストリビューションの OpenTelemetry .NET を使用してコレクターのデプロイと.NET アプリケーションの計装を実践します。</li><li>.NET アプリケーションの「Docker 化」、Docker での実行、そして Splunk OpenTelemetry 計装の追加を実践します。</li><li>Helm を使用した K8s 環境での Splunk ディストロのコレクターのデプロイを実践します。その後、コレクター設定をカスタマイズし、問題のトラブルシューティングを行います。</li></ul><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>このワークショップを最も簡単にナビゲートする方法は以下を使用することです：</p><ul><li>このページの右上にある左右の矢印（<strong>&lt;</strong> | <strong>></strong>）</li><li>キーボードの左（◀️）と右（▶️）のカーソルキー</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><section><h1 class=a11y-only>OpenTelemetry、Docker、K8sを実践で学ぶのサブセクション</h1><article class=default><header class=headline></header><h1 id=ec2インスタンスへの接続>EC2インスタンスへの接続</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<h2 id=ec2-インスタンスへ接続>EC2 インスタンスへ接続<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>各参加者のために、AWS/EC2 に Ubuntu Linux インスタンスを用意しました。</p><p>インストラクターから提供された IP アドレスとパスワードを使用して、以下のいずれかの方法で EC2 インスタンスに接続してください：</p><ul><li>Mac OS / Linux<ul><li>ssh splunk@IP アドレス</li></ul></li><li>Windows 10+<ul><li>OpenSSH クライアントを使用</li></ul></li><li>以前のバージョンの Windows<ul><li>Putty を使用</li></ul></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/16</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetryコレクターのデプロイ>OpenTelemetryコレクターのデプロイ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=opentelemetry-コレクターのアンインストール>OpenTelemetry コレクターのアンインストール<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>EC2 インスタンスには、すでに Splunk Distribution の OpenTelemetry コレクターの古いバージョンが
インストールされている可能性があります。先に進む前に、次のコマンドを使用してアンインストールしましょう：</p><div class=tab-panel data-tab-group=R-tabs-459b451d88e781f63692375e49873992><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-ea95fbbb0f43a5162bf08b9c33d95346 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-459b451d88e781f63692375e49873992","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-06ef4f7969ed0df3f702144b7f768b73 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-459b451d88e781f63692375e49873992","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-ea95fbbb0f43a5162bf08b9c33d95346 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh<span class=p>;</span>
</span></span><span class=line><span class=cl>sudo sh /tmp/splunk-otel-collector.sh --uninstall</span></span></code></pre></div></div></div><div id=R-tab-id-06ef4f7969ed0df3f702144b7f768b73 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Reading package lists... Done
</span></span><span class=line><span class=cl>Building dependency tree... Done
</span></span><span class=line><span class=cl>Reading state information... Done
</span></span><span class=line><span class=cl>The following packages will be REMOVED:
</span></span><span class=line><span class=cl>  splunk-otel-collector*
</span></span><span class=line><span class=cl><span class=m>0</span> upgraded, <span class=m>0</span> newly installed, <span class=m>1</span> to remove and <span class=m>167</span> not upgraded.
</span></span><span class=line><span class=cl>After this operation, <span class=m>766</span> MB disk space will be freed.
</span></span><span class=line><span class=cl><span class=o>(</span>Reading database ... <span class=m>157441</span> files and directories currently installed.<span class=o>)</span>
</span></span><span class=line><span class=cl>Removing splunk-otel-collector <span class=o>(</span>0.92.0<span class=o>)</span> ...
</span></span><span class=line><span class=cl><span class=o>(</span>Reading database ... <span class=m>147373</span> files and directories currently installed.<span class=o>)</span>
</span></span><span class=line><span class=cl>Purging configuration files <span class=k>for</span> splunk-otel-collector <span class=o>(</span>0.92.0<span class=o>)</span> ...
</span></span><span class=line><span class=cl>Scanning processes...
</span></span><span class=line><span class=cl>Scanning candidates...
</span></span><span class=line><span class=cl>Scanning linux images...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Running kernel seems to be up-to-date.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Restarting services...
</span></span><span class=line><span class=cl> systemctl restart fail2ban.service falcon-sensor.service
</span></span><span class=line><span class=cl>Service restarts being deferred:
</span></span><span class=line><span class=cl> systemctl restart networkd-dispatcher.service
</span></span><span class=line><span class=cl> systemctl restart unattended-upgrades.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>No containers need to be restarted.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>No user sessions are running outdated binaries.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>No VM guests are running outdated hypervisor <span class=o>(</span>qemu<span class=o>)</span> binaries on this host.
</span></span><span class=line><span class=cl>Successfully removed the splunk-otel-collector package</span></span></code></pre></div></div></div></div></div><h2 id=opentelemetry-collector-のデプロイ>OpenTelemetry collector のデプロイ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Linux EC2 インスタンスに、Splunk Distribution の OpenTelemetry コレクターの最新バージョンをデプロイしましょう。</p><p>これは<code>curl</code>を使用してコレクターバイナリをダウンロードし、特定の引数を指定して実行することで可能です。
これらの引数は、データを送信する realm、使用するアクセストークン、
およびデータを送信するデプロイメント環境をコレクターに指示します。</p><blockquote><p>Splunk Observability Cloud におけるデプロイメント環境とは、システムまたはアプリケーションの個別のデプロイメントであり、同じアプリケーションの他のデプロイメントの設定と重複しない設定を行うことができます。</p></blockquote><div class=tab-panel data-tab-group=R-tabs-ac1f031c85f804d71cf0a439dd2ca8d6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-635e9c62e338bba72d112c783cedd75e aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-ac1f031c85f804d71cf0a439dd2ca8d6","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-178e74641cf8e1adc8bb2e495fc16aff aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-ac1f031c85f804d71cf0a439dd2ca8d6","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-635e9c62e338bba72d112c783cedd75e data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--realm <span class=nv>$REALM</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--mode agent <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--without-instrumentation <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--deployment-environment otel-<span class=nv>$INSTANCE</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-- <span class=nv>$ACCESS_TOKEN</span></span></span></code></pre></div></div></div><div id=R-tab-id-178e74641cf8e1adc8bb2e495fc16aff data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Splunk OpenTelemetry Collector Version: latest
</span></span><span class=line><span class=cl>Memory Size in MIB: <span class=m>512</span>
</span></span><span class=line><span class=cl>Realm: us1
</span></span><span class=line><span class=cl>Ingest Endpoint: https://ingest.us1.signalfx.com
</span></span><span class=line><span class=cl>API Endpoint: https://api.us1.signalfx.com
</span></span><span class=line><span class=cl>HEC Endpoint: https://ingest.us1.signalfx.com/v1/log
</span></span><span class=line><span class=cl>etc.</span></span></code></pre></div></div></div></div></div><p>詳細については、<a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/collector-linux/install-linux.html#otel-install-linux rel=external>インストーラースクリプトを使用した Linux 用コレクターのインストール</a>
を参照してください。</p><h2 id=コレクターが実行中であることを確認>コレクターが実行中であることを確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>インスタンスでコレクターが正常に実行されていることを確認しましょう。</p><blockquote><p>ステータスコマンドを終了するには、Ctrl + C を押します。</p></blockquote><div class=tab-panel data-tab-group=R-tabs-507c9ff1c9add5e0e232260ca78223d2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-9440e76d434c6d498749bcdb5f924780 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-507c9ff1c9add5e0e232260ca78223d2","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-ab69e88203541204eba95ddd6424ac72 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-507c9ff1c9add5e0e232260ca78223d2","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-9440e76d434c6d498749bcdb5f924780 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-ab69e88203541204eba95ddd6424ac72 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>● splunk-otel-collector.service - Splunk OpenTelemetry Collector
</span></span><span class=line><span class=cl>     Loaded: loaded <span class=o>(</span>/lib/systemd/system/splunk-otel-collector.service<span class=p>;</span> enabled<span class=p>;</span> vendor preset: enabled<span class=o>)</span>
</span></span><span class=line><span class=cl>    Drop-In: /etc/systemd/system/splunk-otel-collector.service.d
</span></span><span class=line><span class=cl>             └─service-owner.conf
</span></span><span class=line><span class=cl>     Active: active <span class=o>(</span>running<span class=o>)</span> since Fri 2024-12-20 00:13:14 UTC<span class=p>;</span> 45s ago
</span></span><span class=line><span class=cl>   Main PID: <span class=m>14465</span> <span class=o>(</span>otelcol<span class=o>)</span>
</span></span><span class=line><span class=cl>      Tasks: <span class=m>9</span> <span class=o>(</span>limit: 19170<span class=o>)</span>
</span></span><span class=line><span class=cl>     Memory: 117.4M
</span></span><span class=line><span class=cl>        CPU: 681ms
</span></span><span class=line><span class=cl>     CGroup: /system.slice/splunk-otel-collector.service
</span></span><span class=line><span class=cl>             └─14465 /usr/bin/otelcol</span></span></code></pre></div></div></div></div></div><h2 id=コレクターログの確認方法>コレクターログの確認方法<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><code>journalctl</code>を使用してコレクターログを表示できます：</p><blockquote><p>ログの監視を終了するには、Ctrl + C を押します。</p></blockquote><div class=tab-panel data-tab-group=R-tabs-600f46bfaf2e75338cc22ca20f0327f0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-e959efdb36bfe03e942d28f4b9f30f20 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-600f46bfaf2e75338cc22ca20f0327f0","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-bbbe61cb2f228830614482f838882566 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-600f46bfaf2e75338cc22ca20f0327f0","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-e959efdb36bfe03e942d28f4b9f30f20 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo journalctl -u splunk-otel-collector -f -n <span class=m>100</span></span></span></code></pre></div></div></div><div id=R-tab-id-bbbe61cb2f228830614482f838882566 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 systemd<span class=o>[</span>1<span class=o>]</span>: Started Splunk OpenTelemetry Collector.
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:483: Set config to /etc/otel/collector/agent_config.yaml
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:539: Set memory limit to <span class=m>460</span> MiB
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:524: Set soft memory limit <span class=nb>set</span> to <span class=m>460</span> MiB
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:373: Set garbage collection target percentage <span class=o>(</span>GOGC<span class=o>)</span> to <span class=m>400</span>
</span></span><span class=line><span class=cl>Dec <span class=m>20</span> 00:13:14 derek-1 otelcol<span class=o>[</span>14465<span class=o>]</span>: 2024/12/20 00:13:14 settings.go:414: <span class=nb>set</span> <span class=s2>&#34;SPLUNK_LISTEN_INTERFACE&#34;</span> to <span class=s2>&#34;127.0.0.1&#34;</span>
</span></span><span class=line><span class=cl>etc.</span></span></code></pre></div></div></div></div></div><h2 id=コレクターの設定>コレクターの設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このコレクターが使用している設定はどこで見つけられるでしょうか？</p><p>その設定は<code>/etc/otel/collector</code>ディレクトリにあります。コレクターを<code>agent</code>モードで
インストールしたため、コレクター設定は<code>agent_config.yaml</code>ファイルにあります。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=netアプリケーションのデプロイ>.NETアプリケーションのデプロイ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h2 id=前提条件>前提条件<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>アプリケーションをデプロイする前に、インスタンスに.NET 8 SDK をインストールする必要があります。</p><div class=tab-panel data-tab-group=R-tabs-85e1e3321ae6f39afca41a75a7b9d900><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c1551595e8ed40f59dd45c1e3deb3373 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-85e1e3321ae6f39afca41a75a7b9d900","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-10a4650474b58733df9b87b8fc6e8adf aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-85e1e3321ae6f39afca41a75a7b9d900","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-c1551595e8ed40f59dd45c1e3deb3373 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  sudo apt-get install -y dotnet-sdk-8.0</span></span></code></pre></div></div></div><div id=R-tab-id-10a4650474b58733df9b87b8fc6e8adf data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Hit:1 http://us-west-1.ec2.archive.ubuntu.com/ubuntu jammy InRelease
</span></span><span class=line><span class=cl>Hit:2 http://us-west-1.ec2.archive.ubuntu.com/ubuntu jammy-updates InRelease
</span></span><span class=line><span class=cl>Hit:3 http://us-west-1.ec2.archive.ubuntu.com/ubuntu jammy-backports InRelease
</span></span><span class=line><span class=cl>Hit:4 http://security.ubuntu.com/ubuntu jammy-security InRelease
</span></span><span class=line><span class=cl>Ign:5 https://splunk.jfrog.io/splunk/otel-collector-deb release InRelease
</span></span><span class=line><span class=cl>Hit:6 https://splunk.jfrog.io/splunk/otel-collector-deb release Release
</span></span><span class=line><span class=cl>Reading package lists... Done
</span></span><span class=line><span class=cl>Reading package lists... Done
</span></span><span class=line><span class=cl>Building dependency tree... Done
</span></span><span class=line><span class=cl>Reading state information... Done
</span></span><span class=line><span class=cl>The following additional packages will be installed:
</span></span><span class=line><span class=cl>  aspnetcore-runtime-8.0 aspnetcore-targeting-pack-8.0 dotnet-apphost-pack-8.0 dotnet-host-8.0 dotnet-hostfxr-8.0 dotnet-runtime-8.0 dotnet-targeting-pack-8.0 dotnet-templates-8.0 liblttng-ust-common1
</span></span><span class=line><span class=cl>  liblttng-ust-ctl5 liblttng-ust1 netstandard-targeting-pack-2.1-8.0
</span></span><span class=line><span class=cl>The following NEW packages will be installed:
</span></span><span class=line><span class=cl>  aspnetcore-runtime-8.0 aspnetcore-targeting-pack-8.0 dotnet-apphost-pack-8.0 dotnet-host-8.0 dotnet-hostfxr-8.0 dotnet-runtime-8.0 dotnet-sdk-8.0 dotnet-targeting-pack-8.0 dotnet-templates-8.0
</span></span><span class=line><span class=cl>  liblttng-ust-common1 liblttng-ust-ctl5 liblttng-ust1 netstandard-targeting-pack-2.1-8.0
</span></span><span class=line><span class=cl><span class=m>0</span> upgraded, <span class=m>13</span> newly installed, <span class=m>0</span> to remove and <span class=m>0</span> not upgraded.
</span></span><span class=line><span class=cl>Need to get <span class=m>138</span> MB of archives.
</span></span><span class=line><span class=cl>After this operation, <span class=m>495</span> MB of additional disk space will be used.
</span></span><span class=line><span class=cl>etc.</span></span></code></pre></div></div></div></div></div><p>詳細については、<a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux-ubuntu-install?tabs=dotnet8&pivots=os-linux-ubuntu-2404" rel=external>Ubuntu に.NET SDK または.NET Runtime をインストールする</a>
を参照してください。</p><h2 id=net-アプリケーションの確認>.NET アプリケーションの確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ターミナルで、アプリケーションディレクトリに移動します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/docker-k8s-otel/helloworld</span></span></code></pre></div><p>このワークショップでは、シンプルな「Hello World」.NET アプリケーションを使用します。主要なロジックは
HelloWorldController.cs ファイルにあります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>HelloWorldController</span> <span class=p>:</span> <span class=n>ControllerBase</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>HelloWorldController</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>HelloWorldController</span><span class=p>(</span><span class=n>ILogger</span><span class=p>&lt;</span><span class=n>HelloWorldController</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=na>
</span></span></span><span class=line><span class=cl><span class=na>    [HttpGet(&#34;/hello/{name?}&#34;)]</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>string</span> <span class=n>Hello</span><span class=p>(</span><span class=kt>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=kt>string</span><span class=p>.</span><span class=n>IsNullOrEmpty</span><span class=p>(</span><span class=n>name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>           <span class=n>logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>&#34;/hello endpoint invoked anonymously&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>           <span class=k>return</span> <span class=s>&#34;Hello, World!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=p>.</span><span class=n>LogInformation</span><span class=p>(</span><span class=s>&#34;/hello endpoint invoked by {name}&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>String</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;Hello, {0}!&#34;</span><span class=p>,</span> <span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h2 id=net-アプリケーションのビルドと実行>.NET アプリケーションのビルドと実行<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>以下のコマンドを使用してアプリケーションをビルドできます：</p><div class=tab-panel data-tab-group=R-tabs-9b52e84f75df82858b2a1d86bb81b1d5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-396982ea7b7fca1194ce390eea2f90d8 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9b52e84f75df82858b2a1d86bb81b1d5","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-d9798826d481dba252f2689e15025f8b aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9b52e84f75df82858b2a1d86bb81b1d5","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-396982ea7b7fca1194ce390eea2f90d8 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet build</span></span></code></pre></div></div></div><div id=R-tab-id-d9798826d481dba252f2689e15025f8b data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>MSBuild version 17.8.5+b5265ef37 <span class=k>for</span> .NET
</span></span><span class=line><span class=cl>  Determining projects to restore...
</span></span><span class=line><span class=cl>  All projects are up-to-date <span class=k>for</span> restore.
</span></span><span class=line><span class=cl>  helloworld -&gt; /home/splunk/workshop/docker-k8s-otel/helloworld/bin/Debug/net8.0/helloworld.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Build succeeded.
</span></span><span class=line><span class=cl>    <span class=m>0</span> Warning<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=m>0</span> Error<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Time Elapsed 00:00:02.04</span></span></code></pre></div></div></div></div></div><p>ビルドが成功したら、次のように実行できます：</p><div class=tab-panel data-tab-group=R-tabs-a9910c1df821f8e3e23bf3d90c5ecb1c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-6da2bc219d20ee59bfcf2cc13d6389e4 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a9910c1df821f8e3e23bf3d90c5ecb1c","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-dbb4a92044029d51010a7a038efff098 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a9910c1df821f8e3e23bf3d90c5ecb1c","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-6da2bc219d20ee59bfcf2cc13d6389e4 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet run</span></span></code></pre></div></div></div><div id=R-tab-id-dbb4a92044029d51010a7a038efff098 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Building...
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime<span class=o>[</span>14<span class=o>]</span>
</span></span><span class=line><span class=cl>      Now listening on: http://localhost:8080
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      Application started. Press Ctrl+C to shut down.
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      Hosting environment: Development
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      Content root path: /home/splunk/workshop/docker-k8s-otel/helloworld</span></span></code></pre></div></div></div></div></div><p>実行したら、Ubuntu インスタンスへの SSH 接続を 2 つ目のターミナルで開き、curl を使用してアプリケーションにアクセスします：</p><div class=tab-panel data-tab-group=R-tabs-99033deceef19c62c4546bfde24d3900><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-de4eec44cbc69bfd7e0aa249cf024511 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-99033deceef19c62c4546bfde24d3900","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-a2bf3b91746af9dd66d86468d2107029 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-99033deceef19c62c4546bfde24d3900","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-de4eec44cbc69bfd7e0aa249cf024511 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello</span></span></code></pre></div></div></div><div id=R-tab-id-a2bf3b91746af9dd66d86468d2107029 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Hello, World!</span></span></code></pre></div></div></div></div></div><p>名前を渡すこともできます：</p><div class=tab-panel data-tab-group=R-tabs-2bddfd48aa46952d430235b4df701f01><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c43ef988fd45b28bbde77d9258a7e84b aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-2bddfd48aa46952d430235b4df701f01","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-1570e6c71a30ebe4389276b29358797a aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-2bddfd48aa46952d430235b4df701f01","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-c43ef988fd45b28bbde77d9258a7e84b data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello/Tom</span></span></code></pre></div></div></div><div id=R-tab-id-1570e6c71a30ebe4389276b29358797a data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Hello, Tom!</span></span></code></pre></div></div></div></div></div><blockquote><p>次のステップに進む前に、Ctrl + C を押して Helloworld アプリを終了してください。</p></blockquote><h2 id=次のステップ>次のステップ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>アプリケーションを OpenTelemetry で計装するために使用できる 3 つの方法は何でしょうか？</p><p><a href=#R-image-c32dcbe5ac045e8f76be42d85065072a class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/NetInstrumentation.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c32dcbe5ac045e8f76be42d85065072a><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/NetInstrumentation.png></a></p><p>オプションの詳細については、<a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/otel-dotnet/instrumentation/instrument-dotnet-application.html rel=external>Splunk Observability Cloud 用の.NET アプリケーションの計装</a>
を参照してください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetryでnetアプリケーションを計装する>OpenTelemetryで.NETアプリケーションを計装する</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<h2 id=splunk-distribution-of-opentelemetry-のダウンロード>Splunk Distribution of OpenTelemetry のダウンロード<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このワークショップでは、NuGet パッケージを使用せず、Splunk Distribution of OpenTelemetry を
手動でインストールします。</p><p>最新の<code>splunk-otel-dotnet-install.sh</code>ファイルをダウンロードすることから始めます。
これを使用して.NET アプリケーションを計装します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/docker-k8s-otel/helloworld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -sSfL https://github.com/signalfx/splunk-otel-dotnet/releases/latest/download/splunk-otel-dotnet-install.sh -O</span></span></code></pre></div><p>インストールプロセスの詳細については、<a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/otel-dotnet/instrumentation/instrument-dotnet-application.html#install-the-splunk-distribution-of-opentelemetry-net-manually rel=external>Splunk Distribution of OpenTelemetry .NET の手動インストール</a>
を参照してください。</p><h2 id=ディストリビューションのインストール>ディストリビューションのインストール<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ターミナルで、以下のようにディストリビューションをインストールします</p><div class=tab-panel data-tab-group=R-tabs-13bb93be3b7e46c704550b884d190ab5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-34e104cd0eea51c74e9c53372f0fcf5d aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-13bb93be3b7e46c704550b884d190ab5","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-f7ce49d128d0577772861f34d0c154ea aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-13bb93be3b7e46c704550b884d190ab5","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-34e104cd0eea51c74e9c53372f0fcf5d data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sh ./splunk-otel-dotnet-install.sh</span></span></code></pre></div></div></div><div id=R-tab-id-f7ce49d128d0577772861f34d0c154ea data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Downloading v1.8.0 <span class=k>for</span> linux-glibc <span class=o>(</span>/tmp/tmp.m3tSdtbmge/splunk-opentelemetry-dotnet-linux-glibc-x64.zip<span class=o>)</span>...</span></span></code></pre></div></div></div></div></div><blockquote><p>注意：上記のコマンドを実行する際には、ARCHITECTURE 環境変数を含める必要がある場合があります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ARCHITECTURE</span><span class=o>=</span>x64 sh ./splunk-otel-dotnet-install.sh</span></span></code></pre></div></blockquote><h2 id=計装の有効化>計装の有効化<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>次に、OpenTelemetry 計装を有効化できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. <span class=nv>$HOME</span>/.splunk-otel-dotnet/instrument.sh</span></span></code></pre></div><h2 id=デプロイメント環境の設定>デプロイメント環境の設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>デプロイメント環境を設定して、データが Splunk Observability Cloud 内の独自の
環境に流れるようにしましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span><span class=o>=</span>deployment.environment<span class=o>=</span>otel-<span class=nv>$INSTANCE</span></span></span></code></pre></div><h2 id=計装を使用したアプリケーションの実行>計装を使用したアプリケーションの実行<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>以下のようにアプリケーションを実行できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet run</span></span></code></pre></div><h2 id=チャレンジ>チャレンジ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Linux インスタンスから C#アプリケーションによってエクスポートされているトレースをどのように確認できるでしょうか？</p><details><summary><b>答えを見るにはここをクリック</b></summary><p>これを行う方法は 2 つあります：</p><ol><li><code>dotnet run</code>コマンドの開始時に<code>OTEL_TRACES_EXPORTER=otlp,console</code>を追加することで、トレースが OTLP 経由でコレクターに書き込まれるとともに、コンソールにも書き込まれるようになります。</li></ol><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>OTEL_TRACES_EXPORTER</span><span class=o>=</span>otlp,console dotnet run</span></span></code></pre></div><ol start=2><li>あるいは、コレクター設定にデバッグエクスポーターを追加し、それをトレースパイプラインに追加することで、トレースがコレクターログに書き込まれるようになります。</li></ol><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>jaeger, otlp, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlphttp, signalfx, debug]</span></span></span></code></pre></div></details><h2 id=アプリケーションへのアクセス>アプリケーションへのアクセス<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>アプリケーションが実行中になったら、2 つ目の SSH ターミナルを使用して curl でアクセスします：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello</span></span></code></pre></div><p>以前と同様に、<code>Hello, World!</code>が返されるはずです。</p><p>トレースログを有効にした場合は、以下のようなトレースがコンソールまたはコレクターログに書き込まれているのを確認できるはずです：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>info: Program<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      /hello endpoint invoked anonymously
</span></span><span class=line><span class=cl>Activity.TraceId:            c7bbf57314e4856447508cd8addd49b0
</span></span><span class=line><span class=cl>Activity.SpanId:             1c92ac653c3ece27
</span></span><span class=line><span class=cl>Activity.TraceFlags:         Recorded
</span></span><span class=line><span class=cl>Activity.ActivitySourceName: Microsoft.AspNetCore
</span></span><span class=line><span class=cl>Activity.DisplayName:        GET /hello/<span class=o>{</span>name?<span class=o>}</span>
</span></span><span class=line><span class=cl>Activity.Kind:               Server
</span></span><span class=line><span class=cl>Activity.StartTime:          2024-12-20T00:45:25.6551267Z
</span></span><span class=line><span class=cl>Activity.Duration:           00:00:00.0006464
</span></span><span class=line><span class=cl>Activity.Tags:
</span></span><span class=line><span class=cl>    server.address: localhost
</span></span><span class=line><span class=cl>    server.port: <span class=m>8080</span>
</span></span><span class=line><span class=cl>    http.request.method: GET
</span></span><span class=line><span class=cl>    url.scheme: http
</span></span><span class=line><span class=cl>    url.path: /hello
</span></span><span class=line><span class=cl>    network.protocol.version: 1.1
</span></span><span class=line><span class=cl>    user_agent.original: curl/7.81.0
</span></span><span class=line><span class=cl>    http.route: /hello/<span class=o>{</span>name?<span class=o>}</span>
</span></span><span class=line><span class=cl>    http.response.status_code: <span class=m>200</span>
</span></span><span class=line><span class=cl>Resource associated with Activity:
</span></span><span class=line><span class=cl>    splunk.distro.version: 1.8.0
</span></span><span class=line><span class=cl>    telemetry.distro.name: splunk-otel-dotnet
</span></span><span class=line><span class=cl>    telemetry.distro.version: 1.8.0
</span></span><span class=line><span class=cl>    service.name: helloworld
</span></span><span class=line><span class=cl>    os.type: linux
</span></span><span class=line><span class=cl>    os.description: Ubuntu 22.04.5 LTS
</span></span><span class=line><span class=cl>    os.build_id: 6.8.0-1021-aws
</span></span><span class=line><span class=cl>    os.name: Ubuntu
</span></span><span class=line><span class=cl>    os.version: 22.04
</span></span><span class=line><span class=cl>    host.name: derek-1
</span></span><span class=line><span class=cl>    host.id: 20cf15fcc7054b468647b73b8f87c556
</span></span><span class=line><span class=cl>    process.owner: splunk
</span></span><span class=line><span class=cl>    process.pid: <span class=m>16997</span>
</span></span><span class=line><span class=cl>    process.runtime.description: .NET 8.0.11
</span></span><span class=line><span class=cl>    process.runtime.name: .NET
</span></span><span class=line><span class=cl>    process.runtime.version: 8.0.11
</span></span><span class=line><span class=cl>    container.id: <span class=m>2</span>
</span></span><span class=line><span class=cl>    telemetry.sdk.name: opentelemetry
</span></span><span class=line><span class=cl>    telemetry.sdk.language: dotnet
</span></span><span class=line><span class=cl>    telemetry.sdk.version: 1.9.0
</span></span><span class=line><span class=cl>    deployment.environment: otel-derek-1</span></span></code></pre></div><h2 id=splunk-observability-cloud-でのアプリケーションの確認>Splunk Observability Cloud でのアプリケーションの確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>セットアップが完了したので、トレースが<strong>Splunk Observability Cloud</strong>に送信されていることを確認しましょう。アプリケーションが初回デプロイされた場合、データが表示されるまでに数分かかる場合があることに注意してください。</p><p>APM にナビゲートし、Environment ドロップダウンを使用してあなたの環境（つまり<code>otel-instancename</code>）を選択します。</p><p>すべてが正しくデプロイされている場合、サービスのリストに<code>helloworld</code>が表示されるはずです：</p><p><a href=#R-image-9a04dde880c4fd4aff371f405826b919 class=lightbox-link><img alt="APM Overview" class="lazy lightbox figure-image" loading=lazy src=../images/apm_overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9a04dde880c4fd4aff371f405826b919><img alt="APM Overview" class="lazy lightbox lightbox-image" loading=lazy src=../images/apm_overview.png></a></p><p>右側の<strong>Service Map</strong>をクリックしてサービスマップを表示します。</p><p><a href=#R-image-bcde4643107f08b6c3dc027db928a39e class=lightbox-link><img alt="Service Map" class="lazy lightbox figure-image" loading=lazy src=../images/service_map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bcde4643107f08b6c3dc027db928a39e><img alt="Service Map" class="lazy lightbox lightbox-image" loading=lazy src=../images/service_map.png></a></p><p>次に、右側の<strong>Traces</strong>をクリックして、このアプリケーションでキャプチャされたトレースを確認します。</p><p><a href=#R-image-56ea4499e4d73a45412e2d3e436d6bd0 class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/traces.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-56ea4499e4d73a45412e2d3e436d6bd0><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/traces.png></a></p><p>個別のトレースは以下のように表示されるはずです：</p><p><a href=#R-image-a96be975db3dc2420e23cae8f3e43154 class=lightbox-link><img alt=Traces class="lazy lightbox figure-image" loading=lazy src=../images/trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a96be975db3dc2420e23cae8f3e43154><img alt=Traces class="lazy lightbox lightbox-image" loading=lazy src=../images/trace.png></a></p><blockquote><p>次のステップに進む前に、Ctrl + C を押して Helloworld アプリを終了してください。</p></blockquote><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=アプリケーションのdocker化>アプリケーションのDocker化</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>このワークショップの後半では、.NET アプリケーションを Kubernetes クラスターにデプロイします。</p><p>しかし、どのようにそれを行うのでしょうか？</p><p>最初のステップは、アプリケーション用の Docker イメージを作成することです。これは
アプリケーションの「Docker 化」として知られており、プロセスは<code>Dockerfile</code>の作成から始まります。</p><p>しかし、まず重要な用語を定義しましょう。</p><h2 id=重要な用語>重要な用語<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=docker-とは何ですか>Docker とは何ですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><blockquote><p>「Docker は、コンテナと呼ばれる緩い分離環境でアプリケーションをパッケージ化して実行する機能を提供します。分離とセキュリティにより、指定されたホスト上で同時に多くのコンテナを実行できます。コンテナは軽量で、アプリケーションの実行に必要なすべてを含んでいるため、ホストにインストールされているものに依存する必要がありません。」</p></blockquote><p>ソース: <a href=https://docs.docker.com/get-started/docker-overview/ rel=external>https://docs.docker.com/get-started/docker-overview/</a></p><h3 id=コンテナとは何ですか>コンテナとは何ですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><blockquote><p>「コンテナは、アプリのコンポーネントごとの分離されたプロセスです。各コンポーネントは&mldr;独自の分離された環境で実行され、マシン上の他のすべてのものから完全に分離されています。」</p></blockquote><p>ソース: <a href=https://docs.docker.com/get-started/docker-concepts/the-basics/what-is-a-container/ rel=external>https://docs.docker.com/get-started/docker-concepts/the-basics/what-is-a-container/</a></p><h3 id=コンテナイメージとは何ですか>コンテナイメージとは何ですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><blockquote><p>「コンテナイメージは、コンテナを実行するためのすべてのファイル、バイナリ、ライブラリ、および設定を含む標準化されたパッケージです。」</p></blockquote><h3 id=dockerfile>Dockerfile<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><blockquote><p>「Dockerfile は、コンテナイメージを作成するために使用されるテキストベースのドキュメントです。実行するコマンド、コピーするファイル、起動コマンドなどに関するイメージビルダーへの指示を提供します。」</p></blockquote><h2 id=dockerfile-の作成>Dockerfile の作成<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><code>/home/splunk/workshop/docker-k8s-otel/helloworld</code>ディレクトリに<code>Dockerfile</code>という名前のファイルを作成しましょう。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk/workshop/docker-k8s-otel/helloworld</span></span></code></pre></div><p>ファイルの作成には vi または nano を使用できます。vi を使用した例を示します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi Dockerfile</span></span></code></pre></div><p>新しく開いたファイルに以下の内容をコピー＆ペーストします：</p><blockquote><p>以下のテキストを貼り付ける前に、vi で「i」を押して挿入モードに入ってください。</p></blockquote><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/aspnet:8.0 AS base</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/sdk:8.0 AS build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /src</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> <span class=o>[</span><span class=s2>&#34;helloworld.csproj&#34;</span>, <span class=s2>&#34;helloworld/&#34;</span><span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet restore <span class=s2>&#34;./helloworld/./helloworld.csproj&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;/src/helloworld&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet build <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> build AS publish</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet publish <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/publish /p:UseAppHost<span class=o>=</span>false<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>publish /app/publish .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;helloworld.dll&#34;</span><span class=p>]</span></span></span></code></pre></div><blockquote><p>vi での変更を保存するには、<code>esc</code>キーを押してコマンドモードに入り、<code>:wq!</code>と入力してから<code>enter/return</code>キーを押します。</p></blockquote><p>これはすべて何を意味するのでしょうか？詳しく見てみましょう。</p><h2 id=dockerfile-の詳細解説>Dockerfile の詳細解説<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>この例では、マルチステージ Dockerfile を使用しており、Docker イメージ作成プロセスを以下のステージに分けています：</p><ul><li>Base（ベース）</li><li>Build（ビルド）</li><li>Publish（パブリッシュ）</li><li>Final（最終）</li></ul><p>マルチステージアプローチはより複雑ですが、デプロイメント用により
軽量なランタイムイメージを作成することができます。以下では、
これらの各ステージの目的を説明します。</p><h3 id=ベースステージ>ベースステージ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>ベースステージでは、アプリを実行するユーザー、作業ディレクトリを定義し、
アプリにアクセスするために使用されるポートを公開します。
これは Microsoft の<code>mcr.microsoft.com/dotnet/aspnet:8.0</code>イメージをベースにしています：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/aspnet:8.0 AS base</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span></span></span></code></pre></div><p>なお、<code>mcr.microsoft.com/dotnet/aspnet:8.0</code>イメージには.NET runtime のみが含まれており、
SDK は含まれていないため、比較的軽量です。これは Debian 12 Linux
distribution がベースになっています。ASP.NET Core Runtime Docker イメージの詳細については
<a href=https://github.com/dotnet/dotnet-docker/blob/main/README.aspnet.md rel=external>GitHub</a>で確認できます。</p><h3 id=build-ステージ>Build ステージ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Dockerfile の次のステージは build ステージです。このステージでは、
<code>mcr.microsoft.com/dotnet/sdk:8.0</code>イメージが使用されます。これも Debian 12 がベースになっていますが、
runtime だけでなく完全な<a href=https://github.com/dotnet/dotnet-docker/blob/main/README.sdk.md rel=external>.NET SDK</a>が含まれています。</p><p>このステージでは<code>.csproj</code>ファイルを build イメージにコピーし、その後<code>dotnet restore</code>を使用して
アプリケーションが使用する依存関係をダウンロードします。</p><p>次に、アプリケーションコードを build イメージにコピーし、
<code>dotnet build</code>を使用してプロジェクトとその依存関係を
<code>.dll</code>バイナリのセットにビルドします：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/sdk:8.0 AS build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /src</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> <span class=o>[</span><span class=s2>&#34;helloworld.csproj&#34;</span>, <span class=s2>&#34;helloworld/&#34;</span><span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet restore <span class=s2>&#34;./helloworld/./helloworld.csproj&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;/src/helloworld&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet build <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/build</span></span></code></pre></div><h3 id=publish-ステージ>Publish ステージ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>3 番目のステージは publish で、これは Microsoft イメージではなく build ステージイメージをベースにしています。このステージでは、<code>dotnet publish</code>を使用して
アプリケーションとその依存関係を deployment 用にパッケージ化します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> build AS publish</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet publish <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/publish /p:UseAppHost<span class=o>=</span>false</span></span></code></pre></div><h3 id=final-ステージ>Final ステージ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>4 番目のステージは最終ステージで、これは base
ステージイメージをベースにしています（build と publish ステージよりも軽量）。publish ステージイメージからの出力をコピーし、
アプリケーションの entry point を定義します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> base AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>publish /app/publish .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;helloworld.dll&#34;</span><span class=p>]</span></span></span></code></pre></div><h2 id=docker-イメージのビルド>Docker イメージのビルド<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><code>Dockerfile</code>ができたので、これを使用してアプリケーションを含む Docker イメージを
ビルドできます：</p><div class=tab-panel data-tab-group=R-tabs-c7965e11e7b2d69d2add6198775805c9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4b62bbaa8e61fd33ea29f71f1fe30291 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c7965e11e7b2d69d2add6198775805c9","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-e69849a0a11ccde137349c9d6656815d aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c7965e11e7b2d69d2add6198775805c9","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-4b62bbaa8e61fd33ea29f71f1fe30291 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t helloworld:1.0 .</span></span></code></pre></div></div></div><div id=R-tab-id-e69849a0a11ccde137349c9d6656815d data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
</span></span><span class=line><span class=cl>            Install the buildx component to build images with BuildKit:
</span></span><span class=line><span class=cl>            https://docs.docker.com/go/buildx/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Sending build context to Docker daemon  281.1kB
</span></span><span class=line><span class=cl>Step 1/19 : FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
</span></span><span class=line><span class=cl>8.0: Pulling from dotnet/aspnet
</span></span><span class=line><span class=cl>af302e5c37e9: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>91ab5e0aabf0: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>1c1e4530721e: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>1f39ca6dcc3a: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>ea20083aa801: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>64c242a4f561: Pull <span class=nb>complete</span>
</span></span><span class=line><span class=cl>Digest: sha256:587c1dd115e4d6707ff656d30ace5da9f49cec48e627a40bbe5d5b249adc3549
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> mcr.microsoft.com/dotnet/aspnet:8.0
</span></span><span class=line><span class=cl> ---&gt; 0ee5d7ddbc3b
</span></span><span class=line><span class=cl>Step 2/19 : USER app
</span></span><span class=line><span class=cl>etc,</span></span></code></pre></div></div></div></div></div><p>これは、現在のディレクトリの<code>Dockerfile</code>を使用して<code>helloworld:1.0</code>のタグでイメージをビルドするよう Docker に指示します。</p><p>以下のコマンドで正常に作成されたことを確認できます：</p><div class=tab-panel data-tab-group=R-tabs-0e279e36455c2f57ba4c6fc94eb6b169><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-9937326304572a72c1e7442e37cd7ab4 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-0e279e36455c2f57ba4c6fc94eb6b169","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-b6572c8b63334e4fb54e0f484e016e40 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-0e279e36455c2f57ba4c6fc94eb6b169","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-9937326304572a72c1e7442e37cd7ab4 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images</span></span></code></pre></div></div></div><div id=R-tab-id-b6572c8b63334e4fb54e0f484e016e40 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
</span></span><span class=line><span class=cl>helloworld   1.0       db19077b9445   <span class=m>20</span> seconds ago   217MB</span></span></code></pre></div></div></div></div></div><h2 id=docker-イメージのテスト>Docker イメージのテスト<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><blockquote><p>続行する前に、以前に開始したアプリケーションがインスタンス上で実行されていないことを確認してください。</p></blockquote><p>Docker イメージを使用して以下のようにアプリケーションを実行できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --name helloworld <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--detach <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--expose <span class=m>8080</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--network<span class=o>=</span>host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>helloworld:1.0</span></span></code></pre></div><blockquote><p>注意：<code>--network=host</code>パラメータを含めて、Docker コンテナが
インスタンス上のリソースにアクセスできるようにしています。これは後でアプリケーションが
localhost 上で実行されているコレクターにデータを送信する必要がある場合に重要です。</p></blockquote><p>Docker コンテナが実行されていることを確認しましょう：</p><div class=tab-panel data-tab-group=R-tabs-b850711543d7fcea92ed95fbd30803e2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-20f4bd3abc0bee783e4c10e826c5ca2f aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b850711543d7fcea92ed95fbd30803e2","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-791451611ef99e2cef8bb8c8bfa891a6 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-b850711543d7fcea92ed95fbd30803e2","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-20f4bd3abc0bee783e4c10e826c5ca2f data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps</span></span></code></pre></div></div></div><div id=R-tab-id-791451611ef99e2cef8bb8c8bfa891a6 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE            COMMAND                  CREATED       STATUS       PORTS     NAMES
</span></span><span class=line><span class=cl>5f5b9cd56ac5   helloworld:1.0   <span class=s2>&#34;dotnet helloworld.d…&#34;</span>   <span class=m>2</span> mins ago    Up <span class=m>2</span> mins              helloworld</span></span></code></pre></div></div></div></div></div><p>以前と同様にアプリケーションにアクセスできます：</p><div class=tab-panel data-tab-group=R-tabs-989e03c4ba8ce74dc3aea44971e06ffa><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-cd6a902adcfa194e6742d7baede382c1 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-989e03c4ba8ce74dc3aea44971e06ffa","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-698d6c32ead67cc186de563a547a0261 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-989e03c4ba8ce74dc3aea44971e06ffa","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-cd6a902adcfa194e6742d7baede382c1 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello/Docker</span></span></code></pre></div></div></div><div id=R-tab-id-698d6c32ead67cc186de563a547a0261 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Hello, Docker!</span></span></code></pre></div></div></div></div></div><p>おめでとうございます。ここまで到達したということは、.NET アプリケーションの Docker 化に成功したということです。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=dockerfileに計装を追加する>Dockerfileに計装を追加する</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>アプリケーションを正常に Docker 化したので、次に OpenTelemetry による計装 を追加しましょう。</p><p>これは、Linux で実行しているアプリケーションを計装した際の手順と似ていますが、
注意すべきいくつかの重要な違いがあります。</p><h2 id=dockerfile-の更新>Dockerfile の更新<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><code>/home/splunk/workshop/docker-k8s-otel/helloworld</code>ディレクトリの<code>Dockerfile</code>を更新しましょう。</p><p>Dockerfile で.NET アプリケーションがビルドされた後、以下の操作を行いたいと思います：</p><ul><li><code>splunk-otel-dotnet-install.sh</code>をダウンロードして実行するために必要な依存関係を追加する</li><li>Splunk OTel .NET インストーラーをダウンロードする</li><li>ディストリビューションをインストールする</li></ul><p>Dockerfile のビルドステージに以下を追加できます。vi で Dockerfile を開きましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/workshop/docker-k8s-otel/helloworld/Dockerfile</span></span></code></pre></div><blockquote><p>vi では「i」キーを押して編集モードに入ります
&lsquo;NEW CODE&rsquo;とマークされている行を Dockerfile のビルドステージセクションに貼り付けてください：</p></blockquote><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># CODE ALREADY IN YOUR DOCKERFILE:</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/sdk:8.0 AS build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /src</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> <span class=o>[</span><span class=s2>&#34;helloworld.csproj&#34;</span>, <span class=s2>&#34;helloworld/&#34;</span><span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet restore <span class=s2>&#34;./helloworld/./helloworld.csproj&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;/src/helloworld&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet build <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: add dependencies for splunk-otel-dotnet-install.sh</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> apt-get install -y unzip<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: download Splunk OTel .NET installer</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> curl -sSfL https://github.com/signalfx/splunk-otel-dotnet/releases/latest/download/splunk-otel-dotnet-install.sh -O<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: install the distribution</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> sh ./splunk-otel-dotnet-install.sh</span></span></code></pre></div><p>次に、以下の変更で Dockerfile の最終ステージを更新します：</p><ul><li>ビルドイメージから最終イメージに/root/.splunk-otel-dotnet/をコピーする</li><li>entrypoint.sh ファイルもコピーする</li><li><code>OTEL_SERVICE_NAME</code>と<code>OTEL_RESOURCE_ATTRIBUTES</code>環境変数を設定する</li><li><code>ENTRYPOINT</code>を<code>entrypoint.sh</code>に設定する</li></ul><p>最も簡単な方法は、最終ステージ全体を以下の内容で置き換えることです：</p><blockquote><p><strong>重要</strong> Dockerfile の<code>$INSTANCE</code>をあなたのインスタンス名に置き換えてください。
インスタンス名は<code>echo $INSTANCE</code>を実行することで確認できます。</p></blockquote><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># CODE ALREADY IN YOUR DOCKERFILE</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: Copy instrumentation file tree</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;//home/app/.splunk-otel-dotnet&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>build /root/.splunk-otel-dotnet/ .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># CODE ALREADY IN YOUR DOCKERFILE</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>publish /app/publish .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: copy the entrypoint.sh script</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> entrypoint.sh .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: set OpenTelemetry environment variables</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>OTEL_SERVICE_NAME</span><span class=o>=</span>helloworld
</span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span><span class=o>=</span><span class=s1>&#39;deployment.environment=otel-$INSTANCE&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: replace the prior ENTRYPOINT command with the following two lines</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span> <span class=s2>&#34;entrypoint.sh&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;helloworld.dll&#34;</span><span class=p>]</span></span></span></code></pre></div><blockquote><p>vi での変更を保存するには、<code>esc</code>キーを押してコマンドモードに入り、<code>:wq!</code>と入力してから<code>enter/return</code>キーを押します。</p></blockquote><p>これらすべての変更の後、Dockerfile は以下のようになるはずです：</p><blockquote><p><strong>重要</strong> このコンテンツを自分の Dockerfile にコピー＆ペーストする場合は、
Dockerfile の<code>$INSTANCE</code>をあなたのインスタンス名に置き換えてください。
インスタンス名は<code>echo $INSTANCE</code>を実行することで確認できます。</p></blockquote><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/aspnet:8.0 AS base</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> mcr.microsoft.com/dotnet/sdk:8.0 AS build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=s> /src</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> <span class=o>[</span><span class=s2>&#34;helloworld.csproj&#34;</span>, <span class=s2>&#34;helloworld/&#34;</span><span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet restore <span class=s2>&#34;./helloworld/./helloworld.csproj&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;/src/helloworld&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> dotnet build <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: add dependencies for splunk-otel-dotnet-install.sh</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> apt-get install -y unzip<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: download Splunk OTel .NET installer</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> curl -sSfL https://github.com/signalfx/splunk-otel-dotnet/releases/latest/download/splunk-otel-dotnet-install.sh -O<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: install the distribution</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> sh ./splunk-otel-dotnet-install.sh<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> build AS publish</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>BUILD_CONFIGURATION</span><span class=o>=</span>Release
</span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet publish <span class=s2>&#34;./helloworld.csproj&#34;</span> -c <span class=nv>$BUILD_CONFIGURATION</span> -o /app/publish /p:UseAppHost<span class=o>=</span>false<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: Copy instrumentation file tree</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> &#34;//home/app/.splunk-otel-dotnet&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>build /root/.splunk-otel-dotnet/ .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>publish /app/publish .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: copy the entrypoint.sh script</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> entrypoint.sh .<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: set OpenTelemetry environment variables</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>OTEL_SERVICE_NAME</span><span class=o>=</span>helloworld
</span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span><span class=o>=</span><span class=s1>&#39;deployment.environment=otel-$INSTANCE&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># NEW CODE: replace the prior ENTRYPOINT command with the following two lines</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span> <span class=s2>&#34;entrypoint.sh&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;helloworld.dll&#34;</span><span class=p>]</span></span></span></code></pre></div><h2 id=entrypointsh-ファイルの作成>entrypoint.sh ファイルの作成<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>また、<code>/home/splunk/workshop/docker-k8s-otel/helloworld</code>フォルダに<code>entrypoint.sh</code>という名前のファイルを
以下の内容で作成する必要があります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/workshop/docker-k8s-otel/helloworld/entrypoint.sh</span></span></code></pre></div><p>次に、新しく作成したファイルに以下のコードを貼り付けます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># Read in the file of environment settings</span>
</span></span><span class=line><span class=cl>. /<span class=nv>$HOME</span>/.splunk-otel-dotnet/instrument.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Then run the CMD</span>
</span></span><span class=line><span class=cl><span class=nb>exec</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span></span></span></code></pre></div><blockquote><p>vi での変更を保存するには、<code>esc</code>キーを押してコマンドモードに入り、<code>:wq!</code>と入力してから<code>enter/return</code>キーを押します。</p></blockquote><p><code>entrypoint.sh</code>スクリプトは、計装に含まれる instrument.sh スクリプトが環境変数を<strong>コンテナ起動時に</strong>取得するために必要です。これにより、各プラットフォームに対して環境変数が正しく設定されることが保証されます。</p><blockquote><p>「なぜ Linux ホスト上で OpenTelemetry .NET instrumentation を有効化したときのように、
Dockerfile に以下のコマンドを含めるだけではだめなのか？」と疑問に思うかもしれません。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>RUN</span> . <span class=nv>$HOME</span>/.splunk-otel-dotnet/instrument.sh</span></span></code></pre></div><p>この方法の問題点は、各 Dockerfile RUN ステップが新しいコンテナと新しいシェルで実行されることです。
あるシェルで環境変数を設定しようとしても、後で見ることはできません。
この問題は、ここで行ったようにエントリポイントスクリプトを使用することで解決されます。
この問題についての詳細は、こちらの<a href=https://stackoverflow.com/questions/55921914/how-to-source-a-script-with-environment-variables-in-a-docker-build-process rel=external>Stack Overflow の投稿</a>を参照してください。</p></blockquote><h2 id=docker-イメージのビルド>Docker イメージのビルド<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry .NET instrumentation を含む新しい Docker イメージをビルドしましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -t helloworld:1.1 .</span></span></code></pre></div><blockquote><p>注：以前のバージョンと区別するために、異なるバージョン（1.1）を使用しています。
古いバージョンをクリーンアップするには、以下のコマンドでコンテナ ID を取得します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps -a</span></span></code></pre></div><p>次に、以下のコマンドでコンテナを削除します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rm &lt;old container id&gt; --force</span></span></code></pre></div><p>次にコンテナイメージ ID を取得します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images <span class=p>|</span> grep 1.0</span></span></code></pre></div><p>最後に、以下のコマンドで古いイメージを削除できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker image rm &lt;old image id&gt;</span></span></code></pre></div></blockquote><h2 id=アプリケーションの実行>アプリケーションの実行<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>新しい Docker イメージを実行しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --name helloworld <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--detach <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--expose <span class=m>8080</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--network<span class=o>=</span>host <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>helloworld:1.1</span></span></code></pre></div><p>以下を使用してアプリケーションにアクセスできます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8080/hello</span></span></code></pre></div><p>トラフィックを生成するために上記のコマンドを数回実行しましょう。</p><p>1 分ほど経過したら、Splunk Observability Cloud に新しいトレースが表示されることを確認します。</p><blockquote><p>あなたの特定の環境でトレースを探すことを忘れないでください。</p></blockquote><h2 id=トラブルシューティング>トラブルシューティング<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Splunk Observability Cloud にトレースが表示されない場合は、以下のようにトラブルシューティングを行うことができます。</p><p>まず、コレクター設定ファイルを編集用に開きます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>次に、トレースパイプラインにデバッグエクスポーターを追加します。これにより、トレースがコレクターログに書き込まれるようになります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, http_forwarder, zpages, smartagent]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>jaeger, otlp, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># NEW CODE: デバッグエクスポーターをここに追加</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlphttp, signalfx, debug]</span></span></span></code></pre></div><p>その後、コレクターを再起動して設定変更を適用します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p><code>journalctl</code>を使用してコレクターログを表示できます：</p><blockquote><p>ログの追跡を終了するには、Ctrl + C を押します。</p></blockquote><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo journalctl -u splunk-otel-collector -f -n <span class=m>100</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=k8sでopentelemetryコレクターをインストール>K8sでOpenTelemetryコレクターをインストール</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<h2 id=ワークショップパート-1-の振り返り>ワークショップパート 1 の振り返り<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップのこの時点で、以下を正常に完了しました：</p><ul><li>Linux ホストに Splunk distribution of OpenTelemetry コレクターをデプロイ</li><li>Splunk Observability Cloud にトレースとメトリクスを送信するよう設定</li><li>.NET アプリケーションをデプロイし、OpenTelemetry で計装</li><li>.NET アプリケーションを Docker 化し、o11y cloud にトレースが流れることを確認</li></ul><p>上記のステップを<strong>完了していない</strong>場合は、ワークショップの残りの部分に進む前に以下のコマンドを実行してください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /home/splunk/workshop/docker-k8s-otel/docker/Dockerfile /home/splunk/workshop/docker-k8s-otel/helloworld/
</span></span><span class=line><span class=cl>cp /home/splunk/workshop/docker-k8s-otel/docker/entrypoint.sh /home/splunk/workshop/docker-k8s-otel/helloworld/</span></span></code></pre></div><blockquote><p><strong>重要</strong> これらのファイルがコピーされたら、<code>/home/splunk/workshop/docker-k8s-otel/helloworld/Dockerfile</code> を
エディターで開き、Dockerfile の <code>$INSTANCE</code> をあなたのインスタンス名に置き換えてください。
インスタンス名は <code>echo $INSTANCE</code> を実行することで確認できます。</p></blockquote><h2 id=ワークショップパート-2-の紹介>ワークショップパート 2 の紹介<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップの次の部分では、Kubernetes でアプリケーションを実行したいと思います。
そのため、Kubernetes クラスターに Splunk distribution of OpenTelemetry コレクターを
デプロイする必要があります。</p><p>まず、いくつかの重要な用語を定義しましょう。</p><h3 id=重要な用語>重要な用語<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><h4 id=kubernetes-とは何ですか>Kubernetes とは何ですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p><em>「Kubernetes は、宣言的な設定と自動化の両方を促進する、コンテナ化されたワークロードとサービスを管理するためのポータブルで拡張可能なオープンソースプラットフォームです。」</em></p><p>Source: <a href=https://kubernetes.io/docs/concepts/overview/ rel=external>https://kubernetes.io/docs/concepts/overview/</a></p><p>Dockerfile に小さな修正を加えた後、アプリケーション用に以前ビルドした Docker イメージを
Kubernetes クラスターにデプロイします。</p><h4 id=helm-とは何ですか>Helm とは何ですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>Helm は Kubernetes 用のパッケージマネージャーです。</p><p><em>「最も複雑な Kubernetes アプリケーションだとしても、定義、インストール、アップグレード役立ちます」</em></p><h4 id=helm-を使用したコレクターのインストール>Helm を使用したコレクターのインストール<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><p>プロダクト内ウィザードではなくコマンドラインを使用して、コレクターをインストールするための独自の
<code>helm</code>コマンドを作成しましょう。</p><p>まず、helm リポジトリを追加する必要があります：ます。」</p><p>Source: <a href=https://helm.sh/ rel=external>https://helm.sh/</a></p><p>Helm を使用して K8s クラスターに OpenTelemetry コレクターをデプロイします。</p><h4 id=helm-の利点>Helm の利点<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h4><ul><li>複雑性の管理<ul><li>数十のマニフェストファイルではなく、単一の values.yaml ファイルを扱う</li></ul></li><li>簡単な更新<ul><li>インプレースアップグレード</li></ul></li><li>ロールバックサポート<ul><li>helm rollback を使用してリリースの古いバージョンにロールバック</li></ul></li></ul><h2 id=ホストコレクターのアンインストール>ホストコレクターのアンインストール<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>先に進む前に、Linux ホストに先ほどインストールしたコレクターを削除しましょう：
\</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh<span class=p>;</span>
</span></span><span class=line><span class=cl>sudo sh /tmp/splunk-otel-collector.sh --uninstall</span></span></code></pre></div><h2 id=helm-を利用して-collector-をインストールする>Helm を利用して Collector をインストールする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ウィザードの代わりに、コマンドラインを利用して collector をインストールします。</p><p>まず初めに、Helm リポジトリに登録する必要があります</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart</span></span></code></pre></div><p>リポジトリが最新であることを確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo update</span></span></code></pre></div><p>helm チャートのデプロイメントを設定するために、<code>/home/splunk</code>ディレクトリに<code>values.yaml</code>という名前の新しいファイルを作成しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># swith to the /home/splunk dir</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /home/splunk
</span></span><span class=line><span class=cl><span class=c1># create a values.yaml file in vi</span>
</span></span><span class=line><span class=cl>vi values.yaml</span></span></code></pre></div><blockquote><p>Press ‘i’ to enter into insert mode in vi before pasting the text below.　&ldquo;i"を押下すると vi はインサートモードになります。ペースト前に押下してください</p></blockquote><p>そして、下記のコードをコピーしてください</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>root_path</span><span class=p>:</span><span class=w> </span><span class=l>/hostfs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>disk</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>exclude_mount_points</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>match_type</span><span class=p>:</span><span class=w> </span><span class=l>regexp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mount_points</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/var/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/snap/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/boot/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/boot</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/opt/orbstack/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/mnt/machines/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=l>/Users/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>load</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>network</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>paging</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>processes</span><span class=p>:</span><span class=w> </span><span class=kc>null</span></span></span></code></pre></div><blockquote><p>vi での変更を保存するには、<code>esc</code>キーを押してコマンドモードに入り、<code>:wq!</code>と入力してから<code>enter/return</code>キーを押します。</p></blockquote><p>次のコマンドを使用してコレクターをインストールできます：</p><div class=tab-panel data-tab-group=R-tabs-805a08e798e754680629dedfdfc5c4d8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c51ffed8337a10b5c4370e8b470e57c5 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-805a08e798e754680629dedfdfc5c4d8","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-cbf8c61b9ae90a4e101971c2adc3848d aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-805a08e798e754680629dedfdfc5c4d8","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-c51ffed8337a10b5c4370e8b470e57c5 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  helm install splunk-otel-collector --version 0.136.0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=otel-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f values.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-cbf8c61b9ae90a4e101971c2adc3848d data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri Dec <span class=m>20</span> 01:01:43 <span class=m>2024</span>
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>1</span>
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm us1.</span></span></code></pre></div></div></div></div></div><h2 id=コレクターが実行中であることを確認>コレクターが実行中であることを確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>以下のコマンドでコレクターが実行されているかどうかを確認できます：</p><div class=tab-panel data-tab-group=R-tabs-82379cd33927159e704d79368e12113f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-11f93caa9d5df108d31fce16886f33be aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-82379cd33927159e704d79368e12113f","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-ec103843e00763420239cab4779872a3 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-82379cd33927159e704d79368e12113f","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-11f93caa9d5df108d31fce16886f33be data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div id=R-tab-id-ec103843e00763420239cab4779872a3 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                                                         READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-8xvk8                            1/1     Running   <span class=m>0</span>          49s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-d54857c89-tx7qr   1/1     Running   <span class=m>0</span>          49s</span></span></code></pre></div></div></div></div></div><h2 id=o11y-cloud-で-k8s-クラスターを確認>O11y Cloud で K8s クラスターを確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Splunk Observability Cloud で、<strong>Infrastructure</strong> -> <strong>Kubernetes</strong> -> <strong>Kubernetes Clusters</strong>にナビゲートし、
クラスター名（<code>$INSTANCE-cluster</code>）を検索します：</p><p><a href=#R-image-ade1fda130c4048ea239a7c70200f83a class=lightbox-link><img alt="Kubernetes node" class="lazy lightbox figure-image" loading=lazy src=../images/k8snode.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ade1fda130c4048ea239a7c70200f83a><img alt="Kubernetes node" class="lazy lightbox lightbox-image" loading=lazy src=../images/k8snode.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/09/08</span></span></footer></article><article class=default><header class=headline></header><h1 id=アプリケーションをk8sにデプロイ>アプリケーションをK8sにデプロイ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<h2 id=dockerfile-の更新>Dockerfile の更新<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Kubernetes では、環境変数は通常、Docker イメージに組み込むのではなく<code>.yaml</code>マニフェストファイルで管理されます。そこで、Dockerfile から以下の 2 つの環境変数を削除しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/workshop/docker-k8s-otel/helloworld/Dockerfile</span></span></code></pre></div><p>次に、以下の 2 つの環境変数を削除します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>OTEL_SERVICE_NAME</span><span class=o>=</span>helloworld
</span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>OTEL_RESOURCE_ATTRIBUTES</span><span class=o>=</span><span class=s1>&#39;deployment.environment=otel-$INSTANCE&#39;</span></span></span></code></pre></div><blockquote><p>vi での変更を保存するには、<code>esc</code>キーを押してコマンドモードに入り、<code>:wq!</code>と入力してから<code>enter/return</code>キーを押します。</p></blockquote><h2 id=新しい-docker-イメージのビルド>新しい Docker イメージのビルド<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>環境変数を除外した新しい Docker イメージをビルドしましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk/workshop/docker-k8s-otel/helloworld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker build -t helloworld:1.2 .</span></span></code></pre></div><blockquote><p>Note: we&rsquo;ve used a different version (1.2) to distinguish the image from our earlier version.
To clean up the older versions, run the following command to get the container id:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker ps -a</span></span></code></pre></div><p>Then run the following command to delete the container:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rm &lt;old container id&gt; --force</span></span></code></pre></div><p>Now we can get the container image id:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images <span class=p>|</span> grep 1.1</span></span></code></pre></div><p>Finally, we can run the following command to delete the old image:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker image rm &lt;old image id&gt;</span></span></code></pre></div></blockquote><h2 id=docker-イメージを-kubernetes-にインポート>Docker イメージを Kubernetes にインポート<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>通常であれば、Docker イメージを Docker Hub などのリポジトリにプッシュします。
しかし、今回のセッションでは、k3s に直接インポートする回避策を使用します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Import the image into k3d</span>
</span></span><span class=line><span class=cl>sudo k3d image import helloworld:1.2 --cluster <span class=nv>$INSTANCE</span>-cluster</span></span></code></pre></div><h2 id=net-アプリケーションのデプロイ>.NET アプリケーションのデプロイ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><blockquote><p>ヒント：vi で編集モードに入るには「i」キーを押します。変更を保存するには、<code>esc</code>キーを押してコマンドモードに入り、<code>:wq!</code>と入力してから<code>enter/return</code>キーを押します。</p></blockquote><p>.NET アプリケーションを K8s にデプロイするために、<code>/home/splunk</code>に<code>deployment.yaml</code>という名前のファイルを作成しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/deployment.yaml</span></span></code></pre></div><p>そして以下を貼り付けます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/library/helloworld:1.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span></span></span></code></pre></div><details class="box cstyle notices tip expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<i class="fa-fw fas fa-lightbulb"></i>
Kubernetes における Deployment とは？</summary><div class=box-content><p>deployment.yaml ファイルは、deployment リソースを定義するために使用される kubernetes 設定ファイルです。このファイルは Kubernetes でアプリケーションを管理するための基盤となります！deployment 設定は deployment の <strong><em>望ましい状態</em></strong> を定義し、Kubernetes が <strong><em>実際の状態</em></strong> がそれと一致するよう保証します。これにより、アプリケーション pod の自己修復が可能になり、アプリケーションの簡単な更新やロールバックも可能になります。</p></div></details><p>次に、同じディレクトリに<code>service.yaml</code>という名前の 2 つ目のファイルを作成します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi /home/splunk/service.yaml</span></span></code></pre></div><p>そして以下を貼り付けます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span></span></span></code></pre></div><details class="box cstyle notices tip expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<i class="fa-fw fas fa-lightbulb"></i>
Kubernetes における Service とは？</summary><div class=box-content><p>Kubernetes の Service は抽象化レイヤーであり、仲介者のような役割を果たします。Pod にアクセスするための固定 IP アドレスや DNS 名を提供し、時間の経過とともに Pod が追加、削除、または交換されても同じままです。</p></div></details><p>これらのマニフェストファイルを使用してアプリケーションをデプロイできます：</p><div class=tab-panel data-tab-group=R-tabs-4cf49641678b4cc79549bb7d1639e374><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-068efdb24397ff2f7c96b4944bb9ef6d aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4cf49641678b4cc79549bb7d1639e374","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-17e127a609e126e9b67f35897b687e1f aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4cf49641678b4cc79549bb7d1639e374","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-068efdb24397ff2f7c96b4944bb9ef6d data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># create the deployment</span>
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># create the service</span>
</span></span><span class=line><span class=cl>kubectl apply -f service.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-17e127a609e126e9b67f35897b687e1f data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/helloworld created
</span></span><span class=line><span class=cl>service/helloworld created</span></span></code></pre></div></div></div></div></div><h2 id=アプリケーションのテスト>アプリケーションのテスト<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>アプリケーションにアクセスするには、まず IP アドレスを取得する必要があります：</p><div class=tab-panel data-tab-group=R-tabs-eac041038be53f49a34cdcc8a900c07f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-ee8dfcf6f01133efbba839b20ee72f3d aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-eac041038be53f49a34cdcc8a900c07f","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-ef9721666e0f65fd452c35613e361475 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-eac041038be53f49a34cdcc8a900c07f","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-ee8dfcf6f01133efbba839b20ee72f3d data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe svc helloworld <span class=p>|</span> grep IP:</span></span></code></pre></div></div></div><div id=R-tab-id-ef9721666e0f65fd452c35613e361475 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>IP:                10.43.102.103</span></span></code></pre></div></div></div></div></div><p>その後、前のコマンドから返された Cluster IP を使用してアプリケーションにアクセスできます。
例：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://10.43.102.103:8080/hello/Kubernetes</span></span></code></pre></div><h2 id=opentelemetry-の設定>OpenTelemetry の設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>.NET OpenTelemetry 計装はすでに Docker イメージに組み込まれています。しかし、データの送信先を指定するためにいくつかの環境変数を設定する必要があります。</p><p>先ほど作成した<code>deployment.yaml</code>ファイルに以下を追加します：</p><blockquote><p><strong>重要</strong> 以下の YAML の<code>$INSTANCE</code>をあなたのインスタンス名に置き換えてください。
インスタンス名は<code>echo $INSTANCE</code>を実行することで確認できます。</p></blockquote><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;helloworld&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=otel-$INSTANCE&#34;</span></span></span></code></pre></div><p>完全な<code>deployment.yaml</code>ファイルは以下のようになります（<code>$INSTANCE</code>ではなく<strong>あなたの</strong>インスタンス名を使用してください）：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/library/helloworld:1.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;helloworld&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=otel-$INSTANCE&#34;</span></span></span></code></pre></div><p>以下のコマンドで変更を適用します：</p><div class=tab-panel data-tab-group=R-tabs-07d993770be35003cc429bd5d937a4f3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-302910e66c7a6aeb93d6148d7a68d16e aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-07d993770be35003cc429bd5d937a4f3","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-f5f513f23f883b90596fedb2f7ce34ee aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-07d993770be35003cc429bd5d937a4f3","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-302910e66c7a6aeb93d6148d7a68d16e data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-f5f513f23f883b90596fedb2f7ce34ee data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/helloworld configured</span></span></code></pre></div></div></div></div></div><p>その後、<code>curl</code>を使用してトラフィックを生成します。</p><p>1 分ほど経過すると、o11y cloud でトレースが流れているのが確認できるはずです。ただし、より早くトレースを確認したい場合は、以下の方法があります&mldr;</p><h2 id=チャレンジ>チャレンジ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>開発者として、トレース ID を素早く取得するか、コンソールフィードバックを見たい場合、deployment.yaml ファイルにどのような環境変数を追加できるでしょうか？</p><details><summary><b>答えを見るにはここをクリック</b></summary><p>セクション 4「.NET Application を OpenTelemetry で計装する」のチャレンジで思い出していただければ、<code>OTEL_TRACES_EXPORTER</code>環境変数を使って trace を console に書き込むトリックをお見せしました。この変数を deployment.yaml に追加し、アプリケーションを再 deploy して、helloworld アプリから log を tail することで、trace id を取得して Splunk Observability Cloud で trace を見つけることができます。（ワークショップの次のセクションでは、debug exporter の使用についても説明します。これは K8s 環境でアプリケーションを debug する際の典型的な方法です。）</p><p>まず、vi で deployment.yaml ファイルを開きます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi deployment.yaml</span></span></code></pre></div><p>次に、<code>OTEL_TRACES_EXPORTER</code>環境変数を追加します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;helloworld&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=YOURINSTANCE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># NEW VALUE HERE:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_TRACES_EXPORTER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;otlp,console&#34;</span></span></span></code></pre></div><p>変更を保存してからアプリケーションを再 deploy します：</p><div class=tab-panel data-tab-group=R-tabs-1e19850693f85273f3a7f8829f6da908><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-e2021639927314e4810178d48b62a89c aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1e19850693f85273f3a7f8829f6da908","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-90398df093d3374d58c8287486374bce aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-1e19850693f85273f3a7f8829f6da908","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-e2021639927314e4810178d48b62a89c data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-90398df093d3374d58c8287486374bce data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>deployment.apps/helloworld configured</span></span></code></pre></div></div></div></div></div><p>helloworld の log を tail します：</p><div class=tab-panel data-tab-group=R-tabs-e32ada8a4f267d28edb1145db705a1c6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-8c33db84efb12b35502a48a56bdabc7e aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-e32ada8a4f267d28edb1145db705a1c6","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-95ff47fc4bbfa7e0cf46e832c1db693e aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-e32ada8a4f267d28edb1145db705a1c6","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-8c33db84efb12b35502a48a56bdabc7e data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>helloworld -f</span></span></code></pre></div></div></div><div id=R-tab-id-95ff47fc4bbfa7e0cf46e832c1db693e data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>info: HelloWorldController<span class=o>[</span>0<span class=o>]</span>
</span></span><span class=line><span class=cl>      /hello endpoint invoked by K8s9
</span></span><span class=line><span class=cl>Activity.TraceId:            5bceb747cc7b79a77cfbde285f0f09cb
</span></span><span class=line><span class=cl>Activity.SpanId:             ac67afe500e7ad12
</span></span><span class=line><span class=cl>Activity.TraceFlags:         Recorded
</span></span><span class=line><span class=cl>Activity.ActivitySourceName: Microsoft.AspNetCore
</span></span><span class=line><span class=cl>Activity.DisplayName:        GET hello/<span class=o>{</span>name?<span class=o>}</span>
</span></span><span class=line><span class=cl>Activity.Kind:               Server
</span></span><span class=line><span class=cl>Activity.StartTime:          2025-02-04T15:22:48.2381736Z
</span></span><span class=line><span class=cl>Activity.Duration:           00:00:00.0027334
</span></span><span class=line><span class=cl>Activity.Tags:
</span></span><span class=line><span class=cl>    server.address: 10.43.226.224
</span></span><span class=line><span class=cl>    server.port: <span class=m>8080</span>
</span></span><span class=line><span class=cl>    http.request.method: GET
</span></span><span class=line><span class=cl>    url.scheme: http
</span></span><span class=line><span class=cl>    url.path: /hello/K8s9
</span></span><span class=line><span class=cl>    network.protocol.version: 1.1
</span></span><span class=line><span class=cl>    user_agent.original: curl/7.81.0
</span></span><span class=line><span class=cl>    http.route: hello/<span class=o>{</span>name?<span class=o>}</span>
</span></span><span class=line><span class=cl>    http.response.status_code: <span class=m>200</span>
</span></span><span class=line><span class=cl>Resource associated with Activity:
</span></span><span class=line><span class=cl>    splunk.distro.version: 1.8.0
</span></span><span class=line><span class=cl>    telemetry.distro.name: splunk-otel-dotnet
</span></span><span class=line><span class=cl>    telemetry.distro.version: 1.8.0
</span></span><span class=line><span class=cl>    os.type: linux
</span></span><span class=line><span class=cl>    os.description: Debian GNU/Linux <span class=m>12</span> <span class=o>(</span>bookworm<span class=o>)</span>
</span></span><span class=line><span class=cl>    os.build_id: 6.2.0-1018-aws
</span></span><span class=line><span class=cl>    os.name: Debian GNU/Linux
</span></span><span class=line><span class=cl>    os.version: <span class=m>12</span>
</span></span><span class=line><span class=cl>    host.name: helloworld-69f5c7988b-dxkwh
</span></span><span class=line><span class=cl>    process.owner: app
</span></span><span class=line><span class=cl>    process.pid: <span class=m>1</span>
</span></span><span class=line><span class=cl>    process.runtime.description: .NET 8.0.12
</span></span><span class=line><span class=cl>    process.runtime.name: .NET
</span></span><span class=line><span class=cl>    process.runtime.version: 8.0.12
</span></span><span class=line><span class=cl>    container.id: 39c2061d7605d8c390b4fe5f8054719f2fe91391a5c32df5684605202ca39ae9
</span></span><span class=line><span class=cl>    telemetry.sdk.name: opentelemetry
</span></span><span class=line><span class=cl>    telemetry.sdk.language: dotnet
</span></span><span class=line><span class=cl>    telemetry.sdk.version: 1.9.0
</span></span><span class=line><span class=cl>    service.name: helloworld
</span></span><span class=line><span class=cl>    deployment.environment: otel-jen-tko-1b75</span></span></code></pre></div></div></div></div></div><p>次に、別の terminal window で curl コマンドを使って trace を生成します。log を tail している console で trace id が表示されるはずです。<code>Activity.TraceId:</code>の値をコピーして、APM の Trace 検索フィールドに貼り付けてください。</p></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/10/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetryコレクター設定のカスタマイズ>OpenTelemetryコレクター設定のカスタマイズ</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<p>デフォルト設定を使用して K8s クラスターに Splunk Distribution of OpenTelemetry コレクターを
デプロイしました。このセクションでは、コレクター設定をカスタマイズする方法をいくつかの例で
説明します。</p><h2 id=コレクター設定の取得>コレクター設定の取得<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コレクター設定をカスタマイズする前に、現在の設定がどのようになっているかを
どのように確認するのでしょうか？</p><p>Kubernetes 環境では、コレクター設定は Config Map を使用して保存されます。</p><p>以下のコマンドで、クラスターに存在する config map を確認できます：</p><div class=tab-panel data-tab-group=R-tabs-c536ae1512a7f8229f0c857ed21d0fcd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2c605fd5b894de7217dcc18a46dbfdeb aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c536ae1512a7f8229f0c857ed21d0fcd","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-aa8d70492cc7399ab65404fa17163b39 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c536ae1512a7f8229f0c857ed21d0fcd","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-2c605fd5b894de7217dcc18a46dbfdeb data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-aa8d70492cc7399ab65404fa17163b39 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                                                 DATA   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-otel-k8s-cluster-receiver   <span class=m>1</span>      3h37m
</span></span><span class=line><span class=cl>splunk-otel-collector-otel-agent                  <span class=m>1</span>      3h37m</span></span></code></pre></div></div></div></div></div><blockquote><p>なぜ 2 つの config map があるのでしょうか？</p></blockquote><p>次に、以下のようにコレクターエージェントの config map を表示できます：</p><div class=tab-panel data-tab-group=R-tabs-fa1526f15b2fa91ff7a60d667923f574><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-19be708e56c1bc06a1a3f1ba3164151e aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-fa1526f15b2fa91ff7a60d667923f574","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-241ee971e61eb2a2a542caa764dedbbc aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-fa1526f15b2fa91ff7a60d667923f574","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-19be708e56c1bc06a1a3f1ba3164151e data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-agent</span></span></code></pre></div></div></div><div id=R-tab-id-241ee971e61eb2a2a542caa764dedbbc data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Name:         splunk-otel-collector-otel-agent
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Labels:       <span class=nv>app</span><span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/instance<span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/managed-by<span class=o>=</span>Helm
</span></span><span class=line><span class=cl>              app.kubernetes.io/name<span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>              app.kubernetes.io/version<span class=o>=</span>0.113.0
</span></span><span class=line><span class=cl>              <span class=nv>chart</span><span class=o>=</span>splunk-otel-collector-0.113.0
</span></span><span class=line><span class=cl>              helm.sh/chart<span class=o>=</span>splunk-otel-collector-0.113.0
</span></span><span class=line><span class=cl>              <span class=nv>heritage</span><span class=o>=</span>Helm
</span></span><span class=line><span class=cl>              <span class=nv>release</span><span class=o>=</span>splunk-otel-collector
</span></span><span class=line><span class=cl>Annotations:  meta.helm.sh/release-name: splunk-otel-collector
</span></span><span class=line><span class=cl>              meta.helm.sh/release-namespace: default
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Data</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>relay:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>exporters:
</span></span><span class=line><span class=cl>  otlphttp:
</span></span><span class=line><span class=cl>    headers:
</span></span><span class=line><span class=cl>      X-SF-Token: <span class=si>${</span><span class=nv>SPLUNK_OBSERVABILITY_ACCESS_TOKEN</span><span class=si>}</span>
</span></span><span class=line><span class=cl>    metrics_endpoint: https://ingest.us1.signalfx.com/v2/datapoint/otlp
</span></span><span class=line><span class=cl>    traces_endpoint: https://ingest.us1.signalfx.com/v2/trace/otlp
</span></span><span class=line><span class=cl>    <span class=o>(</span>followed by the rest of the collector config in yaml format<span class=o>)</span></span></span></code></pre></div></div></div></div></div><h2 id=k8s-でコレクター設定を更新する方法>K8s でコレクター設定を更新する方法<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Linux インスタンスでコレクターを実行した以前の例では、コレクター設定は
<code>/etc/otel/collector/agent_config.yaml</code>ファイルで利用可能でした。その場合にコレクター設定を
変更する必要があれば、単純にこのファイルを編集し、変更を保存してから
コレクターを再起動すればよかったのです。</p><p>K8s では、少し異なる動作をします。<code>agent_config.yaml</code>を直接変更する代わりに、
helm チャートをデプロイするために使用される<code>values.yaml</code>ファイルを変更することで
コレクター設定をカスタマイズします。</p><p><a href=https://github.com/signalfx/splunk-otel-collector-chart/blob/main/helm-charts/splunk-otel-collector/values.yaml rel=external>GitHub</a>の values.yaml ファイルには、
利用可能なカスタマイズオプションが記載されています。</p><p>例を見てみましょう。</p><h2 id=infrastructure-events-monitoring-の追加>Infrastructure Events Monitoring の追加<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>最初の例として、K8s クラスターの infrastructure events monitoring を有効にしましょう。</p><blockquote><p>これにより、charts の Events Feed セクションの一部として Kubernetes イベントを確認できるようになります。
cluster receiver は、kubernetes-events
monitor を使用して Smart Agent receiver で設定され、custom イベントを送信します。詳細については<a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/collector-kubernetes/kubernetes-config-logs.html#collect-kubernetes-events rel=external>Collect Kubernetes events</a>を参照してください。</p></blockquote><p>これは<code>values.yaml</code>ファイルに以下の行を追加することで実行されます：</p><blockquote><p>ヒント：vi での開き方と保存方法は前のステップにあります。</p></blockquote><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>agent:</span></span></span></code></pre></div><p>ファイルが保存されたら、以下のコマンドで変更を適用できます：</p><div class=tab-panel data-tab-group=R-tabs-6db7b04b5eea05fb1051d9f4483bcfd2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-f0fbbd10756e61ab57a77448734cbaa1 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-6db7b04b5eea05fb1051d9f4483bcfd2","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-b0020cdb306f055b8892bc68072375d8 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-6db7b04b5eea05fb1051d9f4483bcfd2","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-f0fbbd10756e61ab57a77448734cbaa1 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=otel-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f values.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-b0020cdb306f055b8892bc68072375d8 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Release <span class=s2>&#34;splunk-otel-collector&#34;</span> has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri Dec <span class=m>20</span> 01:17:03 <span class=m>2024</span>
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>2</span>
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm us1.</span></span></code></pre></div></div></div></div></div><p>その後、config map を表示して変更が適用されたことを確認できます：</p><div class=tab-panel data-tab-group=R-tabs-d15a1febb99d1391d2f453a5fb107fc7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-a4763f4603a9c98dc4741741d99f2668 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-d15a1febb99d1391d2f453a5fb107fc7","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-600bdc56c49170739f7aab5ac978b6cc aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-d15a1febb99d1391d2f453a5fb107fc7","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-a4763f4603a9c98dc4741741d99f2668 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-k8s-cluster-receiver</span></span></code></pre></div></div></div><div id=R-tab-id-600bdc56c49170739f7aab5ac978b6cc data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><code>smartagent/kubernetes-events</code>が agent config に含まれていることを確認してください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  smartagent/kubernetes-events:
</span></span><span class=line><span class=cl>    alwaysClusterReporter: <span class=nb>true</span>
</span></span><span class=line><span class=cl>    type: kubernetes-events
</span></span><span class=line><span class=cl>    whitelistedEvents:
</span></span><span class=line><span class=cl>    - involvedObjectKind: Pod
</span></span><span class=line><span class=cl>      reason: Created
</span></span><span class=line><span class=cl>    - involvedObjectKind: Pod
</span></span><span class=line><span class=cl>      reason: Unhealthy
</span></span><span class=line><span class=cl>    - involvedObjectKind: Pod
</span></span><span class=line><span class=cl>      reason: Failed
</span></span><span class=line><span class=cl>    - involvedObjectKind: Job
</span></span><span class=line><span class=cl>      reason: FailedCreate</span></span></code></pre></div></div></div></div></div><blockquote><p>これらの特定の変更が適用されるのは
cluster receiver config map なので、そちらを指定していることに注意してください。</p></blockquote><h2 id=debug-exporter-の追加>Debug Exporter の追加<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>collector に送信される trace と log を確認して、
Splunk に送信する前に検査したいとします。この目的のために debug exporter を使用できます。これは
OpenTelemetry 関連の問題のトラブルシューティングに役立ちます。</p><p>values.yaml ファイルの下部に以下のように debug exporter を追加しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span></span></span></code></pre></div><p>ファイルが保存されたら、以下のコマンドで変更を適用できます：</p><div class=tab-panel data-tab-group=R-tabs-c6a74ed59681a06fed77bf3545292ba4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b88544069861c28fc5326e5121536236 aria-expanded=true data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c6a74ed59681a06fed77bf3545292ba4","R-tab-f907e651164789346ae0a1e257c462d8")'>
<span class=tab-nav-text>Script</span>
</button>
<button aria-controls=R-tab-id-309a2fbae367357613b943ddd180b372 aria-expanded=false data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c6a74ed59681a06fed77bf3545292ba4","R-tab-4c50e65a8a1f9aa989870396b5c0a12b")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div id=R-tab-id-b88544069861c28fc5326e5121536236 data-tab-item=R-tab-f907e651164789346ae0a1e257c462d8 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=otel-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f values.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div></div></div><div id=R-tab-id-309a2fbae367357613b943ddd180b372 data-tab-item=R-tab-4c50e65a8a1f9aa989870396b5c0a12b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Release <span class=s2>&#34;splunk-otel-collector&#34;</span> has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri Dec <span class=m>20</span> 01:32:03 <span class=m>2024</span>
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: <span class=m>3</span>
</span></span><span class=line><span class=cl>TEST SUITE: None
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm us1.</span></span></code></pre></div></div></div></div></div><p>curl を使用してアプリケーションを数回実行してから、以下のコマンドで agent collector の log を tail します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>component</span><span class=o>=</span>otel-collector-agent -f</span></span></code></pre></div><p>以下のような trace が agent collector の log に書き込まれているのが確認できるはずです：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>2024-12-20T01:43:52.929Z info Traces {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 2}
2024-12-20T01:43:52.929Z info ResourceSpans #0
Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
Resource attributes:
     -&gt; splunk.distro.version: Str(1.8.0)
     -&gt; telemetry.distro.name: Str(splunk-otel-dotnet)
     -&gt; telemetry.distro.version: Str(1.8.0)
     -&gt; os.type: Str(linux)
     -&gt; os.description: Str(Debian GNU/Linux 12 (bookworm))
     -&gt; os.build_id: Str(6.8.0-1021-aws)
     -&gt; os.name: Str(Debian GNU/Linux)
     -&gt; os.version: Str(12)
     -&gt; host.name: Str(derek-1)
     -&gt; process.owner: Str(app)
     -&gt; process.pid: Int(1)
     -&gt; process.runtime.description: Str(.NET 8.0.11)
     -&gt; process.runtime.name: Str(.NET)
     -&gt; process.runtime.version: Str(8.0.11)
     -&gt; container.id: Str(78b452a43bbaa3354a3cb474010efd6ae2367165a1356f4b4000be031b10c5aa)
     -&gt; telemetry.sdk.name: Str(opentelemetry)
     -&gt; telemetry.sdk.language: Str(dotnet)
     -&gt; telemetry.sdk.version: Str(1.9.0)
     -&gt; service.name: Str(helloworld)
     -&gt; deployment.environment: Str(otel-derek-1)
     -&gt; k8s.pod.ip: Str(10.42.0.15)
     -&gt; k8s.pod.labels.app: Str(helloworld)
     -&gt; k8s.pod.name: Str(helloworld-84865965d9-nkqsx)
     -&gt; k8s.namespace.name: Str(default)
     -&gt; k8s.pod.uid: Str(38d39bc6-1309-4022-a569-8acceef50942)
     -&gt; k8s.node.name: Str(derek-1)
     -&gt; k8s.cluster.name: Str(derek-1-cluster)</code></pre></div><p>そして以下のような log エントリも確認できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>2024-12-20T01:43:53.215Z info Logs {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource logs&#34;: 1, &#34;log records&#34;: 2}
2024-12-20T01:43:53.215Z info ResourceLog #0
Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
Resource attributes:
     -&gt; splunk.distro.version: Str(1.8.0)
     -&gt; telemetry.distro.name: Str(splunk-otel-dotnet)
     -&gt; telemetry.distro.version: Str(1.8.0)
     -&gt; os.type: Str(linux)
     -&gt; os.description: Str(Debian GNU/Linux 12 (bookworm))
     -&gt; os.build_id: Str(6.8.0-1021-aws)
     -&gt; os.name: Str(Debian GNU/Linux)
     -&gt; os.version: Str(12)
     -&gt; host.name: Str(derek-1)
     -&gt; process.owner: Str(app)
     -&gt; process.pid: Int(1)
     -&gt; process.runtime.description: Str(.NET 8.0.11)
     -&gt; process.runtime.name: Str(.NET)
     -&gt; process.runtime.version: Str(8.0.11)
     -&gt; container.id: Str(78b452a43bbaa3354a3cb474010efd6ae2367165a1356f4b4000be031b10c5aa)
     -&gt; telemetry.sdk.name: Str(opentelemetry)
     -&gt; telemetry.sdk.language: Str(dotnet)
     -&gt; telemetry.sdk.version: Str(1.9.0)
     -&gt; service.name: Str(helloworld)
     -&gt; deployment.environment: Str(otel-derek-1)
     -&gt; k8s.node.name: Str(derek-1)
     -&gt; k8s.cluster.name: Str(derek-1-cluster)</code></pre></div><p>ただし、Splunk Observability Cloud に戻ると、アプリケーションから trace と log が
もはやそこに送信されていないことに気づくでしょう。</p><p>なぜそうなったと思いますか？次のセクションで詳しく説明します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=troubleshoot-opentelemetry-collector-issues>Troubleshoot OpenTelemetry Collector Issues</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>20 minutes</span>
</span>&nbsp;<p>前のセクションでは、debug エクスポーターをコレクターの設定に追加し、
トレースとログのパイプラインの一部にしました。期待通りに、debug 出力が
エージェントコレクターのログに書き込まれているのが確認できます。</p><p>しかし、トレースが o11y cloud に送信されなくなっています。なぜなのかを把握して修正しましょう。</p><h2 id=コレクター設定を確認する>コレクター設定を確認する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><code>values.yaml</code>ファイルを通じてコレクター設定が変更された場合は、
config map を確認してコレクターに実際に適用された設定を確認することが役立ちます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-agent</span></span></code></pre></div><p>エージェントコレクター設定のログとトレースのパイプラインを確認しましょう。次のようになっているはずです：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>k8sattributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filter/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>fluentforward</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>k8sattributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>smartagent/signalfx-forwarder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>zipkin</span></span></span></code></pre></div><p>問題がわかりますか？debug エクスポーターのみがトレースとログのパイプラインに含まれています。
以前のトレースパイプライン設定にあった<code>otlphttp</code>と<code>signalfx</code>エクスポーターがなくなっています。
これが、もう o11y cloud でトレースが見えなくなった理由です。ログパイプラインについても、<code>splunk_hec/platform_logs</code>
エクスポーターが削除されています。</p><blockquote><p>どのような特定のエクスポーターが以前含まれていたかをどのように知ったか？それを見つけるには、
以前のカスタマイズを元に戻してから、config map を確認して
トレースパイプラインに元々何が含まれていたかを見ることもできました。あるいは、
<a href=https://github.com/signalfx/splunk-otel-collector-chart/blob/main/examples/default/rendered_manifests/configmap-agent.yaml rel=external>splunk-otel-collector-chart の GitHub リポジトリ</a>
の例を参照することもでき、これにより Helm チャートで使用されるデフォルトのエージェント設定が分かります。</p></blockquote><h2 id=これらのエクスポーターはどのように削除されたのか>これらのエクスポーターはどのように削除されたのか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><code>values.yaml</code>ファイルに追加したカスタマイズを確認しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span></span></span></code></pre></div><p><code>helm upgrade</code>を使ってコレクターに<code>values.yaml</code>ファイルを適用したとき、
カスタム設定は以前のコレクター設定とマージされました。
これが発生すると、リストを含む<code>yaml</code>設定のセクション、
例えばパイプラインセクションのエクスポーターのリストは、<code>values.yaml</code>ファイルに
含めたもの（debug エクスポーターのみ）で置き換えられます。</p><h2 id=問題を修正しましょう>問題を修正しましょう<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>既存のパイプラインをカスタマイズする場合、設定のその部分を完全に再定義する必要があります。
したがって、<code>values.yaml</code>ファイルを次のように更新する必要があります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>logsEngine</span><span class=p>:</span><span class=w> </span><span class=l>otel</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>splunkObservability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>infrastructureMonitoringEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=l>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>splunk_hec/platform_logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>debug</span></span></span></code></pre></div><p>変更を適用しましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;environment=otel-</span><span class=nv>$INSTANCE</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -f values.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div><p>それからエージェント config map を確認します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe cm splunk-otel-collector-otel-agent</span></span></code></pre></div><p>今度は、ログとトレースの両方について完全に定義されたエクスポーターパイプラインが表示されるはずです：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  pipelines:
</span></span><span class=line><span class=cl>    logs:
</span></span><span class=line><span class=cl>      exporters:
</span></span><span class=line><span class=cl>      - splunk_hec/platform_logs
</span></span><span class=line><span class=cl>      - debug
</span></span><span class=line><span class=cl>      processors:
</span></span><span class=line><span class=cl>      ...
</span></span><span class=line><span class=cl>    traces:
</span></span><span class=line><span class=cl>      exporters:
</span></span><span class=line><span class=cl>      - otlphttp
</span></span><span class=line><span class=cl>      - signalfx
</span></span><span class=line><span class=cl>      - debug
</span></span><span class=line><span class=cl>      processors:
</span></span><span class=line><span class=cl>      ...</span></span></code></pre></div><h2 id=ログ出力の確認>ログ出力の確認<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><strong>Splunk Distribution of OpenTelemetry .NET</strong>は、ログに使用するアプリケーション
（サンプルアプリでも使用している）から、トレースコンテキストで強化されたログを自動的にエクスポートします。</p><p>アプリケーションログはトレースメタデータで強化され、その後
OpenTelemetry Collector のローカルインスタンスに OTLP 形式でエクスポートされます。</p><p>debug エクスポーターによってキャプチャされたログを詳しく見て、それが発生しているかを確認しましょう。
コレクターログを tail するには、次のコマンドを使用できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>component</span><span class=o>=</span>otel-collector-agent -f</span></span></code></pre></div><p>ログを tail したら、curl を使ってさらにトラフィックを生成できます。そうすると
次のようなものが表示されるはずです：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>2024-12-20T21:56:30.858Z info Logs {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource logs&#34;: 1, &#34;log records&#34;: 1}
2024-12-20T21:56:30.858Z info ResourceLog #0
Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
Resource attributes:
     -&gt; splunk.distro.version: Str(1.8.0)
     -&gt; telemetry.distro.name: Str(splunk-otel-dotnet)
     -&gt; telemetry.distro.version: Str(1.8.0)
     -&gt; os.type: Str(linux)
     -&gt; os.description: Str(Debian GNU/Linux 12 (bookworm))
     -&gt; os.build_id: Str(6.8.0-1021-aws)
     -&gt; os.name: Str(Debian GNU/Linux)
     -&gt; os.version: Str(12)
     -&gt; host.name: Str(derek-1)
     -&gt; process.owner: Str(app)
     -&gt; process.pid: Int(1)
     -&gt; process.runtime.description: Str(.NET 8.0.11)
     -&gt; process.runtime.name: Str(.NET)
     -&gt; process.runtime.version: Str(8.0.11)
     -&gt; container.id: Str(5bee5b8f56f4b29f230ffdd183d0367c050872fefd9049822c1ab2aa662ba242)
     -&gt; telemetry.sdk.name: Str(opentelemetry)
     -&gt; telemetry.sdk.language: Str(dotnet)
     -&gt; telemetry.sdk.version: Str(1.9.0)
     -&gt; service.name: Str(helloworld)
     -&gt; deployment.environment: Str(otel-derek-1)
     -&gt; k8s.node.name: Str(derek-1)
     -&gt; k8s.cluster.name: Str(derek-1-cluster)
ScopeLogs #0
ScopeLogs SchemaURL:
InstrumentationScope HelloWorldController
LogRecord #0
ObservedTimestamp: 2024-12-20 21:56:28.486804 +0000 UTC
Timestamp: 2024-12-20 21:56:28.486804 +0000 UTC
SeverityText: Information
SeverityNumber: Info(9)
Body: Str(/hello endpoint invoked by {name})
Attributes:
     -&gt; name: Str(Kubernetes)
Trace ID: 78db97a12b942c0252d7438d6b045447
Span ID: 5e9158aa42f96db3
Flags: 1
 {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;}</code></pre></div><p>この例では、Trace ID と Span ID が
OpenTelemetry .NET 計装によってログ出力に自動的に書き込まれていることがわかります。これにより、
Splunk Observability Cloud でログとトレースを関連付けることができます。</p><p>ただし、Helm を使って K8s クラスターに OpenTelemetry collector をデプロイし、
ログ収集オプションを含める場合、OpenTelemetry collector は File Log receiver を使用して
コンテナーログを自動的にキャプチャすることを覚えておいてください。</p><p>これにより、アプリケーションの重複ログがキャプチャされることになります。例えば、次のスクリーンショットでは
サービスへの各リクエストに対して 2 つのログエントリーが表示されています：</p><p><a href=#R-image-f18f78eb7b825d44a68f20a7df593dfe class=lightbox-link><img alt="Duplicate Log Entries" class="lazy lightbox figure-image" loading=lazy src=../images/duplicate_logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f18f78eb7b825d44a68f20a7df593dfe><img alt="Duplicate Log Entries" class="lazy lightbox lightbox-image" loading=lazy src=../images/duplicate_logs.png></a></p><p>これをどのように回避しますか？</p><h2 id=k8s-での重複ログの回避>K8s での重複ログの回避<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>重複ログをキャプチャしないようにするには、<code>OTEL_LOGS_EXPORTER</code>環境変数を<code>none</code>に設定して、
Splunk Distribution of OpenTelemetry .NET が OTLP を使用してコレクターにログをエクスポートしないようにできます。
これは、<code>deployment.yaml</code>ファイルに<code>OTEL_LOGS_EXPORTER</code>環境変数を追加することで実行できます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>PORT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>NODE_IP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(NODE_IP):4318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;helloworld&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=otel-$INSTANCE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_LOGS_EXPORTER</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;none&#34;</span></span></span></code></pre></div><p>それから次を実行します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># update the deployment</span>
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div><p><code>OTEL_LOGS_EXPORTER</code>環境変数を<code>none</code>に設定するのは簡単です。しかし、Trace ID と
Span ID はアプリケーションによって生成された stdout ログに書き込まれないため、
ログとトレースを関連付けることができなくなります。</p><p>これを解決するには、
<code>/home/splunk/workshop/docker-k8s-otel/helloworld/SplunkTelemetryConfigurator.cs</code>で定義されている例のような、カスタムロガーを定義する必要があります。</p><p>次のように<code>Program.cs</code>ファイルを更新することで、これをアプリケーションに含めることができます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=k>using</span> <span class=nn>SplunkTelemetry</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Microsoft.Extensions.Logging.Console</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>builder</span> <span class=p>=</span> <span class=n>WebApplication</span><span class=p>.</span><span class=n>CreateBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>builder</span><span class=p>.</span><span class=n>Services</span><span class=p>.</span><span class=n>AddControllers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SplunkTelemetryConfigurator</span><span class=p>.</span><span class=n>ConfigureLogger</span><span class=p>(</span><span class=n>builder</span><span class=p>.</span><span class=n>Logging</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>app</span> <span class=p>=</span> <span class=n>builder</span><span class=p>.</span><span class=n>Build</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=p>.</span><span class=n>MapControllers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=p>.</span><span class=n>Run</span><span class=p>();</span></span></span></code></pre></div><p>その後、カスタムログ設定を含む新しい Docker イメージをビルドします：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk/workshop/docker-k8s-otel/helloworld
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker build -t helloworld:1.3 .</span></span></code></pre></div><p>それから更新されたイメージを Kubernetes にインポートします：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/splunk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Import the image into k3d</span>
</span></span><span class=line><span class=cl>sudo k3d image import helloworld:1.3 --cluster <span class=nv>$INSTANCE</span>-cluster</span></span></code></pre></div><p>最後に、<code>deployment.yaml</code>ファイルを更新してコンテナーイメージの 1.3 バージョンを使用する必要があります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>helloworld</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker.io/library/helloworld:1.3</span></span></span></code></pre></div><p>それから変更を適用します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># update the deployment</span>
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div><p>これで重複したログエントリーが排除されたことがわかります。そして
残りのログエントリーは JSON としてフォーマットされ、span と trace ID が含まれています：</p><p><a href=#R-image-0158de95dbe3c5709cc9213b038d46d2 class=lightbox-link><img alt="JSON Format Logs" class="lazy lightbox figure-image" loading=lazy src=../images/logs_json_format.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0158de95dbe3c5709cc9213b038d46d2><img alt="JSON Format Logs" class="lazy lightbox lightbox-image" loading=lazy src=../images/logs_json_format.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/10/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>2 minutes</span>
</span>&nbsp;<p>このワークショップでは、以下の概念についてハンズオンで体験しました：</p><ul><li>Linux ホストに<strong>Splunk Distribution of the OpenTelemetry Collector</strong>をデプロイする方法。</li><li><strong>Splunk Distribution of OpenTelemetry .NET</strong>で.NET アプリケーションを計装する方法。</li><li>.NET アプリケーションを「Docker 化」し、<strong>Splunk Distribution of OpenTelemetry .NET</strong>で計装する方法。</li><li>Helm を使用して Kubernetes クラスターに<strong>Splunk Distribution of the OpenTelemetry Collector</strong>をデプロイする方法。</li><li>コレクター設定をカスタマイズして問題をトラブルシューティングする方法。</li></ul><p>他の言語と環境で OpenTelemetry がどのように計装されるかを確認するには、
<a href=https://github.com/signalfx/splunk-opentelemetry-examples rel=external>Splunk OpenTelemetry Examples GitHub リポジトリ</a>をご覧ください。</p><p>将来このワークショップを独自に実行するには、これらの手順を参照して、Splunk Show の<strong>Splunk4Rookies - Observability</strong>
ワークショップテンプレートを使用して EC2 インスタンスをプロビジョニングしてください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/06/16</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=その他のワークショップ>その他のワークショップ</h1><ul class=card-container><li><article class="card card-popout" aria-labelledby=R-card-706448d8258a26f592920aac871715b9><div class=card-content><div class=card-title id=R-card-706448d8258a26f592920aac871715b9><a href=/observability-workshop/ja/other/pet-clinic/index.html>Pet Clinic Java ワークショップ</a></div><div class=card-content-text>JavaアプリケーションをつかったSplunk Oservabilityのワークショップです</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-77980838b0805e78a6842bef324d5412><div class=card-content><div class=card-title id=R-card-77980838b0805e78a6842bef324d5412><a href=/observability-workshop/ja/other/opentelemetry-collector/index.html>OpenTelemetry Collector</a></div><div class=card-content-text>OpenTelemetry Collectorのコンセプトを学び、Splunk Observability Cloudにデータを送信する方法を理解しましょう。</div></div></article></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/09/29</span></span></footer></article><section><h1 class=a11y-only>その他のワークショップのサブセクション</h1><article class=default><header class=headline></header><h1 id=pet-clinic-java-ワークショップ>Pet Clinic Java ワークショップ</h1><p>このワークショップでは、Splunk Observabilityプラットフォームの以下のコンポーネントを構成するための、基本的なステップを体験できます：</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk APM<ul><li>Endpoint Performance</li><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Real User Monitoring (RUM)</li><li>Splunk LogObserver</li></ul><p>ワークショップの中では、Javaのサンプルアプリケーション（Spring Pet Clinic）をクローン（ダウンロード）し、アプリケーションのコンパイル、パッケージ、実行していきます。</p><p>アプリケーションを起動すると、OpenTelemetry Javaエージェントを通じて、Splunk APMでメトリクスとトレースが即座に表示されるようになります。</p><p>その後、Splunk OpenTelemetry Javascript Libraries (RUM)を使用して、Pet Clinicのエンドユーザーインターフェース（アプリケーションによってレンダリングされるHTMLページ）を計装し、エンドユーザーが実行する個々のクリックとページロードのすべてについて、RUMトレースを生成していきます。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
前提条件</summary><div class=box-content><p>このワークショップは、ホスト/インスタンスが提供されるSplunk実行ワークショップ <strong>または</strong> 自前のホスト/<a href=https://github.com/splunk/observability-workshop/tree/main/multipass rel=external>Multipassインスタンス</a> で行う、自己主導型のワークショップです。</p><p>ご自身のシステムには、以下のものがインストールされ、有効になっている必要があります：</p><ol><li>JDK 17</li><li>ポート <code>8083</code> が開いていること（インバウンド/アウトバウンド）</li></ol></div></details><p><a href=#R-image-581763ba0c0ccbc9bc04a29b36780d1e class=lightbox-link><img alt="PetClinic Exercise" class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/ja/other/pet-clinic/images/petclinic-exercise.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-581763ba0c0ccbc9bc04a29b36780d1e><img alt="PetClinic Exercise" class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/ja/other/pet-clinic/images/petclinic-exercise.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/16</span></span></footer></article><section><h1 class=a11y-only>Pet Clinic Java ワークショップのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collectorをインストールする>OpenTelemetry Collectorをインストールする</h1><h2 id=1-はじめに>1. はじめに<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry Collector は、インフラストラクチャーとアプリケーションを計装するためのコアコンポーネントです。 その役割は収集と送信です：</p><ul><li>インフラストラクチャーのメトリクス（ディスク、CPU、メモリなど）</li><li>Application Performance Monitoring（APM）のトレース情報</li><li>プロファイリングに関するデータ</li><li>ホストおよびアプリケーションのログ</li></ul><p>Splunk Observability Cloud では、インフラストラクチャーとアプリケーションの両方で Collector のセットアップを案内するウィザードを提供しています。デフォルトでは、ウィザードはコレクターのインストールのみを行うコマンドのみを提供します。</p><h2 id=2-環境変数を設定する>2. 環境変数を設定する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>すでに <strong>Splunk IM</strong> ワークショップを終了している場合は、既存の環境変数を利用することができます。そうでない場合は、<code>ACCESS_TOKEN</code>と<code>REALM</code>の環境変数を設定して、OpenTelemetry Collector のインストールコマンドを実行していきます。</p><p>例えば、Realm が <code>us1</code> の場合、<code>export REALM=us1</code> と入力し、<code>eu0</code> の場合は <code>export REALM=eu0</code> と入力します。</p><div class=tab-panel data-tab-group=R-tabs-94b931b08986165c3ffd4bc98b3d5d48><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-7f2135e68785b33ecf79a33d9b433ffe aria-expanded=true data-tab-item=R-tab-cf0b6ab0882fa6113a61d7222fbde399 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-94b931b08986165c3ffd4bc98b3d5d48","R-tab-cf0b6ab0882fa6113a61d7222fbde399")'>
<span class=tab-nav-text>ACCESS TOKENを環境変数に設定する</span></button></div><div class=tab-content-container><div id=R-tab-id-7f2135e68785b33ecf79a33d9b433ffe data-tab-item=R-tab-cf0b6ab0882fa6113a61d7222fbde399 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_O11y-Workshop-ACCESS_TOKEN&gt;&#34;</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=R-tabs-6853f2849a49b2fe3bba5d085cde128f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c643006accc4d07f385895090df0c3e1 aria-expanded=true data-tab-item=R-tab-999045c586532e256b2eb23b035bd4f2 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-6853f2849a49b2fe3bba5d085cde128f","R-tab-999045c586532e256b2eb23b035bd4f2")'>
<span class=tab-nav-text>REALMを環境変数に設定する</span></button></div><div class=tab-content-container><div id=R-tab-id-c643006accc4d07f385895090df0c3e1 data-tab-item=R-tab-999045c586532e256b2eb23b035bd4f2 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_REALM&gt;&#34;</span></span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
既存のOpenTelemetryコレクターをすべて削除する</summary><div class=box-content><p>同じ VM インスタンスに Splunk IM ワークショップのセットアップをしている場合、Otel Collector をインストールする前に Kubernetes で実行中の Collector を削除していることを確認してください。これは、以下のコマンドを実行することで行うことができます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></details><h2 id=3-opentelemetry-collector-をインストールする>3. OpenTelemetry Collector をインストールする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>次に、Collector をインストールします。インストールスクリプトに渡される追加のパラメータは <code>--deployment-environment</code> です。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --deployment-environment <span class=k>$(</span>hostname<span class=k>)</span>-petclinic --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span></span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
AWS/EC2インスタンスの場合</summary><div class=box-content><p>。
AWS/EC2 インスタンス上でこのワークショップを行う場合、インスタンスのホスト名を公開するためにコレクターにパッチを適用する必要があります：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p><code>agent_config.yaml</code> にパッチを適用したあと、Collector を再起動してください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div></div></details><p>インストールが完了したら、Splunk Observability の <strong>Hosts with agent installed</strong> ダッシュボードに移動して、<strong>Dashboards → Hosts with agent installed</strong> からホストのデータを確認してみましょう。</p><p>ダッシュボードのフィルタを使用して <code>host.name</code>を選択し、仮想マシンのホスト名を入力または選択します。ホストのデータが表示されたら、APM コンポーネントを使用する準備が整いました。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-javaエージェントをインストールする>OpenTelemetry Javaエージェントをインストールする</h1><h2 id=1-spring-petclinic-アプリケーションを動かす>1. Spring PetClinic アプリケーションを動かす<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>APMをセットアップするためにまず必要なのは&mldr;そう、アプリケーションです！この演習では、Spring PetClinicアプリケーションを使用します。これはSpringフレームワーク（Spring Boot）で作られた、非常に人気のあるサンプルJavaアプリケーションです。</p><p>まずはPetClinicリポジトリをクローンし、そして、アプリケーションをコンパイル、ビルド、パッケージ、テストしていきます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/spring-projects/spring-petclinic</span></span></code></pre></div><p><code>spring-petclinic</code> ディレクトリに移動します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> spring-petclinic</span></span></code></pre></div><p>PetClinic が使用する MySQL データベースを起動します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -e <span class=nv>MYSQL_USER</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>petclinic -p 3306:3306 docker.io/biarms/mysql:5.7</span></span></code></pre></div><p>そして、Splunk版のOpenTelemetry Java APMエージェントをダウンロードしておきましょう。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L https://github.com/signalfx/splunk-otel-java/releases/latest/download/splunk-otel-javaagent.jar <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-o splunk-otel-javaagent.jar</span></span></code></pre></div><p>次に、mavenコマンドを実行してPetClinicをコンパイル/ビルド/パッケージ化します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
情報</summary><div class=box-content><p>実際にアプリをコンパイルする前に、mavenが多くの依存ライブラリをダウンロードするため、初回実行時には数分かかるでしょう。2回目以降の実行はもっと短くなります。</p></div></details><p>そして、以下のコマンドでアプリケーションを実行することができます:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java -javaagent:./splunk-otel-javaagent.jar <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>.service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.memory.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.metrics.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>アプリケーションが動作しているかどうかは、<code>http://&lt;VM_IP_ADDRESS>:8083</code> にアクセスして確認することができます。
次に、トラフィックを生成し、クリックしまくり、エラーを生成し、ペットを追加するなどしてください。</p><ul><li><code>-Dotel.service.name=$(hostname).service</code> では、アプリケーションの名前を定義しています。サービスマップ上のアプリケーションの名前等に反映されます。</li><li><code>-Dotel.resource.attributes=deployment.environment=$(hostname),version=0.314</code> では、Environmentと、versionを定義しています。<ul><li><code>deployment.environment=$(hostname)</code> は、Splunk APM UIの上部「Environment」に反映されます。</li><li><code>version=0.314</code> はここでは、アプリケーションのバージョンを示しています。トレースをドリルダウンしたり、サービスマップの Breakdown の機能で分析したり、Tag Spotlightを開くと <code>version</code> 毎のパフォーマンス分析が使えます。</li></ul></li><li><code>-Dsplunk.profiler.enabled=true</code> および <code>splunk.profiler.memory.enabled=true</code> では、CPUとメモリのプロファイリングを有効にしています。Splunk APM UIから、AlwaysOn Profilingを開いてみてください。</li><li><code>-Dsplunk.metrics.enabled=true</code> では、メモリやスレッドなどJVMメトリクスの送信を有効にしています。Dashboardsから、APM java servicesを開いてみてください。</li></ul><p>その後、Splunk APM UIにアクセスして、それぞれのテレメトリーデータを確認してみましょう！</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Troubleshooting MetricSetsを追加する</summary><div class=box-content><p>サービスマップやTab Spotlightで、 <code>version</code> などのカスタム属性で分析できるようにするためには、Troubleshooting MetricSetsの設定をあらかじめ追加する必要があります。
左メニューの <strong>Settings → APM MetricSets</strong> で、設定を管理することができます。 もしお使いのアカウントで分析できなければ、設定を追加してみましょう。</p></div></details><p>次のセクションではカスタム計装を追加して、OpenTelemetryでは何ができるのか、さらに見ていきます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2024/04/24</span></span></footer></article><article class=default><header class=headline></header><h1 id=マニュアル計装>マニュアル計装</h1><h2 id=1-依存ライブラリを追加する>1. 依存ライブラリを追加する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>前のセクション足したような、プロセス全体に渡る属性は便利なのですが、ときにはさらに、リクエストの内容に応じた状況を知りたくなるかもしれません。
心配ありません、OpenTelemetryのAPIを通じてそれらを計装し、データを送り、Splunk Observabilityで分析できるようになります。</p><p>最初に、JavaアプリケーションがOpenTelemetryのAPIを使えるように、ライブラリの依存を追加していきます。
もちろん、vimなどのお好みのエディタをお使い頂いても大丈夫です！</p><p>アプリケーションが起動中であれば、一旦停止しましょう。ターミナルで <strong><code>Ctrl-c</code></strong> を押すと、停止することができます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano pom.xml</span></span></code></pre></div><p>そして、<code>&lt;dependencies></code> セクションの中（33行目）に↓を追加してください。
ファイル修正後、 <strong><code>ctrl-O</code></strong> のあとに <strong><code>Enter</code></strong> で、ファイルを保存します。次に <strong><code>ctrl-X</code></strong> で、nanoを終了します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>    &lt;dependency&gt;
        &lt;groupId&gt;io.opentelemetry&lt;/groupId&gt;
        &lt;artifactId&gt;opentelemetry-api&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre></div><p>念のため、コンパイルできるか確かめてみましょう:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>./mvnw package -Dmaven.test.skip=true</code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Tips: nanoの使い方と壊れたファイルの直し方</summary><div class=box-content><p>nanoはLinux環境でよく使われる、シンプルなエディタの一つです。</p><ul><li><code>Alt-U</code> で、アンドゥができます。Macの場合は <code>Esc</code> キーを押したあとに <code>U</code> を押してください！</li><li><code>ctrl-_</code> のあとに数字を入力すると、指定した行数にジャンプします。</li><li><code>ctrl-O</code> のあとに <code>Enter</code> で、ファイルを保存します。</li><li><code>ctrl-X</code> で、nanoを終了します。</li></ul><p>もしファイルをどうしようもなく壊してしまって元に戻したい場合は、gitを使って次のようにするとよいでしょう。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git checkout pom.xml</span></span></code></pre></div></div></details><p>これで、JavaのアプリケーションでOpenTelemetryのAPIが使う準備ができました。</p><h2 id=2-javaのコードにマニュアル計装を追加する>2. Javaのコードにマニュアル計装を追加する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>では、アプリケーションコードをちょっと変更して、リクエストのコンテキストのデータをスパン属性に追加してみましょう。</p><p>ここでは Pet Clinic アプリケーションの中で <code>Find Owners</code> が使われたときに、どのような検索文字列が指定されたのかを調査できるようにしていきます。
検索条件によってパフォーマンスが劣化してしまうケース、よくありませんか？そんなときは <code>OwnerController</code> に計装を追加していきましょう！</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano src/main/java/org/springframework/samples/petclinic/owner/OwnerController.java</span></span></code></pre></div><p>このコードを <strong>変更するのは2箇所</strong> です。</p><p>まず、<code>import jakarta.validation.Valid;</code> の下、37行目付近に↓を足します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>io.opentelemetry.api.trace.Span</span><span class=p>;</span></span></span></code></pre></div><p>次に、 <code>// find owners by last name</code> のコメントがある箇所（おそらく95行目付近にあります）の下に、次のコードを足していきましょう:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>                </span><span class=n>Span</span><span class=w> </span><span class=n>span</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Span</span><span class=p>.</span><span class=na>current</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>span</span><span class=p>.</span><span class=na>setAttribute</span><span class=p>(</span><span class=s>&#34;lastName&#34;</span><span class=p>,</span><span class=w> </span><span class=n>owner</span><span class=p>.</span><span class=na>getLastName</span><span class=p>());</span></span></span></code></pre></div><p>このコードで、Last Nameとして指定された検索条件が、スパン属性 <code>lastName</code> としてSplunk Observabilityに伝えるようになりました。</p><p>アプリケーションをコンパイルし直ししますが、Javaコードを多少汚してしまったかもしれません。 <code>spring-javaformat:apply</code> を指定しながらコンパイルしてみましょう。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw spring-javaformat:apply package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><p>アプリケーションを起動します。せっかくなので、バージョンを一つあげて <code>version=0.315</code> としましょう。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java -javaagent:./splunk-otel-javaagent.jar <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>.service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>,version<span class=o>=</span>0.315 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.memory.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.metrics.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p><code>http://&lt;VM_IP_ADDRESS>:8083</code> にアクセスして、オーナー検索をいくつか試してましょう。そしてSplunk APM UIからExploreを開き、アプリケーションのトレースを見ていきます。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
さらなる情報: マニュアル計装について</summary><div class=box-content><p>マニュアル計装で何ができるか、他の言語でのやり方などは、OpenTelemetryの公式ウェブサイトにある <a href=https://opentelemetry.io/docs/instrumentation/ rel=external>Instrumentation</a> ページをご覧ください。</p></div></details><p>検証が完了したら、ターミナルで <strong><code>Ctrl-c</code></strong> を押すと、アプリケーションを停止することができます。</p><p>次のセクションでは、RUMを使ってブラウザ上のパフォーマンスデータを収集してみましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/16</span></span></footer></article><article class=default><header class=headline></header><h1 id=real-user-monitoring>Real User Monitoring</h1><h2 id=1-rumを有効にする>1. RUMを有効にする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Real User Monitoring (RUM)計装のために、Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web rel=external>https://github.com/signalfx/splunk-otel-js-web</a> スニペットをページ内に追加します。再度ウィザードを使用します <strong>Data Management → Add Integrationボタン → Monitor user experience（画面上部タブ） → Browser Instrumentation</strong>を開きます。</p><p>ドロップダウンから設定済みの <strong>RUM ACCESS TOKEN</strong> を選択し、<strong>Next</strong> をクリックします。以下の構文で <strong>App name</strong> と<strong>Environment</strong> を入力します：</p><p>次に、ワークショップのRUMトークンを選択し、 App nameとEnvironmentを定義します。ウィザードでは、ページ上部の <code>&lt;head></code> セクションに配置する必要のある HTML コードの断片が表示されます。この例では、次のように記述していますが、ウィザードでは先程入力した値が反映されてるはずです。</p><ul><li>Application Name: <code>&lt;hostname>-petclinic-service</code></li><li>Environment: <code>&lt;hostname>-petclinic-env</code></li></ul><p>ウィザードで編集済みコードスニペットをコピーするか、以下のスニペットをコピーして適宜編集してください。ただし：</p><ul><li><code>[hostname]-petclinic-service</code> - <code>[hostname]</code> をお使いのホスト名に書き換えてください</li><li><code>[hostname]-petclinic-env</code> - <code>[hostname]</code> をお使いのホスト名に書き換えてください</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>beaconUrl</span><span class=o>:</span> <span class=s2>&#34;https://rum-ingest.&lt;REALM&gt;.signalfx.com/v1/rum&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>rumAuth</span><span class=o>:</span> <span class=s2>&#34;&lt;RUM_ACCESS_TOKEN&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>app</span><span class=o>:</span> <span class=s2>&#34;&lt;hostname&gt;.service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>environment</span><span class=o>:</span> <span class=s2>&#34;&lt;hostname&gt;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>Spring PetClinicアプリケーションでは、1つのHTMLページを「レイアウト」ページとして使用し、アプリケーションのすべてのページで再利用しています。これは、Splunk RUM計装ライブラリを挿入するのに最適な場所であり、すべてのページで自動的に読み込まれます。</p><p>では、レイアウトページを編集してみましょう：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano src/main/resources/templates/fragments/layout.html</span></span></code></pre></div><p>そして、上で生成したスニップをページの <code>&lt;head></code> セクションに挿入してみましょう。さて、アプリケーションを再構築して、再び実行する必要があります。</p><h2 id=2-petclinicを再ビルドする>2. PetClinicを再ビルドする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>mavenコマンドを実行して、PetClinicをコンパイル/ビルド/パッケージ化します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><p>そして、アプリケーションを動かしてみましょう。バージョンを <code>version=0.316</code> とするのをお忘れなく。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java -javaagent:./splunk-otel-javaagent.jar <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>.service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>,version<span class=o>=</span>0.316 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.memory.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.metrics.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
versionを自動で設定する</summary><div class=box-content><p>ここまできて <code>version</code> を毎回変えるためにコマンドラインを修正するのは大変だと思うことでしょう。実際、修正が漏れた人もいるかもしれません。
本番環境では、環境変数でアプリケーションバージョンを与えたり、コンテナイメージの作成時にビルドIDを与えたりすることになるはずです。</p></div></details><p>次に、より多くのトラフィックを生成するために、アプリケーションに再度アクセスしてみましょう。 <code>http://&lt;VM_IP_ADDRESS>:8083</code> にアクセスすると、今度はRUMトレースが報告されるはずです。</p><p>RUMにアクセスして、トレースとメトリクスのいくつかを見てみましょう。左のメニューから <strong>RUM</strong> を選ぶと、Spring Pet Clinicでのユーザー（あなたです！）が体験したパフォーマンスが表示されます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/16</span></span></footer></article><article class=default><header class=headline></header><h1 id=log-observer>Log Observer</h1><p>このセクションでは、Spring PetClinicアプリケーションをファイルシステムのファイルにログを書き込むように設定し、
Splunk OpenTelemetry Collectorがそのログファイルを読み取り（tail）、Splunk Observability Platformに情報を報告するように設定していきます。</p><h2 id=1-fluentdの設定>1. FluentDの設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Splunk OpenTelemetry Collectorを、Spring PetClinicのログファイルをtailし
Splunk Observability Cloudエンドポイントにデータを報告するように設定する必要があります。</p><p>Splunk OpenTelemetry Collectorは、FluentDを使用してログの取得/報告を行い、
Spring PetClinicのログを報告するための適切な設定を行うには、
デフォルトディレクトリ（<code>/etc/otel/collector/fluentd/conf.d/</code>）にFluentDの設定ファイルを追加するだけです。</p><p>以下は、サンプルのFluentD設定ファイル <code>petclinic.conf</code> を新たに作成し、</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/otel/collector/fluentd/conf.d/petclinic.conf</span></span></code></pre></div><p>ファイル <code>/tmp/spring-petclinic.log</code>を読み取るよう設定を記述します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>&lt;source&gt;
  @type tail
  @label @SPLUNK
  tag petclinic.app
  path /tmp/spring-petclinic.log
  pos_file /tmp/spring-petclinic.pos_file
  read_from_head false
  &lt;parse&gt;
    @type none
  &lt;/parse&gt;
&lt;/source&gt;</code></pre></div><p>このとき、ファイル <code>petclinic.conf</code> のアクセス権と所有権を変更する必要があります。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo chown td-agent:td-agent /etc/otel/collector/fluentd/conf.d/petclinic.conf
</span></span><span class=line><span class=cl>sudo chmod <span class=m>755</span> /etc/otel/collector/fluentd/conf.d/petclinic.conf</span></span></code></pre></div><p>ファイルが作成されたら、FluentDプロセスを再起動しましょう。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart td-agent</span></span></code></pre></div><h2 id=3-logbackの設定>3. Logbackの設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Spring Pet Clinicアプリケーションは、いくつかのJavaログライブラリを使用することができます。
このシナリオでは、logbackを使ってみましょう。</p><p>リソースフォルダに <code>logback.xml</code> という名前のファイルを作成して…</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano src/main/resources/logback.xml</span></span></code></pre></div><p>以下の設定を保存しましょう:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE xml&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration</span> <span class=na>scan=</span><span class=s>&#34;true&#34;</span> <span class=na>scanPeriod=</span><span class=s>&#34;30 seconds&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;contextListener</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.classic.jul.LevelChangePropagator&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;resetJUL&gt;</span>true<span class=nt>&lt;/resetJUL&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/contextListener&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;logger</span> <span class=na>name=</span><span class=s>&#34;org.springframework.samples.petclinic&#34;</span> <span class=na>level=</span><span class=s>&#34;debug&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;appender</span> <span class=na>name=</span><span class=s>&#34;file&#34;</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;file&gt;</span>/tmp/spring-petclinic.log<span class=nt>&lt;/file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;rollingPolicy</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;fileNamePattern&gt;</span>springLogFile.%d{yyyy-MM-dd}.log<span class=nt>&lt;/fileNamePattern&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;maxHistory&gt;</span>5<span class=nt>&lt;/maxHistory&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;totalSizeCap&gt;</span>1GB<span class=nt>&lt;/totalSizeCap&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/rollingPolicy&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;encoder&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;pattern&gt;</span>
</span></span><span class=line><span class=cl>      %d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg trace_id=%X{trace_id} span_id=%X{span_id} trace_flags=%X{trace_flags} service.name=%property{otel.resource.service.name}, deployment.environment=%property{otel.resource.deployment.environment} %n
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/encoder&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/appender&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;root</span> <span class=na>level=</span><span class=s>&#34;debug&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&#34;file&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/root&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span></span></span></code></pre></div><p>その後、アプリケーションを再構築して再度実行していきます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java -javaagent:./splunk-otel-javaagent.jar <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>.service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>,version<span class=o>=</span>0.317 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.memory.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.metrics.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>これまで通り、アプリケーション <code>http://&lt;VM_IP_ADDRESS>:8083</code> にアクセスしてトラフィックを生成すると、ログメッセージが報告されるようになります。</p><p>左側のLog Observerアイコンをクリックして、ホストとSpring PetClinicアプリケーションからのログメッセージのみを選択するためのフィルタを追加できます。</p><ol><li>Add Filter → Field → host.name → &lt;あなたのホスト名></li><li>Add Filter → Field → service.name → &lt;あなたのホスト名>.service</li></ol><h2 id=4-まとめ>4. まとめ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>これでワークショップは終了です。
これまでに、Splunk Observability Cloudにメトリクス、トレース、ログ、データベースクエリのパフォーマンス、コードプロファイリングが報告されるようになりました。
おめでとうございます！</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/16</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetryでクラウドネイティブ環境のオブザーバビリティを実現する>OpenTelemetryでクラウドネイティブ環境のオブザーバビリティを実現する</h1><h2 id=概要>概要<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry を使い始める場合は、バックエンドに直接データを送ることから始めるかもしれません。最初のステップとしてはよいですが、OpenTelemetry Collector をオブザーバビリティのアーキテクチャとして使用するのは多くの利点があり、本番環境では Collector を使ったデプロイを推奨しています。</p><p>このワークショップでは、OpenTelemetry Collector を使用することに焦点を当て、Splunk Observability Cloud で使用するためのレシーバー、プロセッサー、エクスポーターを定義し、実際にテレメトリデータを送信するためのパイプラインを設定することで、環境に合わせて Collector を活用を学びます。また、分散プラットフォームのビジネスニーズに対応するための、カスタムコンポーネントを追加できるようになるまでの道のりを進むことになります。</p><h3 id=ninja-セクション>Ninja セクション<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>ワークショップの途中には、展開できる <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content>Ninja セクション</span></span> があります。これらはより実践的で、ワークショップ中、もしくは自分の時間を使って、さらに技術的な詳細に取り組むことができます。</p><p>OpenTelemetry プロジェクトは頻繁に開発されているため、Ninjaセクションの内容が古くなる可能性があることに注意してください。コンテンツが古い場合には更新のリクエストを出すこともできますので、必要なものを見つけた場合はお知らせください。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> をテストして！</span></span></summary><div class=box-content><p><strong>このワークショップを完了すると、正式に OpenTelemetry Collector ニンジャになります！</strong></p></div></details><hr><h2 id=対象者>対象者<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このワークショップは、OpenTelemetry Collector のアーキテクチャとデプロイメントについてさらに学びたいと考えている開発者やシステム管理者を対象としています。</p><h2 id=前提条件>前提条件<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ul><li>データ収集に関する基本的な理解</li><li>コマンドラインとvim/viの経験</li><li>Ubuntu 20.04 LTSまたは22.04 LTSが稼働するインスタンス/ホスト/VM<ul><li>最小要件はAWS/EC2 t2.micro（1 CPU、1GB RAM、8GBストレージ）</li></ul></li></ul><h2 id=学習目標>学習目標<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このセッションの終わりまでに、参加者は以下を行うことができるようになります：</p><ul><li>OpenTelemetry のコンポーネントを理解する</li><li>レシーバー、プロセッサー、エクスポーターを使用してデータを収集・分析する</li><li>OpenTelemetry を使用する利点を特定する</li><li>自分たちのビジネスニーズに対応するカスタムコンポーネントを構築する</li></ul><h2 id=opentelemetry-のアーキテクチャー>OpenTelemetry のアーキテクチャー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    subgraph Receivers
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article><section><h1 class=a11y-only>OpenTelemetry Collectorのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-contrib-をインストールする>OpenTelemetry Collector Contrib をインストールする</h1><h2 id=opentelemetry-collector-の-contrib-ディストリビューションをダウンロードする>OpenTelemetry Collector の Contrib ディストリビューションをダウンロードする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry Collector のインストールのために、まずはダウンロードするのが最初のステップです。このラボでは、 <code>wget</code> コマンドを使って OpenTelemetry の GitHub リポジトリから <code>.deb</code> パッケージをダウンロードしていきます。</p><p><a href=https://github.com/open-telemetry/opentelemetry-collector-releases/releases rel=external>OpenTelemetry Collector Contrib releases page</a>
から、ご利用のプラットフォーム用の <code>.deb</code> パッケージを入手してください。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://github.com/open-telemetry/opentelemetry-collector-releases/releases/download/v0.80.0/otelcol-contrib_0.80.0_linux_amd64.deb</span></span></code></pre></div><h2 id=opentelemetry-collector-の-contrib-ディストリビューションをインストールする>OpenTelemetry Collector の Contrib ディストリビューションをインストールする<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><code>dpkg</code> を使って、 <code>.deb</code> パッケージをインストールします。下記の <strong>dpkg Output</strong> のようになれば、インストールは成功です！</p><div class=tab-panel data-tab-group=R-tabs-944f63598807c7cbaef768b5854bb842><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d4c4473dfd2ed967c2503ad2d2d8b226 aria-expanded=true data-tab-item=R-tab-349838fb1d851d3e2014b9fe39203275 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-944f63598807c7cbaef768b5854bb842","R-tab-349838fb1d851d3e2014b9fe39203275")'>
<span class=tab-nav-text>Install</span>
</button>
<button aria-controls=R-tab-id-586b89596254e7ce751fb0cf514fdc5a aria-expanded=false data-tab-item=R-tab-88b74acfc7be57ced2480fc5f7165e87 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-944f63598807c7cbaef768b5854bb842","R-tab-88b74acfc7be57ced2480fc5f7165e87")'>
<span class=tab-nav-text>dpkg Output</span></button></div><div class=tab-content-container><div id=R-tab-id-d4c4473dfd2ed967c2503ad2d2d8b226 data-tab-item=R-tab-349838fb1d851d3e2014b9fe39203275 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dpkg -i otelcol-contrib_0.80.0_linux_amd64.deb</span></span></code></pre></div></div></div><div id=R-tab-id-586b89596254e7ce751fb0cf514fdc5a data-tab-item=R-tab-88b74acfc7be57ced2480fc5f7165e87 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Selecting previously unselected package otelcol-contrib.
</span></span><span class=line><span class=cl>(Reading database ... 64218 files and directories currently installed.)
</span></span><span class=line><span class=cl>Preparing to unpack otelcol-contrib_0.75.0_linux_amd64.deb ...
</span></span><span class=line><span class=cl>Unpacking otelcol-contrib (0.75.0) ...
</span></span><span class=line><span class=cl>Setting up otelcol-contrib (0.75.0) ...
</span></span><span class=line><span class=cl>Created symlink /etc/systemd/system/multi-user.target.wants/otelcol-contrib.service → /lib/systemd/system/otelcol-contrib.service.</span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/22</span></span></footer></article><section><h1 class=a11y-only>1. インストールのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-contribをインストールする>OpenTelemetry Collector Contribをインストールする</h1><h2 id=collector-が動作していることを確認する>Collector が動作していることを確認する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>これで、Collector が動いているはずです。root権限で <code>systemctl</code> コマンドを使って、それを確かめてみましょう。</p><div class=tab-panel data-tab-group=R-tabs-624cb4af198f257a87d4836286836f27><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-37b868291e2a722018aa8a3b3ca67885 aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-624cb4af198f257a87d4836286836f27","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span>
</button>
<button aria-controls=R-tab-id-2278b63321a55da5bd3a95cdd13d243a aria-expanded=false data-tab-item=R-tab-ea8cb5b4ea61afc69dea0097cb212fb6 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-624cb4af198f257a87d4836286836f27","R-tab-ea8cb5b4ea61afc69dea0097cb212fb6")'>
<span class=tab-nav-text>Status Output</span></button></div><div class=tab-content-container><div id=R-tab-id-37b868291e2a722018aa8a3b3ca67885 data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl status otelcol-contrib</span></span></code></pre></div></div></div><div id=R-tab-id-2278b63321a55da5bd3a95cdd13d243a data-tab-item=R-tab-ea8cb5b4ea61afc69dea0097cb212fb6 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>● otelcol-contrib.service - OpenTelemetry Collector Contrib
</span></span><span class=line><span class=cl>     Loaded: loaded (/lib/systemd/system/otelcol-contrib.service; enabled; vendor preset: enabled)
</span></span><span class=line><span class=cl>     Active: active (running) since Tue 2023-05-16 08:23:23 UTC; 25s ago
</span></span><span class=line><span class=cl>   Main PID: 1415 (otelcol-contrib)
</span></span><span class=line><span class=cl>      Tasks: 5 (limit: 1141)
</span></span><span class=line><span class=cl>     Memory: 22.2M
</span></span><span class=line><span class=cl>        CPU: 125ms
</span></span><span class=line><span class=cl>     CGroup: /system.slice/otelcol-contrib.service
</span></span><span class=line><span class=cl>             └─1415 /usr/bin/otelcol-contrib --config=/etc/otelcol-contrib/config.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: NumberDataPoints #0
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Data point attributes:
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; exporter: Str(logging)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_instance_id: Str(df8a57f4-abdc-46b9-a847-acd62db1001f)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_name: Str(otelcol-contrib)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:      -&gt; service_version: Str(0.75.0)
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: StartTimestamp: 2023-05-16 08:23:39.006 +0000 UTC
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Timestamp: 2023-05-16 08:23:39.006 +0000 UTC
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]: Value: 0.000000
</span></span><span class=line><span class=cl>May 16 08:23:39 ip-10-0-9-125 otelcol-contrib[1415]:         {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;metrics&#34;, &#34;name&#34;: &#34;logging&#34;}</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Tips: status 表示を中止するには</summary><div class=box-content><p><code>systemctl status</code> コマンドの表示を中止するときは <code>q</code> キーを押してください。</p></div></details><p>サービスを停止するときは、 <code>stop</code> コマンドを使います。</p><div class=tab-panel data-tab-group=R-tabs-cbe96463e1c7b5a5f3a4d0a0a54bd692><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-3f7d1522314beec9c4c9363fda6b13da aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-cbe96463e1c7b5a5f3a4d0a0a54bd692","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div id=R-tab-id-3f7d1522314beec9c4c9363fda6b13da data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl stop otelcol-contrib</span></span></code></pre></div></div></div></div></div><p>更新した設定ファイルを読み込ませるときは、 <code>restart</code> コマンドでサービスの再起動をしましょう。</p><div class=tab-panel data-tab-group=R-tabs-7edd67205f8aa70b63db0668f80d6891><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-453226f60661534c455616f284f7f5cb aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-7edd67205f8aa70b63db0668f80d6891","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div id=R-tab-id-453226f60661534c455616f284f7f5cb data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart otelcol-contrib</span></span></code></pre></div></div></div></div></div><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> Open Telemetry Collector Builder (ocb) を使って、独自のコレクターを作る</span></span></summary><div class=box-content><p>このパートでは、お使いのシステムに以下のものがインストールされている必要があります：</p><ul><li><p>Go (latest version)</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /tmp
</span></span><span class=line><span class=cl>wget https://golang.org/dl/go1.20.linux-amd64.tar.gz
</span></span><span class=line><span class=cl>sudo tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz</span></span></code></pre></div><p><code>.profile</code> を編集して、次の環境変数をセットします:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOROOT</span><span class=o>=</span>/usr/local/go
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOPATH</span><span class=o>=</span><span class=nv>$HOME</span>/go
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$GOPATH</span>/bin:<span class=nv>$GOROOT</span>/bin:<span class=nv>$PATH</span></span></span></code></pre></div><p>そして、シェルのセッションを更新します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>source</span> ~/.profile</span></span></code></pre></div><p>Go のバージョンを確認します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go version</span></span></code></pre></div></li><li><p>ocb のインストール</p><ul><li><p>ocb バイナリーを <a href=https://github.com/open-telemetry/opentelemetry-collector/releases/tag/cmd%2Fbuilder%2Fv0.80.0 rel=external>project releases</a>
からダウンロードして、次のコマンドを実行します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mv ocb_0.80.0_darwin_arm64 /usr/bin/ocb
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> /usr/bin/ocb</span></span></code></pre></div><p>別のアプローチとして、Go のツールチェーンを使ってバイナリをローカルにビルドする方法もあります:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go install go.opentelemetry.io/collector/cmd/builder@v0.80.0
</span></span><span class=line><span class=cl>mv <span class=k>$(</span>go env GOPATH<span class=k>)</span>/bin/builder /usr/bin/ocb</span></span></code></pre></div></li></ul></li><li><p>(Optional) Docker</p></li></ul><h2 id=なぜ独自のコレクターをビルドするの>なぜ独自のコレクターをビルドするの？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コレクターのデフォルトのディストリビューション（core および contrib）は、含まれれるコンポーネントが少なすぎたり、もしくは多すぎたりします。</p><p>本番環境で contrib コレクターを実行することはできますが、インストールされているコンポーネントの量が多く、デプロイに必要ではないものも含まれるため、一般的には推奨されません。</p><h2 id=独自のコレクターをビルドする利点は>独自のコレクターをビルドする利点は？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>独自のコレクターバイナリー（通常は「ディストリビューション」と呼ばれる）を作成することで、必要なものだけをビルドすることができます。</p><p>メリットは次のとおりです:</p><ol><li>バイナリーのサイズが小さい</li><li>一般的な Go の脆弱性スキャナーを利用できる</li><li>組織独自のコンポーネントを組み込むことができる</li></ol><h2 id=カスタムコレクターをビルドするときの注意事項は>カスタムコレクターをビルドするときの注意事項は？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>さて、これは Ninja ゾーンの人たちにあえて言うことではないかもしれませんが:</p><ol><li>Go の開発経験を、必須ではないが、推奨される</li><li>Splunk の <strong>サポートがない</strong></li><li>ディストリビューションのライフサイクルを管理しなければならない</li></ol><p>プロジェクトは安定性に向けて進んでいますが、行われた変更がワークフローを壊す可能性があることに注意してください。Splunk チームは、より高い安定性とサポートを提供し、デプロイメントニーズに対応するためのキュレーションされた経験を提供しています。</p><h2 id=ninja-ゾーン>Ninja ゾーン<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>必要なツールをすべてインストールしたら、以下のディレクトリ構造に従い、 <code>otelcol-builder.yaml</code> という新しいファイルを作成します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>└── otelcol-builder.yaml</span></span></code></pre></div><p>ファイルを作成したら、インストールするコンポーネントのリストと追加のメタデータを追加する必要があります。</p><p>この例では、導入設定に必要なコンポーネントのみをインストールするためのビルダーマニフェストを作成します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>otelcol-ninja</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>A custom build of the Open Telemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>output_path</span><span class=p>:</span><span class=w> </span><span class=l>./dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/extension/ballastextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/extension/zpagesextension  v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/httpforwarder v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/loggingexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/splunkhecexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/exporter/signalfxexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/batchprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/memorylimiterprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/receiver/otlpreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/zipkinreceiver v0.80.0</span></span></span></code></pre></div><p><em>ocb</em> のためのyamlファイルを作成して更新したら、 次のコマンドを実行します:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ocb --config<span class=o>=</span>otelcol-builder.yaml</span></span></code></pre></div><p>すると、次のようなディレクトリ構造が作成されます:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>├── dist
</span></span><span class=line><span class=cl>│   ├── components.go
</span></span><span class=line><span class=cl>│   ├── components_test.go
</span></span><span class=line><span class=cl>│   ├── go.mod
</span></span><span class=line><span class=cl>│   ├── go.sum
</span></span><span class=line><span class=cl>│   ├── main.go
</span></span><span class=line><span class=cl>│   ├── main_others.go
</span></span><span class=line><span class=cl>│   ├── main_windows.go
</span></span><span class=line><span class=cl>│   └── otelcol-ninja
</span></span><span class=line><span class=cl>└── otelcol-builder.yaml</span></span></code></pre></div><p>最後に、 <code>./dist/otelcol-ninja</code> を実行すれば、独自ビルドのCollectorが動作することがわかります。このコマンドを実行する前に、 <code>otelcol-contrib</code> サービスが停止していることを確認してください。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>./dist/otelcol-ninja --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div><p><strong>この設定ファイルで記述されているコンポーネントは、ビルドに含まれていないかもしれません。エラーの内容を含めて、何が起こるかを見てみましょう</strong> 。</p><h3 id=リファレンス>リファレンス<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><ol><li><a href=https://opentelemetry.io/docs/collector/custom-collector/ rel=external>https://opentelemetry.io/docs/collector/custom-collector/</a></li></ol></div></details><hr><h2 id=デフォルト設定>デフォルト設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry Collector は YAML ファイルを使って設定をしていきます。これらのファイルには、必要に応じて変更できるデフォルト設定が含まれています。提供されているデフォルト設定を見てみましょう:</p><div class=tab-panel data-tab-group=R-tabs-cb8777cea3b27b15315c44224f7cbd2f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-93326db961bbc8dd6058ba3fc347b814 aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-cb8777cea3b27b15315c44224f7cbd2f","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span>
</button>
<button aria-controls=R-tab-id-e6f1ca52b416fabe770efa10e1b0e3dd aria-expanded=false data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-cb8777cea3b27b15315c44224f7cbd2f","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-93326db961bbc8dd6058ba3fc347b814 data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-e6f1ca52b416fabe770efa10e1b0e3dd data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div><p>おめでとうございます！OpenTelemetry Collector のダウンロードとインストールに成功しました。あなたは OTel Ninja になる準備ができました。しかしまずは、設定ファイルと OpenTelemetry Collector の異なるディストリビューションについて見ていきましょう。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>Splunk は、自社で完全にサポートされた OpenTelemetry Collector のディストリビューションを提供しています。このディストリビューションは、<a href=https://github.com/signalfx/splunk-otel-collector rel=external>Splunk GitHub Repository</a> からインストールするか、Splunk Observability Cloud のウィザードを使用して、簡単なインストールスクリプトを作成し、コピー＆ペーストすることで利用できます。このディストリビューションには、OpenTelemetry Collector Contrib ディストリビューションにはない追加機能や強化が含まれています。</p><ul><li>Splunk の OpenTelemetry Collector ディストリビューションは本番環境でテスト済みであり、多くの顧客が本番環境で使用しています。</li><li>このディストリビューションを使用する顧客は、公式の Splunk サポートから、SLA の範囲内で直接支援を受けることができます。</li><li>メトリクスとトレース収集のコア構成体験に将来的な破壊的変更がないことを心配せずに、Splunk の OpenTelemetry Collector ディストリビューションを使用または移行することができます（OpenTelemetry ログ収集の設定はベータ版です）。Collector 自身のメトリクスに破壊的変更がある可能性はあります。</li></ul></div></details><p>このセクションでは、ホストメトリクスを Splunk Observability Cloud に送信するために、設定ファイルの各セクションを詳しく見ていき、変更する方法について説明します。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/02/21</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-エクステンション>OpenTelemetry Collector エクステンション</h1><p>さて、OpenTelemetry Collector はインストールできました。次は OpenTelemetry Collector のエクステンション（拡張機能）を見てみましょう。エクステンションはオプションで、主にテレメトリーデータの処理を伴わないタスクで使用できます。例としては、ヘルスモニタリング、サービスディスカバリ、データ転送などがあります。</p><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;: &#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style E fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Receivers
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article><section><h1 class=a11y-only>2. エクステンションのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-エクステンション>OpenTelemetry Collector エクステンション</h1><h2 id=health-check-エクステンション>Health Check エクステンション<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>他のコンポーネントと同様に、エクステンションは <code>config.yaml</code> ファイルで設定できます。ここでは実際に <code>config.yaml</code> ファイルを編集して、エクステンションを設定していきましょう。デフォルトの <code>config.yaml</code> では、すでに <strong>pprof</strong> エクステンションと <strong>zpages</strong> エクステンションが設定されていることを確認してみてください。このワークショップでは、設定ファイルをアップデートして <strong>health_check</strong> エクステンションを追加し、ポートを解放し、外部ネットワークからコレクターのヘルスチェックにアクセスできるようにしていきます。</p><div class=tab-panel data-tab-group=R-tabs-755c1da17efdba31b44714b333f06a27><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-94fac6de137b869d07fd486ce70639a3 aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-755c1da17efdba31b44714b333f06a27","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div id=R-tab-id-94fac6de137b869d07fd486ce70639a3 data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=R-tabs-b2a9c3e3bc30d324962852c654a60914><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-fb04ad129a0e6afa6787f5ad5ef63451 aria-expanded=true data-tab-item=R-tab-152f0ce564aa5e1309a89e848db53185 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b2a9c3e3bc30d324962852c654a60914","R-tab-152f0ce564aa5e1309a89e848db53185")'>
<span class=tab-nav-text>Extensions Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-fb04ad129a0e6afa6787f5ad5ef63451 data-tab-item=R-tab-152f0ce564aa5e1309a89e848db53185 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span></span></span></code></pre></div></div></div></div></div><p>コレクターを起動します:</p><div class=tab-panel data-tab-group=R-tabs-694471e25dd5df1bdeced066f5d9ed5c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b3bfa459cd78246628bf3e29d8e3518f aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-694471e25dd5df1bdeced066f5d9ed5c","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div id=R-tab-id-b3bfa459cd78246628bf3e29d8e3518f data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart otelcol-contrib</span></span></code></pre></div></div></div></div></div><p>このエクステンションは HTTP の URL を公開し、OpenTelemetry Collector の稼働状況をチェックするプローブを提供します。このエクステンションは Kubernetes 環境での Liveness/Readiness プローブとしても使われています。 <code>curl</code> コマンドの使い方は、<a href=https://curl.se/docs/manpage.html rel=external>curl man page</a> を参照してください。</p><p>次のコマンドを実行します:</p><div class=tab-panel data-tab-group=R-tabs-677b06ceeb0ddf16be266e6be1d7ba6f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-5e2066b934e87fd7178b6a9a16cd435d aria-expanded=true data-tab-item=R-tab-e2d1c201ce0c8c47d452167742abc308 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-677b06ceeb0ddf16be266e6be1d7ba6f","R-tab-e2d1c201ce0c8c47d452167742abc308")'>
<span class=tab-nav-text>curl Command</span>
</button>
<button aria-controls=R-tab-id-4cde53ee5d144393fcf2ec5c75e7b2ab aria-expanded=false data-tab-item=R-tab-6e431ae9119cd9664129d3c3aafa7ce3 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-677b06ceeb0ddf16be266e6be1d7ba6f","R-tab-6e431ae9119cd9664129d3c3aafa7ce3")'>
<span class=tab-nav-text>curl Output</span></button></div><div class=tab-content-container><div id=R-tab-id-5e2066b934e87fd7178b6a9a16cd435d data-tab-item=R-tab-e2d1c201ce0c8c47d452167742abc308 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:13133</span></span></code></pre></div></div></div><div id=R-tab-id-4cde53ee5d144393fcf2ec5c75e7b2ab data-tab-item=R-tab-6e431ae9119cd9664129d3c3aafa7ce3 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;status&#34;:&#34;Server available&#34;,&#34;upSince&#34;:&#34;2023-04-27T10:11:22.153295874+01:00&#34;,&#34;uptime&#34;:&#34;16m24.684476004s&#34;}</span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/05/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-エクステンション>OpenTelemetry Collector エクステンション</h1><h2 id=performance-profiler-エクステンション>Performance Profiler エクステンション<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/pprofextension/README.md rel=external><strong>Performance Profiler</strong></a> エクステンションは、Go の net/http/pprof エンドポイントを有効化します。これは通常、開発者がパフォーマンスプロファイルを収集し、サービスの問題を調査するために使用します。<strong>このワークショップでは詳しく紹介はしません</strong>。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/22</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-エクステンション>OpenTelemetry Collector エクステンション</h1><h2 id=zpages-エクステンション>zPages エクステンション<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/extension/zpagesextension/README.md rel=external><strong>zPages</strong></a> は、外部エクスポータに代わるプロセス内部の機能です。有効化すると、バックグラウンドでトレースとメトリクス情報を収集し、集計し、どのようなデータを扱ったかの Web ページを公開します。zpages は、コレクターが期待どおりに動作していることを確認するための非常に便利な診断機能です。</p><div class=tab-panel data-tab-group=R-tabs-ac6ff2549849cf05ada3b03e6cb6ebd1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-711aa1abf1e8a778c3c38fc089090741 aria-expanded=true data-tab-item=R-tab-552e9e5a9146ffc544b495bfe6a66c36 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-ac6ff2549849cf05ada3b03e6cb6ebd1","R-tab-552e9e5a9146ffc544b495bfe6a66c36")'>
<span class=tab-nav-text>ServiceZ</span>
</button>
<button aria-controls=R-tab-id-8f0ce2d2cfae6cbcb68c23f356e14c5f aria-expanded=false data-tab-item=R-tab-41646adfc5c13ab129b70c2240c1db3d class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-ac6ff2549849cf05ada3b03e6cb6ebd1","R-tab-41646adfc5c13ab129b70c2240c1db3d")'>
<span class=tab-nav-text>PipelineZ</span>
</button>
<button aria-controls=R-tab-id-6b7d0e73761a2cf0503e996397ca82e3 aria-expanded=false data-tab-item=R-tab-3fbf781f7e065ca41160f534cc231df0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-ac6ff2549849cf05ada3b03e6cb6ebd1","R-tab-3fbf781f7e065ca41160f534cc231df0")'>
<span class=tab-nav-text>ExtensionZ</span></button></div><div class=tab-content-container><div id=R-tab-id-711aa1abf1e8a778c3c38fc089090741 data-tab-item=R-tab-552e9e5a9146ffc544b495bfe6a66c36 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p><strong>ServiceZ</strong> は、コレクターサービスの概要と、pipelinez、extensionz、featurez zPages へのクイックアクセスを提供します。このページでは、ビルドとランタイムの情報も提供します。</p><p>URL: <a href=http://localhost:55679/debug/servicez rel=external>http://localhost:55679/debug/servicez</a> (<code>localhost</code> は、適切なホスト名に切り替えてください)</p><p><a href=#R-image-492155d03240d4ef7a74c58541124189 class=lightbox-link><img alt=ServiceZ class="lazy lightbox figure-image" loading=lazy src=../../images/servicez.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-492155d03240d4ef7a74c58541124189><img alt=ServiceZ class="lazy lightbox lightbox-image" loading=lazy src=../../images/servicez.png></a></p></div></div><div id=R-tab-id-8f0ce2d2cfae6cbcb68c23f356e14c5f data-tab-item=R-tab-41646adfc5c13ab129b70c2240c1db3d class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>PipelineZ</strong> は、コレクターで実行中のパイプラインに関する情報を提供します。タイプ、データが変更されているか、各パイプラインで使用されているレシーバー、プロセッサー、エクスポーターの情報を見ることができます。</p><p>URL: <a href=http://localhost:55679/debug/pipelinez rel=external>http://localhost:55679/debug/pipelinez</a> (<code>localhost</code> は、適切なホスト名に切り替えてください)</p><p><a href=#R-image-743319c4d3fbe6fd0581af7c15523490 class=lightbox-link><img alt=PipelineZ class="lazy lightbox figure-image" loading=lazy src=../../images/pipelinez.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-743319c4d3fbe6fd0581af7c15523490><img alt=PipelineZ class="lazy lightbox lightbox-image" loading=lazy src=../../images/pipelinez.png></a></p></div></div><div id=R-tab-id-6b7d0e73761a2cf0503e996397ca82e3 data-tab-item=R-tab-3fbf781f7e065ca41160f534cc231df0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p><strong>ExtensionZ</strong> は、コレクターで有効化されたエクステンションを確認できます。</p><p>Example URL: <a href=http://localhost:55679/debug/extensionz rel=external>http://localhost:55679/debug/extensionz</a> (<code>localhost</code> は、適切なホスト名に切り替えてください)</p><p><a href=#R-image-1cca3516d08386b60661b0bf7b4d0d2b class=lightbox-link><img alt=ExtensionZ class="lazy lightbox figure-image" loading=lazy src=../../images/extensionz.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1cca3516d08386b60661b0bf7b4d0d2b><img alt=ExtensionZ class="lazy lightbox lightbox-image" loading=lazy src=../../images/extensionz.png></a></p></div></div></div></div><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> storage エクステンションでデータの耐久性を向上させる</span></span></summary><div class=box-content><p>これをこなうには、ディストリビューションに <code>file_storage</code> エクステンションモジュールがインストールされていることを確認する必要があります。確認するには、<code>otelcol-contrib components</code> コマンドを実行します:</p><div class=tab-panel data-tab-group=R-tabs-938eb500cc9b9498020d92910d3f3ebe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4ef3394b5330dea6309e44ae782557e1 aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-938eb500cc9b9498020d92910d3f3ebe","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span>
</button>
<button aria-controls=R-tab-id-2ddc01af61f62146d3e820a4ff13def7 aria-expanded=false data-tab-item=R-tab-293717097f4a71a9db50f219169437b8 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-938eb500cc9b9498020d92910d3f3ebe","R-tab-293717097f4a71a9db50f219169437b8")'>
<span class=tab-nav-text>Truncated Output</span>
</button>
<button aria-controls=R-tab-id-1a2e8360d1be41a04a7392cac1c07f82 aria-expanded=false data-tab-item=R-tab-6d20673ef09b9c1f8566526724ee50d7 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-938eb500cc9b9498020d92910d3f3ebe","R-tab-6d20673ef09b9c1f8566526724ee50d7")'>
<span class=tab-nav-text>Full Output</span></button></div><div class=tab-content-container><div id=R-tab-id-4ef3394b5330dea6309e44ae782557e1 data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib components</span></span></code></pre></div></div></div><div id=R-tab-id-2ddc01af61f62146d3e820a4ff13def7 data-tab-item=R-tab-293717097f4a71a9db50f219169437b8 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># ... truncated for clarity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>file_storage</span></span></span></code></pre></div></div></div><div id=R-tab-id-1a2e8360d1be41a04a7392cac1c07f82 data-tab-item=R-tab-6d20673ef09b9c1f8566526724ee50d7 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>buildinfo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>otelcol-contrib</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>OpenTelemetry Collector Contrib</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus_simple</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>influxdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>purefa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>purefb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>receiver_creator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mongodbatlas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>vcenter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>snmp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>expvar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jmx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>skywalking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>udplog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>carbon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafkametrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memcached</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>windowseventlog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsecscontainermetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>iis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nsxt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>aerospike</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>httpcheck</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8sobjects</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mongodb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>hostmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>statsd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsxray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cloudfoundry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>collectd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>couchdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kubeletstats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>journald</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>riak</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>splunk_hec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>active_directory_ds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscloudwatch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sqlquery</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>windowsperfcounters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>flinkmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudpubsub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>podman_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>wavefront</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_events</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>rabbitmq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sqlserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>redis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>solace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tcplog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscontainerinsightreceiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsfirehose</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bigip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filelog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudspanner</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cloudflare</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker_stats</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pulsar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zipkin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>opencensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azureeventhub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>fluentforward</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlpjsonfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>syslog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cumulativetodelta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>groupbyattrs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>groupbytrace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8sattributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>experimental_metricsgeneration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>metricstransform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>deltatorate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>spanmetrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>span</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>redaction</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>servicegraph</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>transform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>filter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>probabilistic_sampler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tail_sampling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>carbon</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>datadog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>f5cloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mezmo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>skywalking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsxray</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>dynatrace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>loki</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azuredataexplorer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>azuremonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>instana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>loadbalancing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sentry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>splunk_hec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tanzuobservability</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zipkin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>alibabacloud_logservice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>clickhouse</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>prometheusremotewrite</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awscloudwatchlogs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlecloudpubsub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaeger_thrift</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logzio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sapm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sumologic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>googlemanagedprometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>opencensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awskinesis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>coralogix</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>influxdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>logicmonitor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>signalfx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tencentcloud_logservice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsemf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>elasticsearch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pulsar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>zpages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bearertokenauth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>oidc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>host_observer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sigv4auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>file_storage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_ballast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>oauth2client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>awsproxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>http_forwarder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>jaegerremotesampling</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>k8s_observer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pprof</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>asapclient</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>basicauth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>headers_setter</span></span></span></code></pre></div></div></div></div></div><p>このエクステンションは、エクスポーターが設定されたエンドポイントにデータを送信できない事象が発生したときに、データをディスクにキューイングする機能をエクスポーターに提供します。</p><p>このエクステンションを設定するには、以下の情報を含むように設定を更新する必要があります。まず、 /tmp/otel-data ディレクトリを作成し、読み取り/書き込み権限を与えてください：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/otel-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/otel-data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_rebound</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rebound_needed_threshold_mib</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rebound_trigger_threshold_mib</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ... truncated for clarity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages, file_storage]</span></span></span></code></pre></div><h2 id=なぜキューデータをディスクに書くの>なぜキューデータをディスクに書くの？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コレクターはネットワークの不調（および、コレクターの再起動）を乗り切って、アップストリームプロバイダーに確実にデータを送信できるようになります。</p><h2 id=キューデータをディスクに書く時の注意事項は>キューデータをディスクに書く時の注意事項は？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ディスクの性能により、データスループットの性能に影響を与える可能性があります</p><h3 id=参照>参照<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><ol><li><a href=https://community.splunk.com/t5/Community-Blog/Data-Persistence-in-the-OpenTelemetry-Collector/ba-p/624583 rel=external>https://community.splunk.com/t5/Community-Blog/Data-Persistence-in-the-OpenTelemetry-Collector/ba-p/624583</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/storage/filestorage rel=external>https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/storage/filestorage</a></li></ol></div></details><hr><h2 id=設定を確認しましょう>設定を確認しましょう<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>さて、エクステンションについて説明したので、設定の変更箇所を確認していきましょう。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>設定ファイルを確認してください</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-9e5ebc62578ef22243e21406a63747d5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-efbb129b6682e6600535d4775fb90beb aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9e5ebc62578ef22243e21406a63747d5","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-efbb129b6682e6600535d4775fb90beb data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=hl><span class=lnt> 3
</span></span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><p>さて、エクステンションについて復習したところで、ワークショップのデータパイプラインの部分に飛び込んでみましょう。パイプラインとは、コレクター内でデータがたどる経路を定義するもので、レシーバーから始まり、追加の処理や変更をし、最終的にエクスポーターを経由してコレクターを出ます。</p><p>OpenTelemetry Collector のデータパイプラインは、レシーバー、プロセッサー、エクスポーターで構成されています。まずは、レシーバーから見ていきましょう。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-レシーバー>OpenTelemetry Collector レシーバー</h1><p>レシーバーワークショップへようこそ！OpenTelemetry Collectorのデータパイプラインのスタート地点です。さあ、始めましょう。</p><p>レシーバーはデータをCollectorに取り込む方法で、プッシュベースとプルベースのものがあります。レシーバーは1つ以上のデータソースをサポートします。一般的に、レシーバーは指定されたフォーマットでデータを受け入れ、内部フォーマットに変換し、該当するパイプラインで定義されたプロセッサやエクスポータにデータを渡します。</p><p>プッシュまたはプルベースのレシーバは、データをCollectorに取り込む方法です。レシーバは 1 つまたは複数のデータソースをサポートします。通常、レシーバは指定されたフォーマットでデータを受け入れ、内部フォーマットに変換し、該当するパイプラインで定義されたプロセッサーや エクスポーターにデータを渡します。</p><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style M fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Receivers
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article><section><h1 class=a11y-only>3. レシーバーのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-レシーバー>OpenTelemetry Collector レシーバー</h1><h2 id=host-metrics-レシーバー>Host Metrics レシーバー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/hostmetricsreceiver/README.md rel=external><strong>Host Metrics レシーバー</strong></a> は、さまざまなソースからスクレイピングされたホストシステムに関するメトリクスを生成します。これは、コレクターがエージェントとしてデプロイされるときに使用さます。</p><p><code>etc/otel-contrib/config.yaml</code> ファイルを更新して、<strong>hostmetrics</strong> レシーバーを設定してみましょう。以下の YAML を <strong>receivers</strong> セクションの下に挿入します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otelcol-contrib/config.yaml</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Tips: vi or nano</summary><div class=box-content><p>vi/vimの操作に慣れていない場合は、<a href=https://www.nano-editor.org/ rel=external>nano</a> もお試しいただくと良いかもしれません。nanoはLinux環境でよく使われる、シンプルなエディタの一つです。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/otelcol-contrib/config.yaml</span></span></code></pre></div><ul><li><code>Alt-U</code> で、アンドゥができます。Macの場合は <code>Esc</code> キーを押したあとに <code>U</code> を押してください！</li><li><code>ctrl-_</code> のあとに数字を入力すると、指定した行数にジャンプします。</li><li><code>ctrl-O</code> のあとに <code>Enter</code> で、ファイルを保存します。</li><li><code>ctrl-X</code> で、nanoを終了します。</li></ul></div></details><div class=tab-panel data-tab-group=R-tabs-213c20c087fe13dd5b9185b25151d828><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-ac842843b5bd0fa00a923e2ce890a70f aria-expanded=true data-tab-item=R-tab-d4d9df34006b2c5d7545d2f1f4e741e2 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-213c20c087fe13dd5b9185b25151d828","R-tab-d4d9df34006b2c5d7545d2f1f4e741e2")'>
<span class=tab-nav-text>Host Metrics Receiver Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-ac842843b5bd0fa00a923e2ce890a70f data-tab-item=R-tab-d4d9df34006b2c5d7545d2f1f4e741e2 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># process:</span></span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-レシーバー>OpenTelemetry Collector レシーバー</h1><h2 id=prometheus-レシーバー>Prometheus レシーバー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><strong>Prometheus</strong> のレシーバーも、もちろんあります。<a href=https://prometheus.io/docs/introduction/overview/ rel=external>Prometheus</a> は OpenTelemetry Collector で使われているオープンソースのツールキットです。このレシーバーは、OpenTelemetry Collector 自身からメトリクスをスクレイピングするためにも使われます。これらのメトリクスは、コレクタの健全性をモニタリングするために使用できる。</p><p>ここでは、<strong>prometheus</strong> レシーバーを変更して、コレクター自身からメトリクスを収集できるようにしてみます。レシーバーの名前を <strong>prometheus</strong> から <strong>prometheus/internal</strong> に変更して、レシーバーが何をしているのかをより明確しましょう。設定ファイルを以下のように更新します：</p><div class=tab-panel data-tab-group=R-tabs-91a9960d11b92cb8106a245ea6f5c9a0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-0f732f8ec88fc69e58b23198551b2540 aria-expanded=true data-tab-item=R-tab-9f44d03ea283a5e0ba757b4cfcb8e9c2 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-91a9960d11b92cb8106a245ea6f5c9a0","R-tab-9f44d03ea283a5e0ba757b4cfcb8e9c2")'>
<span class=tab-nav-text>Prometheus Receiver Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-0f732f8ec88fc69e58b23198551b2540 data-tab-item=R-tab-9f44d03ea283a5e0ba757b4cfcb8e9c2 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class="line hl"><span class=cl><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span></span></span></code></pre></div></div></div></div></div><p>上記の設定では、OpenTelemetry Collector 自身が公開している Prometheus エンドポイントをスクレイピングしています。どのような情報が得られるか、<code>curl</code> コマンドで試すことができます:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:8888/metrics</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Tips: コンポーネントに名前をつける</summary><div class=box-content><p>レシーバー、プロセッサー、エクスポーター、パイプラインなどのコンポーネントは、 <code>otlp</code> や <code>otlp/2</code> のように、 <code>type[/name]</code> 形式に従った識別子によって定義されます。識別子が一意である限り、与えられたタイプのコンポーネントを複数回定義することができるようになります。</p><p>ここでは <code>prometheus/internal</code> という識別子でこのコンポーネントを特定できるようにしたので、別の <code>prometheus</code> レシーバーを追加して、監視対象インスタンスの Prometheus エンドポイントをスクレイピングさせることもできます。</p></div></details><h2 id=ダッシュボード例---prometheus-メトリクス>ダッシュボード例 - Prometheus メトリクス<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このスクリーンショットは、 <code>prometheus/internal</code> レシーバーが OpenTelemetry Collector から収集したメトリクスの、spmeのダッシュボードの例です。ここではスパン・メトリクス・ログの、それぞれの受信および送信の様子を見ることができます。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>このダッシュボードはSplunk Observability Cloud にある組み込みダッシュボードで、Splunk OpenTelemetry Collector のインストールの状況を簡単にモニタリングできます。</p></div></details><p><a href=#R-image-e1e7413b288e856c71501c279d260647 class=lightbox-link><img alt=otel-charts class="lazy lightbox figure-image" loading=lazy src=../../images/otel-charts.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e1e7413b288e856c71501c279d260647><img alt=otel-charts class="lazy lightbox lightbox-image" loading=lazy src=../../images/otel-charts.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-レシーバー>OpenTelemetry Collector レシーバー</h1><h2 id=その他のレシーバー>その他のレシーバー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>デフォルトの設定には、他のレシーバーがあることに気づくはずです。 <strong><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/receiver/otlpreceiver rel=external>otlp</a></strong>、<strong><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/opencensusreceiver rel=external>opencensus</a></strong>、<strong><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/jaegerreceiver rel=external>jaeger</a></strong>、<strong><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/zipkinreceiver rel=external>zipkin</a></strong> が定義されています。これらは他のソースからテレメトリーデータを受信するために使われます。このワークショップでは、これらのレシーバーについては取り上げませんので、そのままにしておきましょう。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> レシーバーを動的に生成する</span></span></summary><div class=box-content><p>dockerコンテナ、kubernetesポッド、sshセッションのような短時間のタスクを観測するために、<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator rel=external>receiver creator</a> レシーバーと <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/extension/observer rel=external>observer</a> エクステンションを使って、対象のサービスが起動するタイミングで新しいレシーバーを作成することができます。</p><h2 id=何が必要なの>何が必要なの？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>receiver creator とそれに関連する observer エクステンションの使用を開始するには、collector build manifest に追加する必要があります。</p><p>詳細は <a href=/observability-workshop/ja/other/opentelemetry-collector/1-installation/index.html>installation</a> を参照してください。</p><h2 id=注意事項はある>注意事項はある？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>短命なタスクの中には、<em>username</em> や <em>password</em> のような追加設定を必要とするものがあります。それらの値は<a href=https://opentelemetry.io/docs/collector/configuration/#configuration-environment-variables rel=external>環境変数</a> を参照したり、 <code>${file:./path/to/database/password}</code> のようなスキーム展開構文を使うこともできます。</p><p>組織における機密情報の取り扱い規定に従って、どのような方法を取るかを検討してください。</p><h2 id=ninja-ゾーン>Ninja ゾーン<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>この Ninja ゾーンに必要なものは2つだけです:</p><ol><li>builder manifestに、 receiver creator レシーバーと observer エクステンションを追加する</li><li>検出されたエンドポイントを検出するように、設定を作成する</li></ol><p>次のようにすると、設定をテンプレート化できます:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>watch_observers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>host_observer]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;port&#34; &amp;&amp; port == 6379</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>${env:HOST_REDIS_PASSWORD}</span></span></span></code></pre></div><p>他の例は <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/receivercreator#examples rel=external>receiver creator&rsquo;s examples</a> にあります。</p></div></details><hr><h2 id=設定を確認しましょう>設定を確認しましょう<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>これで、レシーバーをカバーできました。ここで、設定のの変更内容をチェックしてみましょう。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>設定をレビューしてください</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-fec8a64faa8efb079c63a47ea0203580><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-febab975289e74b2e6c23ce4e79d7b36 aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-fec8a64faa8efb079c63a47ea0203580","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-febab975289e74b2e6c23ce4e79d7b36 data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=hl><span class=lnt>10
</span></span><span class=hl><span class=lnt>11
</span></span><span class=hl><span class=lnt>12
</span></span><span class=hl><span class=lnt>13
</span></span><span class=hl><span class=lnt>14
</span></span><span class=hl><span class=lnt>15
</span></span><span class=hl><span class=lnt>16
</span></span><span class=hl><span class=lnt>17
</span></span><span class=hl><span class=lnt>18
</span></span><span class=hl><span class=lnt>19
</span></span><span class=hl><span class=lnt>20
</span></span><span class=hl><span class=lnt>21
</span></span><span class=hl><span class=lnt>22
</span></span><span class=hl><span class=lnt>23
</span></span><span class=hl><span class=lnt>24
</span></span><span class=hl><span class=lnt>25
</span></span><span class=hl><span class=lnt>26
</span></span><span class=hl><span class=lnt>27
</span></span><span class=hl><span class=lnt>28
</span></span><span class=hl><span class=lnt>29
</span></span><span class=hl><span class=lnt>30
</span></span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=hl><span class=lnt>39
</span></span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><p>これで、レシーバーを通して OpenTelemetry Collector にデータがどのように取り込まれるかを確認しました。次に、コレクターが受信したデータをどのように処理するかを見てみましょう。</p><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
警告</summary><div class=box-content><p><strong>ここではコレクターを再起動しないでください</strong>！ <code>/etc/otelcol-contrib/config.yaml</code> の変更はまだ完了していません。</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-プロセッサー>OpenTelemetry Collector プロセッサー</h1><p><a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/README.md rel=external><strong>プロセッサー</strong></a>は、レシーバーとエクスポーターとの間で、データに対して実行される処理です。プロセッサーはオプションですが、いくつかは推奨されています。OpenTelemetry Collector Contrib には<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor rel=external>多数のプロセッサー</a>が含まれています。</p><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style Processors fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Receivers
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article><section><h1 class=a11y-only>4. プロセッサーのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-プロセッサー>OpenTelemetry Collector プロセッサー</h1><h2 id=batch-プロセッサー>Batch プロセッサー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>デフォルトでは、<strong>batch</strong> プロセッサーだけが有効になっています。このプロセッサーは、データをエクスポートする前にバッチ処理して、エクスポーターへのネットワーク・コールの回数を減らすために使われます。このワークショップではデフォルトの設定を使用します：</p><ul><li><code>send_batch_size</code> (デフォルト = 8192): タイムアウトに関係なく、バッチを送信するスパン、メトリクスデータポイント、またはログレコードの数。パイプラインの次のコンポーネントに送信されるバッチサイズを制限する場合には、 <code>send_batch_max_size</code> を使います。</li><li><code>timeout</code> (デフォルト = 200ms): サイズに関係なく、バッチが送信されるまでの時間。ゼロに設定すると、<code>send_batch_size</code> の設定を無視して <code>send_batch_max_size</code> だけが適用され、データは直ちに送信されます。</li><li><code>send_batch_max_size</code> (デフォルト = 0): バッチサイズの上限。<code>0</code> を設定すると、バッチサイズの上限がないことして扱われます。この設定は、大きなバッチが小さなユニットに分割されることを保証します。<code>send_batch_size</code> 以上でなければななりません。</li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-プロセッサー>OpenTelemetry Collector プロセッサー</h1><h2 id=resource-detection-プロセッサー>Resource Detection プロセッサー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><strong>resourcedetection</strong> プロセッサーは、ホストからリソース情報を検出して、テレメトリーデータ内のリソース値をこの情報で追加または上書きすることができます。</p><p>デフォルトでは、可能であればホスト名を FQDN に設定し、そうでなければ OS が提供するホスト名になります。このロジックは <code>hostname_sources</code> オプションを使って変更できます。FQDN を取得せず、OSが提供するホスト名を使用するには、<code>hostname_sources</code>を<code>os</code>に設定します。</p><div class=tab-panel data-tab-group=R-tabs-39ff74f74eff8b4e13dd26cae9b28ef5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-a81e0ee983c71bba9805c8ac0ca71a80 aria-expanded=true data-tab-item=R-tab-b892811c417d9a038325e7378a05c132 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-39ff74f74eff8b4e13dd26cae9b28ef5","R-tab-b892811c417d9a038325e7378a05c132")'>
<span class=tab-nav-text>System Resource Detection Processor Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-a81e0ee983c71bba9805c8ac0ca71a80 data-tab-item=R-tab-b892811c417d9a038325e7378a05c132 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span></span></span></code></pre></div></div></div></div></div><p>If the workshop instance is running on an AWS/EC2 instance we can gather the following tags from the EC2 metadata API (this is not available on other platforms).
ワークショップのインスタンスが AWS/EC2 インスタンスで実行されている場合、EC2 のメタデータ API から以下のタグを収集します（これは他のプラットフォームでは利用できないものもあります）。</p><ul><li><code>cloud.provider ("aws")</code></li><li><code>cloud.platform ("aws_ec2")</code></li><li><code>cloud.account.id</code></li><li><code>cloud.region</code></li><li><code>cloud.availability_zone</code></li><li><code>host.id</code></li><li><code>host.image.id</code></li><li><code>host.name</code></li><li><code>host.type</code></li></ul><p>これらのタグをメトリクスに追加するために、別のプロセッサーとして定義してみましょう。</p><div class=tab-panel data-tab-group=R-tabs-6649cda509069a8312f715f036aa02b8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-309f65ecdb15710e22853dff87f42d7d aria-expanded=true data-tab-item=R-tab-cfb68818ad6985dd73e8c42294095dee class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-6649cda509069a8312f715f036aa02b8","R-tab-cfb68818ad6985dd73e8c42294095dee")'>
<span class=tab-nav-text>EC2 Resource Detection Processor Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-309f65ecdb15710e22853dff87f42d7d data-tab-item=R-tab-cfb68818ad6985dd73e8c42294095dee class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span></span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-プロセッサー>OpenTelemetry Collector プロセッサー</h1><h2 id=attributes-プロセッサー>Attributes プロセッサー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>attribute プロセッサーを使うと、スパン、ログ、またはメトリクスの属性を変更できます。また、このプロセッサーは、入力データをフィルタリングし、マッチさせ、指定されたアクションに含めるべきか、除外すべきかを決定する機能もサポートしています。</p><p>アクションを設定するには、指定された順序で実行されるアクションのリストを記述します。サポートされるアクションは以下の通りです：</p><ul><li><code>insert</code>: その属性がない場合に、新しい属性値を挿入します。</li><li><code>update</code>: その属性がある場合に、その属性値を更新します。</li><li><code>upsert</code>: insert または update を実行します。属性がない場合には新しい属性値を挿入し、属性がある場合にはその値を更新します。</li><li><code>delete</code>: 入力データから属性値を削除します。</li><li><code>hash</code>: 属性値をハッシュ化 (SHA1) します。</li><li><code>extract</code>: 入力キーの値を正規表現ルールを使って抽出し、対象キーの値を更新します。対象キーがすでに存在する場合は、その値は上書きされます。</li></ul><p>次の例のように、attribute プロセッサーを使って、キーは <code>participant.name</code>、あたいはあなたの名前（例: <code>marge_simpson</code>）という新しい属性を追加してみましょう。</p><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
警告</summary><div class=box-content><p><code>INSERT_YOUR_NAME_HERE</code> の箇所は、自分の名前に置き換えてください。また、自分の名前に <strong>スペースを使わない</strong> ようにしてください。</p></div></details><p>このワークショップの後半では、この属性を使用して Splunk Observability Cloud でメトリクスをフィルタリングします。</p><div class=tab-panel data-tab-group=R-tabs-f88c066ff1242fe89cfc02f32424da72><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-202e947874b0be1d6d609bed0fe87b7f aria-expanded=true data-tab-item=R-tab-99b4d39895514cfa032ce15a26ea7099 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-f88c066ff1242fe89cfc02f32424da72","R-tab-99b4d39895514cfa032ce15a26ea7099")'>
<span class=tab-nav-text>Attributes Processor Configuration</span></button></div><div class=tab-content-container><div id=R-tab-id-202e947874b0be1d6d609bed0fe87b7f data-tab-item=R-tab-99b4d39895514cfa032ce15a26ea7099 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span></span></span></code></pre></div></div></div></div></div><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> コネクターを使って内部への洞察を加速する</span></span></summary><div class=box-content><p>最近追加されたものの一つとして、<a href=https://opentelemetry.io/docs/collector/configuration/#connectors rel=external>connector</a> というコンセプトがあります。これを使うと、あるパイプラインの出力を別のパイプラインの入力に結合できるようになります。</p><p>利用シーンとして、送信するデータポイントの量、エラーステータスを含むログの数をメトリクスをとして出力するサービスがあります。他には、あるデプロイ環境から送信されるデータ量のメトリクスを生成するサービスがあります。このような場合に、count コネクターですぐに対応できます。</p><h2 id=プロセッサーではなくコネクターなのはなぜ>プロセッサーではなくコネクターなのはなぜ？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>プロセッサーは、処理したデータを次に渡すものであり、追加の情報を出力することはできません。コネクターはレシーバーで受け取ったデータを出力せずに、私たちが求める洞察を作り出す機会を提供します。</p><p>たとえば、count コネクターを使うと、環境変数 <code>deployment</code> を持たないログ、メトリクス、トレースの数をカウントすることができます。</p><p>また、非常にシンプルな例として、<code>deployment</code> 別にデータ使用量を分解して出力することもできます。</p><h2 id=コネクターの注意事項>コネクターの注意事項<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コネクターは、あるパイプラインからエクスポートされ、別のパイプラインでレシーバーで定義されたデータのみを受け入れます。コレクターをどう構築してどう利用するか、設定を検討する必要があります。</p><h2 id=参照>参照<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ol><li><a href=https://opentelemetry.io/docs/collector/configuration/#connectors rel=external>https://opentelemetry.io/docs/collector/configuration/#connectors</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector rel=external>https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/countconnector</a></li></ol></div></details><hr><h2 id=設定を確認しましょう>設定を確認しましょう<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>これで、プロセッサーがカバーできました。ここで、設定のの変更内容をチェックしてみましょう。</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>設定をレビューしてください</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-d5d915ab8fb753866dd98b4353a84e53><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-13d119b5cc7f1ee03f5137cbcf88a0cd aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-d5d915ab8fb753866dd98b4353a84e53","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-13d119b5cc7f1ee03f5137cbcf88a0cd data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=hl><span class=lnt>58
</span></span><span class=hl><span class=lnt>59
</span></span><span class=hl><span class=lnt>60
</span></span><span class=hl><span class=lnt>61
</span></span><span class=hl><span class=lnt>62
</span></span><span class=hl><span class=lnt>63
</span></span><span class=hl><span class=lnt>64
</span></span><span class=hl><span class=lnt>65
</span></span><span class=hl><span class=lnt>66
</span></span><span class=hl><span class=lnt>67
</span></span><span class=hl><span class=lnt>68
</span></span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/01</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-エクスポーター>OpenTelemetry Collector エクスポーター</h1><p>エクスポーターは、プッシュまたはプルベースであり、一つ以上のバックエンド/デスティネーションにデータを送信する方法です。エクスポーターは、一つまたは複数のデータソースをサポートすることがあります。</p><p>このワークショップでは、<a href=https://opentelemetry.io/docs/specs/otel/protocol/exporter/ rel=external><strong>otlphttp</strong></a> エクスポーターを使用します。OpenTelemetry Protocol (OTLP) は、テレメトリーデータを伝送するためのベンダーニュートラルで標準化されたプロトコルです。OTLP エクスポーターは、OTLP プロトコルを実装するサーバーにデータを送信します。OTLP エクスポーターは、<a href=https://grpc.io/ rel=external><strong>gRPC</strong></a> および <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview rel=external><strong>HTTP</strong></a>/<a href=https://www.json.org/json-en.html rel=external><strong>JSON</strong></a> プロトコルの両方をサポートします。</p><pre class="mermaid actionbar-wrapper align-center">
%%{
  init:{
    &#34;theme&#34;:&#34;base&#34;,
    &#34;themeVariables&#34;: {
      &#34;primaryColor&#34;: &#34;#ffffff&#34;,
      &#34;clusterBkg&#34;: &#34;#eff2fb&#34;,
      &#34;defaultLinkColor&#34;: &#34;#333333&#34;
    }
  }
}%%

flowchart LR;
    style Exporters fill:#e20082,stroke:#333,stroke-width:4px,color:#fff
    subgraph Receivers
    A[OTLP] --&gt; M(Receivers)
    B[JAEGER] --&gt; M(Receivers)
    C[Prometheus] --&gt; M(Receivers)
    end
    subgraph Processors
    M(Receivers) --&gt; H(Filters, Attributes, etc)
    E(Extensions)
    end
    subgraph Exporters
    H(Filters, Attributes, etc) --&gt; S(OTLP)
    H(Filters, Attributes, etc) --&gt; T(JAEGER)
    H(Filters, Attributes, etc) --&gt; U(Prometheus)
    end
</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article><section><h1 class=a11y-only>5. エクスポーターのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-エクスポーター>OpenTelemetry Collector エクスポーター</h1><h2 id=otlp-http-エクスポーター>OTLP HTTP エクスポーター<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Splunk Observability Cloud へ HTTP 経由でメトリックスを送信するためには、<strong>otlphttp</strong> エクスポーターを設定する必要があります。</p><p><code>/etc/otelcol-contrib/config.yaml</code> ファイルを編集し、<strong>otlphttp</strong> エクスポーターを設定しましょう。以下の YAML を <strong>exporters</strong> セクションの下に挿入し、例えば2スペースでインデントしてください。</p><p>また、ディスクの容量不足を防ぐために、ロギングエクスポーターの詳細度を変更します。デフォルトの <code>detailed</code> は非常に詳細です。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=l>otlphttp/splunk:</span></span></span></code></pre></div><p>次に、<code>metrics_endpoint</code> を定義して、ターゲットURLを設定していきます。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>Splunk 主催のワークショップの参加者である場合、使用しているインスタンスにはすでに Realm 環境変数が設定されています。その環境変数を設定ファイルで参照します。それ以外の場合は、新しい環境変数を作成して Realm を設定する必要があります。例えば：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;us1&#34;</span></span></span></code></pre></div></div></details><p>使用するURLは <code>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</code> です。（Splunkは、データの居住地に応じて世界中の主要地域に Realm を持っています）。</p><p><strong>otlphttp</strong> エクスポーターは、<code>traces_endpoint</code> と <code>logs_endpoint</code> それぞれのターゲットURLを定義することにより、トレースとログを送信するようにも設定できますが、そのような設定はこのワークショップの範囲外とします。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span></span></span></code></pre></div><p>デフォルトでは、すべてのエンドポイントで <code>gzip</code> 圧縮が有効になっています。エクスポーターの設定で <code>compression: none</code> を設定することにより、圧縮を無効にすることができます。このワークショップでは圧縮を有効にしたままにし、データを送信する最も効率的な方法としてデフォルト設定を使っていきます。</p><p>Splunk Observability Cloud にメトリクスを送信するためには、アクセストークンを使用する必要があります。これは、Splunk Observability Cloud UI で新しいトークンを作成することにより行うことができます。トークンの作成方法についての詳細は、<a href=https://docs.splunk.com/Observability/admin/authentication-tokens/org-tokens.html rel=external>Create a token</a> を参照してください。トークンは <strong>INGEST</strong> タイプである必要があります。</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>Splunk　主催のワークショップの参加者である場合、使用しているインスタンスにはすでにアクセストークンが設定されています（環境変数として設定されています）ので、その環境変数を設定ファイルで参照します。それ以外の場合は、新しいトークンを作成し、それを環境変数として設定する必要があります。例えば：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span>&lt;replace-with-your-token&gt;</span></span></code></pre></div></div></details><p>トークンは、設定ファイル内で <code>headers:</code> セクションの下に <code>X-SF-TOKEN: ${env:ACCESS_TOKEN}</code> を挿入することにで定義します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span></span></span></code></pre></div><h2 id=設定を確認しましょう>設定を確認しましょう<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>これで、エクスポーターもカバーできました。設定を確認していきましょう：</p><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>設定をレビューしてください</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-bf0c14f1de868dc25dc1cf8b4ce8a58d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-d117003025f2c93890d7e59876c7d1cb aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-bf0c14f1de868dc25dc1cf8b4ce8a58d","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-d117003025f2c93890d7e59876c7d1cb data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=hl><span class=lnt>72
</span></span><span class=hl><span class=lnt>73
</span></span><span class=hl><span class=lnt>74
</span></span><span class=hl><span class=lnt>75
</span></span><span class=hl><span class=lnt>76
</span></span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><p>もちろん、<strong>OTLP</strong> プロトコルをサポートする他のソリューションを指すように <code>metrics_endpoint</code> を簡単に設定することができます。</p><p>次に、<code>config.yaml</code> のサービスセクションで、今設定したレシーバー、プロセッサー、エクスポーターを有効にしていきます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=opentelemetry-collector-サービス>OpenTelemetry Collector サービス</h1><p><strong>Service</strong> セクションでは、レシーバー、プロセッサー、エクスポーター、およびエクステンションにある設定に基づいて、コレクターで有効にするコンポーネントを設定していきます。</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
情報</summary><div class=box-content><p>コンポーネントが設定されていても、<strong>Service</strong> セクション内で定義されていない場合、そのコンポーネントは<strong>有効化されません</strong>。</p></div></details><p>サービスのセクションは、以下の3つのサブセクションで構成されています：</p><ul><li>extensions（拡張機能）</li><li>pipelines（パイプライン）</li><li>telemetry（テレメトリー）</li></ul><p>デフォルトの設定では、拡張機能セクションが <code>health_check</code>、<code>pprof</code>、<code>zpages</code> を有効にするように設定されており、これらは以前のエクステンションのモジュールで設定しました。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></div><p>それでは、メトリックパイプラインを設定していきましょう！</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/27</span></span></footer></article><section><h1 class=a11y-only>6. サービスのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-サービス>OpenTelemetry Collector サービス</h1><h2 id=hostmetrics-レシーバー>Hostmetrics レシーバー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップのレシーバー部分で振り返ると、ホストシステムに関するメトリクスを生成するために、様々なソースからスクレイピングする <a href=/observability-workshop/ja/other/opentelemetry-collector/3-receivers/index.html#host-metrics-receiver>Host Metrics</a> レシーバーを定義しました。このレシーバーを有効にするためには、メトリクスパイプラインに <code>hostmetrics</code> レシーバーを含める必要があります。</p><p><code>metrics</code> パイプラインで、メトリクスの <code>receivers</code> セクションに <code>hostmetrics</code> を追加します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-サービス>OpenTelemetry Collector サービス</h1><h2 id=prometheus-internal-レシーバー>Prometheus Internal レシーバー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップの前半で、<code>prometheus</code> レシーバーの名前を変更し、コレクター内部のメトリクスを収集していることを反映して、<code>prometheus/internal</code> という名前にしました。</p><p>現在、メトリクスパイプラインの下で <code>prometheus/internal</code> レシーバーを有効にする必要があります。<code>metrics</code> パイプラインの下の <code>receivers</code> セクションを更新して、<code>prometheus/internal</code> を含めます：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-サービス>OpenTelemetry Collector サービス</h1><h2 id=resource-detection-プロセッサー>Resource Detection プロセッサー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>また、コレクターがインスタンスのホスト名やAWS/EC2のメタデータを取得できるように、<code>resourcedetection/system</code> および <code>resourcedetection/ec2</code> プロセッサーを追加しました。これらのプロセッサーをメトリクスパイプライン下で有効にする必要があります。</p><p><code>metrics</code> パイプラインの下の <code>processors</code> セクションを更新して、<code>resourcedetection/system</code> および <code>resourcedetection/ec2</code> を追加します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-サービス>OpenTelemetry Collector サービス</h1><h2 id=attributes-プロセッサー>Attributes プロセッサー<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>また、このワークショップのプロセッサーセクションでは、<code>attributes/conf</code> プロセッサーを追加し、コレクターがすべてのメトリクスに <code>participant.name</code> という新しい属性を挿入するようにしました。これをメトリクスパイプライン下で有効にする必要があります。</p><p><code>metrics</code> パイプラインの下の <code>processors</code> セクションを更新して、<code>attributes/conf</code> を追加します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/27</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-サービス>OpenTelemetry Collector サービス</h1><h2 id=otlp-http-エクスポーター>OTLP HTTP エクスポーター<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ワークショップのエクスポーターセクションでは、<code>otlphttp</code> エクスポーターを設定して、メトリクスを Splunk Observability Cloud に送信するようにしました。これをメトリクスパイプライン下で有効にする必要があります。</p><p><code>metrics</code> パイプラインの下の <code>exporters</code> セクションを更新して、<code>otlphttp/splunk</code> を追加します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging, otlphttp/splunk]</span></span></span></code></pre></div><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> コレクターの内部を観測する</span></span></summary><div class=box-content><p>コレクターは、その動作に関する内部シグナルを捕捉しています。これには実行中のコンポーネントからの追加されるシグナルも含まれます。これは、データの流れに関する決定を行うコンポーネントが、その情報をメトリクスやトレースとして表面化する方法を必要とするためです。</p><h2 id=なぜコレクターを監視するの>なぜコレクターを監視するの？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>これは「監視者を監視するのは誰か？」という種類の問題ですが、このような情報を表面化できることは重要です。コレクターの歴史の興味深い部分は、GoメトリクスのSDKが安定と考えられる前に存在していたことで、コレクターは当面の間、この機能を提供するために Prometheus エンドポイントを公開しています。</p><h2 id=注意点>注意点<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>組織内で稼働している各コレクターの内部使用状況を監視することは、新しいメトリクス量（MTS）を大幅な増加させる可能性があります。Splunkディストリビューションはこれらのメトリクスをキュレーションしており、増加を予測するのに役立ちます。</p><h2 id=ninja-ゾーン>Ninja ゾーン<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コレクターの内部オブザーバビリティを公開するためには、いくつかの設定を追加することがあります：</p><div class=tab-panel data-tab-group=R-tabs-63444495ef982798065359eb910e04f2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-53cc4c53a453ae120d5943cc100cf63d aria-expanded=true data-tab-item=R-tab-b7b7f11d9c9c56d1979ca775dec8b62b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-63444495ef982798065359eb910e04f2","R-tab-b7b7f11d9c9c56d1979ca775dec8b62b")'>
<span class=tab-nav-text>telemetry schema</span>
</button>
<button aria-controls=R-tab-id-fb2478d04e882fecf645c44136eaed91 aria-expanded=false data-tab-item=R-tab-55b005c9d9b0488c209e03663dcdc6fa class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-63444495ef982798065359eb910e04f2","R-tab-55b005c9d9b0488c209e03663dcdc6fa")'>
<span class=tab-nav-text>example-config.yml</span></button></div><div class=tab-content-container><div id=R-tab-id-53cc4c53a453ae120d5943cc100cf63d data-tab-item=R-tab-b7b7f11d9c9c56d1979ca775dec8b62b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>&lt;info|warn|error&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>development</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>&lt;console|json&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_caller</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_stacktrace</span><span class=p>:</span><span class=w> </span><span class=l>&lt;true|false&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>output_paths</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>&lt;stdout|stderr&gt;, paths...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>error_output_paths</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>&lt;stdout|stderr&gt;, paths...]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initial_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>&lt;none|basic|normal|detailed&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Address binds the promethues endpoint to scrape</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>&lt;hostname:port&gt;</span></span></span></code></pre></div></div></div><div id=R-tab-id-fb2478d04e882fecf645c44136eaed91 data-tab-item=R-tab-55b005c9d9b0488c209e03663dcdc6fa class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>encoding</span><span class=p>:</span><span class=w> </span><span class=l>json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disable_stacktrace</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initial_fields</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>instance.name</span><span class=p>:</span><span class=w> </span><span class=l>${env:INSTANCE}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=l>localhost:8888 </span></span></span></code></pre></div></div></div></div></div><h2 id=参照>参照<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ol><li><a href=https://opentelemetry.io/docs/collector/configuration/#service rel=external>https://opentelemetry.io/docs/collector/configuration/#service</a></li></ol></div></details><hr><h2 id=完成した設定>完成した設定<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><hr><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>完成した設定をレビューしてください</span></span></summary><div class=box-content><div class=tab-panel data-tab-group=R-tabs-29cedb04e824d78fd3700605cc0179b3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-6ec6500324e183507966e91fddc75569 aria-expanded=true data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-29cedb04e824d78fd3700605cc0179b3","R-tab-259fe82e12a866f01123927480c7851b")'>
<span class=tab-nav-text>config.yaml</span></button></div><div class=tab-content-container><div id=R-tab-id-6ec6500324e183507966e91fddc75569 data-tab-item=R-tab-259fe82e12a866f01123927480c7851b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=hl><span class=lnt>88
</span></span><span class=hl><span class=lnt>89
</span></span><span class=hl><span class=lnt>90
</span></span><span class=lnt>91
</span><span class=lnt>92
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pprof</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>1777</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zpages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>55679</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Disk I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File System utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>filesystem</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Memory utilization metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network interface I/O metrics &amp; TCP connection metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CPU load metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>load</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Paging/Swap space utilization and I/O metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Process count metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Per process CPU, Memory and Disk I/O metrics. Disabled by default.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># process:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opencensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Collect own metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prometheus/internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>scrape_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;otel-collector&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrape_interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>static_configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;0.0.0.0:8888&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jaeger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>grpc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_binary</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_compact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>thrift_http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>zipkin</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>system</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>hostname_sources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>os]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection/ec2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>ec2]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/conf</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>participant.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;INSERT_YOUR_NAME_HERE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logging</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>normal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp/splunk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics_endpoint</span><span class=p>:</span><span class=w> </span><span class=l>https://ingest.${env:REALM}.signalfx.com/v2/datapoint/otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${env:ACCESS_TOKEN}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp, opencensus, jaeger, zipkin]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>hostmetrics, otlp, opencensus, prometheus/internal]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>batch, resourcedetection/system, resourcedetection/ec2, attributes/conf] </span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>logging, otlphttp/splunk]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check, pprof, zpages]</span></span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></details><hr><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ヒント</summary><div class=box-content><p>コレクターを再起動する前に、設定ファイルを検証することをお勧めします。これは、組み込みの <code>validate</code> コマンドを使用して行うことができます：</p><div class=tab-panel data-tab-group=R-tabs-236e0ba61f22d8771de67585f4a9d5ed><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-f85ef2a08d24af1fabb60508fbfb41b1 aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-236e0ba61f22d8771de67585f4a9d5ed","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span>
</button>
<button aria-controls=R-tab-id-4afdb5fa35c40310f5facd524a55330f aria-expanded=false data-tab-item=R-tab-553ad8ce3bcd210b497dfad469f8d0e2 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-236e0ba61f22d8771de67585f4a9d5ed","R-tab-553ad8ce3bcd210b497dfad469f8d0e2")'>
<span class=tab-nav-text>Example error output</span></button></div><div class=tab-content-container><div id=R-tab-id-f85ef2a08d24af1fabb60508fbfb41b1 data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol-contrib validate --config<span class=o>=</span>file:/etc/otelcol-contrib/config.yaml</span></span></code></pre></div></div></div><div id=R-tab-id-4afdb5fa35c40310f5facd524a55330f data-tab-item=R-tab-553ad8ce3bcd210b497dfad469f8d0e2 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Error: failed to get config: cannot unmarshal the configuration: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* error decoding &#39;processors&#39;: error reading configuration for &#34;attributes/conf&#34;: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* &#39;actions[0]&#39; has invalid keys: actions
</span></span><span class=line><span class=cl>2023/06/29 09:41:28 collector server run finished with error: failed to get config: cannot unmarshal the configuration: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* error decoding &#39;processors&#39;: error reading configuration for &#34;attributes/conf&#34;: 1 error(s) decoding:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>* &#39;actions[0]&#39; has invalid keys: actions</span></span></code></pre></div></div></div></div></div></div></details><p>動作する設定ができたので、コレクターを起動し、その後 <a href=/observability-workshop/ja/other/opentelemetry-collector/2-extensions/index.html#zpages>zPages</a> が報告している内容を確認しましょう。</p><div class=tab-panel data-tab-group=R-tabs-1c16bfcda535932934546e7343df2e34><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-7b65c1539b038ee1027f230ceacc3afa aria-expanded=true data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-1c16bfcda535932934546e7343df2e34","R-tab-ee97be03cb04119af45014d815621ce1")'>
<span class=tab-nav-text>Command</span></button></div><div class=tab-content-container><div id=R-tab-id-7b65c1539b038ee1027f230ceacc3afa data-tab-item=R-tab-ee97be03cb04119af45014d815621ce1 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart otelcol-contrib</span></span></code></pre></div></div></div></div></div><p><a href=#R-image-673f7ee39a4a78741bfd504c7bbd44a8 class=lightbox-link><img alt=pipelinez-full-config class="lazy lightbox figure-image" loading=lazy src=../../images/pipelinez-full-config.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-673f7ee39a4a78741bfd504c7bbd44a8><img alt=pipelinez-full-config class="lazy lightbox lightbox-image" loading=lazy src=../../images/pipelinez-full-config.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/19</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=データの可視化>データの可視化</h1><h2 id=splunk-observability-cloud>Splunk Observability Cloud<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>OpenTelemetry Collector を設定して Splunk Observability Cloud にメトリクスを送信するようにしたので、Splunk Observability Cloud でデータを見てみましょう。Splunk Observability Cloud　への招待を受け取っていない場合は、講師がログイン資格情報を提供します。</p><p>その前に、もう少し興味深くするために、インスタンスでストレステストを実行しましょう。これにより、ダッシュボードが活性化されます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install stress
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span> stress -c <span class=m>2</span> -t 40<span class=p>;</span> stress -d <span class=m>5</span> -t 40<span class=p>;</span> stress -m <span class=m>20</span> -t 40<span class=p>;</span> <span class=k>done</span></span></span></code></pre></div><p>Splunk Observability Cloudにログインしたら、左側のナビゲーションを使用して <strong>Dashboards</strong> に移動します：</p><p><a href=#R-image-c13dd1bf83e46ad262822ee53428808a class=lightbox-link><img alt=menu-dashboards class="lazy lightbox figure-image" loading=lazy src=../images/menu-dashboards.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c13dd1bf83e46ad262822ee53428808a><img alt=menu-dashboards class="lazy lightbox lightbox-image" loading=lazy src=../images/menu-dashboards.png></a></p><p>検索ボックスで <strong>OTel Contrib</strong> を検索します：</p><p><a href=#R-image-ca70f18353c8e0b79186a46b5b99e555 class=lightbox-link><img alt=search-dashboards class="lazy lightbox figure-image" loading=lazy src=../images/search-dashboards.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ca70f18353c8e0b79186a46b5b99e555><img alt=search-dashboards class="lazy lightbox lightbox-image" loading=lazy src=../images/search-dashboards.png></a></p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
情報</summary><div class=box-content><p>ダッシュボードが存在しない場合は、講師が迅速に追加します。このワークショップの Splunk 主催版に参加していない場合、インポートするダッシュボードグループはこのページの下部にあります。</p></div></details><p><strong>OTel Contrib Dashboard</strong> ダッシュボードをクリックして開きます：</p><p><a href=#R-image-4c55fb9af7b79b8d810c83f6f985c727 class=lightbox-link><img alt=otel-dashboard class="lazy lightbox figure-image" loading=lazy src=../images/otel-dashboard.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4c55fb9af7b79b8d810c83f6f985c727><img alt=otel-dashboard class="lazy lightbox lightbox-image" loading=lazy src=../images/otel-dashboard.png></a></p><p>ダッシュボードの上部にある <strong>Filter</strong> 欄に「participant」の途中まで入力し、候補に出る <strong>participant.name</strong> を選択します：</p><p><a href=#R-image-63689a8f52f940b6b8dc32a39e4584ec class=lightbox-link><img alt=search-filter class="lazy lightbox figure-image" loading=lazy src=../images/search-filter.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-63689a8f52f940b6b8dc32a39e4584ec><img alt=search-filter class="lazy lightbox lightbox-image" loading=lazy src=../images/search-filter.png></a></p><p><code>participant.name</code> で、<code>config.yaml</code> 内で設定したあなたの名前を入力するか、リストから選択することができます：</p><p><a href=#R-image-52047a051c742ce13a99f49c9e2a9d96 class=lightbox-link><img alt=select-conf-attendee-name class="lazy lightbox figure-image" loading=lazy src=../images/select-participant-name.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-52047a051c742ce13a99f49c9e2a9d96><img alt=select-conf-attendee-name class="lazy lightbox lightbox-image" loading=lazy src=../images/select-participant-name.png></a></p><p>これで、OpenTelemetry Collector を設定したホストの、ホストメトリクスを確認することができます。</p><details open class="box cstyle attachments info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
ダッシュボードJSONのダウンロード方法</summary><div class=box-content><ul><li><a href=/observability-workshop/ja/other/opentelemetry-collector/7-visualisation/index.files/dashboard_OTel-Contrib-Dashboard.json>index.files/dashboard_OTel-Contrib-Dashboard.json</a> (40 KB)</li></ul></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2024/03/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-を開発する>OpenTelemetry Collector を開発する</h1><h2 id=カスタムコンポーネントの開発>カスタムコンポーネントの開発<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Open Telemetry Collectorのためのコンポーネントを構築するには、以下の3つの主要な部分が必要です：</p><ol><li>Configuration - <em>ユーザーが設定できる値は何か</em></li><li>Factory - <em>提供された値を使ってコンポーネントを作成する</em></li><li>Business Logic - <em>コンポーネントが実行する必要があること</em></li></ol><p>これについて、プロジェクトの重要なDevOpsメトリクスを追跡するためにJenkinsと連携するコンポーネントを構築する例を考えていきます。</p><p>測定しようとしているメトリクスは次のとおりです：</p><ol><li>変更に対するリードタイム - <em>「コミットが本番環境に入るまでにかかる時間」</em></li><li>変更失敗率 - <em>「本番環境での障害を引き起こすデプロイの割合」</em></li><li>デプロイ頻度 - <em>「[チーム]が本番環境に成功してリリースする頻度」</em></li><li>平均復旧時間 - <em>「[チーム]が本番環境の障害から復旧するのにかかる時間」</em></li></ol><p>これらの指標は Google の <a href=https://dora.dev/ rel=external>DevOps Research and Assessment (DORA)</a> チームによって特定されたもので、ソフトウェア開発チームのパフォーマンスを示すのに役立ちます。<em>Jenkins CI</em> を選択した理由は、私たちが同じオープンソースソフトウェアエコシステムに留まり、将来的にベンダー管理のCIツールが採用する例となることができるためです。</p><h2 id=計装--コンポーネント>計装 🆚 コンポーネント<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>組織内でオブザーバビリティを向上させる際には、トレードオフが発生するため、考慮する点があります。</p><table><thead><tr><th></th><th>長所</th><th>短所</th></tr></thead><tbody><tr><td><strong>（自動）計装</strong><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></td><td>システムを観測するために外部APIが不要</td><td>計装を変更するにはプロジェクトの変更が必要</td></tr><tr><td></td><td>システム所有者/開発者は可観測性の変更が可能</td><td>ランタイムへの追加の依存が必要</td></tr><tr><td></td><td>システムの文脈を理解し、<em>Exemplar</em> とキャプチャされたデータを関連付けることが可能</td><td>システムのパフォーマンスに影響を与える可能性がある</td></tr><tr><td><strong>コンポーネント</strong></td><td>データ名や意味の変更をシステムのリリースサイクルから独立した展開が可能</td><td>APIの破壊的な変更の可能性があり、システムとコレクター間でリリースの調整が必要</td></tr><tr><td></td><td>その後の利用に合わせて収集されるデータの更新/拡張が容易</td><td>キャプチャされたデータの意味がシステムリリースと一致せず、予期せず壊れる可能性がある</td></tr></tbody></table><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>計装（instrument, インストゥルメント）とは、アプリケーションなどのシステムコンポーネントに対して、トレースやメトリクス、ログなどのテレメトリーデータを出力させる実装。計装ライブラリを最低限セットアップするだけで一通りのトレースやメトリクスなどを出力できるような対応を「自動計装」と呼びます。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/01</span></span></footer></article><section><h1 class=a11y-only>8. Developのサブセクション</h1><article class=default><header class=headline></header><h1 id=opentelemetry-collector-を開発する>OpenTelemetry Collector を開発する</h1><h2 id=プロジェクトのセットアップ-hahahugoshortcode490s0hbhb>プロジェクトのセットアップ <span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong></span></span><span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
メモ</summary><div class=box-content><p>このワークショップのセクションを完了する時間は経験によって異なる場合があります。</p><p>完成したものは<a href=https://github.com/splunk/collector-workshop-example rel=external>こちら</a>にあります。詰まった場合や講師と一緒に進めたい場合に利用してください。</p></div></details><p>新しい <em>Jenkins CI</em> レシーバーの開発を始めるため、まずは Go プロジェクトのセットアップから始めていきます。
新しい Go プロジェクトを作成する手順は以下の通りです：</p><ol><li><code>${HOME}/go/src/jenkinscireceiver</code> という名前の新しいディレクトリを作成し、そのディレクトリに移動します。<ol><li>実際のディレクトリ名や場所は厳密ではありません。自分の開発ディレクトリを自由に選ぶことができます。</li></ol></li><li><code>go mod init splunk.conf/workshop/example/jenkinscireceiver</code> を実行して、Go のモジュールを初期化します。<ol><li>依存関係を追跡するために使用される <code>go.mod</code> というファイルが作成されます。</li><li>インポートされている依存関係のチェックサム値が <code>go.sum</code> として保存されます。</li></ol></li></ol><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle default badge-with-title"><span class=badge-title><i class="fa-fw fas fa-check"></i> <strong>Check-in</strong></span><span class=badge-content style=background-color:green>go.modをレビューする</span></span></summary><div class=box-content><p>`` text
module splunk.conf/workshop/example/jenkinscireceiver</p><p>go 1.20</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-を開発する>OpenTelemetry Collector を開発する</h1><h2 id=configuration-の構築>Configuration の構築<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コンポーネントの Configuration 部分は、ユーザーがコンポーネントに対する入力を行う方法であり、設定に使用される値は以下のようである必要があります：</p><ol><li>そのフィールドが何を制御するのか、ユーザーが直感的に理解できる</li><li>必須項目とオプション項目が明確である</li><li>共通の名前とフィールドを再利用する</li><li>オプションをシンプルに保つ</li></ol><div class=tab-panel data-tab-group=R-tabs-4d8a7344abcf7b4bc0bde73ce6963472><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c4e27d0cce2163355d914c259baaf273 aria-expanded=true data-tab-item=R-tab-b1f9163189193276acf1d601fbd18931 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4d8a7344abcf7b4bc0bde73ce6963472","R-tab-b1f9163189193276acf1d601fbd18931")'>
<span class=tab-nav-text>良い config</span>
</button>
<button aria-controls=R-tab-id-165792bb6058232f8fa2d53a16c87690 aria-expanded=false data-tab-item=R-tab-b0772115cc4e7d5f29f171704c76e027 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4d8a7344abcf7b4bc0bde73ce6963472","R-tab-b0772115cc4e7d5f29f171704c76e027")'>
<span class=tab-nav-text>悪い config</span></button></div><div class=tab-content-container><div id=R-tab-id-c4e27d0cce2163355d914c259baaf273 data-tab-item=R-tab-b1f9163189193276acf1d601fbd18931 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Required Values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=l>http://my-jenkins-server:8089</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>auth</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>authenticator</span><span class=p>:</span><span class=w> </span><span class=l>basicauth/jenkins</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Optional Values</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.3</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>example.metric.4</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div></div></div><div id=R-tab-id-165792bb6058232f8fa2d53a16c87690 data-tab-item=R-tab-b0772115cc4e7d5f29f171704c76e027 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jenkins_server_addr</span><span class=p>:</span><span class=w> </span><span class=l>hostname</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jenkins_server_api_port</span><span class=p>:</span><span class=w> </span><span class=m>8089</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>10m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>filter_builds_by</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-awesome-build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=l>amber</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>track</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.1</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.2</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.3</span><span class=p>:</span><span class=w> </span><span class=kc>no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>example.metric.4</span><span class=p>:</span><span class=w> </span><span class=kc>no</span></span></span></code></pre></div></div></div></div></div><p>悪い例では、Configuration のベストプラクティスに反するとコンポーネントが使いにくくなってしまうことが理解できるはずです。
フィールドの値が何であるべきかを明確ではなく、既存のプロセッサーに移譲できる機能を含み、コレクター内の他のコンポーネントと比較してフィールドの命名に一貫性がありません。</p><p>良い例では、必要な値をシンプルに保ち、他のコンポーネントからのフィールド名を再利用し、コンポーネントが Jenkins とコレクター間の相互作用にのみ焦点を当てています。</p><p>設定値の中には、このコンポーネントで独自に追加するものと、コレクター内部の共有ライブラリによって提供されているものがあります。これらはビジネスロジックに取り組む際にさらに詳しく説明します。Configuration は小さく始めるべきで、ビジネスロジックに追加の機能が必要になったら、設定も追加していきましょう。</p><h2 id=コードを書く>コードを書く<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Configuration に必要なコードを実装するために、<code>config.go</code> という名前の新しいファイルを以下の内容で作成します：</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Config</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// HTTPClientSettings contains all the values</span>
</span></span><span class=line><span class=cl>    <span class=c1>// that are commonly shared across all HTTP interactions</span>
</span></span><span class=line><span class=cl>    <span class=c1>// performed by the collector.</span>
</span></span><span class=line><span class=cl>    <span class=nx>confighttp</span><span class=p>.</span><span class=nx>HTTPClientSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ScraperControllerSettings will allow us to schedule </span>
</span></span><span class=line><span class=cl>    <span class=c1>// how often to check for updates to builds.</span>
</span></span><span class=line><span class=cl>    <span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// MetricsBuilderConfig contains all the metrics</span>
</span></span><span class=line><span class=cl>    <span class=c1>// that can be configured.</span>
</span></span><span class=line><span class=cl>    <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-を開発する>OpenTelemetry Collector を開発する</h1><h2 id=コンポーネントを検討する>コンポーネントを検討する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Jenkinsからメトリクスを取得するために必要なコンポーネントの種類をおさらいしましょう：</p><div class=tab-panel data-tab-group=R-tabs-9de2d9c321fa874ca2fdf7c8536c7c0f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-c292c0b4812a903da3a5afbb4f3e4b25 aria-expanded=true data-tab-item=R-tab-e1fb85c753368c34bc0f0b2d469791d2 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9de2d9c321fa874ca2fdf7c8536c7c0f","R-tab-e1fb85c753368c34bc0f0b2d469791d2")'>
<span class=tab-nav-text>エクステンション</span>
</button>
<button aria-controls=R-tab-id-e2ae9a6469196a45bcd69939584d1a35 aria-expanded=false data-tab-item=R-tab-b779b140b7b9e49949436eee71953f86 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9de2d9c321fa874ca2fdf7c8536c7c0f","R-tab-b779b140b7b9e49949436eee71953f86")'>
<span class=tab-nav-text>レシーバー</span>
</button>
<button aria-controls=R-tab-id-c56f50189d7fd1d74d152be6c80ee7cb aria-expanded=false data-tab-item=R-tab-a4422ed88647365d029a78d2c5396305 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9de2d9c321fa874ca2fdf7c8536c7c0f","R-tab-a4422ed88647365d029a78d2c5396305")'>
<span class=tab-nav-text>プロセッサー</span>
</button>
<button aria-controls=R-tab-id-c7574bd7ec5bf4a0af53fe0fc9fc0f55 aria-expanded=false data-tab-item=R-tab-504a314066fb8a08a8124a1ee8b65721 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9de2d9c321fa874ca2fdf7c8536c7c0f","R-tab-504a314066fb8a08a8124a1ee8b65721")'>
<span class=tab-nav-text>エクスポーター</span>
</button>
<button aria-controls=R-tab-id-695a37af6ddf1bc2714641f21a2d24ef aria-expanded=false data-tab-item=R-tab-edee523bb477308c478f7e7c94683882 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9de2d9c321fa874ca2fdf7c8536c7c0f","R-tab-edee523bb477308c478f7e7c94683882")'>
<span class=tab-nav-text><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja:</strong> コネクター</span></span></span></button></div><div class=tab-content-container><div id=R-tab-id-c292c0b4812a903da3a5afbb4f3e4b25 data-tab-item=R-tab-e1fb85c753368c34bc0f0b2d469791d2 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>エクステンションが解決するビジネスユースケースは以下の通りです：</p><ol><li>実行時の設定が必要な共有機能を持つ</li><li>コレクターの実行時間の観察に間接的に役立つ</li></ol><p>詳細については、<a href=/observability-workshop/ja/other/opentelemetry-collector/2-extensions/index.html>エクステンションの概要</a>を参照してください。</p></div></div><div id=R-tab-id-e2ae9a6469196a45bcd69939584d1a35 data-tab-item=R-tab-b779b140b7b9e49949436eee71953f86 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>レシーバーが解決するビジネスユースケースは以下の通りです：</p><ul><li>リモートソースからのデータの取得</li><li>リモートソースからのデータの受信</li></ul><p>これらは一般的に <em>pull</em> 対 <em>push</em> ベースのデータ収集と呼ばれ、詳細については<a href=/observability-workshop/ja/other/opentelemetry-collector/3-receivers/index.html>レシーバーの概要</a>で読むことができます。</p></div></div><div id=R-tab-id-c56f50189d7fd1d74d152be6c80ee7cb data-tab-item=R-tab-a4422ed88647365d029a78d2c5396305 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>プロセッサーが解決するビジネスユースケースは以下の通りです：</p><ul><li>データ、フィールド、または値の追加または削除</li><li>データの観察と意思決定</li><li>バッファリング、キューイング、および並べ替え</li></ul><p>プロセッサーを通過するデータタイプは、下流のコンポーネントに同じデータタイプを転送する必要があることを覚えておいてください。
詳細については、<a href=/observability-workshop/ja/other/opentelemetry-collector/4-processors/index.html>プロセッサーの概要</a>をご覧ください。</p></div></div><div id=R-tab-id-c7574bd7ec5bf4a0af53fe0fc9fc0f55 data-tab-item=R-tab-504a314066fb8a08a8124a1ee8b65721 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>エクスポーターが解決するビジネスユースケースは以下の通りです：</p><ul><li>データをツール、サービス、またはストレージに送信する</li></ul><p>OpenTelemetryコレクターは「バックエンド」、すべてを一元化した観測可能性スイートを目指すのではなく、OpenTelemetryの創設原則に忠実であり続けることを目指しています。つまり、ベンダーに依存しない全ての人のための観測可能性です。詳細については、<a href=/observability-workshop/ja/other/opentelemetry-collector/5-exporters/index.html>エクスポーターの概要</a>をお読みください。</p></div></div><div id=R-tab-id-695a37af6ddf1bc2714641f21a2d24ef data-tab-item=R-tab-edee523bb477308c478f7e7c94683882 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>コネクターは比較的新しいコンポーネントで、このワークショップではあまり触れていません。
コネクターは、異なるテレメトリタイプやパイプラインをまたいで使用できるプロセッサーのようなものだといえます。たとえば、コネクターはログとしてデータを受け取り、メトリクスとして出力したり、あるパイプラインからメトリクスを受け取り、テレメトリーデータに関するメトリクスを提供したりすることができます。</p><p>コネクターが解決するビジネスケースは以下の通りです：</p><ul><li>異なるテレメトリタイプ間の変換<ul><li>ログからメトリクスへ</li><li>トレースからメトリクスへ</li><li>メトリクスからログへ</li></ul></li><li>受信したデータを観察し、自身のデータを生成する<ul><li>メトリクスを受け取り、データの分析メトリクスを生成する。</li></ul></li></ul><p><strong>Ninja</strong>セクションの一部として<a href=/observability-workshop/ja/other/opentelemetry-collector/4-processors/index.html>プロセッサーの概要</a>内で簡単に概要が説明されています。</p></div></div></div></div><p>これらのコンポーネントについて考えると、Jenkins に対応する場合はプルベースのレシーバーを開発する必要があることがわかります。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-を開発する>OpenTelemetry Collector を開発する</h1><h3 id=メトリクスを設計する>メトリクスを設計する<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>レシーバーによってキャプチャされるメトリクスを定義し、エクスポートするために、コレクターのために開発された <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/cmd/mdatagen rel=external>mdatagen</a> を使って、yaml で定義したメトリクスをコードに変換していきます。</p><div class=tab-panel data-tab-group=R-tabs-9fad7fee8e2bb3c6f41ea210b0ef00f8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-bbe8c4b0437d8f032d3d4edcd62a96a0 aria-expanded=true data-tab-item=R-tab-b1d90847e9ac9d08a6205ad8f09fd5a9 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9fad7fee8e2bb3c6f41ea210b0ef00f8","R-tab-b1d90847e9ac9d08a6205ad8f09fd5a9")'>
<span class=tab-nav-text>metadata.yaml</span>
</button>
<button aria-controls=R-tab-id-6bd86c21be4af184ac860d9fe97f9686 aria-expanded=false data-tab-item=R-tab-fa95711d3528c54a10a4bd5a3303bf8c class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9fad7fee8e2bb3c6f41ea210b0ef00f8","R-tab-fa95711d3528c54a10a4bd5a3303bf8c")'>
<span class=tab-nav-text>gen.go</span></button></div><div class=tab-content-container><div id=R-tab-id-bbe8c4b0437d8f032d3d4edcd62a96a0 data-tab-item=R-tab-b1d90847e9ac9d08a6205ad8f09fd5a9 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Type defines the name to reference the component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># in the configuration file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>jenkins</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Status defines the component type and the stability level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>class</span><span class=p>:</span><span class=w> </span><span class=l>receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stability</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>development</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>metrics]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Attributes are the expected fields reported</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># with the exported values.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job.name</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The name of the associated Jenkins job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>job.status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Shows if the job had passed, or failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>failed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>success</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>unknown</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Metrics defines all the pontentially exported values from this receiver. </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.jobs.count</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Provides a count of the total number of configured jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{Count}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.job.duration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>Show the duration of the job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.status</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>jenkins.job.commit_delta</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=l>The calculation difference of the time job was finished minus commit timestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>unit</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;s&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>gauge</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value_type</span><span class=p>:</span><span class=w> </span><span class=l>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>job.status</span></span></span></code></pre></div></div></div><div id=R-tab-id-6bd86c21be4af184ac860d9fe97f9686 data-tab-item=R-tab-fa95711d3528c54a10a4bd5a3303bf8c class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// To generate the additional code needed to capture metrics, </span>
</span></span><span class=line><span class=cl><span class=c1>// the following command to be run from the shell:</span>
</span></span><span class=line><span class=cl><span class=c1>//  go generate -x ./...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//go:generate go run github.com/open-telemetry/opentelemetry-collector-contrib/cmd/mdatagen@v0.80.0 metadata.yaml</span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// There is no code defined within this file.</span></span></span></code></pre></div></div></div></div></div><p>次のセクションに進む前に、これらのファイルをプロジェクトフォルダ内に作成してください。</p><h2 id=factory-の構築>Factory の構築<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Factory はソフトウェアデザインパターンの一種で、提供された Configuration を使って、動的にオブジェクト（この場合は <code>jenkinscireceiver</code>）を作成するものです。現実的な例では、携帯電話店に行って、あなたの正確な説明に合った携帯電話を求め、それを提供されるようなものです。</p><p>コマンド <code>go generate -x ./...</code> を実行すると、定義されたメトリクスをエクスポートするために必要なすべてのコードを含む新しいフォルダ <code>jenkinscireceiver/internal/metadata</code> が作成されます。生成されるコードは以下の通りです：</p><div class=tab-panel data-tab-group=R-tabs-4a3b8438f8e58520b29eb87139a28cc0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2903286469995d19eabde78206585c92 aria-expanded=true data-tab-item=R-tab-5aa589ba734396f6c25f293ea24fc1d0 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4a3b8438f8e58520b29eb87139a28cc0","R-tab-5aa589ba734396f6c25f293ea24fc1d0")'>
<span class=tab-nav-text>factory.go</span>
</button>
<button aria-controls=R-tab-id-b06081abe7c47aff5a7377c9cba320d4 aria-expanded=false data-tab-item=R-tab-b4bda758a2aef091432646c354b4dc59 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4a3b8438f8e58520b29eb87139a28cc0","R-tab-b4bda758a2aef091432646c354b4dc59")'>
<span class=tab-nav-text>config.go</span>
</button>
<button aria-controls=R-tab-id-39f2e8c3f6bd4e61df493818bb3afc31 aria-expanded=false data-tab-item=R-tab-aafe740d5e6d08f015cd912160286b41 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4a3b8438f8e58520b29eb87139a28cc0","R-tab-aafe740d5e6d08f015cd912160286b41")'>
<span class=tab-nav-text>scraper.go</span>
</button>
<button aria-controls=R-tab-id-fe645cfad7567ff25c379dea61ec83dc aria-expanded=false data-tab-item=R-tab-6f5be00aa7a4344a722aa8fc34d13ab9 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4a3b8438f8e58520b29eb87139a28cc0","R-tab-6f5be00aa7a4344a722aa8fc34d13ab9")'>
<span class=tab-nav-text>build-config.yaml</span>
</button>
<button aria-controls=R-tab-id-b348fea787731b144c8d1b4eaedb9bf8 aria-expanded=false data-tab-item=R-tab-5d31a174f263a0433738ed5261095688 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4a3b8438f8e58520b29eb87139a28cc0","R-tab-5d31a174f263a0433738ed5261095688")'>
<span class=tab-nav-text>project layout</span></button></div><div class=tab-content-container><div id=R-tab-id-2903286469995d19eabde78206585c92 data-tab-item=R-tab-5aa589ba734396f6c25f293ea24fc1d0 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/component&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewFactory</span><span class=p>()</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>Factory</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>receiver</span><span class=p>.</span><span class=nf>NewFactory</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>newDefaultConfig</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>receiver</span><span class=p>.</span><span class=nf>WithMetrics</span><span class=p>(</span><span class=nx>newMetricsReceiver</span><span class=p>,</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsStability</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newMetricsReceiver</span><span class=p>(</span><span class=nx>_</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>,</span> <span class=nx>cfg</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>consumer</span> <span class=nx>consumer</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>)</span> <span class=p>(</span><span class=nx>receiver</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert the configuration into the expected type</span>
</span></span><span class=line><span class=cl>    <span class=nx>conf</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>cfg</span><span class=p>.(</span><span class=o>*</span><span class=nx>Config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;can not convert config&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>sc</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>conf</span><span class=p>,</span> <span class=nx>set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraperControllerReceiver</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&amp;</span><span class=nx>conf</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>set</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>consumer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>AddScraper</span><span class=p>(</span><span class=nx>sc</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-b06081abe7c47aff5a7377c9cba320d4 data-tab-item=R-tab-b4bda758a2aef091432646c354b4dc59 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/config/confighttp&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Config</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// HTTPClientSettings contains all the values</span>
</span></span><span class=line><span class=cl>    <span class=c1>// that are commonly shared across all HTTP interactions</span>
</span></span><span class=line><span class=cl>    <span class=c1>// performed by the collector.</span>
</span></span><span class=line><span class=cl>    <span class=nx>confighttp</span><span class=p>.</span><span class=nx>HTTPClientSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ScraperControllerSettings will allow us to schedule </span>
</span></span><span class=line><span class=cl>    <span class=c1>// how often to check for updates to builds.</span>
</span></span><span class=line><span class=cl>    <span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>ScraperControllerSettings</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl>    <span class=c1>// MetricsBuilderConfig contains all the metrics</span>
</span></span><span class=line><span class=cl>    <span class=c1>// that can be configured.</span>
</span></span><span class=line><span class=cl>    <span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span> <span class=s>`mapstructure:&#34;,squash&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newDefaultConfig</span><span class=p>()</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Config</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ScraperControllerSettings</span><span class=p>:</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewDefaultScraperControllerSettings</span><span class=p>(</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>HTTPClientSettings</span><span class=p>:</span>        <span class=nx>confighttp</span><span class=p>.</span><span class=nf>NewDefaultHTTPClientSettings</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>MetricsBuilderConfig</span><span class=p>:</span>      <span class=nx>metadata</span><span class=p>.</span><span class=nf>DefaultMetricsBuilderConfig</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-39f2e8c3f6bd4e61df493818bb3afc31 data-tab-item=R-tab-aafe740d5e6d08f015cd912160286b41 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>scraper</span> <span class=kd>struct</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>cfg</span> <span class=o>*</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>)</span> <span class=p>(</span><span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>Scraper</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Create a our scraper with our values </span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>:=</span> <span class=nx>scraper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// To be filled in later</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraper</span><span class=p>(</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>scrape</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>pmetrics</span><span class=p>.</span><span class=nf>NewMetrics</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-fe645cfad7567ff25c379dea61ec83dc data-tab-item=R-tab-6f5be00aa7a4344a722aa8fc34d13ab9 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>dist</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>otelcol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Conf workshop collector&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>output_path</span><span class=p>:</span><span class=w> </span><span class=l>./dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v0.0.0-experimental</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/basicauthextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/extension/healthcheckextension v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/receiver/otlpreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/jaegerreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>splunk.conf/workshop/example/jenkinscireceiver v0.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./jenkinscireceiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/processor/batchprocessor v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/loggingexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>gomod</span><span class=p>:</span><span class=w> </span><span class=l>go.opentelemetry.io/collector/exporter/otlphttpexporter v0.80.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># This replace is a go directive that allows for redefine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># where to fetch the code to use since the default would be from a remote project.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>replaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>splunk.conf/workshop/example/jenkinscireceiver =&gt; ./jenkinscireceiver</span></span></span></code></pre></div></div></div><div id=R-tab-id-b348fea787731b144c8d1b4eaedb9bf8 data-tab-item=R-tab-5d31a174f263a0433738ed5261095688 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>├── build-config.yaml
</span></span><span class=line><span class=cl>└── jenkinscireceiver
</span></span><span class=line><span class=cl>    ├── go.mod
</span></span><span class=line><span class=cl>    ├── config.go
</span></span><span class=line><span class=cl>    ├── factory.go
</span></span><span class=line><span class=cl>    ├── scraper.go
</span></span><span class=line><span class=cl>    └── internal
</span></span><span class=line><span class=cl>      └── metadata</span></span></code></pre></div></div></div></div></div><p>これらのファイルがプロジェクトに作成されたら、<code>go mod tidy</code> を実行します。すると、すべての依存ライブラリが取得され、<code>go.mod</code> が更新されます。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/01</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetry-collector-を開発する>OpenTelemetry Collector を開発する</h1><h2 id=ビジネスロジックを作る>ビジネスロジックを作る<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>この時点では、何も行っていないカスタムコンポーネントが作成されています。ここから、Jenkins からデータを取得するための必要なロジックを追加していきましょう。</p><p>ここからのステップは以下の通りです：</p><ol><li>Jenkinsに接続するクライアントを作成する</li><li>設定されたすべてのジョブをキャプチャする</li><li>設定されたジョブの最後のビルドのステータスを報告する</li><li>コミットタイムスタンプとジョブ完了の時間差を計算する</li></ol><p>変更を <code>scraper.go</code> に加えていきます。</p><div class=tab-panel data-tab-group=R-tabs-4da0893dc93afc48a64c7e21ea4c4f00><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-3c2751d21735ef3a704053362d7bdc0d aria-expanded=true data-tab-item=R-tab-e864bee0b2b23d354f59bcbd2772ea18 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4da0893dc93afc48a64c7e21ea4c4f00","R-tab-e864bee0b2b23d354f59bcbd2772ea18")'>
<span class=tab-nav-text><ol><li>Jenkins クライアントを追加する</li></ol></span></button>
<button aria-controls=R-tab-id-fd9e14f5778166cd878b0716a26d8f15 aria-expanded=false data-tab-item=R-tab-b1b329f587c41a1dc99108465d0d4e4f class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4da0893dc93afc48a64c7e21ea4c4f00","R-tab-b1b329f587c41a1dc99108465d0d4e4f")'>
<span class=tab-nav-text><ol start=2><li>ジョブをキャプチャする</li></ol></span></button>
<button aria-controls=R-tab-id-2ab5f10f2ce72af9e962c908d4ca941b aria-expanded=false data-tab-item=R-tab-380984338e975846eff3abba2a9ebaf0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4da0893dc93afc48a64c7e21ea4c4f00","R-tab-380984338e975846eff3abba2a9ebaf0")'>
<span class=tab-nav-text><ol start=3><li>ジョブの状態を報告する</li></ol></span></button>
<button aria-controls=R-tab-id-5ed619bc32e8e54df4a70c86a729f812 aria-expanded=false data-tab-item=R-tab-4585b98388cebe969bfb61189ebfa937 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4da0893dc93afc48a64c7e21ea4c4f00","R-tab-4585b98388cebe969bfb61189ebfa937")'>
<span class=tab-nav-text><ol start=4><li>差分を報告する</li></ol></span></button></div><div class=tab-content-container><div id=R-tab-id-3c2751d21735ef3a704053362d7bdc0d data-tab-item=R-tab-e864bee0b2b23d354f59bcbd2772ea18 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><p>Jenkinsサーバーに接続するために、パッケージ <a href=https://pkg.go.dev/github.com/yosida95/golang-jenkins rel=external>&ldquo;github.com/yosida95/golang-jenkins&rdquo;</a> を使用します。これには、Jenkinsサーバーからデータを読み取るために必要な機能が提供されています。</p><p>次に、<a href=https://pkg.go.dev/go.opentelemetry.io/collector/receiver/scraperhelper rel=external>&ldquo;go.opentelemetry.io/collector/receiver/scraperhelper&rdquo;</a> ライブラリのいくつかのヘルパー関数を利用して、コンポーネントの起動が完了したらJenkinsサーバーに接続できるようにするスタート関数を作成します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>jenkinscireceiver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>jenkins</span> <span class=s>&#34;github.com/yosida95/golang-jenkins&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/component&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/pdata/pmetric&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;go.opentelemetry.io/collector/receiver/scraperhelper&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;splunk.conf/workshop/example/jenkinscireceiver/internal/metadata&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>scraper</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mb</span>     <span class=o>*</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>MetricsBuilder</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span> <span class=o>*</span><span class=nx>jenkins</span><span class=p>.</span><span class=nx>Jenkins</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>newScraper</span><span class=p>(</span><span class=nx>cfg</span> <span class=o>*</span><span class=nx>Config</span><span class=p>,</span> <span class=nx>set</span> <span class=nx>receiver</span><span class=p>.</span><span class=nx>CreateSettings</span><span class=p>)</span> <span class=p>(</span><span class=nx>scraperhelper</span><span class=p>.</span><span class=nx>Scraper</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>scraper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>mb</span> <span class=p>:</span> <span class=nx>metadata</span><span class=p>.</span><span class=nf>NewMetricsBuilder</span><span class=p>(</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>MetricsBuilderConfig</span><span class=p>,</span> <span class=nx>set</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>NewScraper</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>metadata</span><span class=p>.</span><span class=nx>Type</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>scrape</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>scraperhelper</span><span class=p>.</span><span class=nf>WithStart</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>h</span> <span class=nx>component</span><span class=p>.</span><span class=nx>Host</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>cfg</span><span class=p>.</span><span class=nf>ToClient</span><span class=p>(</span><span class=nx>h</span><span class=p>,</span> <span class=nx>set</span><span class=p>.</span><span class=nx>TelemetrySettings</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=c1>// The collector provides a means of injecting authentication</span>
</span></span><span class=line><span class=cl>            <span class=c1>// on our behalf, so this will ignore the libraries approach</span>
</span></span><span class=line><span class=cl>            <span class=c1>// and use the configured http client with authentication.</span>
</span></span><span class=line><span class=cl>            <span class=nx>s</span><span class=p>.</span><span class=nx>client</span> <span class=p>=</span> <span class=nx>jenkins</span><span class=p>.</span><span class=nf>NewJenkins</span><span class=p>(</span><span class=kc>nil</span><span class=p>,</span> <span class=nx>cfg</span><span class=p>.</span><span class=nx>Endpoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>SetHTTPClient</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>        <span class=p>}),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nf>NewMetrics</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>これで、Jenkinsレシーバーを初期化するために必要なすべてのコードが完成しました。</p></div></div><div id=R-tab-id-fd9e14f5778166cd878b0716a26d8f15 data-tab-item=R-tab-b1b329f587c41a1dc99108465d0d4e4f class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>ここから先は、実装が必要な <code>scrape</code> メソッドに焦点を当てます。このメソッドは、設定された間隔（デフォルトでは1分）ごとに実行されます。</p><p>Jenkins サーバーの負荷状況や、どの程度のプロジェクトが実行されているかを測定するために、Jenkins で設定されているジョブの数をキャプチャしたいと考えています。これを行うために、Jenkins クライアントを呼び出してすべてのジョブをリスト化し、エラーが報告された場合はメトリクスなしでそれを返し、そうでなければメトリクスビルダーからのデータを発行します。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure</span>
</span></span><span class=line><span class=cl>    <span class=c1>// all captured data points within this scrape have the same value. </span>
</span></span><span class=line><span class=cl>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// To be filled in</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-2ab5f10f2ce72af9e962c908d4ca941b data-tab-item=R-tab-380984338e975846eff3abba2a9ebaf0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>前のステップにより、すべてのジョブをキャプチャしてジョブの数をレポートできるようになりました。
このステップでは、それぞれのジョブを調査し、レポートされた値を使用してメトリクスをキャプチャしていきます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure</span>
</span></span><span class=line><span class=cl>    <span class=c1>// all captured data points within this scrape have the same value. </span>
</span></span><span class=line><span class=cl>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>job</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>jobs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure we have valid results to start off with</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>build</span>  <span class=p>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// This will check the result of the job, however,</span>
</span></span><span class=line><span class=cl>        <span class=c1>// since the only defined attributes are </span>
</span></span><span class=line><span class=cl>        <span class=c1>// `success`, `failure`, and `unknown`. </span>
</span></span><span class=line><span class=cl>        <span class=c1>// it is assume that anything did not finish </span>
</span></span><span class=line><span class=cl>        <span class=c1>// with a success or failure to be an unknown status.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=nx>build</span><span class=p>.</span><span class=nx>Result</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;aborted&#34;</span><span class=p>,</span> <span class=s>&#34;not_built&#34;</span><span class=p>,</span> <span class=s>&#34;unstable&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;success&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusSuccess</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=s>&#34;failure&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusFailed</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobDurationDataPoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>int64</span><span class=p>(</span><span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span><span class=p>.</span><span class=nx>Duration</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>job</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div id=R-tab-id-5ed619bc32e8e54df4a70c86a729f812 data-tab-item=R-tab-4585b98388cebe969bfb61189ebfa937 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>最後のステップでは、コミットからジョブ完了までにかかった時間を計算して、<a href=https://cloud.google.com/blog/products/devops-sre/using-the-four-keys-to-measure-your-devops-performance rel=external>DORA メトリクス</a> を推測するのに役立てていきます。</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=nx>scraper</span><span class=p>)</span> <span class=nf>scrape</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>(</span><span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>jobs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>GetJobs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>pmetric</span><span class=p>.</span><span class=nx>Metrics</span><span class=p>{},</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Recording the timestamp to ensure</span>
</span></span><span class=line><span class=cl>    <span class=c1>// all captured data points within this scrape have the same value. </span>
</span></span><span class=line><span class=cl>    <span class=nx>now</span> <span class=o>:=</span> <span class=nx>pcommon</span><span class=p>.</span><span class=nf>NewTimestampFromTime</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Casting to an int64 to match the expected type</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobsCountDataPoint</span><span class=p>(</span><span class=nx>now</span><span class=p>,</span> <span class=nb>int64</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>jobs</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>job</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>jobs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure we have valid results to start off with</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>build</span>  <span class=p>=</span> <span class=nx>job</span><span class=p>.</span><span class=nx>LastCompletedBuild</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span> <span class=p>=</span> <span class=nx>metadata</span><span class=p>.</span><span class=nx>AttributeJobStatusUnknown</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Previous step here</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Ensure that the `ChangeSet` has values</span>
</span></span><span class=line><span class=cl>        <span class=c1>// set so there is a valid value for us to reference</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>build</span><span class=p>.</span><span class=nx>ChangeSet</span><span class=p>.</span><span class=nx>Items</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Making the assumption that the first changeset</span>
</span></span><span class=line><span class=cl>        <span class=c1>// item is the most recent change.</span>
</span></span><span class=line><span class=cl>        <span class=nx>change</span> <span class=o>:=</span> <span class=nx>build</span><span class=p>.</span><span class=nx>ChangeSet</span><span class=p>.</span><span class=nx>Items</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Record the difference from the build time</span>
</span></span><span class=line><span class=cl>        <span class=c1>// compared against the change timestamp.</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>RecordJenkinsJobCommitDeltaDataPoint</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nb>int64</span><span class=p>(</span><span class=nx>build</span><span class=p>.</span><span class=nx>Timestamp</span><span class=o>-</span><span class=nx>change</span><span class=p>.</span><span class=nx>Timestamp</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>job</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>mb</span><span class=p>.</span><span class=nf>Emit</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>これらのステップがすべて完了すると、Jenkins CI レシーバーが完成します！</p><h2 id=次は何をするの>次は何をするの？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>コンポーネントに必要な機能は、おそらく他にもたくさん思いつくでしょう。例えば：</p><ul><li>ジョブで使用されたブランチ名を含めることはできますか？</li><li>ジョブのプロジェクト名を含めることはできますか？</li><li>プロジェクトのジョブの総持続時間をどのように計算しますか？</li><li>変更が機能するかどうかをどのように検証しますか？</li></ul><p>この時間を使って遊んでみたり、壊してみたり、変更してみたり、ビルドからのログをキャプチャしてみるなどしてください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/12/08</span></span></footer></article></section></section></section><article class=default><header class=headline></header><h1 id=リソース>リソース</h1><ul class=card-container><li><article class="card card-popout" aria-labelledby=R-card-323244d469570a169df17e968ef710bd><div class=card-content><div class=card-title id=R-card-323244d469570a169df17e968ef710bd><a href=/observability-workshop/ja/resources/faq/index.html>よくある質問とその回答</a></div><div class=card-content-text>オブザーバビリティ、DevOps、インシデント対応、Splunk On-Callに関連する一般的な質問とその回答を集めました。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-83ab851ec6a1a32b16049a6e3adf81fc><div class=card-content><div class=card-title id=R-card-83ab851ec6a1a32b16049a6e3adf81fc><a href=/observability-workshop/ja/resources/dimensions_properties_tags/index.html>ディメンション、プロパティ、タグ</a></div><div class=card-content-text>ディメンションとプロパティの比較で、どちらかを使うべきかというのはよく議論されます。</div></div></article></li><li><article class="card card-popout" aria-labelledby=R-card-698b2491ebd13870f5af445fbc35e18e><div class=card-content><div class=card-title id=R-card-698b2491ebd13870f5af445fbc35e18e><a href=/observability-workshop/ja/resources/otel_tagging/index.html>OpenTelemetryでのタグ付け</a></div><div class=card-content-text>大規模な組織で OpenTelemetry を展開する際には、タグ付けのための標準化された命名規則を定義し、規則が遵守されるようにガバナンスプロセスを確立することが重要です。</div></div></article></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2025/09/29</span></span></footer></article><section><h1 class=a11y-only>リソースのサブセクション</h1><article class=default><header class=headline></header><h1 id=よくある質問とその回答>よくある質問とその回答</h1><p>オブザーバビリティ、DevOps、インシデント対応、Splunk On-Callに関連する一般的な質問とその回答を集めました。</p><h2 id=q-アラートとインシデント対応インシデント管理の違いは>Q: アラートとインシデント対応、インシデント管理の違いは？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>A: アラート、インシデント対応、インシデント管理は関連する機能です。これらは一緒にインシデント対応および解決プロセスを構成します。</p><p>モニタリングやオブザーバビリティのツールはインシデント対応プラットフォームにアラートを送信します。これらのプラットフォームはアラートのコレクションを収集し、それらをインシデントとして相関させます。</p><p>これらのインシデントは記録のためにインシデント管理（ITSM）プラットフォームに記録されます。アラートは何かが起こったことを示すトリガーであり、インシデントへのコンテキストを提供します。</p><p>インシデントには、アラートの内容、インシデントが作成されてから関連するすべての活動、およびフォローされるオンコールポリシーが含まれます。ITSMは、インシデントがアクティブであるときおよび解決された後のインシデントを記録するシステムです。</p><p>インシデント対応および管理をより良く実践するために、これらのコンポーネントが必要になります。</p><span class="btn cstyle button transparent noicon"><span><span class=title>On-Call</span></span></span><h2 id=q-オブザーバビリティはモニタリングとは違うものですか>Q: オブザーバビリティはモニタリングとは違うものですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>A: モニタリングとオブザーバビリティの主な違いは、「既知の未知」と「未知の未知」の違いです。</p><p>モニタリングでは、オペレーターは通常、システムのアーキテクチャと要素に関する事前の知識を持っています。彼らは要素間の関係とそれに関連するメタデータを確実に予測することができます。モニタリングは、頻繁に変更されない状態のインフラストラクチャに適しています。</p><p>オブザーバビリティは、オペレーターがシステム内のすべての要素とそれらの関係を予測し、追跡する能力が限定されているシステム向けです。</p><p>オブザーバビリティは、従来のメトリクスのモニタリングを含む一連のプラクティスと技術です。</p><p>これらのプラクティスと技術を組み合わせることで、オペレーターはシステムのすべての要素に関する事前の知識がなくても、頻繁に変更がある複雑な環境を理解することができます。オブザーバビリティ技術は、環境の変動やメタデータの変化（カーディナリティ）を従来のモニタリングよりもよく考慮できるため、より静的なモニタリングと比較して優れています。</p><span class="btn cstyle button transparent noicon"><span><span class=title>Observability</span></span></span><h2 id=q-トレースとスパンとは何ですか>Q: トレースとスパンとは何ですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>A: トレースとスパンは、メトリクスとログと共に、現代のオブザーバビリティツールにフィードされるコアタイプのデータを構成します。それらは特定の要素と機能を持っていますが、一緒にうまく機能します。</p><p>マイクロサービスベースのアーキテクチャは分散しているため、システム内のトランザクションは完了する前に複数のサービスにアクセスします。これにより、問題の場所を正確に特定することが困難になります。トレースは、分散システム内のすべてのサービスを通るリクエストの完全なパスを追跡するための方法です。スパンは、各サービスでの時間のかかる操作です。トレースはスパンの結合したものであり、一緒になると個々のサービスプロセスについてより詳細な情報を提供します。メトリクスはシステムの健康状態の良いスナップショットを提供し、ログは問題を調査する際に深さを提供しますが、トレースとスパンはオペレーターに問題の源泉をより多くのコンテキストでナビゲートするのに役立ちます。これにより、インシデントの調査にかかる時間が節約され、現代のアーキテクチャの複雑さがサポートされます。</p><span class="btn cstyle button transparent noicon"><span><span class=title>APM</span></span></span><h2 id=q-サイドカーパターンとは何ですか>Q: サイドカーパターンとは何ですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>A: サイドカーパターンは、関連するサービスをインフラストラクチャによって直接接続するためのデザインパターンです。関連するサービスは、接続されているアプリケーションロジックに機能を追加したりサポートしたりすることができます。これは、管理計画に関連するエージェントをアプリケーションサービスと共に展開する方法として広く使用されます。</p><p>オブザーバビリティでは、サイドカーサービスはアプリケーションロジックであり、そのサービスからデータを収集するエージェントです。このセットアップには、アプリケーションサービスを含むコンテナと、エージェントを実行するコンテナの2つが必要です。コンテナはポッドを共有し、ディスク、ネットワーク、名前空間などのリソースを共有します。また、一緒にデプロイされ、同じライフサイクルを共有します。</p><span class="btn cstyle button transparent noicon"><span><span class=title>Observability</span></span></span><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=ディメンションプロパティタグ>ディメンション、プロパティ、タグ</h1><h2 id=メトリクスにコンテキストを与える>メトリクスにコンテキストを与える<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ディメンションとプロパティの違いや、どちらを使うべきかというのは、よく話題にされます。それぞれの説明から始めるのではなく、私たちがどのように使い、どのように似ているのかを理解してから、それぞれの違いや、なぜどちらかを使うのかの例を見ていくことにしましょう。</p><h2 id=ディメンションとプロパティの類似点>ディメンションとプロパティの類似点<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>最も単純な答えは、ディメンションとプロパティはともに、メトリクスにコンテキスト（状況）を追加するメタデータの <code>key:value</code> ペアであるということです。メトリクス自体は、<code>cpu.utilization</code> のような標準的なインフラストラクチャメトリクスであろうと、API呼び出しの回数のようなカスタムメトリクスであろうと、実際に測定しているものなら全てに当てはまります。</p><p><code>cpu.utilization</code> メトリクスの値が50%であっても、それがどこから来たのかなどのコンテキストを知らなければ、それは単なる数字であり、私たちにとって有用ではありません。少なくとも、どのホストから来たのかを知る必要があります。</p><p>現在では、個々のホストのパフォーマンスや利用率よりも、クラスターやデータセンター全体のパフォーマンスや利用率をより気にすることが多く、ホストのクラスター全体の平均 <code>cpu.utilization</code>、あるホストの <code>cpu.utilization</code> が同じサービスを実行する他のホストと比べて外れ値である場合、あるいは環境間での平均 <code>cpu.utilization</code> を比較することに興味を持っています。</p><p>このように <code>cpu.utilization</code> メトリクスをスライス、集約、またはグループ化するためには、受け取る <code>cpu.utilization</code> メトリクスのメタデータに、ホストが属するクラスター、ホスト上で実行されているサービス、およびそれが属する環境などの情報が必要です。このメタデータは、ディメンションまたはプロパティの <code>key:value</code> ペアの形で存在することができます。</p><p>例えば、ダッシュボードでフィルターを適用したり、分析関数を実行する際にグループ化機能を使用したりするとき、プロパティまたはディメンションを使用することができます。</p><h2 id=ではディメンションとプロパティはどう違うの>では、ディメンションとプロパティはどう違うの？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>ディメンションはメトリクスと共に取り込み時に送信されるのに対し、プロパティは取り込み後にメトリクスやディメンションに適用されます。これは、`cpu.utilization`` の値がどのホストから来ているかのような、データポイント（メトリクスの単一の報告値）をユニークにするために必要なメタデータはディメンションでなければならないことを意味します。メトリクス名 + ディメンションは MTS（メトリクスの時間系列）をユニークに定義します。</p><p>例：特定のホスト（server1）によって送信される <code>cpu.utilization</code> メトリクスで、ディメンション <code>host:server1</code> があれば、それはユニークな時間系列と見なされます。もし 10 台のサーバーがそのメトリクスを送信していれば、メトリクス名 <code>cpu.utilization</code> を共有し、ディメンションのキー値ペア（host:server1, host:server2&mldr;host:server10）でユニークに識別される 10 の時間系列があります。</p><p>しかし、サーバー名がデータセンター内でのみユニークである場合、データセンターの場所を示す 2 番目のディメンション dc を追加する必要があります。これにより、可能な MTS の数は倍になります。受信された <code>cpu.utilization</code> メトリクスは、2 組のディメンションのキー値ペアによってユニークに識別されます。</p><p><code>cpu.utilization</code> に <code>dc:east</code> と <code>host:server1</code> を加えたものは、<code>cpu.utilization</code> に <code>dc:west</code> と <code>host:server1</code> を加えたものとは異なる時間系列を作り出します。</p><h2 id=ディメンションは不変だがプロパティは可変である>ディメンションは不変だが、プロパティは可変である<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>上記で述べたように、メトリクス名 + ディメンションの組み合わせで、ユニークな MTS を作ります。したがって、ディメンションの値が変わると、メトリクス名 + ディメンション値の新しいユニークな組み合わせが生まれ、新しい MTS が作成されます。</p><p>一方、プロパティはメトリクス（またはディメンション）が取り込まれた後に適用されます。メトリクスにプロパティを適用すると、そのメトリクスが属するすべての MTS に伝播して適用されます。または、ディメンションにプロパティを適用する場合、例えば <code>host:server1</code> とすると、そのホストからのすべてのメトリクスにそのプロパティが添付されます。プロパティの値を変更すると、そのプロパティが添付されているすべての MTS のプロパティ値が更新されます。これが重要な理由は何でしょうか？ プロパティの歴史的な値にこだわる場合、それをディメンションにする必要があることを意味しています。</p><p>例：私たちはアプリケーションに関するカスタムメトリクスを収集しています。1つのメトリクスは <code>latency</code> で、アプリケーションへのリクエストのレイテンシーをカウントします。顧客ごとにレイテンシーを分類して比較できるように <code>customer</code> ディメンションを持っています。私たちは、顧客が使用しているバージョン別にアプリケーションの <code>latency</code> を分類して比較したいと考え、プロパティ <code>version</code> を <code>customer</code> ディメンションに添付しました。最初はすべての顧客がアプリケーションバージョン1を使用しているので、<code>version:1</code> です。</p><p>現在、いくつかの顧客がアプリケーションのバージョン2を使用しているため、それらの顧客に対してプロパティを <code>version:2</code> に更新します。これらの顧客の <code>version</code> プロパティの値を更新すると、その顧客に関連するすべての MTS に伝播します。これにより、これらの顧客が以前に <code>version:1</code> を使用していたという歴史が失われるため、歴史的な期間にわたって <code>version:1</code> と <code>version:2</code> の <code>latency</code> を比較する場合、正確なデータを得ることはできません。この場合、メトリクスの時間系列をユニークにするためにアプリケーションの <code>version</code> が必要ではないかもしれませんが、歴史的な値にこだわるために <code>version</code> をディメンションにする必要があります。</p><h2 id=結局いつディメンションじゃなくてプロパティを使うの>結局、いつ、ディメンションじゃなくてプロパティを使うの？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>メトリクスに添付したいメタデータがあるが、取り込み時にはそれを知らない場合が第一の理由です。第二の理由は、ベストプラクティスとして、ディメンションである必要がなければ、それをプロパティにすることです。なぜでしょうか？</p><p>一つの理由は、現在、分析ジョブやチャートレンダリングあたりの MTS の上限が 5K であり、ディメンションが多いほど多くの MTS を生成することです。プロパティは完全に自由形式であり、MTS の数を増やすことなく、メトリクスやディメンションに必要な情報を追加することができます。</p><p>ディメンションは各データポイントと共に送信されるため、ディメンションが多いほど、より多くのデータを送信することになります。これは、クラウドプロバイダーがデータ転送に料金を請求する場合、コストが高くなる可能性があります。</p><p>プロパティを使う良い例としては、ホスト情報の追加などがあります。 <code>machine_type</code>, <code>processor</code>, <code>os</code> などの情報を確認することが重要ですが、これらをディメンションとして設定し、各ホストからのすべてのメトリクスと共に送信するのではなく、プロパティとして設定し、ホストディメンションに添付することができます。</p><p>例えば <code>host:server1</code> では、プロパティ <code>machine_type:ucs</code>, <code>processor:xeon-5560</code>, <code>os:rhel71</code> を設定します。<code>host:server1</code> というディメンションを持つメトリクスが入ってくるたびに、上記のすべてのプロパティが自動的に適用されます。</p><p>プロパティの使用例としては、各サービスのエスカレーション連絡先や、各顧客の SLA レベルを知りたい場合があります。これらの項目は、メトリクスをユニークに識別するために必要ではなく、歴史的な値にも関心がないため、プロパティにすることができます。プロパティはサービスディメンションや顧客ディメンションに追加され、これらのディメンションを持つすべてのメトリクスや MTS に適用されます。</p><h2 id=タグについてはどうですか>タグについてはどうですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>タグは、メトリクスにコンテキストを与えたり整理するのに使われる、メタデータの 3 番目のタイプです。ディメンションやプロパティとは異なり、タグは <code>key:value</code> ペアではありません。タグはラベルやキーワードとして考えることができます。プロパティと同様に、タグは取り込み後に UI の Catalog や API を通じてプログラム的にデータに適用されます。タグはメトリクス、ディメンション、ディテクターなどの他のオブジェクトに適用することができます。</p><h2 id=タグを使う場面はどこですか>タグを使う場面はどこですか？<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>タグが必要とされるのは、タグとオブジェクトの間に多対一の関係がある場合や、タグとそれに適用されるオブジェクト間に一対多の関係がある場合です。本質的に関連していないメトリクスをまとめるのに役立ちます。</p><p>例として、複数のアプリケーションを実行しているホストがある場合です。各アプリケーションに対してタグ（ラベル）を作成し、それぞれのホストに複数のタグを適用して、その上で実行されているアプリケーションをラベル付けします。</p><p>例：Server1 は 3 つのアプリケーションを実行しています。タグ <code>app1</code>, <code>app2</code>, <code>app3</code> を作成し、ディメンション <code>host:server1</code> にこれら 3 つのタグをすべて適用します。</p><p>上記の例を拡張すると、アプリケーションからのメトリクスも収集しているとします。作成したタグを、アプリケーション自体から来るメトリクスに適用することができます。タグに基づいてフィルタリングすることで、アプリケーションに基づいてフィルタリングしながら、アプリケーションと関連するホストメトリクスの全体像を得ることができます。</p><p>例：App1 は <code>service:application1</code> というディメンションでメトリクスを送信します。<code>service:application1</code> のディメンションにタグ <code>app1</code> を適用します。その後、チャートやダッシュボードでタグ <code>app1</code> でフィルタリングすることができます。</p><p>タグの他の使用例には、単一の可能な値を持つ二進状態があります。例として、カナリアテストを行い、カナリアデプロイを行った際に新しいコードを受け取ったホストをマークして、新しいコードを受け取らなかったホストとのパフォーマンスを比較しやすくすることがあります。単一の値 <code>canary</code> しかないため、<code>key:value</code> ペアは必要ありません。</p><p>ただし、タグでフィルタリングはできますが、groupBy 関数では使用できないことに注意してください。groupBy 関数は <code>key:value</code> ペアのキー部分を指定して実行され、そのキーの値に基づいて結果がグループ化されます。</p><h2 id=さらなる情報>さらなる情報<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>カスタムメトリクスのディメンションを送信する方法に関する情報については、お使いのライブラリに関するクライアントライブラリのドキュメントをご覧ください。</p><p>API を通じてメトリクスやディメンションにプロパティやタグを適用する方法については、 <code>/metric/:name</code>、<code>/dimension/:key/:value</code> に関する API ドキュメントを参照してください。</p><p>UI のメタデータカタログでプロパティやタグを追加または編集する方法については、<a href=https://docs.splunk.com/Observability/metrics-and-metadata/metrics-finder-metadata-catalog.html#use-the-metadata-catalog rel=external>Search the Metric Finder and Metadata catalog</a>で、<strong>​Add or edit metadata</strong> セクションをご覧ください。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2023/11/17</span></span></footer></article><article class=default><header class=headline></header><h1 id=opentelemetryとsplunkにおけるタグ付けのための命名規則>OpenTelemetryとSplunkにおける、タグ付けのための命名規則</h1><h2 id=はじめに>はじめに<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>大規模な組織で OpenTelemetry を展開する際には、タグ付けのための標準化された命名規則を定義し、その規則が遵守されるようにガバナンスプロセスを設定することが非常に重要です。</p><p>これにより、OpenTelemetry を通じて収集される MELT データ（メトリクス、イベント、ログ、トレース）を、アラート、ダッシュボード作成、トラブルシューティングの目的で効率的に活用することが可能になります。また、Splunk Observability Cloud のユーザーが探しているデータを迅速に見つけることができます。</p><p>命名規則はまた、データを効果的に集約するためにも重要です。例えば、環境ごとのユニークなホストの数を数えたい場合、ホスト名と環境名を捉えるための標準化された規則を使用する必要があります。</p><h2 id=属性-vs-タグ>属性 vs タグ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>先に進む前に、用語についての注意をしておきましょう。OpenTelemetry の「タグ」は「属性（attribute）」と呼ばれます。属性は、手動または自動の計装を通じて、メトリクス、ログ、トレースに添付することができます。</p><p>属性はまた、<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/resourcedetectionprocessor rel=external>Resource Detection processor</a>などのさまざまなプロセッサを使用して、OpenTelemetry コレクターレベルでメトリクス、ログ、トレースに添付することもできます。</p><p>Splunk Observability Cloud に属性付きのトレースが取り込まれると、それらは「タグ」として利用可能になります。オプションとして、トレースの一部として収集された属性は、<a href=https://docs.splunk.com/Observability/apm/span-tags/metricsets.html#troubleshooting-metricsets rel=external>Troubleshooting Metric Sets</a>の作成に使用され、<a href=https://docs.splunk.com/Observability/apm/span-tags/tag-spotlight.html rel=external>Tag Spotlight</a>などのさまざまな機能と共に使用することができます。</p><p>また、属性は<a href=https://docs.splunk.com/Observability/apm/span-tags/metricsets.html#monitoring-metricsets rel=external>Monitoring Metric Sets</a>の作成に使用され、アラートのトリガーとして使用することもできます。</p><h2 id=リソースに関するセマンティック規約>リソースに関するセマンティック規約<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p><a href=https://github.com/open-telemetry/opentelemetry-specification/tree/main/specification/resource/semantic_conventions#resource-semantic-conventions rel=external>OpenTelemetry リソースセマンティック規約</a>は、組織が標準化すべき属性を決定する際の出発点として使用できます。以下のセクションでは、よく使用される属性のいくつか見ていきましょう。</p><h3 id=サービス属性>サービス属性<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>監視されるサービスを記述するために多くの属性が使用されます。</p><p><code>service.name</code> はサービスの論理名を定義する必須の属性です。OpenTelemetry SDK によって自動的に追加されますが、カスタマイズすることができます。これはシンプルに保つことが最善です（例えば、<code>inventoryservice</code> は <code>inventoryservice-prod-hostxyz</code> よりも良いでしょう。他の属性を使用してサービスの他の側面を捉えることができます）。</p><p>以下のサービス属性が推奨されます：</p><ul><li><code>service.namespace</code> はサービスを所有するチームを識別するために使用されます</li><li><code>service.instance.id</code> はサービスのユニークなインスタンスを識別するために使用されます</li><li><code>service.version</code> はサービスのバージョンを識別するために使用されます</li></ul><h3 id=テレメトリsdk>テレメトリSDK<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>これらの属性はSDKによって自動的に設定され、使用されている計測ライブラリに関する情報を記録します：</p><ul><li><code>telemetry.sdk.name</code> は通常 <code>opentelemetry</code> に設定されます。</li><li><code>telemetry.sdk.language</code> は SDK の言語で、例えば <code>java</code> です。</li><li><code>telemetry.sdk.version</code> は使用されている SDK のバージョンを識別します。</li></ul><h3 id=コンテナ>コンテナ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>コンテナで実行されるサービスには、<code>container.id</code>、<code>container.name</code>、<code>container.image.name</code> など、コンテナのランタイムを記述するための多くの属性が使用されます。完全なリストは<a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/resource/semantic_conventions/container.md rel=external>こちら</a>で確認できます。</p><h3 id=ホスト>ホスト<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>これらの属性は、サービスが実行されているホストを記述し、<code>host.id</code>、<code>host.name</code>、<code>host.arch</code> などの属性を含みます。完全なリストは<a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/resource/semantic_conventions/host.md rel=external>こちら</a>で確認できます。</p><h3 id=デプロイ環境>デプロイ環境<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><code>deployment.environment</code> 属性は、サービスがデプロイされている環境（ <strong>staging</strong> や <strong>production</strong> など）を識別するために使用されます。</p><p>Splunk Observability Cloud は、この属性を使用して関連コンテンツを有効する（詳細は<a href=https://docs.splunk.com/observability/metrics-and-metadata/enablerelatedcontent.html rel=external>こちら</a>）ため、この属性を含めることが重要です。</p><h3 id=クラウド>クラウド<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>AWS などのパブリッククラウド環境で実行されるサービスに関する情報を捉えるための属性もあります。これには、<code>cloud.provider</code>、<code>cloud.account.id</code>、<code>cloud.region</code> が含まれます。</p><p>属性の完全なリストは<a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/resource/semantic_conventions/cloud.md rel=external>こちら</a>で確認できます。</p><p>一部のクラウドプロバイダー、例えば <a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/resource/semantic_conventions/cloud_provider/gcp/README.md rel=external>GCP</a> は、独自のセマンティック規則を定義しています。</p><h3 id=kubernetes>Kubernetes<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Kubernetesで実行されるアプリケーションにも、いくつかの標準化された属性があります。これらの多くは、Splunk の OpenTelemetry コレクター配布によって自動的に追加されます（詳細は<a href=https://docs.splunk.com/observability/metrics-and-metadata/enablerelatedcontent.html#splunk-infrastructure-monitoring rel=external>こちら</a>）。</p><p>属性は、例えば <code>k8s.cluster.name</code>、<code>k8s.node.name</code>、<code>k8s.pod.name</code>、<code>k8s.namespace.name</code>、<code>kubernetes.workload.name</code> などがあります。</p><h2 id=カスタム属性のベストプラクティス>カスタム属性のベストプラクティス<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>多くの組織では、OpenTelemetryのリソースセマンティック規約で定義されているもの以上の属性が欲しくなります。</p><p>この場合、セマンティック規約にすでに含まれている属性名との命名競合を避けることが重要です。つまり、特定の属性名を命名規則に決定する前に、セマンティック規約をチェックすると良いでしょう。</p><p>属性名の命名規則に加えて、属性値も考慮する必要があります。例えば、アプリケーションが属する特定のビジネスユニットをキャプチャしたい場合、簡単にかつ効果的にフィルタリングするために、標準化されたビジネスユニット値のリストも持ちたいでしょう。</p><p>OpenTelemetryコミュニティでは、属性の命名に従うべきガイドラインも提供しています。<a href=https://opentelemetry.io/docs/specs/otel/common/attribute-naming/ rel=external>こちら</a>で見つけることができます。</p><p><a href=https://opentelemetry.io/docs/specs/otel/common/attribute-naming/#recommendations-for-application-developers rel=external>Recommendations for Application Developers</a>は、私たちの議論に最も関連しています。</p><p>そこでは、以下を推奨しています：</p><ul><li><code>com.acme.shopname</code> のように、会社のドメイン名で属性名を接頭辞として付けること（属性が社内だけでなく外部で使用される可能性がある場合）</li><li>属性が特定のアプリケーションに固有であり、組織内でのみ使用される場合は、アプリケーション名で属性名に接頭辞を付けること</li><li>既存の OpenTelemetry セマンティック規約の名前を属性名の接頭辞として使用しないこと</li><li>異なる組織や業界全体で一般的なニーズがある場合は、あなたの属性名を OpenTelemetry 仕様に追加する提案を検討すること</li><li><code>otel.*</code> で始まる属性名は避けること。これは OpenTelemetry 仕様の使用に予約されています</li></ul><h2 id=カーディナリティに関する考慮事項>カーディナリティに関する考慮事項<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>属性名と値の命名基準を決定する際に考慮すべき最後の点は、メトリクスのカーディナリティに関連しています。</p><p>のカーディナリティは、メトリクス名とそれに関連する次元の組み合わせによって生成されるユニークなメトリクス時系列（MTS: Metric Time Series）の数として定義されます。</p><p>メトリクスは、ディメンションの数とそれらのディメンションが持つユニークな値の数が多い場合に、高いカーディナリティを持つことになります。</p><p>例えば、あなたのアプリケーションが <code>custom.metric</code> という名前のメトリクスのデータを送信するとします。属性がない場合、<code>custom.metric</code> は単一のメトリクス時系列（MTS）を生成します。</p><p>一方で、<code>custom.metric</code>が <code>customer.id</code> という属性を含み、数千の顧客ID値がある場合、これは数千のメトリクス時系列を生成し、コストやクエリ性能に影響を与える可能性があります。</p><p>Splunk Observability Cloud は、メトリクスの使用量を管理するための<a href=https://docs.splunk.com/Observability/infrastructure/metrics-pipeline/metrics-usage-report.html rel=external>レポート</a>を提供しています。そして、望ましくないディメンションを削除する<a href=https://docs.splunk.com/Observability/infrastructure/metrics-pipeline/use-metrics-pipeline.html rel=external>ルール</a>を作成することができます。しかし、最初の防衛線は、属性名と値の組み合わせがどのようにメトリクスのカーディナリティを増加させるかを理解することです。</p><h2 id=まとめ>まとめ<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title=リンクをクリップボードにコピー><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>このドキュメントでは、大規模な OpenTelemetry 計装の展開を開始する前に、OpenTelemetry タグの命名規則を定義することの重要性を強調しました。</p><p>OpenTelemetry のリソースセマンティック規約がいくつかの属性の命名規則を定義し、多くの属性が OpenTelemetry SDKや OpenTelemetry コレクター内で動作するプロセッサーを通じて自動的に収集される方法について説明しました。</p><p>最後に、リソースセマンティック規約が組織のニーズに十分でない場合に、属性名を作成するためのベストプラクティスを共有しました。</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>2026/01/05</span></span></footer></article></section></section></div></main></div><script src=/observability-workshop/js/js-yaml/js-yaml.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-color.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-dispatch.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-drag.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-ease.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-interpolate.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-selection.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-timer.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-transition.min.js?1769792814 defer></script><script src=/observability-workshop/js/d3/d3-zoom.min.js?1769792814 defer></script><script src=/observability-workshop/js/mermaid/mermaid.min.js?1769792814 defer></script><script>window.relearn.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/js/perfect-scrollbar/perfect-scrollbar.min.js?1769792814 defer></script><script src=/observability-workshop/js/theme.min.js?1769792814 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>