<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.19.0+tip"><meta name=description content="Splunk Observability Workshops"><title>Deploying the OpenTelemetry Collector in Kubernetes :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v4.100/en/imt/gdi/index.html rel=alternate hreflang=x-default><link href=https://splunk.github.io/observability-workshop/v4.100/en/imt/gdi/index.html rel=alternate hreflang=en><link href=https://splunk.github.io/observability-workshop/v4.100/ja/imt/gdi/index.html rel=alternate hreflang=ja><link href=https://splunk.github.io/observability-workshop/v4.100/en/imt/gdi/index.html rel=canonical type=text/html title="Deploying the OpenTelemetry Collector in Kubernetes :: Splunk Observability Cloud Workshops"><link href=../../../en/imt/gdi/index.xml rel=alternate type=application/rss+xml title="Deploying the OpenTelemetry Collector in Kubernetes :: Splunk Observability Cloud Workshops"><link href=../../../images/favicon.ico?1692263987 rel=icon type=image/x-icon sizes=any><link href=../../../css/fontawesome-all.min.css?1692263990 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fontawesome-all.min.css?1692263990 rel=stylesheet></noscript><link href=../../../css/nucleus.css?1692263990 rel=stylesheet><link href=../../../css/auto-complete.css?1692263990 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/auto-complete.css?1692263990 rel=stylesheet></noscript><link href=../../../css/perfect-scrollbar.min.css?1692263990 rel=stylesheet><link href=../../../css/fonts.css?1692263990 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fonts.css?1692263990 rel=stylesheet></noscript><link href=../../../css/theme.css?1692263990 rel=stylesheet><link href=../../../css/theme-splunk-light.css?1692263990 rel=stylesheet id=variant-style><link href=../../../css/variant.css?1692263990 rel=stylesheet><link href=../../../css/print.css?1692263990 rel=stylesheet media=print><link href=../../../css/format-print.css?1692263990 rel=stylesheet><link href=../../../css/ie.css?1692263990 rel=stylesheet><script src=../../../js/url.js?1692263990></script>
<script src=../../../js/variant.js?1692263990></script>
<script>window.index_js_url="../../../en/index.search.js";var root_url="../../../",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://splunk.github.io/observability-workshop/v4.100/",window.variants&&variants.init(["splunk-light","splunk-dark","aws"])</script><style>@media screen and (min-width:1300px){#body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1300px;width:100%}}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../en/imt/gdi/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../en/imt/index.html><span itemprop=name>Splunk IM</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Deploying the OpenTelemetry Collector in Kubernetes</span><meta itemprop=position content="3"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=deploying-the-opentelemetry-collector-in-kubernetes>Deploying the OpenTelemetry Collector in Kubernetes</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
15 minutes</button></span><ul><li>Use the Splunk Helm chart to install the OpenTelemetry Collector in K3s</li><li>Explore your cluster in the Kubernetes Navigator</li></ul><hr><h2 id=1-obtain-access-token>1. Obtain Access Token</h2><p>You will need to obtain your Access Token<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> from the Splunk UI. You can find the workshop Access Token by clicking <strong>&#187;</strong> bottom left and then selecting <strong>Settings → Access Tokens</strong>.</p><p>Expand the workshop token that your host has instructed you to use e.g. <strong>O11y-Workshop-ACCESS</strong>, then click on <strong>Show Token</strong> to expose your token. Click the
<span class="btn cstyle grey"><button type=button>
Copy</button></span> button to copy to clipboard. Please do not use the <strong>Default</strong> token!</p><p><a href=#image-d889164a9aa4c87a220a6978300f126c class=lightbox-link><img src=../../../en/imt/gdi/../images/access-token.png alt="Access Token" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d889164a9aa4c87a220a6978300f126c><img src=../../../en/imt/gdi/../images/access-token.png alt="Access Token" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Please do not attempt to create your own token</div><div class=box-content><p>We have created a Token specifically for this workshop with the appropriate settings for the exercises you will be performing so have allocated it both Ingest and API Permissions. Best practice in production is to only allocate a single permission to a Token such as Ingest OR API OR RUM and use multiple Tokens where required.</p></div></div><p>You will also need to obtain the name of the Realm<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> for your Splunk account. At the top of the side menu, click on your name. This will direct you to the <strong>Account Settings</strong> Page. Click the <strong>Organizations</strong>-tab. The Realm can be found at the top of the displayed information in the tab. In this example it is <code>eu0</code>.</p><p><a href=#image-b7818c45059a20383906d9d0b98e3555 class=lightbox-link><img src=../../../en/imt/gdi/../images/account-settings.png alt="Account Settings" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b7818c45059a20383906d9d0b98e3555><img src=../../../en/imt/gdi/../images/account-settings.png alt="Account Settings" class=lightbox-image loading=lazy></a></p><h2 id=2-installation-using-helm>2. Installation using Helm</h2><p>Create the <code>ACCESS_TOKEN</code> and <code>REALM</code> environment variables to use in the proceeding Helm install command. For instance, if your realm is <code>us1</code>, you would type <code>export REALM=us1</code> and for <code>eu0</code> type <code>export REALM=eu0</code>.</p><div class=tab-panel data-tab-group=e732d5222195b1d8c19c60946704a25f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export ACCESS TOKEN" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("e732d5222195b1d8c19c60946704a25f","Export ACCESS TOKEN")'><div><div class=tab-nav-hidden>Export ACCESS TOKEN</div><div class=tab-nav-text>Export ACCESS TOKEN</div></div></button></div><div class=tab-content-container><div data-tab-item="Export ACCESS TOKEN" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_O11y-Workshop-ACCESS_TOKEN&gt;&#34;</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=ddc3459b31a09c7fb36a0874b9f18178><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export REALM" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("ddc3459b31a09c7fb36a0874b9f18178","Export REALM")'><div><div class=tab-nav-hidden>Export REALM</div><div class=tab-nav-text>Export REALM</div></div></button></div><div class=tab-content-container><div data-tab-item="Export REALM" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_REALM&gt;&#34;</span></span></span></code></pre></div></div></div></div></div><p>Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository to Helm and update.</p><div class=tab-panel data-tab-group=f5c93a310d6915fadd3b9e9b6456386a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Helm Repo Add" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f5c93a310d6915fadd3b9e9b6456386a","Helm Repo Add")'><div><div class=tab-nav-hidden>Helm Repo Add</div><div class=tab-nav-text>Helm Repo Add</div></div></button>
<button data-tab-item="Helm Repo Add Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f5c93a310d6915fadd3b9e9b6456386a","Helm Repo Add Output")'><div><div class=tab-nav-hidden>Helm Repo Add Output</div><div class=tab-nav-text>Helm Repo Add Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Helm Repo Add" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div data-tab-item="Helm Repo Add Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Using ACCESS_TOKEN={REDACTED}
Using REALM=eu0
&ldquo;splunk-otel-collector-chart&rdquo; has been added to your repositories
Using ACCESS_TOKEN={REDACTED}
Using REALM=eu0
Hang tight while we grab the latest from your chart repositories&mldr;
&mldr;Successfully got an update from the &ldquo;splunk-otel-collector-chart&rdquo; chart repository
Update Complete. ⎈Happy Helming!⎈</p></div></div></div></div><p>Install the OpenTelemetry Collector Helm chart with the following commands, do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=f114488e758e8c250e41dae05d3aa1ed><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Helm Install" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f114488e758e8c250e41dae05d3aa1ed","Helm Install")'><div><div class=tab-nav-hidden>Helm Install</div><div class=tab-nav-text>Helm Install</div></div></button>
<button data-tab-item="Helm Install Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f114488e758e8c250e41dae05d3aa1ed","Helm Install Output")'><div><div class=tab-nav-hidden>Helm Install Output</div><div class=tab-nav-text>Helm Install Output</div></div></button>
<button data-tab-item="Install Network Explorer" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f114488e758e8c250e41dae05d3aa1ed","Install Network Explorer")'><div><div class=tab-nav-hidden>Install Network Explorer</div><div class=tab-nav-text>Install Network Explorer</div></div></button></div><div class=tab-content-container><div data-tab-item="Helm Install" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.profilingEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-apm-env&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div><div data-tab-item="Helm Install Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri May  7 11:19:01 2021
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>TEST SUITE: None</span></span></code></pre></div></div></div><div data-tab-item="Install Network Explorer" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;networkExplorer.enabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;networkExplorer.podSecurityPolicy.enabled=false&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;agent.enabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;gateway.replicaCount=1&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;gateway.resources.limits.cpu=500m&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;gateway.resources.limits.memory=1Gi&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterReceiver.enabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-apm-env&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div></div></div><p>You can monitor the progress of the deployment by running <code>kubectl get pods</code> which should typically report a new pod is up and running after about 30 seconds.</p><p>Ensure the status is reported as Running before continuing.</p><div class=tab-panel data-tab-group=1b7f48afd3a1446b686447cfc6e5fc77><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Get Pods" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("1b7f48afd3a1446b686447cfc6e5fc77","Kubectl Get Pods")'><div><div class=tab-nav-hidden>Kubectl Get Pods</div><div class=tab-nav-text>Kubectl Get Pods</div></div></button>
<button data-tab-item="Kubectl Get Pods Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("1b7f48afd3a1446b686447cfc6e5fc77","Kubectl Get Pods Output")'><div><div class=tab-nav-hidden>Kubectl Get Pods Output</div><div class=tab-nav-text>Kubectl Get Pods Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Get Pods" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Get Pods Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-2sk6k                             0/1     Running   0          10s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6956d4446f-gwnd7   0/1     Running   0          10s</span></span></code></pre></div></div></div></div></div><p>Ensure there are no errors by tailing the logs from the OpenTelemetry Collector pod. Output should look similar to the log output shown in the Output tab below.</p><p>Use the label set by the <code>helm</code> install to tail logs (You will need to press <code>ctrl+c</code> to exit). Or use the installed <code>k9s</code> terminal UI for bonus points!</p><div class=tab-panel data-tab-group=b9e1255c9c368d98619ec130c226babd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Logs" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("b9e1255c9c368d98619ec130c226babd","Kubectl Logs")'><div><div class=tab-nav-hidden>Kubectl Logs</div><div class=tab-nav-text>Kubectl Logs</div></div></button>
<button data-tab-item="Kubectl Logs Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b9e1255c9c368d98619ec130c226babd","Kubectl Logs Output")'><div><div class=tab-nav-hidden>Kubectl Logs Output</div><div class=tab-nav-text>Kubectl Logs Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Logs" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Logs Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>2021-03-21T16:11:10.900Z INFO service/service.go:364 Starting receivers&mldr;
2021-03-21T16:11:10.900Z INFO builder/receivers_builder.go:70 Receiver is starting&mldr; {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;prometheus&rdquo;, &ldquo;component_name&rdquo;: &ldquo;prometheus&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:75 Receiver started. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;prometheus&rdquo;, &ldquo;component_name&rdquo;: &ldquo;prometheus&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:70 Receiver is starting&mldr; {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.009Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0>k8sclusterreceiver@v0.21.0</a>/watcher.go:195 Configured Kubernetes MetadataExporter {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;exporter_name&rdquo;: &ldquo;signalfx&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:75 Receiver started. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.009Z INFO healthcheck/handler.go:128 Health Check state change {&ldquo;component_kind&rdquo;: &ldquo;extension&rdquo;, &ldquo;component_type&rdquo;: &ldquo;health_check&rdquo;, &ldquo;component_name&rdquo;: &ldquo;health_check&rdquo;, &ldquo;status&rdquo;: &ldquo;ready&rdquo;}
2021-03-21T16:11:11.009Z INFO service/service.go:267 Everything is ready. Begin running and processing data.
2021-03-21T16:11:11.009Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0>k8sclusterreceiver@v0.21.0</a>/receiver.go:59 Starting shared informers and wait for initial cache sync. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.281Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0>k8sclusterreceiver@v0.21.0</a>/receiver.go:75 Completed syncing shared informer caches. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}</p></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Deleting a failed installation</div><div class=box-content><p>If you make an error installing the OpenTelemetry Collector you can start over by deleting the installation using:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><hr><h2 id=3-validate-metrics-in-the-ui>3. Validate metrics in the UI</h2><p>In the Splunk UI, click the <strong>&#187;</strong> bottom left and click on <strong>Infrastructure</strong>.</p><p><a href=#image-deff38188c2f4061be344de4f5e4bc7d class=lightbox-link><img src=../../../en/imt/gdi/../images/clustermap-nav.png alt="Selecting the Kubernetes Navigator Map" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-deff38188c2f4061be344de4f5e4bc7d><img src=../../../en/imt/gdi/../images/clustermap-nav.png alt="Selecting the Kubernetes Navigator Map" class=lightbox-image loading=lazy></a></p><p>Under <strong>Containers</strong> click on <strong>Kubernetes</strong> to open the Kubernetes Navigator Cluster Map to ensure metrics are being sent in.</p><p>Validate that your cluster is discovered and reporting by finding your cluster (in the workshop you will see many other clusters). To find your cluster name run the following command and copy the output to your clipboard:</p><div class=tab-panel data-tab-group=229460cf17425fa2befa38e0c6f409f7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Echo Cluster Name" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("229460cf17425fa2befa38e0c6f409f7","Echo Cluster Name")'><div><div class=tab-nav-hidden>Echo Cluster Name</div><div class=tab-nav-text>Echo Cluster Name</div></div></button></div><div class=tab-content-container><div data-tab-item="Echo Cluster Name" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=k>$(</span>hostname<span class=k>)</span>-k3s-cluster</span></span></code></pre></div></div></div></div></div><p>Then in the UI, click on the &ldquo;Cluster: - " menu just below the Splunk Logo, and paste the Cluster name you just copied into the search box, click the box to select your cluster, and finally click off the menu into white space to apply the filter.</p><p><a href=#image-fa4bcf37190a95b821f9b0e46a18fa88 class=lightbox-link><img src=../../../en/imt/gdi/../images/search-k3s-cluster.png alt="K8S Clusters Filter" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-fa4bcf37190a95b821f9b0e46a18fa88><img src=../../../en/imt/gdi/../images/search-k3s-cluster.png alt="K8S Clusters Filter" class=lightbox-image loading=lazy></a></p><p><a href=#image-c9759cb512536d2f7a2d2875deef6fcc class=lightbox-link><img src=../../../en/imt/gdi/../images/selecting-k3s-cluster.png alt="Select K8S Cluster" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c9759cb512536d2f7a2d2875deef6fcc><img src=../../../en/imt/gdi/../images/selecting-k3s-cluster.png alt="Select K8S Cluster" class=lightbox-image loading=lazy></a></p><p><a href=#image-9a1de24d77bf8de0fca98374b9b21881 class=lightbox-link><img src=../../../en/imt/gdi/../images/filtered-k3s-cluster.png alt="Filtered K8S Cluster" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9a1de24d77bf8de0fca98374b9b21881><img src=../../../en/imt/gdi/../images/filtered-k3s-cluster.png alt="Filtered K8S Cluster" class=lightbox-image loading=lazy></a></p><p>To examine the health of your node, hover over the pale blue background of your cluster, then click on the blue magnifying glass
<a href=#image-40fa346c364745904039097b641f5c28 class=lightbox-link><img src="../../../en/imt/gdi/../images/blue-cross.png?classes=inline&height=25px" alt="Magnifying Glass" class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-40fa346c364745904039097b641f5c28><img src="../../../en/imt/gdi/../images/blue-cross.png?classes=inline&height=25px" alt="Magnifying Glass" class=lightbox-image loading=lazy></a> that appears in the top left hand corner.</p><p>This will drill down to the node level. Next, open the side bar by clicking on the side bar button to open the Metrics side bar.</p><p>Once it is open, you can use the slider on the side to explore the various charts relevant to your cluster/node: CPU, Memory, Network, Events etc.</p><p><a href=#image-9ac418b3ce1f5f84796d4b2a9da20269 class=lightbox-link><img src=../../../en/imt/gdi/../images/explore-metrics.png alt="Sidebar metrics" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9ac418b3ce1f5f84796d4b2a9da20269><img src=../../../en/imt/gdi/../images/explore-metrics.png alt="Sidebar metrics" class=lightbox-image loading=lazy></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Access Tokens (sometimes called Org Tokens) are long-lived organization-level tokens. By default, these tokens persist for 5 years, and thus are suitable for embedding into emitters that send data points over long periods of time, or for any long-running scripts that call the Splunk API.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>A realm is a self-contained deployment of Splunk in which your Organization is hosted. Different realms have different API endpoints (e.g. the endpoint for sending data is <code>ingest.us1.signalfx.com</code> for the <strong><code>us1</code></strong> realm, and <code>ingest.eu0.signalfx.com</code> for the <strong><code>eu0</code></strong> realm). This realm name is shown on your profile page in the Splunk UI. If you do not include the realm name when specifying an endpoint, Splunk will interpret it as pointing to the <strong><code>us0</code></strong> realm.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Deploying the OpenTelemetry Collector in Kubernetes</h1><article class=default><header class=headline></header><h1 id=deploying-nginx-in-k3s>Deploying NGINX in K3s</h1><ul><li>Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment.</li><li>Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud!</li></ul><hr><h2 id=1-start-your-nginx>1. Start your NGINX</h2><p>Verify the number of pods running in the Splunk UI by selecting the <strong>WORKLOADS</strong> tab. This should give you an overview of the workloads on your cluster.</p><p><a href=#image-5cbf245bbba250af5d10fcec1d13e2f8 class=lightbox-link><img src=../../../en/imt/gdi/nginx/../../images/k8s-workloads.png alt="Workload Agent" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5cbf245bbba250af5d10fcec1d13e2f8><img src=../../../en/imt/gdi/nginx/../../images/k8s-workloads.png alt="Workload Agent" class=lightbox-image loading=lazy></a></p><p>Note the single agent container running per node among the default Kubernetes pods. This single container will monitor all the pods and services being deployed on this node!</p><p>Now switch back to the default cluster node view by selecting the <strong>MAP</strong> tab and select your cluster again.</p><p>In your AWS/EC2 or Multipass shell session change into the <code>nginx</code> directory:</p><div class=tab-panel data-tab-group=2be326d909746df524786c43f18d966e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Change Directory" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("2be326d909746df524786c43f18d966e","Change Directory")'><div><div class=tab-nav-hidden>Change Directory</div><div class=tab-nav-text>Change Directory</div></div></button></div><div class=tab-content-container><div data-tab-item="Change Directory" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/k3s/nginx</span></span></code></pre></div></div></div></div></div><hr><h2 id=2-create-nginx-deployment>2. Create NGINX deployment</h2><p>Create the NGINX ConfigMap<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> using the <code>nginx.conf</code> file:</p><div class=tab-panel data-tab-group=1de5737c8f95544dc46bf10c937df029><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Configmap Create" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("1de5737c8f95544dc46bf10c937df029","Kubectl Configmap Create")'><div><div class=tab-nav-hidden>Kubectl Configmap Create</div><div class=tab-nav-text>Kubectl Configmap Create</div></div></button>
<button data-tab-item="Kubectl Create Configmap Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("1de5737c8f95544dc46bf10c937df029","Kubectl Create Configmap Output")'><div><div class=tab-nav-hidden>Kubectl Create Configmap Output</div><div class=tab-nav-text>Kubectl Create Configmap Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Configmap Create" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create configmap nginxconfig --from-file<span class=o>=</span>nginx.conf</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Create Configmap Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>configmap/nginxconfig created</p></div></div></div></div><p>Then create the deployment:</p><div class=tab-panel data-tab-group=820b8a9820bb8ee8e1c649ed4d63367a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Create Deployment" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("820b8a9820bb8ee8e1c649ed4d63367a","Kubectl Create Deployment")'><div><div class=tab-nav-hidden>Kubectl Create Deployment</div><div class=tab-nav-text>Kubectl Create Deployment</div></div></button>
<button data-tab-item="Kubectl Create Deployment Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("820b8a9820bb8ee8e1c649ed4d63367a","Kubectl Create Deployment Output")'><div><div class=tab-nav-hidden>Kubectl Create Deployment Output</div><div class=tab-nav-text>Kubectl Create Deployment Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Create Deployment" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f nginx-deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Create Deployment Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>deployment.apps/nginx created
service/nginx created</p></div></div></div></div><p>Next we will deploy Locust<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> which is an open source tool used for creating a load test against NGINX:</p><div class=tab-panel data-tab-group=29c5a702da4373d0db6472590b1d6d03><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Create Deployment" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("29c5a702da4373d0db6472590b1d6d03","Kubectl Create Deployment")'><div><div class=tab-nav-hidden>Kubectl Create Deployment</div><div class=tab-nav-text>Kubectl Create Deployment</div></div></button>
<button data-tab-item="Kubectl Create Deployment Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("29c5a702da4373d0db6472590b1d6d03","Kubectl Create Deployment Output")'><div><div class=tab-nav-hidden>Kubectl Create Deployment Output</div><div class=tab-nav-text>Kubectl Create Deployment Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Create Deployment" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f locust-deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Create Deployment Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>deployment.apps/nginx-loadgenerator created
service/nginx-loadgenerator created</p></div></div></div></div><p>Validate the deployment has been successful and that the Locust and NGINX pods are running.</p><p>If you have the Splunk UI open you should see new Pods being started and containers being deployed.</p><p>It should only take around 20 seconds for the pods to transition into a Running state. In the Splunk UI you will have a cluster that looks like below:</p><p><a href=#image-6e67e057f3cac5d7a6556b3f3e543f24 class=lightbox-link><img src=../../../en/imt/gdi/nginx/../../images/cluster.png alt="back to Cluster" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6e67e057f3cac5d7a6556b3f3e543f24><img src=../../../en/imt/gdi/nginx/../../images/cluster.png alt="back to Cluster" class=lightbox-image loading=lazy></a></p><p>If you select the <strong>WORKLOADS</strong> tab again you will now see that there is a new ReplicaSet and a deployment added for NGINX:</p><p><a href=#image-98fdb90dc18b5e167e858b9ce5981bd6 class=lightbox-link><img src=../../../en/imt/gdi/nginx/../../images/k8s-workloads-nginx.png alt="NGINX loaded" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-98fdb90dc18b5e167e858b9ce5981bd6><img src=../../../en/imt/gdi/nginx/../../images/k8s-workloads-nginx.png alt="NGINX loaded" class=lightbox-image loading=lazy></a></p><hr><p>Let&rsquo;s validate this in your shell as well:</p><div class=tab-panel data-tab-group=e9c88419be3def8f4c73d2d290f21552><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Get Pods" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("e9c88419be3def8f4c73d2d290f21552","Kubectl Get Pods")'><div><div class=tab-nav-hidden>Kubectl Get Pods</div><div class=tab-nav-text>Kubectl Get Pods</div></div></button>
<button data-tab-item="Kubectl Get Pods Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("e9c88419be3def8f4c73d2d290f21552","Kubectl Get Pods Output")'><div><div class=tab-nav-hidden>Kubectl Get Pods Output</div><div class=tab-nav-text>Kubectl Get Pods Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Get Pods" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Get Pods Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>NAME READY STATUS RESTARTS AGE
splunk-otel-collector-k8s-cluster-receiver-77784c659c-ttmpk 1/1 Running 0 9m19s
splunk-otel-collector-agent-249rd 1/1 Running 0 9m19s
svclb-nginx-vtnzg 1/1 Running 0 5m57s
nginx-7b95fb6b6b-7sb9x 1/1 Running 0 5m57s
nginx-7b95fb6b6b-lnzsq 1/1 Running 0 5m57s
nginx-7b95fb6b6b-hlx27 1/1 Running 0 5m57s
nginx-7b95fb6b6b-zwns9 1/1 Running 0 5m57s
svclb-nginx-loadgenerator-nscx4 1/1 Running 0 2m20s
nginx-loadgenerator-755c8f7ff6-x957q 1/1 Running 0 2m20s</p></div></div></div></div><hr><h2 id=3-run-locust-load-test>3. Run Locust load test</h2><p>Locust, an open source load generator, is available on port 8080 of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and go to <code>http://{==EC2-IP==}:8080/</code>, you will then be able to see the Locust running.</p><p><a href=#image-e2b31d94ab4a4a0f762040a83d89622a class=lightbox-link><img src=../../../en/imt/gdi/nginx/../../images/nginx-locust.png alt=Locust style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e2b31d94ab4a4a0f762040a83d89622a><img src=../../../en/imt/gdi/nginx/../../images/nginx-locust.png alt=Locust class=lightbox-image loading=lazy></a></p><p>Set the <strong>Spawn rate</strong> to be 2 and click <strong>Start Swarming</strong>.</p><p><a href=#image-23975105fed6c61620be7c00666b5440 class=lightbox-link><img src=../../../en/imt/gdi/nginx/../../images/nginx-locust-spawn-rate.png alt="Locust Spawn Rate" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-23975105fed6c61620be7c00666b5440><img src=../../../en/imt/gdi/nginx/../../images/nginx-locust-spawn-rate.png alt="Locust Spawn Rate" class=lightbox-image loading=lazy></a></p><p>This will start a gentle continuous load on the application.</p><p><a href=#image-59feb135b8ca5ab8beccae651d69586a class=lightbox-link><img src=../../../en/imt/gdi/nginx/../../images/nginx-locust-statistics.png alt="Locust Statistics" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-59feb135b8ca5ab8beccae651d69586a><img src=../../../en/imt/gdi/nginx/../../images/nginx-locust-statistics.png alt="Locust Statistics" class=lightbox-image loading=lazy></a></p><p>As you can see from the above screenshot, most of the calls will report a fail, this is expected, as we have not yet deployed the application behind it, however NGINX is reporting on your attempts and you should be able to see those metrics.</p><p>Validate you are seeing those metrics in the UI by selecting <strong>Dashboards → Built-in Dashboard Groups → NGINX → NGINX Servers</strong>. Using the <strong>Overrides</strong> filter on <code>k8s.cluster.name:</code>, find the name of your cluster as returned by <code>echo $(hostname)-k3s-cluster</code> in the terminal.</p><p><a href=#image-d3ce3447511c37dc1363cda2426c6bd7 class=lightbox-link><img src=../../../en/imt/gdi/nginx/../../images/nginx-dashboard.png alt="NGINX Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d3ce3447511c37dc1363cda2426c6bd7><img src=../../../en/imt/gdi/nginx/../../images/nginx-dashboard.png alt="NGINX Dashboard" class=lightbox-image loading=lazy></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A ConfigMap is an API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or as configuration files in a volume. A ConfigMap allows you to decouple environment-specific configuration from your container images, so that your applications are easily portable.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://locust.io/ target=_blank>What is Locust?</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article></section></div></main></div><script src=../../../js/clipboard.min.js?1692263991 defer></script>
<script src=../../../js/perfect-scrollbar.min.js?1692263991 defer></script>
<script src=../../../js/theme.js?1692263991 defer></script></body></html>