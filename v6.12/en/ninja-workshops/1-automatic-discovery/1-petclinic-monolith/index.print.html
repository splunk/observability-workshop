<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 8.0.0+97777ec5111409397e83f44eca496eea97697836"><meta name=description content="Hands-on workshop demonstrating Splunk Observability Cloud's automatic discovery and configuration capabilities for Java applications using the Spring PetClinic sample application."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="PetClinic Monolith Workshop :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Hands-on workshop demonstrating Splunk Observability Cloud's automatic discovery and configuration capabilities for Java applications using the Spring PetClinic sample application."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="PetClinic Monolith Workshop :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Hands-on workshop demonstrating Splunk Observability Cloud's automatic discovery and configuration capabilities for Java applications using the Spring PetClinic sample application."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="PetClinic Monolith Workshop :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Hands-on workshop demonstrating Splunk Observability Cloud's automatic discovery and configuration capabilities for Java applications using the Spring PetClinic sample application."><meta itemprop=dateModified content="2025-09-29T12:27:10+01:00"><meta itemprop=wordCount content="190"><title>PetClinic Monolith Workshop :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html rel=canonical type=text/html title="PetClinic Monolith Workshop :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v6.12/images/favicon.ico?1761175652 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v6.12/css/auto-complete/auto-complete.min.css?1761175652 rel=stylesheet><script src=/observability-workshop/v6.12/js/auto-complete/auto-complete.min.js?1761175652 defer></script><script src=/observability-workshop/v6.12/js/search-lunr.min.js?1761175652 defer></script><script src=/observability-workshop/v6.12/js/search.min.js?1761175652 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/v6.12/searchindex.en.js?1761175652"</script><script src=/observability-workshop/v6.12/js/lunr/lunr.min.js?1761175652 defer></script><script src=/observability-workshop/v6.12/js/lunr/lunr.stemmer.support.min.js?1761175652 defer></script><script src=/observability-workshop/v6.12/js/lunr/lunr.multi.min.js?1761175652 defer></script><script src=/observability-workshop/v6.12/js/lunr/lunr.en.min.js?1761175652 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/observability-workshop/v6.12/fonts/fontawesome/css/fontawesome-all.min.css?1761175652 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v6.12/fonts/fontawesome/css/fontawesome-all.min.css?1761175652 rel=stylesheet></noscript><link href=/observability-workshop/v6.12/css/perfect-scrollbar/perfect-scrollbar.min.css?1761175652 rel=stylesheet><link href=/observability-workshop/v6.12/css/theme.min.css?1761175652 rel=stylesheet><link href=/observability-workshop/v6.12/css/format-print.min.css?1761175652 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html",window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v6.12",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({appplicationName:"observability-workshop",realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",recorder:"splunk",features:{video:!0}})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-url=/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.12/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.12/en/ninja-workshops/index.html><span itemprop=name>Splunk4Ninjas Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/index.html><span itemprop=name>Automatic Discovery Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>PetClinic Monolith Workshop</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/index.html title="Automatic Discovery Workshops (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/1-otel-collector/index.html title="Installing the OpenTelemetry Collector (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=petclinic-monolith-workshop>PetClinic Monolith Workshop</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>30 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><p>The goal is to walk through the basic steps to configure the following components of the <strong>Splunk Observability Cloud</strong> platform:</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Automatic Discovery for Java (APM)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Real User Monitoring (RUM)</li><li>RUM to APM Correlation</li><li>Splunk Log Observer (LO)</li></ul><p>We will also show the steps about how to clone (download) a sample Java application (Spring PetClinic), as well as how to compile, package and run the application.</p><p>Once the application is up and running, we will instantly start seeing metrics, traces and logs via the <strong>automatic discovery and configuration</strong> for Java 2.x that will be used by the <strong>Splunk APM</strong> product.</p><p>After that, we will instrument PetClinic&rsquo;s end user interface (HTML pages rendered by the application) with the <strong>Splunk OpenTelemetry Javascript Libraries (RUM)</strong> that will generate RUM traces around all the individual clicks and page loads executed by an end user.</p><p>Lastly, we will view the logs generated by the automatic injection of trace metadata into the PetClinic application logs.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info"></i>
Prerequisites</summary><div class=box-content><ul><li>Outbound SSH access to port <code>2222</code>.</li><li>Outbound HTTP access to port <code>8083</code>.</li><li>Familiarity with the <code>bash</code> shell and <code>vi/vim</code> editor.</li></ul></div></details><p><a href=#R-image-48cbed4dd950797643f77d6e03b56ffb class=lightbox-link><img alt="PetClinic Exercise" class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/images/petclinic-exercise.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-48cbed4dd950797643f77d6e03b56ffb><img alt="PetClinic Exercise" class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/v6.12/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/images/petclinic-exercise.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 29, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of PetClinic Monolith Workshop</h1><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><p>The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:</p><ul><li>Infrastructure metrics (disk, CPU, memory, etc.)</li><li>Application Performance Monitoring (APM) traces</li><li>Profiling data</li><li>Host and application logs</li></ul><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
Remove any existing OpenTelemetry Collectors</summary><div class=box-content><p>If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div><p>The EC2 instance may already have an older version of the collector already installed. To uninstall the collector, run the following commands:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh
</span></span><span class=line><span class=cl>sudo sh /tmp/splunk-otel-collector.sh --uninstall</span></span></code></pre></div></div></details><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/check_env.sh</span></span></code></pre></div><p>In the output check that all the following environment variables are present and have values set. If any are missing, please contact your instructor:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL
</span></span><span class=line><span class=cl>INSTANCE</span></span></code></pre></div><p>We can then go ahead and install the Collector. Some additional parameters are passed to the installation script, they are:</p><ul><li><code>--with-instrumentation</code> - This will install the agent from the Splunk distribution of OpenTelemetry Java, which is then loaded automatically when the PetClinic Java application starts up. No configuration is required!</li><li><code>--deployment-environment</code> - Sets the resource attribute <code>deployment.environment</code> to the value passed. This is used to filter views in the UI.</li><li><code>--enable-profiler</code> - Enables the profiler for the Java application. This will generate CPU profiles for the application.</li><li><code>--enable-profiler-memory</code> - Enables the profiler for the Java application. This will generate memory profiles for the application.</li><li><code>--enable-metrics</code> - Enables the exporting of Micrometer metrics</li><li><code>--hec-token</code> - Sets the HEC token for the collector to use</li><li><code>--hec-url</code> - Sets the HEC URL for the collector to use</li></ul><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span> --mode agent --without-fluentd --with-instrumentation --deployment-environment <span class=nv>$INSTANCE</span>-petclinic --enable-profiler --enable-profiler-memory --enable-metrics --hec-token <span class=nv>$HEC_TOKEN</span> --hec-url <span class=nv>$HEC_URL</span></span></span></code></pre></div><p>Next, we will patch the collector to expose the hostname of the instance and not the AWS instance ID. This will make it easier to filter data in the UI:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Once the <code>agent_config.yaml</code> has been patched, you will need to restart the collector:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p>Once the installation is completed, you can navigate to the <strong>Hosts with agent installed</strong> dashboard to see the data from your host, <strong>Dashboards → Hosts with agent installed</strong>.</p><p>Use the dashboard filter and select <code>host.name</code> and type or select the hostname of your workshop instance (you can get this from the command prompt in your terminal session). Once you see data flowing for your host, we are then ready to get started with the APM component.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 3, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=building-the-spring-petclinic-application>Building the Spring PetClinic Application</h1><p>The first thing we need to set up APM is&mldr; well, an application. For this exercise, we will use the Spring PetClinic application. This is a very popular sample Java application built with the Spring framework (Springboot).</p><p>First, clone the PetClinic GitHub repository, and then we will compile, build, package and test the application:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/spring-projects/spring-petclinic</span></span></code></pre></div><p>Change into the <code>spring-petclinic</code> directory:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> spring-petclinic</span></span></code></pre></div><p>Using Docker, start a MySQL database for PetClinic to use:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -e <span class=nv>MYSQL_USER</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>petclinic -p 3306:3306 docker.io/biarms/mysql:5.7</span></span></code></pre></div><p>Next, we will start another container running Locust that will generate some simple traffic to the PetClinic application. Locust is a simple load-testing tool that can be used to generate traffic to a web application.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --network<span class=o>=</span><span class=s2>&#34;host&#34;</span> -d -p 8090:8090 -v ~/workshop/petclinic:/mnt/locust docker.io/locustio/locust -f /mnt/locust/locustfile.py --headless -u <span class=m>1</span> -r <span class=m>1</span> -H http://127.0.0.1:8083</span></span></code></pre></div><p>Next, compile, build and package PetClinic using <code>maven</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>This will take a few minutes the first time you run and will download a lot of dependencies before it compiles the application. Future builds will be a lot quicker.</p></div></details><p>Once the build completes, you need to obtain the public IP address of the instance you are running on. You can do this by running the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://ifconfig.me</span></span></code></pre></div><p>You will see an IP address returned, make a note of this as we will need it to validate that the application is running.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=automatic-discovery-and-configuration-for-java>Automatic discovery and configuration for Java</h1><p>You can now start the application with the following command. Notice that we are passing the <code>mysql</code> profile to the application, this will tell the application to use the MySQL database we started earlier. We are also setting the <code>otel.service.name</code> and <code>otel.resource.attributes</code> to a logical names using the instance name. These will also be used in the UI for filtering:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>You can validate the application is running by visiting <code>http://&lt;IP_ADDRESS>:8083</code> (replace <code>&lt;IP_ADDRESS></code> with the IP address you obtained earlier).</p><p>When we installed the collector we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you start the PetClinic application you will see the collector automatically detect the application and instrument it for traces and profiling.</p><div class=tab-panel data-tab-group=R-tabs-c5a3c108608cb1ebc7d4fe0b53306a4d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c5a3c108608cb1ebc7d4fe0b53306a4d","R-tab-587b796170a9abac4701cd8aa1bb38cb")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-587b796170a9abac4701cd8aa1bb38cb class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/lib/splunk-instrumentation/splunk-otel-javaagent.jar
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:58:970 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-2.6.0-otel-2.6.0
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT10S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><p>You can now visit the Splunk APM UI and examine the application components, traces, profiling, DB Query performance and metrics. From the left-hand menu click <strong>APM</strong> and then click the <strong>Environment</strong> dropdown and select your environment e.g. <code>&lt;INSTANCE>-petclinic</code> (where<code>&lt;INSTANCE></code> is replaced with the value you noted down earlier).</p><p>Once your validation is complete you can stop the application by pressing <code>Ctrl-c</code>.</p><p>Resource attributes can be added to every reported span. For example <code>version=0.314</code>. A comma-separated list of resource attributes can also be defined e.g. <code>key1=val1,key2=val2</code>.</p><p>Let&rsquo;s launch the PetClinic again using new resource attributes. Note, that adding resource attributes to the run command will override what was defined when we installed the collector. Let&rsquo;s add a new resource attribute <code>version=0.314</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Back in the Splunk APM UI we can drill down on a recent trace and see the new <code>version</code> attribute in a span.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Nov 4, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=3-real-user-monitoring>3. Real User Monitoring</h1><p>For the Real User Monitoring (RUM) instrumentation, we will add the Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web rel=external target=_blank><strong>https://github.com/signalfx/splunk-otel-js-web</strong></a> snippet in the pages, we will use the wizard again <strong>Data Management → Add Integration → RUM Instrumentation → Browser Instrumentation</strong>.</p><p>Your instructor will inform you which token to use from the dropdown, click <strong>Next</strong>. Enter <strong>App name</strong> and <strong>Environment</strong> using the following syntax:</p><ul><li><code>&lt;INSTANCE>-petclinic-service</code> - replacing <code>&lt;INSTANCE></code> with the value you noted down earlier.</li><li><code>&lt;INSTANCE>-petclinic-env</code> - replacing <code>&lt;INSTANCE></code> with the value you noted down earlier.</li></ul><p>The wizard will then show a snippet of HTML code that needs to be placed at the top of the pages in the <code>&lt;head></code> section. The following is an example of the (do not use this snippet, use the one generated by the wizard):</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>IMPORTANT: Replace the <span class=p>&lt;</span><span class=nt>version</span><span class=p>&gt;</span> placeholder in the src URL with a
</span></span><span class=line><span class=cl>version from https://github.com/signalfx/splunk-otel-js-web/releases
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*/
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>The Spring PetClinic application uses a single HTML page as the &ldquo;layout&rdquo; page, that is reused across all pages of the application. This is the perfect location to insert the Splunk RUM Instrumentation Library as it will be loaded in all pages automatically.</p><p>Let&rsquo;s then edit the layout page:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi src/main/resources/templates/fragments/layout.html</span></span></code></pre></div><p>Next, insert the snippet we generated above in the <code>&lt;head></code> section of the page. Make sure you don&rsquo;t include the comment and replace <code>&lt;version></code> in the source URL to <code>latest</code> e.g.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!doctype html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>th:fragment</span><span class=o>=</span><span class=s>&#34;layout (template, menu)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>...</span></span></code></pre></div><p>With the code changes complete, we need to rebuild the application and run it again. Run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Then let&rsquo;s visit the application using a browser to generate real-user traffic <code>http://&lt;IP_ADDRESS>:8083</code>.</p><p>In RUM, filter down into the environment as defined in the RUM snippet above and click through to the dashboard.</p><p>When you drill down into a RUM trace you will see a link to APM in the spans. Clicking on the trace ID will take you to the corresponding APM trace for the current RUM trace.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=4-log-observer>4. Log Observer</h1><p>For the Splunk Log Observer component, the Splunk OpenTelemetry Collector automatically collects logs from the Spring PetClinic application and sends them to Splunk Observability Cloud using the OTLP exporter, anotating the log events with <code>trace_id</code>, <code>span_id</code> and trace flags.</p><p>Log Observer provides a real-time view of logs from your applications and infrastructure. It allows you to search, filter, and analyze logs to troubleshoot issues and monitor your environment.</p><p>Go back to the PetClinic web application and click on the <strong>Error</strong> link several times. This will generate some log messages in the PetClinic application logs.</p><p><a href=#R-image-f6759743efe02cb72c542e38180e882a class=lightbox-link><img alt="PetClinic Error" class="lazy lightbox figure-image" loading=lazy src=../images/petclinic-error.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f6759743efe02cb72c542e38180e882a><img alt="PetClinic Error" class="lazy lightbox lightbox-image" loading=lazy src=../images/petclinic-error.png></a></p><p>From the left-hand menu click on <strong>Log Observer</strong> and ensure <strong>Index</strong> is set to <strong>splunk4rookies-workshop</strong>.</p><p>Next, click <strong>Add Filter</strong> search for the field <code>service.name</code> select the value <code>&lt;INSTANCE>-petclinic-service</code> and click <code>=</code> (include). You should now see only the log messages from your PetClinic application.</p><p>Select one of the log entries that were generated by clicking on the <strong>Error</strong> link in the PetClinic application. You will see the log message and the trace metadata that was automatically injected into the log message. Also, you will notice that Related Content is available for APM and Infrastructure.</p><p><a href=#R-image-4c4467ee14fc378f7cdfbec983d78d79 class=lightbox-link><img alt="Log Observer" class="lazy lightbox figure-image" loading=lazy src=../images/log-observer.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4c4467ee14fc378f7cdfbec983d78d79><img alt="Log Observer" class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer.png></a></p><p>This is the end of the workshop and we have certainly covered a lot of ground. At this point, you should have metrics, traces (APM & RUM), logs, database query performance and code profiling being reported into Splunk Observability Cloud and all without having to modify the PetClinic application code (well except for RUM).</p><p><strong>Congratulations!</strong></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v6.12/js/clipboard/clipboard.min.js?1761175652 defer></script><script src=/observability-workshop/v6.12/js/perfect-scrollbar/perfect-scrollbar.min.js?1761175652 defer></script><script src=/observability-workshop/v6.12/js/theme.min.js?1761175652 defer></script></body></html>