<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster.
However, besides tracing automatic discovery and configuration offers additional features out of the box that can help you find issues even faster. In this section we are going to look at two of them:
Always-on Profiling and Java Metrics Database Query Performance If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called Debug Problems in Microservices that you can follow."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Always-On Profiling & DB Query Performance :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster.
However, besides tracing automatic discovery and configuration offers additional features out of the box that can help you find issues even faster. In this section we are going to look at two of them:
Always-on Profiling and Java Metrics Database Query Performance If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called Debug Problems in Microservices that you can follow."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Always-On Profiling & DB Query Performance :: Splunk Observability Cloud Workshops"><meta property="og:description" content="As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster.
However, besides tracing automatic discovery and configuration offers additional features out of the box that can help you find issues even faster. In this section we are going to look at two of them:
Always-on Profiling and Java Metrics Database Query Performance If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called Debug Problems in Microservices that you can follow."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Always-On Profiling & DB Query Performance :: Splunk Observability Cloud Workshops"><meta itemprop=description content="As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster.
However, besides tracing automatic discovery and configuration offers additional features out of the box that can help you find issues even faster. In this section we are going to look at two of them:
Always-on Profiling and Java Metrics Database Query Performance If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called Debug Problems in Microservices that you can follow."><meta itemprop=dateModified content="2024-06-14T14:20:44+01:00"><meta itemprop=wordCount content="100"><title>Always-On Profiling & DB Query Performance :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/index.html rel=canonical type=text/html title="Always-On Profiling & DB Query Performance :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.62/images/favicon.ico?1718371975 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.62/css/fontawesome-all.min.css?1718371989 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.62/css/fontawesome-all.min.css?1718371989 rel=stylesheet></noscript><link href=/observability-workshop/v5.62/css/nucleus.css?1718371989 rel=stylesheet><link href=/observability-workshop/v5.62/css/auto-complete.css?1718371989 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.62/css/auto-complete.css?1718371989 rel=stylesheet></noscript><link href=/observability-workshop/v5.62/css/perfect-scrollbar.min.css?1718371989 rel=stylesheet><link href=/observability-workshop/v5.62/css/fonts.css?1718371989 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.62/css/fonts.css?1718371989 rel=stylesheet></noscript><link href=/observability-workshop/v5.62/css/theme.css?1718371989 rel=stylesheet><link href=/observability-workshop/v5.62/css/theme-splunk-light.css?1718371989 rel=stylesheet id=R-variant-style><link href=/observability-workshop/v5.62/css/chroma-relearn-light.css?1718371989 rel=stylesheet id=R-variant-chroma-style><link href=/observability-workshop/v5.62/css/variant.css?1718371989 rel=stylesheet><link href=/observability-workshop/v5.62/css/print.css?1718371989 rel=stylesheet media=print><link href=/observability-workshop/v5.62/css/format-print.css?1718371989 rel=stylesheet><script src=/observability-workshop/v5.62/js/variant.js?1718371989></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../../..",window.relearn.relBaseUri="../../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.62",window.index_js_url="/observability-workshop/v5.62/en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.62/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.62/en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.62/en/other/3-auto-instrumentation/index.html><span itemprop=name>Auto-Instrumentation Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/index.html><span itemprop=name>PetClinic Kubernetes Workshop</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>6. Advanced Features</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/5-traces/5-section-break/index.html title="5. Section Break (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/1-profiling/index.html title="Always-On Profiling & Metrics (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><article class=chapter><header class=headline></header><h1 id=always-on-profiling--db-query-performance>Always-On Profiling & DB Query Performance</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, which will allow you to identify issues faster.</p><p>However, besides tracing <strong>automatic discovery and configuration</strong> offers additional features out of the box that can help you find issues even faster. In this section we are going to look at two of them:</p><ul><li><strong>Always-on Profiling and Java Metrics</strong></li><li><strong>Database Query Performance</strong></li></ul><p>If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called <a href=/observability-workshop/v5.62/en/scenarios/debug_problems/index.html><strong>Debug Problems in Microservices</strong></a> that you can follow.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>rcastley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Jun 14, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Always-On Profiling & DB Query Performance</h1><article class=default><header class=headline></header><h1 id=always-on-profiling--metrics>Always-On Profiling & Metrics</h1><p>When we installed the Splunk Distribution of the OpenTelemetry Collector using the Helm chart earlier, we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you deploy the PetClinic application and set the annotation, the collector automatically detects the application and instruments it for traces and profiling. We can verify this by examining the startup logs of one of the Java containers we are instrumenting by running the following script:</p><p>The logs should show what flags were picked up by the Java automatic discovery and configuration:</p><p><div class=tab-panel data-tab-group=8084a118ebb664b9d8262dcc74b56322><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=run-the-script class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8084a118ebb664b9d8262dcc74b56322","run-the-script")'>
<span class=tab-nav-text>Run the script</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("8084a118ebb664b9d8262dcc74b56322","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=run-the-script class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0><code class=language-logs data-lang=logs>.  ~/workshop/petclinic/scripts/get_logs.sh</code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2024/02/15 09:42:00 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:01 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:02 Connected to tcp://discovery-server:8761
</span></span><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS:  -javaagent:/otel-auto-instrumentation-java/javaagent.jar
</span></span><span class=line><span class=cl>Picked up _JAVA_OPTIONS: -Dspring.profiles.active=docker,mysql -Dsplunk.profiler.call.stack.interval=150
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:056 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.30.1-otel-1.32.1
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:768 +0000] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:480 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:506 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:510 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:515 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT0.15S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:518 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div>We are interested in the section written by the <code>com.splunk.opentelemetry.profiler.ConfigurationLogger</code> or the <strong>Profiling Configuration</strong>.</p><p>We can see the various settings you can control, some that are useful depending on your use case like the <code>splunk.profiler.directory</code> - The location where the agent writes the call stacks before sending them to Splunk. This may be different depending on how you configure your containers.</p><p>Another parameter you may want to change is <code>splunk.profiler.call.stack.interval</code> This is how often the system takes a CPU Stack trace. You may want to reduce this if you have short spans like we have in our application. (we kept the default as the spans in this demo application are extremely short, so Span may not always have a CPU Call Stack related to it.)</p><p>You can find how to set these parameters <a href=https://docs.splunk.com/observability/en/gdi/get-data-in/application/java/configuration/advanced-java-otel-configuration.html#profiling-configuration-java rel=external target=_blank>here</a>. Below, is how you set a higher collection rate for call stack in your <code>deployment.yaml</code>, exactly how to pass any JAVA option to the Java application running in your container:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>JAVA_OPTIONS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Xdebug -Dsplunk.profiler.call.stack.interval=150&#34;</span></span></span></code></pre></div><p>If you don&rsquo;t see those lines as a result of the script, the startup may have taken too long and generated too many connection errors, try looking at the logs directly with <code>kubectl</code> or the <code>k9s</code> utility that is installed.</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>rcastley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Jun 14, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=always-on-profiling-in-the-trace-waterfall>Always-On Profiling in the Trace Waterfall</h1><p>Make sure you have your original (or similar) Trace & Span <strong>(1)</strong> selected in the APM Waterfall view and select <strong>Memory Stack Traces (2)</strong> from the right-hand pane:</p><p><a href=#R-image-2828d5dee9a79dd61e3e00815d327e4b class=lightbox-link><img alt="profiling from span" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/2-waterfall/../../images/flamechart-in-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2828d5dee9a79dd61e3e00815d327e4b><img alt="profiling from span" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/2-waterfall/../../images/flamechart-in-waterfall.png></a></p><p>The pane should show you the Memory Stack Trace Flame Graph <strong>(3)</strong>, you can scroll down and/or make the pane for a better view by dragging the right side of the pane.</p><p>As AlwaysOn Profiling is constantly taking snapshots, or stack traces, of your applicationâ€™s code and reading through thousands of stack traces is not practical, AlwaysOn Profiling aggregates and summarizes profiling data, providing a convenient way to explore Call Stacks in a view called the <strong>Flame Graph</strong>. It represents a summary of all stack traces captured from your application. You can use the Flame Graph to discover which lines of code might be causing performance issues and to confirm whether the changes you make to the code have the intended effect.</p><p>To dive deeper into the Always-on Profiling, select Span <strong>(3)</strong> in the Profiling Pane under <strong>Memory Stack Traces</strong>
This will bring you to the Always-on Profiling main screen, with the Memory view pre-selected:</p><p><a href=#R-image-36505e6630ac8e71fc868b3eae217a8a class=lightbox-link><img alt="Profiling main" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/2-waterfall/../../images/profiling-memory.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-36505e6630ac8e71fc868b3eae217a8a><img alt="Profiling main" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/2-waterfall/../../images/profiling-memory.png></a></p><ul><li>Java Memory Metric Charts <strong>(1)</strong>, Allow you to <code>Monitor Heap Memory, Application Activity</code> like <code>Memory Allocation Rate</code> and <code>Garbage Collecting</code> Metrics.</li><li>Ability to focus/see metrics and Stack Traces only related to the Span <strong>(2)</strong>, This will filter out background activities running in the Java application if required.</li><li>Java Function calls identified. <strong>(3)</strong>, allowing you to drill down into the Methods called from that function.</li><li>The Flame Graph <strong>(4)</strong>, with the visualization of hierarchy based on the stack traces of the profiled service.</li></ul><p>For further investigation the UI let&rsquo;s you grab the actual stack trace, so you can use in your coding platform to go to the actual lines of code used at this point (depending of course on your preferred Coding platform)</p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>rcastley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Jun 14, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=database-query-performance>Database Query Performance</h1><p>With Database Query Performance, you can monitor the impact of your database queries on service availability directly in Splunk APM. This way, you can quickly identify long-running, unoptimized, or heavy queries and mitigate issues they might be causing, without having to instrument your databases.</p><p>To look at the performance of your database queries, make sure you are on the APM <strong>Explore</strong> page either by going back in the browser or navigating to the APM section in the Menu bar, then click on the <strong>Explore</strong> tile.
Select the inferred database service <code>mysql:petclinic</code> Inferred Database server in the Dependency map <strong>(1)</strong>, then scroll the right-hand pane to find the <strong>Database Query Performance</strong> Pane <strong>(2)</strong>.</p><p><a href=#R-image-4e137473134f2a4976db142054ace8f5 class=lightbox-link><img alt="DB-query from map" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/3-dbquery/../../images/db-query-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4e137473134f2a4976db142054ace8f5><img alt="DB-query from map" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/3-dbquery/../../images/db-query-map.png></a></p><p>If the service you have selected in the map is indeed an (inferred) database server, this pane will populate with the top 90% (P90) database calls based on duration. To dive deeper into the db-query performance function click somewhere on the word <strong>Database Query Performance</strong> at the top of the pane.</p><p>This will bring us to the DB-query Performance overview screen:</p><p><a href=#R-image-9fbf3c369c120ade7ee43423fa7dd96b class=lightbox-link><img alt="DB-query full" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/3-dbquery/../../images/db-query-full.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9fbf3c369c120ade7ee43423fa7dd96b><img alt="DB-query full" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/3-dbquery/../../images/db-query-full.png></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Database Query Normalization</div><div class=box-content><p>By default, Splunk APM instrumentation sanitizes database queries to remove or mask sensible data, such as secrets or personally identifiable information (PII) from the <code>db.statements</code>. You can find how to turn off database query normalization <a href=https://docs.splunk.com/observability/en/apm/db-query-perf/db-perf-troubleshooting.html#turn-off-database-query-normalization rel=external target=_blank>here</a>.</p></div></div><p>This screen will show us all the Database queries <strong>(1)</strong> done towards our database from your application, based on the Traces & Spans sent to the Splunk Observability Cloud. Note that you can compare them across a time block or sort them on Total Time, P90 Latency & Requests <strong>(2)</strong>.</p><p>For each Database query in the list, we see the highest latency, the total number of calls during the time window and the number of requests per second <strong>(3)</strong>. This allows you to identify places where you might optimize your queries.</p><p>You can select traces containing Database Calls via the two charts in the right-hand pane <strong>(5)</strong>. Use the Tag Spotlight pane <strong>(6)</strong> to drill down what tags are related to the database calls, based on endpoints or tags.</p><p>If you click on a specific Query <strong>(1)</strong> you get a detailed query Details pane appears <strong>(2)</strong>, which you can use for more detailed investigations:
<a href=#R-image-44d6dcfe1b954d18a19465b7d1d019fe class=lightbox-link><img alt=details class="noborder lazy lightbox noshadow figure-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/3-dbquery/../../images/query-details.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-44d6dcfe1b954d18a19465b7d1d019fe><img alt=details class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=/observability-workshop/v5.62/en/other/3-auto-instrumentation/1-zero-config-k8s/6-profiling-db-query/3-dbquery/../../images/query-details.png></a></p><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>rcastley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Jun 14, 2024</span></span></footer></article><article class=chapter><header class=headline></header><h1 id=4-section-break>4. Section Break</h1><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>rcastley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Jun 14, 2024</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.62/js/clipboard.min.js?1718371989 defer></script><script src=/observability-workshop/v5.62/js/perfect-scrollbar.min.js?1718371989 defer></script><script src=/observability-workshop/v5.62/js/theme.js?1718371989 defer></script></body></html>