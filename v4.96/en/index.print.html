<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.17.1+tip"><meta name=description content="Learn how to build observability solutions with Splunk"><title>Splunk Observability Workshops :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v4.96/en/index.html rel=alternate hreflang=x-default><link href=https://splunk.github.io/observability-workshop/v4.96/en/index.html rel=alternate hreflang=en><link href=https://splunk.github.io/observability-workshop/v4.96/ja/index.html rel=alternate hreflang=ja><link href=https://splunk.github.io/observability-workshop/v4.96/en/index.html rel=canonical type=text/html title="Splunk Observability Workshops :: Splunk Observability Cloud Workshops"><link href=../en/index.xml rel=alternate type=application/rss+xml title="Splunk Observability Workshops :: Splunk Observability Cloud Workshops"><link href=../images/favicon.ico?1689693081 rel=icon type=image/x-icon sizes=any><link href=../css/fontawesome-all.min.css?1689693085 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../css/fontawesome-all.min.css?1689693085 rel=stylesheet></noscript><link href=../css/nucleus.css?1689693085 rel=stylesheet><link href=../css/auto-complete.css?1689693085 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../css/auto-complete.css?1689693085 rel=stylesheet></noscript><link href=../css/perfect-scrollbar.min.css?1689693085 rel=stylesheet><link href=../css/fonts.css?1689693085 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../css/fonts.css?1689693085 rel=stylesheet></noscript><link href=../css/theme.css?1689693085 rel=stylesheet><link href=../css/theme-splunk-light.css?1689693085 rel=stylesheet id=variant-style><link href=../css/variant.css?1689693085 rel=stylesheet><link href=../css/print.css?1689693085 rel=stylesheet media=print><link href=../css/format-print.css?1689693085 rel=stylesheet><link href=../css/ie.css?1689693085 rel=stylesheet><script src=../js/url.js?1689693085></script>
<script src=../js/variant.js?1689693085></script>
<script>window.index_js_url="../en/index.search.js";var root_url="../",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://splunk.github.io/observability-workshop/v4.96/",window.variants&&variants.init(["splunk-light","splunk-dark","aws"])</script><style>@media screen and (min-width:1300px){#body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1300px;width:100%}}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../en/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Splunk Observability Workshops</span><meta itemprop=position content="1"></li></ol></div></div></nav><main id=body-inner class="highlightable home" tabindex=-1><div class=flex-block-wrapper><article class=home><header class=headline></header><h1 id=splunk-observability-workshops>Splunk Observability Workshops</h1><h2 id=welcome-to-the-splunk-observability-workshops>Welcome to the Splunk Observability Workshops</h2><p>Get insights into your applications and infrastructure in real-time with the help of the monitoring, analytics and response tools of the Splunk Observability Cloud</p><p>These workshops are going to take you through the best-in-class observability platform for ingesting, monitoring, visualizing and analyzing metrics, traces and logs.</p><p><a href=#image-2493c81e1f4f3759819f851778f1b5ed class=lightbox-link><img src=../en/images/observability-hero-dashboard.gif alt=gif style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2493c81e1f4f3759819f851778f1b5ed><img src=../en/images/observability-hero-dashboard.gif alt=gif class=lightbox-image loading=lazy></a></p><div class="box notices cstyle default" style=--VARIABLE-BOX-color:#4f62ad><div class=box-label><i class="fab fa-wpexplorer"></i> OpenTelemetry</div><div class=box-content><p><a href=https://opentelemetry.io target=_blank>OpenTelemetry</a> is used in this workshop to instrument, generate, collect and export telemetry data (metrics, traces and logs) to help you analyze your application and infrastructure.</p></div></div><div class="box notices cstyle default" style=--VARIABLE-BOX-color:#4078c0><div class=box-label><i class="fab fa-github"></i> GitHub</div><div class=box-content><p>You can <a href=https://github.com/splunk/observability-workshop target=_blank>contribute</a> to this documentation via issues and pull requests. Please don&rsquo;t hesitate to help to make the workshops better.</p></div></div><div class="box notices cstyle default" style=--VARIABLE-BOX-color:#1da1f2><div class=box-label><i class="fab fa-twitter"></i> Twitter</div><div class=box-content><p>You can find information about updates and interesting reads in the Twitter channel of <a href=https://twitter.com/splunk target=_blank>Splunk</a>.</p></div></div><div class="children children-h6 children-sort-"><h6><a href=../en/imt/index.html>Splunk IM</a></h6><p>Whether on-prem, hybrid or multicloud, Splunk delivers real-time monitoring and troubleshooting to help you maximize infrastructure performance with complete visibility.</p><h6><a href=../en/apm/index.html>Splunk APM</a></h6><p>Splunk APM is a NoSample‚Ñ¢ Full-fidelity application performance monitoring and troubleshooting solution for cloud-native, microservices-based applications.</p><h6><a href=../en/rum/index.html>Splunk RUM</a></h6><p>End-to-end visibility helps you pinpoint customer-impacting issues from web browsers and native mobile apps to your backend services.</p><h6><a href=../en/synthetics/index.html>Splunk Synthetics</a></h6><p>Proactively find and fix performance issues across user flows, business transactions and APIs to deliver better digital experiences.</p><h6><a href=../en/oncall/index.html>Splunk OnCall</a></h6><p>Make expensive service outages a thing of the past. Remediate issues faster, reduce on-call burnout and keep your services up and running.</p><h6><a href=../en/other/index.html>Other Workshops</a></h6><p>PetClinic Java WorkshopA workshop using Zero Configuration Auto-Instrumentation for Java
Getting Data In (GDI) with OTel and UF45 minutes During this technical workshop you will learn how to: Efficiently deploy complex environments Capture metrics from these environments to Splunk Observability Cloud Auto-instrument a python application Enable OS logging to Splunk Enterprise via Universal Forwarder In order to simplify the workshop modules, a pre-configured AWS EC2 instance is provided. By the end of this technical workshop you will have an approach to demonstrating metrics collection for complex environments and services.</p></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk Observability Workshops</h1><article class=default><header class=headline></header><h1 id=splunk-im>Splunk IM</h1><p>During this <em><strong>technical</strong></em> Splunk Observability Cloud Infrastructure Monitoring and APM Workshop you will build out an environment based on a <a href=https://k3s.io/ target=_blank>lightweight</a> Kubernetes<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> cluster.</p><p>In order to simplify the workshop modules, a pre-configured AWS/EC2 instance is provided.</p><p>The instance is pre-configured with all the software required to deploy the Splunk OpenTelemetery Connector<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> in Kubernetes, deploy a NGINX<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> ReplicaSet<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> and finally deploy a microservices based application which has been instrumented using OpenTelemetry to send metrics, traces, spans and logs<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>.</p><p>The workshops also introduce you to dashboards, editing and creating charts, creating detectors to fire alerts, Monitoring as Code and the Service Bureau<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></p><p>By the end of these technical workshops you will have a good understanding of some of the key features and capabilities of the Splunk Observability Cloud.</p><p>Here are the instructions on how to access you pre-configured <a href=../en/imt/./initial-setup/>AWS/EC2 instance</a></p><p><a href=#image-88d89306654ad831fe01db8a2c0eb709 class=lightbox-link><img src=../en/imt/images/architecture.png alt="Splunk Architecture" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-88d89306654ad831fe01db8a2c0eb709><img src=../en/imt/images/architecture.png alt="Splunk Architecture" class=lightbox-image loading=lazy></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/ target=_blank>Kubernetes</a> is a portable, extensible, open-source platform for managing containerized workloads and services, that facilitates both declarative configuration and automation.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>The OpenTelemetry Collector offers a vendor-agnostic implementation on how to receive, process and export telemetry data. In addition, it removes the need to run, operate and maintain multiple agents/collectors in order to support open-source telemetry data formats (e.g. Jaeger, Prometheus, etc.) sending to multiple open-source or commercial back-ends.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>NGINX is a web server that can also be used as a reverse proxy, load balancer, mail proxy and HTTP cache.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/ target=_blank>Kubernetes ReplicaSet</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>Jaeger, inspired by Dapper and OpenZipkin, is a distributed tracing system released as open source by Uber Technologies. It is used for monitoring and troubleshooting microservices-based distributed systems&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=https://www.splunk.com/en_us/blog/it/monitoring-observability-enterprise-service.html target=_blank>Monitoring as Code and Service Bureau</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk IM</h1><article class=default><header class=headline></header><h1 id=how-to-connect-to-your-workshop-environment>How to connect to your workshop environment</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
5 minutes ü•∑üèª</button></span><ol><li>How to retrieve the IP address of the AWS/EC2 instance assigned to you.</li><li>Connect to your instance using SSH, Putty<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> or your web browser.</li><li>Verify your connection to your AWS/EC2 cloud instance.</li><li>Using Putty (Optional)</li><li>Using Multipass (Optional)</li></ol><hr><h2 id=1-awsec2-ip-address>1. AWS/EC2 IP Address</h2><p>In preparation for the workshop, Splunk has prepared an Ubuntu Linux instance in AWS/EC2.</p><p>To get access to the instance that you will be using in the workshop please visit the URL to access the Google Sheet provided by the workshop leader.</p><p>Search for your AWS/EC2 instance by looking for your first and last name, as provided during registration for this workshop.</p><p><a href=#image-65e2e9b48ed99ebaedced3829684ba1b class=lightbox-link><img src=../en/imt/initial-setup/../images/spreadsheet-info.png alt="attendee spreadsheet" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-65e2e9b48ed99ebaedced3829684ba1b><img src=../en/imt/initial-setup/../images/spreadsheet-info.png alt="attendee spreadsheet" class=lightbox-image loading=lazy></a></p><p>Find your allocated IP address, SSH command (for Mac OS, Linux and the latest Windows versions) and password to enable you to connect to your workshop instance.</p><p>It also has the Browser Access URL that you can use in case you cannot connect via ssh or putty - see <a href=#4-web-browser-all>EC2 access via Web browser</a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Important</div><div class=box-content><p>Please use SSH or Putty to gain access to your EC2 instance if possible and
make a note of the IP address as you will need this during the workshop.</p></div></div><h2 id=2-ssh-mac-oslinux>2. SSH (Mac OS/Linux)</h2><p>Most attendees will be able to connect to the workshop by using SSH from their Mac or Linux device, or on Windows 10 and above.</p><p>To use SSH, open a terminal on your system and type <code>ssh ubuntu@x.x.x.x</code> (replacing x.x.x.x with the IP address found in Step #1).</p><p><a href=#image-6b3a3fd0fbfe3c45b22dca38892e0c31 class=lightbox-link><img src=../en/imt/initial-setup/../images/ssh-1.png alt="ssh login" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6b3a3fd0fbfe3c45b22dca38892e0c31><img src=../en/imt/initial-setup/../images/ssh-1.png alt="ssh login" class=lightbox-image loading=lazy></a></p><p>When prompted <strong><code>Are you sure you want to continue connecting (yes/no/[fingerprint])?</code></strong> please type <strong><code>yes</code></strong>.</p><p><a href=#image-0ba62b19bc67aef31a99cea9cebf984e class=lightbox-link><img src=../en/imt/initial-setup/../images/ssh-2.png alt="ssh password" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0ba62b19bc67aef31a99cea9cebf984e><img src=../en/imt/initial-setup/../images/ssh-2.png alt="ssh password" class=lightbox-image loading=lazy></a></p><p>Enter the password provided in the Google Sheet from Step #1.</p><p>Upon successful login you will be presented with the Splunk logo and the Linux prompt.</p><p><a href=#image-d50da32b8e4aab9132ff479679b92092 class=lightbox-link><img src=../en/imt/initial-setup/../images/ssh-3.png alt="ssh connected" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d50da32b8e4aab9132ff479679b92092><img src=../en/imt/initial-setup/../images/ssh-3.png alt="ssh connected" class=lightbox-image loading=lazy></a></p><h2 id=3-ssh-windows-10-and-above>3. SSH (Windows 10 and above)</h2><p>The procedure described above is the same on Windows 10, and the commands can be executed either in the Windows Command Prompt or PowerShell.
However, Windows regards its SSH Client as an &ldquo;optional feature&rdquo;, which might need to be enabled.</p><p>You can verify if SSH is enabled by simply executing <code>ssh</code></p><p>If you are shown a help text on how to use the ssh-command (like shown on the screenshot below), you are all set.</p><p><a href=#image-9f149a3d32709a84057aaf9f8c9f035c class=lightbox-link><img src=../en/imt/initial-setup/../images/windows-ssh-enabled-feedback.png alt="Windows SSH enabled" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9f149a3d32709a84057aaf9f8c9f035c><img src=../en/imt/initial-setup/../images/windows-ssh-enabled-feedback.png alt="Windows SSH enabled" class=lightbox-image loading=lazy></a></p><p>If the result of executing the command looks something like on the screenshot below, you want to enable the &ldquo;OpenSSH Client&rdquo; feature manually.</p><p><a href=#image-63515f690adb6271578b60cfa943c555 class=lightbox-link><img src=../en/imt/initial-setup/../images/windows-ssh-disabled-feedback.png alt="Windows SSH disabled" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-63515f690adb6271578b60cfa943c555><img src=../en/imt/initial-setup/../images/windows-ssh-disabled-feedback.png alt="Windows SSH disabled" class=lightbox-image loading=lazy></a></p><p>To do that, open the &ldquo;Settings&rdquo; menu, and click on &ldquo;Apps&rdquo;. While being in the &ldquo;Apps & features&rdquo; section, click on &ldquo;Optional features&rdquo;.</p><p><a href=#image-32d3c04465330d99b4b8cb6e6ec0e9b6 class=lightbox-link><img src=../en/imt/initial-setup/../images/windows-gui-optionalfeatures.png alt="Windows Apps Settings" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-32d3c04465330d99b4b8cb6e6ec0e9b6><img src=../en/imt/initial-setup/../images/windows-gui-optionalfeatures.png alt="Windows Apps Settings" class=lightbox-image loading=lazy></a></p><p>Here, you are presented a list of installed features. On the top, you see a button with a plus icon to &ldquo;Add a feature&rdquo;. Click it.
In the search input field, type &ldquo;OpenSSH&rdquo;, and find a feature called &ldquo;OpenSSH Client&rdquo;, or respectively, &ldquo;OpenSSH Client (Beta)&rdquo;, click on it, and click the &ldquo;Install&rdquo;-button.</p><p><a href=#image-25cc974f03b240dc9daaedbefaa15ffa class=lightbox-link><img src=../en/imt/initial-setup/../images/windows-enable-openssh-client.png alt="Windows Enable OpenSSH Client" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-25cc974f03b240dc9daaedbefaa15ffa><img src=../en/imt/initial-setup/../images/windows-enable-openssh-client.png alt="Windows Enable OpenSSH Client" class=lightbox-image loading=lazy></a></p><p>Now you are set! In case you are not able to access the provided instance in spite of enabling the OpenSSH feature, please do not shy away from reaching
out to the course instructor, either via chat or directly.</p><p>At this point you are ready to continue and <a href=../en/imt/initial-setup/../gdi/>start the workshop</a></p><hr><h2 id=4-putty-for-windows-versions-prior-to-windows-10>4. Putty (For Windows Versions prior to Windows 10)</h2><p>If you do not have ssh preinstalled or if you are on a Windows system, the best option is to install putty, you can find <a href=https://www.putty.org/ target=_blank>here.</a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Important</div><div class=box-content><p>If you <strong>cannot</strong> install Putty, please go to <a href=#4-web-browser-all>Web Browser (All)</a>.</p></div></div><p>Open Putty and enter the in <strong>Host Name (or IP address)</strong> field the IP address provided in the Google Sheet.</p><p>You can optionally save your settings by providing a name and pressing <strong>Save</strong>.</p><p><a href=#image-95198e75c502a4506c764375f5de8283 class=lightbox-link><img src=../en/imt/initial-setup/../images//putty-settings.png alt=putty-2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-95198e75c502a4506c764375f5de8283><img src=../en/imt/initial-setup/../images//putty-settings.png alt=putty-2 class=lightbox-image loading=lazy></a></p><p>To then login to your instance click on the <strong>Open</strong> button as shown above.</p><p>If this is the first time connecting to your AWS/EC2 workshop instance, you will be presented with a security dialog, please click <strong>Yes</strong>.</p><p><a href=#image-83971b9d77df038b6a25d0b09fe2c0ec class=lightbox-link><img src=../en/imt/initial-setup/../images//putty-security.png alt=putty-3 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-83971b9d77df038b6a25d0b09fe2c0ec><img src=../en/imt/initial-setup/../images//putty-security.png alt=putty-3 class=lightbox-image loading=lazy></a></p><p>Once connected, login in as <strong>ubuntu</strong> and the password is the one provided in the Google Sheet.</p><p>Once you are connected successfully you should see a screen similar to the one below:</p><p><a href=#image-41a6cb020827d425a2a5adf4127fcf2e class=lightbox-link><img src=../en/imt/initial-setup/../images//putty-loggedin.png alt=putty-4 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-41a6cb020827d425a2a5adf4127fcf2e><img src=../en/imt/initial-setup/../images//putty-loggedin.png alt=putty-4 class=lightbox-image loading=lazy></a></p><p>At this point you are ready to continue and <a href=../en/imt/initial-setup/../gdi/>start the workshop</a></p><hr><h2 id=5-web-browser-all>5. Web Browser (All)</h2><p>If you are blocked from using SSH (Port 22) or unable to install Putty you may be able to connect to the workshop instance by using a web browser.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>This assumes that access to port 6501 is not restricted by your company&rsquo;s firewall.</p></div></div><p>Open your web browser and type <strong><a href=http://x.x.x.x:6501 target=_blank>http://x.x.x.x:6501</a></strong> (where X.X.X.X is the IP address from the Google Sheet).</p><p><a href=#image-74bf7bf3e7a3e5e2b125394523decbe1 class=lightbox-link><img src=../en/imt/initial-setup/../images//shellinabox-url.png alt=http-6501 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-74bf7bf3e7a3e5e2b125394523decbe1><img src=../en/imt/initial-setup/../images//shellinabox-url.png alt=http-6501 class=lightbox-image loading=lazy></a></p><p>Once connected, login in as <strong>ubuntu</strong> and the password is the one provided in the Google Sheet.</p><p><a href=#image-144b1ff4bf2ac7ae0fa81bb14797c02d class=lightbox-link><img src=../en/imt/initial-setup/../images//shellinabox-connect.png alt=http-connect style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-144b1ff4bf2ac7ae0fa81bb14797c02d><img src=../en/imt/initial-setup/../images//shellinabox-connect.png alt=http-connect class=lightbox-image loading=lazy></a></p><p>Once you are connected successfully you should see a screen similar to the one below:</p><p><a href=#image-fdcda9d7349b72d27265e508249a30a7 class=lightbox-link><img src=../en/imt/initial-setup/../images//shellinabox-login.png alt="web login" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-fdcda9d7349b72d27265e508249a30a7><img src=../en/imt/initial-setup/../images//shellinabox-login.png alt="web login" class=lightbox-image loading=lazy></a></p><p>Unlike when you are using regular SSH, <em>copy and paste</em> does require a few extra steps to complete when using a browser session. This is due to cross browser restrictions.</p><p>When the workshop ask you to copy instructions into your terminal, please do the following:</p><p><em>Copy the instruction as normal, but when ready to paste it in the web terminal, choose <strong>Paste from browser</strong> as show below:</em></p><p><a href=#image-6cceb47b4a493168700d7440b63c9ab1 class=lightbox-link><img src=../en/imt/initial-setup/../images//shellinabox-paste-browser.png alt="web paste 1" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6cceb47b4a493168700d7440b63c9ab1><img src=../en/imt/initial-setup/../images//shellinabox-paste-browser.png alt="web paste 1" class=lightbox-image loading=lazy></a></p><p>This will open a dialog box asking for the text to be pasted into the web terminal:</p><p><a href=#image-59c9c21986395539dae7cf8f1270fe1f class=lightbox-link><img src=../en/imt/initial-setup/../images//shellinabox-example-1.png alt="web paste 3" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-59c9c21986395539dae7cf8f1270fe1f><img src=../en/imt/initial-setup/../images//shellinabox-example-1.png alt="web paste 3" class=lightbox-image loading=lazy></a></p><p>Paste the text in the text box as show, then press <strong>OK</strong> to complete the copy and paste process.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Unlike regular SSH connection, the web browser has a 60 second time out, and you will be disconnected, and a <strong>Connect</strong> button will be shown in the center of the web terminal.</p><p>Simply click the <strong>Connect</strong> button and you will be reconnected and will be able to continue.</p></div></div><p><a href=#image-831963e757e35352d580449f750fb7d7 class=lightbox-link><img src=../en/imt/initial-setup/../images//shellinabox-reconnect.png alt="web reconnect" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-831963e757e35352d580449f750fb7d7><img src=../en/imt/initial-setup/../images//shellinabox-reconnect.png alt="web reconnect" class=lightbox-image loading=lazy></a></p><p>At this point you are ready to continue and <a href=../en/imt/initial-setup/../gdi/>start the workshop</a>.</p><hr><h2 id=6-multipass-all>6. Multipass (All)</h2><p>If you are unable to access AWS, but you want to install software locally, follow the instructions for <a href=https://github.com/splunk/observability-workshop/blob/main/multipass/README.md target=_blank>using Multipass</a>.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://www.chiark.greenend.org.uk/~sgtatham/putty/ target=_blank>Download Putty</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=deploying-the-opentelemetry-collector-in-kubernetes>Deploying the OpenTelemetry Collector in Kubernetes</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
15 minutes</button></span><ul><li>Use the Splunk Helm chart to install the OpenTelemetry Collector in K3s</li><li>Explore your cluster in the Kubernetes Navigator</li></ul><hr><h2 id=1-obtain-access-token>1. Obtain Access Token</h2><p>You will need to obtain your Access Token<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> from the Splunk UI. You can find the workshop Access Token by clicking <strong>&#187;</strong> bottom left and then selecting <strong>Settings ‚Üí Access Tokens</strong>.</p><p>Expand the workshop token that your host has instructed you to use e.g. <strong>O11y-Workshop-ACCESS</strong>, then click on <strong>Show Token</strong> to expose your token. Click the
<span class="btn cstyle grey"><button type=button>
Copy</button></span> button to copy to clipboard. Please do not use the <strong>Default</strong> token!</p><p><a href=#image-8bd9fbf415f569c1842a7b0d714e24a9 class=lightbox-link><img src=../en/imt/gdi/../images/access-token.png alt="Access Token" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8bd9fbf415f569c1842a7b0d714e24a9><img src=../en/imt/gdi/../images/access-token.png alt="Access Token" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Please do not attempt to create your own token</div><div class=box-content><p>We have created a Token specifically for this workshop with the appropriate settings for the exercises you will be performing so have allocated it both Ingest and API Permissions. Best practice in production is to only allocate a single permission to a Token such as Ingest OR API OR RUM and use multiple Tokens where required.</p></div></div><p>You will also need to obtain the name of the Realm<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> for your Splunk account. At the top of the side menu, click on your name. This will direct you to the <strong>Account Settings</strong> Page. Click the <strong>Organizations</strong>-tab. The Realm can be found at the top of the displayed information in the tab. In this example it is <code>eu0</code>.</p><p><a href=#image-de1e4e953e46d1f3968597a40eadcc1c class=lightbox-link><img src=../en/imt/gdi/../images/account-settings.png alt="Account Settings" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-de1e4e953e46d1f3968597a40eadcc1c><img src=../en/imt/gdi/../images/account-settings.png alt="Account Settings" class=lightbox-image loading=lazy></a></p><h2 id=2-installation-using-helm>2. Installation using Helm</h2><p>Create the <code>ACCESS_TOKEN</code> and <code>REALM</code> environment variables to use in the proceeding Helm install command. For instance, if your realm is <code>us1</code>, you would type <code>export REALM=us1</code> and for <code>eu0</code> type <code>export REALM=eu0</code>.</p><div class=tab-panel data-tab-group=55e5affca09df801ea797b551a2a6a8f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export ACCESS TOKEN" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("55e5affca09df801ea797b551a2a6a8f","Export ACCESS TOKEN")'><div><div class=tab-nav-hidden>Export ACCESS TOKEN</div><div class=tab-nav-text>Export ACCESS TOKEN</div></div></button></div><div class=tab-content-container><div data-tab-item="Export ACCESS TOKEN" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_O11y-Workshop-ACCESS_TOKEN&gt;&#34;</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=4743236dc4d8d6421d7a478965860d36><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export REALM" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("4743236dc4d8d6421d7a478965860d36","Export REALM")'><div><div class=tab-nav-hidden>Export REALM</div><div class=tab-nav-text>Export REALM</div></div></button></div><div class=tab-content-container><div data-tab-item="Export REALM" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_REALM&gt;&#34;</span></span></span></code></pre></div></div></div></div></div><p>Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository to Helm and update.</p><div class=tab-panel data-tab-group=6865948be1de5ba0e6554db5e905a9d2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Helm Repo Add" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("6865948be1de5ba0e6554db5e905a9d2","Helm Repo Add")'><div><div class=tab-nav-hidden>Helm Repo Add</div><div class=tab-nav-text>Helm Repo Add</div></div></button>
<button data-tab-item="Helm Repo Add Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6865948be1de5ba0e6554db5e905a9d2","Helm Repo Add Output")'><div><div class=tab-nav-hidden>Helm Repo Add Output</div><div class=tab-nav-text>Helm Repo Add Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Helm Repo Add" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div data-tab-item="Helm Repo Add Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Using ACCESS_TOKEN={REDACTED}
Using REALM=eu0
&ldquo;splunk-otel-collector-chart&rdquo; has been added to your repositories
Using ACCESS_TOKEN={REDACTED}
Using REALM=eu0
Hang tight while we grab the latest from your chart repositories&mldr;
&mldr;Successfully got an update from the &ldquo;splunk-otel-collector-chart&rdquo; chart repository
Update Complete. ‚éàHappy Helming!‚éà</p></div></div></div></div><p>Install the OpenTelemetry Collector Helm chart with the following commands, do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=17f29af2138939703b660df9df78a6a0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Helm Install" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("17f29af2138939703b660df9df78a6a0","Helm Install")'><div><div class=tab-nav-hidden>Helm Install</div><div class=tab-nav-text>Helm Install</div></div></button>
<button data-tab-item="Helm Install Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("17f29af2138939703b660df9df78a6a0","Helm Install Output")'><div><div class=tab-nav-hidden>Helm Install Output</div><div class=tab-nav-text>Helm Install Output</div></div></button>
<button data-tab-item="Install Network Explorer" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("17f29af2138939703b660df9df78a6a0","Install Network Explorer")'><div><div class=tab-nav-hidden>Install Network Explorer</div><div class=tab-nav-text>Install Network Explorer</div></div></button></div><div class=tab-content-container><div data-tab-item="Helm Install" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.profilingEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-apm-env&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div><div data-tab-item="Helm Install Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Fri May  7 11:19:01 2021
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>TEST SUITE: None</span></span></code></pre></div></div></div><div data-tab-item="Install Network Explorer" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;networkExplorer.enabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;networkExplorer.podSecurityPolicy.enabled=false&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;agent.enabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;gateway.replicaCount=1&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;gateway.resources.limits.cpu=500m&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;gateway.resources.limits.memory=1Gi&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterReceiver.enabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-apm-env&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div></div></div><p>You can monitor the progress of the deployment by running <code>kubectl get pods</code> which should typically report a new pod is up and running after about 30 seconds.</p><p>Ensure the status is reported as Running before continuing.</p><div class=tab-panel data-tab-group=3e1a786a0495f70fbffb08a73c623a41><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Get Pods" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("3e1a786a0495f70fbffb08a73c623a41","Kubectl Get Pods")'><div><div class=tab-nav-hidden>Kubectl Get Pods</div><div class=tab-nav-text>Kubectl Get Pods</div></div></button>
<button data-tab-item="Kubectl Get Pods Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("3e1a786a0495f70fbffb08a73c623a41","Kubectl Get Pods Output")'><div><div class=tab-nav-hidden>Kubectl Get Pods Output</div><div class=tab-nav-text>Kubectl Get Pods Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Get Pods" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Get Pods Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-2sk6k                             0/1     Running   0          10s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6956d4446f-gwnd7   0/1     Running   0          10s</span></span></code></pre></div></div></div></div></div><p>Ensure there are no errors by tailing the logs from the OpenTelemetry Collector pod. Output should look similar to the log output shown in the Output tab below.</p><p>Use the label set by the <code>helm</code> install to tail logs (You will need to press <code>ctrl+c</code> to exit). Or use the installed <code>k9s</code> terminal UI for bonus points!</p><div class=tab-panel data-tab-group=c044a77085b36c03a47b0f37bd9a02b5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Logs" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c044a77085b36c03a47b0f37bd9a02b5","Kubectl Logs")'><div><div class=tab-nav-hidden>Kubectl Logs</div><div class=tab-nav-text>Kubectl Logs</div></div></button>
<button data-tab-item="Kubectl Logs Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c044a77085b36c03a47b0f37bd9a02b5","Kubectl Logs Output")'><div><div class=tab-nav-hidden>Kubectl Logs Output</div><div class=tab-nav-text>Kubectl Logs Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Logs" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Logs Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>2021-03-21T16:11:10.900Z INFO service/service.go:364 Starting receivers&mldr;
2021-03-21T16:11:10.900Z INFO builder/receivers_builder.go:70 Receiver is starting&mldr; {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;prometheus&rdquo;, &ldquo;component_name&rdquo;: &ldquo;prometheus&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:75 Receiver started. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;prometheus&rdquo;, &ldquo;component_name&rdquo;: &ldquo;prometheus&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:70 Receiver is starting&mldr; {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.009Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0>k8sclusterreceiver@v0.21.0</a>/watcher.go:195 Configured Kubernetes MetadataExporter {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;exporter_name&rdquo;: &ldquo;signalfx&rdquo;}
2021-03-21T16:11:11.009Z INFO builder/receivers_builder.go:75 Receiver started. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.009Z INFO healthcheck/handler.go:128 Health Check state change {&ldquo;component_kind&rdquo;: &ldquo;extension&rdquo;, &ldquo;component_type&rdquo;: &ldquo;health_check&rdquo;, &ldquo;component_name&rdquo;: &ldquo;health_check&rdquo;, &ldquo;status&rdquo;: &ldquo;ready&rdquo;}
2021-03-21T16:11:11.009Z INFO service/service.go:267 Everything is ready. Begin running and processing data.
2021-03-21T16:11:11.009Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0>k8sclusterreceiver@v0.21.0</a>/receiver.go:59 Starting shared informers and wait for initial cache sync. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}
2021-03-21T16:11:11.281Z INFO <a href=mailto:k8sclusterreceiver@v0.21.0>k8sclusterreceiver@v0.21.0</a>/receiver.go:75 Completed syncing shared informer caches. {&ldquo;component_kind&rdquo;: &ldquo;receiver&rdquo;, &ldquo;component_type&rdquo;: &ldquo;k8s_cluster&rdquo;, &ldquo;component_name&rdquo;: &ldquo;k8s_cluster&rdquo;}</p></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Deleting a failed installation</div><div class=box-content><p>If you make an error installing the OpenTelemetry Collector you can start over by deleting the installation using:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><hr><h2 id=3-validate-metrics-in-the-ui>3. Validate metrics in the UI</h2><p>In the Splunk UI, click the <strong>&#187;</strong> bottom left and click on <strong>Infrastructure</strong>.</p><p><a href=#image-dfd6e571541d1939248508b1a405c1f6 class=lightbox-link><img src=../en/imt/gdi/../images/clustermap-nav.png alt="Selecting the Kubernetes Navigator Map" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-dfd6e571541d1939248508b1a405c1f6><img src=../en/imt/gdi/../images/clustermap-nav.png alt="Selecting the Kubernetes Navigator Map" class=lightbox-image loading=lazy></a></p><p>Under <strong>Containers</strong> click on <strong>Kubernetes</strong> to open the Kubernetes Navigator Cluster Map to ensure metrics are being sent in.</p><p>Validate that your cluster is discovered and reporting by finding your cluster (in the workshop you will see many other clusters). To find your cluster name run the following command and copy the output to your clipboard:</p><div class=tab-panel data-tab-group=afa292ed2c2c1ee1f8e7ab44c077ff94><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Echo Cluster Name" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("afa292ed2c2c1ee1f8e7ab44c077ff94","Echo Cluster Name")'><div><div class=tab-nav-hidden>Echo Cluster Name</div><div class=tab-nav-text>Echo Cluster Name</div></div></button></div><div class=tab-content-container><div data-tab-item="Echo Cluster Name" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=k>$(</span>hostname<span class=k>)</span>-k3s-cluster</span></span></code></pre></div></div></div></div></div><p>Then in the UI, click on the &ldquo;Cluster: - " menu just below the Splunk Logo, and paste the Cluster name you just copied into the search box, click the box to select your cluster, and finally click off the menu into white space to apply the filter.</p><p><a href=#image-1d6ac16b8b45a120f54bbde96f55fbba class=lightbox-link><img src=../en/imt/gdi/../images/search-k3s-cluster.png alt="K8S Clusters Filter" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1d6ac16b8b45a120f54bbde96f55fbba><img src=../en/imt/gdi/../images/search-k3s-cluster.png alt="K8S Clusters Filter" class=lightbox-image loading=lazy></a></p><p><a href=#image-237dcbd594612799e423c0e9d4741d9f class=lightbox-link><img src=../en/imt/gdi/../images/selecting-k3s-cluster.png alt="Select K8S Cluster" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-237dcbd594612799e423c0e9d4741d9f><img src=../en/imt/gdi/../images/selecting-k3s-cluster.png alt="Select K8S Cluster" class=lightbox-image loading=lazy></a></p><p><a href=#image-21e65b43b66197b4c84a749cc7e8cc30 class=lightbox-link><img src=../en/imt/gdi/../images/filtered-k3s-cluster.png alt="Filtered K8S Cluster" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-21e65b43b66197b4c84a749cc7e8cc30><img src=../en/imt/gdi/../images/filtered-k3s-cluster.png alt="Filtered K8S Cluster" class=lightbox-image loading=lazy></a></p><p>To examine the health of your node, hover over the pale blue background of your cluster, then click on the blue magnifying glass
<a href=#image-aa71c4ef3535156242d81b1e58bfa40b class=lightbox-link><img src="../en/imt/gdi/../images/blue-cross.png?classes=inline&height=25px" alt="Magnifying Glass" class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-aa71c4ef3535156242d81b1e58bfa40b><img src="../en/imt/gdi/../images/blue-cross.png?classes=inline&height=25px" alt="Magnifying Glass" class=lightbox-image loading=lazy></a> that appears in the top left hand corner.</p><p>This will drill down to the node level. Next, open the side bar by clicking on the side bar button to open the Metrics side bar.</p><p>Once it is open, you can use the slider on the side to explore the various charts relevant to your cluster/node: CPU, Memory, Network, Events etc.</p><p><a href=#image-6083dfb5f3e6d3701b9cffc0f40d2249 class=lightbox-link><img src=../en/imt/gdi/../images/explore-metrics.png alt="Sidebar metrics" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6083dfb5f3e6d3701b9cffc0f40d2249><img src=../en/imt/gdi/../images/explore-metrics.png alt="Sidebar metrics" class=lightbox-image loading=lazy></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Access Tokens (sometimes called Org Tokens) are long-lived organization-level tokens. By default, these tokens persist for 5 years, and thus are suitable for embedding into emitters that send data points over long periods of time, or for any long-running scripts that call the Splunk API.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>A realm is a self-contained deployment of Splunk in which your Organization is hosted. Different realms have different API endpoints (e.g. the endpoint for sending data is <code>ingest.us1.signalfx.com</code> for the <strong><code>us1</code></strong> realm, and <code>ingest.eu0.signalfx.com</code> for the <strong><code>eu0</code></strong> realm). This realm name is shown on your profile page in the Splunk UI. If you do not include the realm name when specifying an endpoint, Splunk will interpret it as pointing to the <strong><code>us0</code></strong> realm.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Deploying the OpenTelemetry Collector in Kubernetes</h1><article class=default><header class=headline></header><h1 id=deploying-nginx-in-k3s>Deploying NGINX in K3s</h1><ul><li>Deploy a NGINX ReplicaSet into your K3s cluster and confirm the discovery of your NGINX deployment.</li><li>Run a load test to create metrics and confirm them streaming into Splunk Observability Cloud!</li></ul><hr><h2 id=1-start-your-nginx>1. Start your NGINX</h2><p>Verify the number of pods running in the Splunk UI by selecting the <strong>WORKLOADS</strong> tab. This should give you an overview of the workloads on your cluster.</p><p><a href=#image-48d73e87e72fd06583e156e60c54c29e class=lightbox-link><img src=../en/imt/gdi/nginx/../../images/k8s-workloads.png alt="Workload Agent" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-48d73e87e72fd06583e156e60c54c29e><img src=../en/imt/gdi/nginx/../../images/k8s-workloads.png alt="Workload Agent" class=lightbox-image loading=lazy></a></p><p>Note the single agent container running per node among the default Kubernetes pods. This single container will monitor all the pods and services being deployed on this node!</p><p>Now switch back to the default cluster node view by selecting the <strong>MAP</strong> tab and select your cluster again.</p><p>In your AWS/EC2 or Multipass shell session change into the <code>nginx</code> directory:</p><div class=tab-panel data-tab-group=08674a11ab18c5563d3c4dda952d2564><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Change Directory" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("08674a11ab18c5563d3c4dda952d2564","Change Directory")'><div><div class=tab-nav-hidden>Change Directory</div><div class=tab-nav-text>Change Directory</div></div></button></div><div class=tab-content-container><div data-tab-item="Change Directory" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/k3s/nginx</span></span></code></pre></div></div></div></div></div><hr><h2 id=2-create-nginx-deployment>2. Create NGINX deployment</h2><p>Create the NGINX ConfigMap<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> using the <code>nginx.conf</code> file:</p><div class=tab-panel data-tab-group=cfedf76601abf9d0b06e4a94cbb63699><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Configmap Create" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("cfedf76601abf9d0b06e4a94cbb63699","Kubectl Configmap Create")'><div><div class=tab-nav-hidden>Kubectl Configmap Create</div><div class=tab-nav-text>Kubectl Configmap Create</div></div></button>
<button data-tab-item="Kubectl Create Configmap Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("cfedf76601abf9d0b06e4a94cbb63699","Kubectl Create Configmap Output")'><div><div class=tab-nav-hidden>Kubectl Create Configmap Output</div><div class=tab-nav-text>Kubectl Create Configmap Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Configmap Create" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create configmap nginxconfig --from-file<span class=o>=</span>nginx.conf</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Create Configmap Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>configmap/nginxconfig created</p></div></div></div></div><p>Then create the deployment:</p><div class=tab-panel data-tab-group=509615dc156ce06372f6f00e55f64bea><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Create Deployment" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("509615dc156ce06372f6f00e55f64bea","Kubectl Create Deployment")'><div><div class=tab-nav-hidden>Kubectl Create Deployment</div><div class=tab-nav-text>Kubectl Create Deployment</div></div></button>
<button data-tab-item="Kubectl Create Deployment Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("509615dc156ce06372f6f00e55f64bea","Kubectl Create Deployment Output")'><div><div class=tab-nav-hidden>Kubectl Create Deployment Output</div><div class=tab-nav-text>Kubectl Create Deployment Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Create Deployment" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f nginx-deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Create Deployment Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>deployment.apps/nginx created
service/nginx created</p></div></div></div></div><p>Next we will deploy Locust<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> which is an open source tool used for creating a load test against NGINX:</p><div class=tab-panel data-tab-group=2bf37cfb7f09337c7191aba2af103e5d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Create Deployment" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("2bf37cfb7f09337c7191aba2af103e5d","Kubectl Create Deployment")'><div><div class=tab-nav-hidden>Kubectl Create Deployment</div><div class=tab-nav-text>Kubectl Create Deployment</div></div></button>
<button data-tab-item="Kubectl Create Deployment Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("2bf37cfb7f09337c7191aba2af103e5d","Kubectl Create Deployment Output")'><div><div class=tab-nav-hidden>Kubectl Create Deployment Output</div><div class=tab-nav-text>Kubectl Create Deployment Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Create Deployment" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f locust-deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Create Deployment Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>deployment.apps/nginx-loadgenerator created
service/nginx-loadgenerator created</p></div></div></div></div><p>Validate the deployment has been successful and that the Locust and NGINX pods are running.</p><p>If you have the Splunk UI open you should see new Pods being started and containers being deployed.</p><p>It should only take around 20 seconds for the pods to transition into a Running state. In the Splunk UI you will have a cluster that looks like below:</p><p><a href=#image-1bb4a4ec22e7e795c86c0b34fa1b86ed class=lightbox-link><img src=../en/imt/gdi/nginx/../../images/cluster.png alt="back to Cluster" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1bb4a4ec22e7e795c86c0b34fa1b86ed><img src=../en/imt/gdi/nginx/../../images/cluster.png alt="back to Cluster" class=lightbox-image loading=lazy></a></p><p>If you select the <strong>WORKLOADS</strong> tab again you will now see that there is a new ReplicaSet and a deployment added for NGINX:</p><p><a href=#image-0d8084995f75bbc5be0968fde94680ef class=lightbox-link><img src=../en/imt/gdi/nginx/../../images/k8s-workloads-nginx.png alt="NGINX loaded" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0d8084995f75bbc5be0968fde94680ef><img src=../en/imt/gdi/nginx/../../images/k8s-workloads-nginx.png alt="NGINX loaded" class=lightbox-image loading=lazy></a></p><hr><p>Let&rsquo;s validate this in your shell as well:</p><div class=tab-panel data-tab-group=457f36332e459c4aea5b0ce030dace6a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Kubectl Get Pods" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("457f36332e459c4aea5b0ce030dace6a","Kubectl Get Pods")'><div><div class=tab-nav-hidden>Kubectl Get Pods</div><div class=tab-nav-text>Kubectl Get Pods</div></div></button>
<button data-tab-item="Kubectl Get Pods Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("457f36332e459c4aea5b0ce030dace6a","Kubectl Get Pods Output")'><div><div class=tab-nav-hidden>Kubectl Get Pods Output</div><div class=tab-nav-text>Kubectl Get Pods Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Kubectl Get Pods" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item="Kubectl Get Pods Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>NAME READY STATUS RESTARTS AGE
splunk-otel-collector-k8s-cluster-receiver-77784c659c-ttmpk 1/1 Running 0 9m19s
splunk-otel-collector-agent-249rd 1/1 Running 0 9m19s
svclb-nginx-vtnzg 1/1 Running 0 5m57s
nginx-7b95fb6b6b-7sb9x 1/1 Running 0 5m57s
nginx-7b95fb6b6b-lnzsq 1/1 Running 0 5m57s
nginx-7b95fb6b6b-hlx27 1/1 Running 0 5m57s
nginx-7b95fb6b6b-zwns9 1/1 Running 0 5m57s
svclb-nginx-loadgenerator-nscx4 1/1 Running 0 2m20s
nginx-loadgenerator-755c8f7ff6-x957q 1/1 Running 0 2m20s</p></div></div></div></div><hr><h2 id=3-run-locust-load-test>3. Run Locust load test</h2><p>Locust, an open source load generator, is available on port 8080 of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and go to <code>http://{==EC2-IP==}:8080/</code>, you will then be able to see the Locust running.</p><p><a href=#image-5fc35dc83751a406100a86bb00c45557 class=lightbox-link><img src=../en/imt/gdi/nginx/../../images/nginx-locust.png alt=Locust style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5fc35dc83751a406100a86bb00c45557><img src=../en/imt/gdi/nginx/../../images/nginx-locust.png alt=Locust class=lightbox-image loading=lazy></a></p><p>Set the <strong>Spawn rate</strong> to be 2 and click <strong>Start Swarming</strong>.</p><p><a href=#image-9ecd699eab72300cd975b32411e9dc70 class=lightbox-link><img src=../en/imt/gdi/nginx/../../images/nginx-locust-spawn-rate.png alt="Locust Spawn Rate" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9ecd699eab72300cd975b32411e9dc70><img src=../en/imt/gdi/nginx/../../images/nginx-locust-spawn-rate.png alt="Locust Spawn Rate" class=lightbox-image loading=lazy></a></p><p>This will start a gentle continuous load on the application.</p><p><a href=#image-93f3759d845e42d45eaff3f03f9991b1 class=lightbox-link><img src=../en/imt/gdi/nginx/../../images/nginx-locust-statistics.png alt="Locust Statistics" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-93f3759d845e42d45eaff3f03f9991b1><img src=../en/imt/gdi/nginx/../../images/nginx-locust-statistics.png alt="Locust Statistics" class=lightbox-image loading=lazy></a></p><p>As you can see from the above screenshot, most of the calls will report a fail, this is expected, as we have not yet deployed the application behind it, however NGINX is reporting on your attempts and you should be able to see those metrics.</p><p>Validate you are seeing those metrics in the UI by selecting <strong>Dashboards ‚Üí Built-in Dashboard Groups ‚Üí NGINX ‚Üí NGINX Servers</strong>. Using the <strong>Overrides</strong> filter on <code>k8s.cluster.name:</code>, find the name of your cluster as returned by <code>echo $(hostname)-k3s-cluster</code> in the terminal.</p><p><a href=#image-be0f1f22b9d7d5e699f684de123bd821 class=lightbox-link><img src=../en/imt/gdi/nginx/../../images/nginx-dashboard.png alt="NGINX Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-be0f1f22b9d7d5e699f684de123bd821><img src=../en/imt/gdi/nginx/../../images/nginx-dashboard.png alt="NGINX Dashboard" class=lightbox-image loading=lazy></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A ConfigMap is an API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or as configuration files in a volume. A ConfigMap allows you to decouple environment-specific configuration from your container images, so that your applications are easily portable.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://locust.io/ target=_blank>What is Locust?</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=working-with-dashboards>Working with Dashboards</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
20 minutes</button></span><ul><li>Introduction to the Dashboards and charts</li><li>Editing and creating charts</li><li>Filtering and analytical functions</li><li>Using formulas</li><li>Saving charts in a dashboard</li><li>Introduction to SignalFlow</li></ul><hr><h2 id=1-dashboards>1. Dashboards</h2><p>Dashboards are groupings of charts and visualizations of metrics. Well-designed dashboards can provide useful and actionable insight into your system at a glance. Dashboards can be complex or contain just a few charts that drill down only into the data you want to see.</p><p>During this module we are going to create the following charts and dashboard and connect it to your Team page.</p><p><a href=#image-3f72cae36d489aab06e30ead04efa74e class=lightbox-link><img src=../en/imt/dashboards/../images/example-dashboard.png alt="Example Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-3f72cae36d489aab06e30ead04efa74e><img src=../en/imt/dashboards/../images/example-dashboard.png alt="Example Dashboard" class=lightbox-image loading=lazy></a></p><hr><h2 id=2-your-teams-page>2. Your Teams&rsquo; Page</h2><p>Click on the
<a href=#image-8dd6694225e45cc3e9fdcd98ac811af3 class=lightbox-link><img src="../en/imt/dashboards/../images/dashboards.png?classes=inline&height=25px" alt="dashboards button" class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8dd6694225e45cc3e9fdcd98ac811af3><img src="../en/imt/dashboards/../images/dashboards.png?classes=inline&height=25px" alt="dashboards button" class=lightbox-image loading=lazy></a> from the navbar. As you have already been assigned to a team, you will land on the team dashboard. We use the <em><strong>Example Team</strong></em> as an example here. The one in your workshop will be different!</p><p><a href=#image-6182ff097be08ffe89c85aba28f8a446 class=lightbox-link><img src=../en/imt/dashboards/../images/team-dashboard.png alt="Team Dashboard1" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6182ff097be08ffe89c85aba28f8a446><img src=../en/imt/dashboards/../images/team-dashboard.png alt="Team Dashboard1" class=lightbox-image loading=lazy></a></p><p>This page shows the total number of team members, how many active alerts for your team and all dashboards that are assigned to your team. Right now they are no dashboards assigned but as stated before, we will add the new dashboard that you will create to your Teams page later.</p><hr><h2 id=3-sample-charts>3. Sample Charts</h2><p>To continue, click on <strong>All Dashboards</strong> on the top right corner of the screen.
This brings you to the view that shows all the available dashboards, including the pre-built ones.</p><p><a href=#image-cd18480b9785b0fef98a64961e4a0351 class=lightbox-link><img src=../en/imt/dashboards/../images/sample-data.png alt="Sample Data" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cd18480b9785b0fef98a64961e4a0351><img src=../en/imt/dashboards/../images/sample-data.png alt="Sample Data" class=lightbox-image loading=lazy></a></p><p>If you are already receiving metrics from a Cloud API integration or another service through the Splunk Agent you will see relevant dashboards for these services.</p><hr><h2 id=4-inspecting-the-sample-data>4. Inspecting the Sample Data</h2><p>Among the dashboards you will see a Dashboard group called <strong>Sample Data</strong>. Expand the <strong>Sample Data</strong> dashboard group by clicking on it, and then click on the <strong>Sample Charts</strong> dashboard.</p><p>In the Sample Charts dashboard you can see a selection of charts that show a sample of the various styles, colors and formats you can apply to your charts in the dashboards.</p><p>Have a look through all the dashboards in this dashboard group (<strong>PART 1</strong>, <strong>PART 2</strong>, <strong>PART 3</strong> and <strong>INTRO TO SPLUNK OBSERVABILITY CLOUD</strong>)</p><p><a href=#image-8cf02b1071e59023d8964ec6f1791cc7 class=lightbox-link><img src=../en/imt/dashboards/../images/sample-charts.png alt="Sample Charts" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8cf02b1071e59023d8964ec6f1791cc7><img src=../en/imt/dashboards/../images/sample-charts.png alt="Sample Charts" class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Working with Dashboards</h1><article class=default><header class=headline></header><h1 id=editing-charts>Editing charts</h1><h2 id=1-editing-a-chart>1. Editing a chart</h2><p>Select the <strong>SAMPLE CHARTS</strong> dashboard and then click on the three dots <strong><code>...</code></strong> on the <strong>Latency histogram</strong> chart, then on <strong>Open</strong> (or you can click on the name of the chart which here is <strong>Latency histogram</strong>).</p><p><a href=#image-a4708063678da9e9a103bb14016c564a class=lightbox-link><img src=../en/imt/dashboards/editing/../../images/latency-histogram-open.png alt="Sample Charts" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a4708063678da9e9a103bb14016c564a><img src=../en/imt/dashboards/editing/../../images/latency-histogram-open.png alt="Sample Charts" class=lightbox-image loading=lazy></a></p><p>You will see the plot options, current plot and signal (metric) for the <strong>Latency histogram</strong> chart in the chart editor UI.</p><p><a href=#image-cbcf634dd6fd9b0b16f90d39ea5889db class=lightbox-link><img src=../en/imt/dashboards/editing/../../images/latency-histogram.png alt="Latency Histogram" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cbcf634dd6fd9b0b16f90d39ea5889db><img src=../en/imt/dashboards/editing/../../images/latency-histogram.png alt="Latency Histogram" class=lightbox-image loading=lazy></a></p><p>In the <strong>Plot Editor</strong> tab under <strong>Signal</strong> you see the metric <strong><code>demo.trans.latency</code></strong> we are currently plotting.</p><p><a href=#image-5565ba6169398492d7cea99ac2ef8360 class=lightbox-link><img src=../en/imt/dashboards/editing/../../images/plot-editor.png alt="Plot Editor" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5565ba6169398492d7cea99ac2ef8360><img src=../en/imt/dashboards/editing/../../images/plot-editor.png alt="Plot Editor" class=lightbox-image loading=lazy></a></p><p>You will see a number of <strong>Line</strong> plots. The number <strong><code>18 ts</code></strong> indicates that we are plotting 18 metric time series in the chart.</p><p>Click on the different chart type icons to explore each of the visualizations. Notice their name while you swipe over them. For example, click on the Heat Map icon:</p><p><a href=#image-026c7a4f23dad61c07ab9aaf42328320 class=lightbox-link><img src=../en/imt/dashboards/editing/../../images/M-Editing-2.png alt="Chart Types" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-026c7a4f23dad61c07ab9aaf42328320><img src=../en/imt/dashboards/editing/../../images/M-Editing-2.png alt="Chart Types" class=lightbox-image loading=lazy></a></p><p>See how the chart changes to a heat map.</p><p><a href=#image-84a1731ce8b6fa5346ec633f76952321 class=lightbox-link><img src=../en/imt/dashboards/editing/../../images/change-to-heatmap.png alt="Change to Heatmap" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-84a1731ce8b6fa5346ec633f76952321><img src=../en/imt/dashboards/editing/../../images/change-to-heatmap.png alt="Change to Heatmap" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>You can use different charts to visualize your metrics - you choose which chart type fits best for the visualization you want to have.</p><p>For more info on the different chart types see <a href=https://docs.splunk.com/Observability/data-visualization/charts/chart-types.html#chart-types target=_blank>Choosing a chart type.</a></p></div></div><p>Click on the <strong>Line</strong> chart type and you will see the line plot.</p><p><a href=#image-38520a3ec2da1942cdf24050c0490728 class=lightbox-link><img src=../en/imt/dashboards/editing/../../images/M-Editing-3b.png alt="Line Chart" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-38520a3ec2da1942cdf24050c0490728><img src=../en/imt/dashboards/editing/../../images/M-Editing-3b.png alt="Line Chart" class=lightbox-image loading=lazy></a></p><h2 id=2-changing-the-time-window>2. Changing the time window</h2><p>You can also increase the time window of the chart by changing the time to <strong>Past 15 minutes</strong> by selecting from the <strong>Time</strong> dropdown.</p><p><a href=#image-0b8d92db82a989a146c31ed01de66611 class=lightbox-link><img src=../en/imt/dashboards/editing/../../images/line-chart.png alt="Line Chart" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0b8d92db82a989a146c31ed01de66611><img src=../en/imt/dashboards/editing/../../images/line-chart.png alt="Line Chart" class=lightbox-image loading=lazy></a></p><h2 id=3-viewing-the-data-table>3. Viewing the Data Table</h2><p>Click on the <strong>Data Table</strong> tab.</p><p><a href=#image-fbc070b9ce802b19781bfd9b721dd165 class=lightbox-link><img src=../en/imt/dashboards/editing/../../images/data-table.png alt="Data Table" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-fbc070b9ce802b19781bfd9b721dd165><img src=../en/imt/dashboards/editing/../../images/data-table.png alt="Data Table" class=lightbox-image loading=lazy></a></p><p>You now see 18 rows, each representing a metric time series with a number of columns. These columns represent the dimensions of the metric. The dimensions for <code>demo.trans.latency</code> are:</p><ul><li><code>demo_datacenter</code></li><li><code>demo_customer</code></li><li><code>demo_host</code></li></ul><p>In the <strong><code>demo_datacenter</code></strong> column you see that there are two data centers, <strong>Paris</strong> and <strong>Tokyo</strong>, for which we are getting metrics.</p><p>If you move your cursor over the lines in the chart horizontally you will see the data table update accordingly. If you click on one of the lines in the chart you will see a pinned value appear in the data table.</p><hr><p>Now click on <strong>Plot editor</strong> again to close the Data Table and let&rsquo;s save this chart into a dashboard for later use!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=saving-charts>Saving charts</h1><h2 id=1-saving-a-chart>1. Saving a chart</h2><p>To start saving your chart, lets give it a name and description. Click the name of the chart <strong>Copy of Latency Histogram</strong> and rename it to <strong>&ldquo;Active Latency&rdquo;</strong>.</p><p>To change the description click on <strong>Spread of latency values across time.</strong> and change this to <strong>Overview of latency values in real-time.</strong></p><p><a href=#image-4d81a9ecf91a068ff5c08a397b734cc4 class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/save-chart.png alt="Save Chart" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4d81a9ecf91a068ff5c08a397b734cc4><img src=../en/imt/dashboards/savingcharts/../../images/save-chart.png alt="Save Chart" class=lightbox-image loading=lazy></a></p><p>Click the
<span class="btn cstyle blue"><button type=button>
Save As</button></span> button. Make sure your chart has a name, it will use the name <strong>Active Latency</strong> the you defined in the previous step, but you can edit it here if needed.</p><p>Press the
<span class="btn cstyle blue"><button type=button>
Ok</button></span>
button to continue.</p><p><a href=#image-fed58d91a0055b16dc53c7055282b95a class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/name-chart.png alt="Name Chart" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-fed58d91a0055b16dc53c7055282b95a><img src=../en/imt/dashboards/savingcharts/../../images/name-chart.png alt="Name Chart" class=lightbox-image loading=lazy></a></p><h2 id=2-creating-a-dashboard>2. Creating a dashboard</h2><p>In the <strong>Choose dashboard</strong> dialog, we need to create a new dashboard, click on the
<span class="btn cstyle blue"><button type=button>
New Dashboard</button></span>
button.</p><p><a href=#image-4c080cf5deb9622ff208aae8d2420200 class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/create-dashboard.png alt="Create Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4c080cf5deb9622ff208aae8d2420200><img src=../en/imt/dashboards/savingcharts/../../images/create-dashboard.png alt="Create Dashboard" class=lightbox-image loading=lazy></a></p><p>You will now see the <strong>New Dashboard</strong> Dialog. In here you can give you dashboard a name and description, and set <strong>Read and Write Permissions</strong>.</p><p>Please use your own name in the following format to give your dashboard a name e.g. <strong>YOUR_NAME-Dashboard</strong>.</p><p>Please replace <strong>YOUR_NAME</strong> with your own name, change the dashboard permissions to <em>Restricted Read and Write access</em>, and verify your user can read/write.</p><p><a href=#image-7897eb0cba3a0431ec03a58d44a5912a class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/name-dashboard.png alt="Name Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7897eb0cba3a0431ec03a58d44a5912a><img src=../en/imt/dashboards/savingcharts/../../images/name-dashboard.png alt="Name Dashboard" class=lightbox-image loading=lazy></a></p><p>You should see you own login information displayed, meaning you are now the only one who can edit this dashboard. Of course you have the option to add other users or teams from the drop box below that may edit your dashboard and charts, but for now make sure you change it back to <em>Everyone can Read or Write</em> to remove any restrictions and press the
<span class="btn cstyle blue"><button type=button>
Save</button></span>
Button to continue.</p><p>Your new dashboard is now available and selected so you can save your chart in your new dashboard.</p><p><a href=#image-80da43b66c6d1c5106ba783fcc56b326 class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/choose-dashboard.png alt="Choose Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-80da43b66c6d1c5106ba783fcc56b326><img src=../en/imt/dashboards/savingcharts/../../images/choose-dashboard.png alt="Choose Dashboard" class=lightbox-image loading=lazy></a></p><p>Make sure you have your dashboard selected and press the
<span class="btn cstyle blue"><button type=button>
Ok</button></span> button.</p><p>You will now be taken to your dashboard like below. You can see at the top left that your <strong>YOUR_NAME-DASHBOARD</strong> is part of a Dashboard Group <strong>YOUR_NAME-Dashboard</strong>. You can add other dashboards to this dashboard group.</p><p><a href=#image-e217edab2f9a90ae3e5202bb48f1b4f3 class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/new-dashboard-group.png alt="New Dashboard Group" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e217edab2f9a90ae3e5202bb48f1b4f3><img src=../en/imt/dashboards/savingcharts/../../images/new-dashboard-group.png alt="New Dashboard Group" class=lightbox-image loading=lazy></a></p><hr><h2 id=3-add-to-team-page>3. Add to Team page</h2><p>It is common practice to link dashboards that are relevant to a Team to a teams page. So let&rsquo;s add your dashboard to the team page for easy access later. Use the
<a href=#image-211ebd62dfd1742b3f586d033c6d03d1 class=lightbox-link><img src="../en/imt/dashboards/savingcharts/../../images/dashboards.png?classes=inline&height=25px" alt="dashboards button" class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-211ebd62dfd1742b3f586d033c6d03d1><img src="../en/imt/dashboards/savingcharts/../../images/dashboards.png?classes=inline&height=25px" alt="dashboards button" class=lightbox-image loading=lazy></a> from the navbar again.</p><p>This will bring you to your teams dashboard, We use the team <em><strong>Example Team</strong></em> as an example here, the workshop one will be different.</p><p><a href=#image-3979140d9910ed1aaec9d905705762eb class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/team-dashboard.png alt="Team Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-3979140d9910ed1aaec9d905705762eb><img src=../en/imt/dashboards/savingcharts/../../images/team-dashboard.png alt="Team Dashboard" class=lightbox-image loading=lazy></a></p><p>Press the
<span class="btn cstyle white"><button type=button>
+</button></span> <em>Add Dashboard Group</em> button to add you dashboard to the team page.</p><p>This will bring you to the <strong>Select a dashboard group to link to this team</strong> dialog.
Type your name (that you used above) in the search box to find your Dashboard. Select it so its highlighted and click the <strong>Ok</strong> button to add your dashboard.</p><p><a href=#image-e53cc18318157401aa7ee6f2e305e0d9 class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/select-dashboard-group.png alt="Select Dashboard Group" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e53cc18318157401aa7ee6f2e305e0d9><img src=../en/imt/dashboards/savingcharts/../../images/select-dashboard-group.png alt="Select Dashboard Group" class=lightbox-image loading=lazy></a></p><p>Your dashboard group will appear as part of the team page. Please note during the course of the workshop many more will appear here.</p><p><a href=#image-6df523d922f9635a2abed55b2d4ccb5c class=lightbox-link><img src=../en/imt/dashboards/savingcharts/../../images/new-team-dashboard.png alt="New Team Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6df523d922f9635a2abed55b2d4ccb5c><img src=../en/imt/dashboards/savingcharts/../../images/new-team-dashboard.png alt="New Team Dashboard" class=lightbox-image loading=lazy></a></p><hr><p>Now click on the link for your Dashboard to add more charts!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=33-using-filters--formulas>3.3 Using Filters & Formulas</h1><h2 id=1-creating-a-new-chart>1 Creating a new chart</h2><p>Let&rsquo;s now create a new chart and save it in our dashboard!</p><p>Select the plus icon (top right of the UI) and from the drop down, choose the option <strong>Chart</strong>.
Or click on the
<span class="btn cstyle blue"><button type=button>
+ New Chart</button></span> Button to create a new chart.</p><p><a href=#image-8869d2fe47d4610aebc11b2629318015 class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-0.png alt="Create new chart" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8869d2fe47d4610aebc11b2629318015><img src=../en/imt/dashboards/filtering/../../images/M-Filter-0.png alt="Create new chart" class=lightbox-image loading=lazy></a></p><p>You will now see a chart template like the following.</p><p><a href=#image-59f3549c344ebf26be4b46af69164de0 class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Editing-6.png alt="Empty Chart" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-59f3549c344ebf26be4b46af69164de0><img src=../en/imt/dashboards/filtering/../../images/M-Editing-6.png alt="Empty Chart" class=lightbox-image loading=lazy></a></p><p>Let&rsquo;s enter a metric to plot. We are still going to use the metric <strong><code>demo.trans.latency</code></strong>.</p><p>In the <strong>Plot Editor</strong> tab under <strong>Signal</strong> enter <strong><code>demo.trans.latency</code></strong>.</p><p><a href=#image-c47dc864b92c7fd7eaa88157d124863d class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/plot-editor.png alt=Signal style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c47dc864b92c7fd7eaa88157d124863d><img src=../en/imt/dashboards/filtering/../../images/plot-editor.png alt=Signal class=lightbox-image loading=lazy></a></p><p>You should now have a familiar line chart. Please switch the time to 15 mins.</p><p><a href=#image-07941f1fbd0bd23b67c3bf16ca85a8d6 class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-10.png alt=Signal style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-07941f1fbd0bd23b67c3bf16ca85a8d6><img src=../en/imt/dashboards/filtering/../../images/M-Filter-10.png alt=Signal class=lightbox-image loading=lazy></a></p><h2 id=2-filtering-and-analytics>2. Filtering and Analytics</h2><p>Let&rsquo;s now select the <strong>Paris</strong> datacenter to do some analytics - for that we will use a filter.</p><p>Let&rsquo;s go back to the <strong>Plot Editor</strong> tab and click on
<span class="btn cstyle blue"><button type=button>
Add Filter</button></span>
, wait until it automatically populates, choose <strong><code>demo_datacenter</code></strong>, and then <strong><code>Paris</code></strong>.</p><p><a href=#image-d0ebb9a62cfd36a0ea5db51960ed75ae class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-1.png alt=Filter style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d0ebb9a62cfd36a0ea5db51960ed75ae><img src=../en/imt/dashboards/filtering/../../images/M-Filter-1.png alt=Filter class=lightbox-image loading=lazy></a></p><p>In the <strong>F(x)</strong> column, add the analytic function <strong><code>Percentile:Aggregation</code></strong>, and leave the value to <strong><code>95</code></strong> (click outside to confirm).</p><p><a href=#image-686eb0dfb694b77c975b7c42a27c4712 class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-2.png alt=Analytics style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-686eb0dfb694b77c975b7c42a27c4712><img src=../en/imt/dashboards/filtering/../../images/M-Filter-2.png alt=Analytics class=lightbox-image loading=lazy></a></p><p>For info on the <strong>Percentile</strong> function and the other functions see <a href=https://docs.splunk.com/Observability/data-visualization/charts/gain-insights-through-chart-analytics.html#gain-insights-through-chart-analytics target=_blank>Chart Analytics</a>.</p><hr><h2 id=3-using-timeshift-analytical-function>3. Using Timeshift analytical function</h2><p>Let&rsquo;s now compare with older metrics. Click on <strong><code>...</code></strong> and then on <strong>Clone</strong> in the dropdown to clone Signal <strong>A</strong>.</p><p><a href=#image-b3b76c933376b47043c41ce9d318697c class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-3.png alt="Clone Signal" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b3b76c933376b47043c41ce9d318697c><img src=../en/imt/dashboards/filtering/../../images/M-Filter-3.png alt="Clone Signal" class=lightbox-image loading=lazy></a></p><p>You will see a new row identical to <strong>A</strong>, called <strong>B</strong>, both visible and plotted.</p><p><a href=#image-4cc3a49f60db4fd444724743a7277ae7 class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-4.png alt="Plot Editor" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4cc3a49f60db4fd444724743a7277ae7><img src=../en/imt/dashboards/filtering/../../images/M-Filter-4.png alt="Plot Editor" class=lightbox-image loading=lazy></a></p><p>For Signal <strong>B</strong>, in the <strong>F(x)</strong> column add the analytic function <strong>Timeshift</strong> and enter <strong><code>1w</code></strong> (or 7d for 7 days), and click outside to confirm.</p><p><a href=#image-f6f74e27a39ea6be4d7096d0928e965c class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-5.png alt=Timeshift style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f6f74e27a39ea6be4d7096d0928e965c><img src=../en/imt/dashboards/filtering/../../images/M-Filter-5.png alt=Timeshift class=lightbox-image loading=lazy></a></p><p>Click on the cog on the far right, and choose a <strong>Plot Color</strong> e.g. pink, to change color for the plot of <strong>B</strong>.</p><p><a href=#image-e01cf5608375c64db718ec36e5f7c2eb class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-6.png alt="Change Plot Colour" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e01cf5608375c64db718ec36e5f7c2eb><img src=../en/imt/dashboards/filtering/../../images/M-Filter-6.png alt="Change Plot Colour" class=lightbox-image loading=lazy></a></p><p>Click on <strong>Close</strong>.</p><p>We now see plots for Signal <strong>A</strong> (the past 15 minutes) as a blue plot, and the plots from a week ago in pink.</p><p>In order to make this clearer we can click on the <strong>Area chart</strong> icon to change the visualization.</p><p><a href=#image-343f845f44b9a86d1d5ca9fe879f1eb8 class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-8.png alt="Area Chart" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-343f845f44b9a86d1d5ca9fe879f1eb8><img src=../en/imt/dashboards/filtering/../../images/M-Filter-8.png alt="Area Chart" class=lightbox-image loading=lazy></a></p><p>We now can see when last weeks latency was higher!</p><p>Next, click into the field next to <strong>Time</strong> on the Override bar and choose <strong><code>Past Hour</code></strong> from the dropdown.</p><p><a href=#image-e200e7410579d20e6e07d1431f802ff2 class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-9.png alt=Timeframe style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e200e7410579d20e6e07d1431f802ff2><img src=../en/imt/dashboards/filtering/../../images/M-Filter-9.png alt=Timeframe class=lightbox-image loading=lazy></a></p><hr><h2 id=4-using-formulas>4. Using Formulas</h2><p>Let&rsquo;s now plot the difference of all metric values for a day with 7 days in between.</p><p>Click on
<span class="btn cstyle blue"><button type=button>
Enter Formula</button></span>
then enter <strong><code>A-B</code></strong> (A minus B) and hide (deselect) all Signals using the eye, except <strong>C</strong>.</p><p><a href=#image-6252cde4badb7331d541ef88ec59a1cb class=lightbox-link><img src=../en/imt/dashboards/filtering/../../images/M-Filter-11.png alt=Formulas style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6252cde4badb7331d541ef88ec59a1cb><img src=../en/imt/dashboards/filtering/../../images/M-Filter-11.png alt=Formulas class=lightbox-image loading=lazy></a></p><p>We now see only the difference of all metric values of <strong>A</strong> and <strong>B</strong> being plotted. We see that we have some negative values on the plot because a metric value of <strong>B</strong> has some times larger value than the metric value of <strong>A</strong> at that time.</p><p>Lets look at the Signalflow that drives our Charts and Detectors!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=34-signalflow>3.4 SignalFlow</h1><h2 id=1-introduction>1. Introduction</h2><p>Let&rsquo;s take a look at SignalFlow - the analytics language of Observability Cloud that can be used to setup monitoring as code.</p><p>The heart of Splunk Infrastructure Monitoring is the SignalFlow analytics engine that runs computations written in a Python-like language. SignalFlow programs accept streaming input and produce output in real time. SignalFlow provides built-in analytical functions that take metric time series (MTS) as input, perform computations, and output a resulting MTS.</p><ul><li>Comparisons with historical norms, e.g. on a week-over-week basis</li><li>Population overviews using a distributed percentile chart</li><li>Detecting if the rate of change (or other metric expressed as a ratio, such as a service level objective) has exceeded a critical threshold</li><li>Finding correlated dimensions, e.g. to determine which service is most correlated with alerts for low disk space</li></ul><p>Infrastructure Monitoring creates these computations in the Chart Builder user interface, which lets you specify the input MTS to use and the analytical functions you want to apply to them. You can also run SignalFlow programs directly by using the <a href=https://dev.splunk.com/observability/docs/ target=_blank>SignalFlow API</a>.</p><p>SignalFlow includes a large library of built-in analytical functions that take a metric time series as an input, performs computations on its datapoints, and outputs time series that are the result of the computation.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>For more information on SignalFlow see <a href=https://docs.splunk.com/Observability/infrastructure/analytics/signalflow.html target=_blank>Analyze incoming data using SignalFlow.</a></p></div></div><h2 id=2-view-signalflow>2. View SignalFlow</h2><p>In the chart builder, click on <strong>View SignalFlow</strong>.</p><p><a href=#image-39f694ee7678e7124503bb4d003834fe class=lightbox-link><img src=../en/imt/dashboards/signalflow/../../images/view-signalflow.png alt=SignalFlow style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-39f694ee7678e7124503bb4d003834fe><img src=../en/imt/dashboards/signalflow/../../images/view-signalflow.png alt=SignalFlow class=lightbox-image loading=lazy></a></p><p>You will see the SignalFlow code that composes the chart we were working on. You can now edit the SignalFlow directly within the UI. Our documentation has the <a href=https://dev.splunk.com/observability/docs/signalflow/function_method_list target=_blank>full list</a> of SignalFlow functions and methods.</p><p>Also, you can copy the SignalFlow and use it when interacting with the API or with Terraform to enable <a href=../en/imt/dashboards/signalflow/../../monitoring-as-code/>Monitoring as Code</a></p><p><a href=#image-52d45a58477a76fb629b79263fff91d4 class=lightbox-link><img src=../en/imt/dashboards/signalflow/../../images/show-signalflow.png alt=Code style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-52d45a58477a76fb629b79263fff91d4><img src=../en/imt/dashboards/signalflow/../../images/show-signalflow.png alt=Code class=lightbox-image loading=lazy></a></p><div class=tab-panel data-tab-group=ebaef60bda435d96105f161677a5b2a4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=SignalFlow class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("ebaef60bda435d96105f161677a5b2a4","SignalFlow")'><div><div class=tab-nav-hidden>SignalFlow</div><div class=tab-nav-text>SignalFlow</div></div></button></div><div class=tab-content-container><div data-tab-item=SignalFlow class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>A</span> <span class=o>=</span> <span class=n>data</span><span class=p>(</span><span class=s1>&#39;demo.trans.latency&#39;</span><span class=p>,</span> <span class=nb>filter</span><span class=o>=</span><span class=nb>filter</span><span class=p>(</span><span class=s1>&#39;demo_datacenter&#39;</span><span class=p>,</span> <span class=s1>&#39;Paris&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>pct</span><span class=o>=</span><span class=mi>95</span><span class=p>)</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=n>enable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>B</span> <span class=o>=</span> <span class=n>data</span><span class=p>(</span><span class=s1>&#39;demo.trans.latency&#39;</span><span class=p>,</span> <span class=nb>filter</span><span class=o>=</span><span class=nb>filter</span><span class=p>(</span><span class=s1>&#39;demo_datacenter&#39;</span><span class=p>,</span> <span class=s1>&#39;Paris&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>pct</span><span class=o>=</span><span class=mi>95</span><span class=p>)</span><span class=o>.</span><span class=n>timeshift</span><span class=p>(</span><span class=s1>&#39;1w&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;B&#39;</span><span class=p>,</span> <span class=n>enable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>C</span> <span class=o>=</span> <span class=p>(</span><span class=n>A</span><span class=o>-</span><span class=n>B</span><span class=p>)</span><span class=o>.</span><span class=n>publish</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s1>&#39;C&#39;</span><span class=p>)</span></span></span></code></pre></div></div></div></div></div><p>Click on <strong>View Builder</strong> to go back to the Chart <strong>Builder</strong> UI.</p><p><a href=#image-a26c718dacf945e26a81fb549f59dfe0 class=lightbox-link><img src=../en/imt/dashboards/signalflow/../../images/view-builder.png alt="View Builder" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a26c718dacf945e26a81fb549f59dfe0><img src=../en/imt/dashboards/signalflow/../../images/view-builder.png alt="View Builder" class=lightbox-image loading=lazy></a></p><p>Let&rsquo;s save this new chart to our Dashboard!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-charts-to-dashboards>Adding charts to dashboards</h1><h2 id=1-save-to-existing-dashboard>1. Save to existing dashboard</h2><p>Check that you have <strong>YOUR_NAME-Dashboard: YOUR_NAME-Dashboard</strong> in the top left corner. This means you chart will be saved in this Dashboard.</p><p>Name the Chart <strong>Latency History</strong> and add a Chart Description if you wish.</p><p><a href=#image-2e476f6185bc742666d0f1f4614473bd class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-1.png alt="Save Chart 1" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2e476f6185bc742666d0f1f4614473bd><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-1.png alt="Save Chart 1" class=lightbox-image loading=lazy></a></p><p>Click on
<span class="btn cstyle transparent"><button type=button>
Save And Close</button>
</span>. This returns you to your dashboard that now has two charts!</p><p><a href=#image-614175c30ceef21b0fd14f8bba63399a class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-2.png alt="Save Chart 2" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-614175c30ceef21b0fd14f8bba63399a><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-2.png alt="Save Chart 2" class=lightbox-image loading=lazy></a>
Now let&rsquo;s quickly add another Chart based on the previous one.</p><h2 id=2-copy-and-paste-a-chart>2. Copy and Paste a chart</h2><p>Click on the three dots <strong><code>...</code></strong> on the <strong>Latency History</strong> chart in your dashboard and then on <strong>Copy</strong>.</p><p><a href=#image-cf3e686cfdcf3cc9dea6d7d24c34cb69 class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-3.png alt="Copy chart" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cf3e686cfdcf3cc9dea6d7d24c34cb69><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-3.png alt="Copy chart" class=lightbox-image loading=lazy></a></p><p>You see the chart being copied, and you should now have a red circle with a white 1 next to the <strong>+</strong> on the top left of the page.</p><p>Click on the plus icon the top of the page, and then in the menu on <em>Paste Charts</em> (There should also be a red dot with a 1 visible at the end of the line).</p><p><a href=#image-9121ae58d7abe1b45768aa66234e9171 class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-5.png alt="Past charts" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9121ae58d7abe1b45768aa66234e9171><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-5.png alt="Past charts" class=lightbox-image loading=lazy></a></p><p>This will place a copy of the previous chart in your dashboard.</p><p><a href=#image-dd320b181342e9a469ddaba59a86f8ee class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-6.png alt="Three Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-dd320b181342e9a469ddaba59a86f8ee><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-6.png alt="Three Dashboard" class=lightbox-image loading=lazy></a></p><h2 id=3-edit-the-pasted-chart>3. Edit the pasted chart</h2><p>Click on the three dots <strong><code>...</code></strong> on one of the <strong>Latency History</strong> charts in your dashboard and then on <strong>Open</strong> (or you can click on the name of the chart which here is <strong>Latency History</strong>).</p><p>This will bring you to the editor environment again.</p><p>First set the time for the chart to -1 hour in the Time box at the top right of the chart. Then to make this a different chart, click on the eye icon in front of signal &ldquo;<em>A</em>&rdquo; to make it visible again, and then hide signal &ldquo;<em>C</em>&rdquo; via the eye icon and change the name for <em>Latency history</em> to <strong>Latency vs Load</strong>.</p><p><a href=#image-305426853317f63b7b73d1b418c5161e class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-7.png alt="Set Visibility" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-305426853317f63b7b73d1b418c5161e><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-7.png alt="Set Visibility" class=lightbox-image loading=lazy></a></p><p>Click on the
<span class="btn cstyle blue"><button type=button>
Add Metric Or Event</button></span> button. This will bring up the box for a new signal. Type and select <code>demo.trans.count</code> for Signal <strong>D</strong>.</p><p><a href=#image-aaa5d367177371fc4e03fd1eb76507b0 class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-8.png alt="Dashboard Info" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-aaa5d367177371fc4e03fd1eb76507b0><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-8.png alt="Dashboard Info" class=lightbox-image loading=lazy></a></p><p>This will add a new Signal <strong>D</strong> to your chart, It shows the number of active requests. Add the filter for the <em>demo_datacenter:Paris</em>, then change the Rollup type by clicking on the <strong>Configure Plot</strong> button and changing the roll-up from <strong>Auto (Delta)</strong> to <strong>Rate/sec</strong>. Change the name from <strong>demo.trans.count</strong> to <strong>Latency vs Load</strong>.</p><p><a href=#image-4c314563a53367d279da045731048695 class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-9.png alt="rollup change" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4c314563a53367d279da045731048695><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-9.png alt="rollup change" class=lightbox-image loading=lazy></a></p><p>Finally press the
<span class="btn cstyle transparent"><button type=button>
Save And Close</button></span> button. This returns you to your dashboard that now has three different charts!</p><p><a href=#image-f431f272c337f3051654f9d182bf6029 class=lightbox-link><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-10.png alt="three charts" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f431f272c337f3051654f9d182bf6029><img src=../en/imt/dashboards/adding-charts/../../images/M-MoreCharts-10.png alt="three charts" class=lightbox-image loading=lazy></a></p><p>Let&rsquo;s add an &ldquo;instruction&rdquo; note and arrange the charts!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=adding-notes-and-dashboard-layout>Adding Notes and Dashboard Layout</h1><h2 id=1-adding-notes>1. Adding Notes</h2><p>Often on dashboards it makes sense to place a short &ldquo;instruction&rdquo; pane that helps users of a dashboard. Lets add one now by clicking on the
<span class="btn cstyle white"><button type=button>
New Text Note</button></span>
Button.</p><p><a href=#image-ae8b653a5744a22a1f26d6389a6a066e class=lightbox-link><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-0.png alt="three charts" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ae8b653a5744a22a1f26d6389a6a066e><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-0.png alt="three charts" class=lightbox-image loading=lazy></a></p><p>This will open the notes editor.</p><p><a href=#image-e2d618c55422637d9779ea4885e7c594 class=lightbox-link><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-1.png alt="Notes 1" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e2d618c55422637d9779ea4885e7c594><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-1.png alt="Notes 1" class=lightbox-image loading=lazy></a></p><p>To allow you to add more then just text to you notes, Splunk is allowing you to use Markdown in these notes/panes.
Markdown is a lightweight markup language for creating formatted text using plain-text often used in Webpages.</p><p>This includes (but not limited to):</p><ul><li>Headers. (in various sizes)</li><li>Emphasis styles.</li><li>Lists and Tables.</li><li>Links. These can be external webpages (for documentation for example) or directly to other Splunk IM Dashboards</li></ul><p>Below is an example of above Markdown options you can use in your note.</p><div class=tab-panel data-tab-group=622effe93228b7113b572da5c9c5456a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Sample Markdown text" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("622effe93228b7113b572da5c9c5456a","Sample Markdown text")'><div><div class=tab-nav-hidden>Sample Markdown text</div><div class=tab-nav-text>Sample Markdown text</div></div></button></div><div class=tab-content-container><div data-tab-item="Sample Markdown text" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl><span class=gh># h1 Big headings
</span></span></span><span class=line><span class=cl><span class=gh></span>
</span></span><span class=line><span class=cl><span class=gu>###### h6 To small headings
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl><span class=gu>##### Emphasis
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl><span class=gs>**This is bold text**</span>, <span class=ge>*This is italic text*</span> , <span class=gd>~~Strikethrough~~</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>##### Lists
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl>Unordered
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>+ Create a list by starting a line with <span class=sb>`+`</span>, <span class=sb>`-`</span>, or <span class=sb>`*`</span>
</span></span><span class=line><span class=cl><span class=k>-</span> Sub-lists are made by indenting 2 spaces:
</span></span><span class=line><span class=cl><span class=k>-</span> Marker character change forces new list start:
</span></span><span class=line><span class=cl>    <span class=k>*</span> Ac tristique libero volutpat at
</span></span><span class=line><span class=cl>    + Facilisis in pretium nisl aliquet
</span></span><span class=line><span class=cl><span class=k>*</span> Very easy!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ordered
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>1.</span> Lorem ipsum dolor sit amet
</span></span><span class=line><span class=cl><span class=k>2.</span> Consectetur adipiscing elit
</span></span><span class=line><span class=cl><span class=k>3.</span> Integer molestie lorem at massa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>##### Tables
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl>| Option | Description |
</span></span><span class=line><span class=cl>| ------ | ----------- |
</span></span><span class=line><span class=cl>| chart  | path to data files to supply the data that will be passed into templates. |
</span></span><span class=line><span class=cl>| engine | engine to be used for processing templates. Handlebars is the default. |
</span></span><span class=line><span class=cl>| ext    | extension to be used for dest files. |
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gu>#### Links
</span></span></span><span class=line><span class=cl><span class=gu></span>
</span></span><span class=line><span class=cl>[<span class=nt>link to webpage</span>](<span class=na>https://www.splunk.com</span>)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[<span class=nt>link to dashboard with title</span>](<span class=na>https://app.eu0.signalfx.com/#/dashboard/EaJHrbPAEAA?groupId=EaJHgrsAIAA&amp;configId=EaJHsHzAEAA &#34;Link to the Sample chart Dashboard!&#34;</span>)</span></span></code></pre></div></div></div></div></div><p>Copy the above by using the copy button and paste it in the <em>Edit</em> box.
the preview will show you how it will look.</p><hr><h2 id=2-saving-our-chart>2. Saving our chart</h2><p>Give the Note chart a name, in our example we used <em>Example text chart</em>, then press the
<span class="btn cstyle transparent"><button type=button>
Save And Close</button></span> Button.</p><p><a href=#image-a39cfff7c01e5272558e3b5cdeda33ff class=lightbox-link><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-2.png alt="saving note" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a39cfff7c01e5272558e3b5cdeda33ff><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-2.png alt="saving note" class=lightbox-image loading=lazy></a></p><p>This will bring you back to you Dashboard, that now includes the note.</p><p><a href=#image-c7bd21f23f5d352fd71ccd994a220ff5 class=lightbox-link><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-3.png alt="three charts and note" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c7bd21f23f5d352fd71ccd994a220ff5><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-3.png alt="three charts and note" class=lightbox-image loading=lazy></a></p><hr><h2 id=3-ordering--sizing-of-charts>3. Ordering & sizing of charts</h2><p>If you do not like the default order and sizes of your charts you can simply use window dragging technique to move and size them to the desired location.</p><p>Grab the <strong>top</strong> border of a chart and you should see the mouse pointer change to a drag icon (see picture below).</p><p><a href=#image-8057cf3197a82ba986e2c903aa92d9f6 class=lightbox-link><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-4.png alt="dragging charts" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8057cf3197a82ba986e2c903aa92d9f6><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-4.png alt="dragging charts" class=lightbox-image loading=lazy></a></p><p>Now drag the <strong>Latency vs Load</strong> chart to sit between the <strong>Latency History</strong> Chart and the <strong>Example text chart</strong>.</p><p><a href=#image-068a507630a74676eaaee579272028a1 class=lightbox-link><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-5.png alt=sizing style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-068a507630a74676eaaee579272028a1><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-5.png alt=sizing class=lightbox-image loading=lazy></a></p><p>You can also resize windows by dragging from the left, right and bottom edges.</p><p>As a last exercise reduce the width of the note chart to about a third of the other charts. The chart will automatically snap to one of the sizes it supports. Widen the 3 other charts to about a third of the Dashboard. Drag the notes to the right of the others and resize it to match it to the 3 others. Set the <strong>Time</strong> to <strong>-1h</strong> and you should have the following dashboard!</p><p><a href=#image-bd837f8de4746aa63a617caf44ebebda class=lightbox-link><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-6.png alt=TaDA! style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-bd837f8de4746aa63a617caf44ebebda><img src=../en/imt/dashboards/notes-and-layout/../../images/M-Notes-6.png alt=TaDA! class=lightbox-image loading=lazy></a></p><p>On to Detectors!</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=working-with-detectors>Working with Detectors</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
10 minutes</button></span><ul><li>Create a Detector from one of your charts</li><li>Setting Alert conditions</li><li>Running a pre-flight check</li><li>Working with muting rules</li></ul><hr><h2 id=1-introduction>1. Introduction</h2><p>Splunk Observability Cloud uses detectors, events, alerts, and notifications to keep you informed when certain criteria are met. For example, you might want a message sent to a Slack channel or to an email address for the Ops team when CPU Utilization has reached 95%, or when the number of concurrent users is approaching a limit that might require you to spin up an additional AWS instance.</p><p>These conditions are expressed as one or more rules that trigger an alert when the conditions in the rules are met. Individual rules in a detector are labeled according to criticality: Info, Warning, Minor, Major, and Critical.</p><h2 id=2-creating-a-detector>2. Creating a Detector</h2><p>In <strong>Dashboards</strong> click on your <strong>Custom Dashboard Group</strong> (that you created in the previous module) and then click on the dashboard name.</p><p><a href=#image-6b880647e019a53e71b0eac100ee0fe5 class=lightbox-link><img src=../en/imt/detectors/../images/custom-dashboard-group.png alt="Custom Dashboard Group" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6b880647e019a53e71b0eac100ee0fe5><img src=../en/imt/detectors/../images/custom-dashboard-group.png alt="Custom Dashboard Group" class=lightbox-image loading=lazy></a></p><p>We are now going to create a new detector from a chart on this dashboard. Click on the bell icon on the <strong>Latency vs Load</strong> chart, and then click <strong>New Detector From Chart</strong>.</p><p><a href=#image-e9749fa0a341f73c95a15afbc6538940 class=lightbox-link><img src=../en/imt/detectors/../images/new-detector.png alt="New Detector" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e9749fa0a341f73c95a15afbc6538940><img src=../en/imt/detectors/../images/new-detector.png alt="New Detector" class=lightbox-image loading=lazy></a></p><p>In the text field next to <strong>Detector Name</strong>, <strong>ADD YOUR INITIALS</strong> before the proposed detector name.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Naming the detector</div><div class=box-content><p>It&rsquo;s important that you add your initials in front of the proposed detector name.</p><p>It should be something like this: <strong>XYZ&rsquo;s Latency Chart Detector</strong>.</p></div></div><p>Click on
<span class="btn cstyle blue"><button type=button>
Create Alert Rule</button></span></p><p><a href=#image-cba0f8995196788395708dec141b808f class=lightbox-link><img src=../en/imt/detectors/../images/create-alert-rule.png alt="Create Alert Rule" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cba0f8995196788395708dec141b808f><img src=../en/imt/detectors/../images/create-alert-rule.png alt="Create Alert Rule" class=lightbox-image loading=lazy></a></p><p>In the Detector window, inside <strong>Alert signal</strong>, the Signal we will alert on is marked with a (blue) bell in the <strong>Alert on</strong> column. The bell indicates which Signal is being used to generate the alert.</p><p>Click on
<span class="btn cstyle blue"><button type=button>
Proceed to Alert Condition</button></span></p><p><a href=#image-b080ce21019f13edd23e1c9c30789ab8 class=lightbox-link><img src=../en/imt/detectors/../images/alert-signal.png alt="Alert Signal" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b080ce21019f13edd23e1c9c30789ab8><img src=../en/imt/detectors/../images/alert-signal.png alt="Alert Signal" class=lightbox-image loading=lazy></a></p><h2 id=3-setting-alert-condition>3. Setting Alert condition</h2><p>In <strong>Alert condition</strong>, click on <strong>Static Threshold</strong> and then on
<span class="btn cstyle blue"><button type=button>
Proceed to Alert Settings</button></span></p><p><a href=#image-ae1572225e9412e300d6349d76ee7c59 class=lightbox-link><img src=../en/imt/detectors/../images/alert-condition.png alt="Alert Condition" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ae1572225e9412e300d6349d76ee7c59><img src=../en/imt/detectors/../images/alert-condition.png alt="Alert Condition" class=lightbox-image loading=lazy></a></p><p>In <strong>Alert Settings</strong>, enter the value <strong><code>290</code></strong> in the <strong>Threshold</strong> field. In the same window change <strong>Time</strong> on top right to past day (<strong>-1d</strong>).</p><hr><h2 id=4-alert-pre-flight-check>4. Alert pre-flight check</h2><p>A pre-flight check will take place after 5 seconds. See the <strong>Estimated alert count</strong>. Based on the current alert settings, the amount of alerts we would have received in 1 day would have been <strong>3</strong>.</p><p><a href=#image-60790684005e42fdeed65dfdf4dc0f83 class=lightbox-link><img src=../en/imt/detectors/../images/alert-threshold.png alt="Alert Threshold" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-60790684005e42fdeed65dfdf4dc0f83><img src=../en/imt/detectors/../images/alert-threshold.png alt="Alert Threshold" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> About pre-flight checks</div><div class=box-content><p>Once you set an alert condition, the UI estimates how many alerts you might get based on the current settings, and in the timeframe set on the upper right corner - in this case, the past day.</p><p>Immediately, the platform will start analyzing the signals with the current settings, and perform something we call a Pre-flight Check. This enables you to test the alert conditions using the historical data in the platform, to ensure the settings are logical and will not inadvertently generate an alert storm, removing the guess work from configuring alerts in a simple but very powerful way, only available using the Splunk Observability Cloud.</p><p>To read more about detector previewing, please visit this link
<a href=https://docs.splunk.com/Observability/alerts-detectors-notifications/preview-detector-alerts.html#nav-Preview-detector-alerts target=_blank>Preview detector alerts.</a></p></div></div><p>Click on
<span class="btn cstyle blue"><button type=button>
Proceed to Alert Message</button></span></p><hr><h2 id=5-alert-message>5. Alert message</h2><p>In <strong>Alert message</strong>, under <strong>Severity</strong> choose <strong>Major</strong>.</p><p><a href=#image-205af428b93d510517f08218385a56e8 class=lightbox-link><img src=../en/imt/detectors/../images/alert-message.png alt="Alert Message" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-205af428b93d510517f08218385a56e8><img src=../en/imt/detectors/../images/alert-message.png alt="Alert Message" class=lightbox-image loading=lazy></a></p><p>Click on
<span class="btn cstyle blue"><button type=button>
Proceed to Alert Recipients</button></span></p><p>Click on <strong>Add Recipient</strong> and then on your email address displayed as the first option.</p><p><a href=#image-e83e5fedb55f15a077da5ee97d4c4955 class=lightbox-link><img src=../en/imt/detectors/../images/add-recipient.png alt="Add Recipient" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e83e5fedb55f15a077da5ee97d4c4955><img src=../en/imt/detectors/../images/add-recipient.png alt="Add Recipient" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Notification Services</div><div class=box-content><p>That&rsquo;s the same as entering that email address OR you can enter another email address by clicking on <strong>E-mail&mldr;</strong>.</p><p>This is just one example of the many <strong>Notification Services</strong> the suite has available. You can check this out by going to the <strong>Integrations</strong> tab of the top menu, and see <strong>Notification Services</strong>.</p></div></div><hr><h2 id=6-alert-activation>6. Alert Activation</h2><p>Click on
<span class="btn cstyle blue"><button type=button>
Proceed to Alert Activation</button></span></p><p>In <strong>Activate&mldr;</strong> click on
<span class="btn cstyle blue"><button type=button>
Activate Alert Rule</button></span></p><p><a href=#image-ef37e090b9f396cfdf75a3b9a1c2ae73 class=lightbox-link><img src=../en/imt/detectors/../images/activate-alert.png alt="Activate Alert" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ef37e090b9f396cfdf75a3b9a1c2ae73><img src=../en/imt/detectors/../images/activate-alert.png alt="Activate Alert" class=lightbox-image loading=lazy></a></p><p>If you want to get alerts quicker you edit the rule and lower the value from <strong><code>290</code></strong> to say <strong><code>280</code></strong>.</p><p>If you change the <strong>Time</strong> to <strong>-1h</strong> you can see how many alerts you might get with the threshold you have chosen based on the metrics from the last 1 hour.</p><p>Click on the
<a href=#image-48c3d125025deba4edabb00a6f3ad516 class=lightbox-link><img src="../en/imt/detectors/../images/alerts-and-detectors.png?classes=inline&height=25px" alt="alerts and detectors button" class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-48c3d125025deba4edabb00a6f3ad516><img src="../en/imt/detectors/../images/alerts-and-detectors.png?classes=inline&height=25px" alt="alerts and detectors button" class=lightbox-image loading=lazy></a> in the navbar and then click on <strong>Detectors</strong>. You can optionally filter for your initials. You will see you detector listed here. If you don&rsquo;t then please refresh your browser.</p><p><a href=#image-1799e165c70be53bf51d50c04b759fec class=lightbox-link><img src=../en/imt/detectors/../images/detectors.png alt="Detector List" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1799e165c70be53bf51d50c04b759fec><img src=../en/imt/detectors/../images/detectors.png alt="Detector List" class=lightbox-image loading=lazy></a></p><p><strong>Congratulations</strong>! You have created your first detector and activated it!</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Working with Detectors</h1><article class=default><header class=headline></header><h1 id=working-with-muting-rules>Working with Muting Rules</h1><ul><li>Learn how to configure Muting Rules</li><li>Learn how to resume notifications</li></ul><hr><h2 id=1-configuring-muting-rules>1. Configuring Muting Rules</h2><p>There will be times when you might want to mute certain notifications. For example, if you want to schedule downtime for maintenance on a server or set of servers, or if you are testing new code or settings etc. For that you can use muting rules in Splunk Observability Cloud. Let&rsquo;s create one!</p><p>Click on <strong>Alerts & Detectors</strong> in the sidebar and then click <strong>Detectors</strong> to see the list of active detectors.</p><p><a href=#image-f4e85682134fe2d7ca59daea39ec5b67 class=lightbox-link><img src=../en/imt/detectors/muting/../../images/detectors.png alt="detectors list" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f4e85682134fe2d7ca59daea39ec5b67><img src=../en/imt/detectors/muting/../../images/detectors.png alt="detectors list" class=lightbox-image loading=lazy></a></p><p>If you created a detector in <strong>Creating a Detector</strong> you can click on the three dots <strong><code>...</code></strong> on the far right for that detector; if not, do that for another detector.</p><p>From the drop-down click on <strong>Create Muting Rule&mldr;</strong></p><p><a href=#image-f3ceb398d1a8f4d78e8372423591a131 class=lightbox-link><img src=../en/imt/detectors/muting/../../images/create-muting-rule.png alt="Create Muting Rule" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f3ceb398d1a8f4d78e8372423591a131><img src=../en/imt/detectors/muting/../../images/create-muting-rule.png alt="Create Muting Rule" class=lightbox-image loading=lazy></a></p><p>In the <strong>Muting Rule</strong> window check <strong>Mute Indefinitely</strong> and enter a reason.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Important</div><div class=box-content><p>This will mute the notifications permanently until you come back here and un-check this box or resume notifications for this detector.</p></div></div><p><a href=#image-084460f38e81d40f6830333e6a1e9d17 class=lightbox-link><img src=../en/imt/detectors/muting/../../images/mute-indefinitely.png alt="Mute Indefinitely" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-084460f38e81d40f6830333e6a1e9d17><img src=../en/imt/detectors/muting/../../images/mute-indefinitely.png alt="Mute Indefinitely" class=lightbox-image loading=lazy></a></p><p>Click <strong>Next</strong> and in the new modal window confirm the muting rule setup.</p><p><a href=#image-6cc4b52d7e1605d4a1f29d22b3da231a class=lightbox-link><img src=../en/imt/detectors/muting/../../images/confirm-rule.png alt="Confirm Rule" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6cc4b52d7e1605d4a1f29d22b3da231a><img src=../en/imt/detectors/muting/../../images/confirm-rule.png alt="Confirm Rule" class=lightbox-image loading=lazy></a></p><p>Click on
<span class="btn cstyle blue"><button type=button>
Mute Indefinitely</button></span> to confirm.</p><p><a href=#image-13aa373e48791e56b8afdb9837003426 class=lightbox-link><img src=../en/imt/detectors/muting/../../images/alert-muted.png alt="List muted rule" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-13aa373e48791e56b8afdb9837003426><img src=../en/imt/detectors/muting/../../images/alert-muted.png alt="List muted rule" class=lightbox-image loading=lazy></a></p><p>You won&rsquo;t be receiving any email notifications from your detector until you resume notifications again. Let&rsquo;s now see how to do that!</p><hr><h2 id=2-resuming-notifications>2. Resuming notifications</h2><p>To Resume notifications, click on <strong>Muting Rules</strong>, you will see the name of the detector you muted notifications for under <strong>Detector</strong> heading.</p><p>Click on the thee dots <strong><code>...</code></strong> on the far right, and click on <strong>Resume Notifications</strong>.</p><p><a href=#image-3c4c2824511f2e75fbfbd09c6b90ac92 class=lightbox-link><img src=../en/imt/detectors/muting/../../images/muting-list.png alt=Resume style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-3c4c2824511f2e75fbfbd09c6b90ac92><img src=../en/imt/detectors/muting/../../images/muting-list.png alt=Resume class=lightbox-image loading=lazy></a></p><p>Click on
<span class="btn cstyle blue"><button type=button>
Resume</button></span> to confirm and resume notifications for this detector.</p><p><a href=#image-02257114e921cd34a93e888c42e989a8 class=lightbox-link><img src=../en/imt/detectors/muting/../../images/resume.png alt=Resume style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-02257114e921cd34a93e888c42e989a8><img src=../en/imt/detectors/muting/../../images/resume.png alt=Resume class=lightbox-image loading=lazy></a></p><p><strong>Congratulations!</strong> You have now resumed your alert notifications!</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=monitoring-as-code>Monitoring as Code</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
10 minutes</button></span><ul><li>Use Terraform<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> to manage Observability Cloud Dashboards and Detectors</li><li>Initialize the Terraform Splunk Provider<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</li><li>Run Terraform to create detectors and dashboards from code using the Splunk Terraform Provider.</li><li>See how Terraform can also delete detectors and dashboards.</li></ul><hr><h2 id=1-initial-setup>1. Initial setup</h2><p>Monitoring as code adopts the same approach as infrastructure as code. You can manage monitoring the same way you do applications, servers, or other infrastructure components.</p><p>You can use monitoring as code to build out your visualisations, what to monitor, and when to alert, among other things. This means your monitoring setup, processes, and rules can be versioned, shared, and reused.</p><p>Full documentation for the Splunk Terraform Provider is available <a href=https://registry.terraform.io/providers/splunk-terraform/signalfx/latest/docs target=_blank>here</a>.</p><p>Remaining in your AWS/EC2 instance, change into the <code>o11y-cloud-jumpstart</code> directory</p><div class=tab-panel data-tab-group=41a37da1736506ef4fd81c8b59f64844><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Change directory" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("41a37da1736506ef4fd81c8b59f64844","Change directory")'><div><div class=tab-nav-hidden>Change directory</div><div class=tab-nav-text>Change directory</div></div></button></div><div class=tab-content-container><div data-tab-item="Change directory" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> observability-content-contrib/integration-examples/terraform-jumpstart</span></span></code></pre></div></div></div></div></div><p>The environment variables needed should already be set from <a href=../en/imt/monitoring-as-code/../gdi/#2-installation-using-helm>Installation using Helm</a>. If not, create the following environment variables to use in the Terraform steps below</p><div class=tab-panel data-tab-group=1e4d0b061feb7e7d87fd11c44e955277><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export ACCESS TOKEN" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("1e4d0b061feb7e7d87fd11c44e955277","Export ACCESS TOKEN")'><div><div class=tab-nav-hidden>Export ACCESS TOKEN</div><div class=tab-nav-text>Export ACCESS TOKEN</div></div></button></div><div class=tab-content-container><div data-tab-item="Export ACCESS TOKEN" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_O11y-Workshop-ACCESS_TOKEN&gt;&#34;</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=d462585877a9bcd8e0f8e320d3b51f16><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export REALM" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("d462585877a9bcd8e0f8e320d3b51f16","Export REALM")'><div><div class=tab-nav-hidden>Export REALM</div><div class=tab-nav-text>Export REALM</div></div></button></div><div class=tab-content-container><div data-tab-item="Export REALM" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_REALM&gt;&#34;</span></span></span></code></pre></div></div></div></div></div><p>Initialize Terraform and upgrade to the latest version of the Splunk Terraform Provider</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note: Upgrading the SignalFx Terraform Provider</div><div class=box-content><p>You will need to run the command below each time a new version of the Splunk Terraform Provider is released. You can track the releases on <a href=https://github.com/splunk-terraform/terraform-provider-signalfx/releases target=_blank>GitHub.</a></p></div></div><div class=tab-panel data-tab-group=f286f4ca7ce46a8bf8ea8e9123fb8961><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Initialise Terraform" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f286f4ca7ce46a8bf8ea8e9123fb8961","Initialise Terraform")'><div><div class=tab-nav-hidden>Initialise Terraform</div><div class=tab-nav-text>Initialise Terraform</div></div></button>
<button data-tab-item="Initialise Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f286f4ca7ce46a8bf8ea8e9123fb8961","Initialise Output")'><div><div class=tab-nav-hidden>Initialise Output</div><div class=tab-nav-text>Initialise Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Initialise Terraform" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform init -upgrade</span></span></code></pre></div></div></div><div data-tab-item="Initialise Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    Upgrading modules...
</span></span><span class=line><span class=cl>    - aws in modules/aws
</span></span><span class=line><span class=cl>    - azure in modules/azure
</span></span><span class=line><span class=cl>    - docker in modules/docker
</span></span><span class=line><span class=cl>    - gcp in modules/gcp
</span></span><span class=line><span class=cl>    - host in modules/host
</span></span><span class=line><span class=cl>    - kafka in modules/kafka
</span></span><span class=line><span class=cl>    - kubernetes in modules/kubernetes
</span></span><span class=line><span class=cl>    - parent_child_dashboard in modules/dashboards/parent
</span></span><span class=line><span class=cl>    - pivotal in modules/pivotal
</span></span><span class=line><span class=cl>    - rum_and_synthetics_dashboard in modules/dashboards/rum_and_synthetics
</span></span><span class=line><span class=cl>    - usage_dashboard in modules/dashboards/usage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Initializing the backend...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Initializing provider plugins...
</span></span><span class=line><span class=cl>    - Finding latest version of splunk-terraform/signalfx...
</span></span><span class=line><span class=cl>    - Installing splunk-terraform/signalfx v6.20.0...
</span></span><span class=line><span class=cl>    - Installed splunk-terraform/signalfx v6.20.0 (self-signed, key ID CE97B6074989F138)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Partner and community providers are signed by their developers.
</span></span><span class=line><span class=cl>    If you&#39;d like to know more about provider signing, you can read about it here:
</span></span><span class=line><span class=cl>    https://www.terraform.io/docs/cli/plugins/signing.html
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Terraform has created a lock file .terraform.lock.hcl to record the provider
</span></span><span class=line><span class=cl>    selections it made above. Include this file in your version control repository
</span></span><span class=line><span class=cl>    so that Terraform can guarantee to make the same selections by default when
</span></span><span class=line><span class=cl>    you run &#34;terraform init&#34; in the future.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Terraform has been successfully initialized!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    You may now begin working with Terraform. Try running &#34;terraform plan&#34; to see
</span></span><span class=line><span class=cl>    any changes that are required for your infrastructure. All Terraform commands
</span></span><span class=line><span class=cl>    should now work.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    If you ever set or change modules or backend configuration for Terraform,
</span></span><span class=line><span class=cl>    rerun this command to reinitialize your working directory. If you forget, other
</span></span><span class=line><span class=cl>    commands will detect it and remind you to do so if necessary.</span></span></code></pre></div></div></div></div></div><h2 id=2-create-execution-plan>2. Create execution plan</h2><p>The <code>terraform plan</code> command creates an execution plan. By default, creating a plan consists of:</p><ul><li>Reading the current state of any already-existing remote objects to make sure that the Terraform state is up-to-date.</li><li>Comparing the current configuration to the prior state and noting any differences.</li><li>Proposing a set of change actions that should, if applied, make the remote objects match the configuration.</li></ul><p>The plan command alone will not actually carry out the proposed changes, and so you can use this command to check whether the proposed changes match what you expected before you apply the changes</p><div class=tab-panel data-tab-group=43d9a0b3fcb2342a1670eab235138e58><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Execution Plan" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("43d9a0b3fcb2342a1670eab235138e58","Execution Plan")'><div><div class=tab-nav-hidden>Execution Plan</div><div class=tab-nav-text>Execution Plan</div></div></button>
<button data-tab-item="Execution Plan Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("43d9a0b3fcb2342a1670eab235138e58","Execution Plan Output")'><div><div class=tab-nav-hidden>Execution Plan Output</div><div class=tab-nav-text>Execution Plan Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Execution Plan" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform plan -var<span class=o>=</span><span class=s2>&#34;access_token=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;o11y_prefix=[</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>]&#34;</span></span></span></code></pre></div></div></div><div data-tab-item="Execution Plan Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Plan: 146 to add, 0 to change, 0 to destroy.</span></span></code></pre></div></div></div></div></div><p>If the plan executes successfully, we can go ahead and apply:</p><hr><h2 id=3-apply-execution-plan>3. Apply execution plan</h2><p>The <code>terraform apply</code> command executes the actions proposed in the Terraform plan above.</p><p>The most straightforward way to use <code>terraform apply</code> is to run it without any arguments at all, in which case it will automatically create a new execution plan (as if you had run terraform plan) and then prompt you to provide the Access Token, Realm (the prefix defaults to <code>Splunk</code>) and approve the plan, before taking the indicated actions.</p><p>Due to this being a workshop it is required that the prefix is to be unique so you need to run the <code>terraform apply</code> below.</p><div class=tab-panel data-tab-group=683a577f3bdd2e0c959902a16970170f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Apply Plan" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("683a577f3bdd2e0c959902a16970170f","Apply Plan")'><div><div class=tab-nav-hidden>Apply Plan</div><div class=tab-nav-text>Apply Plan</div></div></button>
<button data-tab-item="Apply Plan Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("683a577f3bdd2e0c959902a16970170f","Apply Plan Output")'><div><div class=tab-nav-hidden>Apply Plan Output</div><div class=tab-nav-text>Apply Plan Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Apply Plan" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform apply -var<span class=o>=</span><span class=s2>&#34;access_token=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;o11y_prefix=[</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>]&#34;</span></span></span></code></pre></div></div></div><div data-tab-item="Apply Plan Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Apply complete! Resources: 146 added, 0 changed, 0 destroyed.</span></span></code></pre></div></div></div></div></div><p>Once the apply has completed, validate that the detectors were created, under the <strong>Alerts & Detectors</strong> and click on the <strong>Detectors</strong> tab. They will be prefixed by the hostname of your instance. To check the prefix value run:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=k>$(</span>hostname<span class=k>)</span></span></span></code></pre></div><p>You will see a list of the new detectors and you can search for the prefix that was output from above.</p><p><a href=#image-8fc7d6720c8a8e7a1a25fe7ad478c40e class=lightbox-link><img src=../en/imt/monitoring-as-code/../images/detectors.png alt=Detectors style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8fc7d6720c8a8e7a1a25fe7ad478c40e><img src=../en/imt/monitoring-as-code/../images/detectors.png alt=Detectors class=lightbox-image loading=lazy></a></p><h2 id=3-destroy-all-your-hard-work>3. Destroy all your hard work</h2><p>The <code>terraform destroy</code> command is a convenient way to destroy all remote objects managed by your Terraform configuration.</p><p>While you will typically not want to destroy long-lived objects in a production environment, Terraform is sometimes used to manage ephemeral infrastructure for development purposes, in which case you can use <code>terraform destroy</code> to conveniently clean up all of those temporary objects once you are finished with your work.</p><p>Now go and destroy all the Detectors and Dashboards that were previously applied!</p><div class=tab-panel data-tab-group=4c11c29d7381afe7047acc0012e7c9ba><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Destroy class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("4c11c29d7381afe7047acc0012e7c9ba","Destroy")'><div><div class=tab-nav-hidden>Destroy</div><div class=tab-nav-text>Destroy</div></div></button>
<button data-tab-item="Destroy Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("4c11c29d7381afe7047acc0012e7c9ba","Destroy Output")'><div><div class=tab-nav-hidden>Destroy Output</div><div class=tab-nav-text>Destroy Output</div></div></button></div><div class=tab-content-container><div data-tab-item=Destroy class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform destroy -var<span class=o>=</span><span class=s2>&#34;access_token=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span></span></span></code></pre></div></div></div><div data-tab-item="Destroy Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Destroy complete! Resources: 146 destroyed.</span></span></code></pre></div></div></div></div></div><p>Validate all the detectors have been removed by navigating to <em><strong>Alerts ‚Üí Detectors</strong></em></p><p><a href=#image-8dccde5dc436af967d536f9608d287ab class=lightbox-link><img src=../en/imt/monitoring-as-code/../images/destroy.png alt=Destroyed style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8dccde5dc436af967d536f9608d287ab><img src=../en/imt/monitoring-as-code/../images/destroy.png alt=Destroyed class=lightbox-image loading=lazy></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Terraform is a tool for building, changing, and versioning infrastructure safely and efficiently. Terraform can manage existing and popular service providers as well as custom in-house solutions.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>A provider is responsible for understanding API interactions and exposing resources. Providers generally are an IaaS (e.g. Alibaba Cloud, AWS, GCP, Microsoft Azure, OpenStack), PaaS (e.g. Heroku), or SaaS services (e.g. Splunk, Terraform Cloud, DNSimple, Cloudflare).&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=service-bureau>Service Bureau</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
10 minutes</button></span><ul><li>How to keep track of the usage of Observability Cloud in your organization</li><li>Learn how to keep track of spend by exploring the Subscription Usage interface</li><li>Creating Teams</li><li>Adding notification rules to Teams</li><li>Controlling usage</li></ul><hr><h2 id=1-understanding-engagement>1. Understanding engagement</h2><p>To fully understand Observability Cloud engagement inside your organization, click on the <strong>&#187;</strong> bottom left and select the <strong>Settings ‚Üí Organization Overview</strong>, this will provide you with the following dashboards that shows you how your Observability Cloud organization is being used:</p><p><a href=#image-ea82b04d01bd9acfe2e514bcc53c2992 class=lightbox-link><img src=../en/imt/servicebureau/../images/engagement.png alt="Organization overview" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ea82b04d01bd9acfe2e514bcc53c2992><img src=../en/imt/servicebureau/../images/engagement.png alt="Organization overview" class=lightbox-image loading=lazy></a></p><p>You will see various dashboards such as Throttling, System Limits, Entitlements & Engagement. The workshop organization you&rsquo;re using now may have less data to work with as this is cleared down after each workshop.</p><p>Take a minute to explore the various dashboards and charts in the Organization Overview of this workshop instance.</p><h2 id=2-subscription-usage>2. Subscription Usage</h2><p>If you want to see what your usage is against your subscription you can select <strong>Subscription Usage</strong>.</p><p><a href=#image-aa48dd7fb8c329cdc316047146af5025 class=lightbox-link><img src=../en/imt/servicebureau/../images/billing-and-usage-menu.png alt="Left pane" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-aa48dd7fb8c329cdc316047146af5025><img src=../en/imt/servicebureau/../images/billing-and-usage-menu.png alt="Left pane" class=lightbox-image loading=lazy></a></p><p>This screen may take a few seconds to load whilst it calculates and pulls in the usage.</p><h2 id=3-understanding-usage>3. Understanding usage</h2><p>You will see a screen similar to the one below that will give you an overview of the current usage, the average usage and your entitlement per category: Hosts, Containers, Custom Metrics and High Resolution Metrics.</p><p>For more information about these categories please refer to <a href=https://docs.splunk.com/Observability/admin/monitor-imm-billing-usage.html target=_blank>Monitor Splunk Infrastructure Monitoring subscription usage</a>.</p><p><a href=#image-4cec638b1f69da0835a3f5d3c9225d03 class=lightbox-link><img src=../en/imt/servicebureau/../images/usage-charts.png alt="Billing and Usage" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4cec638b1f69da0835a3f5d3c9225d03><img src=../en/imt/servicebureau/../images/usage-charts.png alt="Billing and Usage" class=lightbox-image loading=lazy></a></p><hr><h2 id=4-examine-usage-in-detail>4. Examine usage in detail</h2><p>The top chart shows you the current subscription levels per category (shown by the red arrows at the top in the screenshot below).</p><p>Also, your current usage of the four catagories is displayed (shown at the red lines at the bottom of the chart).</p><p>In this example you can see that there are 25 Hosts, 0 Containers, 100 Custom Metrics and 0 High Resolution Metrics.</p><p><a href=#image-1e0aa3289056b2ca127cc0a0b9148b07 class=lightbox-link><img src=../en/imt/servicebureau/../images/usage-detail.png alt="Billing and Usage-top" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1e0aa3289056b2ca127cc0a0b9148b07><img src=../en/imt/servicebureau/../images/usage-detail.png alt="Billing and Usage-top" class=lightbox-image loading=lazy></a></p><p>In the bottom chart, you can see the usage per category for the current period (shown in the drop-down box on the top right of the chart).</p><p>The blue line marked <strong>Average Usage</strong> indicates what Observability Cloud will use to calculate your average usage for the current Subscription Usage Period.</p><p><a href=#image-79d059a2b77afaec0b8f61c7cfed6fd3 class=lightbox-link><img src=../en/imt/servicebureau/../images/usage-trends.png alt="Billing and Usage-Bottom" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-79d059a2b77afaec0b8f61c7cfed6fd3><img src=../en/imt/servicebureau/../images/usage-trends.png alt="Billing and Usage-Bottom" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>As you can see from the screenshot, Observability Cloud does not use High Watermark or P95% for cost calculation but the actual average hourly usage, allowing you to do performance testing or Blue/Green style deployments etc. without the risk of overage charges.</p></div></div><p>To get a feel for the options you can change the metric displayed by selecting the different options from the <strong>Usage Metric</strong> drop down on the left, or change the <strong>Subscription Usage Period</strong> with the drop down on the right.</p><p>Please take a minute to explore the different time periods & categories and their views.</p><p>Finally, the pane on the right shows you information about your Subscription.</p><p><a href=#image-dadf60069527e4fad928caa9eb125d4b class=lightbox-link><img src=../en/imt/servicebureau/../images/subscription.png alt="Billing and Usage-Pane" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-dadf60069527e4fad928caa9eb125d4b><img src=../en/imt/servicebureau/../images/subscription.png alt="Billing and Usage-Pane" class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Service Bureau</h1><article class=default><header class=headline></header><h1 id=teams>Teams</h1><ul><li>Introduction to Teams</li><li>Create a Team and add members to Team</li></ul><hr><h2 id=1-introduction-to-teams>1. Introduction to Teams</h2><p>To make sure that users see the dashboards and alerts that are relevant to them when using Observability Cloud, most organizations will use Observability Cloud&rsquo;s Teams feature to assign a member to one or more Teams.</p><p>Ideally, this matches work related roles, for example, members of a Dev-Ops or Product Management group would be assigned to the corresponding Teams in Observability Cloud.</p><p>When a user logs into Observability Cloud, they can choose which Team Dashboard will be their home page and they will typically select the page for their primary role.</p><p>In the example below, the user is a member of the Development, Operations and Product Management Teams, and is currently viewing the Dashboard for the Operations Team.</p><p>This Dashboard has specific Dashboard Groups for Usage, SaaS and APM Business Workflows assigned but any Dashboard Group can be linked to a Teams Dashboard.</p><p>They can use the menu along the top left to quickly navigate between their allocated teams, or they can use the <strong>ALL TEAMS</strong> dropdown on the right to select specific Team Dashboards, as well as quickly accessing <strong>ALL Dashboards</strong> using the adjacent link.</p><p><a href=#image-0477e4b7b974cabcc656d2fdb2d5dcad class=lightbox-link><img src=../en/imt/servicebureau/teams/../../images/teams-homepage.png alt=Teams style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0477e4b7b974cabcc656d2fdb2d5dcad><img src=../en/imt/servicebureau/teams/../../images/teams-homepage.png alt=Teams class=lightbox-image loading=lazy></a></p><p>Alerts can be linked to specific Teams so the Team can monitor only the Alerts they are interested in, and in the above example they currently have 1 active Critical Alert.</p><p>The Description for the Team Dashboard can be customized and can include links to team specific resources (using Markdown).</p><hr><h2 id=2-creating-a-new-team>2. Creating a new Team</h2><p>To work with to Splunk&rsquo;s Team UI click on the hamburger icon top left and select the <strong>Organizations Settings ‚Üí Teams</strong>.</p><p>When the <strong>Team</strong> UI is selected you will be presented with the list of current Teams.</p><p>To add a new <strong>Team</strong> click on the
<span class="btn cstyle blue"><button type=button>
Create New Team</button></span> button. This will present you with the <strong>Create New Team</strong> dialog.</p><p><a href=#image-657c0972c6c5d0de73716e81d0942e7c class=lightbox-link><img src=../en/imt/servicebureau/teams/../../images/create-new-team.png alt="Add Team" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-657c0972c6c5d0de73716e81d0942e7c><img src=../en/imt/servicebureau/teams/../../images/create-new-team.png alt="Add Team" class=lightbox-image loading=lazy></a></p><p>Create your own team by naming it <code>[YOUR-INITIALS]-Team and</code> add yourself by searching for your name and selecting the <strong>Add</strong> link next to your name. This should result in a dialog similar to the one below:</p><p><a href=#image-52e7bba52ae802372ef30279f594a4cb class=lightbox-link><img src=../en/imt/servicebureau/teams/../../images/add-to-team.png alt="Add Team complete" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-52e7bba52ae802372ef30279f594a4cb><img src=../en/imt/servicebureau/teams/../../images/add-to-team.png alt="Add Team complete" class=lightbox-image loading=lazy></a></p><p>You can remove selected users by pressing <strong>Remove</strong> or the small <strong>x</strong>.</p><p>Make sure you have your group created with your initials and with yourself added as a member, then click
<span class="btn cstyle blue"><button type=button>
Done</button></span></p><p>This will bring you back to the <strong>Teams</strong> list that will now show your Team and the one&rsquo;s created by others.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>The Teams(s) you are a member of have a grey <strong>Member</strong> icon in front of it.</p></div></div><p>If no members are assigned to your Team, you should see a blue <strong>Add Members</strong> link instead of the member count, clicking on that link will get you to the <strong>Edit Team</strong> dialog where you can add yourself.</p><p>This is the same dialog you get when pressing the 3 dots <strong>&mldr;</strong> at the end of the line with your Team and selecting <strong>Edit Team</strong></p><p>The <strong>&mldr;</strong> menu gives you the option to Edit, Join, Leave or Delete a Team (leave and join will depend on if you are currently a member).</p><hr><h2 id=3-adding-notification-rules>3. Adding Notification Rules</h2><p>You can set up specific Notification rules per team, click on the <strong>Notification Policy</strong> tab, this will open the notification edit menu.</p><p><a href=#image-735adb69419081ad97c2a436a1f1cb19 class=lightbox-link><img src=../en/imt/servicebureau/teams/../../images/notification-policy.png alt="Base notification menu" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-735adb69419081ad97c2a436a1f1cb19><img src=../en/imt/servicebureau/teams/../../images/notification-policy.png alt="Base notification menu" class=lightbox-image loading=lazy></a></p><p>By default the system offers you the ability to set up a general notification rule for your team.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>The <strong>Email all team members</strong> option means all members of this Team will receive an email with the Alert information, regardless of the alert type.</p></div></div><h3 id=31-adding-recipients>3.1 Adding recipients</h3><p>You can add other recipients, by clicking
<span class="btn cstyle blue"><button type=button>
Add Recipient</button>
</span>. These recipients do not need to be Observability Cloud users.</p><p>However if you click on the link <strong>Configure separate notification tiers for different severity alerts</strong> you can configure every alert level independently.</p><p><a href=#image-d78b4a668ee1c796b0c1c6bca6456d8b class=lightbox-link><img src=../en/imt/servicebureau/teams/../../images/single-policy.png alt="Multiple Notifications" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d78b4a668ee1c796b0c1c6bca6456d8b><img src=../en/imt/servicebureau/teams/../../images/single-policy.png alt="Multiple Notifications" class=lightbox-image loading=lazy></a></p><p>Different alert rules for the different alert levels can be configured, as shown in the above image.</p><p>Critical and Major are using <a href=https://www.splunk.com/en_us/observability/on-call.html target=_blank>Splunk's On-Call</a> Incident Management solution. For the Minor alerts we send it to the Teams Slack channel and for Warning and Info we send an email.</p><h3 id=32-notification-integrations>3.2 Notification Integrations</h3><p>In addition to sending alert notifications via email, you can configure Observability Cloud to send alert notifications to the services shown below.</p><p><a href=#image-843155f731629ac44134f11c675f3031 class=lightbox-link><img src=../en/imt/servicebureau/teams/../../images/integrations.png alt="Notifications options" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-843155f731629ac44134f11c675f3031><img src=../en/imt/servicebureau/teams/../../images/integrations.png alt="Notifications options" class=lightbox-image loading=lazy></a></p><p>Take a moment to create some notification rules for you Team.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=controlling-usage>Controlling Usage</h1><ul><li>Discover how you can restrict usage by creating separate Access Tokens and set limits.</li></ul><h2 id=1-access-tokens>1. Access Tokens</h2><p>If you wish to control the consumption of Hosts, Containers, Custom Metrics and High Resolution Metrics, you can create multiple Access Tokens and allocate them to different parts of your organization.</p><p>In the UI click on the <strong>&#187;</strong> bottom left and select the <strong>Settings ‚Üí Access Tokens</strong> under <strong>General Settings</strong>.</p><p>The <strong>Access Tokens</strong> Interface provides an overview of your allotments in the form of a list of Access Tokens that have been generated. Every Organization will have a <strong>Default</strong> token generated when they are first setup, but there will typically be multiple Tokens configured.</p><p>Each Token is unique and can be assigned limits for the amount of Hosts, Containers, Custom Metrics and High Resolution Metrics it can consume.</p><p>The <strong>Usage Status</strong> Column quickly shows if a token is above or below its assigned limits.</p><p><a href=#image-6ad34b1c77cceb13fba8f8633b01c3ac class=lightbox-link><img src=../en/imt/servicebureau/tokens/../../images/access-tokens.png alt="New token" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6ad34b1c77cceb13fba8f8633b01c3ac><img src=../en/imt/servicebureau/tokens/../../images/access-tokens.png alt="New token" class=lightbox-image loading=lazy></a></p><h2 id=2-creating-a-new-token>2. Creating a new token</h2><p>Let create a new token by clicking on the
<span class="btn cstyle blue"><button type=button>
New Token</button></span> button. This will provide you with the <strong>Name Your Access Token</strong> dialog.</p><p>Enter the new name of the new Token by using your Initials e.g. RWC-Token and make sure to tick both <strong>Ingest Token</strong> and <strong>API Token</strong> checkboxes!</p><p><a href=#image-d2041a5fa6f97d9a8d459f685e659a22 class=lightbox-link><img src=../en/imt/servicebureau/tokens/../../images/new-access-token.png alt="Name Your token" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d2041a5fa6f97d9a8d459f685e659a22><img src=../en/imt/servicebureau/tokens/../../images/new-access-token.png alt="Name Your token" class=lightbox-image loading=lazy></a></p><p>After you press
<span class="btn cstyle blue"><button type=button>
OK</button></span> you will be taken back to the <strong>Access Token</strong> UI. Here your new token should be present, among the ones created by others.</p><p><a href=#image-bd76b95060779611188231768973b520 class=lightbox-link><img src=../en/imt/servicebureau/tokens/../../images/access-token-created.png alt="full tokenlist" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-bd76b95060779611188231768973b520><img src=../en/imt/servicebureau/tokens/../../images/access-token-created.png alt="full tokenlist" class=lightbox-image loading=lazy></a></p><p>If you have made an error in your naming, want to disable/enable a token or set a Token limit, click on the ellipsis (<strong>&mldr;</strong>) menu button behind a token limit to open the manage token menu.</p><p><a href=#image-47d3d1adaaa8a1f073ae96d13ff94a9a class=lightbox-link><img src=../en/imt/servicebureau/tokens/../../images/manage-access-token.png alt="Show Menu" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-47d3d1adaaa8a1f073ae96d13ff94a9a><img src=../en/imt/servicebureau/tokens/../../images/manage-access-token.png alt="Show Menu" class=lightbox-image loading=lazy></a></p><p>If you made a typo you can use the <strong>Rename Token</strong> option to correct the name of your token.</p><h2 id=3-disabling-a-token>3. Disabling a token</h2><p>If you need to make sure a token cannot be used to send Metrics in you can disable a token.</p><p>Click on <strong>Disable</strong> to disable the token, this means the token cannot be used for sending in data to Splunk Observability Cloud.</p><p>The line with your token should have become greyed out to indicate that is has been disabled as you can see in the screenshot below.</p><p><a href=#image-b0150da8e7e3d1b05f77f582aef5a2c1 class=lightbox-link><img src=../en/imt/servicebureau/tokens/../../images/disable-access-token.png alt="Token disabled" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b0150da8e7e3d1b05f77f582aef5a2c1><img src=../en/imt/servicebureau/tokens/../../images/disable-access-token.png alt="Token disabled" class=lightbox-image loading=lazy></a></p><p>Go ahead and click on the ellipsis (<strong>&mldr;</strong>) menu button to Disable and Enable your token.</p><h2 id=4-manage-token-usage-limits>4. Manage token usage limits</h2><p>Now Lets start limiting usage by clicking on Manage Token Limit in the 3 <strong>&mldr;</strong> menu.</p><p>This will show the Manage Token Limit Dialog:</p><p><a href=#image-213c916d811da6abd345a4bf5bda3bdc class=lightbox-link><img src=../en/imt/servicebureau/tokens/../../images/manage-token-limit.png alt="Set Limits on token" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-213c916d811da6abd345a4bf5bda3bdc><img src=../en/imt/servicebureau/tokens/../../images/manage-token-limit.png alt="Set Limits on token" class=lightbox-image loading=lazy></a></p><p>In this Dialog you can set the limits per category.</p><p>Please go ahead and specify the limits as follows for each usage metric:</p><table><thead><tr><th>Limit</th><th>Value</th></tr></thead><tbody><tr><td>Host Limit</td><td>5</td></tr><tr><td>Container Limit</td><td>15</td></tr><tr><td>Custom Metric Limit</td><td>20</td></tr><tr><td>High Resolution Metric Limit</td><td>0</td></tr></tbody></table><p>For our lab use your own email address, and double check that you have the correct numbers in your dialog box as shown in the table above.</p><p>Token limits are used to trigger an alert that notify one or more recipients when the usage has been above 90% of the limit for 5 minutes.</p><p>To specify the recipients, click
<span class="btn cstyle blue"><button type=button>
Add Recipient</button>
</span>, then select the recipient or notification method you want to use (specifying recipients is optional but highly recommended).</p><p>The severity for token alerts is always Critical.</p><p>Click on
<span class="btn cstyle blue"><button type=button>
Update</button></span> to save your Access Tokens limits and The Alert Settings.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note: Going above token limit</div><div class=box-content><p>When a token is at or above its limit in a usage category, new metrics for that usage category will not be stored and processed by Observability Cloud. This will make sure you there will be no unexpected cost due to a team sending in data without restriction.</p></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note: Advanced alerting</div><div class=box-content><p>If you wish to get alerts before you hit 90%, you can create additional detectors using whatever values you want. These detectors could target the Teams consuming the specific Access Tokens so they can take action before the admins need to get involved.</p></div></div><p>In your company you would distribute these new Access Tokens to various teams, controlling how much information/data they can send to Observability Cloud.</p><p>This will allow you to fine tune the way you consume your Observability Cloud allotment and prevent overages from happening.</p><p><strong>Congratulations!</strong> You have now have completed the Service Bureau module.</p><footer class=footline></footer></article></section></section><article class=default><header class=headline></header><h1 id=splunk-apm>Splunk APM</h1><p>Splunk APM is a NoSample‚Ñ¢ Full-fidelity application performance monitoring and troubleshooting solution for cloud-native, microservices-based applications.</p><p>By collecting all traces, instead of a sampled subset, no anomaly goes undetected. Whether a user experiences an error or longer-than-usual latency, you‚Äôll be able to know and act on it within seconds. Furthermore, not all bad behavior results in errors ‚Äî as your developers create new applications they need to know whether their canary releases provide the expected results. Only by collecting all trace data will you ensure that your cloud-native applications behave the way they are supposed to.</p><p>Infrastructure and application performance are interdependent. To see the full picture, Splunk APM provides seamless correlation between cloud infrastructure and the microservices running on top of it. If your application acts out because of memory leakage, a noisy neighbor container or any other infrastructure-related issue, Splunk will let you know. To complete the picture, in-context access to Splunk logs and events enable deeper troubleshooting and root-cause analysis.</p><p><a href=#image-daa68964b3c140808f9837e7e9829537 class=lightbox-link><img src=../en/apm/images/arch-overview.png alt="Architecture Overview" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-daa68964b3c140808f9837e7e9829537><img src=../en/apm/images/arch-overview.png alt="Architecture Overview" class=lightbox-image loading=lazy></a></p><div class="children children-h3 children-sort-"><h3><a href=../en/apm/online-boutique/index.html>1. The Online Boutique</a></h3><p>Verify the Online Boutique application is deployed into Kubernetes (K3s) and generate some artificial traffic using a Load Generator (Locust).</p><h3><a href=../en/apm/using-splunk-apm/index.html>2. Using Splunk APM</a></h3><p>An overview of how to use Splunk APM</p></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk APM</h1><article class=default><header class=headline></header><h1 id=1-the-online-boutique>1. The Online Boutique</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
15 minutes</button></span><ul><li><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong></span></span> Deploy the Online Boutique application in Kubernetes</li><li>Verify the application is running</li><li>Generate some artificial traffic using Locust</li><li>See APM metrics in the UI</li></ul><hr><div class=expand><input type=checkbox id=expand-a05c891e54841cbca8ae46bead723f13 aria-controls=expandcontent-a05c891e54841cbca8ae46bead723f13>
<label class=expand-label for=expand-a05c891e54841cbca8ae46bead723f13><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong> - Deploy the Online Boutique</span></span></label><div id=expandcontent-a05c891e54841cbca8ae46bead723f13 class=expand-content><h2 id=1-check-your-ec2-server>1. Check your EC2 server</h2><p>This workshop module assumes you are completing this after you have run the IM workshop, and still have access to your EC2 instance.</p><p>If this is the case, continue with <a href=#2-deploy-online-boutique>Deploy Online Boutique</a>, otherwise if you have received a fresh instance, please run the first two (2) sections of <a href=../en/apm/online-boutique/../../imt/gdi/>Deploy the OTel Collector</a> to get the system ready for the APM workshop, then continue with the next section.</p><h2 id=2-deploy-online-boutique>2. Deploy Online Boutique</h2><p>To deploy the Online Boutique application into K3s, run the <code>apm-config.sh</code> script, then apply the deployment:</p><div class=tab-panel data-tab-group=66aa466508abb2f5feee2213b5989f94><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Deploy Online Boutique" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("66aa466508abb2f5feee2213b5989f94","Deploy Online Boutique")'><div><div class=tab-nav-hidden>Deploy Online Boutique</div><div class=tab-nav-text>Deploy Online Boutique</div></div></button>
<button data-tab-item="Deployment Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("66aa466508abb2f5feee2213b5989f94","Deployment Output")'><div><div class=tab-nav-hidden>Deployment Output</div><div class=tab-nav-text>Deployment Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Deploy Online Boutique" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/apm
</span></span><span class=line><span class=cl>./apm-config.sh
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item="Deployment Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>APM Only Deployment
</span></span><span class=line><span class=cl>deployment.apps/recommendationservice created
</span></span><span class=line><span class=cl>service/recommendationservice created
</span></span><span class=line><span class=cl>deployment.apps/productcatalogservice created
</span></span><span class=line><span class=cl>service/productcatalogservice created
</span></span><span class=line><span class=cl>deployment.apps/cartservice created
</span></span><span class=line><span class=cl>service/cartservice created
</span></span><span class=line><span class=cl>deployment.apps/adservice created
</span></span><span class=line><span class=cl>service/adservice created
</span></span><span class=line><span class=cl>deployment.apps/paymentservice created
</span></span><span class=line><span class=cl>service/paymentservice created
</span></span><span class=line><span class=cl>deployment.apps/loadgenerator created
</span></span><span class=line><span class=cl>service/loadgenerator created
</span></span><span class=line><span class=cl>deployment.apps/shippingservice created
</span></span><span class=line><span class=cl>service/shippingservice created
</span></span><span class=line><span class=cl>deployment.apps/currencyservice created
</span></span><span class=line><span class=cl>service/currencyservice created
</span></span><span class=line><span class=cl>deployment.apps/redis-cart created
</span></span><span class=line><span class=cl>service/redis-cart created
</span></span><span class=line><span class=cl>deployment.apps/checkoutservice created
</span></span><span class=line><span class=cl>service/checkoutservice created
</span></span><span class=line><span class=cl>deployment.apps/frontend created
</span></span><span class=line><span class=cl>service/frontend created
</span></span><span class=line><span class=cl>service/frontend-external created
</span></span><span class=line><span class=cl>deployment.apps/emailservice created
</span></span><span class=line><span class=cl>service/emailservice created
</span></span><span class=line><span class=cl>deployment.apps/rum-loadgen-deployment created</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> In case of a message about a VARIABLE being unset</div><div class=box-content><p>Delete the deployment running <code>kubectl delete -f deployment.yaml</code>.</p><p>Then, export the variable as described in the guide/message, followed by re-running the deployment script above.</p></div></div><p>To ensure the Online Boutique application is running:</p><div class=tab-panel data-tab-group=8adf5195e3f0eca11f80a09361850d22><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Get Pods" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("8adf5195e3f0eca11f80a09361850d22","Get Pods")'><div><div class=tab-nav-hidden>Get Pods</div><div class=tab-nav-text>Get Pods</div></div></button>
<button data-tab-item="Get Pods Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("8adf5195e3f0eca11f80a09361850d22","Get Pods Output")'><div><div class=tab-nav-hidden>Get Pods Output</div><div class=tab-nav-text>Get Pods Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Get Pods" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item="Get Pods Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                       READY  STATUS  RESTARTS      AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-849cf595bf-l7mnq 1/1   Running   0           31m
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-pxrgp                           2/2   Running   0           31m
</span></span><span class=line><span class=cl>productcatalogservice-8464cd56d-n8f89                       1/1   Running   0            1m
</span></span><span class=line><span class=cl>redis-cart-bcf44df97-djv6z                                  1/1   Running   0            1m
</span></span><span class=line><span class=cl>checkoutservice-8558fd7b95-b9pn8                            1/1   Running   0            1m
</span></span><span class=line><span class=cl>shippingservice-7cc4bdd6f4-xsvnx                            1/1   Running   0            1m
</span></span><span class=line><span class=cl>recommendationservice-647d57fd44-l7tkq                      1/1   Running   0            1m
</span></span><span class=line><span class=cl>frontend-66c5d589d-55vzb                                    1/1   Running   0            1m
</span></span><span class=line><span class=cl>emailservice-6ff5bbd67d-pdcm2                               1/1   Running   0            1m
</span></span><span class=line><span class=cl>paymentservice-6866558995-8xmf2                             1/1   Running   0            1m
</span></span><span class=line><span class=cl>currencyservice-8668d75d6f-mr68h                            1/1   Running   0            1m
</span></span><span class=line><span class=cl>rum-loadgen-deployment-58ccf7bd8f-cr4pr                     1/1   Running   0            1m
</span></span><span class=line><span class=cl>rum-loadgen-deployment-58ccf7bd8f-qjr4b                     1/1   Running   0            1m
</span></span><span class=line><span class=cl>rum-loadgen-deployment-58ccf7bd8f-fvb4x                     1/1   Running   0            1m
</span></span><span class=line><span class=cl>cartservice-7b58c88c45-xvxhq                                1/1   Running   0            1m
</span></span><span class=line><span class=cl>loadgenerator-6bdc7b4857-9kxjd                              1/1   Running   2 (49s ago)  1m
</span></span><span class=line><span class=cl>adservice-7b68d5b969-89ft2                                  1/1   Running   0            1m</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>Usually it should only take around 1min 30secs for the pods to transition into a Running state.</p></div></div></div></div><h2 id=validate-online-boutique-is-deployed>Validate Online Boutique is deployed</h2><p>In the Splunk UI click on <strong>Infrastructure</strong> this will bring you to the Infrastructure Overview dashboard, then click on <strong>Kubernetes</strong>.</p><p>Use the <strong>Cluster</strong> dropdown to select the cluster name, you will see the new pods started and containers deployed. When you click on your Cluster in the Splunk UI you should have a view that looks like below:</p><p><a href=#image-646cf0544e70896cf508d598cec8131a class=lightbox-link><img src=../en/apm/online-boutique/../images/online-boutique-k8s.png alt="Back to cluster" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-646cf0544e70896cf508d598cec8131a><img src=../en/apm/online-boutique/../images/online-boutique-k8s.png alt="Back to cluster" class=lightbox-image loading=lazy></a></p><p>If you select the <strong>WORKLOADS</strong> tab again you should now see that there are a number of Deployments and ReplicaSets:</p><p><a href=#image-77859f41feda62821cfd4e30e5691b4d class=lightbox-link><img src=../en/apm/online-boutique/../images/online-boutique-workload.png alt="Online Boutique loaded" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-77859f41feda62821cfd4e30e5691b4d><img src=../en/apm/online-boutique/../images/online-boutique-workload.png alt="Online Boutique loaded" class=lightbox-image loading=lazy></a></p><h2 id=visit-the-online-boutique>Visit the Online Boutique</h2><div class=expand><input type=checkbox id=expand-6545f5e59ec0c86db3989734f67a7fad aria-controls=expandcontent-6545f5e59ec0c86db3989734f67a7fad>
<label class=expand-label for=expand-6545f5e59ec0c86db3989734f67a7fad><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong> - Visit the Online Boutique you just deployed</span></span></label><div id=expandcontent-6545f5e59ec0c86db3989734f67a7fad class=expand-content><div class="box notices cstyle blue"><div class=box-label></div><div class=box-content><p>The Online Boutique is viewable on port 81 of the EC2 instance&rsquo;s IP address. The IP address is the one you used to SSH into the instance at the beginning of the workshop.</p><p>Open your web browser and go to <code>http://&lt;ec2-ip-address>:81/</code> where you will then be able to see the Online Boutique running.</p></div></div></div></div><p>Your Workshop instructor will provide you with URL to access the Online Boutique. Enter this URL into your browser and you will see the Online Boutique homepage.</p><p><a href=#image-4e67a70378ba6558ba79254054b28f44 class=lightbox-link><img src=../en/apm/online-boutique/../images/online-boutique.png alt="Online Boutique" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4e67a70378ba6558ba79254054b28f44><img src=../en/apm/online-boutique/../images/online-boutique.png alt="Online Boutique" class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of 1. The Online Boutique</h1><article class=default><header class=headline></header><h1 id=11-generate-load>1.1 Generate load</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
5 minutes</button></span><h2 id=1-generate-traffic>1. Generate traffic</h2><p>The Online Boutique deployment contains a container running Locust that we can use to generate load traffic against the website to generate metrics, traces and spans.</p><div class=expand><input type=checkbox id=expand-46a7fba59260ae8a2dbd608b9d5910dc aria-controls=expandcontent-46a7fba59260ae8a2dbd608b9d5910dc>
<label class=expand-label for=expand-46a7fba59260ae8a2dbd608b9d5910dc><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong> - Access your Locust instance</span></span></label><div id=expandcontent-46a7fba59260ae8a2dbd608b9d5910dc class=expand-content><div class="box notices cstyle blue"><div class=box-label></div><div class=box-content><p>Locust is available on port 82 of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and go to <code>http://&lt;ec2-ip-address>:82/</code>, you will then be able to see the Locust running.</p></div></div></div></div><p>Your Workshop instructor will provide you with URL to access the Locust load generator. Enter this URL into your browser and you will see the Locust Start new load test landing page.</p><p><a href=#image-f6054027818fca95cbf7f5437f2cb06a class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/locust.png alt=Locust style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f6054027818fca95cbf7f5437f2cb06a><img src=../en/apm/online-boutique/locust/../../images/locust.png alt=Locust class=lightbox-image loading=lazy></a></p><p>Set the <strong>Spawn rate</strong> to be 2 and click <strong>Start Swarming</strong>, this will start a gentle continuous load on the application.</p><p><a href=#image-44480343eec330ba17e5409c7572cc12 class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/locust-spawn-rate.png alt="Spawn Rate" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-44480343eec330ba17e5409c7572cc12><img src=../en/apm/online-boutique/locust/../../images/locust-spawn-rate.png alt="Spawn Rate" class=lightbox-image loading=lazy></a></p><p><a href=#image-242ee8351a1e1cd01cc7ab3e0731d05a class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/locust-statistics.png alt=Statistics style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-242ee8351a1e1cd01cc7ab3e0731d05a><img src=../en/apm/online-boutique/locust/../../images/locust-statistics.png alt=Statistics class=lightbox-image loading=lazy></a></p><hr><p>Now go to <strong>Dashboards ‚Üí All Dashboards ‚Üí APM Services ‚Üí Service</strong>.</p><p>For this we need to know the name of your application environment. In this workshop all the environments use: <code>&lt;hostname>-apm-env</code>.</p><p>To find the hostname, on the AWS/EC2 instance run the following command:</p><div class=tab-panel data-tab-group=603b4234a771c8264fd3ab280d5f91ed><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Echo Hostname" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("603b4234a771c8264fd3ab280d5f91ed","Echo Hostname")'><div><div class=tab-nav-hidden>Echo Hostname</div><div class=tab-nav-text>Echo Hostname</div></div></button>
<button data-tab-item="Output Example" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("603b4234a771c8264fd3ab280d5f91ed","Output Example")'><div><div class=tab-nav-hidden>Output Example</div><div class=tab-nav-text>Output Example</div></div></button></div><div class=tab-content-container><div data-tab-item="Echo Hostname" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=k>$(</span>hostname<span class=k>)</span>-apm-env</span></span></code></pre></div></div></div><div data-tab-item="Output Example" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>bdzx-apm-env</span></span></code></pre></div></div></div></div></div><p>Select your environment you found in the previous step then select the <code>frontend</code> service and set time to Past 15 minutes.</p><p><a href=#image-79ff51489b432f937b0a744797a24bb9 class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/online-boutique-service-dashboard.png alt="APM Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-79ff51489b432f937b0a744797a24bb9><img src=../en/apm/online-boutique/locust/../../images/online-boutique-service-dashboard.png alt="APM Dashboard" class=lightbox-image loading=lazy></a></p><p>With this automatically generated dashboard you can keep an eye out for the health of your service(s) using RED (Rate, Error & Duration) metrics. It provides various performance related charts as well as correlated information on the underlying host and Kubernetes pods (if applicable).</p><p>Take some time to explore the various charts in this dashboard</p><hr><h2 id=2-verify-splunk-apm-metrics>2. Verify Splunk APM metrics</h2><p>In the left hand menu card click on <strong>APM</strong> this will bring you to the APM Overview dashboard:</p><p><a href=#image-0bb6c16379f81ca74124d1db5f427c9d class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/online-boutique-apm.png alt="select APM" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0bb6c16379f81ca74124d1db5f427c9d><img src=../en/apm/online-boutique/locust/../../images/online-boutique-apm.png alt="select APM" class=lightbox-image loading=lazy></a></p><p>Select the <strong>Explore</strong> on the right hand side and select your environment you found before and set the time to 15 minutes. This will show you the automatically generated Dependency/Service Map for the Online Boutique application.</p><p>It should look similar to the screenshot below:</p><p><a href=#image-6599f760f5fa2c62c657d3353700b2ef class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/online-boutique-map.png alt="Online Boutique in APM" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6599f760f5fa2c62c657d3353700b2ef><img src=../en/apm/online-boutique/locust/../../images/online-boutique-map.png alt="Online Boutique in APM" class=lightbox-image loading=lazy></a></p><p>The legend at the bottom of the page explains the different visualizations in the Dependency/Service Map.</p><p><a href=#image-033df2cda274e52bdc94153cff3ac417 class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/apm-legend.png alt="APM Legend" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-033df2cda274e52bdc94153cff3ac417><img src=../en/apm/online-boutique/locust/../../images/apm-legend.png alt="APM Legend" class=lightbox-image loading=lazy></a></p><ul><li>Service requests, error rate and root error rate.</li><li>Request rate, latency and error rate</li></ul><p>Also in this view you can see the overall Error and Latency rates over time charts.</p><h2 id=3-opentelemetry-dashboard>3. OpenTelemetry Dashboard</h2><p>Once the Open Telemetery Collector is deployed the platform will automatically provide a built in dashboard display OpenTelemetry Collector metrics.</p><p>From the top left hamburger menu <strong>Dashboards ‚Üí OpenTelemetry Collector</strong>, scroll all the way to the bottom of the page and validate metrics and spans are being sent:</p><p><a href=#image-c95ca90d283ee28955118bcff0718920 class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/otel-dashboard.png alt="OpenTelemetry Collector dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c95ca90d283ee28955118bcff0718920><img src=../en/apm/online-boutique/locust/../../images/otel-dashboard.png alt="OpenTelemetry Collector dashboard" class=lightbox-image loading=lazy></a></p><h2 id=4-opentelemetry-zpages>4. OpenTelemetry zpages</h2><p>To debug the traces being sent you can use the zpages extension. <a href=https://github.com/open-telemetry/opentelemetry-specification/blob/main/experimental/trace/zpages.md#tracez target=_blank>zpages</a> are part of the OpenTelemetry collector and provide live data for troubleshooting and statistics.</p><div class=expand><input type=checkbox id=expand-c02bb54224879875c4c75c77c15446cf aria-controls=expandcontent-c02bb54224879875c4c75c77c15446cf>
<label class=expand-label for=expand-c02bb54224879875c4c75c77c15446cf><i class="fas fa-chevron-down"></i>
<i class="fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-user-ninja"></i></span><span class=badge-content><strong>Ninja</strong> - Access zPages on your EC2 instance</span></span></label><div id=expandcontent-c02bb54224879875c4c75c77c15446cf class=expand-content><div class="box notices cstyle blue"><div class=box-label></div><div class=box-content><p>zPages is available on port <code>55679</code> of the EC2 instance&rsquo;s IP address. Open a new tab in your web browser and enter in <code>http://{==EC2-IP==}:55679/debug/tracez</code>, you will then be able to see the zpages output.</p><p>Alternatively, from your shell prompt you can run a text based browser:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lynx http://localhost:55679/debug/tracez</span></span></code></pre></div></div></div></div></div><p>Your Workshop instructor will provide you with a URL to access zPages. Enter this URL into your browser and you will see the zPages output.</p><p><a href=#image-e0fe95eef8fa6b0f3cc9eba358f41578 class=lightbox-link><img src=../en/apm/online-boutique/locust/../../images/zpages.png alt=zpages style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e0fe95eef8fa6b0f3cc9eba358f41578><img src=../en/apm/online-boutique/locust/../../images/zpages.png alt=zpages class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=2-using-splunk-apm>2. Using Splunk APM</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
15 minutes</button></span><ul><li>APM Overview - RED metrics</li><li>Using the Service Map</li><li>Introduction to Tag Spotlight</li><li>Example Traces</li><li>Contextual Links to Infra</li></ul><h2 id=1-traces-and-spans-explained>1. Traces and Spans explained</h2><p>A trace is a collection of spans that share the same trace ID, representing a unique transaction handled by your application and its constituent services.</p><p><a href=#image-4065d0a750f5e31daad72d6bc7e11c6d class=lightbox-link><img src=../en/apm/using-splunk-apm/../images/trace-spans.png alt="Traces and Spans" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4065d0a750f5e31daad72d6bc7e11c6d><img src=../en/apm/using-splunk-apm/../images/trace-spans.png alt="Traces and Spans" class=lightbox-image loading=lazy></a></p><p>Each span has a name, representing the operation captured by this span, and a service name, representing within which service the operation took place.</p><p>Additionally, spans may reference another span as their parent, defining the relationships between the operations captured in the trace that were performed to process that transaction.</p><p>Each span contains a lot of information about the method, operation, or block of code that it captures, including:</p><ul><li>the operation name</li><li>the start time of the operation with microsecond precision</li><li>how long the operation took to execute, also with microsecond precision</li><li>the logical name of the service on which the operation took place</li><li>the IP address of the service instance on which the operation took place</li></ul><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of 2. Using Splunk APM</h1><article class=default><header class=headline></header><h1 id=21-service-map>2.1 Service Map</h1><h2 id=service-map>Service Map</h2><p>Click on <strong>paymentservice</strong> in the service map and select <strong>version</strong> from the <code>breakdown</code> drop down filter underneath <strong>paymentservice</strong>. This will filter our service map by the custom span tag <strong>version</strong>.</p><p>You will now see the service map has been updated like the below screenshot to show the different versions of the <strong>paymentservice</strong>.</p><p>Splunk Observability shows that not only is paymentservice experiencing errors (you can see request rate vs error rate) but that this service is the root cause.</p><p>This happens automatically with our AI-directed triage capabilities once distributed tracing is enabled in your services. You don‚Äôt have to set a threshold or anything for it to populate just like this.</p><p>This is one example of how customers can detect issues faster and know where to look for errors and hence helps reduce the MTTD and MTTR.</p><p><a href=#image-58fa75d31efe7624ebd349ded8d8909f class=lightbox-link><img src=../en/apm/using-splunk-apm/service_map/../../images/paymentservice.png alt="Payment Service" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-58fa75d31efe7624ebd349ded8d8909f><img src=../en/apm/using-splunk-apm/service_map/../../images/paymentservice.png alt="Payment Service" class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=22-tag-spotlight>2.2 Tag Spotlight</h1><h2 id=tag-spotlight>Tag Spotlight</h2><p>On the right hand side of the screen scroll down on <strong>Tag Spotlight</strong>, ensure <strong>Top Across All Indexed Tags</strong> is selected in the dropdown click the full screen button as indicated in the screenshot below.</p><p><a href=#image-7f1c97dbfa3688ae91c4d8dfd6e70326 class=lightbox-link><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/tag-spotlight.png alt="Tag Spotlight" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7f1c97dbfa3688ae91c4d8dfd6e70326><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/tag-spotlight.png alt="Tag Spotlight" class=lightbox-image loading=lazy></a></p><p>The Tag Spotlight Page will be displayed. From this page you can view the top tags in your application and their corresponding error rates and request rates.</p><p>Note that for the <strong>version</strong> span tag it appears that version <code>350.10</code> has a 100% error rate and for our <strong>tenant.level</strong> span tag it shows that all three tenants (Gold, Silver & Bronze) have errors present.</p><p><a href=#image-6978d028060bcc5dff74188f464aa245 class=lightbox-link><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/tag-spotlight-dashboard.png alt="Tag Spotlight Dashboard" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6978d028060bcc5dff74188f464aa245><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/tag-spotlight-dashboard.png alt="Tag Spotlight Dashboard" class=lightbox-image loading=lazy></a></p><p>The Tag Spotlight page is interactive and allows you to add a tag as a filter by simply clicking on your desired tag. Click on <strong>gold</strong> under <strong>tenant.level</strong> to add it as a filter. Once this is done the page will now only display data with <strong>gold</strong> as it‚Äôs <strong>tenant.level</strong>.</p><p><a href=#image-8adc27791c63708211898332f5262480 class=lightbox-link><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/gold-tenant.png alt="Gold Tenant" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8adc27791c63708211898332f5262480><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/gold-tenant.png alt="Gold Tenant" class=lightbox-image loading=lazy></a></p><p>Tag Spotlight is very useful for analysing your data and spotting trends. We can see that for the Gold Tenant that out of the total number of requests, 55 of them are in error (this number will vary in your workshop).</p><p>If we correlate this to the version tag, we can see that version <code>350.10</code> served 55 requests and version <code>350.9</code> served 17 requests. This means that all of the requests that went through version <code>350.10</code> ended up in an error state.</p><p>In order to test this theory further that all of the requests from <strong>paymentservice</strong> version <code>350.10</code> result in an error, we can change our filter to another tenant by using the tag selector. Change your filter from <strong>gold</strong> tenant to <strong>silver</strong> tenant.</p><p><a href=#image-f7f782d9b4e3c3aa7f4ae7f6c82ac0e3 class=lightbox-link><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/silver-tag-filter.png alt="Silver Tag Filter" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f7f782d9b4e3c3aa7f4ae7f6c82ac0e3><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/silver-tag-filter.png alt="Silver Tag Filter" class=lightbox-image loading=lazy></a></p><p>Now we can perform a similar analysis by looking at the number of requests in error for the <strong>silver</strong> tenant and correlating that with the version number. Note the amount of errors for the <strong>silver</strong> tenant match the amount of requests for version <code>350.10</code>.</p><p><a href=#image-89a714451f8308a160219aeea6af9903 class=lightbox-link><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/silver-tenant.png alt="Silver Tenant" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-89a714451f8308a160219aeea6af9903><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/silver-tenant.png alt="Silver Tenant" class=lightbox-image loading=lazy></a></p><p>Tag Spotlight not only allows you to look at request and error rates but also at the latency per service. In order to do this just select the latency button and remove your Silver Tenant Tag so that you can see the latency for all of the Payment Service.</p><p><a href=#image-11171b1833ac10ba8c253d958e883334 class=lightbox-link><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/latency.png alt=Latency style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-11171b1833ac10ba8c253d958e883334><img src=../en/apm/using-splunk-apm/tag_spotlight/../../images/latency.png alt=Latency class=lightbox-image loading=lazy></a></p><p>Go back to your service map by pressing the <strong>X</strong> button on the far right underneath <strong>Clear All</strong>.</p><p>Click anywhere on the pink line in the <strong>Services by Error Rate</strong> graph in the top right hand corner. Once selected you should see a list of example traces. Click on one of the example traces with an initiating operation of <strong>frontend: POST /cart/checkout</strong>.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=23-example-trace>2.3 Example trace</h1><h2 id=example-trace>Example Trace</h2><p><a href=#image-26c7218cf63aa246f366110d360d6e20 class=lightbox-link><img src=../en/apm/using-splunk-apm/example_trace/../../images/example-trace.png alt="Example Trace" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-26c7218cf63aa246f366110d360d6e20><img src=../en/apm/using-splunk-apm/example_trace/../../images/example-trace.png alt="Example Trace" class=lightbox-image loading=lazy></a></p><p>You should now see the entire trace along with the spans for the example trace that was selected. Spans which have errors are indicated by a red exclamation mark beside it. If you have a number such as <strong>x6</strong> in a grey box, click it to expand the compacted <code>paymentservice</code> spans.</p><p><a href=#image-b80ba4846cc1149250a2bdafe6d893ec class=lightbox-link><img src=../en/apm/using-splunk-apm/example_trace/../../images/trace-span.png alt="Example Trace" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b80ba4846cc1149250a2bdafe6d893ec><img src=../en/apm/using-splunk-apm/example_trace/../../images/trace-span.png alt="Example Trace" class=lightbox-image loading=lazy></a></p><p>Now click one of the <code>paymentservice</code> spans with the red exclamation mark to expand it and see the associated metadata and some error details. Note that we are able to see that this error is caused by a 401 error and other useful information such as ‚Äòtenant‚Äô and ‚Äòversion‚Äô is also displayed.</p><p><a href=#image-0bfb75122eeb9c146878662d36833ff6 class=lightbox-link><img src=../en/apm/using-splunk-apm/example_trace/../../images/trace-metadata.png alt="Traces and Spans" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0bfb75122eeb9c146878662d36833ff6><img src=../en/apm/using-splunk-apm/example_trace/../../images/trace-metadata.png alt="Traces and Spans" class=lightbox-image loading=lazy></a></p><p>So we now know that the error is caused by an <strong>Invalid Request</strong> but we don&rsquo;t know what exact request. At the bottom of the page you should see a contextual link to Logs, clink on this link to view the logs associated with this span.</p><p><a href=#image-9f3dcad1a62d0d16bfbbddafba97649f class=lightbox-link><img src=../en/apm/using-splunk-apm/example_trace/../../images/logs_link.png alt="Logs Link" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9f3dcad1a62d0d16bfbbddafba97649f><img src=../en/apm/using-splunk-apm/example_trace/../../images/logs_link.png alt="Logs Link" class=lightbox-image loading=lazy></a></p><p>You should now be looking at a <strong>Log Observer</strong> dashboard simialar to the image below.</p><p><a href=#image-739a7492ae09f110ef4e63c38858ab87 class=lightbox-link><img src=../en/apm/using-splunk-apm/example_trace/../../images/log_observer.png alt="Log Observer" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-739a7492ae09f110ef4e63c38858ab87><img src=../en/apm/using-splunk-apm/example_trace/../../images/log_observer.png alt="Log Observer" class=lightbox-image loading=lazy></a></p><p>We can use the filter to display only the error logs. Click on <code>ERROR</code> in the top right hand corner, then <code>Add to filter</code></p><p><a href=#image-4d5cbcb960be0cca9dfc25c06fb972a0 class=lightbox-link><img src=../en/apm/using-splunk-apm/example_trace/../../images/error_filter.png alt="Error Filter" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4d5cbcb960be0cca9dfc25c06fb972a0><img src=../en/apm/using-splunk-apm/example_trace/../../images/error_filter.png alt="Error Filter" class=lightbox-image loading=lazy></a></p><p>You should now have a shorter list of log entries which have a <code>severity</code> of <code>ERROR</code></p><p><a href=#image-12f78e52c38385df9198b78ddbf91bec class=lightbox-link><img src=../en/apm/using-splunk-apm/example_trace/../../images/filtered_results.png alt="Filtered Results" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-12f78e52c38385df9198b78ddbf91bec><img src=../en/apm/using-splunk-apm/example_trace/../../images/filtered_results.png alt="Filtered Results" class=lightbox-image loading=lazy></a></p><p>Select any of the entries to view the details. We can now see how the error was caused by the use of an <strong>Invalid API Token</strong> that our developers have accidentally pushed to production!</p><p><a href=#image-b8ff6a9782e00089563589035899925d class=lightbox-link><img src=../en/apm/using-splunk-apm/example_trace/../../images/error_details.png alt="Error Details" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b8ff6a9782e00089563589035899925d><img src=../en/apm/using-splunk-apm/example_trace/../../images/error_details.png alt="Error Details" class=lightbox-image loading=lazy></a></p><p><strong>Congratulations</strong>, you have now completed the APM Workshop.</p><footer class=footline></footer></article></section></section><article class=default><header class=headline></header><h1 id=splunk-rum>Splunk RUM</h1><p>Splunk RUM is the industry‚Äôs only end to end, full fidelity Real User Monitoring solution. It is built to optimize performance and aid in faster troubleshooting, giving you full visibility into end-user experiences.</p><p>Splunk RUM allows you to identify performance problems in your Web and or Mobile applications that impact the customer experience. We support benchmarking and measuring page performance with core web vitals. This includes but not limited to: W3C timings, the ability to identify long running tasks, along with everything that can impact your page load.</p><p>With Splunk‚Äôs end to end monitoring capabilities you are able to view the latency between all of the services that make up your application, from the service itself through to infrastructure metrics such as database calls and everything in between.</p><p>Our full fidelity end to end monitoring solution captures 100% of your span data. We do not sample, we are framework agnostic and Open Telemetry standardized.</p><p>More often than not we find that the frontend and backend application&rsquo;s performance are interdependent. Fully understanding and being able to visualize the link between your backend services and your user experience is increasingly important.
To see the full picture, Splunk RUM provides seamless correlation between our front end and back end microservices. If your users are experiencing less than optimal conditions on your web based application due to an issue related to your microservice or infrastructure, Splunk will be able to detect this issue and alert you.</p><p>To complete the picture and offer full visibility, Splunk is also able to show in-context logs and events to enable deeper troubleshooting and root-cause analysis.</p><p><a href=#image-0f25d973da97f8dc090e85cf12fd2505 class=lightbox-link><img src=../en/rum/images/rum-architecture.png alt="Architecture Overview" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0f25d973da97f8dc090e85cf12fd2505><img src=../en/rum/images/rum-architecture.png alt="Architecture Overview" class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk RUM</h1><article class=default><header class=headline></header><h1 id=1-overview>1. Overview</h1><h2 id=overview-of-the-rum-workshop>Overview of the RUM Workshop</h2><p>The aim of this Splunk Real User Monitoring (RUM) workshop is to let you:</p><ul><li><p>Shop for some fantastic items on the Online Boutique to create traffic, and create a number of RUM User Sessions<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> that you can view in the Splunk Observability Suite.</p></li><li><p>See an overview of the performance of all your application(s) in the Application Summary Dashboard (Both Mobile and Web based)</p></li><li><p>Examine the performance of a specific website or Mobile App with RUM metrics.</p></li><li><p>Investigate issues with your website and backend services.</p></li><li><p>(Optionally) See how to add RUM to your website.</p></li></ul><p>In order to reach this goal, we will use an online boutique to order various products. Whilst shopping on the online boutique you will create what is called a User Session.</p><p>You may encounter some issues with this web site, and you will use Splunk RUM to identify the issues, so they can be resolved by the developers.</p><p>If this a standalone RUM workshop, the workshop host will provide you with a URL for an online boutique store that has RUM enabled.</p><p>If you are running this session as part of the IM/APM workshop you will be able to use your current online boutique store after we enable RUM.</p><p>Each of these Online Boutiques are also being visited by a few synthetic users, this will allow us to generate more live data to be analyzed later.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A RUM Users session is a &ldquo;recording&rdquo; of a collection of user interactions on an application, basically collecting a website or app‚Äôs performance measured straight from the browser or Mobile App of the end user. To do this a small amount of JavaScript is embedded in each page. This script then collects data from each user as he or she explores the page, and transfers that data back for analysis.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=2-showcase-of-rum-with-the-online-boutique>2. Showcase of RUM with the Online Boutique</h1><ul><li>Find the Web address of your workshop hosts Online Boutique</li><li>Generate traffic by shopping for bargains on your workshop hosted Online Boutique web shop.</li></ul><hr><h2 id=1-url-of-rum-enabled-online-boutique>1. URL of RUM enabled Online Boutique</h2><p>As discussed in the previous section we are going to use an Online Boutique running on a RUM host.
If you&rsquo;re participating in a RUM only workshop, after you have received the RUM instance URL, you can continue to Section 4: <a href=../en/rum/2-showcase/./#4-using-the-online-boutique-to-generate-load-on-your-system>Using the Online Boutique to generate load on your system</a> as the system your going to use is already prepared.</p><h2 id=2-obtain-rum-access-token>2. Obtain RUM Access Token</h2><p>As part of the overall workshop you have installed services for the APM Workshop. We are now going to add the RUM capability to the deployment as well.</p><p>The first thing we need to do is obtain a RUM_ACCESS_TOKEN with a RUM Authorization scope. You can find the workshop RUM Access Token by clicking on the <strong>Settings Cog</strong> menu button and then selecting <strong>Access Tokens</strong>.</p><p>Expand the RUM workshop token that your host has instructed you to use e.g. <strong>O11y-Workshop-RUM-TOKEN</strong>, then click on <strong>Show Token</strong> to expose your token. Click the
<span class="btn cstyle grey"><button type=button>
Copy</button></span> button to copy to clipboard. Please do not use the <strong>Default</strong> token! Make sure the token has RUM as its Authorization Scope.</p><p><a href=#image-ce74176093c3f627f0fb57939558a3f4 class=lightbox-link><img src=../en/rum/2-showcase/../images/RUM-Access-Token.png alt="Access Token" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ce74176093c3f627f0fb57939558a3f4><img src=../en/rum/2-showcase/../images/RUM-Access-Token.png alt="Access Token" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Please do not attempt to create your own token</div><div class=box-content><p>We have created a RUM Token specifically for this workshop with the appropriate settings for the exercises you will be performing</p></div></div><p>Create the <code>RUM_TOKEN</code> environment variable to use in the proceeding shell script to personalize your deployment.</p><div class=tab-panel data-tab-group=5d6f39fb3dd03f9f4a3211b2695289fd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export Variables" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("5d6f39fb3dd03f9f4a3211b2695289fd","Export Variables")'><div><div class=tab-nav-hidden>Export Variables</div><div class=tab-nav-text>Export Variables</div></div></button></div><div class=tab-content-container><div data-tab-item="Export Variables" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>RUM_TOKEN</span><span class=o>=</span>&lt;replace_with_O11y-Workshop-RUM-TOKEN&gt;</span></span></code></pre></div></div></div></div></div><h2 id=3-deploy-rum-based-online-boutique>3. Deploy RUM based Online Boutique</h2><p>To deploy the Online Boutique application into your EC2 instance kubernetes (K3s) installation delete the original deployment, then run the apm config script for RUM, then apply the RUM deployment:</p><div class=tab-panel data-tab-group=b560c3e908ec2ca421d4b226dfd2fe4f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Deploy Online Boutique with RUM" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("b560c3e908ec2ca421d4b226dfd2fe4f","Deploy Online Boutique with RUM")'><div><div class=tab-nav-hidden>Deploy Online Boutique with RUM</div><div class=tab-nav-text>Deploy Online Boutique with RUM</div></div></button>
<button data-tab-item="Partial Deployment Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b560c3e908ec2ca421d4b226dfd2fe4f","Partial Deployment Output")'><div><div class=tab-nav-hidden>Partial Deployment Output</div><div class=tab-nav-text>Partial Deployment Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Deploy Online Boutique with RUM" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/apm
</span></span><span class=line><span class=cl>kubectl delete -f deployment.yaml
</span></span><span class=line><span class=cl>./apm-config.sh -r
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item="Partial Deployment Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>......
</span></span><span class=line><span class=cl>Adding RUM_TOKEN to deployment
</span></span><span class=line><span class=cl>deployment.apps/recommendationservice created
</span></span><span class=line><span class=cl>service/recommendationservice created
</span></span><span class=line><span class=cl>deployment.apps/productcatalogservice created
</span></span><span class=line><span class=cl>service/productcatalogservice created
</span></span><span class=line><span class=cl>deployment.apps/cartservice created
</span></span><span class=line><span class=cl>service/cartservice created
</span></span><span class=line><span class=cl>deployment.apps/adservice created
</span></span><span class=line><span class=cl>service/adservice created
</span></span><span class=line><span class=cl>deployment.apps/paymentservice created
</span></span><span class=line><span class=cl>service/paymentservice created
</span></span><span class=line><span class=cl>deployment.apps/loadgenerator created
</span></span><span class=line><span class=cl>service/loadgenerator created
</span></span><span class=line><span class=cl>deployment.apps/shippingservice created
</span></span><span class=line><span class=cl>service/shippingservice created
</span></span><span class=line><span class=cl>deployment.apps/currencyservice created
</span></span><span class=line><span class=cl>service/currencyservice created
</span></span><span class=line><span class=cl>deployment.apps/redis-cart created
</span></span><span class=line><span class=cl>service/redis-cart created
</span></span><span class=line><span class=cl>deployment.apps/checkoutservice created
</span></span><span class=line><span class=cl>service/checkoutservice created
</span></span><span class=line><span class=cl>deployment.apps/frontend created
</span></span><span class=line><span class=cl>service/frontend created
</span></span><span class=line><span class=cl>service/frontend-external created
</span></span><span class=line><span class=cl>deployment.apps/emailservice created
</span></span><span class=line><span class=cl>service/emailservice created
</span></span><span class=line><span class=cl>deployment.apps/rum-loadgen-deployment created</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> In case of a message about a VARIABLE being unset</div><div class=box-content><p>Please undeploy the APM environment by running <code>kubectl delete -f deployment.yaml</code> before exporting the variable as described in the guide and rerunning the deployment script above.</p></div></div><h2 id=4-using-the-online-boutique-to-generate-load-on-your-system>4. Using the Online Boutique to generate load on your system</h2><p>We are all connected to an Online Boutique, together with some synthetic users who are also shopping for this session. This will create more traffic from multiple locations, making the data more realistic.</p><p>You should have received the correct URL from your workshop host at this point.
Open a new web browser and go to <code>http://{==RUM-HOST-EC2-IP==}:81/</code> where you will then be able to see the RUM enabled Online Boutique running.</p><p><a href=#image-309da3cd3ff5b54153f1a97486d4a41c class=lightbox-link><img src=../en/rum/2-showcase/../images/online-boutique.png alt="Online Boutique" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-309da3cd3ff5b54153f1a97486d4a41c><img src=../en/rum/2-showcase/../images/online-boutique.png alt="Online Boutique" class=lightbox-image loading=lazy></a></p><h2 id=5-generate-traffic>5. Generate traffic</h2><p>The goal of this exercise is for you to browse the RUM enabled Online Boutique and buy different products and different quantities.
For extra credit, you may even use the url from different browsers or from your smartphone.</p><p>This will create multiple sessions to investigate. Take your time to examine and buy the various products and put them in your cart:</p><p><a href=#image-b53815757ad0c5ceff1038ff14c86836 class=lightbox-link><img src=../en/rum/2-showcase/../images/cart.png alt="Cart Online Boutique" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b53815757ad0c5ceff1038ff14c86836><img src=../en/rum/2-showcase/../images/cart.png alt="Cart Online Boutique" class=lightbox-image loading=lazy></a></p><p>Doesn&rsquo;t that HOME BARISTA KIT look tempting?&mldr; Your time to start shopping now!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=3-example-of-rum-enablement-in-your-website>3. Example of RUM enablement in your Website</h1><ul><li>Check the original HEAD section of your Online-boutique webpage (or use the examples here) in your browser</li><li>Find the Web address of your workshop hosts Online Boutique</li><li>Compare the changes made to the hosts Online-Boutique and compare with the base one.</li></ul><hr><h2 id=1-review-the-original-code-of-your-non-rum-online-boutique>1. Review the original code of your NON RUM Online-Boutique</h2><p>If you have access to an EC2 instance and have previously installed the Online Boutique as part of the APM session, you can view it on port 81 of the EC2 instance&rsquo;s IP address.</p><p>If you have not got access to an EC2 instance with the Online Boutique installed then your workshop instructor will provide you with the Online Boutique URL that does not have RUM installed so that you can complete the next steps.</p><h2 id=2-obtain-rum-access-token>2. Obtain RUM Access Token</h2><p>As this Deployment we are about to do is also used as part of the RUM workshop section, you will need to obtain your RUM Access Token from the Splunk UI. You can find the workshop Access Token by clicking <strong>&#187;</strong> bottom left or the
<a href=#image-15dd85238de8d35f10bab111b65532a7 class=lightbox-link><img src="../en/rum/3-setup/../images/setting.png?classes=inline&height=25px" alt=settings class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-15dd85238de8d35f10bab111b65532a7><img src="../en/rum/3-setup/../images/setting.png?classes=inline&height=25px" alt=settings class=lightbox-image loading=lazy></a> menu option and then selecting <strong>Settings ‚Üí Access Tokens</strong>.</p><p>Expand the RUM workshop token that your host has instructed you to use e.g. <strong>O11y-Workshop-RUM-TOKEN</strong>, then click on <strong>Show Token</strong> to expose your token. Click the
<span class="btn cstyle grey"><button type=button>
Copy</button></span> button to copy to clipboard. Please do not use the <strong>Default</strong> token! Make sure the token has RUM as its Authorization Scope.</p><p><a href=#image-73dd0171a4f8f8dfe89ba9e35a77ca79 class=lightbox-link><img src=../en/rum/3-setup/../images/RUM-Access-Token.png alt="Access Token" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-73dd0171a4f8f8dfe89ba9e35a77ca79><img src=../en/rum/3-setup/../images/RUM-Access-Token.png alt="Access Token" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Please do not attempt to create your own token</div><div class=box-content><p>We have created a RUM Token specifically for this workshop with the appropriate settings for the exercises you will be performing</p></div></div><p>Create the <code>RUM_TOKEN</code> environment variable to use in the proceeding shell script to personalize your deployment.</p><div class=tab-panel data-tab-group=48470c972a9a33488706942685d7fccf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export Variables" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("48470c972a9a33488706942685d7fccf","Export Variables")'><div><div class=tab-nav-hidden>Export Variables</div><div class=tab-nav-text>Export Variables</div></div></button></div><div class=tab-content-container><div data-tab-item="Export Variables" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>RUM_TOKEN</span><span class=o>=</span>&lt;replace_with_O11y-Workshop-RUM-TOKEN&gt;</span></span></code></pre></div></div></div></div></div><h2 id=2-deploy-online-boutique>2. Deploy Online Boutique</h2><p>To deploy the Online Boutique application into K3s, run the apm config script, then apply the deployment:</p><div class=tab-panel data-tab-group=12a86e66b09e5e2f0c6b05a6cdf74433><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Deploy Online Boutique" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("12a86e66b09e5e2f0c6b05a6cdf74433","Deploy Online Boutique")'><div><div class=tab-nav-hidden>Deploy Online Boutique</div><div class=tab-nav-text>Deploy Online Boutique</div></div></button>
<button data-tab-item="Deployment Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("12a86e66b09e5e2f0c6b05a6cdf74433","Deployment Output")'><div><div class=tab-nav-hidden>Deployment Output</div><div class=tab-nav-text>Deployment Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Deploy Online Boutique" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/workshop/apm
</span></span><span class=line><span class=cl>./apm-config.sh -r
</span></span><span class=line><span class=cl>kubectl apply -f deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item="Deployment Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/checkoutservice created
</span></span><span class=line><span class=cl>service/checkoutservice created
</span></span><span class=line><span class=cl>deployment.apps/redis-cart created
</span></span><span class=line><span class=cl>service/redis-cart created
</span></span><span class=line><span class=cl>deployment.apps/productcatalogservice created
</span></span><span class=line><span class=cl>service/productcatalogservice created
</span></span><span class=line><span class=cl>deployment.apps/loadgenerator created
</span></span><span class=line><span class=cl>service/loadgenerator created
</span></span><span class=line><span class=cl>deployment.apps/frontend created
</span></span><span class=line><span class=cl>service/frontend created
</span></span><span class=line><span class=cl>service/frontend-external created
</span></span><span class=line><span class=cl>deployment.apps/paymentservice created
</span></span><span class=line><span class=cl>service/paymentservice created
</span></span><span class=line><span class=cl>deployment.apps/emailservice created
</span></span><span class=line><span class=cl>service/emailservice created
</span></span><span class=line><span class=cl>deployment.apps/adservice created
</span></span><span class=line><span class=cl>service/adservice created
</span></span><span class=line><span class=cl>deployment.apps/cartservice created
</span></span><span class=line><span class=cl>service/cartservice created
</span></span><span class=line><span class=cl>deployment.apps/recommendationservice created
</span></span><span class=line><span class=cl>service/recommendationservice created
</span></span><span class=line><span class=cl>deployment.apps/shippingservice created
</span></span><span class=line><span class=cl>service/shippingservice created
</span></span><span class=line><span class=cl>deployment.apps/currencyservice created
</span></span><span class=line><span class=cl>service/currencyservice created</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> In case of a message about a VARIABLE being unset</div><div class=box-content><p>Please undeploy the APM environment by running <code>kubectl delete -f deployment.yaml</code> before exporting the variable as described in the guide and rerunning the deployment script above.</p></div></div><p>Open your web browser and go to the Online Boutique. (The one you previously used, or the one provided by the Workshop instructor). You will see the Non RUM Online Boutique running.</p><p><a href=#image-81fbd35197adb9f7ab089f9fbdbf42eb class=lightbox-link><img src=../en/rum/3-setup/../images/online-boutique.png alt="Online Boutique" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-81fbd35197adb9f7ab089f9fbdbf42eb><img src=../en/rum/3-setup/../images/online-boutique.png alt="Online Boutique" class=lightbox-image loading=lazy></a></p><p>Follow the instructions for your preferred browser below:</p><h3 id=11-chrome-firefox---microsoft-edge-users---check-the-web-page-source>1.1 Chrome, FireFox & Microsoft Edge Users - Check the Web page source</h3><p>In Chrome & Firefox or Microsoft Edge you can right click on the Online-Boutique site, you will have an option to <strong>&ldquo;View Page Source&rdquo;</strong></p><p><a href=#image-61dbbc3f4e23111940517f1d749c1338 class=lightbox-link><img src=../en/rum/3-setup/../images/Chrome-1.png alt=Chrome-see-source style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-61dbbc3f4e23111940517f1d749c1338><img src=../en/rum/3-setup/../images/Chrome-1.png alt=Chrome-see-source class=lightbox-image loading=lazy></a></p><p>Selecting it will show you the HTML page source code in a separate Tab.</p><p><a href=#image-52be25223e27d5aa057f56df65d28cfd class=lightbox-link><img src=../en/rum/3-setup/../images/Chrome-html.png alt=Chrome-see-html style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-52be25223e27d5aa057f56df65d28cfd><img src=../en/rum/3-setup/../images/Chrome-html.png alt=Chrome-see-html class=lightbox-image loading=lazy></a></p><p>If successful you can skip to <a href=../en/rum/3-setup/./#2----review-the-unchanged-head-section>2 - Review the unchanged HEAD section.</a></p><h3 id=12-safari-users---check-the-web-page-source>1.2 Safari Users - Check the Web page source</h3><p>For Safari users, you may have to enable the extra menu in Safari by selecting <strong>&lsquo;Preferences&rsquo;</strong> under <em>Safari</em> in the OS X menu bar.</p><p><a href=#image-72f146a00154d08f55aa00cb1d670bd0 class=lightbox-link><img src=../en/rum/3-setup/../images/Safari-1.png alt=Safari-1 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-72f146a00154d08f55aa00cb1d670bd0><img src=../en/rum/3-setup/../images/Safari-1.png alt=Safari-1 class=lightbox-image loading=lazy></a></p><p>Then in the dialog that pops up, under the <strong>&lsquo;Advanced&rsquo;</strong> pane select the checkbox that says <strong>&lsquo;Show Develop menu in menu bar. &lsquo;</strong> and close the Dialog box.</p><p><a href=#image-e8bb0aa733342e8da9c83d520503c115 class=lightbox-link><img src=../en/rum/3-setup/../images/Safari-2.png alt=Safari-2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e8bb0aa733342e8da9c83d520503c115><img src=../en/rum/3-setup/../images/Safari-2.png alt=Safari-2 class=lightbox-image loading=lazy></a></p><p>You can now right click on the Online-Boutique and you now will have an option <strong>&lsquo;Show Page Source&rsquo;</strong>.</p><p><a href=#image-1174a18d4d7fc24bf05ac3e1716a7ebd class=lightbox-link><img src=../en/rum/3-setup/../images/Safari-3.png alt=Safari-3 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1174a18d4d7fc24bf05ac3e1716a7ebd><img src=../en/rum/3-setup/../images/Safari-3.png alt=Safari-3 class=lightbox-image loading=lazy></a></p><p>If you select that option on the Online-Boutique you will see the HTML source code as shown below:</p><p><a href=#image-e850a8b9623a3771f7454e2f39d15409 class=lightbox-link><img src=../en/rum/3-setup/../images/Safari-html.png alt=Safari-html style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e850a8b9623a3771f7454e2f39d15409><img src=../en/rum/3-setup/../images/Safari-html.png alt=Safari-html class=lightbox-image loading=lazy></a></p><p>If successful you can skip to <a href=../en/rum/3-setup/./#2----review-the-unchanged-head-section>2 - Review the unchanged HEAD section.</a></p><h3 id=13-internet-explorer-users---check-the-web-page-source>1.3 Internet Explorer Users - Check the Web page source</h3><p>For Internet Explorer 11 Users, you may have trouble with this exercise as it will require a specific version of the Splunk Open Telemetry Javascript for Web/RUM.</p><p>However you will be able to see the changes required by right clicking on the Online-Boutique site, you see an option to <strong>&ldquo;View Source&rdquo;</strong></p><p><a href=#image-9cc6bfc573eefbddc2407be7bf8200d3 class=lightbox-link><img src=../en/rum/3-setup/../images/IE-1.png alt=IE-1 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9cc6bfc573eefbddc2407be7bf8200d3><img src=../en/rum/3-setup/../images/IE-1.png alt=IE-1 class=lightbox-image loading=lazy></a></p><p>If you select that option on the Online-Boutique you will see the HTML source code as shown below:</p><p><a href=#image-0d2aa5e04b20cfb1d19f55d056846b13 class=lightbox-link><img src=../en/rum/3-setup/../images/IE-2.png alt=IE-2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0d2aa5e04b20cfb1d19f55d056846b13><img src=../en/rum/3-setup/../images/IE-2.png alt=IE-2 class=lightbox-image loading=lazy></a></p><h2 id=2----review-the-unchanged-head-section>2 - Review the unchanged HEAD section</h2><p>The changes for RUM will be placed in the HEAD section of your Web page, Below are the original lines as you should have it in your local Base version.</p><p><a href=#image-7a8a9c14e5bb0aeee7785051ad72a4bf class=lightbox-link><img src=../en/rum/3-setup/../images/ViewBase-HEAD-html.png alt="Online Boutique" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7a8a9c14e5bb0aeee7785051ad72a4bf><img src=../en/rum/3-setup/../images/ViewBase-HEAD-html.png alt="Online Boutique" class=lightbox-image loading=lazy></a></p><p>There is no reference to the Splunk or Open Telemetry Beacon (The function that is used to send RUM Metrics and Traces )</p><h2 id=3-find-the-web-url-of-the-rum-enabled-online-boutique>3. Find the web (URL) of the RUM enabled Online Boutique</h2><p>The Online Boutique we are going to use for RUM is viewable on port 81 of the RUM Enabled instance&rsquo;s IP address and the url will be provided to you by the workshop instructor at this point.</p><p>We are all connecting to the extra RUM Enabled Online Boutique provided by the workshops instructor for this RUM session. Open a new web browser and go to <code>http://{==RUM-HOST-EC2-IP==}:81/</code> where you will then be able to see the RUM enabled Online Boutique running. Again, view the source of the HTML Page as described in the previous section:</p><h2 id=4--review-the-changes-made-to-enable-rum-in-the-head-section-of-the-rum-enabled-online-boutique>4. Review the Changes made to enable RUM in the HEAD section of the RUM enabled Online-Boutique</h2><p>The changes needed for RUM are placed in the HEAD section of the hosts Web page, Below is the hosts updated HEAD section with the changes required to enable RUM:</p><p><a href=#image-b706407d1c3acd2c4f94ea92871d2f5f class=lightbox-link><img src=../en/rum/3-setup/../images/ViewRUM-HEAD-html.png alt="Online Boutique" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b706407d1c3acd2c4f94ea92871d2f5f><img src=../en/rum/3-setup/../images/ViewRUM-HEAD-html.png alt="Online Boutique" class=lightbox-image loading=lazy></a></p><p>The first three lines (marked in red) have been added to the HEAD section of the host Web page to enable RUM Tracing, the last three (marked in blue) are optional and used to enable Custom RUM events.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text/javascript&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nb>window</span><span class=p>.</span><span class=nx>SplunkRum</span> <span class=o>&amp;&amp;</span> <span class=nb>window</span><span class=p>.</span><span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span><span class=nx>beaconUrl</span><span class=o>:</span> <span class=s2>&#34;https://rum-ingest.eu0.signalfx.com/v1/rum&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAuth</span><span class=o>:</span> <span class=s2>&#34;1wCqZVUWIP5XSdNjPoQRFg&#34;</span><span class=p>,</span> <span class=nx>app</span><span class=o>:</span> <span class=s2>&#34;ksnq-rum-app&#34;</span><span class=p>,</span> <span class=nx>environment</span><span class=o>:</span> <span class=s2>&#34;ksnq-rum-env&#34;</span><span class=p>});&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>Provider</span> <span class=o>=</span> <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>provider</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>tracer</span><span class=o>=</span><span class=nx>Provider</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=s1>&#39;appModuleLoader&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><ul><li>The first part is to indicate where to download the Splunk Open Telemetry Javascript file from: <em><a href=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js target=_blank>https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js</a></em> (This can also be loaded locally if so required)</li><li>The second line defines the location where to send the traces to in the beacon url: <code>{beaconUrl: "https://rum-ingest.eu0.signalfx.com/v1/rum"</code></li><li>It also adds an Access Token to : <code>rumAuth: "1wCqZVUWIP5XSdNjPoQRFg"</code> (this of course is an example, you can create multiple RUM Access Tokens for all your applications)</li><li>And it is used to add identification tags like the application Name and environment to the RUM trace for use in the SPLUNK RUM UI: <code>app: "ksnq-rum-app", environment: "ksnq-rum-env"}</code></li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>In this example the app name is <strong>ksnq-rum-app</strong>, this will be different in the Workshop. Check with your host what the app name and environment to use in the RUM session will be and make a note of it!</p></div></div><p>The above two lines are all that is required to enable RUM on your website!</p><p>The (blue) optional section that uses <code>var tracer=Provider.getTracer('appModuleLoader');</code> will add a custom event for every page change allow you to better track your website conversions and usage.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=4-rum-landing-page>4. RUM Landing Page</h1><ul><li>Visit the RUM landing page and and check the overview of the performance of all your RUM enabled applications with the Application Summary Dashboard (Both Mobile and Web based)</li></ul><hr><h2 id=1-visit-the-rum-landing-page>1. Visit the RUM Landing Page</h2><p>Login into your Splunk IM/APM/RUM Website. From the left side menu bar select <strong>RUM</strong>
<a href=#image-e8377acbdd3a223505c72b2e3ad4466e class=lightbox-link><img src="../en/rum/4-rum-landing/../images/RUM_ico.png?classes=inline&height=25px" alt=RUM-ico class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e8377acbdd3a223505c72b2e3ad4466e><img src="../en/rum/4-rum-landing/../images/RUM_ico.png?classes=inline&height=25px" alt=RUM-ico class=lightbox-image loading=lazy>
</a>. This will bring you to your the RUM Landing Page.</p><p>The goal of this page is to give you in a single page, a clear indication of the health, performance and potential errors found in your application(s) and allow you to dive deeper into the information about your User Sessions collected from your web page/App. You will have a pane for each of your active RUM applications. (The view below is the default expanded view)</p><p><a href=#image-da006258bc490995b8a0f371eb2cac9a class=lightbox-link><img src=../en/rum/4-rum-landing/../images/Applicationsummarydashboard.png alt=RUM-App-sum style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-da006258bc490995b8a0f371eb2cac9a><img src=../en/rum/4-rum-landing/../images/Applicationsummarydashboard.png alt=RUM-App-sum class=lightbox-image loading=lazy></a></p><p>If you have multiple applications, (which will be the case when every attendee is using their own ec2 instance for the RUM workshop), the pane view may be automatically reduced by collapsing the panes as shown below:</p><p><a href=#image-eb131d8ed9fb11a51020147469062a1d class=lightbox-link><img src=../en/rum/4-rum-landing/../images/multiple_apps_collapsed.png alt=RUM-App-sum-collapsed style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-eb131d8ed9fb11a51020147469062a1d><img src=../en/rum/4-rum-landing/../images/multiple_apps_collapsed.png alt=RUM-App-sum-collapsed class=lightbox-image loading=lazy></a></p><p>You can expanded a condensed RUM Application Summary View to the full dashboard by clicking on the small browser
<a href=#image-e2ba6c85c472d4095630787071ff2cb5 class=lightbox-link><img src="../en/rum/4-rum-landing/../images/browser.png?classes=inline&height=25px" alt=RUM-browser class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e2ba6c85c472d4095630787071ff2cb5><img src="../en/rum/4-rum-landing/../images/browser.png?classes=inline&height=25px" alt=RUM-browser class=lightbox-image loading=lazy></a> or Mobile
<a href=#image-f14682fb274703102ab4964ab9a8eb8a class=lightbox-link><img src="../en/rum/4-rum-landing/../images/mobile.png?classes=inline&height=25px" alt=RUM-mobile class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f14682fb274703102ab4964ab9a8eb8a><img src="../en/rum/4-rum-landing/../images/mobile.png?classes=inline&height=25px" alt=RUM-mobile class=lightbox-image loading=lazy>
</a>icon. (Depending on the type of application: <em>Mobile</em> or <em>Browser</em> based) on the left in front of the applications name, highlighted by the red arrow.</p><p>First find the right application to use for the workshop:</p><p>If you are participating in a stand alone RUM workshop, the workshop leader will tell you the name of the application to use, in the case of a combined workshop, it will follow the naming convention we used for IM and APM and use the ec2 node name as a unique id like <strong>jmcj-rum-app</strong> as shown as the last app in the screenshot above.</p><h2 id=2-configure-the-rum-application-summary-dashboard-header-section>2. Configure the RUM Application Summary Dashboard Header Section</h2><p>RUM Application Summary Dashboard consists of 6 major sections. The first is the selection header, where you can set/filter a number of options:</p><ul><li>A drop down for the <strong>Time Window</strong> you&rsquo;re reviewing (You are looking at the past 15 minutes by default)</li><li>A drop down to select the <strong>Environment</strong><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> you want to look at. This allows you to focus on just the subset of applications belonging to that environment, or Select all to view all available.</li><li>A drop down list with the various <strong>Apps</strong> being monitored. You can use the one provided by the workshop host or select your own. This will focus you on just one application.</li><li>A drop down to select the <strong>Source</strong>, <em>Browser</em> or <em>Mobile</em> applications to view. For the Workshop leave <em>All</em> selected.</li><li>A hamburger menu located at the right of the header allowing you to configure some settings of your Splunk RUM application. (We will visit this in a later section).</li></ul><p><a href=#image-83d6ff501fc496acddacbe7670045d8d class=lightbox-link><img src=../en/rum/4-rum-landing/../images/RUM_SummaryHeader.png alt=RUM-SummaryHeader style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-83d6ff501fc496acddacbe7670045d8d><img src=../en/rum/4-rum-landing/../images/RUM_SummaryHeader.png alt=RUM-SummaryHeader class=lightbox-image loading=lazy></a></p><p>For the workshop lets do a deeper dive into the Application Summary screen in the next section: <a href=../en/rum/4-rum-landing/../5-browser-app-summary/>Check Health Browser Application</a></p><hr><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A deployment environment is a distinct deployment of your system or application that allows you to set up configurations that don‚Äôt overlap with configurations in other deployments of the same application. Separate deployment environments are often used for different stages of the development process, such as development, staging, and production.</br></br>A common application deployment pattern is to have multiple, distinct application environments that don‚Äôt interact directly with each other but that are all being monitored by Splunk APM or RUM: for instance, quality assurance (QA) and production environments, or multiple distinct deployments in different datacenters, regions or cloud providers.
<a href=http://nebezb.com/ target=_blank></a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=5-check-browser-applications-health-at-a-glance>5. Check Browser Applications health at a glance</h1><ul><li>Get familiar with the UI and options available from this landing page</li><li>Identify Page Views/Errors and Request/Errors and Java Script Errors in a single view</br>Check the Web Vitals metrics and any Detector that has fired for in relation to your Browser Application</li></ul><hr><h2 id=1-application-summary-dashboard-overview>1. Application Summary Dashboard Overview</h2><h3 id=11-header-bar>1.1. Header Bar</h3><p>As seen in the previous section the RUM Application Summary Dashboard consists of 5 major sections.</br>The first section is the selection header, where you can collapse the Pane via the
<a href=#image-b0806e8e9ae4e12cb4f624dfebf82cca class=lightbox-link><img src="../en/rum/5-browser-app-summary/../images/browser.png?classes=inline&height=25px" alt=RUM-browser class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b0806e8e9ae4e12cb4f624dfebf82cca><img src="../en/rum/5-browser-app-summary/../images/browser.png?classes=inline&height=25px" alt=RUM-browser class=lightbox-image loading=lazy></a> Browser icon or the <strong>></strong> in front of the application name, which is <em>jmcj-rum-app</em> in the example below. It also provides access to the <em>Application Overview</em> page if you click the link with your application name which is <em>jmcj-rum-app</em> in the example below.</p><p>Further, you can also open the <em>Application Overview</em> or <em>App Health Dashboard</em> via the triple dot
<a href=#image-b62689f388f9e98f403fc83ae214d8b0 class=lightbox-link><img src="../en/rum/5-browser-app-summary/../images/trippleburger.png?classes=inline&height=25px" alt=trippleburger class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b62689f388f9e98f403fc83ae214d8b0><img src="../en/rum/5-browser-app-summary/../images/trippleburger.png?classes=inline&height=25px" alt=trippleburger class=lightbox-image loading=lazy></a> menu on the right.</p><p><a href=#image-9a70210c7498c17ecc02424d87414984 class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/summaryHeader.png alt=RUM-SummaryHeader style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9a70210c7498c17ecc02424d87414984><img src=../en/rum/5-browser-app-summary/../images/summaryHeader.png alt=RUM-SummaryHeader class=lightbox-image loading=lazy></a></p><p>First use the <em>View Dashboard</em> link to open the Browser App Health Dashboard which should open in a new tab. Then switch back to original RUM tab, and then use the <em>Open Application Overview</em> link, or click on the name of the app to launch the Application Overview dashboard.</p><p>We will looking at the <em>Application Overview</em> and <em>Browser App Health</em> Dashboards in detail in the following sections.</p><h2 id=2-application-overview>2. Application Overview</h2><p>The RUM Application Overview Dashboard is focused on providing you with <em>at a glance</em> overview of the status of your application.</p><h3 id=21-page-views--errors--network-requests--errors>2.1. Page Views / Errors & Network Requests / Errors</h3><p>The first section shows <em>Page Views / Errors</em>, & <em>Network Requests and Errors</em> charts show the quantity and trend of these issues in your application. This could be Javascript errors, or failed network calls to back end services.</p><p><a href=#image-6b0e26fce4c04384cd7dee4dceb01b2e class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/Rum-chart.png alt=RUM-chart style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6b0e26fce4c04384cd7dee4dceb01b2e><img src=../en/rum/5-browser-app-summary/../images/Rum-chart.png alt=RUM-chart class=lightbox-image loading=lazy></a></p><p>In the example above you can see that there are no failed network calls in the Network chart, but in the Page View chart you can see that a number of pages do experience some errors. These are often not visible for regular users, but can seriously impact the performance of your web site.</p><p>You can see the count of the Page Views / Network Requests / Errors by hovering over the charts.</p><p><a href=#image-c50d7884c8ff8afaec6f2f10ee163297 class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/RUM-Chart-Clicked.png alt=RUM-chart-clicked style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c50d7884c8ff8afaec6f2f10ee163297><img src=../en/rum/5-browser-app-summary/../images/RUM-Chart-Clicked.png alt=RUM-chart-clicked class=lightbox-image loading=lazy></a></p><h3 id=22-javascript-errors>2.2. JavaScript Errors</h3><p>With the second section of the RUM Application Summary Dashboard we are showing you an overview of the JavaScript errors occurring in your application, along with a count of each error.</p><p><a href=#image-f723ff565cf638c5f59b1de01ba4b5a9 class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/RUM-Javascripterrors.png alt=RUM-javascript style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f723ff565cf638c5f59b1de01ba4b5a9><img src=../en/rum/5-browser-app-summary/../images/RUM-Javascripterrors.png alt=RUM-javascript class=lightbox-image loading=lazy></a></p><p>In the example above you can see there are three JavaScript errors, one that appears 29 times in the selected time slot, and the other two each appear 12 times.</p><p>If you click on one of the errors a pop-out opens that will show a summary (below) of the errors over time, along with a Stack Trace of the JavaScript error, giving you an indication of where the problems occurred. (We will see this in more detail in one of the following sections)</p><p><a href=#image-6ca935ec6064caefc0f0703050547335 class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/expandedRUmJAVAscript-error.png alt=RUM-javascript-chart style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6ca935ec6064caefc0f0703050547335><img src=../en/rum/5-browser-app-summary/../images/expandedRUmJAVAscript-error.png alt=RUM-javascript-chart class=lightbox-image loading=lazy></a></p><h3 id=23-web-vitals>2.3. Web Vitals</h3><p>The third section of the RUM Application Summary Dashboard is showing you the crucial (google) Web Vitals, three metrics, that are used by Google in its ranking system, and give a very good indication of the speed of your site for your end users.</p><p><a href=#image-d512b1c4b3362ee3ef57aa34e1d75cd2 class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/RUM-QuickWebVitals.png alt=WEB-vitals style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d512b1c4b3362ee3ef57aa34e1d75cd2><img src=../en/rum/5-browser-app-summary/../images/RUM-QuickWebVitals.png alt=WEB-vitals class=lightbox-image loading=lazy></a></p><p>As you can see our site is well behaved and scores <em>Good</em> for all three Metrics. These metrics can be used to identify the effect changes to your application have, and help you improve the performance of your site.</p><p>If you click on any of the Metrics shown in the Web Vitals pane you will be taken to the corresponding Tag Spotlight Dashboard. e.g. clicking on the <strong>Largest Contentful Paint (LCP)</strong> chartlet, you will be taken to a dashboard similar to the screen shot below, that gives you timeline and table views for how this metric has performed. This should allow you to spot trends and identify where the problem may be more common, such as an OS or browser version, .</p><p><a href=#image-c4dd477d837d5d220cc30ace7401a726 class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/RUM-Tag-Spotlight.png alt=WEB-vitals-tag style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c4dd477d837d5d220cc30ace7401a726><img src=../en/rum/5-browser-app-summary/../images/RUM-Tag-Spotlight.png alt=WEB-vitals-tag class=lightbox-image loading=lazy></a></p><h3 id=24-most-recent-detectors>2.4. Most Recent Detectors</h3><p>The fourth and final section of the RUM Application Summary Dashboard is focused on providing you an overview of any detector that has triggered for your application. We have created a detector for this screen shot but your pane will be empty for now, but we will add some detectors to your site and make sure they are triggered in one of the next sections.</p><p><a href=#image-0321abdcb0c58369021a72d244759dce class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/rum-detector.png alt=detectors style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0321abdcb0c58369021a72d244759dce><img src=../en/rum/5-browser-app-summary/../images/rum-detector.png alt=detectors class=lightbox-image loading=lazy></a></p><p>In the screen shot you can see we have a critical alert for the <em>RUM Aggregated View Detector</em>, and a Count, how often this alert has triggered in the selected time window. If you happen to have an alert listed, you can click on the name of the Alert (that is shown as a blue link) and you will be taken to the Alert Overview page showing the details of the alert (Note: this will move you away from the current page, Please use the <strong>Back</strong> option of your browser to return to the overview page).</p><p><a href=#image-18163830a3a44c599e708f1140c67095 class=lightbox-link><img src=../en/rum/5-browser-app-summary/../images/click-alert.png alt=alert style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-18163830a3a44c599e708f1140c67095><img src=../en/rum/5-browser-app-summary/../images/click-alert.png alt=alert class=lightbox-image loading=lazy></a></p><hr><p>Please take a few minutes to experiment with the RUM Application Summary Dashboard and the underlying chart and dashboards before going on to the next section.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=6-analyzing-rum-metrics>6. Analyzing RUM Metrics</h1><ul><li>See RUM Metrics and Session information in the RUM UI</li><li>See correlated APM traces in the RUM & APM UI</li></ul><hr><h2 id=1-rum-overview-pages>1. RUM Overview Pages</h2><p>From your RUM Application Summary Dashboard you can see detailed information by opening the Application Overview Page via the tripple dot
<a href=#image-f6b7e133f7eb3488b1ff5255277452a2 class=lightbox-link><img src="../en/rum/6-analyzing-metrics/../images/trippleburger.png?classes=inline&height=25px" alt=trippleburger class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f6b7e133f7eb3488b1ff5255277452a2><img src="../en/rum/6-analyzing-metrics/../images/trippleburger.png?classes=inline&height=25px" alt=trippleburger class=lightbox-image loading=lazy></a> menu on the right by selecting <em>Open Application Overview</em> or by clicking the link with your application name which is <em>jmcj-rum-app</em> in the example below.</p><p><a href=#image-e50576c1d7b17678675aba1accecb255 class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/summaryHeader.png alt=RUM-SummaryHeader style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e50576c1d7b17678675aba1accecb255><img src=../en/rum/6-analyzing-metrics/../images/summaryHeader.png alt=RUM-SummaryHeader class=lightbox-image loading=lazy></a></p><p>This will take you to the RUM Application Overview Page screen as shown below.</p><p><a href=#image-12eecd171020a67836861a8cd645d68b class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-1.png alt=RUM-1 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-12eecd171020a67836861a8cd645d68b><img src=../en/rum/6-analyzing-metrics/../images/RUM-1.png alt=RUM-1 class=lightbox-image loading=lazy></a></p><h2 id=2-rum-browser-overview>2. RUM Browser Overview</h2><h3 id=21-header>2.1. Header</h3><p>The RUM UI consists of 6 major sections. The first is the selection header, where you can set/filter a number of options:</p><ul><li>A drop down for the time window you&rsquo;re reviewing (You are looking at the past hour in this case)</li><li>A drop down to select the Comparison window (You are comparing current performance on a rolling window - in this case compared to 1 hour ago)</li><li>A drop down with the available Environments to view: (Choose the one provided by the workshop host or <em>All</em> like in the example)</li><li>A drop down list with the Various Web apps (You can use the one provided by the workshop host or use <em>All</em>)</li><li><em><strong>Optionally</strong></em> a drop down to select Browser or Mobile metrics (<em>Might not be available in your workshop</em>)</li></ul><p><a href=#image-cb0d319a33b5105dee0b6b68e50f2910 class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-Header.png alt=RUM-Header style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cb0d319a33b5105dee0b6b68e50f2910><img src=../en/rum/6-analyzing-metrics/../images/RUM-Header.png alt=RUM-Header class=lightbox-image loading=lazy></a></p><h3 id=22-overview-pane>2.2. Overview Pane</h3><p>The Overview Panes, down the left hand side of the page, give you a summary of the pages which have increased load times.</p><p>In the example here you can see that the <strong>checkout</strong> and <strong>cart</strong> pages have errors due to the yellow triangles, and you can see that the load time has increased by 2.38 to 5.50 seconds.</p><p><a href=#image-4845fe808e45a089b5f5aa9db46fc495 class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-Page-Load-Times.png alt=RUM-Top style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4845fe808e45a089b5f5aa9db46fc495><img src=../en/rum/6-analyzing-metrics/../images/RUM-Page-Load-Times.png alt=RUM-Top class=lightbox-image loading=lazy></a></p><p>You also see an overview of the number of Front end Error and Backend Errors per minute, and we appear to have three JavaScript errors on our site.</p><p><a href=#image-a0d20c38430b3f9e0d407cd3b548e229 class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-JS-Errors.png alt=RUM-Top style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a0d20c38430b3f9e0d407cd3b548e229><img src=../en/rum/6-analyzing-metrics/../images/RUM-JS-Errors.png alt=RUM-Top class=lightbox-image loading=lazy></a></p><p>The last two panes show you the <strong>Top Page Views</strong> and the <strong>Top Network Requests</strong>.</p><p><a href=#image-7feb924081233d506bc818413a02c810 class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-Page-Views-Network.png alt=RUM-Top style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7feb924081233d506bc818413a02c810><img src=../en/rum/6-analyzing-metrics/../images/RUM-Page-Views-Network.png alt=RUM-Top class=lightbox-image loading=lazy></a></p><h3 id=23-key-metrics-pane>2.3. Key Metrics Pane</h3><p>The Key Metrics View is the location where you will find the metrics for the number of
<strong>JavaScript Errors</strong> per second, <strong>Network Errors</strong> per second an the <strong>Backend/Resource Request Duration</strong>.
These Metrics are very useful to guide you to the location of an issue if you are experiencing problems with your site.</p><p><a href=#image-89f23fdc8826c3a47260e848d7faba3a class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-Key-Metrics.png alt=RUM-KeyMetrics style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-89f23fdc8826c3a47260e848d7faba3a><img src=../en/rum/6-analyzing-metrics/../images/RUM-Key-Metrics.png alt=RUM-KeyMetrics class=lightbox-image loading=lazy></a></p><h3 id=24-web-vitals-pane>2.4. Web Vitals Pane</h3><p>The Web Vitals view is the location where you go if you wish to get insight into the experience you are delivering to your End users based on Web Vitals metrics.
Web Vitals is an initiative by Google to provide unified guidance for quality signals that are essential to delivering a great user experience on the web and focuses on three key parameters:</p><ul><li><strong>Largest Contentful Paint (LCP)</strong>, measures loading performance. To provide a good user experience, LCP should occur within 2.5 seconds of when the page first starts loading.</li><li><strong>First Input Delay (FID)</strong>, measures interactivity. To provide a good user experience, pages should have a FID of 100 milliseconds or less.</li><li><strong>Cumulative Layout Shift (CLS)</strong>, measures visual stability. To provide a good user experience, pages should maintain a CLS of 0.1. or less.</li></ul><p><a href=#image-d60dab59ccd8d3f34d31f7864613d2b9 class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-Web-Vitals.png alt=RUM-WebVitals style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d60dab59ccd8d3f34d31f7864613d2b9><img src=../en/rum/6-analyzing-metrics/../images/RUM-Web-Vitals.png alt=RUM-WebVitals class=lightbox-image loading=lazy></a></p><h3 id=25-other-metrics-pane>2.5. Other Metrics Pane</h3><p>The Other Metrics Pane is the location where you find other performance metrics, with a focus on initial load time of your page or tasks that are taking too long to complete.</p><ul><li><strong>Time To First Byte (TTFB)</strong>, measures how long it takes for a client&rsquo;s browser to receive the first byte of the response from the server. The longer it takes for the server to process the request and send a response, the slower your visitors&rsquo; browser is at displaying your page.</li><li><strong>Long Task Duration</strong>, a performance metric that can be used help developers to understand the bad user experience on the website, or can be an indication of a problem.</li><li><strong>Long Task Count</strong>, a metric to indicate how often a long task occurs, again used for exploring user experiences or problem detection.</li></ul><p><a href=#image-f832135420404eb835c724ce7a5a9f3a class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-Other.png alt=RUM-Other style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f832135420404eb835c724ce7a5a9f3a><img src=../en/rum/6-analyzing-metrics/../images/RUM-Other.png alt=RUM-Other class=lightbox-image loading=lazy></a></p><h3 id=26-custom-event-pane>2.6. Custom Event Pane</h3><p>The Custom Event View is the location where you will find the metrics for any event you may have added yourself to the web pages you are monitoring.</p><p>As we have seen in the RUM enabled website, we have added the following two lines:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Provider</span> <span class=o>=</span> <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>provider</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>tracer</span><span class=o>=</span><span class=nx>Provider</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=s1>&#39;appModuleLoader&#39;</span><span class=p>);</span></span></span></code></pre></div><p>These lines will automatically create custom Events for every new Page, and you can also add these to pieces of custom code that are not part of a framework or an event you created so you can better understand the flow though your application. We support <strong>Custom Event Requests</strong>, <strong>Custom Event Error Rates</strong> and <strong>Custom Event Latency</strong> metrics.</p><p><a href=#image-5e8294cf974978cc74c47f833956f494 class=lightbox-link><img src=../en/rum/6-analyzing-metrics/../images/RUM-Custom-Events.png alt=RUM-CustomMetrics style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5e8294cf974978cc74c47f833956f494><img src=../en/rum/6-analyzing-metrics/../images/RUM-Custom-Events.png alt=RUM-CustomMetrics class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=7-analyzing-rum-tags-in-the-tag-spotlight-view>7. Analyzing RUM Tags in the Tag Spotlight view</h1><ul><li>Look into the Metrics views for the various endpoints and use the Tags sent via the Tag spotlight for deeper analysis</li></ul><hr><h2 id=1-find-an-url-for-the-cart-endpoint>1. Find an url for the Cart endpoint</h2><p>From the RUM Overview page, please select the url for the <strong>Cart</strong> endpoint to dive deeper into the information available for this endpoint.</p><p><a href=#image-f6c864f66a85001a629c121f39420823 class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUM-select-cart.png alt=RUM-Cart2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f6c864f66a85001a629c121f39420823><img src=../en/rum/7-tag-spotlight/../images/RUM-select-cart.png alt=RUM-Cart2 class=lightbox-image loading=lazy></a></p><p>Once you have selected and clicked on the blue url, you will find yourself in the <strong>Tag Spotlight</strong> overview</p><p><a href=#image-88f63631789e690d00780cd8c48c84ea class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUM-TAG-Overview.png alt=RUM-Tag style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-88f63631789e690d00780cd8c48c84ea><img src=../en/rum/7-tag-spotlight/../images/RUM-TAG-Overview.png alt=RUM-Tag class=lightbox-image loading=lazy></a></p><p>Here you will see all of the tags that have been sent to Splunk RUM as part of the RUM traces. The tags displayed will be relevant to the overview that you have selected. These are generic Tags created automatically when the Trace was sent, and additional Tags you have added to the trace as part of the configuration of your website.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Additional Tags</div><div class=box-content><p>We are already sending two additional tags, you have seen them defined in the <em>Beacon url</em> that was added to your website: <code>app: "[nodename]-rum-app", environment: "[nodename]-rum-env"</code> in the first section of this workshop! You can add additional tags in a similar way.</p></div></div><p>In our example we have selected the <strong>Document Load Latency</strong> view as shown here:</p><p><a href=#image-ac1ca01c2535107f198c44c5628c8f15 class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUM-Selection.png alt=RUM-Header style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ac1ca01c2535107f198c44c5628c8f15><img src=../en/rum/7-tag-spotlight/../images/RUM-Selection.png alt=RUM-Header class=lightbox-image loading=lazy></a></p><p>You can select any of the following Tag views, each focused on a specific metric.</p><p><a href=#image-87891c62a3f6f218d9ae1b9561f964d0 class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUM-Tag-views.png alt=RUM-views style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-87891c62a3f6f218d9ae1b9561f964d0><img src=../en/rum/7-tag-spotlight/../images/RUM-Tag-views.png alt=RUM-views class=lightbox-image loading=lazy></a></p><hr><h2 id=2-explore-the-information-in-the-tag-spotlight-view>2. Explore the information in the Tag Spotlight view</h2><p>The Tag spotlight is designed to help you identify problems, either through the chart view,, where you may quickly identify outliers or via the TAGs.</p><p>In the <strong>Document Load Latency</strong> view, if you look at the <strong>Browser</strong>, <strong>Browser Version</strong> & <strong>OS Name</strong> Tag views,you can see the various browser types and versions, as well as for the underlying OS.</p><p>This makes it easy to identify problems related to specific browser or OS versions, as they would be highlighted.</p><p><a href=#image-43021edd2bd7545050fd3bd0bff95a8d class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUMBrowserTags.png alt=RUM-Tag2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-43021edd2bd7545050fd3bd0bff95a8d><img src=../en/rum/7-tag-spotlight/../images/RUMBrowserTags.png alt=RUM-Tag2 class=lightbox-image loading=lazy></a></p><p>In the above example you can see that Firefox had the slowest response, various Browser versions ( Chrome) that have different response times and the slow response of the Android devices.</p><p>A further example are the regional Tags that you can use to identify problems related to ISP or locations etc. Here you should be able to find the location you have been using to access the Online Boutique. Drill down by selecting the town or country you are accessing the Online Boutique from by clicking on the name as shown below (City of Amsterdam):</p><p><a href=#image-de395a50d3ffa2ab6988ea7d8788193c class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUM-Region.png alt=RUM-click style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-de395a50d3ffa2ab6988ea7d8788193c><img src=../en/rum/7-tag-spotlight/../images/RUM-Region.png alt=RUM-click class=lightbox-image loading=lazy></a></p><p>This will select only the traces relevant to the city selected as shown below:</p><p><a href=#image-4b88de67e8326943f43830a30f819fca class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUM-Adam.png alt=RUM-Adam style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4b88de67e8326943f43830a30f819fca><img src=../en/rum/7-tag-spotlight/../images/RUM-Adam.png alt=RUM-Adam class=lightbox-image loading=lazy></a></p><p>By selecting the various Tag you build up a filter, you can see the current selection below</p><p><a href=#image-d04e5929cd3986419c7a1eae60ec34c1 class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUM-Filter.png alt=RUM-Adam style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d04e5929cd3986419c7a1eae60ec34c1><img src=../en/rum/7-tag-spotlight/../images/RUM-Filter.png alt=RUM-Adam class=lightbox-image loading=lazy></a></p><p>To clear the filter and see every trace click on <strong>Clear All</strong> at the top right of the page.</p><p>If the overview page is empty or shows
<a href=#image-068b0f3844f01dcc4ecadb805704bd28 class=lightbox-link><img src="../en/rum/7-tag-spotlight/../images/RUM-NoTime.png?classes=inline&height=25px" alt=RUM-Adam class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-068b0f3844f01dcc4ecadb805704bd28><img src="../en/rum/7-tag-spotlight/../images/RUM-NoTime.png?classes=inline&height=25px" alt=RUM-Adam class=lightbox-image loading=lazy>
</a>, no traces have been received in the selected timeslot.
You need to increase the time window at the top left. You can start with the <em>Last 12 hours</em> for example.</p><p>You can then use your mouse to select the time slot you want like show in the view below and activate that time filter by clicking on the little spyglass icon.</p><p><a href=#image-09b6eb4e5dd6d6a75c17b4ed5a00915a class=lightbox-link><img src=../en/rum/7-tag-spotlight/../images/RUM-TimeSelect.png alt=RUM-time style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-09b6eb4e5dd6d6a75c17b4ed5a00915a><img src=../en/rum/7-tag-spotlight/../images/RUM-TimeSelect.png alt=RUM-time class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=8-analyzing-rum-sessions>8. Analyzing RUM Sessions</h1><ul><li>Dive into RUM Session information in the RUM UI</li><li>Identify Javascript errors in the Span of an user interaction</li></ul><hr><h2 id=1-again-select-the-cart-url>1. Again select the cart URL</h2><p>After you have focussed the time slot with the time selector, you need to reselect the <em>cart</em> url from <strong>Url Name</strong> view, as shown below:</p><p><a href=#image-f4750eb0438eeb84c3e19ed52222cf23 class=lightbox-link><img src=../en/rum/8-rum-sessions/../images/RUM-Cart-All.png alt=RUM-Cart-3 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f4750eb0438eeb84c3e19ed52222cf23><img src=../en/rum/8-rum-sessions/../images/RUM-Cart-All.png alt=RUM-Cart-3 class=lightbox-image loading=lazy></a></p><p>In the example above we selected <code>http://34.246.124.162:81/cart</code></p><h2 id=2-drill-down-in-the-sessions>2. Drill down in the Sessions</h2><p>After you have analyzed the information and drilled down via the Tag Spotlight to a subset of the traces, you can view the actual session as it was run by the end-user&rsquo;s browser.</p><p>You do this by clicking on the link <strong>Example Sessions</strong> as shown below:</p><p><a href=#image-dc1ad30bdc86f307ffdd59a43b01e634 class=lightbox-link><img src=../en/rum/8-rum-sessions/../images/RUM-ExampleSessions.png alt=RUM-Header style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-dc1ad30bdc86f307ffdd59a43b01e634><img src=../en/rum/8-rum-sessions/../images/RUM-ExampleSessions.png alt=RUM-Header class=lightbox-image loading=lazy></a></p><p>This will give you a list of sessions that matched both the time filter and the subset selected in the Tag Profile.</p><p>Select one by clicking on the session ID, It is a good idea to select one that has the longest duration (preferably over 700 ms).</p><p><a href=#image-ab8be1fb2e7a54b3659486cda21c3196 class=lightbox-link><img src=../en/rum/8-rum-sessions/../images/RUM-Session-Selected.png alt=RUM-Header style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ab8be1fb2e7a54b3659486cda21c3196><img src=../en/rum/8-rum-sessions/../images/RUM-Session-Selected.png alt=RUM-Header class=lightbox-image loading=lazy></a></p><p>Once you have selected the session, you will be taken to the session details page. As you are selecting a specific action that is part of the session, you will likely arrive somewhere in the middle of the session, at the moment of the interaction.</p><p>You can see the URL <code>http://34.246.124.162:81/cart</code>, the one you selected earlier, is where we are focusing on in the session stream.</p><p><a href=#image-db276931416262f5add3450c63eb1190 class=lightbox-link><img src=../en/rum/8-rum-sessions/../images/Session-Tag.png alt=RUM-Session-Tag style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-db276931416262f5add3450c63eb1190><img src=../en/rum/8-rum-sessions/../images/Session-Tag.png alt=RUM-Session-Tag class=lightbox-image loading=lazy></a></p><p>Scroll down a little bit on the page, so you see the end of the operation as shown below.</p><p><a href=#image-13b5d9e257778eb56923bb136814b3cb class=lightbox-link><img src=../en/rum/8-rum-sessions/../images/Session-Tag-2.png alt=RUM-Session-info style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-13b5d9e257778eb56923bb136814b3cb><img src=../en/rum/8-rum-sessions/../images/Session-Tag-2.png alt=RUM-Session-info class=lightbox-image loading=lazy></a></p><p>You can see that we have received a few Javascript Console errors that may not have been detected or visible to the end users. To examine these in more detail click on the middle one that says: *<strong>Cannot read properties of undefined (reading &lsquo;Prcie&rsquo;)</strong></p><p><a href=#image-f34c3a3bc00b02c1a908644bb0679a75 class=lightbox-link><img src=../en/rum/8-rum-sessions/../images/Session-Tag-3.png alt=RUM-Session-info style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f34c3a3bc00b02c1a908644bb0679a75><img src=../en/rum/8-rum-sessions/../images/Session-Tag-3.png alt=RUM-Session-info class=lightbox-image loading=lazy></a></p><p>This will cause the page to expand and show the Span detail for this interaction, It will contain a detailed <em>error.stack</em> you can pass on the developer to solve the issue. You may have noticed when buying in the Online Boutique that the final total always was $0.00.</p><p><a href=#image-b646da62ed1f43019faa1db5572a5f58 class=lightbox-link><img src=../en/rum/8-rum-sessions/../images/Session-Tag-4.png alt=RUM-Session-info style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b646da62ed1f43019faa1db5572a5f58><img src=../en/rum/8-rum-sessions/../images/Session-Tag-4.png alt=RUM-Session-info class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=9-correlate-between-splunk-rum-and-apm-backend-services>9. Correlate between Splunk RUM and APM backend services</h1><ul><li>Continue with the RUM Session information in the RUM UI</li><li>See correlated APM traces and logs in the APM & Log Observer UI</li></ul><hr><h2 id=1-finding-backend-service-issues>1. Finding backend service issues</h2><p>Click on the
<a href=#image-9965e5c758afbe0fcad1d680d868faed class=lightbox-link><img src="../en/rum/9-apm-correlation/../images/RUM-JS-Error.png?classes=inline&height=25px" alt=RUM-JS class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9965e5c758afbe0fcad1d680d868faed><img src="../en/rum/9-apm-correlation/../images/RUM-JS-Error.png?classes=inline&height=25px" alt=RUM-JS class=lightbox-image loading=lazy></a> to close the Span view.
Now continue to scroll down and find the <strong>POST /cart/checkout</strong> line.</p><p><a href=#image-99d3316f3829154c34c50ee55546b490 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/RUM-APM-Click.png alt=RUM-APM-Click style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-99d3316f3829154c34c50ee55546b490><img src=../en/rum/9-apm-correlation/../images/RUM-APM-Click.png alt=RUM-APM-Click class=lightbox-image loading=lazy></a></p><p>Click on the blue
<a href=#image-c6a61fb5b5a5be147467d0680877ef53 class=lightbox-link><img src="../en/rum/9-apm-correlation/../images/RUM-APM.png?classes=inline&height=25px" alt=RUM-APM-BLUE class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c6a61fb5b5a5be147467d0680877ef53><img src="../en/rum/9-apm-correlation/../images/RUM-APM.png?classes=inline&height=25px" alt=RUM-APM-BLUE class=lightbox-image loading=lazy></a> link, this should pop up a dialog showing information on the backend services that were part of the checkout action taken by the end user.</p><p><a href=#image-5fe62db706c106784d18dfe1e9d3ead2 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/RUM-Trace.png alt=RUM-APM-Trace style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5fe62db706c106784d18dfe1e9d3ead2><img src=../en/rum/9-apm-correlation/../images/RUM-Trace.png alt=RUM-APM-Trace class=lightbox-image loading=lazy></a></p><p>In this popup, there are multiple sections available, providing you with a quick insight in the behavior of your backend services. For example the Performance Summary section will tell you where the time was spent during the backend call.</p><p><a href=#image-999ab334a8f11c473cb659547afe4a61 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/RUM-Trace-Performance.png alt=RUM-APM-Trace-perf style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-999ab334a8f11c473cb659547afe4a61><img src=../en/rum/9-apm-correlation/../images/RUM-Trace-Performance.png alt=RUM-APM-Trace-perf class=lightbox-image loading=lazy></a></p><p>In the above example you can see that more than 77,9% was spent in external services.</p><p>If you scroll down to the bottom of the dialog, you can see the complete Trace and Services section like shown below:</p><p><a href=#image-8f078a6946be482b57a277504048f934 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/RUM-Trace-Services.png alt=RUM-APM-Trace-services style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8f078a6946be482b57a277504048f934><img src=../en/rum/9-apm-correlation/../images/RUM-Trace-Services.png alt=RUM-APM-Trace-services class=lightbox-image loading=lazy></a></p><p>in the Services map, you can see two services flagged red, the <strong>Checkout</strong> Service and the <strong>Payment</strong> Service in both in dark red. Light red means it received an error and dark red means an error originated from that service.</p><p><a href=#image-59bb1e71f6b13992d08e4a5b1fe6e6b4 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/RUM-Trace-Services-Detail.png alt=RUM-APM-Trace-services-detail style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-59bb1e71f6b13992d08e4a5b1fe6e6b4><img src=../en/rum/9-apm-correlation/../images/RUM-Trace-Services-Detail.png alt=RUM-APM-Trace-services-detail class=lightbox-image loading=lazy></a>
So already it is obvious there is a problem in the back end services.</p><p>Let&rsquo;s investigate!</p><h2 id=2--follow-the-trace-to-the-backend-service>2. Follow the Trace to the Backend service</h2><p>You can now click on the Trace Id link:</p><p><a href=#image-0ee830f786bc6e16085b45883c502a58 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/RUM-Trace-url.png alt=RUM-APM-Trace-link style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0ee830f786bc6e16085b45883c502a58><img src=../en/rum/9-apm-correlation/../images/RUM-Trace-url.png alt=RUM-APM-Trace-link class=lightbox-image loading=lazy></a></p><p>This will bring you to the Waterfall APM view that will show you what occurred in detail in a call to the backend services.
On the right you see the Trace Id: and again the Performance Summary, as we saw before.
In the waterfall, you can identify the various backend services that were part of this call from the frontend.</p><p>As you can see there are red error indicators
<a href=#image-9d37e6c1abaf71fd934f20196c87fc78 class=lightbox-link><img src="../en/rum/9-apm-correlation/../images/APM_Error_Flag.png?classes=inline&height=25px" alt=RUM-APM-error-flag class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9d37e6c1abaf71fd934f20196c87fc78><img src="../en/rum/9-apm-correlation/../images/APM_Error_Flag.png?classes=inline&height=25px" alt=RUM-APM-error-flag class=lightbox-image loading=lazy></a> before the <strong>Checkout</strong> Service and the <strong>Payment</strong> Service.</p><p><a href=#image-cec9279dfece956672ffab7d680bdfcf class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/RUM-APM-Waterfall.png alt=RUM-APM-waterfall style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cec9279dfece956672ffab7d680bdfcf><img src=../en/rum/9-apm-correlation/../images/RUM-APM-Waterfall.png alt=RUM-APM-waterfall class=lightbox-image loading=lazy></a></p><p>Click on the
<a href=#image-844536f233ab8b5a97bad14762577733 class=lightbox-link><img src="../en/rum/9-apm-correlation/../images/APM_Error_Flag.png?classes=inline&height=25px" alt=RUM-APM-error-flag class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-844536f233ab8b5a97bad14762577733><img src="../en/rum/9-apm-correlation/../images/APM_Error_Flag.png?classes=inline&height=25px" alt=RUM-APM-error-flag class=lightbox-image loading=lazy></a> after the <strong>paymentservice: grpc.hipstershop.PaymentService/Charge</strong> line.</p><p><a href=#image-265b247bdc808bcff9f9020e75e50426 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/payment-click.png alt=RUM-payment-click style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-265b247bdc808bcff9f9020e75e50426><img src=../en/rum/9-apm-correlation/../images/payment-click.png alt=RUM-payment-click class=lightbox-image loading=lazy></a></p><p>This will open the span detail page to show you the detailed information about this service call.
You wil see that the call returned a <strong>401</strong> error code or <em>Invalid Request</em>.</p><h2 id=3--use-the-related-content---logs>3. Use the Related Content - Logs</h2><p>As the Splunk Observability cloud suite correlates trace metrics and logs automatically, the system will show you in the related content bar at the bottom of the page, the corresponding logs for this trace.</p><p><a href=#image-15ed0ba1371c57ac273d91fedf1a3776 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/log-corelation.png alt=RUM-payment-related-content style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-15ed0ba1371c57ac273d91fedf1a3776><img src=../en/rum/9-apm-correlation/../images/log-corelation.png alt=RUM-payment-related-content class=lightbox-image loading=lazy></a></p><p>Click on the Log link to see the logs.</p><p>When the logs are shown, notice that the filter at the top of the page contains the logs for the trace.
Next select one of the lines indicating an error for the payment service.
This should open the log message on the right.</p><p>It clearly shows the reason why the payment service fails: we are using an invalid token towards the service:<br>*<strong>Failed payment processing through ButtercupPayments: Invalid API Token (test-20e26e90-356b-432e-a2c6-956fc03f5609)</strong></p><p><a href=#image-2ecd8d42757e4618038c4df7c4bffdb2 class=lightbox-link><img src=../en/rum/9-apm-correlation/../images/RUM-LogObserver.png alt=RUM-logs style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2ecd8d42757e4618038c4df7c4bffdb2><img src=../en/rum/9-apm-correlation/../images/RUM-LogObserver.png alt=RUM-logs class=lightbox-image loading=lazy></a></p><h2 id=4--conclusion>4. Conclusion</h2><p>In the workshop, you have seen how to add RUM functionality to you website.
We investigate the performance of your Website using RUM Metrics.
Using the Tag profile, you have searched for your own session, and with the session waterfall, you identified two problems:</p><ul><li>A Java script error that caused your price calculation to be zero.</li><li>An issue in the payment backend service that caused payments to fail.</li></ul><p>Using the ability to correlate RUM traces with the Backend APM trace and Logs, you have found the reason for the payment failure.</p><p>This concludes the RUM workshop.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=10-custom-alerts-and-charts-based-on-rum-metrics>10. Custom alerts and charts based on RUM Metrics</h1><ul><li>Use RUM Metrics to set up Alerts to be warned in case of an issue</li><li>Create a Custom Chart based on RUM Metrics</li></ul><hr><h2 id=1--overview>1. Overview</h2><p>The fact that Splunk&rsquo;s RUM is designed as a full fidelity solution, and thus can take 100% of your traces, allows it to detect and alert you to any change to the behavior of your website. It also give you the ability to to give you accurate insight in how your website is behaving by allowing you to creating custom Chart and Dashboards.
This allows you to combine data from your Website, Backend service and underlying Infrastructure. Allowing you to observe the complete stack that makes up your application/solution.</p><p>Creating charts or alerts for RUM Metrics are done in the same way as we do for Infrastructure Metrics. In this section we will create a simple chart, detector and alert.</p><p>If you previously done the Splunk IM Part of the Workshop, you will find this section very familiar. If you have not done the Splunk IM workshop before, it is recommended that you run though the <a href=../en/rum/10-alerting/../../imt/dashboards/>Dashboards</a> and <a href=../en/rum/10-alerting/../../imt/detectors/>Detectors</a> modules after completing the RUM workshop to get a better understanding of the capabilities.</p><h2 id=2-create-an-alert-on-one-of-the-rum-metrics>2. Create an alert on one of the RUM Metrics</h2><p>From the top left hamburger menu icon click <strong>Alerts</strong> in the menu and then select <strong>Detectors</strong>.</p><h2 id=3-create-a-chart-based-on-rum-metrics>3. Create a Chart based on Rum Metrics</h2><h3 id=31-overview>3.1 Overview</h3><p>Creating charts or alerts for RUM Metrics are done in the same way as we do for Infrastructure Metrics.
In this section we will create a simple chart, detector and alert
If you previously done the Splunk IM Part of the Workshop, you will find this section very familiar.</p><p><a href=#image-848e0201a6d390d3501dd60306db2fb1 class=lightbox-link><img src=../en/rum/10-alerting/../images/RUM-select-cart.png alt=RUM-Cart2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-848e0201a6d390d3501dd60306db2fb1><img src=../en/rum/10-alerting/../images/RUM-select-cart.png alt=RUM-Cart2 class=lightbox-image loading=lazy></a></p><p>u have added to the trace as part of the configuration of your website.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Additional Tags</div><div class=box-content><p>We are already sending two additional tags, you have seen them defined in the <em>Beacon url</em> that was added to your website in the first section of this workshop! You can add additional tag in a similar way.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=o>:</span> <span class=s2>&#34;[nodename]-rum-app&#34;</span><span class=p>,</span> <span class=nx>environment</span><span class=o>:</span> <span class=s2>&#34;[nodename]-rum-env&#34;</span></span></span></code></pre></div></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=11-introdcution-to-rum-for-mobile-applications>11. Introdcution to RUM for Mobile Applications</h1><ul><li>Short introduction to Mobile RUM</li><li>See an overview of the performance of your Mobile Application(s) in the Application Summary Dashboard</li></ul><hr><h2 id=1-visit-your-rum-application-summary-dashboard>1. Visit your RUM Application Summary Dashboard</h2><p>Visit and login into your Splunk IM/APM/RUM Website. From the left side menu bar select <strong>RUM</strong>
<a href=#image-1faecdb03ab77775abb280cd49c2e50d class=lightbox-link><img src="../en/rum/11-mobile-app-summary/../images/RUM_ico.png?classes=inline&height=25px" alt=RUM-ico class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1faecdb03ab77775abb280cd49c2e50d><img src="../en/rum/11-mobile-app-summary/../images/RUM_ico.png?classes=inline&height=25px" alt=RUM-ico class=lightbox-image loading=lazy>
</a>. This will bring you to your RUM Application Summary Page.</p><p>The goal of this page is to give you in a single pane/dashboard, a clear indication of the health, performance and potential errors found in your application(s) and allow you dive deeper into the information about your User Session ran against your web site.<br>You will have a pane for each of your active RUM applications. (The view below is the default expanded view)</p><p><a href=#image-3e35434c194b94857ea9d936bc9a7a3f class=lightbox-link><img src=../en/rum/11-mobile-app-summary/../images/Applicationsummarydashboard.png alt=RUM-App-sum style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-3e35434c194b94857ea9d936bc9a7a3f><img src=../en/rum/11-mobile-app-summary/../images/Applicationsummarydashboard.png alt=RUM-App-sum class=lightbox-image loading=lazy></a></p><p>If you have multiple applications, the pane view may be automatically reduced by collapsing the panes as shown below:</p><p><a href=#image-c9651244df657e0afcdc0903c2d0165a class=lightbox-link><img src=../en/rum/11-mobile-app-summary/../images/multiple_apps_collapsed.png alt=RUM-App-sum-collapsed style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c9651244df657e0afcdc0903c2d0165a><img src=../en/rum/11-mobile-app-summary/../images/multiple_apps_collapsed.png alt=RUM-App-sum-collapsed class=lightbox-image loading=lazy></a></p><p>You can expanded a condensed RUM Application Summary View to the full dashboard by clicking on the small browser
<a href=#image-95e3e4cf30678c4e31364dd1ca8c8207 class=lightbox-link><img src="../en/rum/11-mobile-app-summary/../images/browser.png?classes=inline&height=25px" alt=RUM-browser class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-95e3e4cf30678c4e31364dd1ca8c8207><img src="../en/rum/11-mobile-app-summary/../images/browser.png?classes=inline&height=25px" alt=RUM-browser class=lightbox-image loading=lazy></a> or Mobile
<a href=#image-5d27b95f3a2438ac3b056ec9eca4b579 class=lightbox-link><img src="../en/rum/11-mobile-app-summary/../images/mobile.png?classes=inline&height=25px" alt=RUM-mobile class=inline style=height:25px;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5d27b95f3a2438ac3b056ec9eca4b579><img src="../en/rum/11-mobile-app-summary/../images/mobile.png?classes=inline&height=25px" alt=RUM-mobile class=lightbox-image loading=lazy>
</a>icon. (Depending on the type of application: <em>Mobile</em> or <em>Browser</em> based) on the left in front of the applications name, highlighted by the red arrow.</p><h2 id=2-rum-mobile-overview>2. RUM Mobile Overview</h2><p>Splunk RUM supports Native Mobile RUM, for Apple iPhone and Android Phones. You can use this to see the End-user experience of your native Smartphone app.</p><p><a href=#image-0f424d807990f5a44e8a385259d6e300 class=lightbox-link><img src=../en/rum/11-mobile-app-summary/../images/RUM-Mobile.png alt=RUM-Header style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0f424d807990f5a44e8a385259d6e300><img src=../en/rum/11-mobile-app-summary/../images/RUM-Mobile.png alt=RUM-Header class=lightbox-image loading=lazy></a></p><p>The above screen is to show you the various metrics and data Splunk Mobile RUM can track. For example:</p><ul><li><strong>Custom events</strong>, similar to the Browser version.</li><li><strong>App Errors</strong> , with <em>App Errors</em> & <em>Crashes</em> per minute.</li><li><strong>App Lifecycle Performance</strong>, with <em>Cold Startup Time</em>, <em>Hot Startup Time</em> per OS.</li><li><strong>Request/Response</strong>, similar to the Browser version.</li></ul><p>At this point we will not go deeper into Mobile RUM, due to the need to run either a native app on a phone, or run an emulation. We can provide more information in a deep dive demo if needed.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=splunk-synthetics>Splunk Synthetics</h1><p><strong>Splunk Synthetic Monitoring</strong> offers the most comprehensive and in-depth capabilities for uptime and web performance optimization as part of the only complete observability suite, Splunk Observability Cloud.</p><p>Easily set up monitoring for APIs, service endpoints and end-user-experience. With Splunk Synthetic monitoring, go beyond basic uptime and performance monitoring and focus on proactively finding and fixing issues, optimizing web performance, and ensuring customers get the best user experience.</p><p>With Splunk Synthetic Monitoring you can:</p><ul><li>Detect and resolve issues fast across critical user flows, business transactions and API endpoints</li><li>Prevent web performance issues from affecting customers with an intelligence web optimization engine</li><li>And improve performance of all page resources and third-party dependencies</li></ul><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk Synthetics</h1><article class=default><header class=headline></header><h1 id=real-browser-checks>Real Browser Checks</h1><p>This Lab walks your through using the <a href="https://chrome.google.com/webstore/detail/selenium-ide/mooikfkahbdckldjjndioackbalphokd?hl=en" target=_blank>Chrome Selenium IDE</a> extension to create a synthetic transaction against a Splunk demo instance and creating a Splunk Synthetic Monitoring Real Browser Check (RBC). In addition you also get to learn other Splunk Synthetic Monitoring checks like REST API checks and Uptime Checks.</p><h2 id=1-prerequisites>1. Prerequisites</h2><p>Ensure you can login with your username and password at <a href=https://monitoring.rigor.com target=_blank>https://monitoring.rigor.com</a> and <a href=https://optimization.rigor.com target=_blank>https://optimization.rigor.com</a>. Also, make sure you are assigned to your own account for example: <strong>O11y Workshop</strong>.</p><p>Edit your Splunk Synthetic Monitoring account personal information and adjust your timezone and email notifications. Splunk Synthetic Monitoring will default to start sending you notifications, you can turn them off at the monitor configuration level.</p><p><a href=#image-7eca70ae93ffe08af3bfbc6b352c50e0 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image5.png alt="Edit Personal Information" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7eca70ae93ffe08af3bfbc6b352c50e0><img src=../en/synthetics/real-browser-checks/../images/image5.png alt="Edit Personal Information" class=lightbox-image loading=lazy></a></p><p>Add the <a href="https://chrome.google.com/webstore/detail/selenium-ide/mooikfkahbdckldjjndioackbalphokd?hl=en-US" target=_blank>Chrome Selenium IDE</a> extension to your <strong>Chrome</strong> Browser. Once installed click on the extension and you will see the following screen:</p><p><a href=#image-776b3e105b32f36fd5313d051f6c763e class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image17.png alt="Selenium IDE" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-776b3e105b32f36fd5313d051f6c763e><img src=../en/synthetics/real-browser-checks/../images/image17.png alt="Selenium IDE" class=lightbox-image loading=lazy></a></p><h2 id=2-using-selenium-ide>2. Using Selenium IDE</h2><p>You can now go ahead and record a web transaction using Selenium IDE to check on <a href=http://splunk.o11ystore.com target=_blank>http://splunk.o11ystore.com</a>.</p><p>Click on <strong>Record a new test in a new project</strong>, name the project <strong>[YOUR_INITIALS] - O11y Store</strong> e.g. RWC - O11y Store.</p><p>!!! question &ldquo;What is Selenium IDE?&rdquo;
- Selenium IDE is an open source record and playback test automation for the web.
- Selenium is a portable framework for testing web applications.
- Selenium provides a playback tool for authoring functional tests without the need to learn a test scripting language (Selenium IDE).
- It also provides a test domain-specific language (Selenese) to write tests in a number of popular programming languages, including C#, Groovy, Java, Perl, PHP, Python, Ruby and Scala.
- The tests can then run against most modern web browsers.
- Selenium runs on Windows, Linux, and macOS.
- It is open-source software released under the Apache License 2.0.</p><p><a href=#image-0a734ebe633985e2139539cc1304c774 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image29.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0a734ebe633985e2139539cc1304c774><img src=../en/synthetics/real-browser-checks/../images/image29.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Enter <a href=http://splunk.o11ystore.com target=_blank>http://splunk.o11ystore.com</a> as your base URL.</p><p><a href=#image-b6cadec39cfc53154ace4bbf1c52dd14 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image11.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b6cadec39cfc53154ace4bbf1c52dd14><img src=../en/synthetics/real-browser-checks/../images/image11.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Click
<span class="btn cstyle grey"><button type=button>
Start Recording</button>
</span>, a new window should open up with <a href=http://splunk.o11ystore.com target=_blank>splunk.o11ystore.com</a>. Click <strong>Vintage Camera Lens</strong>, click <strong>Add To Cart</strong> and then click <strong>Place Order</strong>.</p><p>Close the window and then stop the recording by navigating back to Selenium IDE. Finally name the test: <strong>[YOUR_INITIALS] - Checkout Flow (Desktop)</strong> e.g. RWC - Checkout Flow (Desktop).</p><p><a href=#image-172b40bacad2df750c7d6b582d592800 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image10.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-172b40bacad2df750c7d6b582d592800><img src=../en/synthetics/real-browser-checks/../images/image10.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Your Selenium IDE Project will look something like this:</p><p><a href=#image-eec55eb0753b14780082df3539c6ce9a class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image19.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-eec55eb0753b14780082df3539c6ce9a><img src=../en/synthetics/real-browser-checks/../images/image19.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Test your recording by pressing on the play button, make sure your recording successfully completes the transaction:</p><p><a href=#image-c6e4970a9eedd577a3c3d813eb0aef90 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image26.png alt=Run style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c6e4970a9eedd577a3c3d813eb0aef90><img src=../en/synthetics/real-browser-checks/../images/image26.png alt=Run class=lightbox-image loading=lazy></a></p><p>Save your Selenium IDE Project to your Downloads folder as <code>Workshop.side</code></p><p><a href=#image-da59f4ad056277d73ccc4f7e53a5bae3 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image30.png alt=Save style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-da59f4ad056277d73ccc4f7e53a5bae3><img src=../en/synthetics/real-browser-checks/../images/image30.png alt=Save class=lightbox-image loading=lazy></a></p><p><a href=#image-82d0c5eb3d9fa465edd219419a03e050 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/save-side-project.png alt="Save SIDE Project" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-82d0c5eb3d9fa465edd219419a03e050><img src=../en/synthetics/real-browser-checks/../images/save-side-project.png alt="Save SIDE Project" class=lightbox-image loading=lazy></a></p><h2 id=3-create-real-browser-check>3. Create Real Browser Check</h2><p>Login to Splunk Synthetic Monitoring using <a href=https://monitoring.rigor.com target=_blank>https://monitoring.rigor.com</a>. Click on <strong>REAL BROWSER</strong> and click
<span class="btn cstyle blue"><button type=button>
+ New</button>
</span>.</p><p><a href=#image-c59126c9c3ca470946b39f28e63511bd class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image3.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c59126c9c3ca470946b39f28e63511bd><img src=../en/synthetics/real-browser-checks/../images/image3.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Click on &ldquo;<strong>From File</strong>&rdquo; and select your recording then click on Import</p><p><a href=#image-8a236af68b4cb8c621ee2768ea0fd8ff class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image1.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8a236af68b4cb8c621ee2768ea0fd8ff><img src=../en/synthetics/real-browser-checks/../images/image1.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Set the <strong>Frequency</strong> to <strong>5 Minutes</strong></p><p><a href=#image-c88e25c2f83abd5ff47f9019fad7a885 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image15.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c88e25c2f83abd5ff47f9019fad7a885><img src=../en/synthetics/real-browser-checks/../images/image15.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Click on Steps and make the following adjustments to your recording provide a friendly name to Steps 1 (Click Camera), 2 (Add to Cart) & 3 (Place Order).</p><p><a href=#image-6bcf453a0ae2412a532b94b511c9efb9 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image6.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6bcf453a0ae2412a532b94b511c9efb9><img src=../en/synthetics/real-browser-checks/../images/image6.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Next, click <strong>+ Add Step</strong>, with this new step we will add some validation to the monitor. This is to ensure the checkout completed successfully.</p><p>Enter <strong>Confirm Order</strong> for the <strong>Name</strong> and change the <strong>Action</strong> to <strong>Wait for text present</strong> and finally enter <strong>Your order is complete!</strong> for the <strong>Value</strong>. You will now have a <strong>Start Url</strong> and 4 steps in your monitor configuration.</p><p><a href=#image-dbf8ec7a34f387013393e2bb4ef1cb3e class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image2.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-dbf8ec7a34f387013393e2bb4ef1cb3e><img src=../en/synthetics/real-browser-checks/../images/image2.png alt=placeholder class=lightbox-image loading=lazy></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>As you are creating the steps think about how to go about using the <strong>Business Transaction</strong> feature in Splunk Synthetic Monitoring which is very powerful.</p><p><em>&ldquo;Business Transactions are a combined group of contiguous steps in a Real Browser script that are to be measured as a whole. These transactions logically group similar parts of a flow together, so that users can view the performance of multiple steps and page(s) grouped under one Business Transaction.&rdquo;</em></p></div></div><p>Click on <strong>Advanced</strong> and make sure the <strong>Viewport Size</strong> is set to <strong>Default desktop: 1366 x 768</strong></p><p><a href=#image-690283a2264d3edfce0a12b20e605aee class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/viewport-size.png alt="Viewport Size" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-690283a2264d3edfce0a12b20e605aee><img src=../en/synthetics/real-browser-checks/../images/viewport-size.png alt="Viewport Size" class=lightbox-image loading=lazy></a></p><p>Click on &ldquo;<strong>Test</strong>&rdquo; to test your monitor. Once the test has successfully completed make sure to click on &ldquo;<strong>AFTER</strong>&rdquo; in Step 4 to validate the monitor was able to get to the order complete screenshot.</p><p><a href=#image-a8e3dc61cb7b716a85062e805e8a6a30 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image22.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a8e3dc61cb7b716a85062e805e8a6a30><img src=../en/synthetics/real-browser-checks/../images/image22.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Click on
<span class="btn cstyle blue"><button type=button>
Create</button></span> to save your Real Browser Monitor. After 5-10 minutes validate your monitor is working and producing successful checks e.g.</p><p><a href=#image-8f724cbaf46b94d1de015777486fc58e class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image27.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8f724cbaf46b94d1de015777486fc58e><img src=../en/synthetics/real-browser-checks/../images/image27.png alt=placeholder class=lightbox-image loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Tip</div><div class=box-content><p>You can force to run your monitor now using <strong>Run Now</strong></p><p><a href=#image-7fbe283d4a19b1878e555d01e731b14d class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image8.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7fbe283d4a19b1878e555d01e731b14d><img src=../en/synthetics/real-browser-checks/../images/image8.png alt=placeholder class=lightbox-image loading=lazy></a></p></div></div><p>Change your view to <strong>Segment by location</strong> and observe the difference. You can turn off/on locations by clicking on them.</p><p>!!! question &ldquo;Question?&rdquo;
Which Location has the poorest <strong>Response Time</strong>?</p><p><a href=#image-8ecddec7d80967858f9106246e87f193 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image9.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8ecddec7d80967858f9106246e87f193><img src=../en/synthetics/real-browser-checks/../images/image9.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Click on one of the successful circles to drill-down into that Run:</p><p><a href=#image-fac2429211e2f4a4f3c793dd9ef3c658 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image33.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-fac2429211e2f4a4f3c793dd9ef3c658><img src=../en/synthetics/real-browser-checks/../images/image33.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Take a moment to explore the metrics with the <strong>CONFIGURE METRICS/HIDE METRICS</strong> dropdown.</p><p><a href=#image-4498ef408ef603b1bd574fcfbb1c4cac class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image14.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4498ef408ef603b1bd574fcfbb1c4cac><img src=../en/synthetics/real-browser-checks/../images/image14.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Click <strong>Page 2</strong> in the dropdown, and scroll down to view the <strong>Filmstrip</strong> and the <strong>Waterfall Chart.</strong></p><p><a href=#image-b965ece2dac878c48a1bab2d01c9f5c5 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image16.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b965ece2dac878c48a1bab2d01c9f5c5><img src=../en/synthetics/real-browser-checks/../images/image16.png alt=placeholder class=lightbox-image loading=lazy></a></p><p><a href=#image-57268b1601c548befbd3898f49de8ab0 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/filmstrip.png alt=Filmstrip style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-57268b1601c548befbd3898f49de8ab0><img src=../en/synthetics/real-browser-checks/../images/filmstrip.png alt=Filmstrip class=lightbox-image loading=lazy></a></p><p><a href=#image-fbbd78fc3c96dbdbddcfae845b957638 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/waterfall.png alt=Waterfall style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-fbbd78fc3c96dbdbddcfae845b957638><img src=../en/synthetics/real-browser-checks/../images/waterfall.png alt=Waterfall class=lightbox-image loading=lazy></a></p><p>Click on <strong>Click Here to Analyze with Optimization</strong> which will prompt you to login to your Splunk Synthetic Monitoring Optimization Account. If you <strong>don&rsquo;t have this option</strong>, navigate to this <a href="https://optimization.rigor.com/s/2373818/?sh=3AF8C48AADD6D3E5F5DAA8B4B7BB7F45" target=_blank>page</a>.</p><p><a href=#image-b308ae14d36fc9ca565dee440d1ff9a5 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image31.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b308ae14d36fc9ca565dee440d1ff9a5><img src=../en/synthetics/real-browser-checks/../images/image31.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Click the &ldquo;<strong>Best Practices Score</strong>&rdquo; tab. Scroll down, and review all the findings</p><p><a href=#image-503b91180c0ba95a3302dc178720b13a class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image23.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-503b91180c0ba95a3302dc178720b13a><img src=../en/synthetics/real-browser-checks/../images/image23.png alt=placeholder class=lightbox-image loading=lazy></a></p><p><a href=#image-f6d6541bbc175d7aa25cff15edfacc53 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/best-practices.png alt="Best Practices" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f6d6541bbc175d7aa25cff15edfacc53><img src=../en/synthetics/real-browser-checks/../images/best-practices.png alt="Best Practices" class=lightbox-image loading=lazy></a></p><p>Spend some time to review the findings. Click into any line item</p><h2 id=4-create-mobile-check>4. Create Mobile Check</h2><p>Copy the RBC you created above:</p><p><a href=#image-848ba6337114d6a43d64dee77e7c7b59 class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/copy-check.png alt="Copy Check" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-848ba6337114d6a43d64dee77e7c7b59><img src=../en/synthetics/real-browser-checks/../images/copy-check.png alt="Copy Check" class=lightbox-image loading=lazy></a></p><p>Rename it, for example: <strong>RWC - Checkout Flow (Tablet)</strong></p><p><a href=#image-c72ef8a8bd9298ce5027d863e4abd40c class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/rename-check.png alt="Copy Check" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c72ef8a8bd9298ce5027d863e4abd40c><img src=../en/synthetics/real-browser-checks/../images/rename-check.png alt="Copy Check" class=lightbox-image loading=lazy></a></p><p>Under the <strong>Advanced</strong> tab, update the following three settings and create your new mobile RBC.</p><p><a href=#image-39b18871b16b6ba0889715138dd5f27a class=lightbox-link><img src=../en/synthetics/real-browser-checks/../images/image18.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-39b18871b16b6ba0889715138dd5f27a><img src=../en/synthetics/real-browser-checks/../images/image18.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Test & Validate the new monitor.</p><h2 id=5-resources>5. Resources</h2><ul><li><p><a href="https://help.rigor.com/hc/en-us/articles/115004652007?flash_digest=b1ef7d1a07b68d5279ee5fef8adb87fb878cf010" target=_blank>Getting Started With Selenium IDE</a></p></li><li><p><a href=http://www2.rigor.com/scripting-guide target=_blank>Splunk Synthetic Monitoring Scripting Guide</a></p></li><li><p><a href=https://help.rigor.com/hc/en-us/articles/115004443988-How-Can-I-Fix-A-Broken-Script target=_blank>How Can I Fix A Broken Script?</a></p></li><li><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction target=_blank>Introduction to the DOM</a> (Document Object Model (DOM)</p></li><li><p><a href=https://www.selenium.dev/selenium-ide/ target=_blank>Selenium IDE</a></p></li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=api-checks>API Checks</h1><p>The API Check provides a flexible way to check the functionality and performance of API endpoints. The shift toward API-first development has magnified the necessity to monitor the back-end services that provide your core front-end functionality. Whether you&rsquo;re interested in testing the multi-step API interactions or you want to gain visibility into the performance of your endpoints, the API Check can help you accomplish your goals.</p><h2 id=1-create-a-global-variable>1. Create a Global Variable</h2><p>View the global variable that we&rsquo;ll use to perform our API check. Click on <strong>Global Variables</strong> under <strong>Admin Tools</strong>. View the global variable that we&rsquo;ll use to make the spotify API transaction</p><p><a href=#image-cda5ab640866cc6c06d7e85540626f4b class=lightbox-link><img src=../en/synthetics/api-checks/../images/global-variable.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cda5ab640866cc6c06d7e85540626f4b><img src=../en/synthetics/api-checks/../images/global-variable.png alt=placeholder class=lightbox-image loading=lazy></a></p><h2 id=2-create-an-api-check>2. Create an API Check</h2><p>Create a new API Check and name it <code>&lt;your initials></code> followed by Splunk REST API Check for example: <strong>AP - Spotify API</strong></p><p><a href=#image-60150e48506f7a8acd7013d88c80de8d class=lightbox-link><img src=../en/synthetics/api-checks/../images/new-api-check.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-60150e48506f7a8acd7013d88c80de8d><img src=../en/synthetics/api-checks/../images/new-api-check.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Take a second to explore the notification tab after you&rsquo;ve named your check</p><p>Add the following API Check Steps:</p><p><a href=#image-e2108c042498895c5cbd82068ffd7ad7 class=lightbox-link><img src=../en/synthetics/api-checks/../images/api-check-steps.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e2108c042498895c5cbd82068ffd7ad7><img src=../en/synthetics/api-checks/../images/api-check-steps.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Available Variables to choose from:</p><p><a href=#image-5f1be85e783520b37488e9261697e09a class=lightbox-link><img src=../en/synthetics/api-checks/../images/available-variables.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5f1be85e783520b37488e9261697e09a><img src=../en/synthetics/api-checks/../images/available-variables.png alt=placeholder class=lightbox-image loading=lazy></a></p><p><strong><a href=https://help.rigor.com/hc/en-us/articles/115004583747-API-Check-Request-Step target=_blank>Request Step</a></strong></p><ul><li>A Request Step makes an HTTP request to some endpoint and collects data from that interaction. Unlike other check types, API Checks do not require an initial URL to start the check. All HTTP requests are configured within Request Steps.</li></ul><p><strong><a href=https://help.rigor.com/hc/en-us/articles/115004582607-API-Check-Extract-Step target=_blank>Extract Step</a></strong></p><ul><li><p>An Extract Step extracts data out of JSON, XML, or HTML formatted data.</p></li><li><p>To extract data out of JSON, supply three things:</p></li><li><p>The source containing the JSON,</p></li><li><p>The JSONPath expression to extract out the data, and</p></li><li><p>The name of the custom variable that you want to save to.</p></li><li><p>The source can be any JSON, but most likely will come from the response body. The source could also come from a response header or can be a custom value. The source must be well-formed JSON.</p></li></ul><p><strong><a href=https://help.rigor.com/hc/en-us/articles/115004743868-API-Check-Save-Step target=_blank>Save Step</a></strong></p><ul><li><p>A Save Step stores some data to be reused later in the check. To save data, supply the source and the name of the custom variable to save to. The source can be selected from the presets, including response headers, or by providing a custom value.</p></li><li><p>Some additional use cases are appending bits of information to easily reuse in other steps and saving the results from one request to be reused after another request is made.</p></li><li><p>It is important to remember that request variables are only available after a request is made. If you try to save a value from a request but haven&rsquo;t made a request yet, then an empty string will be saved.</p></li></ul><p><strong><a href=https://help.rigor.com/hc/en-us/articles/115004742408-API-Check-Assert-Step target=_blank>Assert Step</a></strong></p><ul><li>An Assert Step makes an assertion on two values. To make an assertion, supply two parameters along with the comparison that you would like to perform between the two.</li></ul><p><strong><a href=https://help.rigor.com/hc/en-us/articles/115004742408-API-Check-Assert-Step target=_blank>Comparisons</a></strong></p><ul><li><p>We currently support 3 types of comparisons: <strong>string</strong>, <strong>numeric</strong>, and <strong>regular expression</strong>.</p></li><li><p>For <strong>string</strong> and <strong>numeric</strong> comparisons, values are coerced to the comparison type before the comparison is made.</p></li><li><p>For a <strong>regular expression</strong> comparison, the first parameter is a string and the second parameter is a regular expression.</p></li></ul><p>Tag your API Check with Splunk and API and <strong>SAVE</strong> it</p><p><a href=#image-aa6567e5b96ecf2a045f4b9372f1cd6d class=lightbox-link><img src=../en/synthetics/api-checks/../images/tags.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-aa6567e5b96ecf2a045f4b9372f1cd6d><img src=../en/synthetics/api-checks/../images/tags.png alt=placeholder class=lightbox-image loading=lazy></a></p><h2 id=3-test-your-rest-api-check>3. Test your REST API Check</h2><p>Press got back into the edit configuration and press &rsquo;test&rsquo; at the bottom of the page to ensure there are no errors</p><p><a href=#image-29be91c1d9b7e8236ecbc773489a7214 class=lightbox-link><img src=../en/synthetics/api-checks/../images/test-api-check.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-29be91c1d9b7e8236ecbc773489a7214><img src=../en/synthetics/api-checks/../images/test-api-check.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Slide the window up to view details about the successful run</p><p><a href=#image-0c946fc9dde9d73bdd9cc88ca832846f class=lightbox-link><img src=../en/synthetics/api-checks/../images/successful-run.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0c946fc9dde9d73bdd9cc88ca832846f><img src=../en/synthetics/api-checks/../images/successful-run.png alt=placeholder class=lightbox-image loading=lazy></a></p><p><a href=#image-726bec513f1120d5473afde5c831466a class=lightbox-link><img src=../en/synthetics/api-checks/../images/request-step.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-726bec513f1120d5473afde5c831466a><img src=../en/synthetics/api-checks/../images/request-step.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Now, let&rsquo;s add some more functionality to the monitor. Slide the detailed window back down and add steps 5-8</p><p><strong>BONUS</strong>: use step 6 to assert that the following response came back in a timely manner (1000 ms)</p><p><a href=#image-6266cb55c3b7dd09331cedcf2b68a2d3 class=lightbox-link><img src=../en/synthetics/api-checks/../images/additional-steps.png alt=placeholder style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6266cb55c3b7dd09331cedcf2b68a2d3><img src=../en/synthetics/api-checks/../images/additional-steps.png alt=placeholder class=lightbox-image loading=lazy></a></p><p>Once the steps are added, test & save the monitor.</p><h2 id=4-resources>4. Resources</h2><ul><li><p><a href=https://help.rigor.com/hc/en-us/articles/115004817308-How-to-Create-an-API-Check target=_blank>How to Create an API Check</a></p></li><li><p><a href=https://help.rigor.com/hc/en-us/articles/115004952508-API-Check-Overview target=_blank>API Check Overview</a></p></li><li><p><a href=https://help.rigor.com/hc/en-us/articles/360049442854-How-Do-I-Use-Business-Transactions target=_blank>How Do I Use Business Transactions?</a></p></li></ul><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=splunk-oncall>Splunk OnCall</h1><h2 id=aim>Aim</h2><p>This module is simply to ensure you have access to the Splunk On-Call UI (formerly known as VictorOps), Splunk Infrastructure Monitoring UI (formerly known as SignalFx) and the EC2 Instance which has been allocated to you.</p><p>Once you have access to each platform, keep them open for the duration of the workshop as you will be switching between them and the workshop instructions.</p><h2 id=1-activate-your-splunk-on-call-login>1. Activate your Splunk On-Call Login</h2><p>You should have received an invitation to Activate your Splunk On-Call account via e-mail, if you have not already done so, click the <em>Activate Account</em> link and follow the prompts.</p><p>If you did not receive an invitation it is probably because you already have a Splunk On-Call login, linked to a different organisation.</p><p>If so login to that Org, then use the organisation dropdown next to your username in the top left to switch to the Observability Workshop Org.</p><p><a href=#image-2c0bb42819625ff19f04fe6f85545796 class=lightbox-link><img src=../en/oncall/images/switch-org.png alt="Switch Org" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2c0bb42819625ff19f04fe6f85545796><img src=../en/oncall/images/switch-org.png alt="Switch Org" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>If you do not see the Organisation dropdown menu item next to your name with Observability Workshop EMEA that is OK, it simply means you only have access to a single Org so that menu is not visible to you.</p><p>If you have forgotten your password go to the <a href=https://portal.victorops.com/membership/#/ target=_blank>https://portal.victorops.com/membership/#/</a> page and use the forgotten password link to reset your password.</p><p><a href=#image-e8e4402d9c946b04bb3a0f725634bd15 class=lightbox-link><img src=../en/oncall/images/reset-password.png alt="Reset Pwd" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e8e4402d9c946b04bb3a0f725634bd15><img src=../en/oncall/images/reset-password.png alt="Reset Pwd" class=lightbox-image loading=lazy></a></p></div></div><h2 id=2-activate-your-splunk-infrastructure-monitoring-login>2. Activate your Splunk Infrastructure Monitoring Login</h2><p>You should have received an invitation to join the Splunk Infrastructure Monitoring - Observability Workshop. If you have not already done so click the
<span class="btn cstyle transparent"><button type=button>
JOIN NOW</button></span> button and follow the prompts to set a password and activate your login.</p><h2 id=3-access-your-ec2-instance>3. Access your EC2 Instance</h2><p>Splunk has provided you with a dedicated EC2 Instance which you can use during this workshop for triggering Incidents the same way the instructor did during the introductory demo. This VM has Splunk Infrastructure Monitoring deployed and has an associated Detector configured. The Detector will pass Alerts to Splunk On-Call which will then create Incidents and page the on-call user.</p><p>The welcome e-mail you received providing you all the details for this Workshop contain the instructions for accessing your allocated EC2 Instance.</p><h3 id=ssh-mac-oslinux>SSH (Mac OS/Linux)</h3><p>Most attendees will be able to connect to the workshop by using SSH from their Mac or Linux device.</p><p>To use SSH, open a terminal on your system and type <code>ssh ubuntu@x.x.x.x</code> (replacing x.x.x.x with the IP address found in your welcome e-mail).</p><p><a href=#image-6991dbcff97886f8dc62f49f4bdccdaa class=lightbox-link><img src=../en/oncall/images/ssh-1.png alt="ssh login" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6991dbcff97886f8dc62f49f4bdccdaa><img src=../en/oncall/images/ssh-1.png alt="ssh login" class=lightbox-image loading=lazy></a></p><p>When prompted <strong><code>Are you sure you want to continue connecting (yes/no/[fingerprint])?</code></strong> please type <strong><code>yes</code></strong>.</p><p><a href=#image-ace40d876646225fd1576ab101ca230e class=lightbox-link><img src=../en/oncall/images/ssh-2.png alt="ssh password" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ace40d876646225fd1576ab101ca230e><img src=../en/oncall/images/ssh-2.png alt="ssh password" class=lightbox-image loading=lazy></a></p><p>Enter the password provided in the welcome e-mail.</p><p>Upon successful login you will be presented with the Splunk logo and the Linux prompt.</p><p><a href=#image-d6f3b5a81343cc544eabf3dbbc9bf677 class=lightbox-link><img src=../en/oncall/images/ssh-3.png alt="ssh connected" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d6f3b5a81343cc544eabf3dbbc9bf677><img src=../en/oncall/images/ssh-3.png alt="ssh connected" class=lightbox-image loading=lazy></a></p><p>At this point you are ready to <a href=../en/oncall/../../oncall/getting_started/user_profile>continue with the workshop</a> when instructed to do so by the instructor</p><hr><h3 id=putty-windows-users-only>Putty (Windows users only)</h3><p>If you do not have ssh preinstalled or if you are on a Windows system, the best option is to install putty, you can find the downloads <a href=https://www.putty.org/ target=_blank>here</a>.</p><p>!!! important
If you <strong>cannot</strong> install Putty, please go to <a href=../en/oncall/../getting_started/#web-browser-all>Web Browser (All)</a>.</p><p>Open Putty and in the <strong>Host Name (or IP address)</strong> field enter the IP address provided in the welcome e-mail.</p><p>You can optionally save your settings by providing a name and pressing <strong>Save</strong>.</p><p><a href=#image-76cc7a93a3d6bfa3590a19049ab9af83 class=lightbox-link><img src=../en/oncall/images/putty-settings.png alt=putty-2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-76cc7a93a3d6bfa3590a19049ab9af83><img src=../en/oncall/images/putty-settings.png alt=putty-2 class=lightbox-image loading=lazy></a></p><p>To then login to your instance click on the <strong>Open</strong> button as shown above.</p><p>If this is the first time connecting to your EC2 instance, you will be presented with a security dialog, please click <strong>Yes</strong>.</p><p><a href=#image-7adf0099974f3f29b1d607ef71f7acda class=lightbox-link><img src=../en/oncall/images/putty-security.png alt=putty-3 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7adf0099974f3f29b1d607ef71f7acda><img src=../en/oncall/images/putty-security.png alt=putty-3 class=lightbox-image loading=lazy></a></p><p>Once connected, login in as <strong>ubuntu</strong> using the password provided in the welcome e-mail.</p><p>Once you are connected successfully you should see a screen similar to the one below:</p><p><a href=#image-ac68261ee504dedbb08a8c1aab8d8444 class=lightbox-link><img src=../en/oncall/images/putty-loggedin.png alt=putty-4 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ac68261ee504dedbb08a8c1aab8d8444><img src=../en/oncall/images/putty-loggedin.png alt=putty-4 class=lightbox-image loading=lazy></a></p><p>At this point you are ready to <a href=../en/oncall/../../oncall/getting_started/user_profile>continue with the workshop</a> when instructed to do so by the instructor</p><hr><h3 id=web-browser-all>Web Browser (All)</h3><p>If you are blocked from using SSH (Port 22) or unable to install Putty you may be able to connect to the workshop instance by using a web browser.</p><p>!!! note
This assumes that access to port 6501 is not restricted by your company&rsquo;s firewall.</p><p>Open your web browser and type <code>http://x.x.x.x:650</code> (where <code>x.x.x.x</code> is the IP address from the welcome e-mail).</p><p><a href=#image-0b5abd6dca3b0bc980add90786f81755 class=lightbox-link><img src=../en/oncall/images/shellinabox-url.png alt=http-6501 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0b5abd6dca3b0bc980add90786f81755><img src=../en/oncall/images/shellinabox-url.png alt=http-6501 class=lightbox-image loading=lazy></a></p><p>Once connected, login in as <strong>ubuntu</strong> and the password is the one provided in the welcome e-mail.</p><p><a href=#image-ff3e6a050664bf37de989dc66cde4e84 class=lightbox-link><img src=../en/oncall/images/shellinabox-connect.png alt=http-connect style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ff3e6a050664bf37de989dc66cde4e84><img src=../en/oncall/images/shellinabox-connect.png alt=http-connect class=lightbox-image loading=lazy></a></p><p>Once you are connected successfully you should see a screen similar to the one below:</p><p><a href=#image-7e82654e60fadbf781d8c6d9ee15c0db class=lightbox-link><img src=../en/oncall/images/shellinabox-login.png alt="web login" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7e82654e60fadbf781d8c6d9ee15c0db><img src=../en/oncall/images/shellinabox-login.png alt="web login" class=lightbox-image loading=lazy></a></p><hr><h3 id=copy--paste-in-browser>Copy & Paste in browser</h3><p>Unlike when you are using regular SSH, <em>copy and paste</em> does require a few extra steps to complete when using a browser session. This is due to cross browser restrictions.</p><p>When the workshop asks you to copy instructions into your terminal, please do the following:</p><p><em>Copy the instruction as normal, but when ready to paste it in the web terminal, choose <strong>Paste from browser</strong> as show below:</em></p><p><a href=#image-9d65ba004621a28f94b8c4bbaac38ed8 class=lightbox-link><img src=../en/oncall/images/shellinabox-paste-browser.png alt="web paste 1" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9d65ba004621a28f94b8c4bbaac38ed8><img src=../en/oncall/images/shellinabox-paste-browser.png alt="web paste 1" class=lightbox-image loading=lazy></a></p><p>This will open a dialog box asking for the text to be pasted into the web terminal:</p><p><a href=#image-55068c93a6cdb80ffac112c2702260b0 class=lightbox-link><img src=../en/oncall/images/shellinabox-example-1.png alt="web paste 3" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-55068c93a6cdb80ffac112c2702260b0><img src=../en/oncall/images/shellinabox-example-1.png alt="web paste 3" class=lightbox-image loading=lazy></a></p><p>Paste the text in the text box as show, then press <strong>OK</strong> to complete the copy and paste process.</p><div class="box notices cstyle primary"><div class=box-label></div><div class=box-content><p>Unlike regular SSH connection, the web browser has a 60 second time out, and you will be disconnected, and a <strong>Connect</strong> button will be shown in the center of the web terminal.</p><p>Simply click the <strong>Connect</strong> button and you will be reconnected and will be able to continue.</p></div></div><p>At this point you are ready to <a href=../en/oncall/../../oncall/getting_started/user_profile>continue with the workshop</a> when instructed to do so by the instructor</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Splunk OnCall</h1><article class=default><header class=headline></header><h1 id=user-profile>User Profile</h1><h2 id=aim>Aim</h2><p>The aim of this module is for you to configure your personal profile which controls how you will be notified by Splunk On-Call whenever you get paged.</p><h2 id=1-contact-methods>1. Contact Methods</h2><p>Switch to the Splunk On-Call UI and click on your login name in the top right hand corner and chose <strong>Profile</strong> from the drop down. Confirm your contact methods are listed correctly and add any additional phone numbers and e-mail address you wish to use.</p><h2 id=2-mobile-devices>2. Mobile Devices</h2><p>To install the Splunk On-Call app for your smartphone search your phones App Store for Splunk On-Call to find the appropriate version of the app. The publisher should be listed as VictorOps Inc.</p><p><a href=https://apps.apple.com/us/app/victorops/id696974262 target=_blank>Apple Store</a></p><p><a href="https://play.google.com/store/apps/details?id=com.victorops.androidclient&hl=en" target=_blank>Google Play</a></p><p>Configuration help guides are available:</p><ul><li><a href=https://help.victorops.com/knowledge-base/ios-application/ target=_blank>Apple</a></li><li><a href=https://help.victorops.com/knowledge-base/android-devices-victorops/ target=_blank>Android</a></li></ul><p>Install the App and login, then refresh the Profile page and your device should now be listed under the devices section. Click the <strong>Test push notification</strong> button and confirm you receive the test message.</p><h2 id=3-personal-calendar>3. Personal Calendar</h2><p>This link will enable you to sync your on-call schedule with your calendar, however as you do not have any allocated shifts yet this will currently be empty. You can add it to your calendar by copying the link into your preferred application and setting it up as a new subscription.</p><h2 id=4-paging-policies>4. Paging Policies</h2><p>Paging Polices specify how you will be contacted when on-call. The Primary Paging Policy will have defaulted to sending you an SMS assuming you added your phone number when activating your account. We will now configure this policy into a three tier multi-stage policy similar to the image below.</p><p><a href=#image-671212cfd6f2788b1870fb2ee8b7f8b5 class=lightbox-link><img src=../en/oncall/getting_started/../images/primary-paging-policy.png alt="Paging Policy" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-671212cfd6f2788b1870fb2ee8b7f8b5><img src=../en/oncall/getting_started/../images/primary-paging-policy.png alt="Paging Policy" class=lightbox-image loading=lazy></a></p><h3 id=41-send-a-push-notification>4.1 Send a push notification</h3><p>Click the edit policy button in the top right corner for the Primary Paging Policy.</p><ul><li>Send a push notification to all my devices</li><li>Execute the next step if I have not responded within 5 minutes</li></ul><p><a href=#image-6b97ee4f08f124c6b85b376568331d3b class=lightbox-link><img src=../en/oncall/getting_started/../images/pri-page-step1.png alt="Step 1" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6b97ee4f08f124c6b85b376568331d3b><img src=../en/oncall/getting_started/../images/pri-page-step1.png alt="Step 1" class=lightbox-image loading=lazy></a></p><p>Click <strong>Add a Step</strong></p><h3 id=42-send-an-e-mail>4.2 Send an e-mail</h3><ul><li>Send an e-mail to [your email address]</li><li>Execute the next step if I have not responded within 5 minutes</li></ul><p><a href=#image-481263ba21578caf73232d63c59a23a0 class=lightbox-link><img src=../en/oncall/getting_started/../images/pri-page-step2.png alt="Step 2" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-481263ba21578caf73232d63c59a23a0><img src=../en/oncall/getting_started/../images/pri-page-step2.png alt="Step 2" class=lightbox-image loading=lazy></a></p><p>Click <strong>Add a Step</strong></p><h3 id=43-call-your-number>4.3 Call your number</h3><ul><li>Every 5 minutes until we have reached you</li><li>Make a phone call to [your phone number]</li></ul><p>Click
<span class="btn cstyle default" style=--VARIABLE-BOX-color:#00bce4><button type=button>
Save</button></span> to save the policy.</p><p><a href=#image-0a926d7ce3981641736b73d2204b08bd class=lightbox-link><img src=../en/oncall/getting_started/../images/pri-page-step3.png alt="Step 3" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0a926d7ce3981641736b73d2204b08bd><img src=../en/oncall/getting_started/../images/pri-page-step3.png alt="Step 3" class=lightbox-image loading=lazy></a></p><p>When you are on-call or in the escalation path of an incident, you will receive notifications in this order following these time delays.</p><p>To cease the paging you must acknowledge the incident. Acknowledgements can occur in one of the following ways:</p><ul><li>Expanding the Push Notification on your device and selecting Acknowledge</li><li>Responding to the SMS with the 5 digit code included</li><li>Pressing 4 during the Phone Call</li><li>Slack Button</li></ul><p>For more information on Notification Types, see <a href=https://help.victorops.com/knowledge-base/notification-types/ target=_blank>here</a>.</p><h2 id=5-custom-paging-policies>5. Custom Paging Policies</h2><p>Custom paging polices enable you to override the primary policy based on the time and day of the week. A good example would be to get the system to immediately phone you whenever you get a page during the evening or weekends as this is more likely to get your attention than a push notification.</p><p>Create a new Custom Policy by clicking <strong>Add a Policy</strong> and configure with the following settings:</p><h3 id=51-custom-evening-policy>5.1 Custom evening policy</h3><p>Policy Name: Evening</p><ul><li>Every 5 minutes until we have reached you<ul><li>Make a phone call to [your phone number]</li><li>Time Period: All 7 Days</li><li>Timezone<ul><li>Between 7pm and 9am</li></ul></li></ul></li></ul><p><a href=#image-77fb643d6acb0424d47fe9461ac26117 class=lightbox-link><img src=../en/oncall/getting_started/../images/evening.png alt=Evening style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-77fb643d6acb0424d47fe9461ac26117><img src=../en/oncall/getting_started/../images/evening.png alt=Evening class=lightbox-image loading=lazy></a></p><p>Click
<span class="btn cstyle default" style=--VARIABLE-BOX-color:#00bce4><button type=button>
Save</button></span> to save the policy then add one more.</p><h3 id=52-custom-weekend-policy>5.2 Custom weekend policy</h3><p>Policy Name: Weekend</p><ul><li>Every 5 minutes until we have reached you<ul><li>Make a phone call to [your phone number]</li><li>Time Period: Sat & Sun</li><li>Timezone<ul><li>Between 9am and 7pm</li></ul></li></ul></li></ul><p>Click
<span class="btn cstyle default" style=--VARIABLE-BOX-color:#00bce4><button type=button>
Save</button></span> to save the policy.</p><p><a href=#image-c4d3ff36b6a0354831553a70b9d00b28 class=lightbox-link><img src=../en/oncall/getting_started/../images/weekends.png alt=Weekends style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c4d3ff36b6a0354831553a70b9d00b28><img src=../en/oncall/getting_started/../images/weekends.png alt=Weekends class=lightbox-image loading=lazy></a></p><p>These custom paging policies will be used during the specified times in place of the Primary Policy. However, admins do have the ability to ignore these custom policies, and we will highlight how this is achieved in a later module.</p><p>The final option here is the setting for Recovery Notifications. These are typically low priority, will default to Push, but can also be email, sms or phone call. Your profile is now fully configured using these example configurations.</p><p>Organizations will have different views on how profiles should be configured and will typically issue guidelines for paging policies and times between escalations etc.</p><p>Please wait for the instructor before proceeding to the Teams module.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of User Profile</h1><article class=default><header class=headline></header><h1 id=teams>Teams</h1><h2 id=aim>Aim</h2><p>The aim of this module is for you to complete the first step of Team configuration by adding users to your Team.</p><h2 id=1-find-your-team>1. Find your Team</h2><p>Navigate to the <strong>Teams</strong> tab on the main toolbar, you should find you that a Team has been created for you as part of the workshop pre-setup and you would have been informed of your Team Name via e-mail.</p><p>If you have found your pre-configured Team, <strong>skip Step 2.</strong> and proceed to <strong><a href=../en/oncall/getting_started/team/../team/#3-configure-your-team>Step 3. Configure Your Team</a></strong>. However, if you cannot find your allocated Team, you will need to create a new one, so proceed with <strong>Step 2. Create Team</strong></p><h2 id=2-create-team>2. Create Team</h2><p>Only complete this step if you <strong>cannot</strong> find your pre-allocated Team as detailed in your workshop e-mail. Select <strong>Add Team</strong>, then enter your allocated team name, this will typically be in the format of &ldquo;AttendeeID Workshop&rdquo; and then save by clicking the <strong>Add Team</strong> button.</p><h2 id=3-configure-your-team>3. Configure Your Team</h2><p>You now need to add other users to your team. If you are running this workshop using the Splunk provided environment, the following accounts are available for testing. If you are running this lab in your own environment, you will have been provided a list of usernames you can use in place of the table below.</p><p>These users are dummy accounts who will not receive notifications when they are on call.</p><table><thead><tr><th>Name</th><th>Username</th><th>Shift</th></tr></thead><tbody><tr><td>Duane Chow</td><td>duanechow</td><td>Europe</td></tr><tr><td>Steven Gomez</td><td>gomez</td><td>Europe</td></tr><tr><td>Walter White</td><td>heisenberg</td><td>Europe</td></tr><tr><td>Jim Halpert</td><td>jimhalpert</td><td>Asia</td></tr><tr><td>Lydia Rodarte-Quayle</td><td>lydia</td><td>Asia</td></tr><tr><td>Marie Schrader</td><td>marie</td><td>Asia</td></tr><tr><td>Maximo Arciniega</td><td>maximo</td><td>West Coast</td></tr><tr><td>Michael Scott</td><td>michaelscott</td><td>West Coast</td></tr><tr><td>Tuco Salamanca</td><td>tuco</td><td>West Coast</td></tr><tr><td>Jack Welker</td><td>jackwelker</td><td>24/7</td></tr><tr><td>Hank Schrader</td><td>hank</td><td>24/7</td></tr><tr><td>Pam Beesly</td><td>pambeesly</td><td>24/7</td></tr></tbody></table><p>Add the users to your team, using either the above list or the alternate one provided to you. The value in the <strong>Shift</strong> column can be ignored for now, but will be required for a later step.</p><p>Click
<span class="btn cstyle default" style=--VARIABLE-BOX-color:#00bce4><button type=button>
Invite User</button></span> button on the right hand side, then either start typing the usernames (this will filter the list), or copy and paste them into the dialogue box. Once all users are added to the list click the <strong>Add User</strong> button.</p><p><a href=#image-dad7d6b2dcaee59c6edd4dd28cc46223 class=lightbox-link><img src=../en/oncall/getting_started/team/../../images/add-team-members.png alt="Add Team Members" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-dad7d6b2dcaee59c6edd4dd28cc46223><img src=../en/oncall/getting_started/team/../../images/add-team-members.png alt="Add Team Members" class=lightbox-image loading=lazy></a></p><p>To make a team member a Team Admin, simply click the :fontawesome-regular-edit: icon in the right hand column, pick any user and make them an Admin.</p><p><a href=#image-05ecc5a77c3758d9590680b2fb9a99b0 class=lightbox-link><img src=../en/oncall/getting_started/team/../../images/team-admin.png alt="Add Admin" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-05ecc5a77c3758d9590680b2fb9a99b0><img src=../en/oncall/getting_started/team/../../images/team-admin.png alt="Add Admin" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle default" style=--VARIABLE-BOX-color:info><div class=box-label>Tip</div><div class=box-content><p>For large team management you can use the APIs to streamline this process.</p></div></div><p>Continue and also complete the <a href=../en/oncall/getting_started/team/../rotations/>Configure Rotations</a> module.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=configure-rotations>Configure Rotations</h1><h2 id=aim>Aim</h2><p>A rotation is a recurring schedule, that consists of one or more shifts, with members who rotate through a shift.</p><p>The aim of this module is for you to configure two example Rotations, and assign Team Members to the Rotations.</p><hr><p>Navigate to the <strong>Rotations</strong> tab on the <strong>Teams</strong> sub menu, you should have no existing Rotations so we need to create some.</p><p>The 1st Rotation you will create is for a follow the sun support pattern where the members of each shift provide cover during their normal working hours within their time zone.</p><p>The 2nd will be a Rotation used to provide escalation support by more experienced senior members of the team, based on a 24/7, 1 week shift pattern.</p><h2 id=1-follow-the-sun-support---business-hours>1. Follow the Sun Support - Business Hours</h2><p>Click <strong>Add Rotation</strong></p><p><a href=#image-3d73c5bfadd82dcf7c4f4ee242784d79 class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/add-rotation.png alt="Add Rotation" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-3d73c5bfadd82dcf7c4f4ee242784d79><img src=../en/oncall/getting_started/rotations/../../images/add-rotation.png alt="Add Rotation" class=lightbox-image loading=lazy></a></p><p>Enter a name of &ldquo;<em>Follow the Sun Support - Business Hours</em>&rdquo; and Select <strong>Partial day</strong> from the three available shift templates.</p><p><a href=#image-1116acc464e3fecfd783b4778b0613f0 class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/follow-the-sun.png alt="Follow the Sun" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1116acc464e3fecfd783b4778b0613f0><img src=../en/oncall/getting_started/rotations/../../images/follow-the-sun.png alt="Follow the Sun" class=lightbox-image loading=lazy></a></p><ul><li>Enter a Shift name of &ldquo;<em>Asia</em>&rdquo;</li><li>Time Zone set to &ldquo;<em>Asia/Tokyo</em>&rdquo;</li><li>Each user is on duty from &ldquo;<em>Monday through Friday from 9.00am to 5.00pm</em>&rdquo;</li><li>Handoff happens every &ldquo;<em>5 days</em>&rdquo;</li><li>The next handoff happens - Select the next Monday using the calendar</li><li>Click <strong>Save Rotation</strong></li></ul><p><a href=#image-e9c899b0a7f9dc3738c3c2d63e6b8103 class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/asia-shift.png alt="Asia Shift" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e9c899b0a7f9dc3738c3c2d63e6b8103><img src=../en/oncall/getting_started/rotations/../../images/asia-shift.png alt="Asia Shift" class=lightbox-image loading=lazy></a></p><p>You will now be prompted to add Members to this shift; add the Asia members who are <strong>Jim Halpert, Lydie Rodarte-Quayle and Marie Schrader</strong>, but only if you&rsquo;re using the Splunk provided environment for this workshop.</p><p>If you&rsquo;re using your own Organisation refer to the specific list provided separately.</p><p><a href=#image-52b1b7bb70f62c7ef547f1de3805c768 class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/asia-members.png alt="Asia Members" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-52b1b7bb70f62c7ef547f1de3805c768><img src=../en/oncall/getting_started/rotations/../../images/asia-members.png alt="Asia Members" class=lightbox-image loading=lazy></a></p><p>Now add an 2nd shift for Europe by again clicking <strong>+Add a shift ‚Üí Partial Day</strong></p><ul><li>Enter a Shift name of &ldquo;<em>Europe</em>&rdquo;</li><li>Time Zone set to &ldquo;<em>Europe/London</em>&rdquo;</li><li>Each user is on duty from &ldquo;<em>Monday through Friday from 9.00am to 5.00pm</em>&rdquo;</li><li>Handoff happens every &ldquo;<em>5 days</em>&rdquo;</li><li>The next handoff happens - Select the next Monday using the calendar</li><li>Click <strong>Save Shift</strong></li></ul><p><a href=#image-a362a83a4f4f52079614b27516a5c735 class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/europe-shift.png alt="Europe Shift" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a362a83a4f4f52079614b27516a5c735><img src=../en/oncall/getting_started/rotations/../../images/europe-shift.png alt="Europe Shift" class=lightbox-image loading=lazy></a></p><p>You will again be prompted to add Members to this shift; add the Europe members who are <strong>Duane Chow, Steven Gomez and Walter White</strong>, but only if you&rsquo;re using the Observability Workshop Org for this workshop.</p><p>If you&rsquo;re using your own Organisation refer to the specific list provided separately.</p><p><a href=#image-ae9464c59b42105f01b61d27d7506cdd class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/europe-members.png alt="Europe Members" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ae9464c59b42105f01b61d27d7506cdd><img src=../en/oncall/getting_started/rotations/../../images/europe-members.png alt="Europe Members" class=lightbox-image loading=lazy></a></p><p>Now add a 3rd shift for West Coast USA by again clicking <code>+Add a shift</code> - <code>Partial Day</code></p><ul><li>Enter a Shift name of &ldquo;<em>West Coast</em>&rdquo;</li><li>Time Zone set to &ldquo;<em>US/Pacific</em>&rdquo;</li><li>Each user is on duty from &ldquo;<em>Monday through Friday from 9.00am to 5.00pm</em>&rdquo;</li><li>Handoff happens every &ldquo;<em>5 days</em>&rdquo;</li><li>The next handoff happens - Select the next Monday using the calendar</li><li>Click <strong>Save Shift</strong></li></ul><p><a href=#image-c8ef920ce259c745758ee180db55ba87 class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/west-coast-shift.png alt="West Coast Shift" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c8ef920ce259c745758ee180db55ba87><img src=../en/oncall/getting_started/rotations/../../images/west-coast-shift.png alt="West Coast Shift" class=lightbox-image loading=lazy></a></p><p>You will again be prompted to add Members to this shift; add the West Coast members who are <strong>Maximo Arciniega, Michael Scott and Tuco Salamanca</strong>, but only if you&rsquo;re using the Observability Workshop Org for this workshop.</p><p>If you&rsquo;re using your own Organisation refer to the specific list provided separately.</p><p><a href=#image-a524dc1e55d6b5b612aa47fc59dcb11b class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/west-coast-members.png alt="West Coast Members" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a524dc1e55d6b5b612aa47fc59dcb11b><img src=../en/oncall/getting_started/rotations/../../images/west-coast-members.png alt="West Coast Members" class=lightbox-image loading=lazy></a></p><p>The first user added will be the &lsquo;current&rsquo; user for that shift.</p><p>You can re-order the shifts by simply dragging the users up and down, and you can change the current user by clicking <code>Set Current</code> on an alternate user</p><p>You will now have three different Shift patterns, that provide cover 24hr hours, Mon - Fri, but with no cover at weekends.</p><p>We will now add another Rotation for our Senior SRE Escalation cover.</p><hr><h2 id=2-senior-sre-escalation>2. Senior SRE Escalation</h2><ul><li>Click <strong>Add Rotation</strong></li><li>Enter a name of &ldquo;<em>Senior SRE Escalation</em>&rdquo;</li><li>Select <code>24/7</code> from the three available shift templates</li><li>Enter a Shift name of &ldquo;<em>Senior SRE Escalation</em>&rdquo;</li><li>Time Zone set to &ldquo;<em>Asia/Tokyo</em>&rdquo;</li><li>Handoff happens every &ldquo;<em>7 days at 9.00am</em>&rdquo;</li><li>The next handoff happens [select the next Monday from the date picker]</li><li>Click <strong>Save Rotation</strong></li></ul><p><a href=#image-b6f699cc5d8f04ff31c5dd05a0a2b0f7 class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/24-7-shift.png alt="24/7 Shift" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b6f699cc5d8f04ff31c5dd05a0a2b0f7><img src=../en/oncall/getting_started/rotations/../../images/24-7-shift.png alt="24/7 Shift" class=lightbox-image loading=lazy></a></p><p>You will again be prompted to add Members to this shift; add the 24/7 members who are <strong>Jack Welker, Hank Schrader and Pam Beesly</strong>, but only if you&rsquo;re using the Observability Workshop Org for this workshop.</p><p>If you&rsquo;re using your own Organisation refer to the specific list provided separately.</p><p><a href=#image-c5c4972fce93f798f9f51a0886a4a8e1 class=lightbox-link><img src=../en/oncall/getting_started/rotations/../../images/24-7-members.png alt="24/7 Members" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c5c4972fce93f798f9f51a0886a4a8e1><img src=../en/oncall/getting_started/rotations/../../images/24-7-members.png alt="24/7 Members" class=lightbox-image loading=lazy></a></p><hr><p>Please wait for the instructor before proceeding to the Configuring Escalation Policies module.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=configure-escalation-policies>Configure Escalation Policies</h1><h2 id=aim>Aim</h2><p>Escalation policies determine who is actually on-call for a given team and are the link to utilizing any rotations that have been created.</p><p>The aim of this module is for you to create three different Escalation Policies to demonstrate a number of different features and operating models.</p><p>The instructor will start by explaining the concepts before you proceed with the configuration.</p><hr><p>Navigate to the Escalation Polices tab on the Teams sub menu, you should have no existing Polices so we need to create some.</p><p><a href=#image-675e4265b05aecb40ec5ed4d08441701 class=lightbox-link><img src=../en/oncall/getting_started/escalation/../../images/no-escalation.png alt="No Escalation Policies" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-675e4265b05aecb40ec5ed4d08441701><img src=../en/oncall/getting_started/escalation/../../images/no-escalation.png alt="No Escalation Policies" class=lightbox-image loading=lazy></a></p><p>We are going to create the following Polices to cover off three typical use cases.</p><p><a href=#image-91dab16d38c749786aeecfe452463632 class=lightbox-link><img src=../en/oncall/getting_started/escalation/../../images/escalation-policies.png alt="Escalation Policies" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-91dab16d38c749786aeecfe452463632><img src=../en/oncall/getting_started/escalation/../../images/escalation-policies.png alt="Escalation Policies" class=lightbox-image loading=lazy></a></p><h2 id=1-247-policy>1. 24/7 Policy</h2><p>Click <strong>Add Escalation Policy</strong></p><ul><li>Policy Name: 24/7</li><li>Step 1</li><li>Immediately<ul><li>Notify the on-duty user(s) in rotation ‚Üí Senior SRE Escalation</li><li>Click <strong>Save</strong></li></ul></li></ul><p><a href=#image-6bb8454b1ee74da8fb948b360095c115 class=lightbox-link><img src=../en/oncall/getting_started/escalation/../../images/24-7-escalation-policy.png alt="24/7 Escalation Policy " style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6bb8454b1ee74da8fb948b360095c115><img src=../en/oncall/getting_started/escalation/../../images/24-7-escalation-policy.png alt="24/7 Escalation Policy " class=lightbox-image loading=lazy></a></p><h2 id=2-primary-policy>2. Primary Policy</h2><p>Click <strong>Add Escalation Policy</strong></p><ul><li>Policy Name: Primary</li><li>Step 1</li><li>Immediately</li><li>Notify the on-duty user(s) in rotation ‚Üí Follow the Sun Support - Business Hours</li><li>Click <strong>Add Step</strong></li></ul><p><a href=#image-ea7b6d8d2100c40fb401708843604195 class=lightbox-link><img src=../en/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-1.png alt="Pri Escalation Policy Step 1" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ea7b6d8d2100c40fb401708843604195><img src=../en/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-1.png alt="Pri Escalation Policy Step 1" class=lightbox-image loading=lazy></a></p><ul><li>Step 2</li><li>If still unacked after 15 minutes</li><li>Notify the next user(s) in the current on-duty shift ‚Üí Follow the Sun Support - Business Hours</li><li>Click <strong>Add Step</strong></li></ul><p><a href=#image-f6ffd96c115cc86c63b641eb12c92b58 class=lightbox-link><img src=../en/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-2.png alt="Pri Escalation Policy Step 2" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f6ffd96c115cc86c63b641eb12c92b58><img src=../en/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-2.png alt="Pri Escalation Policy Step 2" class=lightbox-image loading=lazy></a></p><ul><li>Step 3</li><li>If still unacked after 15 more minutes</li><li>Execute Policy ‚Üí [Your Team Name] : 24/7</li><li>Click <strong>Save</strong></li></ul><p><a href=#image-b7351de25e85d45488cdfba9db534258 class=lightbox-link><img src=../en/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-3.png alt="Pri Escalation Policy Step 3" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b7351de25e85d45488cdfba9db534258><img src=../en/oncall/getting_started/escalation/../../images/pri-escalation-policy-step-3.png alt="Pri Escalation Policy Step 3" class=lightbox-image loading=lazy></a></p><h2 id=3-waiting-room-policy>3. Waiting Room Policy</h2><p>Click <strong>Add Escalation Policy</strong></p><ul><li>Policy Name: Waiting Room</li><li>Step 1</li><li>If still unacked after 10 more minutes</li><li>Execute Policy ‚Üí [Your Team Name] : Primary</li><li>Click <strong>Save</strong></li></ul><p><a href=#image-c7c169a15aab35a72da5d5662d39c56f class=lightbox-link><img src=../en/oncall/getting_started/escalation/../../images/wr-escalation-policy.png alt="WR Escalation Policy" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c7c169a15aab35a72da5d5662d39c56f><img src=../en/oncall/getting_started/escalation/../../images/wr-escalation-policy.png alt="WR Escalation Policy" class=lightbox-image loading=lazy></a></p><p>You should now have the following three escalation polices:</p><p><a href=#image-4bd87c755e5bb43522374540a6739da9 class=lightbox-link><img src=../en/oncall/getting_started/escalation/../../images/escalation-policies.png alt="Escalation Policies" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4bd87c755e5bb43522374540a6739da9><img src=../en/oncall/getting_started/escalation/../../images/escalation-policies.png alt="Escalation Policies" class=lightbox-image loading=lazy></a></p><p>You may have noticed that when we created each policy there was the following warning message:</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>There are no routing keys for this policy - it will only receive incidents via manual reroute or when on another escalation policy</p></div></div><p>This is because there are no Routing Keys linked to these Escalation Polices, so now that we have these polices configured we can create the Routing Keys and link them to our Polices..</p><hr><p>Continue and also complete the <a href=../en/oncall/getting_started/escalation/../routing/>Creating Routing Keys</a> module.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=creating-routing-keys>Creating Routing Keys</h1><h2 id=aim>Aim</h2><p>Routing Keys map the incoming alert messages from your monitoring system to an Escalation Policy which in turn sends the notifications to the appropriate team.</p><p>Note that routing keys are case insensitive and should only be composed of letters, numbers, hyphens, and underscores.</p><p>The aim of this module is for you to create some routing keys and then link them to your Escalation Policies you have created in the previous exercise.</p><hr><h2 id=1-instance-id>1. Instance ID</h2><p>Each participant requires a unique Routing Key so we use the Hostname of the EC2 Instance you were allocated. We are only doing this to ensure your Routing Key is unique and we know all Hostnames are unique. In a production deployment the Routing Key would typically reflect the name of a System or Service being monitored, or a Team such as 1st Line Support etc.</p><p>Your welcome e-mail informed you of the details of your EC2 Instance that has been provided for you to use during this workshop and you should have logged into this as part of the 1st exercise.</p><p>The e-mail also contained the Hostname of the Instance, but you can also obtain it from the Instance directly. To get your Hostname from within the shell session connected to your Instance run the following command:</p><div class=tab-panel data-tab-group=64722dca0726d9e7e9b16b5387a033e7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export Hostname" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("64722dca0726d9e7e9b16b5387a033e7","Export Hostname")'><div><div class=tab-nav-hidden>Export Hostname</div><div class=tab-nav-text>Export Hostname</div></div></button>
<button data-tab-item="Example Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("64722dca0726d9e7e9b16b5387a033e7","Example Output")'><div><div class=tab-nav-hidden>Example Output</div><div class=tab-nav-text>Example Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Export Hostname" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=si>${</span><span class=nv>HOSTNAME</span><span class=si>}</span></span></span></code></pre></div></div></div><div data-tab-item="Example Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>zevn</span></span></code></pre></div></div></div></div></div><p>It is very important that when creating the Routing Keys you use the 4 letter hostname allocated to you as a Detector has been configured within Splunk Infrastructure Monitoring using this hostname, so any deviation will cause future exercises to fail.</p><h2 id=2-create-routing-keys>2 Create Routing Keys</h2><p>Navigate to <strong>Settings</strong> on the main menu bar, you should now be at the <strong>Routing Keys</strong> page.</p><p>You are going to create the following two Routing Keys using the naming conventions listed in the following table, but replacing {==HOSTNAME==} with the value from above and replace <strong><code>TEAM_NAME</code></strong> with the team you were allocated or created earlier.</p><table><thead><tr><th>Routing Key</th><th>Escalation Policies</th></tr></thead><tbody><tr><td><strong><code>HOSTNAME</code></strong>_PRI</td><td><strong><code>TEAM_NAME</code></strong> : Primary</td></tr><tr><td><strong><code>HOSTNAME</code></strong>_WR</td><td><strong><code>TEAM_NAME</code></strong> : Waiting Room</td></tr></tbody></table><p>There will probably already be a number of Routing Keys configured, but to add a new one simply scroll to the bottom of the page and then click <strong>Add Key</strong></p><p>In the left hand box, enter the name for the key as per the table above. In the <strong>Routing Key</strong> column, select your Teams <strong>Primary</strong> policy from the drop down in the <strong>Escalation Polices</strong> column. You can start typing your Team Name to filter the results.</p><p><a href=#image-067f737380763836b36f347bdd9be801 class=lightbox-link><img src=../en/oncall/getting_started/routing/../../images/routing-key-add.png alt="Add Routing Key" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-067f737380763836b36f347bdd9be801><img src=../en/oncall/getting_started/routing/../../images/routing-key-add.png alt="Add Routing Key" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>If there are a large number of participants on the workshop, resulting in an unusually large number of Escalation Policies sometimes the search filter does not list all the Policies under your Team Name. If this happens instead of using the search feature, simply scroll down to your team name, all the policies will then be listed.</p></div></div><p>Repeat the above steps for both Keys, <strong><code>xxxx_PRI</code></strong> and <strong><code>xxxx_WR</code></strong>, mapping them to your Teams Primary and Waiting Room policies.</p><p>You should now have two Routing Keys configured, similar to the following:</p><p><a href=#image-8b790db9767cf8c376325fcb8a4b2413 class=lightbox-link><img src=../en/oncall/getting_started/routing/../../images/routing-keys.png alt="Routing Keys" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8b790db9767cf8c376325fcb8a4b2413><img src=../en/oncall/getting_started/routing/../../images/routing-keys.png alt="Routing Keys" class=lightbox-image loading=lazy></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Tip</div><div class=box-content><p>You can assign a Routing Key to multiple Escalation Policies if required by simply selecting more from the list</p></div></div><p>If you now navigate back to <strong>Teams ‚Üí [Your Team Name] ‚Üí Escalation Policies</strong> and look at the settings for your <strong>Primary</strong> and <strong>Waiting Room</strong> polices you will see that these now have <strong>Routes</strong> assigned to them.</p><p><a href=#image-b750c8b15f8ee3cf78deec253b5ef660 class=lightbox-link><img src=../en/oncall/getting_started/routing/../../images/routing-keys-assigned.png alt="Routing Keys Assigned" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b750c8b15f8ee3cf78deec253b5ef660><img src=../en/oncall/getting_started/routing/../../images/routing-keys-assigned.png alt="Routing Keys Assigned" class=lightbox-image loading=lazy></a></p><p>The <strong>24/7</strong> policy does not have a Route assigned as this will only be triggered via an <strong>Execute Policy</strong> escalation from the <strong>Primary</strong> policy.</p><hr><p>Please wait for the instructor before proceeding to the Incident Lifecycle/Overview module.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=incident-lifecycle>Incident Lifecycle</h1><h2 id=aim>Aim</h2><p>The aim of this module is for you to get more familiar with the Timeline Tab and the filtering features.</p><h2 id=1-timeline>1. Timeline</h2><p>The aim of Splunk On-Call is to make being on call more bearable, and it does this by getting the critical data, to the right people, at the right time.</p><p>The key to making it work for you is to centralize all your alerting sources, sending them all to the Splunk On-Call platform, then you have a single pane of glass in which to manage all of your alerting.</p><p>Login to the Splunk On-Call UI and select the <strong>Timeline</strong> tab on the main menu bar, you should have a screen similar to the following image:</p><p><a href=#image-835e0dd5395ccfadc741d169e2261964 class=lightbox-link><img src=../en/oncall/incident_lifecycle/../images/m7-vo-ui.png alt="Splunk On-Call UI" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-835e0dd5395ccfadc741d169e2261964><img src=../en/oncall/incident_lifecycle/../images/m7-vo-ui.png alt="Splunk On-Call UI" class=lightbox-image loading=lazy></a></p><h2 id=2-people>2. People</h2><p>On the left we have the <strong>People</strong> section with the <strong>Teams</strong> and <strong>Users</strong> sub tabs. On the <strong>Teams</strong> tab, click on <strong>All Teams</strong> then expand <em><strong>[Your Teamname]</strong></em>.</p><p>Users with the Splunk On-Call Logo against their name are currently on call. Here you can see who is on call within a particular Team, or across all Teams via <strong>Users ‚Üí On-Call</strong>.</p><p>If you click into one of the currently on call users, you can see their status. It shows which Rotation they are on call for, when their current Shift ends and their next Shift starts (times are displayed in your timezone), what contact methods they have and which Teams they belong to (dummy users such as Hank do not have Contact Methods configured).</p><p><a href=#image-2203b638430aed2e653b8691a7c47099 class=lightbox-link><img src=../en/oncall/incident_lifecycle/../images/m7-user-detail.png alt="User Detail" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2203b638430aed2e653b8691a7c47099><img src=../en/oncall/incident_lifecycle/../images/m7-user-detail.png alt="User Detail" class=lightbox-image loading=lazy></a></p><h2 id=3-timeline>3. Timeline</h2><p>In the centre <strong>Timeline</strong> section you get a realtime view of what is happening within your environment with the newest messages at the top. Here you can quickly post update messages to make your colleagues aware of important developments etc.</p><p>You can filter the view using the buttons on the top toolbar showing only update messages, GitHub integrations, or apply more advanced filters.</p><p>Lets change the Filters settings to streamline your view. Click the <strong>Filters</strong> button then within the <strong>Routing Keys</strong> tab change the <strong>Show</strong> setting from <strong>all routing keys</strong> to <strong>selected routing keys</strong>. Change the <strong>My Keys</strong> value to <strong>all</strong> and the <strong>Other Keys</strong> value to <strong>selected</strong> and deselect all keys under the Other Keys section.</p><p>Click anywhere outside of the dialogue box to close it.</p><p><a href=#image-08c2b1fb557cd9ac1ab491535de7df33 class=lightbox-link><img src=../en/oncall/incident_lifecycle/../images/m7-timeline-filters.png alt="Timeline Filters" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-08c2b1fb557cd9ac1ab491535de7df33><img src=../en/oncall/incident_lifecycle/../images/m7-timeline-filters.png alt="Timeline Filters" class=lightbox-image loading=lazy></a></p><p>You will probably now have a much simpler view as you will not currently have Incidents created using your Routing Keys, so you are left with the other types of messages that the Timeline can display.</p><p>Click on <strong>Filters</strong> again, but this time switch to the <strong>Message Types</strong> tab. Here you control the types of messages that are displayed.</p><p>For example, deselect <strong>On-call Changes</strong> and <strong>Escalations</strong>, this will reduce the amount of messages displayed.</p><p><a href=#image-fbfbf9fcd08ce135c2738ddd35d97f6b class=lightbox-link><img src=../en/oncall/incident_lifecycle/../images/m7-timeline-filters-message-types.png alt="Timeline Filters Message Types" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-fbfbf9fcd08ce135c2738ddd35d97f6b><img src=../en/oncall/incident_lifecycle/../images/m7-timeline-filters-message-types.png alt="Timeline Filters Message Types" class=lightbox-image loading=lazy></a></p><h2 id=4-incidents>4. Incidents</h2><p>On the right we have the <strong>Incidents</strong> section. Here we get a list of all the incidents within the platform, or we can view a more specific list such as incidents you are specifically assigned to, or for any of the Teams you are a member of.</p><p>Select the <strong>Team Incidents</strong> tab you should find that the <strong>Triggered</strong>, <strong>Acknowledged</strong> & <strong>Resolved</strong> tabs are currently all empty as you have had no incidents logged.</p><p>Let&rsquo;s change that by generating your first incident!</p><p>Continue with the <a href=../en/oncall/incident_lifecycle/../create_incidents/>Create Incidents</a> module.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Incident Lifecycle</h1><article class=default><header class=headline></header><h1 id=create-incidents>Create Incidents</h1><h2 id=aim>Aim</h2><p>The aim of this module is for you to place yourself &lsquo;On-Call&rsquo; then generate an Incident using the supplied EC2 Instance so you can then work through the lifecycle of an Incident.</p><hr><h2 id=1-on-call>1. On-Call</h2><p>Before generating any incidents you should assign yourself to the current Shift within your <strong>Follow the Sun Support - Business Hours</strong> Rotation and also place yourself <strong>On-Call</strong>.</p><ul><li>Click on the <strong>Schedule</strong> link within your <strong>Team</strong> in the <strong>People</strong> section on the left, or navigate to <strong>Teams ‚Üí [Your Team] ‚Üí Rotations</strong></li><li>Expand the <strong>Follow the Sun Support - Business Hours</strong> Rotation</li><li>Click on the <strong>Manage members</strong> icon (the figures) for the current active shift depending on your timezone
<a href=#image-a7fc198b0277ce4cb2d4942ab51fccd2 class=lightbox-link><img src=../en/oncall/incident_lifecycle/create_incidents/../../images/manage-members.png alt="Manage Members" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a7fc198b0277ce4cb2d4942ab51fccd2><img src=../en/oncall/incident_lifecycle/create_incidents/../../images/manage-members.png alt="Manage Members" class=lightbox-image loading=lazy></a></li><li>Use the <strong>Select a user to add&mldr;</strong> dropdown to add yourself to the shift</li><li>Then click on <strong>Set Current</strong> next to your name to make yourself the current <strong>on-call</strong> user within the shift</li><li>You should now get a <strong>Push Notification</strong> to your phone informing you that <strong>You Are Now On-Call</strong>
<a href=#image-3b9f6c5e1afdf891ebb36619a1722238 class=lightbox-link><img src=../en/oncall/incident_lifecycle/create_incidents/../../images/on-duty.png alt="On Duty" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-3b9f6c5e1afdf891ebb36619a1722238><img src=../en/oncall/incident_lifecycle/create_incidents/../../images/on-duty.png alt="On Duty" class=lightbox-image loading=lazy></a></li></ul><h2 id=2-trigger-alert>2. Trigger Alert</h2><p>Switch back to your shell session connected to your EC2 Instance; all of the following commands will be executed from your Instance.</p><p>Force the CPU to spike to 100% by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>openssl speed -multi $(grep -ci processor /proc/cpuinfo)</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Forked child 0
</span></span><span class=line><span class=cl>+DT:md4:3:16
</span></span><span class=line><span class=cl>+R:19357020:md4:3.000000
</span></span><span class=line><span class=cl>+DT:md4:3:64
</span></span><span class=line><span class=cl>+R:14706608:md4:3.010000
</span></span><span class=line><span class=cl>+DT:md4:3:256
</span></span><span class=line><span class=cl>+R:8262960:md4:3.000000
</span></span><span class=line><span class=cl>+DT:md4:3:1024</span></span></code></pre></div><p>This will result in an Alert being generated by Splunk Infrastructure Monitoring which in turn will generate an Incident within Splunk On-Call within a maximum of 10 seconds. This is the default polling time for the OpenTelemetry Collector installed on your instance (note it can be reduced to 1 second).</p><hr><p>Continue with the <a href=../en/oncall/incident_lifecycle/create_incidents/../manage_incidents/>Manage Incidents</a> module.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=manage-incidents>Manage Incidents</h1><h2 id=1-acknowledge>1. Acknowledge</h2><p>Use your Splunk On-Call App on your phone to acknowledge the Incident by clicking on the <strong>push notification</strong> &mldr;</p><p><a href=#image-c17fcaca3be7d0000ca39db1f40855f5 class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/mobile-notification.png alt="Push Notification" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c17fcaca3be7d0000ca39db1f40855f5><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/mobile-notification.png alt="Push Notification" class=lightbox-image loading=lazy></a></p><p>&mldr;to open the alert in the Splunk On-Call mobile app, then clicking on either the <strong>single tick</strong> in the top right hand corner, or the <strong>Acknowledge</strong> link to acknowledge the incident and stop the escalation process.</p><p>The :fontawesome-solid-check: will then transform into a :fontawesome-solid-check::fontawesome-solid-check:, and the status will change from <strong>TRIGGERED</strong> to <strong>ACKNOWLEDGED</strong>.</p><table><thead><tr><th>Triggered Incident</th><th>Acknowledge Incident</th></tr></thead><tbody><tr><td><a href=#image-8c40e0a56308c3a3d19f6d777d4ded48 class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/phone-annotations.png alt="Acknowledge Alert" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8c40e0a56308c3a3d19f6d777d4ded48><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/phone-annotations.png alt="Acknowledge Alert" class=lightbox-image loading=lazy></a></td><td><a href=#image-b9436d319653c294d10e7004a28b4218 class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/phone-alert-acknowledged.png alt="Alert Acknowledged" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b9436d319653c294d10e7004a28b4218><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/phone-alert-acknowledged.png alt="Alert Acknowledged" class=lightbox-image loading=lazy></a></td></tr></tbody></table><h2 id=2-details-and-annotations>2. Details and Annotations</h2><p>Still on your phone, select the Alert Details tab. Then on the Web UI, navigate back to <strong>Timeline</strong>, select <strong>Team Incidents</strong> on the right, then select <strong>Acknowledged</strong> and click into the new <strong>Incident</strong>, this will open up the War Room Dashboard view of the Incident.</p><p>You should now have the <strong>Details</strong> tab displayed on both your Phone and the Web UI. Notice how they both show the exact same information.</p><p>Now select the <strong>Annotations</strong> tab on both the Phone and the Web UI, you should have a <strong>Graph</strong> displayed in the UI which is generated by Splunk Infrastructure Monitoring.</p><p><a href=#image-7d934ecd138e4e7c009585c923ba7abf class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/ui-annotations.png alt="UI Annotations" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7d934ecd138e4e7c009585c923ba7abf><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/ui-annotations.png alt="UI Annotations" class=lightbox-image loading=lazy></a></p><p>On your phone you should get the same image displayed (sometimes it&rsquo;s a simple hyperlink depending on the image size)</p><p><a href=#image-cd67e01e2726f31c517f264423e7df91 class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/phone-annotations.png alt="Phone Link" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-cd67e01e2726f31c517f264423e7df91><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/phone-annotations.png alt="Phone Link" class=lightbox-image loading=lazy></a></p><p>Splunk On-Call is a &lsquo;Mobile First&rsquo; platform meaning the phone app is full functionality and you can manage an incident directly from your phone.</p><p>For the remainder of this module we will focus on the Web UI however please spend some time later exploring the phone app features.</p><h2 id=3-link-to-alerting-system>3. Link to Alerting System</h2><p>Sticking with the Web UI, click the <strong>2. Alert Details in SignalFx</strong> link.</p><p><a href=#image-113efb956bc8ff0d44d20ec09435a02a class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/alert-details-in-sfx.png alt="Alert Details" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-113efb956bc8ff0d44d20ec09435a02a><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/alert-details-in-sfx.png alt="Alert Details" class=lightbox-image loading=lazy></a></p><p>This will open a new browser tab and take you directly to the Alert within Splunk Infrastructure Monitoring where you could then progress your troubleshooting using the powerful tools built into its UI.</p><p><a href=#image-53c704fceafe1a5cbb20061686f71e4a class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/sfx-alert-details.png alt="SFX Alert Details" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-53c704fceafe1a5cbb20061686f71e4a><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/sfx-alert-details.png alt="SFX Alert Details" class=lightbox-image loading=lazy></a></p><p>However, we are focussing on Splunk On-Call so close this tab and return to the Splunk On-Call UI.</p><h2 id=4-similar-incidents>4. Similar Incidents</h2><p>What if Splunk On-Call could identify previous incidents within the system which may give you a clue to the best way to tackle this incident.</p><p>The <strong>Similar Incidents</strong> tab does exactly that, surfacing previous incidents allowing you to look at them and see what actions were taken to resolve them, actions which could be easily repeated for this incident.</p><p><a href=#image-25d05f911eb229b2853b42800ad7a8dc class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/similar-incidents.png alt="Similar Incidents" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-25d05f911eb229b2853b42800ad7a8dc><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/similar-incidents.png alt="Similar Incidents" class=lightbox-image loading=lazy></a></p><h2 id=5-timeline>5 Timeline</h2><p>On right we have a Time Line view where you can add messages and see the history of previous alerts and interactions.</p><p><a href=#image-5d4865155035ed24c06f4a25ff411a2d class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/war-room-dashboard.png alt="Incident View" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5d4865155035ed24c06f4a25ff411a2d><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/war-room-dashboard.png alt="Incident View" class=lightbox-image loading=lazy></a></p><h2 id=6-add-responders>6 Add Responders</h2><p>On the far left you have the option of allocating additional resources to this incident by clicking on the <strong>Add Responders</strong> link.</p><p><a href=#image-65505714aa79d480b7a3918d1115f6bf class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/add-responders.png alt=add-responders style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-65505714aa79d480b7a3918d1115f6bf><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/add-responders.png alt=add-responders class=lightbox-image loading=lazy></a></p><p>This allows you build a virtual team specific to this incident by adding other Teams or individual Users, and also share details of a <strong>Conference Bridge</strong> where you can all get together and collaborate.</p><p><a href=#image-58ac80700cdf9c901fccf03322c82cbf class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/conference-bridge.png alt="Conference Bridge" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-58ac80700cdf9c901fccf03322c82cbf><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/conference-bridge.png alt="Conference Bridge" class=lightbox-image loading=lazy></a></p><p>Once the system has built up some incident data history, it will use Machine Learning to suggest Teams and Users who have historically worked on similar incidents, as they may be best placed to help resolve this incident quickly.</p><p>You can select different Teams and/or Users and also choose from a pre-configured conference bridge, or populate the details of a new bridge from your preferred provider.</p><p>We do not need to add any Responders in this exercise so close the <strong>Add Responders</strong> dialogue by clicking <strong>Cancel</strong>.</p><h2 id=7-reroute>7 Reroute</h2><p>If it&rsquo;s decided that maybe the incident could be better dealt with by a different Team, the call can be <strong>Rerouted</strong> by clicking the <strong>Reroute</strong> Button at the top of the left hand panel.</p><p><a href=#image-c197ef847ed5ef6142fac1a875869997 class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/reroute1.png alt=Reroute style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c197ef847ed5ef6142fac1a875869997><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/reroute1.png alt=Reroute class=lightbox-image loading=lazy></a></p><p>In a similar method to that used in the Add Responders dialogue, you can select Teams or Users to Reroute the Incident to.</p><p><a href=#image-f4d6ba2674073aded5e92bf0c4f44eaf class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/reroute2.png alt="Reroute Incident" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f4d6ba2674073aded5e92bf0c4f44eaf><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/reroute2.png alt="Reroute Incident" class=lightbox-image loading=lazy></a></p><p>We do not need to actually Reroute in this exercise so close the <strong>Reroute Incident</strong> dialogue by clicking <strong>Cancel</strong>.</p><h2 id=8-snooze>8 Snooze</h2><p>You can also <strong>snooze</strong> this incident by clicking on the <strong>alarm clock</strong> Button at the top of the left hand panel.</p><p><a href=#image-6e38978e091655928e5a3bf990901bd1 class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/snooze1.png alt=Snnoze style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6e38978e091655928e5a3bf990901bd1><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/snooze1.png alt=Snnoze class=lightbox-image loading=lazy></a></p><p>You can enter an amount of time upto 24 hours to snooze the incident. This action will be tracked in the Timeline, and when the time expires the paging will restart.</p><p>This is useful for low priority incidents, enabling you to put them on a back burner for a few hours, but it ensures they do not get forgotten thanks to the paging process starting again.</p><p><a href=#image-851815469b8c1a41d542ddfbdc9b6672 class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/snooze2.png alt="Snooze Incident" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-851815469b8c1a41d542ddfbdc9b6672><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/snooze2.png alt="Snooze Incident" class=lightbox-image loading=lazy></a></p><p>We do not need to actually Snooze in this exercise so close the <strong>Snooze Incident</strong> dialogue by clicking <strong>Cancel</strong>.</p><h2 id=9-action-tracking>9 Action Tracking</h2><p>Now lets fix this issue and update the Incident with what we did. Add a new message at the top of the right hand panel such as <strong>Discovered rogue process, terminated it</strong>.</p><p><a href=#image-9d431c15d366771975155ca036324c64 class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/time-line-update-message.png alt="Add Message" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9d431c15d366771975155ca036324c64><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/time-line-update-message.png alt="Add Message" class=lightbox-image loading=lazy></a></p><p>All the actions related to the Incident will be recorded here, and can then be summarized is a <strong>Post Incident Review Report</strong> available from the <strong>Reports</strong> tab</p><h2 id=10-resolution>10 Resolution</h2><p>Now kill off the process we started in the VM to max out the CPU by switching back the Shell session for the VM and pressing <strong>ctrl+c</strong></p><p>Within no more than 10 seconds SignalFx should detect the new CPU value, clear the alert state in SignalFx, then automatically update the Incident in VictorOps marking it as <strong>Resolved</strong>.</p><p><a href=#image-b659346a2b520a6adc7a9955be44e94c class=lightbox-link><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/m7-resolved.png alt=Resolved style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b659346a2b520a6adc7a9955be44e94c><img src=../en/oncall/incident_lifecycle/manage_incidents/../../images/m7-resolved.png alt=Resolved class=lightbox-image loading=lazy></a></p><p>As we have two way integration between Splunk Infrastructure Monitoring and Splunk On-Call we could have also marked the incident as Resolved in Splunk On-Call, and this would have resulted in the alert in Splunk Infrastructure Monitoring being resolved as well.</p><hr><p>That completes this introduction to Splunk On-Call!</p><footer class=footline></footer></article></section></section><article class=home><header class=headline></header><h1 id=other-workshops>Other Workshops</h1><div class="children children-h3 children-sort-"><h3><a href=../en/other/pet-clinic/index.html>PetClinic Java Workshop</a></h3><p>A workshop using Zero Configuration Auto-Instrumentation for Java</p><h3><a href=../en/other/gdi/index.html>Getting Data In (GDI) with OTel and UF</a></h3><p>45 minutes During this technical workshop you will learn how to:
Efficiently deploy complex environments Capture metrics from these environments to Splunk Observability Cloud Auto-instrument a python application Enable OS logging to Splunk Enterprise via Universal Forwarder In order to simplify the workshop modules, a pre-configured AWS EC2 instance is provided.
By the end of this technical workshop you will have an approach to demonstrating metrics collection for complex environments and services.</p><h3><a href=../en/other/hpa/index.html>Monitoring Horizontal Pod Autoscaling in Kubernetes</a></h3><p>This workshop will equip you with the basic understanding of monitoring Kubernetes using the Splunk OpenTelemetry Collector</p><h3><a href=../en/other/lambda-kinesis/index.html>Build a Distributed Trace in Lambda and Kinesis</a></h3><p>This workshop will equip you with how a distributed trace is constructed for a small serverless application that runs on AWS Lambda, producing and consuming a message via AWS Kinesis</p><h3><a href=../en/other/dev-mttr-custom-tags/index.html>Improving MTTR with Custom Tags</a></h3><p>This workshop will equip you with...</p></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Other Workshops</h1><article class=default><header class=headline></header><h1 id=petclinic-java-workshop>PetClinic Java Workshop</h1><p>The goal is to walk through the basic steps to configure the following components of the Splunk Observability platform:</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Zero Configuration Auto Instrumentation for Java (APM)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Real User Monitoring (RUM)</li><li>RUM to APM Correlation</li><li>Splunk Log Observer</li></ul><p>We will also show the steps about how to clone (download) a sample Java application (Spring PetClinic), as well as how to compile, package and run the application.</p><p>Once the application is up and running, we will instantly start seeing metrics and traces via the Zero Configuration Auto Instrumentation for Java that will be used by the Splunk APM product.</p><p>After that, we will instrument the PetClinic&rsquo;s end user interface (HTML pages rendered by the application) with the Splunk OpenTelemetry Javascript Libraries (RUM) that will generate RUM traces around all the individual clicks and page loads executed by an end user.</p><p>Lastly, we will configure the Spring PetClinic application to write application logs to the filesystem and also configure the Splunk OpenTelemetry Collector to read (tail) the logs and send to Splunk Cloud.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Prerequisites</div><div class=box-content><p>A Splunk run workshop where an host/instance is provided <strong>OR</strong> a self led workshop on own host / <a href=https://github.com/splunk/observability-workshop/tree/main/multipass target=_blank>multipass instance</a></p><p>For your own system you will need the following installed and enabled:</p><ol><li>JDK 17 installed</li><li>Maven</li><li>Port <code>8080</code> open inbound/outbound</li></ol></div></div><p><a href=#image-2342cd41b6d12d47edb11687e21ac3e9 class=lightbox-link><img src=../en/other/pet-clinic/images/petclinic-exercise.png alt="PetClinic Exercise" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2342cd41b6d12d47edb11687e21ac3e9><img src=../en/other/pet-clinic/images/petclinic-exercise.png alt="PetClinic Exercise" class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of PetClinic Java Workshop</h1><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><h2 id=1-introduction>1. Introduction</h2><p>The OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:</p><ul><li>Infrastructure metrics (disk, cpu, memory, etc)</li><li>Application Performance Monitoring (APM) traces</li><li>Profiling data</li><li>Host and application logs</li></ul><p>Splunk Observability Cloud offers a wizard to walk you through the setup of the Collector on both your infrastructure and applications. By default, the wizard will only provide the commands to only install the collector.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Delete any existing OpenTelemetry Collectors</div><div class=box-content><p>If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></div><h2 id=2-confirm-environment-variables>2. Confirm environment variables</h2><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>env</span></span></code></pre></div><p>In the output check the following environment variables are present and have values set:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL</span></span></code></pre></div><p>For the purposes of this workshop <strong>all</strong> of the above are required. If any are missing, please contact your instructor.</p><h2 id=3-install-the-opentelemetry-collector>3. Install the OpenTelemetry Collector</h2><p>We can then go ahead and install the Collector. There are some additional parameters that are passed to the install script, they are:</p><ul><li><code>--with-instrumentation</code> - This will install the agent from the Splunk distribution of OpenTelemetry Java, which is then loaded automatically when the PetClinic Java application starts up. No configuration required!</li><li><code>--deployment-environment</code> - Sets the resource attribute <code>deployment.environment</code> to the value passed. This is used to filter views in the UI.</li><li><code>--enable-profiler</code> - Enables the profiler for the Java application. This will generate CPU profiles for the application.</li><li><code>--enable-profiler-memory</code> - Enables the profiler for the Java application. This will generate memory profiles for the application.</li><li><code>--enable-metrics</code> - Enables the exporting of Micrometer metrics</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --with-instrumentation --deployment-environment <span class=nv>$INSTANCE</span>-petclinic --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span> --hec-token <span class=nv>$HEC_TOKEN</span> --hec-url <span class=nv>$HEC_URL</span> --enable-profiler --enable-profiler-memory --enable-metrics --mode agent --without-fluentd</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> AWS/EC2 instances</div><div class=box-content><p>If you are attempting this workshop on an AWS/EC2 instance you will have to patch the collector to expose the hostname of the instance:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Once the <code>agent_config.yaml</code> has been patched, you will need to restart the collector:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div></div></div><p>Once the install is completed, you can navigate to the <strong>Hosts with agent installed</strong> dashboard to see the data from your host, <strong>Dashboards ‚Üí Hosts with agent installed</strong>.</p><p>Use the dashboard filter and select <code>host.name</code> and type or select the hostname of your virtual machine. Once you see data flowing for your host, we are then ready to get started with the APM component.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=zero-configuration-auto-instrumentation-for-java>Zero Configuration Auto Instrumentation for Java</h1><h2 id=1-spring-petclinic-application>1. Spring PetClinic Application</h2><p>First thing we need to setup APM is&mldr; well, an application. For this exercise, we will use the Spring PetClinic application. This is a very popular sample java application built with Spring framework (Springboot).</p><p>First clone the PetClinic GitHub repository, then we will compile, build, package and test the application:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/spring-projects/spring-petclinic</span></span></code></pre></div><p>Change into the <code>spring-petclinic</code> directory (and checkout a specific commit):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> spring-petclinic <span class=o>&amp;&amp;</span> git checkout 276880e</span></span></code></pre></div><p>Start a MySQL database for PetClinic to use:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -e <span class=nv>MYSQL_USER</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>petclinic -p 3306:3306 docker.io/mysql:5.7.8</span></span></code></pre></div><p>Next we will start a Docker container running Locust that will generate some simple traffic to the PetClinic application. Locust is a simple load testing tool that can be used to generate traffic to a web application.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --network<span class=o>=</span><span class=s2>&#34;host&#34;</span> -d -p 8090:8090 -v /home/ubuntu/workshop/petclinic:/mnt/locust docker.io/locustio/locust -f /mnt/locust/locustfile.py --headless -u <span class=m>1</span> -r <span class=m>1</span> -H http://127.0.0.1:8080</span></span></code></pre></div><p>Next, run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>This will take a few minutes the first time you run, <code>maven</code> will download a lot of dependencies before it actually compiles the application. Future executions will be a lot quicker.</p></div></div><p>Once the compilation is complete, you can run the application with the following command. Notice that we are passing the <code>mysql</code> profile to the application, this will tell the application to use the MySQL database we started earlier. We are also setting the <code>otel.service.name</code> to a logical service name that will also be used in the UI for filtering:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>You can validate if the application is running by visiting <code>http://&lt;VM_IP_ADDRESS>:8080</code>.</p><h2 id=2-alwayson-profiling-and-metrics>2. AlwaysOn Profiling and Metrics</h2><p>When we installed the collector we configured it to enable AlwaysOn Profiling and Metrics. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you start the PetClinic application you will see the collector automatically detect the application and instrument it for traces and profiling.</p><div class=tab-panel data-tab-group=01662376c75558a75ce8649d94ceb8b7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Example output" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("01662376c75558a75ce8649d94ceb8b7","Example output")'><div><div class=tab-nav-hidden>Example output</div><div class=tab-nav-text>Example output</div></div></button></div><div class=tab-content-container><div data-tab-item="Example output" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/lib/splunk-instrumentation/splunk-otel-javaagent.jar -Dsplunk.profiler.enabled=true -Dsplunk.profiler.memory.enabled=true
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:04:661 +0100] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.25.0-otel-1.27.0
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:05:294 +0100] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:043 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:044 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:047 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:048 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:049 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:050 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:051 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:053 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:054 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:055 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:056 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:057 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT10S
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:058 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:059 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:059 +0100] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2023-06-26 13:32:07:060 +0100] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><h2 id=3-configure-profiling-data-collection>3. Configure Profiling Data Collection</h2><p>We need to edit the collector configuration file <code>/etc/otel/collector/agent_config.yaml</code> and add a new exporter to send the profiling data to Splunk Observability Cloud:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>splunk_hec/profiling</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;${SPLUNK_ACCESS_TOKEN}&#34;</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;${SPLUNK_INGEST_URL}/v1/log&#34;</span></span></span></code></pre></div><p>We, also, then need to create a new pipeline called <code>logs/profiling</code> under the <code>service:</code> section:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>logs/profiling</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>splunk_hec/profiling]</span></span></span></code></pre></div><p>Save the changes and exit the editor, then restart the collector:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p>You can now visit the Splunk APM UI and examine the application components, traces, profiling, DB Query performance and metrics. From the left hand menu <strong>APM ‚Üí Explore</strong>, click the environment dropdown and select your own environment (which is prefixed with your hostname of your instance).</p><p><a href=#image-8618f5a34cbb7566e8e0581620f5a8ed class=lightbox-link><img src=../en/other/pet-clinic/2-zero-configuration/../images/apm-environment.png alt="APM Environment" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8618f5a34cbb7566e8e0581620f5a8ed><img src=../en/other/pet-clinic/2-zero-configuration/../images/apm-environment.png alt="APM Environment" class=lightbox-image loading=lazy></a></p><p>Once your validation is complete you can stop the application by pressing <code>Ctrl-c</code>.</p><h2 id=4-adding-resource-attributes-to-spans>4. Adding Resource Attributes to Spans</h2><p>Resource attributes can be added to every reported span. For example <code>version=0.314</code>. A comma separated list of resource attributes can also be defined e.g. <code>key1=val1,key2=val2</code>.</p><p>Let&rsquo;s launch the PetClinic again using a new resource attribute. Note, that adding resource attributes to the run command will override what was defined when we installed the collector. Let&rsquo;s add a new resource attribute <code>version=0.314</code>:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span><span class=nv>version</span><span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Back in the Splunk APM UI we can drill down on a recent trace and see the new <code>version</code> attribute in a span.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=3-real-user-monitoring>3. Real User Monitoring</h1><h2 id=1-enable-rum>1. Enable RUM</h2><p>For the Real User Monitoring (RUM) instrumentation, we will add the Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web target=_blank>https://github.com/signalfx/splunk-otel-js-web</a> snippet in the pages, we will use the wizard again <strong>Data Management ‚Üí Add Integration ‚Üí RUM Instrumentation ‚Üí Browser Instrumentation</strong>.</p><p>Select the preconfigured <strong>RUM ACCESS TOKEN</strong> from the dropdown, click <strong>Next</strong>. Enter <strong>App name</strong> and <strong>Environment</strong> using the following syntax:</p><ul><li><code>[hostname]-petclinic-service</code> - replacing <code>[hostname]</code> with your actual hostname.</li><li><code>[hostname]-petclinic-env</code> - replacing <code>[hostname]</code> with your actual hostname.</li></ul><p>Then you&rsquo;ll need to select the workshop RUM token and define the application and environment names. The wizard will then show a snipped of HTML code that needs to be place at the top at the pages in the <code>&lt;head></code> section. In this example we are using:</p><ul><li>Application Name: <code>&lt;hostname>-petclinic-service</code></li><li>Environment: <code>&lt;hostname>-petclinic-env</code></li></ul><p>Copy the generated code snippet in the wizard or copy and edit the snippet below accordingly. You need to replace <code>&lt;REALM></code>, <code>&lt;RUM_ACCESS_TOKEN></code> and <code>&lt;hostname></code> with the actual values.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>beaconUrl</span><span class=o>:</span> <span class=s2>&#34;https://rum-ingest.&lt;REALM&gt;.signalfx.com/v1/rum&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>rumAuth</span><span class=o>:</span> <span class=s2>&#34;&lt;RUM_ACCESS_TOKEN&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>app</span><span class=o>:</span> <span class=s2>&#34;&lt;hostname&gt;-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>environment</span><span class=o>:</span> <span class=s2>&#34;&lt;hostname&gt;-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>The Spring PetClinic application uses a single HTML page as the &ldquo;layout&rdquo; page, that is reused across all pages of the application. This is the perfect location to insert the Splunk RUM Instrumentation Library as it will be loaded in all pages automatically.</p><p>Let&rsquo;s then edit the layout page:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi src/main/resources/templates/fragments/layout.html</span></span></code></pre></div><p>Next, insert the snippet we generated above in the <code>&lt;head></code> section of the page. Now we need to rebuild the application and run it again:</p><h2 id=2-rebuild-petclinic>2. Rebuild PetClinic</h2><p>Run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span><span class=nv>version</span><span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Then let&rsquo;s visit the application using a browser to generate real-user traffic <code>http://&lt;VM_IP_ADDRESS>:8080</code>, now we should see RUM traces being reported.</p><p>Let&rsquo;s visit RUM and see some of the traces and metrics <strong>Hamburger Menu ‚Üí RUM</strong> and you will see some of the Spring PetClinic URLs showing up in the UI.</p><p>When you drill down into a RUM trace you will see a link to APM in the spans. Clicking on the trace ID will take you to the corresponding APM trace for the current RUM trace.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=4-log-observer>4. Log Observer</h1><h2 id=1-introduction>1. Introduction</h2><p>For the Splunk Log Observer component, we will configure the Spring PetClinic application to write logs to a file in the filesystem and configure the Splunk OpenTelemetry Collect to read (tail) that log file and report the information to the Splunk Observability Platform.</p><h2 id=2-opentelemetry-filelog-configuration>2. OpenTelemetry Filelog Configuration</h2><p>We need to configure the Splunk OpenTelemetry Collector to tail the Spring PetClinic log file and report the data to the Splunk Cloud HEC URL.</p><p>The Splunk OpenTelemetry Collector uses the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/filelogreceiver/README.md target=_blank>Filelog Receiver</a> to consume logs. We will need to edit the collectors configuration file:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Under <code>receivers:</code> create the Filelog Receiver (make sure to indent correctly):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>  </span><span class=nt>filelog</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>/home/ubuntu/spring-petclinic.log]</span></span></span></code></pre></div><p>The under the <code>service:</code> section, find the <code>logs:</code> pipeline, replace <code>fluentforward</code> with<code>filelog</code> and remove <code>otlp</code>(again, make sure to indent correctly):</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>filelog]</span></span></span></code></pre></div><p>Save the file and exit the editor. Next, we need to validate the HEC Token and HEC URL are configured for the collector to use. We will inspect the <code>/etc/otel/collector/splunk-otel-collector.conf</code> file:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo cat /etc/otel/collector/splunk-otel-collector.conf</span></span></code></pre></div><p>Make sure <code>SPLUNK_HEC_URL</code> and <code>SPLUNK_HEC_TOKEN</code> have values set, we can then restart the collector to apply the changes:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><h2 id=3-logback-settings>3. Logback Settings</h2><p>The Spring PetClinic application can be configured to use a number of different java logging libraries. In this scenario, we are going to use logback. We just need to create a file named <code>logback.xml</code> in the configuration folder:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi ~/spring-petclinic/src/main/resources/logback.xml</span></span></code></pre></div><p>Copy and paste the following XML content:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE xml&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration</span> <span class=na>scan=</span><span class=s>&#34;true&#34;</span> <span class=na>scanPeriod=</span><span class=s>&#34;30 seconds&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;contextListener</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.classic.jul.LevelChangePropagator&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;resetJUL&gt;</span>true<span class=nt>&lt;/resetJUL&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/contextListener&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;logger</span> <span class=na>name=</span><span class=s>&#34;org.springframework.samples.petclinic&#34;</span> <span class=na>level=</span><span class=s>&#34;info&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;appender</span> <span class=na>name=</span><span class=s>&#34;file&#34;</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;file&gt;</span>/home/ubuntu/spring-petclinic.log<span class=nt>&lt;/file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;rollingPolicy</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;fileNamePattern&gt;</span>springLogFile.%d{yyyy-MM-dd}.log<span class=nt>&lt;/fileNamePattern&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;maxHistory&gt;</span>5<span class=nt>&lt;/maxHistory&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;totalSizeCap&gt;</span>1GB<span class=nt>&lt;/totalSizeCap&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/rollingPolicy&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;encoder&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;pattern&gt;</span>
</span></span><span class=line><span class=cl>        %d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg trace_id=%X{trace_id} span_id=%X{span_id} trace_flags=%X{trace_flags} %n service.name=%property{otel.resource.service.name}, deployment.environment=%property{otel.resource.deployment.environment}: %m%n
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/encoder&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/appender&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;root</span> <span class=na>level=</span><span class=s>&#34;info&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&#34;file&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/root&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span></span></span></code></pre></div><p>Now we need to rebuild the application and run it again:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><p>Once the rebuild has completed we can then run the application again:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span><span class=nv>version</span><span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><h2 id=4-view-logs>4. View Logs</h2><p>From the left hand menu click on <strong>Log Observer</strong>. Click on <strong>Index</strong> and select <strong>o11y-workshop-XXX.splunkcloud.com</strong> (where <strong>XXX</strong> will be the realm you are running in). On the right hand side select <strong>petclinic-workshop</strong> and then click <strong>Apply</strong>. You should see log messages being reported.</p><p>Next click <strong>Add Filter</strong> and search for the field <code>service_name</code> and select the value <code>&lt;your host name>-petclinic-service</code> and click <code>=</code> (include). You should now see only the log messages from your PetClinic application.</p><p><a href=#image-26cfc5255695ba95f704ccadc345c195 class=lightbox-link><img src=../en/other/pet-clinic/4-log-observer-connect/../images/log-observer.png alt="Log Observer" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-26cfc5255695ba95f704ccadc345c195><img src=../en/other/pet-clinic/4-log-observer-connect/../images/log-observer.png alt="Log Observer" class=lightbox-image loading=lazy></a></p><h2 id=4-summary>4. Summary</h2><p>This the end of the exercise and we have certainly covered a lot of ground. At this point you should have metrics, traces (APM & RUM), logs, database query performance and code profiling being reported into Splunk Observability Cloud. <strong>Congratulations</strong>!</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=getting-data-in-gdi-with-otel-and-uf>Getting Data In (GDI) with OTel and UF</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
45 minutes</button></span><p>During this technical workshop you will learn how to:</p><ul><li>Efficiently deploy complex environments</li><li>Capture metrics from these environments to Splunk Observability Cloud</li><li>Auto-instrument a python application</li><li>Enable OS logging to Splunk Enterprise via Universal Forwarder</li></ul><p>In order to simplify the workshop modules, a pre-configured AWS EC2 instance is provided.</p><p>By the end of this technical workshop you will have an approach to demonstrating metrics collection for complex environments and services.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Getting Data In (GDI) with OTel and UF</h1><article class=default><header class=headline></header><h1 id=getting-started-with-o11y-gdi---real-time-enrichment-workshop>Getting Started with O11y GDI - Real Time Enrichment Workshop</h1><p>Please note to begin the following lab, you must have completed the prework:</p><ul><li>Obtain a Splunk Observability Cloud access key</li><li>Understand cli commands</li></ul><p>Follow these steps if using O11y Workshop EC2 instances</p><h2 id=1-verify-yelp-data-files-are-present>1. Verify yelp data files are present</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ll /var/appdata/yelp*</span></span></code></pre></div><h2 id=2-export-the-following-variables>2. Export the following variables</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span>&lt;your-access-token&gt;
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span>&lt;your-o11y-cloud-realm&gt;
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>clusterName</span><span class=o>=</span>&lt;your-k8s-cluster&gt;</span></span></code></pre></div><h2 id=3-clone-the-following-repo>3. Clone the following repo</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu 
</span></span><span class=line><span class=cl>git clone https://github.com/leungsteve/realtime_enrichment.git 
</span></span><span class=line><span class=cl><span class=nb>cd</span> realtime_enrichment/workshop 
</span></span><span class=line><span class=cl>python3 -m venv rtapp-workshop 
</span></span><span class=line><span class=cl><span class=nb>source</span> rtapp-workshop/bin/activate</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=deploy-complex-environments-and-capture-metrics>Deploy Complex Environments and Capture Metrics</h1><p><strong>Objective:</strong> Learn how to efficiently deploy complex infrastructure components such as Kafka and MongoDB to demonstrate metrics collection with Splunk O11y IM integrations</p><p><strong>Duration</strong>: 15 Minutes</p><h2 id=scenario>Scenario</h2><p>A prospect uses Kafka and MongoDB in their environment. Since there are integrations for these services, you‚Äôd like to demonstrate this to the prospect. What is a quick and efficient way to set up a live environment with these services and have metrics collected?</p><h3 id=1-where-can-i-find-helm-charts>1. Where can I find helm charts?</h3><ul><li>Google ‚Äúmyservice helm chart‚Äù</li><li><code>https://artifacthub.io/</code> (<strong>Note:</strong> Look for charts from trusted organizations, with high star count and frequent updates)</li></ul><h3 id=2-review-apache-kafka-packaged-by-bitnamihttpsgithubcombitnamichartstreemainbitnamikafkainstalling-the-chart>2. Review <a href=https://github.com/bitnami/charts/tree/main/bitnami/kafka/#installing-the-chart target=_blank>Apache Kafka packaged by Bitnami</a></h3><p>We will deploy the helm chart with these options enabled:</p><ul><li><code>replicaCount=3</code></li><li><code>metrics.jmx.enabled=true</code></li><li><code>metrics.kafka.enabled=true</code></li><li><code>deleteTopicEnable=true</code></li></ul><h3 id=3-review-mongodbr-packaged-by-bitnamihttpsgithubcombitnamichartstreemasterbitnamimongodbinstalling-the-chart>3. Review <a href=https://github.com/bitnami/charts/tree/master/bitnami/mongodb/#installing-the-chart target=_blank>MongoDB(R) packaged by Bitnami</a></h3><p>We will deploy the helm chart with these options enabled:</p><ul><li><code>version 12.1.31</code></li><li><code>metrics.enabled=true</code></li><li><code>global.namespaceOverride=default</code></li><li><code>auth.rootUser=root</code></li><li><code>auth.rootPassword=splunk</code></li><li><code>auth.enabled=false</code></li></ul><h3 id=4-install-kafka-and-mongodb-with-helm-charts>4. Install Kafka and MongoDB with helm charts</h3><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add bitnami https://charts.bitnami.com/bitnami</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install kafka --set <span class=nv>replicaCount</span><span class=o>=</span><span class=m>3</span> --set metrics.jmx.enabled<span class=o>=</span><span class=nb>true</span> --set metrics.kafka.enabled<span class=o>=</span><span class=nb>true</span>  --set <span class=nv>deleteTopicEnable</span><span class=o>=</span><span class=nb>true</span> bitnami/kafka</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install mongodb --set metrics.enabled<span class=o>=</span><span class=nb>true</span> bitnami/mongodb --set global.namespaceOverride<span class=o>=</span>default --set auth.rootUser<span class=o>=</span>root --set auth.rootPassword<span class=o>=</span>splunk --set auth.enabled<span class=o>=</span><span class=nb>false</span> --version 12.1.31</span></span></code></pre></div><p>Verify the helm chart installation</p><div class=tab-panel data-tab-group=7ecdebe8bba61466b1ead954191f8249><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="helm list" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("7ecdebe8bba61466b1ead954191f8249","helm list")'><div><div class=tab-nav-hidden>helm list</div><div class=tab-nav-text>helm list</div></div></button>
<button data-tab-item="helm list output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("7ecdebe8bba61466b1ead954191f8249","helm list output")'><div><div class=tab-nav-hidden>helm list output</div><div class=tab-nav-text>helm list output</div></div></button></div><div class=tab-content-container><div data-tab-item="helm list" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm list</span></span></code></pre></div></div></div><div data-tab-item="helm list output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME    NAMESPACE   REVISION    UPDATED                                 STATUS      CHART           APP VERSION
</span></span><span class=line><span class=cl>kafka   default     1           2022-11-14 11:21:36.328956822 -0800 PST deployed    kafka-19.1.3    3.3.1
</span></span><span class=line><span class=cl>mongodb default     1           2022-11-14 11:19:36.507690487 -0800 PST deployed    mongodb-12.1.31 5.0.10</span></span></code></pre></div></div></div></div></div><p>Verify the helm chart installation</p><div class=tab-panel data-tab-group=77c144f6559c182818ae0f83cede75cb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="kubectl get pods" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("77c144f6559c182818ae0f83cede75cb","kubectl get pods")'><div><div class=tab-nav-hidden>kubectl get pods</div><div class=tab-nav-text>kubectl get pods</div></div></button>
<button data-tab-item="kubectl get pods Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("77c144f6559c182818ae0f83cede75cb","kubectl get pods Output")'><div><div class=tab-nav-hidden>kubectl get pods Output</div><div class=tab-nav-text>kubectl get pods Output</div></div></button></div><div class=tab-content-container><div data-tab-item="kubectl get pods" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item="kubectl get pods Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                              READY   STATUS              RESTARTS   AGE
</span></span><span class=line><span class=cl>kafka-exporter-595778d7b4-99ztt   0/1     ContainerCreating   0          17s
</span></span><span class=line><span class=cl>mongodb-b7c968dbd-jxvsj           0/2     Pending             0          6s
</span></span><span class=line><span class=cl>kafka-1                           0/2     ContainerCreating   0          16s
</span></span><span class=line><span class=cl>kafka-2                           0/2     ContainerCreating   0          16s
</span></span><span class=line><span class=cl>kafka-zookeeper-0                 0/1     Pending             0          17s
</span></span><span class=line><span class=cl>kafka-0                           0/2     Pending             0          17s</span></span></code></pre></div></div></div></div></div><p>Use information for each Helm chart and Splunk O11y Data Setup to generate values.yaml for capturing metrics from Kafka and MongoDB.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p><code>values.yaml</code> for the different services will be passed to the Splunk Helm Chart at installation time. These will configure the OTEL collector to capture metrics from these services.</p></div></div><ul><li>References:<ul><li><a href=https://github.com/bitnami/charts/tree/master/bitnami/spark/#installing-the-chart target=_blank>Apache Kafka packaged by Bitnami</a></li><li><a href=https://docs.splunk.com/Observability/gdi/kafka/kafka.html target=_blank>Configure application receivers for databases ¬ª Apache Kafka</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/kafkametricsreceiver target=_blank>Kafkametricsreceiver</a></li></ul></li></ul><h4 id=41-example-kafkavaluesyaml>4.1 Example kafka.values.yaml</h4><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otelAgent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>smartagent/kafka</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;pod&#34; &amp;&amp; name matches &#34;kafka&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=c>#endpoint: &#39;`endpoint`:5555&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5555</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>clusterName</span><span class=p>:</span><span class=w> </span><span class=l>sl-kafka</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>otelK8sClusterReceiver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>k8sEventsEnabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kafkametrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>brokers</span><span class=p>:</span><span class=w> </span><span class=l>kafka:9092</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>protocol_version</span><span class=p>:</span><span class=w> </span><span class=m>2.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>brokers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>topics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>consumers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c>#- prometheus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>k8s_cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>kafkametrics</span></span></span></code></pre></div><h4 id=42-example-mongodbvaluesyaml>4.2 Example mongodb.values.yaml</h4><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otelAgent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>smartagent/mongodb</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;pod&#34; &amp;&amp; name matches &#34;mongo&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/mongodb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>mongodb.default.svc.cluster.local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>27017</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>databases</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;O11y&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;local&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;config&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>sendCollectionMetrics</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>sendCollectionTopMetrics</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div><h4 id=43-example-zookeepervaluesyaml>4.3 Example zookeeper.values.yaml</h4><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>otelAgent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>smartagent/zookeeper</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;pod&#34; &amp;&amp; name matches &#34;kafka-zookeeper&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=l>kafka-zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>2181</span></span></span></code></pre></div><h3 id=5-install-the-splunk-otel-helm-chart>5. Install the Splunk OTEL helm chart</h3><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu/realtime_enrichment/otel_yamls/ 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>helm repo update</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install --set <span class=nv>provider</span><span class=o>=</span><span class=s1>&#39; &#39;</span> --set <span class=nv>distro</span><span class=o>=</span><span class=s1>&#39; &#39;</span> --set splunkObservability.accessToken<span class=o>=</span><span class=nv>$ACCESS_TOKEN</span> --set <span class=nv>clusterName</span><span class=o>=</span><span class=nv>$clusterName</span> --set splunkObservability.realm<span class=o>=</span><span class=nv>$REALM</span> --set otelCollector.enabled<span class=o>=</span><span class=s1>&#39;false&#39;</span> --set splunkObservability.logsEnabled<span class=o>=</span><span class=s1>&#39;true&#39;</span> --set gateway.enabled<span class=o>=</span><span class=s1>&#39;false&#39;</span> --values kafka.values.yaml --values mongodb.values.yaml --values zookeeper.values.yaml --values alwayson.values.yaml --values k3slogs.yaml --generate-name splunk-otel-collector-chart/splunk-otel-collector</span></span></code></pre></div><h3 id=6-verify-installation>6. Verify installation</h3><p>Verify that the Kafka, MongoDB and Splunk OTEL Collector helm charts are installed, note that names may differ.</p><div class=tab-panel data-tab-group=3e556c3f3829140cda5708e991c9b0ac><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="helm list" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("3e556c3f3829140cda5708e991c9b0ac","helm list")'><div><div class=tab-nav-hidden>helm list</div><div class=tab-nav-text>helm list</div></div></button>
<button data-tab-item="helm list Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("3e556c3f3829140cda5708e991c9b0ac","helm list Output")'><div><div class=tab-nav-hidden>helm list Output</div><div class=tab-nav-text>helm list Output</div></div></button></div><div class=tab-content-container><div data-tab-item="helm list" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm list</span></span></code></pre></div></div></div><div data-tab-item="helm list Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                NAMESPACE   REVISION    UPDATED                                 STATUS      CHART                           APP VERSION
</span></span><span class=line><span class=cl>kafka                               default     1           2021-12-07 12:48:47.066421971 -0800 PST deployed    kafka-14.4.1                    2.8.1
</span></span><span class=line><span class=cl>mongodb                             default     1           2021-12-07 12:49:06.132771625 -0800 PST deployed    mongodb-10.29.2                 4.4.10
</span></span><span class=line><span class=cl>splunk-otel-collector-1638910184    default     1           2021-12-07 12:49:45.694013749 -0800 PST deployed    splunk-otel-collector-0.37.1    0.37.1</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=ad023099ab6dcba06d8ba25d1fef605f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="kubectl get pods" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("ad023099ab6dcba06d8ba25d1fef605f","kubectl get pods")'><div><div class=tab-nav-hidden>kubectl get pods</div><div class=tab-nav-text>kubectl get pods</div></div></button>
<button data-tab-item="kubectl get pods Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ad023099ab6dcba06d8ba25d1fef605f","kubectl get pods Output")'><div><div class=tab-nav-hidden>kubectl get pods Output</div><div class=tab-nav-text>kubectl get pods Output</div></div></button></div><div class=tab-content-container><div data-tab-item="kubectl get pods" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item="kubectl get pods Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kafka-zookeeper-0                                                 1/1     Running   0          18m
</span></span><span class=line><span class=cl>kafka-2                                                           2/2     Running   1          18m
</span></span><span class=line><span class=cl>mongodb-79cf87987f-gsms8                                          2/2     Running   0          18m
</span></span><span class=line><span class=cl>kafka-1                                                           2/2     Running   1          18m
</span></span><span class=line><span class=cl>kafka-exporter-7c65fcd646-dvmtv                                   1/1     Running   3          18m
</span></span><span class=line><span class=cl>kafka-0                                                           2/2     Running   1          18m
</span></span><span class=line><span class=cl>splunk-otel-collector-1638910184-agent-27s5c                      2/2     Running   0          17m
</span></span><span class=line><span class=cl>splunk-otel-collector-1638910184-k8s-cluster-receiver-8587qmh9l   1/1     Running   0          17m</span></span></code></pre></div></div></div></div></div><h3 id=7-verify-dashboards>7. Verify dashboards</h3><p>Verify that out of the box dashboards for Kafka, MongoDB and Zookeeper are populated in the Infrastructure Monitor landing page. Drill down into each component to view granular details for each service.</p><p>Tip: You can use the filter <code>k8s.cluster.name</code> with your cluster name to find your instance.</p><ul><li>Infrastructure Monitoring Landing page:</li></ul><p><a href=#image-423a1fd4e1cb08623824227853e12431 class=lightbox-link><img src=../en/other/gdi/2-deploy/../images/inframon.jpg alt=IM-landing-page style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-423a1fd4e1cb08623824227853e12431><img src=../en/other/gdi/2-deploy/../images/inframon.jpg alt=IM-landing-page class=lightbox-image loading=lazy></a></p><ul><li>K8 Navigator:</li></ul><p><a href=#image-0056342986fbc42668010f276c676ac0 class=lightbox-link><img src=../en/other/gdi/2-deploy/../images/k8navigator.jpg alt=k8-navigator style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0056342986fbc42668010f276c676ac0><img src=../en/other/gdi/2-deploy/../images/k8navigator.jpg alt=k8-navigator class=lightbox-image loading=lazy></a></p><ul><li>MongoDB Dashboard:</li></ul><p><a href=#image-4a318f8f50aa41fb69c9b6a6665ac8f1 class=lightbox-link><img src=../en/other/gdi/2-deploy/../images/mongoDB.jpg alt=mongodb-dash style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4a318f8f50aa41fb69c9b6a6665ac8f1><img src=../en/other/gdi/2-deploy/../images/mongoDB.jpg alt=mongodb-dash class=lightbox-image loading=lazy></a></p><ul><li>Kafka Dashboard:</li></ul><p><a href=#image-90bea8a821ef2ffb00a83b0d84c20c09 class=lightbox-link><img src=../en/other/gdi/2-deploy/../images/kafka.jpg alt=kafka-dash style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-90bea8a821ef2ffb00a83b0d84c20c09><img src=../en/other/gdi/2-deploy/../images/kafka.jpg alt=kafka-dash class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=code-to-kubernetes---python>Code to Kubernetes - Python</h1><h2 id=code-to-kubernetes---python>Code to Kubernetes - Python</h2><p><strong>Objective:</strong> Understand activities to instrument a python application and run it on Kubernetes.</p><ul><li>Verify the code</li><li>Containerize the app</li><li>Deploy the container in Kubernetes</li></ul><p><strong>Note:</strong> these steps do not involve Splunk</p><p><strong>Duration:</strong> 15 Minutes</p><h2 id=1-verify-the-code---review-service>1. Verify the code - Review service</h2><p>Navigate to the review directory</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu/realtime_enrichment/flask_apps/review/</span></span></code></pre></div><p>Inspect review.py (realtime_enrichment/flask_apps/review)</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat review.py</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>review</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>num_reviews</span> <span class=o>=</span> <span class=mi>8635403</span>
</span></span><span class=line><span class=cl><span class=n>num_reviews</span> <span class=o>=</span> <span class=mi>100000</span>
</span></span><span class=line><span class=cl><span class=n>reviews_file</span> <span class=o>=</span> <span class=s1>&#39;/var/appdata/yelp_academic_dataset_review.json&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@review.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello_world</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=s1>&#39;Hello, you want to hit /get_review. We have &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>num_reviews</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39; reviews!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@review.route</span><span class=p>(</span><span class=s1>&#39;/get_review&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_review</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>random_review_int</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>num_reviews</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>line_num</span> <span class=o>=</span> <span class=n>random_review_int</span> <span class=o>+</span> <span class=s1>&#39;q;d&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;sed&#34;</span><span class=p>,</span> <span class=n>line_num</span><span class=p>,</span> <span class=n>reviews_file</span><span class=p>]</span> <span class=c1># sed &#34;7997242q;d&#34; &lt;file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>random_review</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>command</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>random_review</span><span class=o>.</span><span class=n>stdout</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>review</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span> <span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span> <span class=o>=</span> <span class=mi>5000</span><span class=p>,</span> <span class=n>debug</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span></span></span></code></pre></div><p>Inspect requirements.txt</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Flask==2.0.2</span></span></code></pre></div><p>Create a virtual environment and Install the necessary python packages</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu/realtime_enrichment/workshop/flask_apps_start/review/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pip freeze <span class=c1>#note output</span>
</span></span><span class=line><span class=cl>pip install -r requirements.txt
</span></span><span class=line><span class=cl>pip freeze <span class=c1>#note output</span></span></span></code></pre></div><p>Start the REVIEW service. <strong>Note:</strong> You can stop the app with control+C</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 review.py
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * Serving Flask app <span class=s1>&#39;review&#39;</span> <span class=o>(</span>lazy loading<span class=o>)</span>
</span></span><span class=line><span class=cl> * Environment: production
</span></span><span class=line><span class=cl>         ...snip...
</span></span><span class=line><span class=cl> * Running on http://10.160.145.246:5000/ <span class=o>(</span>Press CTRL+C to quit<span class=o>)</span>
</span></span><span class=line><span class=cl> * Restarting with stat
</span></span><span class=line><span class=cl>127.0.0.1 - - <span class=o>[</span>17/May/2022 22:46:38<span class=o>]</span> <span class=s2>&#34;GET / HTTP/1.1&#34;</span> <span class=m>200</span> -
</span></span><span class=line><span class=cl>127.0.0.1 - - <span class=o>[</span>17/May/2022 22:47:02<span class=o>]</span> <span class=s2>&#34;GET /get_review HTTP/1.1&#34;</span> <span class=m>200</span> -
</span></span><span class=line><span class=cl>127.0.0.1 - - <span class=o>[</span>17/May/2022 22:47:58<span class=o>]</span> <span class=s2>&#34;GET /get_review HTTP/1.1&#34;</span> <span class=m>200</span> -</span></span></code></pre></div><p>Verify that the service is working</p><ul><li>Open a new terminal and ssh into your ec2 instance. Then use the curl command in your terminal.</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://localhost:5000</span></span></code></pre></div><ul><li>Or hit the URL <code>http://{Your_EC2_IP_address}:5000</code> and <code>http://{Your_EC2_IP_address}:5000/get_review</code> with a browser</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl localhost:5000
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;message&#34;</span>: <span class=s2>&#34;Hello, you want to hit /get_review. We have 100000 reviews!&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl localhost:5000/get_review
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;review_id&#34;</span>:<span class=s2>&#34;NjbiESXotcEdsyTc4EM3fg&#34;</span>,<span class=s2>&#34;user_id&#34;</span>:<span class=s2>&#34;PR9LAM19rCM_HQiEm5OP5w&#34;</span>,<span class=s2>&#34;business_id&#34;</span>:<span class=s2>&#34;UAtX7xmIfdd1W2Pebf6NWg&#34;</span>,<span class=s2>&#34;stars&#34;</span>:3.0,<span class=s2>&#34;useful&#34;</span>:0,<span class=s2>&#34;funny&#34;</span>:0,<span class=s2>&#34;cool&#34;</span>:0,<span class=s2>&#34;text&#34;</span>:<span class=s2>&#34;-If you&#39;re into cheap beer (pitcher of bud-light for </span><span class=nv>$7</span><span class=s2>) decent wings and a good time, this is the place for you. Its generally very packed after work hours and weekends. Don&#39;t expect cocktails. \n\n-You run into a lot of sketchy characters here sometimes but for the most part if you&#39;re chilling with friends its not that bad. \n\n-Friendly bouncer and bartenders.&#34;</span>,<span class=s2>&#34;date&#34;</span>:<span class=s2>&#34;2016-04-12 20:23:24&#34;</span><span class=o>}</span></span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><ul><li>What does this application do?</li><li>Do you see the yelp dataset being used?</li><li>Why did the output of pip freeze differ each time you ran it?</li><li>Which port is the REVIEW app listening on? Can other python apps use this same port?</li></ul></div></div><h2 id=2-create-a-review-container>2. Create a REVIEW container</h2><p>To create a container image, you need to create a Dockerfile, run docker build to build the image referencing the Docker file and push it up to a remote repository so it can be pulled by other sources.</p><ul><li><a href=https://docs.docker.com/get-started/02_our_app/ target=_blank>Create a Dockerfile</a></li><li>Creating a Dockerfile typically requires you to consider the following:<ul><li>Identify an appropriate container image<ul><li>ubuntu vs. python vs. alpine/slim</li><li>ubuntu - overkill, large image size, wasted resources when running in K8</li><li>this is a python app, so pick an image that is optimized for it</li><li><a href=https://lih-verma.medium.com/alpine-makes-python-docker-builds-way-too-50-slower-and-images-double-2-larger-61d1d43cbc79 target=_blank>avoid alpine for python</a></li></ul></li><li>Order matters<ul><li>you&rsquo;re building layers.</li><li>re-use the layers as much as possible</li><li>have items that change often towards the end</li></ul></li><li><a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ target=_blank>Other Best practices for writing Dockerfiles</a></li></ul></li></ul><p>Dockerfile for review</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.10-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./review.py /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 5000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span> <span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;review.py&#34;</span> <span class=p>]</span></span></span></code></pre></div><p>Create a container image (locally)
Run ‚Äòdocker build‚Äô to build a local container image referencing the Dockerfile</p><div class=tab-panel data-tab-group=8257251c92834507a5ab140061d41457><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="docker build" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("8257251c92834507a5ab140061d41457","docker build")'><div><div class=tab-nav-hidden>docker build</div><div class=tab-nav-text>docker build</div></div></button>
<button data-tab-item="docker build Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("8257251c92834507a5ab140061d41457","docker build Output")'><div><div class=tab-nav-hidden>docker build Output</div><div class=tab-nav-text>docker build Output</div></div></button></div><div class=tab-content-container><div data-tab-item="docker build" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -f Dockerfile -t localhost:8000/review:0.01 .</span></span></code></pre></div></div></div><div data-tab-item="docker build Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[+] Building 35.5s (11/11) FINISHED
</span></span><span class=line><span class=cl> =&gt; [internal] load build definition from Dockerfile                              0.0s
</span></span><span class=line><span class=cl>         ...snip...
</span></span><span class=line><span class=cl> =&gt; [3/5] COPY requirements.txt /app                                              0.0s
</span></span><span class=line><span class=cl> =&gt; [4/5] RUN pip install -r requirements.txt                                     4.6s
</span></span><span class=line><span class=cl> =&gt; [5/5] COPY ./review.py /app                                                   0.0s
</span></span><span class=line><span class=cl> =&gt; exporting to image                                                            0.2s
</span></span><span class=line><span class=cl> =&gt; =&gt; exporting layers                                                           0.2s
</span></span><span class=line><span class=cl> =&gt; =&gt; writing image sha256:61da27081372723363d0425e0ceb34bbad6e483e698c6fe439c5  0.0s
</span></span><span class=line><span class=cl> =&gt; =&gt; naming to docker.io/localhost:8000/review:0.1                                   0.0</span></span></code></pre></div></div></div></div></div><p>Push the container image into a container repository
Run ‚Äòdocker push‚Äô to place a copy of the REVIEW container to a remote location</p><div class=tab-panel data-tab-group=c358016b9341973c15b3e62408b8bb99><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="docker push" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c358016b9341973c15b3e62408b8bb99","docker push")'><div><div class=tab-nav-hidden>docker push</div><div class=tab-nav-text>docker push</div></div></button>
<button data-tab-item="docker push Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c358016b9341973c15b3e62408b8bb99","docker push Output")'><div><div class=tab-nav-hidden>docker push Output</div><div class=tab-nav-text>docker push Output</div></div></button></div><div class=tab-content-container><div data-tab-item="docker push" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker push localhost:8000/review:0.01</span></span></code></pre></div></div></div><div data-tab-item="docker push Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>The push refers to repository [docker.io/localhost:8000/review]
</span></span><span class=line><span class=cl>02c36dfb4867: Pushed
</span></span><span class=line><span class=cl>         ...snip...
</span></span><span class=line><span class=cl>fd95118eade9: Pushed
</span></span><span class=line><span class=cl>0.1: digest: sha256:3651f740abe5635af95d07acd6bcf814e4d025fcc1d9e4af9dee023a9b286f38 size: 2202</span></span></code></pre></div></div></div></div></div><p>Verify that the image is in Docker Hub. The same info can be found in Docker Desktop</p><div class=tab-panel data-tab-group=56a7547376e0173ce6af42253035455b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="get catalog" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("56a7547376e0173ce6af42253035455b","get catalog")'><div><div class=tab-nav-hidden>get catalog</div><div class=tab-nav-text>get catalog</div></div></button>
<button data-tab-item="get catalog Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("56a7547376e0173ce6af42253035455b","get catalog Output")'><div><div class=tab-nav-hidden>get catalog Output</div><div class=tab-nav-text>get catalog Output</div></div></button></div><div class=tab-content-container><div data-tab-item="get catalog" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -s http://localhost:8000/v2/_catalog</span></span></code></pre></div></div></div><div data-tab-item="get catalog Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;repositories&#34;:[&#34;review&#34;]}</span></span></code></pre></div></div></div></div></div><h2 id=3-run-review-in-kubernetes>3. Run REVIEW in Kubernetes</h2><p>Create K8 deployment yaml file for the REVIEW app</p><p>Reference: <a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#creating-a-deployment target=_blank>Creating a Deployment</a></p><p>review.deployment.yaml</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imagePullSecrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>regcred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>localhost:8000/review:0.01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/var/appdata</span></span></span></code></pre></div><p>Notes regarding review.deployment.yaml:</p><ul><li>labels - K8 uses labels and selectors to tag and identify resources<ul><li>In the next step, we&rsquo;ll create a service and associate it to this deployment using the label</li></ul></li><li>replicas = 1<ul><li>K8 allows you to scale your deployments horizontally</li><li>We&rsquo;ll leverage this later to add load and increase our ingestion rate</li></ul></li><li>regcred provides this deployment with the ability to access your dockerhub credentials which is necessary to pull the container image.</li><li>The volume definition and volumemount make the yelp dataset visible to the container</li></ul><p>Create a K8 service yaml file for the review app.</p><p>Reference: <a href=https://kubernetes.io/docs/concepts/services-networking/service/#defining-a-service target=_blank>Creating a service:</a></p><p>review.service.yaml</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>5000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30000</span></span></span></code></pre></div><p>Notes about review.service.yaml:</p><ul><li>the selector associates this service to pods with the label app with the value being review</li><li>the review service exposes the review pods as a network service<ul><li>other pods can now ping &lsquo;review&rsquo; and they will hit a review pod.</li><li>a pod would get a review if it ran <code>curl http://review:5000</code></li></ul></li><li>NodePort service<ul><li>the service is accessible to the K8 host by the nodePort, 30000</li><li>Another machine that has this can get a review if it ran <code>curl http://&lt;k8 host ip>:30000</code></li></ul></li></ul><p>Apply the review deployment and service</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f review.service.yaml -f review.deployment.yaml</span></span></code></pre></div><p>Verify that the deployment and services are running:</p><div class=tab-panel data-tab-group=bbf75e17a645b4500af62da9a77b0b6f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="kubectl get deployments" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("bbf75e17a645b4500af62da9a77b0b6f","kubectl get deployments")'><div><div class=tab-nav-hidden>kubectl get deployments</div><div class=tab-nav-text>kubectl get deployments</div></div></button>
<button data-tab-item="kubectl get deployments output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("bbf75e17a645b4500af62da9a77b0b6f","kubectl get deployments output")'><div><div class=tab-nav-hidden>kubectl get deployments output</div><div class=tab-nav-text>kubectl get deployments output</div></div></button></div><div class=tab-content-container><div data-tab-item="kubectl get deployments" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get deployments</span></span></code></pre></div></div></div><div data-tab-item="kubectl get deployments output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>review                                                  1/1     1            1           19h</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=98533c655b305830cc2c1ee5105a0844><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="kubectl get services" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("98533c655b305830cc2c1ee5105a0844","kubectl get services")'><div><div class=tab-nav-hidden>kubectl get services</div><div class=tab-nav-text>kubectl get services</div></div></button>
<button data-tab-item="kubectl get services output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("98533c655b305830cc2c1ee5105a0844","kubectl get services output")'><div><div class=tab-nav-hidden>kubectl get services output</div><div class=tab-nav-text>kubectl get services output</div></div></button></div><div class=tab-content-container><div data-tab-item="kubectl get services" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get services</span></span></code></pre></div></div></div><div data-tab-item="kubectl get services output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE
</span></span><span class=line><span class=cl>review                     NodePort    10.43.175.21    &lt;none&gt;        5000:30000/TCP                  154d</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=b07f040f4aecb8a697ea094f0fcd2db6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="curl localhost" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("b07f040f4aecb8a697ea094f0fcd2db6","curl localhost")'><div><div class=tab-nav-hidden>curl localhost</div><div class=tab-nav-text>curl localhost</div></div></button>
<button data-tab-item="curl localhost Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b07f040f4aecb8a697ea094f0fcd2db6","curl localhost Output")'><div><div class=tab-nav-hidden>curl localhost Output</div><div class=tab-nav-text>curl localhost Output</div></div></button></div><div class=tab-content-container><div data-tab-item="curl localhost" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl localhost:30000</span></span></code></pre></div></div></div><div data-tab-item="curl localhost Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>  &#34;message&#34;: &#34;Hello, you want to hit /get_review. We have 100000 reviews!&#34;
</span></span><span class=line><span class=cl>}</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=93c84c3ee797d45c03d8a80366b34d4f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="get review" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("93c84c3ee797d45c03d8a80366b34d4f","get review")'><div><div class=tab-nav-hidden>get review</div><div class=tab-nav-text>get review</div></div></button>
<button data-tab-item="get review Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("93c84c3ee797d45c03d8a80366b34d4f","get review Output")'><div><div class=tab-nav-hidden>get review Output</div><div class=tab-nav-text>get review Output</div></div></button></div><div class=tab-content-container><div data-tab-item="get review" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl localhost:30000/get_review</span></span></code></pre></div></div></div><div data-tab-item="get review Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>{&#34;review_id&#34;:&#34;Vv9rHtfBrFc-1M1DHRKN9Q&#34;,&#34;user_id&#34;:&#34;EaNqIwKkM7p1bkraKotqrg&#34;,&#34;business_id&#34;:&#34;TA1KUSCu8GkWP9w0rmElxw&#34;,&#34;stars&#34;:3.0,&#34;useful&#34;:1,&#34;funny&#34;:0,&#34;cool&#34;:0,&#34;text&#34;:&#34;This is the first time I&#39;ve actually written a review for Flip, but I&#39;ve probably been here about 10 times.  \n\nThis used to be where I would take out of town guests who wanted a good, casual, and relatively inexpensive meal.  \n\nI hadn&#39;t been for a while, so after a long day in midtown, we decided to head to Flip.  \n\nWe had the fried pickles, onion rings, the gyro burger, their special burger, and split a nutella milkshake.  I have tasted all of the items we ordered previously (with the exception of the special) and have been blown away with how good they were.  My guy had the special which was definitely good, so no complaints there.  The onion rings and the fried pickles were greasier than expected.  Though I&#39;ve thought they were delicious in the past, I probably wouldn&#39;t order either again.  The gyro burger was good, but I could have used a little more sauce.  It almost tasted like all of the ingredients didn&#39;t entirely fit together.  Something was definitely off. It was a friday night and they weren&#39;t insanely busy, so I&#39;m not sure I would attribute it to the staff not being on their A game...\n\nDon&#39;t get me wrong.  Flip is still good.  The wait staff is still amazingly good looking.  They still make delicious milk shakes.  It&#39;s just not as amazing as it once was, which really is a little sad.&#34;,&#34;date&#34;:&#34;2010-10-11 18:18:35&#34;}</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What changes are required if you need to make an update to your Dockerfile now?</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=instrument-reviews-for-tracing>Instrument REVIEWS for Tracing</h1><h2 id=1-use-data-setup-to-instrument-a-python-application>1. Use Data Setup to instrument a Python application</h2><p>Within the O11y Cloud UI:</p><p>Data Management -> Add Integration -> Monitor Applications -> Python (traces) -> Add Integration</p><p>Provide the following to the Configure Integration Wizard:</p><ul><li><p>Service: review</p></li><li><p>Django: no</p></li><li><p>collector endpoint: <code>http://localhost:4317</code></p></li><li><p>Environment: rtapp-workshop-[YOURNAME]</p></li><li><p>Kubernetes: yes</p></li><li><p>Legacy Agent: no</p></li></ul><p><a href=#image-718b9c03f5967582e4c5cfc5aac8cede class=lightbox-link><img src=../en/other/gdi/4-instrument/../images/configureintegration.png alt=o11y_cloud_ui style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-718b9c03f5967582e4c5cfc5aac8cede><img src=../en/other/gdi/4-instrument/../images/configureintegration.png alt=o11y_cloud_ui class=lightbox-image loading=lazy></a></p><p>We are instructed to:</p><ul><li>Install the instrumentation packages for your Python environment.</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>pip install splunk-opentelemetry[all]
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>splunk-py-trace-bootstrap</span></span></code></pre></div><ul><li><p>Configure the Downward API to expose environment variables to Kubernetes resources.</p><p>For example, update a Deployment to inject environment variables by adding <code>.spec.template.spec.containers.env</code> like:</p></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>your-application</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPLUNK_OTEL_AGENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(SPLUNK_OTEL_AGENT):4317&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;review&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;deployment.environment=rtapp-workshop-stevel&#34;</span></span></span></code></pre></div><ul><li><p>Enable the Splunk OTel Python agent by editing your Python service command.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>splunk-py-trace python3 main.py --port=8000</span></span></code></pre></div></li><li><p>The actions we must perform include:</p><ul><li>Update the Dockerfile to install the splunk-opentelemetry packages</li><li>Update the deployment.yaml for each service to include these environment variables which will be used by the pod and container.</li><li>Update our Dockerfile for REVIEW so that our program is bootstrapped with splunk-py-trace</li></ul></li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>We will accomplish this by:</p><ol><li>generating a new requirements.txt file</li><li>generating a new container image with an updated Dockerfile for REVIEW and then</li><li>update the review.deployment.yaml to capture all of these changes.</li></ol></div></div><h2 id=2-update-the-review-container>2. Update the REVIEW container</h2><ul><li><p>Generate a new container image</p></li><li><p>Update the Dockerfile for REVIEW (<code>/workshop/flask_apps_finish/review</code>)</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.10-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install splunk-opentelemetry<span class=o>[</span>all<span class=o>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> splk-py-trace-bootstrap<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./review.py /app<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 5000</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span> <span class=s2>&#34;splunk-py-trace&#34;</span> <span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span> <span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;review.py&#34;</span> <span class=p>]</span></span></span></code></pre></div></li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Note that the only lines, in bold, added to the Dockerfile</p></div></div><ul><li>Generate a new container image with docker build in the ‚Äòfinished‚Äô directory</li><li>Notice that I have changed the repository name from <code>localhost:8000/review:0.01</code> to <code>localhost:8000/review-splkotel:0.01</code></li></ul><p>Ensure you are in the correct directory.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>pwd</span>
</span></span><span class=line><span class=cl>./workshop/flask_apps_finish/review</span></span></code></pre></div><div class=tab-panel data-tab-group=6d93b73f227162f664c4a81a84ff9b00><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="docker build" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("6d93b73f227162f664c4a81a84ff9b00","docker build")'><div><div class=tab-nav-hidden>docker build</div><div class=tab-nav-text>docker build</div></div></button>
<button data-tab-item="docker build Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6d93b73f227162f664c4a81a84ff9b00","docker build Output")'><div><div class=tab-nav-hidden>docker build Output</div><div class=tab-nav-text>docker build Output</div></div></button></div><div class=tab-content-container><div data-tab-item="docker build" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build -f Dockerfile.review -t localhost:8000/review-splkotel:0.01 .</span></span></code></pre></div></div></div><div data-tab-item="docker build Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[+] Building 27.1s (12/12) FINISHED
</span></span><span class=line><span class=cl>=&gt; [internal] load build definition from Dockerfile                                                        0.0s
</span></span><span class=line><span class=cl>=&gt; =&gt; transferring dockerfile: 364B                                                                        0.0s
</span></span><span class=line><span class=cl>=&gt; [internal] load .dockerignore                                                                           0.0s
</span></span><span class=line><span class=cl>=&gt; =&gt; transferring context: 2B                                                                             0.0s
</span></span><span class=line><span class=cl>=&gt; [internal] load metadata for docker.io/library/python:3.10-slim                                         1.6s
</span></span><span class=line><span class=cl>=&gt; [auth] library/python:pull token for registry-1.docker.io                                               0.0s
</span></span><span class=line><span class=cl>=&gt; [1/6] FROM docker.io/library/python:3.10-slim@sha256:54956d6c929405ff651516d5ebbc204203a6415c9d2757aad  0.0s
</span></span><span class=line><span class=cl>=&gt; [internal] load build context                                                                           0.3s
</span></span><span class=line><span class=cl>=&gt; =&gt; transferring context: 1.91kB                                                                         0.3s
</span></span><span class=line><span class=cl>=&gt; CACHED [2/6] WORKDIR /app                                                                               0.0s
</span></span><span class=line><span class=cl>=&gt; [3/6] COPY requirements.txt /app                                                                        0.0s
</span></span><span class=line><span class=cl>=&gt; [4/6] RUN pip install -r requirements.txt                                                              15.3s
</span></span><span class=line><span class=cl>=&gt; [5/6] RUN splk-py-trace-bootstrap                                                                       9.0s
</span></span><span class=line><span class=cl>=&gt; [6/6] COPY ./review.py /app                                                                             0.0s
</span></span><span class=line><span class=cl>=&gt; exporting to image                                                                                      0.6s
</span></span><span class=line><span class=cl>=&gt; =&gt; exporting layers                                                                                     0.6s
</span></span><span class=line><span class=cl>=&gt; =&gt; writing image sha256:164977dd860a17743b8d68bcc50c691082bd3bfb352d1025dc3a54b15d5f4c4d                0.0s
</span></span><span class=line><span class=cl>=&gt; =&gt; naming to docker.io/localhost:8000/review-splkotel:0.01                                              0.0s</span></span></code></pre></div></div></div></div></div><ul><li>Push the image to Docker Hub with docker push command</li></ul><div class=tab-panel data-tab-group=d27cd02616d1e71420738dba3b156868><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="docker push" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("d27cd02616d1e71420738dba3b156868","docker push")'><div><div class=tab-nav-hidden>docker push</div><div class=tab-nav-text>docker push</div></div></button>
<button data-tab-item="docker push Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("d27cd02616d1e71420738dba3b156868","docker push Output")'><div><div class=tab-nav-hidden>docker push Output</div><div class=tab-nav-text>docker push Output</div></div></button></div><div class=tab-content-container><div data-tab-item="docker push" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker push localhost:8000/review-splkotel:0.01</span></span></code></pre></div></div></div><div data-tab-item="docker push Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>The push refers to repository [docker.io/localhost:8000/review-splkotel]
</span></span><span class=line><span class=cl>682f0e550f2c: Pushed
</span></span><span class=line><span class=cl>dd7dfa312442: Pushed
</span></span><span class=line><span class=cl>917fd8334695: Pushed
</span></span><span class=line><span class=cl>e6782d51030d: Pushed
</span></span><span class=line><span class=cl>c6b19a64e528: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>8f52e3bfc0ab: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>f90b85785215: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>d5c0beb90ce6: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>3759be374189: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>fd95118eade9: Mounted from localhost:8000/review
</span></span><span class=line><span class=cl>0.01: digest: sha256:3b251059724dbb510ea81424fc25ed03554221e09e90ef965438da33af718a45 size: 2412</span></span></code></pre></div></div></div></div></div><h2 id=3-update-the-review-deployment-in-kubernetes>3. Update the REVIEW deployment in Kubernetes</h2><ul><li><p>review.deployment.yaml must be updated with the following changes:</p><ul><li>Load the new container image on Docker Hub</li><li>Add environment variables so traces can be emitted to the OTEL collector</li></ul></li><li><p>The deployment must be replaced using the updated review.deployment.yaml</p><ul><li><p>Update review.deployment.yaml (updates highlighted in bold)</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>imagePullSecrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>regcred</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>localhost:8000/review-splkotel:0.01</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>review</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPLUNK_OTEL_AGENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>status.hostIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_SERVICE_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;review&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPLUNK_METRICS_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(SPLUNK_OTEL_AGENT):9943&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_EXPORTER_OTLP_ENDPOINT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://$(SPLUNK_OTEL_AGENT):4317&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>OTEL_RESOURCE_ATTRIBUTES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;deployment.environment=rtapp-workshop-stevel&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>appdata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/var/appdata</span></span></span></code></pre></div></li></ul></li><li><p>Apply review.deployment.yaml. Kubernetes will automatically pick up the changes to the deployment and redeploy new pods with these updates</p><ul><li>Notice that the review-* pod has been restarted</li></ul></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f review.deployment.yaml</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                              READY   STATUS        RESTARTS   AGE
</span></span><span class=line><span class=cl>kafka-client                                                      0/1     Unknown       0          155d
</span></span><span class=line><span class=cl>curl                                                              0/1     Unknown       0          155d
</span></span><span class=line><span class=cl>kafka-zookeeper-0                                                 1/1     Running       0          26h
</span></span><span class=line><span class=cl>kafka-2                                                           2/2     Running       0          26h
</span></span><span class=line><span class=cl>kafka-exporter-647bddcbfc-h9gp5                                   1/1     Running       2          26h
</span></span><span class=line><span class=cl>mongodb-6f6c78c76-kl4vv                                           2/2     Running       0          26h
</span></span><span class=line><span class=cl>kafka-1                                                           2/2     Running       1          26h
</span></span><span class=line><span class=cl>kafka-0                                                           2/2     Running       1          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-agent-n4dfn                      2/2     Running       0          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-k8s-cluster-receiver-5f48v296j   1/1     Running       0          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-agent-jqxhh                      2/2     Running       0          26h
</span></span><span class=line><span class=cl>review-6686859bd7-4pf5d                                           1/1     Running       0          11s
</span></span><span class=line><span class=cl>review-5dd8cfd77b-52jbd                                           0/1     Terminating   0          2d10h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get pods
</span></span><span class=line><span class=cl>NAME                                                              READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>kafka-client                                                      0/1     Unknown   0          155d
</span></span><span class=line><span class=cl>curl                                                              0/1     Unknown   0          155d
</span></span><span class=line><span class=cl>kafka-zookeeper-0                                                 1/1     Running   0          26h
</span></span><span class=line><span class=cl>kafka-2                                                           2/2     Running   0          26h
</span></span><span class=line><span class=cl>kafka-exporter-647bddcbfc-h9gp5                                   1/1     Running   2          26h
</span></span><span class=line><span class=cl>mongodb-6f6c78c76-kl4vv                                           2/2     Running   0          26h
</span></span><span class=line><span class=cl>kafka-1                                                           2/2     Running   1          26h
</span></span><span class=line><span class=cl>kafka-0                                                           2/2     Running   1          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-agent-n4dfn                      2/2     Running   0          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-k8s-cluster-receiver-5f48v296j   1/1     Running   0          26h
</span></span><span class=line><span class=cl>splunk-otel-collector-1653114277-agent-jqxhh                      2/2     Running   0          26h
</span></span><span class=line><span class=cl>review-6686859bd7-4pf5d                                           1/1     Running   0          15s</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=monitor-system-logs-with-splunk-universal-forwarder>Monitor System Logs with Splunk Universal Forwarder</h1><p><strong>Objective:</strong> Learn how to monitor Linux system logs with the Universal Forwarder sending logs to Splunk Enterprise</p><p><strong>Duration</strong>: 10 Minutes</p><h2 id=scenario>Scenario</h2><p>You&rsquo;ve been tasked with monitoring the OS logs of the host running your Kubernetes cluster. We are going to utilize a script that will autodeploy the Splunk Universal Forwarder. You will then configure the Universal Forwarder to send logs to the Splunk Enterprise instance assigned to you.</p><h3 id=1-ensure-youre-in-the-correct-directory>1. Ensure You&rsquo;re in the Correct Directory</h3><ul><li>we will need to be in /home/ubuntu/session-2</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /home/ubuntu/session-2</span></span></code></pre></div><h3 id=2-review-the-universal-forwarder-install-script>2. Review the Universal Forwarder Install Script</h3><ul><li>Let&rsquo;s take a look at the script that will install the Universal Forwarder and Linux TA automatically for you.<ul><li>This script is primarily used for remote instances.</li><li>Note we are not using a deployment server in this lab, however it is recommended in production we do that.</li><li>What user are we installing Splunk as?</li></ul></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh  
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1># This EXAMPLE script shows how to deploy the Splunk universal forwarder</span>
</span></span><span class=line><span class=cl><span class=c1># to many remote hosts via ssh and common Unix commands.</span>
</span></span><span class=line><span class=cl><span class=c1># For &#34;real&#34; use, this script needs ERROR DETECTION AND LOGGING!!</span>
</span></span><span class=line><span class=cl><span class=c1># --Variables that you must set -----</span>
</span></span><span class=line><span class=cl><span class=c1># Set username using by splunkd to run.</span>
</span></span><span class=line><span class=cl>  <span class=nv>SPLUNK_RUN_USER</span><span class=o>=</span><span class=s2>&#34;ubuntu&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Populate this file with a list of hosts that this script should install to,</span>
</span></span><span class=line><span class=cl><span class=c1># with one host per line. This must be specified in the form that should</span>
</span></span><span class=line><span class=cl><span class=c1># be used for the ssh login, ie. username@host</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Example file contents:</span>
</span></span><span class=line><span class=cl><span class=c1># splunkuser@10.20.13.4</span>
</span></span><span class=line><span class=cl><span class=c1># splunkker@10.20.13.5</span>
</span></span><span class=line><span class=cl>  <span class=nv>HOSTS_FILE</span><span class=o>=</span><span class=s2>&#34;myhost.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This should be a WGET command that was *carefully* copied from splunk.com!!</span>
</span></span><span class=line><span class=cl><span class=c1># Sign into splunk.com and go to the download page, then look for the wget</span>
</span></span><span class=line><span class=cl><span class=c1># link near the top of the page (once you have selected your platform)</span>
</span></span><span class=line><span class=cl><span class=c1># copy and paste your wget command between the &#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>WGET_CMD</span><span class=o>=</span><span class=s2>&#34;wget -O splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz &#39;https://download.splunk.com/products/universalforwarder/releases/9.0.3/linux/splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz&#39;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Set the install file name to the name of the file that wget downloads</span>
</span></span><span class=line><span class=cl><span class=c1># (the second argument to wget)</span>
</span></span><span class=line><span class=cl>  <span class=nv>INSTALL_FILE</span><span class=o>=</span><span class=s2>&#34;splunkforwarder-9.0.3-dd0128b1f8cd-Linux-x86_64.tgz&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># After installation, the forwarder will become a deployment client of this</span>
</span></span><span class=line><span class=cl><span class=c1># host.  Specify the host and management (not web) port of the deployment server</span>
</span></span><span class=line><span class=cl><span class=c1># that will be managing these forwarder instances.</span>
</span></span><span class=line><span class=cl><span class=c1># Example 1.2.3.4:8089</span>
</span></span><span class=line><span class=cl><span class=c1>#  DEPLOY_SERVER=&#34;x.x.x.x:8089&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># After installation, the forwarder can have additional TA&#39;s added to the </span>
</span></span><span class=line><span class=cl><span class=c1># /app directory please provide the local where TA&#39;s will be. </span>
</span></span><span class=line><span class=cl>  <span class=nv>TA_INSTALL_DIRECTORY</span><span class=o>=</span><span class=s2>&#34;/home/ubuntu/session-2&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Set the seed app folder name for deploymentclien.conf</span>
</span></span><span class=line><span class=cl><span class=c1>#  DEPLOY_APP_FOLDER_NAME=&#34;seed_all_deploymentclient&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Set the new Splunk admin password</span>
</span></span><span class=line><span class=cl>  <span class=nv>PASSWORD</span><span class=o>=</span><span class=s2>&#34;buttercup&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>REMOTE_SCRIPT_DEPLOY</span><span class=o>=</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  cd /opt
</span></span></span><span class=line><span class=cl><span class=s2>  sudo </span><span class=nv>$WGET_CMD</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  sudo tar xvzf </span><span class=nv>$INSTALL_FILE</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  sudo rm </span><span class=nv>$INSTALL_FILE</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo useradd </span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  sudo find </span><span class=nv>$TA_INSTALL_DIRECTORY</span><span class=s2> -name &#39;*.tgz&#39; -exec tar xzvf {} --directory /opt/splunkforwarder/etc/apps \;
</span></span></span><span class=line><span class=cl><span class=s2>  sudo chown -R </span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2>:</span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2> /opt/splunkforwarder
</span></span></span><span class=line><span class=cl><span class=s2>  echo \&#34;[user_info] 
</span></span></span><span class=line><span class=cl><span class=s2>  USERNAME = admin
</span></span></span><span class=line><span class=cl><span class=s2>  PASSWORD = </span><span class=nv>$PASSWORD</span><span class=s2>\&#34; &gt; /opt/splunkforwarder/etc/system/local/user-seed.conf   
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo cp </span><span class=nv>$TA_INSTALL_DIRECTORY</span><span class=s2>/*.tgz /opt/splunkforwader/etc/apps/
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo find /opt/splunkforwarder/etc/apps/ -name &#39;*.tgz&#39; -exec tar xzvf {} \;
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo -u splunk /opt/splunkforwarder/bin/splunk start --accept-license --answer-yes --auto-ports --no-prompt
</span></span></span><span class=line><span class=cl><span class=s2>  /opt/splunkforwarder/bin/splunk start --accept-license --answer-yes --auto-ports --no-prompt
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo /opt/splunkforwarder/bin/splunk enable boot-start -user </span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  /opt/splunkforwarder/bin/splunk enable boot-start -user </span><span class=nv>$SPLUNK_RUN_USER</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  #sudo cp </span><span class=nv>$TA_INSTALL_DIRECTORY</span><span class=s2>/*.tgz /opt/splunkforwarder/etc/apps/
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  exit
</span></span></span><span class=line><span class=cl><span class=s2> &#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>DIR</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span> <span class=nb>cd</span> <span class=s2>&#34;</span><span class=k>$(</span> dirname <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BASH_SOURCE</span><span class=p>[0]</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>)</span><span class=s2>&#34;</span> &gt;/dev/null <span class=o>&amp;&amp;</span> <span class=nb>pwd</span> <span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#===============================================================================================</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;In 5 seconds, will run the following script on each remote host:&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;====================&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$REMOTE_SCRIPT_DEPLOY</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;====================&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> 
</span></span><span class=line><span class=cl>  sleep <span class=m>5</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Reading host logins from </span><span class=nv>$HOSTS_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Starting.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> DST in <span class=sb>`</span>cat <span class=s2>&#34;</span><span class=nv>$DIR</span><span class=s2>/</span><span class=nv>$HOSTS_FILE</span><span class=s2>&#34;</span><span class=sb>`</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=nv>$DST</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>      <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;---------------------------&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Installing to </span><span class=nv>$DST</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Initial UF deployment&#34;</span>
</span></span><span class=line><span class=cl>    sudo ssh -t <span class=s2>&#34;</span><span class=nv>$DST</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$REMOTE_SCRIPT_DEPLOY</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>done</span>  
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;---------------------------&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Done&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Please use the following app folder name to override deploymentclient.conf options: </span><span class=nv>$DEPLOY_APP_FOLDER_NAME</span><span class=s2>&#34;</span></span></span></code></pre></div><h3 id=3-run-the-install-script>3. Run the install script</h3><p>We will run the install script now. You will see some Warnings at the end. This is totally normal. The script is built for use on remote machines, however for todays lab you will be using localhost.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./install.sh</span></span></code></pre></div><p>You will be asked <code>Are you sure you want to continue connecting (yes/no/[fingerprint])?</code>
Answer Yes.</p><p>Enter your ssh password when prompted.</p><h3 id=4-verify-installation-of-the-universal-forwarader>4. Verify installation of the Universal Forwarader</h3><ul><li>We need to verify that the Splunk Universal Forwarder is installed and running.<ul><li>You should see a couple PID&rsquo;s return and a &ldquo;Splunk is currently running.&rdquo; message.</li></ul></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/opt/splunkforwarder/bin/splunk status</span></span></code></pre></div><h4 id=5-configure-the-universal-forwarder-to-send-data-to-splunk-enterprise>5. Configure the Universal Forwarder to Send Data to Splunk Enterprise</h4><ul><li>We will be able to send the data to our Splunk Enterprise environment easily by entering one line into the cli.<ul><li><a href=https://docs.splunk.com/Documentation/Forwarder/9.0.3/Forwarder/Configuretheuniversalforwarder target=_blank>Universal Forwarder Config Guide</a></li></ul></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/opt/splunkforwarder/bin/splunk add forward-server &lt;your_splunk_enterprise_ip&gt;:9997</span></span></code></pre></div><h4 id=6-verify-the-data-in-your-splunk-enterprise-environment>6. Verify the Data in Your Splunk Enterprise Environment</h4><ul><li><p>We are now going to take a look at the Splunk Enterprise environment to verify logs are coming in.</p><ul><li>Logs will be coming into <code>index=main</code></li></ul></li><li><p>Open your web browser and navigate to: <code>http://&lt;your_splunk_enterprise_ip:8000</code></p><ul><li>You will use the credentials <code>admin:&lt;your_ssh_password></code></li></ul></li><li><p>In the search bar, type in the following:</p></li><li><p><code>index=main host=&lt;your_host_name></code></p></li><li><p>You should see data from your host. Take note of the interesting fields and the different data sources flowing in.</p></li></ul><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=monitoring-horizontal-pod-autoscaling-in-kubernetes>Monitoring Horizontal Pod Autoscaling in Kubernetes</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
45 minutes</button></span><p>This workshop will equip you with the basic understanding of monitoring Kubernetes using the Splunk OpenTelemetry Collector. During the workshop you will deploy PHP/Apache and a load generator.</p><p>You will learn about OpenTelemetry Receivers, Kubernetes Namespaces, ReplicaSets, Kubernetes Horizontal Pod AutoScaling and how to monitor all this using the Splunk Observability Cloud. The main learnings from the workshop will be a better understanding of the Kubernetes Navigator (and Dashboards) in Splunk Observability Cloud as well as seeing Kubernetes metrics, events and Detectors.</p><p>For this workshop Splunk has prepared an Ubuntu Linux instance in AWS/EC2 all pre-configured for you.</p><p>To get access to the instance that you will be using in the workshop, please visit the URL provided by the workshop leader.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Monitoring Horizontal Pod Autoscaling in Kubernetes</h1><article class=default><header class=headline></header><h1 id=deploying-the-opentelemetry-collector-in-kubernetes-using-a-namespace>Deploying the OpenTelemetry Collector in Kubernetes using a NameSpace</h1><h2 id=1-kubernetes-navigator-20-ui>1. Kubernetes Navigator 2.0 UI</h2><p>We will be starting this workshop using the new Kubernetes Navigator so please check that you are already using the new Navigator.</p><p>When you select <strong>Infrastructure</strong> from the main menu on the left, followed by selecting <strong>Kubernetes</strong>, you should see two services panes (<strong>K8s nodes</strong> and <strong>K8s workloads</strong>) for Kubernetes, similar like the ones below:</p><p><a href=#image-01caf33db3693ecab40b9db5aaf86e43 class=lightbox-link><img src=../en/other/hpa/1-deploy-otel/../images/k8s-nav2-two.png alt=k8s-navi-v-2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-01caf33db3693ecab40b9db5aaf86e43><img src=../en/other/hpa/1-deploy-otel/../images/k8s-nav2-two.png alt=k8s-navi-v-2 class=lightbox-image loading=lazy></a></p><h2 id=2-connect-to-ec2-instance>2. Connect to EC2 instance</h2><p>You will be able to connect to the workshop instance by using SSH from your Mac, Linux or Windows device. Open the link to the sheet provided by your instructor. This sheet contains the IP addresses and the password for the workshop instances.</p><p>To use SSH, open a terminal on your system and type <code>ssh ubuntu@x.x.x.x</code> (replacing x.x.x.x with the IP address assigned to you). The password for this workshop is also provided in the sheet.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Your workshop instance has been pre-configured with the correct <strong>Access Token</strong> and <strong>Realm</strong> for this workshop. There is no need for you to configure these.</p></div></div><h2 id=3-namespaces-in-kubernetes>3. Namespaces in Kubernetes</h2><p>Most of our customers will make use of some kind of private or public cloud service to run Kubernetes. They often choose to have only a few large Kubernetes clusters as it is easier to manage centrally.</p><p>Namespaces are a way to organize these large Kubernetes clusters into virtual sub-clusters. This can be helpful when different teams or projects share a Kubernetes cluster as this will give them the easy ability to just see and work with their own resources.</p><p>Any number of namespaces are supported within a cluster, each logically separated from others but with the ability to communicate with each other. Components are only <strong>visible</strong> when selecting a namespace or when adding the <code>--all-namespaces</code> flag to <code>kubectl</code> instead of allowing you to view just the components relevant to your project by selecting your namespace.</p><p>Most customers will want to install the Splunk OpenTelemetry Collector into a separate namespace. This workshop will follow that best practice.</p><h2 id=4-install-splunk-otel-using-helm>4. Install Splunk OTel using Helm</h2><p>Install the OpenTelemetry Collector using the Splunk Helm chart. First, add the Splunk Helm chart repository and update.</p><div class=tab-panel data-tab-group=602724b83ded64a3ee10a37b09caac8f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="helm repo add" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("602724b83ded64a3ee10a37b09caac8f","helm repo add")'><div><div class=tab-nav-hidden>helm repo add</div><div class=tab-nav-text>helm repo add</div></div></button>
<button data-tab-item="helm repo add output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("602724b83ded64a3ee10a37b09caac8f","helm repo add output")'><div><div class=tab-nav-hidden>helm repo add output</div><div class=tab-nav-text>helm repo add output</div></div></button></div><div class=tab-content-container><div data-tab-item="helm repo add" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div data-tab-item="helm repo add output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>&#34;splunk-otel-collector-chart&#34; has been added to your repositories
</span></span><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>Hang tight while we grab the latest from your chart repositories...
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;splunk-otel-collector-chart&#34; chart repository
</span></span><span class=line><span class=cl>Update Complete. ‚éàHappy Helming!‚éà</span></span></code></pre></div></div></div></div></div><p>Install the OpenTelemetry Collector Helm chart into a new <strong>splunk</strong> namespace with the following commands, do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=189bf68265630b04141b7ef2ed63001b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="helm install" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("189bf68265630b04141b7ef2ed63001b","helm install")'><div><div class=tab-nav-hidden>helm install</div><div class=tab-nav-text>helm install</div></div></button></div><div class=tab-content-container><div data-tab-item="helm install" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--namespace splunk <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--create-namespace <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/splunk-defaults.yaml</span></span></code></pre></div></div></div></div></div><h2 id=5-verify-deployment>5. Verify Deployment</h2><p>You can monitor the progress of the deployment by running <code>kubectl get pods</code> and adding <code>-n splunk</code> to the command to see the pods in the <code>splunk</code> namespace which should typically report that the new pods are up and running after about 30 seconds.</p><p>Ensure the status is reported as <strong>Running</strong> before continuing.</p><div class=tab-panel data-tab-group=a1de0a749a7912e7ad33a636bed24c88><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="kubectl get pods" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("a1de0a749a7912e7ad33a636bed24c88","kubectl get pods")'><div><div class=tab-nav-hidden>kubectl get pods</div><div class=tab-nav-text>kubectl get pods</div></div></button>
<button data-tab-item="kubectl get pods Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("a1de0a749a7912e7ad33a636bed24c88","kubectl get pods Output")'><div><div class=tab-nav-hidden>kubectl get pods Output</div><div class=tab-nav-text>kubectl get pods Output</div></div></button></div><div class=tab-content-container><div data-tab-item="kubectl get pods" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods -n splunk</span></span></code></pre></div></div></div><div data-tab-item="kubectl get pods Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NAME                                                          READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-pvstb                             2/2     Running   0          19s
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6c454894f8-mqs8n   1/1     Running   0          19s</span></span></code></pre></div></div></div></div></div><p>Use the label set by the <code>helm</code> install to tail logs (You will need to press <code>ctrl + c</code> to exit).</p><div class=tab-panel data-tab-group=32a0d93ab9105e39551120e2b42a8825><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="kubectl logs" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("32a0d93ab9105e39551120e2b42a8825","kubectl logs")'><div><div class=tab-nav-hidden>kubectl logs</div><div class=tab-nav-text>kubectl logs</div></div></button></div><div class=tab-content-container><div data-tab-item="kubectl logs" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector -n splunk</span></span></code></pre></div></div></div></div></div><p>Or use the installed <code>k9s</code> terminal UI.</p><p><a href=#image-4c6e3ac3fd9ffaf511e135f106d6bfc9 class=lightbox-link><img src=../en/other/hpa/1-deploy-otel/../images/k9s.png alt=k9s style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4c6e3ac3fd9ffaf511e135f106d6bfc9><img src=../en/other/hpa/1-deploy-otel/../images/k9s.png alt=k9s class=lightbox-image loading=lazy></a></p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Deleting a failed installation</div><div class=box-content><p>If you make an error installing the Splunk OpenTelemetry Collector you can start over by deleting the installation using:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>helm delete splunk-otel-collector -n splunk</span></span></code></pre></div></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=tour-of-the-kubernetes-navigator-v2>Tour of the Kubernetes Navigator v2</h1><h2 id=1-cluster-vs-workload-view>1. Cluster vs Workload View</h2><p>The Kubernetes Navigator offers you two separate use cases to view your Kubernetes data.</p><ul><li>The <strong>K8s workloads</strong> is focusing on providing information in regards to workloads a.k.a. <em>your deployments</em>.</li><li>The <strong>K8s nodes</strong> is focusing on providing insight into the performance of clusters, nodes, pods and containers.</li></ul><p>You will initially select either view depending on your need (you can switch between the view on the fly if required). The most common one we will use in this workshop is the workload view and we will focus on that specifically.</p><h3 id=11-finding-your-k8s-cluster-name>1.1 Finding your K8s Cluster name</h3><p>Your first task is to identify and find your own cluster. The cluster will be named after your EC2 instance name.</p><p>To confirm your EC2 instance name, look at the prompt of your EC2 instance. For example, if you are assigned the 7th EC2 instance, the prompt will show:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu@emea-ws-7 ~ $</span></span></code></pre></div><p>This means your cluster will be named: <code>emea-ws-7-k3s-cluster</code>. Please make a note of your cluster name as you will need this later in the workshop for filtering.</p><h2 id=2-workloads--workload-details-pane>2. Workloads & Workload Details Pane</h2><p>Go to the <strong>Infrastructure</strong> page in the Observability UI and select <strong>Kubernetes</strong>, this will offer you a set of Kubernetes services, one of them being the <strong>K8s workloads</strong> pane.</p><p>The pane will show a tiny graph giving you a bird&rsquo;s eye view of the load being handled across those Workloads. Also, if there are any alerts for one of the workloads, you will see a small alert indicator as shown in the image below.</p><p><a href=#image-29bcaeb13dd10ecaf9638dfddc75152d class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/K8s-Workloads.png alt=k8sWorkloads style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-29bcaeb13dd10ecaf9638dfddc75152d><img src=../en/other/hpa/2-check-new-navigator-short/../images/K8s-Workloads.png alt=k8sWorkloads class=lightbox-image loading=lazy></a></p><p>Click on the <strong>K8s workloads</strong> pane and you will be taken to the workload view.</p><p>Initially, you will see all the workloads for all clusters that are reported into your Observability Cloud Org. If an alert has fired for any of the workloads, it will be highlighted on the top right (as marked with a red stripe) in the image below. You can go directly to the alert by clicking it to expand it.</p><p><a href=#image-829de1a8c42bbeb99cf39a5417129820 class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-screen.png alt=Workloads style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-829de1a8c42bbeb99cf39a5417129820><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-screen.png alt=Workloads class=lightbox-image loading=lazy></a></p><p>Now, let&rsquo;s find your own cluster by filtering on the field <code>k8s.cluster.name</code> in the filter toolbar (as marked with a blue stripe).</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>You can enter a partial name into the search box, such as &rsquo;emea-ws-7*&rsquo;, to quickly find your Cluster.</p><p>Also, it&rsquo;s a very good idea to switch the default time from the default <strong>-3h</strong> back to last 15 minutes (<strong>-15m</strong>).</p></div></div><p><a href=#image-97d87331f3fde4b4fb49a3b4986fb99a class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-filter.png alt=Workloads style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-97d87331f3fde4b4fb49a3b4986fb99a><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-filter.png alt=Workloads class=lightbox-image loading=lazy></a></p><p>You should now just see information for your own cluster.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many workloads are running & how many namespaces are in your Cluster?</p></div></div><h3 id=21-using-the-navigator-selection-chart>2.1 Using the Navigator Selection chart</h3><p>The <strong>K8s workloads</strong> table is a common feature used across most of the Navigator&rsquo;s and will offer you a list view of the data you are viewing. In our case, it shows a list of <code>Pods Failed</code> grouped by <code>k8s.namespace.name</code>.</p><p><a href=#image-f875aa7f3a93b0be150aa26d91fdcba2 class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/workload-selection.png alt=k8s-workload-list style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f875aa7f3a93b0be150aa26d91fdcba2><img src=../en/other/hpa/2-check-new-navigator-short/../images/workload-selection.png alt=k8s-workload-list class=lightbox-image loading=lazy></a></p><p>Now let&rsquo;s change the list view to a heat map view by selecting either the Heat map icon or List icon in the upper-right corner of the screen (as marked with the purple line).</p><p>Changing this option will result in the following visualisation:</p><p><a href=#image-6ce04a9d125718640da91307630d2879 class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/heatmap.png alt=k8s-Heat-map style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6ce04a9d125718640da91307630d2879><img src=../en/other/hpa/2-check-new-navigator-short/../images/heatmap.png alt=k8s-Heat-map class=lightbox-image loading=lazy></a></p><p>In this view, you will note that each workload is now a colored square. These squares will change color according to the <strong>Color by</strong> option you selected, <em>as marked by the first green line</em> in the image above. The colors give a visual indication of health and/or usage. You can check the meaning by hovering over the <strong>legend</strong> exclamation icon <i class="fa-fw fas fa-exclamation-circle"></i>
bottom right of the heatmaps.</p><p>Another valuable option in this screen is <strong>Find Outliers</strong> which provides historical analytics of your clusters based on what is selected in the <strong>Color by</strong> dropdown.</p><p>Now, let&rsquo;s select the <strong>File system usage (bytes)</strong> from the <strong>Color by</strong> drop down box, then click on the <strong>Find outliers</strong> drop down <em>as marked by a yellow line</em> in the above image and make sure you change the <strong>Scope</strong> in the dialog to <strong>Per k8s.namespace.name</strong> and <strong>Deviation from Median</strong> as below:</p><p><a href=#image-22a05ef747d6c9d87475424df5f17f2d class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/set-find-outliers.png alt=k8s-Heat-map style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-22a05ef747d6c9d87475424df5f17f2d><img src=../en/other/hpa/2-check-new-navigator-short/../images/set-find-outliers.png alt=k8s-Heat-map class=lightbox-image loading=lazy></a></p><p>The <strong>Find outliers</strong> view is very useful when you need to view a selection of your workloads (or any service depending on the Navigator used) and quickly need to figure out if something has changed.</p><p>It will give you fast insight into items (workloads in our case) that are performing differently (both increased or decreased) which helps to make it easier to spot problems.</p><h3 id=22-the-deployment-overview-pane>2.2 The Deployment overview pane</h3><p>The Deployment overview pane gives you a quick insight of the status of your deployments. You can see at once if the pods of your deployments are Pending, Running, Succeeded, Failed or in an Unknown state.</p><p><a href=#image-f16b4e8a05c5b57065fc7b70e6404b79 class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-deployment-overview.png alt=k8s-workload-overview style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f16b4e8a05c5b57065fc7b70e6404b79><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-deployment-overview.png alt=k8s-workload-overview class=lightbox-image loading=lazy></a></p><ul><li><em>Running:</em> Pod is deployed and in a running state</li><li><em>Pending:</em> Waiting to be deployed</li><li><em>Succeeded:</em> Pod has been deployed and completed its job and is finished</li><li><em>Failed:</em> Containers in the pod have run and returned some kind of error</li><li><em>Unknown:</em> Kubernetes isn&rsquo;t reporting any of the known states. (This may be during the starting or stopping of pods, for example).</li></ul><p>You can expand the Workload name by hovering your mouse on it, in case the name is longer than the chart allows.</p><p><a href=#image-5fea249fcd40d2582f6802e11627c46b class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-hover.png alt=k8s-workload-hoover style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-5fea249fcd40d2582f6802e11627c46b><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-hover.png alt=k8s-workload-hoover class=lightbox-image loading=lazy></a></p><p>To filter to a specific workload, you can click on three dots <strong>&mldr;</strong> next to the workload name in the <strong>k8s.workload.name</strong> column and choose <strong>Filter</strong> from the dropdown box.</p><p><a href=#image-c869f110d6866062639a47ea7c050348 class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/workload-add-filter.png alt=workload-add-filter style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c869f110d6866062639a47ea7c050348><img src=../en/other/hpa/2-check-new-navigator-short/../images/workload-add-filter.png alt=workload-add-filter class=lightbox-image loading=lazy></a></p><p>This will add the selected workload to your filters. Try this for the <strong>splunk-otel-collector-k8s-cluster-receiver</strong> workload. It will then list a single workload in the <strong>splunk</strong> namespace.</p><p>The Heat map above will also filter down to a single coloured square. Click on the square to see more information about the workload.</p><p><a href=#image-1b019f396fbea8f3cba66e58d3a39b8c class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-detail.png alt=workload-add-filter style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1b019f396fbea8f3cba66e58d3a39b8c><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-detail.png alt=workload-add-filter class=lightbox-image loading=lazy></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What are the CPU request & CPU limit units for the otel-collector?</p></div></div><p>At this point you can drill into the information of the pods, but that is outside the scope of this workshop, for now reset your view by removing the filter for the <strong>splunk-otel-collector-k8s-cluster-receiver</strong> workload and setting the <strong>Color by</strong> option to <strong>Pods Running</strong>.</p><p><a href=#image-f433c49b98fa651e5d19f014927effe3 class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-remove-filter.png alt=workload-add-filter style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f433c49b98fa651e5d19f014927effe3><img src=../en/other/hpa/2-check-new-navigator-short/../images/k8s-workload-remove-filter.png alt=workload-add-filter class=lightbox-image loading=lazy></a></p><h2 id=3-navigator-sidebar>3. Navigator Sidebar</h2><p>Later in the workshop, you will deploy an Apache server into your cluster which will display an icon in the <strong>Navigator Sidebar</strong>.</p><p>In navigators for Kubernetes, you can track dependent services and containers in the navigator sidebar. To get the most out of the navigator sidebar you configure the services you want to track by configuring an extra dimension called <code>service.name</code>. For this workshop, we have already configured the <code>extraDimensions</code> in the collector configuration for monitoring Apache e.g.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extraDimensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service.name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><p>The Navigator Sidebar will expand and a link to the discovered service will be added as seen in the image below:</p><p><a href=#image-7a2ac4d25d7048ab08809d4ccb270241 class=lightbox-link><img src=../en/other/hpa/2-check-new-navigator-short/../images/pivotbar.png alt=pivotbar style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7a2ac4d25d7048ab08809d4ccb270241><img src=../en/other/hpa/2-check-new-navigator-short/../images/pivotbar.png alt=pivotbar class=lightbox-image loading=lazy></a></p><p>This will allow for easy switching between Navigators. The same applies for your Apache server instance, it will have a Navigator Sidebar allowing you to quickly jump back to the Kubernetes Navigator.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=deploying-phpapache>Deploying PHP/Apache</h1><h2 id=1--dns-and-services-in-kubernetes>1. DNS and Services in Kubernetes</h2><p>The Domain Name System (DNS) is a mechanism for linking various sorts of information with easy-to-remember names, such as IP addresses. Using a DNS system to translate request names into IP addresses makes it easy for end-users to reach their target domain name effortlessly.</p><p>Most Kubernetes clusters include an internal DNS service configured by default to offer a lightweight approach for service discovery. Even when Pods and Services are created, deleted, or shifted between nodes, built-in service discovery simplifies applications to identify and communicate with services on the Kubernetes clusters.</p><p>In short, the DNS system for Kubernetes will create a DNS entry for each Pod and Service. In general, a Pod has the following DNS resolution:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>pod-name.my-namespace.pod.cluster-domain.example</span></span></code></pre></div><p>For example, if a Pod in the <code>default</code> namespace has the Pod name <code>my_pod</code>, and the domain name for your cluster is <code>cluster.local</code>, then the Pod has a DNS name:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>my_pod.default.pod.cluster.local</span></span></code></pre></div><p>Any Pods exposed by a Service have the following DNS resolution available:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>my_pod.service-name.my-namespace.svc.cluster-domain.example</span></span></code></pre></div><p>More information can be found here : <a href=https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/ target=_blank>DNS for Service and Pods</a></p><h2 id=2-review-otel-receiver-for-phpapache>2. Review OTel receiver for PHP/Apache</h2><p>Inspect the YAML file <code>~/workshop/k3s/otel-apache.yaml</code> and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/otel-apache.yaml</span></span></code></pre></div><p>This file contains the configuration for the OpenTelemetry agent to monitor the PHP/Apache deployment.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>agent</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receiver_creator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>smartagent/apache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>rule</span><span class=p>:</span><span class=w> </span><span class=l>type == &#34;port&#34; &amp;&amp; pod.name matches &#34;apache&#34; &amp;&amp; port == 80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>collectd/apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>http://php-apache-svc.apache.svc.cluster.local/server-status?auto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>extraDimensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>service.name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><h2 id=3--observation-rules-in-the-opentelemetry-config>3. Observation Rules in the OpenTelemetry config</h2><p>The above file contains an observation rule for Apache using the OTel <code>receiver_creator</code>. This receiver can instantiate other receivers at runtime based on whether observed endpoints match a configured rule.</p><p>The configured rules will be evaluated for each endpoint discovered. If the rule evaluates to true, then the receiver for that rule will be started as configured against the matched endpoint.</p><p>In the file above we tell the OpenTelemetry agent to look for Pods that match the name <code>apache</code> and have port <code>80</code> open. Once found, the agent will configure an Apache receiver to read Apache metrics from the configured URL. Note, the K8s DNS based URL in the above YAML for the service.</p><p>To use the Apache configuration, you can upgrade the existing Splunk OpenTelemetry Collector Helm chart to use the <code>otel-apache.yaml</code> file with the following command:</p><div class=tab-panel data-tab-group=5f032f05178a682fa295783f074d3f76><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Helm Upgrade" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("5f032f05178a682fa295783f074d3f76","Helm Upgrade")'><div><div class=tab-nav-hidden>Helm Upgrade</div><div class=tab-nav-text>Helm Upgrade</div></div></button></div><div class=tab-content-container><div data-tab-item="Helm Upgrade" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.logsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.infrastructureMonitoringEventsEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--namespace splunk <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/splunk-defaults.yaml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-apache.yaml</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> NOTE</div><div class=box-content><p>The <strong>REVISION</strong> number of the deployment has changed, which is a helpful way to keep track of your changes.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Release &#34;splunk-otel-collector&#34; has been upgraded. Happy Helming!
</span></span><span class=line><span class=cl>NAME: splunk-otel-collector
</span></span><span class=line><span class=cl>LAST DEPLOYED: Tue Jan 31 16:57:22 2023
</span></span><span class=line><span class=cl>NAMESPACE: splunk
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 2
</span></span><span class=line><span class=cl>TEST SUITE: None</span></span></code></pre></div></div></div><h2 id=4-kubernetes-configmaps>4. Kubernetes ConfigMaps</h2><p>A ConfigMap is an object in Kubernetes consisting of key-value pairs which can be injected into your application. With a ConfigMap, you can separate configuration from your Pods.</p><p>Using ConfigMap, you can prevent hardcoding configuration data. ConfigMaps are useful for storing and sharing non-sensitive, unencrypted configuration information.</p><p>The OpenTelemetry collector/agent uses ConfigMaps to store the configuration of the agent and the K8s Cluster receiver. You can/will always verify the current configuration of an agent after a change by running the following commands:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm -n splunk</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many ConfigMaps are used by the collector?</p></div></div><p>When you have list of ConfigMaps from the namespace, select the one for the <code>otel-agent</code> and view it with the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get cm splunk-otel-collector-otel-agent -n splunk -o yaml</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> NOTE</div><div class=box-content><p>The option <code>-o yaml</code> will output the content of the ConfigMap in a readable YAML format.</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Is the configuration from <code>otel-apache.yaml</code> visible in the ConfigMap for the collector agent?</p></div></div><h2 id=5-review-phpapache-deployment-yaml>5. Review PHP/Apache deployment YAML</h2><p>Inspect the YAML file <code>~/workshop/k3s/php-apache.yaml</code> and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/php-apache.yaml</span></span></code></pre></div><p>This file contains the configuration for the PHP/Apache deployment and will create a new StatefulSet with a single replica of the PHP/Apache image.</p><p>A stateless application is one that does not care which network it is using, and it does not need permanent storage. Examples of stateless apps may include web servers such as Apache, Nginx, or Tomcat.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>updateStrategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RollingUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>serviceName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;php-apache-svc&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/splunk/php-apache:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;9Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;6&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache-svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><h2 id=6-deploy-phpapache>6. Deploy PHP/Apache</h2><p>Create an apache namespace then deploy the PHP/Apache application to the cluster.</p><p>Create the <code>apache</code> namespace:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace apache</span></span></code></pre></div><p>Deploy the PHP/Apache application:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/php-apache.yaml -n apache</span></span></code></pre></div><p>Ensure the deployment has been created:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get statefulset -n apache</span></span></code></pre></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What metrics for your Apache instance are being reported in the Apache Navigator?</p><p><strong>Tip:</strong> Use the Navigator Sidebar and click on the service name.</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Using Log Observer what is the issue with the PHP/Apache deployment?</p><p><strong>Tip:</strong> Adjust your <strong>Table settings</strong> by clicking on the cog to use only <code>object.involvedObject.name</code>, <code>object.message</code> and <code>k8s.cluster.name</code>. Make sure you unselect <code>_raw</code>!</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=fix-phpapache-issue>Fix PHP/Apache Issue</h1><h2 id=1-kubernetes-resources>1. Kubernetes Resources</h2><p>Especially in Production Kubernetes Clusters, CPU and Memory are considered precious resources. Cluster Operators will normally require you to specify the amount of CPU and Memory your Pod or Service will require in the deployment, so they can have the Cluster automatically manage on which Node(s) your solution will be placed.</p><p>You do this by placing a Resource section in the deployment of you application/Pod</p><p><strong>Example:</strong></p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>         </span><span class=c># Maximum amount of CPU &amp; memory for peek use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8&#34;</span><span class=w>      </span><span class=c># Maximum of 8 cores of CPU allowed at for peek use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;9Mi&#34;</span><span class=w> </span><span class=c># Maximum allowed 9Mb of memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>       </span><span class=c># Request are the expected amount of CPU &amp; memory for normal use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;6&#34;</span><span class=w>      </span><span class=c># Requesting 4 cores of a CPU</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span><span class=w> </span><span class=c># Requesting 4Mb of memory</span></span></span></code></pre></div><p>More information can be found here : <a href=https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/ target=_blank>Resource Management for Pods and Containers</a></p><p>If your application or Pod will go over the limits set in your deployment, Kubernetes will kill and restart your Pod to protect the other applications on the Cluster.</p><p>Another scenario that you will run into is when there is not enough Memory or CPU on a Node. In that case, the Cluster will try to reschedule your Pod(s) on a different Node with more space.</p><p>If that fails, or if there is not enough space when you deploy your application, the Cluster will put your workload/deployment in schedule mode until there is enough room on any of the available Nodes to deploy the Pods according their limits.</p><h2 id=2-fix-phpapache-deployment>2. Fix PHP/Apache Deployment</h2><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Before we start, let&rsquo;s check the current status of the PHP/Apache deployment. Under <strong>Alerts & Detectors</strong> which detector has fired? Where else can you find this information?</p></div></div><p>To fix the PHP/Apache StatefulSet, edit <code>~/workshop/k3s/php-apache.yaml</code> using the following commands to reduce the CPU resources:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim ~/workshop/k3s/php-apache.yaml</span></span></code></pre></div><p>Find the resources section and reduce the CPU limits to <strong>1</strong> and the CPU requests to <strong>0.5</strong>:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;9Mi&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;4Mi&#34;</span></span></span></code></pre></div><p>Save the changes youhave made. (Hint: Use <code>Esc</code> followed by <code>:wq!</code> to save your changes).</p><p>Now, we must delete the existing StatefulSet and re-create it. StatefulSets are immutable, so we must delete the existing one and re-create it with the new changes.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete statefulset php-apache -n apache</span></span></code></pre></div><p>Now, deploy your changes:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/php-apache.yaml -n apache</span></span></code></pre></div><h2 id=3-validate-the-changes>3. Validate the changes</h2><p>You can validate the changes have been applied by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe statefulset php-apache -n apache</span></span></code></pre></div><p>Validate the Pod is now running in Splunk Observability Cloud.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Is the <strong>Apache Web Servers</strong> dashboard showing any data now?</p><p><strong>Tip:</strong> Don&rsquo;t forget to use filters and time frames to narrow down your data.</p></div></div><p>Monitor the Apache web servers Navigator dashboard for a few minutes.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What is happening with the # Hosts reporting chart?</p></div></div><h2 id=4-fix-memory-issue>4. Fix memory issue</h2><p>If you navigate back to the Apache dashboard, you will notice that metrics are no longer coming in. We have another resource issue and this time we are Out of Memory. Let&rsquo;s edit the stateful set and increase the memory to what is shown in the image below:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl edit statefulset php-apache -n apache</span></span></code></pre></div><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>16Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>500m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>12Mi</span></span></span></code></pre></div><p>Save the changes you have made.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-exclamation"></i> Hint</div><div class=box-content><p><code>kubectl edit</code> will open the contents in the <code>vi</code> editor, use <code>Esc</code> followed by <code>:wq!</code> to save your changes.</p></div></div><p>Because StatefulSets are immutable, we must delete the existing Pod and let the StatefulSet re-create it with the new changes.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete pod php-apache-0 -n apache</span></span></code></pre></div><p>Validate the changes have been applied by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe statefulset php-apache -n apache</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=deploy-load-generator>Deploy Load Generator</h1><p>Now let&rsquo;s apply some load against the <code>php-apache</code> pod. To do this, you will need start a different Pod to act as a client. The container within the client Pod runs in an infinite loop, sending HTTP GETs to the <code>php-apache</code> service.</p><h2 id=1-review-loadgen-yaml>1. Review loadgen YAML</h2><p>Inspect the YAML file <code>~/workshop/k3s/loadgen.yaml</code> and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/loadgen.yaml</span></span></code></pre></div><p>This file contains the configuration for the load generator and will create a new ReplicaSet with a two replicas of the load generator image.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ReplicaSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>loadgen</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>infinite-calls</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>/bin/sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s2>&#34;while true; do wget -q -O- http://php-apache-svc.apache.svc.cluster.local; done&#34;</span></span></span></code></pre></div><h2 id=2-create-a-new-namespace>2. Create a new namespace</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl create namespace loadgen</span></span></code></pre></div><h2 id=3-deploy-the-loadgen-yaml>3. Deploy the loadgen YAML</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/loadgen.yaml --namespace loadgen</span></span></code></pre></div><p>Once you have deployed the load generator, you can see the Pods running in the <code>loadgen</code> namespace. Use previous similar commands to check the status of the Pods from the command line.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Which metrics in the Apache Navigator have now significantly increased?</p></div></div><h2 id=4-scale-the-load-generator>4. Scale the load generator</h2><p>A ReplicaSet is a process that runs multiple instances of a Pod and keeps the specified number of Pods constant. Its purpose is to maintain the specified number of Pod instances running in a cluster at any given time to prevent users from losing access to their application when a Pod fails or is inaccessible.</p><p>ReplicaSet helps bring up a new instance of a Pod when the existing one fails, scale it up when the running instances are not up to the specified number, and scale down or delete Pods if another instance with the same label is created. A ReplicaSet ensures that a specified number of Pod replicas are running continuously and helps with load-balancing in case of an increase in resource usage.</p><p>Let&rsquo;s scale our ReplicaSet to 4 replicas using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl scale replicaset/loadgen --replicas 4 -n loadgen</span></span></code></pre></div><p>Validate the replicas are running from both the command line and Splunk Observability Cloud:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl get replicaset loadgen -n loadgen</span></span></code></pre></div><p><a href=#image-d5f06a896dceb06c6c19f0032c1ab9be class=lightbox-link><img src=../en/other/hpa/5-deploy-loadgen/../images/k8s-workload-replicaset.png alt=Replicaset style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d5f06a896dceb06c6c19f0032c1ab9be><img src=../en/other/hpa/5-deploy-loadgen/../images/k8s-workload-replicaset.png alt=Replicaset class=lightbox-image loading=lazy></a></p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What impact can you see in the Apache Navigator?</p></div></div><p>Let the load generator run for around 2-3 minutes and keep observing the metrics in the Kubernetes Navigator and the Apache Navigator.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=setup-horizontal-pod-autoscaling-hpa>Setup Horizontal Pod Autoscaling (HPA)</h1><p>In Kubernetes, a HorizontalPodAutoscaler automatically updates a workload resource (such as a Deployment or StatefulSet), with the aim of automatically scaling the workload to match demand.</p><p>Horizontal scaling means that the response to increased load is to deploy more Pods. This is different from vertical scaling, which for Kubernetes would mean assigning more resources (for example: memory or CPU) to the Pods that are already running for the workload.</p><p>If the load decreases, and the number of Pods is above the configured minimum, the HorizontalPodAutoscaler instructs the workload resource (the Deployment, StatefulSet, or other similar resource) to scale back down.</p><h2 id=1-setup-hpa>1. Setup HPA</h2><p>Inspect the <code>~/workshop/k3s/hpa.yaml</code> file and validate the contents using the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/workshop/k3s/hpa.yaml</span></span></code></pre></div><p>This file contains the configuration for the Horizontal Pod Autoscaler and will create a new HPA for the <code>php-apache</code> deployment.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>autoscaling/v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HorizontalPodAutoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>apache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cpu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>75</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scaleTargetRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>StatefulSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>php-apache</span></span></span></code></pre></div><p>Once deployed, <code>php-apache</code> will autoscale when either the average CPU usage goes above 50% and average memory usage for the deployment goes above 75%, with a minimum of 1 pod and a maximum of 4 pods.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl apply -f ~/workshop/k3s/hpa.yaml</span></span></code></pre></div><h2 id=2-validate-hpa>2. Validate HPA</h2><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>kubectl get hpa -n apache</span></span></code></pre></div><p>Go to the <strong>Workloads</strong> or <strong>Node Detail</strong> tab in Kubernetes and check the HPA deployment.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>How many additional <code>php-apache-x</code> pods have been created?</p></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Which metrics in the Apache Navigator have significantly increased again?</p></div></div><h2 id=3-increase-the-hpa-replica-count>3. Increase the HPA replica count</h2><p>Increase the <code>maxReplicas</code> to 8</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl edit hpa php-apache -n apache</span></span></code></pre></div><p>Save the changes you have made. (Hint: Use <code>Esc</code> followed by <code>:wq!</code> to save your changes).</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Questions</div><div class=box-content><ol><li><p>How many pods are now in a running state?</p></li><li><p>How many are pending?</p></li><li><p>Why are they pending?</p></li></ol></div></div><p><strong>Congratulations!</strong> You have successfully completed the workshop.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=build-a-distributed-trace-in-lambda-and-kinesis>Build a Distributed Trace in Lambda and Kinesis</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
45 minutes</button></span><p>This workshop will equip you with how a distributed trace is constructed for a small serverless application that runs on AWS Lambda, producing and consuming a message via AWS Kinesis.</p><p>We will see how auto-instrumentation works with manual steps to force a Producer function&rsquo;s context to be sent to Consumer function via a Record put on a Kinesis stream.</p><p>For this workshop Splunk has prepared an Ubuntu Linux instance in AWS/EC2 all pre-configured for you.</p><p>To get access to the instance that you will be using in the workshop, please visit the URL provided by the workshop leader.d</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Build a Distributed Trace in Lambda and Kinesis</h1><article class=default><header class=headline></header><h1 id=setup>Setup</h1><p>This lab will make a tracing superhero out of you!</p><p>In this lab you will learn how a distributed trace is constructed for a small serverless application that runs on AWS Lambda, producing and consuming your message via AWS Kinesis.</p><p><a href=#image-0bdf02c5f1e00efee8bc9cfaa8feeae2 class=lightbox-link><img src=../en/other/lambda-kinesis/1-setup/../images/1-architecture.png alt=1-architecture style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0bdf02c5f1e00efee8bc9cfaa8feeae2><img src=../en/other/lambda-kinesis/1-setup/../images/1-architecture.png alt=1-architecture class=lightbox-image loading=lazy></a></p><h2 id=pre-requisites>Pre-requisites</h2><p>You should already have the lab content available on your EC2 lab host.</p><p>Ensure that this lab&rsquo;s required folder o11y-lambda-lab is on your home directory:</p><div class=tab-panel data-tab-group=b236c15270b501225b6bc1c085371e23><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("b236c15270b501225b6bc1c085371e23","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button>
<button data-tab-item=Output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b236c15270b501225b6bc1c085371e23","Output")'><div><div class=tab-nav-hidden>Output</div><div class=tab-nav-text>Output</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~ <span class=o>&amp;&amp;</span> ls</span></span></code></pre></div></div></div><div data-tab-item=Output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>o11y-lambda-lab</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>If you don&rsquo;t see it, fetch the lab contents by running the following command:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/kdroukman/o11y-lambda-lab.git</span></span></code></pre></div></div></div><h2 id=set-environment-variables>Set Environment Variables</h2><p>In your Splunk Observability Cloud Organisation (Org) obtain your Access Token and Realm Values.</p><p>Please reset your environment variables from the earlier lab. Take care that for this lab we may be using different names - make sure to match the Environment Variable names bellow.</p><div class=tab-panel data-tab-group=398b27673302c4bfa3e45efca8936991><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Export Environment Variables" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("398b27673302c4bfa3e45efca8936991","Export Environment Variables")'><div><div class=tab-nav-hidden>Export Environment Variables</div><div class=tab-nav-text>Export Environment Variables</div></div></button></div><div class=tab-content-container><div data-tab-item="Export Environment Variables" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>export ACCESS_TOKEN</span><span class=o>=</span><span class=s>CHANGE_ME \</span>
</span></span><span class=line><span class=cl><span class=na>export REALM</span><span class=o>=</span><span class=s>CHANGE_ME \</span>
</span></span><span class=line><span class=cl><span class=na>export PREFIX</span><span class=o>=</span><span class=s>$(hostname)</span></span></span></code></pre></div></div></div></div></div><h2 id=update-auto-instrumentation-serverless-template>Update Auto-instrumentation serverless template</h2><p>Update your auto-instrumentation Serverless template to include new values from the Enviornment variables.</p><div class=tab-panel data-tab-group=43cff07aa02241d126027475d6eb5840><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Substitute Environment Variables" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("43cff07aa02241d126027475d6eb5840","Substitute Environment Variables")'><div><div class=tab-nav-hidden>Substitute Environment Variables</div><div class=tab-nav-text>Substitute Environment Variables</div></div></button></div><div class=tab-content-container><div data-tab-item="Substitute Environment Variables" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-lab/auto/serverless_unset.yml <span class=p>|</span> envsubst &gt; ~/o11y-lambda-lab/auto/serverless.yml</span></span></code></pre></div></div></div></div></div><p>Examine the output of the updated serverless.yml contents (you may need to scroll up to the relevant section).</p><div class=tab-panel data-tab-group=fdc4ca338919d4731e8c7cd0fb271406><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Check file contents" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("fdc4ca338919d4731e8c7cd0fb271406","Check file contents")'><div><div class=tab-nav-hidden>Check file contents</div><div class=tab-nav-text>Check file contents</div></div></button>
<button data-tab-item="Expected Content" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("fdc4ca338919d4731e8c7cd0fb271406","Expected Content")'><div><div class=tab-nav-hidden>Expected Content</div><div class=tab-nav-text>Expected Content</div></div></button></div><div class=tab-content-container><div data-tab-item="Check file contents" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-lab/auto/serverless.yml</span></span></code></pre></div></div></div><div data-tab-item="Expected Content" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># USER SET VALUES =====================              </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>custom</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessToken</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Access Token&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>realm</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Realm&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Hostname&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#====================================== </span></span></span></code></pre></div></div></div></div></div><h2 id=update-manual-instrumentation-template>Update Manual instrumentation template</h2><p>Update your manual instrumentation Serverless template to include new values from the Enviornment variables.</p><div class=tab-panel data-tab-group=4a505e4c2e5f14e96d0fee43b3d5a6e3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Substitute Environment Variables" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("4a505e4c2e5f14e96d0fee43b3d5a6e3","Substitute Environment Variables")'><div><div class=tab-nav-hidden>Substitute Environment Variables</div><div class=tab-nav-text>Substitute Environment Variables</div></div></button></div><div class=tab-content-container><div data-tab-item="Substitute Environment Variables" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-lab/manual/serverless_unset.yml <span class=p>|</span> envsubst &gt; ~/o11y-lambda-lab/manual/serverless.yml</span></span></code></pre></div></div></div></div></div><p>Examine the output of the updated serverless.yml contents (you may need to scroll up to the relevant section).</p><div class=tab-panel data-tab-group=18b4cf6bdb880c116de8a0a0c1653f4f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Check file contents" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("18b4cf6bdb880c116de8a0a0c1653f4f","Check file contents")'><div><div class=tab-nav-hidden>Check file contents</div><div class=tab-nav-text>Check file contents</div></div></button>
<button data-tab-item="Expected Content" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("18b4cf6bdb880c116de8a0a0c1653f4f","Expected Content")'><div><div class=tab-nav-hidden>Expected Content</div><div class=tab-nav-text>Expected Content</div></div></button></div><div class=tab-content-container><div data-tab-item="Check file contents" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/o11y-lambda-lab/manual/serverless.yml</span></span></code></pre></div></div></div><div data-tab-item="Expected Content" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># USER SET VALUES =====================              </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>custom</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessToken</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Access Token&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>realm</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Realm&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=l>&lt;updated to your Hostname&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>#====================================== </span></span></span></code></pre></div></div></div></div></div><h2 id=set-your-aws-credentials>Set your AWS Credentials</h2><p>You will be provided with AWS Access Key ID and AWS Secret Access Key values - substitue these values in place of AWS_ACCESS_KEY_ID and AWS_ACCESS_KEY_SECRET in the bellow command:</p><div class=tab-panel data-tab-group=f1aa2aee368c4c88725d63fe5eae9647><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Set AWS Credentials" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("f1aa2aee368c4c88725d63fe5eae9647","Set AWS Credentials")'><div><div class=tab-nav-hidden>Set AWS Credentials</div><div class=tab-nav-text>Set AWS Credentials</div></div></button></div><div class=tab-content-container><div data-tab-item="Set AWS Credentials" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls config credentials --provider aws --key AWS_ACCCESS_KEY_ID --secret AWS_ACCESS_KEY_SECRET</span></span></code></pre></div></div></div></div></div><p>This command will create a file <code>~/.aws/credentials</code> with your AWS Credentials populated.</p><p>Note that we are using sls here, which is a Serverless framework for developing and deploying AWS Lambda functions. We will be using this command throughout the lab.</p><p>Now you are set up and ready go!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=auto-instrumentation>Auto-Instrumentation</h1><h2 id=auto-instrumentation>Auto-Instrumentation</h2><p>Navigate to the auto directory that contains auto-instrumentation code.</p><div class=tab-panel data-tab-group=dd7b07f27b3f471f869104d4b546382a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("dd7b07f27b3f471f869104d4b546382a","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>cd ~/o11y-lambda-lab/auto</code></pre></div></div></div></div></div><p>Inspect the contents of the files in this directory. Take a look at the serverless.yml template.</p><div class=tab-panel data-tab-group=57eff609e9b6bf0ef6552c7817f5e7b4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("57eff609e9b6bf0ef6552c7817f5e7b4","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>cat serverless.yml</code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><ul><li>Can you identify which AWS entities are being created by this template?</li><li>Can you identify where OpenTelemetry instrumentation is being set up?</li><li>Can you determine which instrumentation information is being provided by the Environment Variables?</li></ul></div></div><p>You should see the Splunk OpenTelemetry Lambda layer being added to each fuction.</p><div class="wrap-code highlight"><pre tabindex=0><code>layers:
      - arn:aws:lambda:us-east-1:254067382080:layer:splunk-apm:70</code></pre></div><p>You can see the relevant layer ARNs (Amazon Resource Name) and latest versions for each AWS region here: <a href=https://github.com/signalfx/lambda-layer-versions/blob/main/splunk-apm/splunk-apm.md target=_blank>https://github.com/signalfx/lambda-layer-versions/blob/main/splunk-apm/splunk-apm.md</a></p><p>You should also see a section where the Environment variables that are being set.</p><div class="wrap-code highlight"><pre tabindex=0><code>environment:
  AWS_LAMBDA_EXEC_WRAPPER: /opt/nodejs-otel-handler
  OTEL_RESOURCE_ATTRIBUTES: deployment.environment=${self:custom.prefix}-apm-lambda
  OTEL_SERVICE_NAME: consumer-lambda
  SPLUNK_ACCESS_TOKEN: ${self:custom.accessToken}
  SPLUNK_REALM: ${self:custom.realm}</code></pre></div><p>Using the environment variables we are configuring and enriching our auto-instrumentation.</p><p>Here we provide minimum information, such as NodeJS wrapper location in the Splunk APM Layer, environment name, service name, and our Splunk Org credentials. We are sending trace data directly to Splunk Observability Cloud. You could alternatively export traces to an OpenTelemetry Collector set up in Gateway mode.</p><p>Take a look at the function code.</p><div class=tab-panel data-tab-group=c392f81ead5275e50150616b93ca31fe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c392f81ead5275e50150616b93ca31fe","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>cat handler.js</code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><ul><li>Can you identify the code for producer function?</li><li>Can you identify the code for consumer function?</li></ul></div></div><p>Notice there is no mention of Splunk or OpenTelemetry in the code. We are adding the instrumentation using the Lambda layer and Environment Variables only.</p><h2 id=deploy-your-lambdas>Deploy your Lambdas</h2><p>Run the following command to deploy your Lambda Functions:</p><div class=tab-panel data-tab-group=c5e96b46349159f96b58fd1b2ee26b77><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Deploy Command" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c5e96b46349159f96b58fd1b2ee26b77","Deploy Command")'><div><div class=tab-nav-hidden>Deploy Command</div><div class=tab-nav-text>Deploy Command</div></div></button>
<button data-tab-item="Expected Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c5e96b46349159f96b58fd1b2ee26b77","Expected Output")'><div><div class=tab-nav-hidden>Expected Output</div><div class=tab-nav-text>Expected Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Deploy Command" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>sls deploy</code></pre></div></div></div><div data-tab-item="Expected Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>Deploying hostname-lambda-lab to stage dev (us-east-1)
...
...
endpoint: POST - https://randomstring.execute-api.us-east-1.amazonaws.com/dev/producer
functions:
  producer: hostname-lambda-lab-dev-producer (1.6 kB)
  consumer: hostname-lambda-lab-dev-consumer (1.6 kB)</code></pre></div></div></div></div></div><p>This command will follow the instructions in your serverless.yml template to create your Lambda functions and your Kinesis stream. Note it may take a 1-2 minutes to execute.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>serverless.yml is in fact a CloudFormation template. CloudFormation is an infrastructure as code service from AWS. You can read more about it here - <a href=https://aws.amazon.com/cloudformation/ target=_blank>https://aws.amazon.com/cloudformation/</a></div></div><p>Check the details of your serverless functions:</p><div class=tab-panel data-tab-group=bc703990497d26f7af1710f2961d4fb0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("bc703990497d26f7af1710f2961d4fb0","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>sls info</code></pre></div></div></div></div></div><p>Take note of your endpoint value:
<a href=#image-2a911e0b0bf91b6dc90fb6432f04b987 class=lightbox-link><img src=../en/other/lambda-kinesis/2-auto-instrumentation/../images/2-auto-1-endpoint-value.png alt=2-auto-1-endpoint-value style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2a911e0b0bf91b6dc90fb6432f04b987><img src=../en/other/lambda-kinesis/2-auto-instrumentation/../images/2-auto-1-endpoint-value.png alt=2-auto-1-endpoint-value class=lightbox-image loading=lazy></a></p><h2 id=send-some-traffic>Send some Traffic</h2><p>Use the curl command to send a payload to your producer function. Note the command option -d is followed by your message payload.</p><p>Try changing the value of name to your name and telling the Lambda function about your superpower. Replace YOUR_ENDPOINT with the endpoint from your previous step.</p><div class=tab-panel data-tab-group=9cfd91edb2b06eeae158d9e771d61782><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("9cfd91edb2b06eeae158d9e771d61782","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>curl -d &#39;{ &#34;name&#34;: &#34;CHANGE_ME&#34;, &#34;superpower&#34;: &#34;CHANGE_ME&#34; }&#39; YOUR_ENDPOINT</code></pre></div></div></div></div></div><p>For example:</p><div class="wrap-code highlight"><pre tabindex=0><code>curl -d &#39;{ &#34;name&#34;: &#34;Kate&#34;, &#34;superpower&#34;: &#34;Distributed Tracing&#34; }&#39; https://xvq043lj45.execute-api.us-east-1.amazonaws.com/dev/producer</code></pre></div><p>You should see the following output if your message is successful:</p><div class="wrap-code highlight"><pre tabindex=0><code>{&#34;message&#34;:&#34;Message placed in the Event Stream: hostname-eventSteam&#34;}</code></pre></div><p>If unsuccessful, you will see:</p><div class="wrap-code highlight"><pre tabindex=0><code>{&#34;message&#34;: &#34;Internal server error&#34;}</code></pre></div><p>If this occurs, ask one of the lab facilitators for assistance.</p><p>If you see a success message, generate more load: re-send that messate 5+ times. You should keep seeing a success message after each send.</p><p>Check the lambda logs output:</p><p>Producer function logs:</p><div class=tab-panel data-tab-group=920ce03dfd7ed2310314bf277ae9d3d9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Producer Function Logs" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("920ce03dfd7ed2310314bf277ae9d3d9","Producer Function Logs")'><div><div class=tab-nav-hidden>Producer Function Logs</div><div class=tab-nav-text>Producer Function Logs</div></div></button></div><div class=tab-content-container><div data-tab-item="Producer Function Logs" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>sls logs -f producer</code></pre></div></div></div></div></div><p>Consumer function logs:</p><div class=tab-panel data-tab-group=1042563f6bedc8bbbf0773f41a8c7e48><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Consumer Function Logs" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("1042563f6bedc8bbbf0773f41a8c7e48","Consumer Function Logs")'><div><div class=tab-nav-hidden>Consumer Function Logs</div><div class=tab-nav-text>Consumer Function Logs</div></div></button></div><div class=tab-content-container><div data-tab-item="Consumer Function Logs" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0><code>sls logs -f consumer</code></pre></div></div></div></div></div><p>Examine the logs carefully.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Do you see OpenTelemetry being loaded? Look out for lines with splunk-extension-wrapper.</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=lambdas-in-splunk-apm>Lambdas in Splunk APM</h1><h2 id=lambdas-in-splunk-apm>Lambdas in Splunk APM</h2><p>Now it&rsquo;s time to check how your Lambda traffic has been captured in Splunk APM.</p><h2 id=navigate-to-your-splunk-observability-cloud>Navigate to your Splunk Observability Cloud</h2><p>Select APM from the Main Menu and then select your APM Environment. Your APM environment should be in the format <code>$(hostname)-apm-lambda</code> where the hostname value is a four letter name of your lab host. (Check it by looking at your command prompt, or by running <code>echo $(hostname)</code>).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p>It may take a few minutes for you traces to appear in Splunk APM. Try hitting refresh on your browser until you find your environement name in the list of Envrionments</div></div><p><a href=#image-b3d82970b73ffe8dee1854eb159a4f93 class=lightbox-link><img src=../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-1-filter.png alt=3-splunk-1-filter style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b3d82970b73ffe8dee1854eb159a4f93><img src=../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-1-filter.png alt=3-splunk-1-filter class=lightbox-image loading=lazy></a></p><p>Go to <code>Explore</code> the Service Map to see the Dependencies between your Lambda Functions.</p><p><a href=#image-ea2a55cb29bbbad22f63305089822d2c class=lightbox-link><img src=../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-2-explore.png alt=3-splunk-2-explore style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-ea2a55cb29bbbad22f63305089822d2c><img src=../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-2-explore.png alt=3-splunk-2-explore class=lightbox-image loading=lazy></a></p><p>You should be able to see the <code>producer-lambda</code> and the call it is making to <code>Kinesis</code> service.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>What about your <code>consumer-lambda</code>?</p></div></div><p><a href=#image-0f90de59a303de2076d004836e3ef94e class=lightbox-link><img src=../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-3-map-producer.png alt=3-splunk-3-map-producer style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0f90de59a303de2076d004836e3ef94e><img src=../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-3-map-producer.png alt=3-splunk-3-map-producer class=lightbox-image loading=lazy></a></p><p>Click into <code>Traces</code> and examine some traces that container procuder function calls and traces with consumer function calls.</p><p><a href=#image-2d3b5237157039bcdcbacb47609edf69 class=lightbox-link><img src=../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-4-trace-producer.png alt=3-splunk-4-trace-producer.png style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2d3b5237157039bcdcbacb47609edf69><img src=../en/other/lambda-kinesis/3-lambdas-in-splunk/../images/3-splunk-4-trace-producer.png alt=3-splunk-4-trace-producer.png class=lightbox-image loading=lazy></a></p><p>We can see the <code>producer-lambda</code> putting a Record on the Kinesis stream. But the action of <code>consumer-function</code> is disconnected!</p><p>This is because the Trace Context is not being propagated.</p><p>This is not something that is supported automatically Out-of-the-Box by Kinesis service at the time of this lab. Our Distributed Trace stops at Kinesis inferred service, and we can&rsquo;t see the propagation any further.</p><p>Not yet&mldr;</p><p>Let&rsquo;s see how we work around this in the next section of this lab.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=manual-instrumentation>Manual Instrumentation</h1><h2 id=manual-instrumentation>Manual Instrumentation</h2><p>Navigate to the manual directory that contains manually instrumentated code.</p><div class=tab-panel data-tab-group=d6e0fa8d84847729c65ac34a0a60b18c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("d6e0fa8d84847729c65ac34a0a60b18c","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/o11y-lambda-lab/manual</span></span></code></pre></div></div></div></div></div><p>Inspect the contents of the files in this directory. Take a look at the serverless.yml template.</p><div class=tab-panel data-tab-group=db406f9cad2e731ddfd3fe48f23bf0fe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("db406f9cad2e731ddfd3fe48f23bf0fe","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat serverless.yml</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Do you see any difference from the same file in your auto directory?</p></div></div><p>You can try to compare them with a diff command:</p><div class=tab-panel data-tab-group=679fb42015eb0044bbe0d9b19f33e88a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Diff Command" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("679fb42015eb0044bbe0d9b19f33e88a","Diff Command")'><div><div class=tab-nav-hidden>Diff Command</div><div class=tab-nav-text>Diff Command</div></div></button>
<button data-tab-item="Expected Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("679fb42015eb0044bbe0d9b19f33e88a","Expected Output")'><div><div class=tab-nav-hidden>Expected Output</div><div class=tab-nav-text>Expected Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Diff Command" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>diff ~/o11y-lambda-lab/auto/serverless.yml ~/o11y-lambda-lab/manual/serverless.yml </span></span></code></pre></div></div></div><div data-tab-item="Expected Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>19c19
</span></span><span class=line><span class=cl>&lt; #======================================    
</span></span><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>&gt; #======================================   </span></span></code></pre></div></div></div></div></div><p>There is no difference! (Well, there shouldn&rsquo;t be. Ask your lab facilitator to assist you if there is)</p><p>Now compare handler.js it with the same file in auto directory using the diff command:</p><div class=tab-panel data-tab-group=3eb0d8a707a03b041173184e335c1f10><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Diff Command" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("3eb0d8a707a03b041173184e335c1f10","Diff Command")'><div><div class=tab-nav-hidden>Diff Command</div><div class=tab-nav-text>Diff Command</div></div></button></div><div class=tab-content-container><div data-tab-item="Diff Command" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>diff ~/o11y-lambda-lab/auto/handler.js ~/o11y-lambda-lab/manual/handler.js </span></span></code></pre></div></div></div></div></div><p>Look at all these differences!</p><p>You may wish to view the entire file with <code>cat handler.js</code> command and examine its content.</p><p>Notice how we are now importing some OpenTelemetry libraries directly into our function to handle some of the manual instrumenation tasks we require.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>otelapi</span>  <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@opentelemetry/api&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>otelcore</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@opentelemetry/core&#39;</span><span class=p>);</span></span></span></code></pre></div><p>We are using <a href=https://www.npmjs.com/package/@opentelemetry/api target=_blank>https://www.npmjs.com/package/@opentelemetry/api</a> to manipulate the tracing logic in our functions. We are using <a href=https://www.npmjs.com/package/@opentelemetry/core target=_blank>https://www.npmjs.com/package/@opentelemetry/core</a> to access the Propagator objects that we will use to manually propagate our context with.</p><h2 id=inject-trace-context-in-producer-function>Inject Trace Context in Producer Function</h2><p>The below code executes the following steps inside the Producer function:</p><ol><li>Get the current Active Span.</li><li>Create a Propagator.</li><li>Initialize a context carrier object.</li><li>Inject the context of the active span into the carrier object.</li><li>Modify the record we are about to put on our Kinesis stream to include the carrier that will carry the active span&rsquo;s context to the consumer.</li></ol><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>activeSpan</span> <span class=o>=</span> <span class=nx>otelapi</span><span class=p>.</span><span class=nx>trace</span><span class=p>.</span><span class=nx>getSpan</span><span class=p>(</span><span class=nx>otelapi</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>active</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>propagator</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>otelcore</span><span class=p>.</span><span class=nx>W3CTraceContextPropagator</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>carrier</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=nx>propagator</span><span class=p>.</span><span class=nx>inject</span><span class=p>(</span><span class=nx>otelapi</span><span class=p>.</span><span class=nx>trace</span><span class=p>.</span><span class=nx>setSpanContext</span><span class=p>(</span><span class=nx>otelapi</span><span class=p>.</span><span class=nx>ROOT_CONTEXT</span><span class=p>,</span> <span class=nx>activeSpan</span><span class=p>.</span><span class=nx>spanContext</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>    <span class=nx>carrier</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>otelapi</span><span class=p>.</span><span class=nx>defaultTextMapSetter</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=s2>&#34;{\&#34;tracecontext\&#34;: &#34;</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>carrier</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;, \&#34;record\&#34;:&#34;</span> <span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>body</span> <span class=o>+</span> <span class=s2>&#34;}&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Record with Trace Context added: 
</span></span></span><span class=line><span class=cl><span class=sb>  </span><span class=si>${</span><span class=nx>data</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span></span></span></code></pre></div><h2 id=extract-trace-context-in-consumer-function>Extract Trace Context in Consumer Function</h2><p>The bellow code executes the following steps inside the Consumer function:</p><ol><li>Extract the context that we obtained from the Producer into a carrier object.</li><li>Create a Propagator.</li><li>Extract the context from the carrier object in Customer function&rsquo;s parent span context.</li><li>Start a new span with the parent span context.</li><li>Bonus: Add extra attributes to your span, including custom ones with the values from your message!</li><li>Once completed, end the span.</li></ol><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>carrier</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span> <span class=nx>message</span> <span class=p>).</span><span class=nx>tracecontext</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>propagator</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>otelcore</span><span class=p>.</span><span class=nx>W3CTraceContextPropagator</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>parentContext</span> <span class=o>=</span> <span class=nx>propagator</span><span class=p>.</span><span class=nx>extract</span><span class=p>(</span><span class=nx>otelapi</span><span class=p>.</span><span class=nx>ROOT_CONTEXT</span><span class=p>,</span> <span class=nx>carrier</span><span class=p>,</span> <span class=nx>otelapi</span><span class=p>.</span><span class=nx>defaultTextMapGetter</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>tracer</span> <span class=o>=</span> <span class=nx>otelapi</span><span class=p>.</span><span class=nx>trace</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>OTEL_SERVICE_NAME</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>span</span> <span class=o>=</span> <span class=nx>tracer</span><span class=p>.</span><span class=nx>startSpan</span><span class=p>(</span><span class=s2>&#34;Kinesis.getRecord&#34;</span><span class=p>,</span> <span class=kc>undefined</span><span class=p>,</span> <span class=nx>parentContext</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                         
</span></span><span class=line><span class=cl><span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;span.kind&#34;</span><span class=p>,</span> <span class=s2>&#34;server&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>body</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span> <span class=nx>message</span> <span class=p>).</span><span class=nx>record</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;custom.tag.name&#34;</span><span class=p>,</span> <span class=nx>body</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=k>if</span> <span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>superpower</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>span</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s2>&#34;custom.tag.superpower&#34;</span><span class=p>,</span> <span class=nx>body</span><span class=p>.</span><span class=nx>superpower</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>---</span> <span class=kd>function</span> <span class=nx>does</span> <span class=nx>some</span> <span class=nx>work</span>
</span></span><span class=line><span class=cl> <span class=nx>span</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span></span></span></code></pre></div><p>Now let&rsquo;s see the difference this makes.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=redeploy-lambdas>Redeploy Lambdas</h1><h2 id=re-deploy-your-lambdas>Re-deploy your Lambdas</h2><p>While remaining in your manual directory, run the following commandd to re-deploy your Lambda Functions:</p><div class=tab-panel data-tab-group=56a1ddec260749c9b01e9e6965d90e43><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Deploy Producer Code" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("56a1ddec260749c9b01e9e6965d90e43","Deploy Producer Code")'><div><div class=tab-nav-hidden>Deploy Producer Code</div><div class=tab-nav-text>Deploy Producer Code</div></div></button>
<button data-tab-item="Expected Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("56a1ddec260749c9b01e9e6965d90e43","Expected Output")'><div><div class=tab-nav-hidden>Expected Output</div><div class=tab-nav-text>Expected Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Deploy Producer Code" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls deploy -f producer</span></span></code></pre></div></div></div><div data-tab-item="Expected Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Deploying function producer to stage dev (us-east-1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>‚úî Function code deployed (6s)
</span></span><span class=line><span class=cl>Configuration did not change. Configuration update skipped. (6s)</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=00d869896c0f09229f2a3fc4b19f1ad2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Deploy Consumer Code" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("00d869896c0f09229f2a3fc4b19f1ad2","Deploy Consumer Code")'><div><div class=tab-nav-hidden>Deploy Consumer Code</div><div class=tab-nav-text>Deploy Consumer Code</div></div></button>
<button data-tab-item="Expected Output" class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("00d869896c0f09229f2a3fc4b19f1ad2","Expected Output")'><div><div class=tab-nav-hidden>Expected Output</div><div class=tab-nav-text>Expected Output</div></div></button></div><div class=tab-content-container><div data-tab-item="Deploy Consumer Code" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls deploy -f consumer</span></span></code></pre></div></div></div><div data-tab-item="Expected Output" class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Deploying function consumer to stage dev (us-east-1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>‚úî Function code deployed (6s)
</span></span><span class=line><span class=cl>Configuration did not change. Configuration update skipped. (6s)</span></span></code></pre></div></div></div></div></div><p>Note that this deployment now only updates the code changes within the function. Our configuration remains the same.</p><p>Check the details of your serverless functions:</p><div class=tab-panel data-tab-group=2906c7804f8f81eaf20ed01972641d34><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("2906c7804f8f81eaf20ed01972641d34","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls info</span></span></code></pre></div></div></div></div></div><p>You endpoint value should remain the same:</p><p><a href=#image-d3f187b250e342fcda657601938dcc26 class=lightbox-link><img src=../en/other/lambda-kinesis/5-redeploy-lambdas/../images/5-redeploy-1-endpoint-value.png alt=5-redeploy-1-endpoint-value style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d3f187b250e342fcda657601938dcc26><img src=../en/other/lambda-kinesis/5-redeploy-lambdas/../images/5-redeploy-1-endpoint-value.png alt=5-redeploy-1-endpoint-value class=lightbox-image loading=lazy></a></p><h2 id=send-some-traffic-again>Send some Traffic again</h2><p>Use the <code>curl</code> command to send a payload to your producer function. Note the command option <code>-d</code> is followed by your message payload.</p><p>Try changing the value of name to your name and telling the Lambda function about your superpower. Replace <code>YOUR_ENDPOINT</code> with the endpoint from your previous step.</p><div class=tab-panel data-tab-group=6b08a871df97642fd0dd30e60486953c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=Command class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("6b08a871df97642fd0dd30e60486953c","Command")'><div><div class=tab-nav-hidden>Command</div><div class=tab-nav-text>Command</div></div></button></div><div class=tab-content-container><div data-tab-item=Command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -d <span class=s1>&#39;{ &#34;name&#34;: &#34;CHANGE_ME&#34;, &#34;superpower&#34;: &#34;CHANGE_ME&#34; }&#39;</span> YOUR_ENDPOINT</span></span></code></pre></div></div></div></div></div><p>For example:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -d <span class=s1>&#39;{ &#34;name&#34;: &#34;Kate&#34;, &#34;superpower&#34;: &#34;Distributed Tracing&#34; }&#39;</span> https://xvq043lj45.execute-api.us-east-1.amazonaws.com/dev/producer</span></span></code></pre></div><p>You should see the following output if your message is successful:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;Message placed in the Event Stream: hostname-eventSteam&#34;</span><span class=p>}</span></span></span></code></pre></div><p>If unsuccessful, you will see:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Internal server error&#34;</span><span class=p>}</span></span></span></code></pre></div><p>If this occurs, ask one of the lab facilitators for assistance.</p><p>If you see a success message, generate more load: re-send that messate 5+ times. You should keep seeing a success message after each send.</p><p>Check the lambda logs output:</p><div class=tab-panel data-tab-group=a6334d49de1bb06299bf028264734670><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Producer Function Logs" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("a6334d49de1bb06299bf028264734670","Producer Function Logs")'><div><div class=tab-nav-hidden>Producer Function Logs</div><div class=tab-nav-text>Producer Function Logs</div></div></button></div><div class=tab-content-container><div data-tab-item="Producer Function Logs" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls logs -f producer</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=0a6b8f1d02517e7213bde66b568c462e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Consumer Function Logs" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("0a6b8f1d02517e7213bde66b568c462e","Consumer Function Logs")'><div><div class=tab-nav-hidden>Consumer Function Logs</div><div class=tab-nav-text>Consumer Function Logs</div></div></button></div><div class=tab-content-container><div data-tab-item="Consumer Function Logs" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls logs -f consumer</span></span></code></pre></div></div></div></div></div><p>Examine the logs carefully.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Do you notice the difference?</p></div></div><p>Note that we are logging our Record together with the Trace context that we have added to it. Copy one of the underlined sub-sections of your trace parent context, and save it for later.</p><p><a href=#image-a38a3114f5b1931ef4a9922598502d9d class=lightbox-link><img src=../en/other/lambda-kinesis/5-redeploy-lambdas/../images/5-redeploy-2-logs.png alt=5-redeploy-2-logs style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a38a3114f5b1931ef4a9922598502d9d><img src=../en/other/lambda-kinesis/5-redeploy-lambdas/../images/5-redeploy-2-logs.png alt=5-redeploy-2-logs class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=updated-lambdas-in-splunk-apm>Updated Lambdas in Splunk APM</h1><p>Navigate back to APM in <a href=https://app.us1.signalfx.com/#/apm target=_blank>Splunk Observabilty Cloud</a></p><p>Go back to your Service Dependency map.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Notice the difference?</p></div></div><p><a href=#image-32263d7faaa6b56ef92457356ad275da class=lightbox-link><img src=../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-1-map.png alt=6-updated-1-map style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-32263d7faaa6b56ef92457356ad275da><img src=../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-1-map.png alt=6-updated-1-map class=lightbox-image loading=lazy></a></p><p>You should be able to see the <code>consumer-lambda</code> now clearly connected to the <code>producer-lambda</code>.</p><p>Remember the value you copied from your producer logs? You can run <code>sls logs -f consumer</code> command again on your EC2 lab host to fetch one.</p><p>Take that value, and paste it into trace search:</p><p><a href=#image-06ee5f2920216707234dc53b9f1752be class=lightbox-link><img src=../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-2-trace-search.png alt=6-updated-2-trace-search style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-06ee5f2920216707234dc53b9f1752be><img src=../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-2-trace-search.png alt=6-updated-2-trace-search class=lightbox-image loading=lazy></a></p><p>Click on Go and you should be able to find the logged Trace:</p><p><a href=#image-d886fb08f8887a706068f22ad3aec7d5 class=lightbox-link><img src=../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-3-trace.png alt=6-updated-3-trace style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d886fb08f8887a706068f22ad3aec7d5><img src=../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-3-trace.png alt=6-updated-3-trace class=lightbox-image loading=lazy></a></p><p>Notice that the <code>Trace ID</code> is something that makes up the trace context that we propagated.</p><p>You can read up on the two common propagation standards:</p><ol><li>W3C: <a href=https://www.w3.org/TR/trace-context/#traceparent-header target=_blank>https://www.w3.org/TR/trace-context/#traceparent-header</a></li><li>B3: <a href=https://github.com/openzipkin/b3-propagation#overall-process target=_blank>https://github.com/openzipkin/b3-propagation#overall-process</a></li></ol><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Which one are we using?</p></div></div><p>It should be self-explanatory from the Propagator we are creating in the Functions</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Bonus Question: What happens if we mix and match the W3C and B3 headers?</p></div></div><p>Expand the <code>consumer-lambda</code> span.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-question"></i> Workshop Question</div><div class=box-content><p>Can you find the attributes from your message?</p></div></div><p><a href=#image-546b0fbac2e2155f03652f14cb34d752 class=lightbox-link><img src=../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-4-attributes.png alt=6-updated-4-attributes style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-546b0fbac2e2155f03652f14cb34d752><img src=../en/other/lambda-kinesis/6-updated-in-splunk/../images/6-updated-4-attributes.png alt=6-updated-4-attributes class=lightbox-image loading=lazy></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><h2 id=before-you-go>Before you Go</h2><p>Please kindly clean up your lab using the following command:</p><div class=tab-panel data-tab-group=c45c1de3a354d4e516964df9d478cd83><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item="Remove Functions" class="tab-nav-button tab-panel-style cstyle initial active" onclick='switchTab("c45c1de3a354d4e516964df9d478cd83","Remove Functions")'><div><div class=tab-nav-hidden>Remove Functions</div><div class=tab-nav-text>Remove Functions</div></div></button></div><div class=tab-content-container><div data-tab-item="Remove Functions" class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sls remove</span></span></code></pre></div></div></div></div></div><h2 id=conclusion>Conclusion</h2><p>Congratuations on finishing the lab. You have seen how we complement auto-instrumentation with manual steps to force <code>Producer</code> function&rsquo;s context to be sent to <code>Consumer</code> function via a Record put on a Kinesis stream. This allowed us to build the expected Distributed Trace.</p><p><a href=#image-d7fa4a77ca79f97cb6459066ed5ca8cf class=lightbox-link><img src=../en/other/lambda-kinesis/7-summary/../images/7-conclusion-1-architecture.png alt=7-conclusion-1-architecture style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-d7fa4a77ca79f97cb6459066ed5ca8cf><img src=../en/other/lambda-kinesis/7-summary/../images/7-conclusion-1-architecture.png alt=7-conclusion-1-architecture class=lightbox-image loading=lazy></a></p><p>You can now build out a Trace manually by linking two different functions together. This is very powerful when your auto-instrumenation, or third-party systems, do not support context propagation out of the box.</p><footer class=footline></footer></article></section><article class=default><header class=headline></header><h1 id=improving-mttr-with-custom-tags>Improving MTTR with Custom Tags</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
45 minutes</button></span><p>This workshop will ..</p><p>For this workshop Splunk has prepared an Ubuntu Linux instance in AWS/EC2 all pre-configured for you.</p><p>To get access to the instance that you will be using in the workshop, please visit the URL provided by the workshop leader.</p><h2 id=splunk-observability-cloud>Splunk Observability Cloud</h2><p>You must have the ability to send traces to Splunk Observability Cloud. If you do not have an account already, please start a trial here: <a href=https://www.splunk.com/en_us/download/apm-free-trial.html target=_blank>https://www.splunk.com/en_us/download/apm-free-trial.html</a></p><h2 id=workshop-story>Workshop Story</h2><p>Here at Splunk Instruments, our business is expanding!</p><p>We have recently added 3 new locations: Two locations in the USA (Colorado and Chicago) and one international location in Sri Lanka.</p><p>Our technical staff has already on-boarded the data from these new locations and incorporated them into our inventory application and it is our job to review these improvements and send any issues back to our developers for repairs.</p><p>We now have a total of 6 locations!</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Improving MTTR with Custom Tags</h1><article class=default><header class=headline></header><h1 id=setting-up-your-aws-instance>Setting up your AWS Instance</h1><h2 id=environment-setup---mac>Environment Setup - Mac</h2><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>If you wish to run this on Mac directly, you can see the instructions <a href=../en/other/dev-mttr-custom-tags/1-setup-os/../appendix-a-setup-mac>here in the appendix</a> and skip the next section on Linux.</p><p>All installs must continue at <a href=../en/other/dev-mttr-custom-tags/1-setup-os/../2-setup-app>setting up the app</a>.</p></div></div><h2 id=environment-setup---linux>Environment Setup - Linux</h2><p>You can skip past the EC2 configuration to Linux Software Requirements if you already have an Ec2 that meets the specifications below !!!!</p><ul><li>ubuntu 22.04</li></ul><p><a href=#image-0ac706a57e7a36fc43ac180f50389cea class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-1.png alt=1-setup-config-1 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0ac706a57e7a36fc43ac180f50389cea><img src=../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-1.png alt=1-setup-config-1 class=lightbox-image loading=lazy></a>
<a href=#image-7f183a4c3ab9b3997d953ad146b37223 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-2.png alt=1-setup-config-2 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7f183a4c3ab9b3997d953ad146b37223><img src=../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-2.png alt=1-setup-config-2 class=lightbox-image loading=lazy></a>
<a href=#image-676c8c7091292e95088d2230cfba568c class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-3.png alt=1-setup-config-3 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-676c8c7091292e95088d2230cfba568c><img src=../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-3.png alt=1-setup-config-3 class=lightbox-image loading=lazy></a></p><ul><li>Security Group Security Settings<ul><li>HTTP inbound open on 8010</li><li>All Traffic open outbound</li></ul></li></ul><p><a href=#image-12fa84b19d936cf7741676671af7e19f class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-4.png alt=1-setup-config-4 style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-12fa84b19d936cf7741676671af7e19f><img src=../en/other/dev-mttr-custom-tags/1-setup-os/../images/1-setup-config-4.png alt=1-setup-config-4 class=lightbox-image loading=lazy></a></p><ul><li>Linux Software Requirements: docker, docker-compose, git, maven</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt upgrade
</span></span><span class=line><span class=cl>sudo apt install docker docker-compose maven</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=setting-up-your-application>Setting up your Application</h1><h2 id=environment-setup---application>Environment Setup - Application</h2><ul><li>Clone the workshop repository:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone -b tko-fy24-distributed-tracing https://github.com/shabuhabs/javashop-otel.git</span></span></code></pre></div><ul><li>Access the workshop directory:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> javashop-otel</span></span></code></pre></div><ul><li>Set Environment Variables</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano .env</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><ul><li>NO spaces in &lt;your_name></li><li>The shop_user provides us an Environment Tag.</li><li>To get your access token, go to your Splunk O11y UI -> Settings ->Access Tokens.</li><li>It is assumed in this workshop that you can send traces to the org and token you are using.</li></ul></div></div><ul><li>Set the following values:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>SHOP_USER</span><span class=o>=</span><span class=s>&lt;your_name&gt;</span>
</span></span><span class=line><span class=cl><span class=na>SPLUNK_ACCESS_TOKEN</span><span class=o>=</span><span class=s>&lt;your_token&gt;</span>
</span></span><span class=line><span class=cl><span class=na>SPLUNK_REALM</span><span class=o>=</span><span class=s>&lt;your_realm&gt;</span></span></span></code></pre></div><ul><li>Save in nano with <strong>[CTRL]-o [ENTER]</strong></li><li>Exit nano with <strong>[CTRL]-x</strong></li></ul><h2 id=build-and-deploy-application>Build and Deploy Application</h2><p>Let&rsquo;s get started by building and deploying our Application, the Splunk Instrument Shop. Run the commands below to begin and start reading ahead as your traces are coming up!</p><ul><li>Build the app</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=overview-of-the-workshop>Overview of the Workshop</h1><h2 id=users-and-workflows>Users and Workflows</h2><p>As we go through this workshop we will be switching roles from SRE to Developer. First we will start with alert responders or SREs who will identify an issue in Splunk Observability UI. Next, we will jump to a Developer Role to see how a Developer will debug and repair/fix a software problem using trace data provided by our SRE.</p><p>Of course, we are not requiring 2 people for this workshop as each participant will play both roles.</p><h2 id=today-we-will-learn>Today we will learn</h2><p>Today we will learn how Splunk APM with Full Fidelity tracing can accelerate the time to repair for Development teams. We will focus on the full fidelity data ( In the form of traces ) that an SRE or alert responder would send to a developer to then repair/fix software. We will do this with both Auto-Instrumentation data and Custom attributes or Custom Tags, via Manual Instrumentation data.</p><p>While we will be spending time Debugging code, &mldr;. Don&rsquo;t worry, &mldr;there is no programming experience necessary, as our goal here is for every participant to understand how using Custom Attributes/Tags in Splunk APM @ Full Fidelity accelerates Mean Time to Repair Software problems for Development Teams.</p><h2 id=important-definitions>Important Definitions</h2><p>Let&rsquo;s define a few terms for those new to APM / Software Development or Java</p><ul><li>What Are Custom Attributes / Custom Tags in Splunk APM ?</li></ul><p>First, you will hear poeple refer to Custom Attributes in the context of Splunk Enterprise, however in Splunk APM Custom Attributes are called Custom Tags as defined in Opentelemetry and shown in Splunk APM Tag Splotlight.</p><ul><li>What is a Function or a method in Java?</li></ul><p>A Function in most languages, including Java, is a logical chunk of code that &ndash; when executed &ndash; solves a repeatable task. This is basically what development teams spend thier time building and where software issues will most commonly be.</p><ul><li>What is an Exception in Java?</li></ul><p>An exception is an exceptional error condition that indicates abonormal behavior, or an unhandled condition, that interrupts program execution abnormally.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=review-apm-in-the-ui>Review APM in the UI</h1><h2 id=view-service-map>View Service Map</h2><p>Next step is open your Observability UI, accessing the proper org ( where you sent the traces to ) and click APM and Access the Environemnnt that matches the username you put in .env.</p><p><a href=#image-6adc996d2d6ad67a048a6cabb22fc419 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-1-filter.png alt=4-overview-1-filter style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-6adc996d2d6ad67a048a6cabb22fc419><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-1-filter.png alt=4-overview-1-filter class=lightbox-image loading=lazy></a></p><p>Please note it may take 4-5 minutes or more for traces to show up and you will see full map &ldquo;form&rdquo; as traces are coming in, so you may have to refresh the page a few times each time we Build and Deploy.</p><p>It is recommended to use a -15m look back during this lab. You may need to change it from time to time (for example to -5m or a custom -10m) to make sure you are only looking at the newer traces after your changes.</p><p>NOTE: You may have to refresh the page several times to see your Environment Tag in the UI. The prefix of the Environment tag should match what you entered for SHOP_USER in the .env file.</p><p><a href=#image-e9b6122292212a0b2e0b38ba06aefec7 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-2-time-window.png alt=4-overview-2-time-window style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e9b6122292212a0b2e0b38ba06aefec7><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-2-time-window.png alt=4-overview-2-time-window class=lightbox-image loading=lazy></a></p><p>NOTE: Typically, to identify root cause and route an issue, an SRE or alert responder would check metrics and logs to determine if it is a software or hardware related issue, and thus route to the correct party. In this excercise we are ONLY handling software issues, so we are skipping the metrics and logs parts of normal triage.</p><p>If your instrumentation was successful, the service-map will show latency from the shop service to the products service.</p><p><a href=#image-a878eb28751a6448499419a5d51e8e59 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-3-map.png alt=4-overview-3-map style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-a878eb28751a6448499419a5d51e8e59><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-3-map.png alt=4-overview-3-map class=lightbox-image loading=lazy></a></p><p>Ok let&rsquo;s triage this SOFTWARE ISSUE and skip directly to the traces.</p><ul><li>Click on shop service</li><li>Click Traces (on the right side)</li><li>Sort by Duration</li><li>Select the longest duration trace<ul><li>Or one of the obvious much longer ones</li></ul></li></ul><p><a href=#image-85fe1f696198c1182a19679194b13826 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-4-trace.png alt=4-overview-4-trace style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-85fe1f696198c1182a19679194b13826><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-4-trace.png alt=4-overview-4-trace class=lightbox-image loading=lazy></a></p><p>Now we can see the long latency occurred in the products service and if we click on <strong>products: /products</strong> we can see the offending method was <strong>products:ProductResource.getAllProducts</strong></p><p><a href=#image-f6dc7c7c25cf8a0bf15aadb0454e9301 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-5-span.png alt=4-overview-5-span style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f6dc7c7c25cf8a0bf15aadb0454e9301><img src=../en/other/dev-mttr-custom-tags/4-review-apm/../images/4-overview-5-span.png alt=4-overview-5-span class=lightbox-image loading=lazy></a></p><p>Our next step here would be to send that trace to a developer by clicking download trace and they will have to debug the function. Since we will be the developer there is no need to download the trace. Just remember that is normal workflow for alert responders to route an issue to the &ldquo;Repairers&rdquo; while providing trace data.</p><p>Before we do that please take note of the Tags available for the developer to leverage to find root cause. We see standard out of the box Otel tags on the span, environmental information, but no indications of data specific to something inside custom code (which is where the problem often is).</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=debugging-101>Debugging 101</h1><h2 id=now-lets-play-the-role-of-the-developer>Now let&rsquo;s play the role of the developer</h2><p>As a developer we must debug the function products:ProductResource.getAllProducts to find the problem.</p><h2 id=debugging-101-the-line-by-line-method>Debugging 101, the Line by Line method</h2><p>Without anything to go on other than &ldquo;BAD FUNCTION&rdquo;, a Developer must then look at code visually line by line to find and fix the problem. To make this worse, <strong>functions call other functions</strong>, and it can get very messy in bad code scenarios.</p><p>We will do the visual inspection mehtod next.</p><ul><li>Using Nano:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano products/src/main/java/com/shabushabu/javashop/products/resources/ProductResource.java</span></span></code></pre></div><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: <strong>getAllProducts [Enter]</strong></li><li>You will be taken here:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=nd>@GET</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Response</span> <span class=nf>getAllProducts</span><span class=o>(</span><span class=nd>@DefaultValue</span><span class=o>(</span><span class=s>&#34;California&#34;</span><span class=o>)</span> <span class=nd>@QueryParam</span><span class=o>(</span><span class=s>&#34;location&#34;</span><span class=o>)</span> <span class=n>String</span> <span class=n>location</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>      <span class=c1>// STEP X: All we know right now is somewhere in this function, latency was introduced.
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction1</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction2</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction10</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction13</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction5</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>myCoolFunction6</span><span class=o>(</span><span class=n>location</span><span class=o>);</span></span></span></code></pre></div><p>We can see here in getAllProducts, the first call is to <code>myCoolFunction1()</code>, so as may have guessed our next step is to go look at <code>myCoolFunction1()</code>.</p><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: myCoolFunction1 <strong>[Enter]</strong></li><li>Find the next occurrence: <strong>[CTRL]-w [Enter]</strong></li><li>Keep repeating <strong>[CTRL]-w [Enter]</strong> until you get to the actual function definition</li></ul><p>It looks like this:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>myCoolFunction1</span><span class=o>(</span><span class=n>String</span> <span class=n>location</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Generate a FAST sleep of 0 time !
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kt>int</span> <span class=n>sleepy</span> <span class=o>=</span> <span class=n>lookupLocation1</span><span class=o>(</span><span class=n>location</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span><span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>sleepy</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span></span></span></code></pre></div><p>Now, <code>myCoolFunction1</code> calls <code>lookupLocation1(location)</code></p><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: lookupLocation1 <strong>[Enter]</strong></li></ul><p>I think you get the picture by now, you have no choice but to inspect every line of code and every function called and visually inspect them for problems. This can be a VERY long process and kills our customers Mean Time to Repair. This happens quite often to our customers with our competition beacsue they can&rsquo;t provide all the traces 100% of the time and most can&rsquo;t scale to add more data, via Custom Attributes on top of that!</p><p>Remember, without Full Fidelty, you have to either reproduce errors / latency in another environment or inspect code line by line.</p><p>So they are stuck where we are, quite often.</p><p>OK, enough fun. Let&rsquo;s make this easier for our developer, and show off some Splunk APM Scale!</p><ul><li>Exit your editor:</li><li>Exit nano: <strong>[CTRL]-X</strong></li><li>Optional: If it asks you to save, hit <strong>N</strong></li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=custom-tags>Custom Tags</h1><h2 id=custom-attribution-custom-tags>Custom Attribution (Custom Tags)</h2><p>To take a deeper look at this issue and make this much easier to debug we will implement Custom Attributes via Opentelemetry Manual Instrumentation.</p><p>To speed up manual instrumentation in Java you can leverage OpenTelemetry Annotations, which automatically create a span around a method without modifying the actual code inside the method. This can be very valuable if you are working with an SRE that may have limited access to source code changes.</p><p>To add even more information to help our developers find the root cause faster, OpenTelemetry Annotations can be used to generate span tags with parameter values for the method in question. This is incredibly important to mean time to Repair, because as a Developer, if I know the parameter values of a function at the time of latency or error, I can debug this without having to reproduce an issue in another environment if I have Full Fidelity Tracing.</p><p>Splunk Full Fidelity APM allows our customers development teams to debug their code as it ran in production, 100% of the time. Add with Custom Attribution, you are providing repeatable Mean Time to Repair reduction&mldr; 100% of the time, only with Full Fidelity tracing.</p><p>To expedite manual instrumentation implementation for this exercise, we have provided a tool which will annotate the entirety of the &ldquo;shop&rdquo; and &ldquo;products&rdquo; services with OpenTelemetry standard annotations for every function call without having to write any code. This &ldquo;annotator&rdquo; tool will also tag every parameter in every function, which adds a span tag with Parameter=Value.</p><ul><li>Run Manual Instrumentation Tool</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./AutomateManualInstrumentation.sh</span></span></code></pre></div><ul><li>Rebuild and Deploy the Application</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><h2 id=visualize-in-splunk-apm>Visualize in Splunk APM</h2><p>Now that we have rebuilt and deployed our application, traffic is being sent once again.</p><p>Go back to the Splunk Observability UI and let&rsquo;s see if these annotations help us narrow down the root cause more quickly.</p><p>Let&rsquo;s try to find our latency root cause again, this time with every function and every parameter spanned and tagged respectively&mldr;. You will see exactly what this means and how it benefits developers in a moment.</p><p><a href=#image-c6291316b9fe35b929affa985a877d2e class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-1-apm-map.png alt=6-custom-tags-1-apm-map style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-c6291316b9fe35b929affa985a877d2e><img src=../en/other/dev-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-1-apm-map.png alt=6-custom-tags-1-apm-map class=lightbox-image loading=lazy></a></p><ul><li>Click on shop service</li><li>Click Traces ( on the right side )</li><li>Sort by Duration</li><li>Select the longest duration trace ( or one of the obvious much longer ones )</li></ul><p><a href=#image-f77a5235e6a3f7427b3421b5da7b2c48 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-2-trace.png alt=6-custom-tags-2-trace style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-f77a5235e6a3f7427b3421b5da7b2c48><img src=../en/other/dev-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-2-trace.png alt=6-custom-tags-2-trace class=lightbox-image loading=lazy></a></p><p>We can see that the actual function call that has the latency was not <code>ProductResource.getAllProducts</code> but the function call <code>ProductResource.myCoolFunction234234234</code>.</p><p>Since we now have the parameter tagged as part of our span metadata the actual root cause is seemingly related to the &ldquo;location&rdquo; <strong>Colorado</strong>. And it appears the one custom attribute that was tagged for function <code>ProductResource.myCoolFunction234234234</code> was <code>myInt</code> with a value of <strong>999</strong>. With this information a developer can debug very quickly.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>We added additional span information, which we call <strong>Custom Attributes</strong> here at Splunk. In this case our <strong>Custom Attributes</strong> are <strong>Parameter Values at Time of Latency</strong>.</p></div></div><p>In our exmaple the <code>myInt</code> tag was created due our handy Annotator, that did the OpenTelemetry Annotations for us.</p><ul><li>Using nano:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano products/src/main/java/com/shabushabu/javashop/products/resources/ProductResource.java</span></span></code></pre></div><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: <strong>999 [Enter]</strong></li></ul><p>We can see here, someone wrote some very bad code in the form of a long Sleep!</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=mi>999</span><span class=o>==</span><span class=n>myInt</span><span class=o>)</span> 
</span></span><span class=line><span class=cl>    <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>sleepy</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=mi>5000</span> <span class=o>-</span> <span class=mi>3000</span><span class=o>)</span> <span class=o>+</span> <span class=mi>3000</span><span class=o>);</span></span></span></code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=fixing-code>Fixing Code</h1><h2 id=finding-the-problem>Finding the Problem</h2><p>How did we get here? How did the 999 end up in the trace as a Custom Attribute?</p><p>Take a look at the function signature</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>myCoolFunction234234234</span><span class=o>(</span><span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;myInt&#34;</span><span class=o>)</span> <span class=kt>int</span> <span class=n>myInt</span><span class=o>)</span></span></span></code></pre></div><p><code>@SpanAttribute("myint")</code> is an OpenTelemetry Annotation that was added by our Java Otel Annotator tool.</p><h2 id=fixing-the-code>Fixing the code</h2><ul><li>Change this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>myCoolFunction234234234</span><span class=o>(</span><span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;myInt&#34;</span><span class=o>)</span> <span class=kt>int</span> <span class=n>myInt</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Generate a FAST sleep of 0 time !
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Random</span> <span class=n>sleepy</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=mi>999</span><span class=o>==</span><span class=n>myInt</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span>
</span></span><span class=line><span class=cl><span class=n>sleepy</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=mi>5000</span> <span class=o>-</span> <span class=mi>3000</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>+</span> <span class=mi>3000</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span></span></span></code></pre></div><ul><li>to this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span> <span class=nf>myCoolFunction234234234</span><span class=o>(</span><span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;myInt&#34;</span><span class=o>)</span> <span class=kt>int</span> <span class=n>myInt</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Generate a FAST sleep of 0 time !
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Random</span> <span class=n>sleepy</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=o>{</span>
</span></span><span class=line><span class=cl><span class=c1>// if (999==myInt)
</span></span></span><span class=line><span class=cl><span class=c1>// Thread.sleep(
</span></span></span><span class=line><span class=cl><span class=c1>// sleepy.nextInt(5000 - 3000)
</span></span></span><span class=line><span class=cl><span class=c1>// + 3000);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span></span></span></code></pre></div><p>which is basically placing comments (//) before the lines in myCoolFunction234234234 that are causing the slowness:</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// if (999==myInt)
</span></span></span><span class=line><span class=cl><span class=c1>// Thread.sleep(
</span></span></span><span class=line><span class=cl><span class=c1>// sleepy.nextInt(5000 - 3000)
</span></span></span><span class=line><span class=cl><span class=c1>// + 3000);
</span></span></span></code></pre></div><ul><li>Save the changes: <strong>[CTRL]-o [Enter]</strong></li><li>Exit: <strong>[CTRL]-x</strong></li></ul><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>Until we rebuild and restart our application this change isn&rsquo;t implemented.</p></div></div><h2 id=find-other-issues>Find Other Issues</h2><p>Let&rsquo;s go see if our manual instrumentation uncovered any other issues we did not see before</p><p>So you may be asking yourself: &ldquo;How does manual instrumentation alone show us &ldquo;more problems&rdquo; than before? Latency is latency, isn&rsquo;t it?&rdquo;</p><p>The answer is with auto-instrumentation you are in most situations NOT covering functions our customers&rsquo; development teams wrote, which is of course the bulk of what developers do. They write functions&mldr;. and of course this is where the bulk of software problems occur.</p><p>You may have noticed a new exception in our trace that was not present with Auto-Instrumentation during our latency fix use-case. Since we skipped over this, let&rsquo;s walk you through it.</p><ul><li>Return to the service map</li><li>Click on shop service</li><li>Click Traces (on the right side)</li><li>Click Errors Only</li></ul><p><a href=#image-e24ff962a33493eadd6c0af1ba661586 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-1-traces.png alt=7-fixing-code-1-traces style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-e24ff962a33493eadd6c0af1ba661586><img src=../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-1-traces.png alt=7-fixing-code-1-traces class=lightbox-image loading=lazy></a></p><ul><li>Click on a trace with an error present</li></ul><p><a href=#image-9a1f44cff5f2b285ef1207b8c6620f2f class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-2-span.png alt=7-fixing-code-2-span style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-9a1f44cff5f2b285ef1207b8c6620f2f><img src=../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-2-span.png alt=7-fixing-code-2-span class=lightbox-image loading=lazy></a></p><p>We can see our exception is <code>InvalidLocaleException</code>.</p><p>The real problem must be related to the new data associated with <strong>Sri Lanka</strong> as the Exception says <strong>&ldquo;Non English Characters found in Instrument Data&rdquo;</strong>.</p><p>This exception had not surfaced in previous traces based on ONLY Auto-Instrumentation because the method where it was thrown was NOT covered with Auto-Instrumentation.</p><p>Once we completed the Manual Instrumentation via the Otel Annotator, this method was instrumented and we can now see we had a buried Exception being thrown.</p><h2 id=fixing-more-code>Fixing more code</h2><p>We already know exactly what file to look in and what method to look at as it is called out in the trace.</p><p><a href=#image-95b3876dee1a0eaca3144504c3d5f95d class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-3-what-to-fix.png alt=7-fixing-code-3-what-to-fix style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-95b3876dee1a0eaca3144504c3d5f95d><img src=../en/other/dev-mttr-custom-tags/7-fixing-code/../images/7-fixing-code-3-what-to-fix.png alt=7-fixing-code-3-what-to-fix class=lightbox-image loading=lazy></a></p><ul><li>Using nano:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano shop/src/main/java/com/shabushabu/javashop/shop/model/Instrument.java</span></span></code></pre></div><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: <strong>buildForLocale [Enter]</strong></li></ul><p>Look just above the <code>buildForLocale</code> function.</p><p>Notice the Annotation <code>@WithSpan</code>? <code>@WithSpan</code> is an <a href=https://opentelemetry.io/docs/instrumentation/java/automatic/annotations/ target=_blank>OpenTelemetry Annotation</a> for Java that automatically generates a span around a the function that follows.</p><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@WithSpan</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>Instrument</span> <span class=nf>buildForLocale</span><span class=o>(</span>
</span></span><span class=line><span class=cl>  <span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;id&#34;</span><span class=o>)</span> <span class=kt>long</span> <span class=n>id</span><span class=o>,</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>  <span class=nd>@SpanAttribute</span><span class=o>(</span><span class=s>&#34;seller_type&#34;</span><span class=o>)</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=o>.</span><span class=na>id</span><span class=o>=</span> <span class=n>id</span><span class=o>;</span></span></span></code></pre></div><p>Now let&rsquo;s fix this code. We are going to simply comment this out for now and see if it fixes our latency issue.</p><ul><li>Change this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(!</span><span class=n>isEnglish</span><span class=o>(</span><span class=n>title</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>throw</span> <span class=k>new</span> <span class=n>InvalidLocaleException</span><span class=o>(</span><span class=s>&#34;Non English Characters found in Instrument Data&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl> <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>   <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Characters OK &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><ul><li>to this (comment out if block):</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// if (!isEnglish(title)) {
</span></span></span><span class=line><span class=cl><span class=c1>//   throw new InvalidLocaleException(&#34;Non English Characters found in Instrument Data&#34;);
</span></span></span><span class=line><span class=cl><span class=c1>// } else {
</span></span></span><span class=line><span class=cl><span class=c1>//   System.out.println(&#34;Characters OK &#34;);
</span></span></span><span class=line><span class=cl><span class=c1>// }
</span></span></span></code></pre></div><ul><li>Save the changes: <strong>[CTRL]-o [Enter]</strong></li><li>Exit: <strong>[CTRL]-x</strong></li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=rebuild-and-deploy>Rebuild and Deploy</h1><h2 id=rebuild-and-deploy>Rebuild and Deploy</h2><ul><li>Run</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><ul><li>Wait a few minutes . . .</li><li>Return to the service map</li></ul><p>If you do NOT see RED in your service map, you have completed the Latency Repair for the Colorado Location!</p><p>Now let&rsquo;s check for our exception in the traces.</p><ul><li>Click on shop service</li><li>Click Traces (on the right side)</li><li>Click Errors Only</li></ul><p>If you do not have red in your service map and you do not see Errors in traces, you have successfully completed our Inventory application review for Sri Lanka and Colorado locations.</p><p><strong>Well done!</strong></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=dont-forget-chicago>Don't Forget Chicago</h1><h2 id=dont-forget-chicago>Don&rsquo;t forget Chicago</h2><p>We are nearly done, one more location to go&mldr; Chicago.</p><p>Since we have been having so many issues related to &ldquo;location&rdquo; and we have added that custom attribute via Opentelemetry Manual Instrumentation, lets go to the Splunk Observability UI and look at an APM metric set around that tag that I created for us.</p><p><a href=#image-4a0b992028072f3b8f5c8f4e00911b82 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-1-metricset.png alt=9-chicago-1-metricset style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4a0b992028072f3b8f5c8f4e00911b82><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-1-metricset.png alt=9-chicago-1-metricset class=lightbox-image loading=lazy></a></p><ul><li>Open a browser and navigate to <a href=http://[EC2-Address]:8010 target=_blank>http://[EC2-Address]:8010</a><ul><li>Replace [EC2-Address] with the ip address of your host</li></ul></li><li>Select a few locations and hit the Login button.<ul><li>Make sure to also select the Chicago Location and hit the Login button.</li></ul></li></ul><p><a href=#image-1d94673623908f0958dc94d6baf4c9d2 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-2-app.png alt=9-chicago-2-app style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-1d94673623908f0958dc94d6baf4c9d2><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-2-app.png alt=9-chicago-2-app class=lightbox-image loading=lazy></a></p><p>Uh oh! We received a 500 error, something is wrong there as well.</p><p><a href=#image-4c2e4933e8914e0165d26326c21bb1c7 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-3-map.png alt=9-chicago-3-map style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-4c2e4933e8914e0165d26326c21bb1c7><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-3-map.png alt=9-chicago-3-map class=lightbox-image loading=lazy></a></p><ul><li>Return to the Splunk Observability UI and lets look once again at our Service Map</li><li>Select the Instruments Service</li><li>Click the Breakdowns dropdown on the right and select location</li></ul><p><a href=#image-b8d2626cea4d1dc48226c2660a2b1ce8 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-4-map-breakdown.png alt=9-chicago-4-map-breakdown style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-b8d2626cea4d1dc48226c2660a2b1ce8><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-4-map-breakdown.png alt=9-chicago-4-map-breakdown class=lightbox-image loading=lazy></a></p><p>We see there was an un-handled exception thrown in the Instruments service, and some latency from our database that is related to the Chicago location!</p><ul><li>Click on Traces on the right</li><li>Click Errors Only</li><li>Click one of the traces</li></ul><p><a href=#image-7c76fd47daffc36a7b40ea9ebc0ff0e4 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-5-trace.png alt=9-chicago-5-trace style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7c76fd47daffc36a7b40ea9ebc0ff0e4><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-5-trace.png alt=9-chicago-5-trace class=lightbox-image loading=lazy></a></p><p>We can see the exception was thrown by Hibernate, however it was thrown in our method instruments: <code>InstrumentRepository.findInstruments</code></p><p><a href=#image-0aa089496f909a66de493e5a58201e44 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-6-span.png alt=9-chicago-6-span style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-0aa089496f909a66de493e5a58201e44><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-6-span.png alt=9-chicago-6-span class=lightbox-image loading=lazy></a></p><h2 id=lets-play-developer-again>Let&rsquo;s play developer again</h2><ul><li>Edit the file <code>instruments: InstrumentRepository.findInstruments</code> using nano:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>nano</span> <span class=n>instruments</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>main</span><span class=o>/</span><span class=n>java</span><span class=o>/</span><span class=n>com</span><span class=o>/</span><span class=n>shabushabu</span><span class=o>/</span><span class=n>javashop</span><span class=o>/</span><span class=n>instruments</span><span class=o>/</span><span class=n>repositories</span><span class=o>/</span><span class=n>FindInstrumentRepositoryImpl</span><span class=o>.</span><span class=na>java</span></span></span></code></pre></div><ul><li>Find the method: <code>findInstruments</code><ul><li>You know how to do this now, right?</li></ul></li></ul><p><a href=#image-8ed70454da9fbead62e9bde7e68463c9 class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-7-code.png alt=9-chicago-7-code style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-8ed70454da9fbead62e9bde7e68463c9><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-7-code.png alt=9-chicago-7-code class=lightbox-image loading=lazy></a></p><p>We can see the developer accidently added the Instruments database with the Chicago Instruments database!</p><p>Let&rsquo;s change the query and fix this, remove instruments_for_sale from our query.</p><ul><li>Change this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>Object</span> <span class=nf>findInstruments</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>LOGGER</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;findInstruments Called (All)&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Object</span> <span class=n>obj</span> <span class=o>=</span> <span class=n>entityManager</span><span class=o>.</span><span class=na>createNativeQuery</span><span class=o>(</span> <span class=s>&#34;SELECT * FROM instruments_for_sale, instruments_for_sale_chicago&#34;</span><span class=o>).</span><span class=na>getResultList</span><span class=o>();</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>obj</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><ul><li>to this:</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>Object</span> <span class=nf>findInstruments</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>LOGGER</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;findInstruments Called (All)&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Object</span> <span class=n>obj</span> <span class=o>=</span> <span class=n>entityManager</span><span class=o>.</span><span class=na>createNativeQuery</span><span class=o>(</span> <span class=s>&#34;SELECT * FROM instruments_for_sale_chicago&#34;</span><span class=o>).</span><span class=na>getResultList</span><span class=o>();</span> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>obj</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div><ul><li><p>Save the changes: <strong>[CTRL]-o [Enter]</strong></p></li><li><p>Exit: <strong>[CTRL]-x</strong></p></li><li><p>Build and Deploy Application</p></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><p>Now let&rsquo;s test the Chicago location once again</p><ul><li>Open a browser and navigate to <a href=http://[EC2-Address]:8010 target=_blank>http://[EC2-Address]:8010</a></li><li>Select the Chicago location and Login</li></ul><p>We now see the 500 error is gone!</p><ul><li>Let&rsquo;s confirm a clean Service Map:</li></ul><p><a href=#image-2c7384089384df6c34f167c098446caa class=lightbox-link><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-8-map-clean.png alt=9-chicago-8-map-clean style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-2c7384089384df6c34f167c098446caa><img src=../en/other/dev-mttr-custom-tags/9-chicago/../images/9-chicago-8-map-clean.png alt=9-chicago-8-map-clean class=lightbox-image loading=lazy></a></p><p>If you see a clean service map, free of errors and Latency you have successfully completed the Java Instrumentation Workshop!</p><p><strong>Congratulations!!!</strong></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=appendix---setting-up-on-mac>Appendix - Setting up on Mac</h1><h2 id=mac-setup>Mac Setup</h2><ul><li>Tested on<ul><li>Macos Ventura 13.2.1</li><li>Mac M1/M2</li></ul></li></ul><p>Intel Macs should be work; however if they are slower you may need to run <code>./BuildAndDeploy</code> multiple times.</p><p>IMPORTANT: Docker must have access to 6-GB RAM.</p><ul><li>Prerequisites<ul><li><a href=https://mac.install.guide/commandlinetools/index.html target=_blank>XCode Command line tools</a></li></ul></li></ul><h3 id=homebrew-install>Homebrew Install</h3><ul><li><a href=https://docs.brew.sh/Installation target=_blank>Homebrew full install details</a></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir homebrew <span class=o>&amp;&amp;</span> curl -L https://github.com/Homebrew/brew/tarball/master <span class=p>|</span> tar xz --strip <span class=m>1</span> -C homebrew
</span></span><span class=line><span class=cl><span class=nb>eval</span> <span class=s2>&#34;</span><span class=k>$(</span>homebrew/bin/brew shellenv<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>brew update --force --quiet
</span></span><span class=line><span class=cl>chmod -R go-w <span class=s2>&#34;</span><span class=k>$(</span>brew --prefix<span class=k>)</span><span class=s2>/share/zsh&#34;</span></span></span></code></pre></div><h4 id=install-colima>Install Colima</h4><p>Colima - Colima is a docker daemon that does not require Docker Desktop. This is used to avoid any docker license issues with Docker Desktop.</p><ul><li><a href=https://github.com/abiosoft/colima target=_blank>Colima full install details</a></li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew uninstall docker docker-compose colima
</span></span><span class=line><span class=cl>brew install docker docker-compose colima 
</span></span><span class=line><span class=cl>colima stop
</span></span><span class=line><span class=cl>colima start --cpu <span class=m>4</span> --memory <span class=m>6</span></span></span></code></pre></div><ul><li>Java Tools Install</li></ul><div class="wrap-code highlight"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install git
</span></span><span class=line><span class=cl>brew install maven</span></span></code></pre></div><footer class=footline></footer></article></section></section></section></div></main></div><script src=../js/clipboard.min.js?1689693085 defer></script>
<script src=../js/perfect-scrollbar.min.js?1689693085 defer></script>
<script src=../js/theme.js?1689693085 defer></script></body></html>