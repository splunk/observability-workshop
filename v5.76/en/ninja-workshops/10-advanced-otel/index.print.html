<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=generator content="Relearn 7.2.1"><meta name=description content="In this workshop you will practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Advanced OpenTelemetry :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="In this workshop you will practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.76/en/ninja-workshops/10-advanced-otel/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Advanced OpenTelemetry :: Splunk Observability Cloud Workshops"><meta property="og:description" content="In this workshop you will practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Advanced OpenTelemetry :: Splunk Observability Cloud Workshops"><meta itemprop=description content="In this workshop you will practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's"><meta itemprop=dateModified content="2025-01-21T11:56:47+00:00"><meta itemprop=wordCount content="308"><title>Advanced OpenTelemetry :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.76/en/ninja-workshops/10-advanced-otel/index.html rel=canonical type=text/html title="Advanced OpenTelemetry :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.76/images/favicon.ico?1737480558 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.76/css/fontawesome-all.min.css?1737480558 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.76/css/fontawesome-all.min.css?1737480558 rel=stylesheet></noscript><link href=/observability-workshop/v5.76/css/auto-complete.css?1737480558 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.76/css/auto-complete.css?1737480558 rel=stylesheet></noscript><link href=/observability-workshop/v5.76/css/perfect-scrollbar.min.css?1737480558 rel=stylesheet><link href=/observability-workshop/v5.76/css/theme.min.css?1737480558 rel=stylesheet><link href=/observability-workshop/v5.76/css/format-print.min.css?1737480558 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.76",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.76/en/ninja-workshops/10-advanced-otel/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#workshop-overview>Workshop Overview</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.76/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.76/en/ninja-workshops/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Advanced OpenTelemetry</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.76/en/ninja-workshops/10-advanced-otel/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.76/en/ninja-workshops/6-lambda-kinesis/7-summary/index.html title="Conclusion (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.76/en/ninja-workshops/10-advanced-otel/10-agent-setup/index.html title="Initial setup our agent config (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=advanced-opentelemetry>Advanced OpenTelemetry</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>90 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Authors
</span><span class=badge-content>Robert Castley,
Charity Anderson
&
Pieter Hagen</span></span><p>The goal of this workshop is to help you become comfortable creating and modifying OpenTelemetry Collector configuration files. Youâ€™ll start with a minimal <code>agent.yaml</code> file and gradually configure several common advanced scenarios.</p><p>To get the most out of this workshop, you should have a basic understanding of the OpenTelemetry Collector and its configuration file format. Additionally, proficiency in editing YAML files is required. The entire workshop is designed to run locally, using the File Exporter as the target output for the collector, so you wonâ€™t need a backend to send data to.</p><h3 id=prerequisites>Prerequisites</h3><ol><li><strong>Create a directory</strong> on your machine for the workshop (e.g., <code>collector</code>). We will refer to this directory as <code>[WORKSHOP]</code> in the instructions.</li><li><strong>Download the latest OpenTelemetry Collector release</strong> (as of this writing, v0.116.0) for your platform and place it in the <code>[WORKSHOP]</code> directory.</li></ol><p>The appropriate binary for your platform is:</p><ul><li><strong>Apple Mac (Apple Silicon):</strong> <code>otelcol_darwin_arm64</code></li><li><strong>Apple Mac (Intel):</strong> <code>otelcol_darwin_amd64</code></li><li><strong>Windows AMD/64:</strong> <code>otelcol_windows_amd64.exe</code></li><li><strong>Linux (AMD/64):</strong> <code>otelcol_linux_amd64</code></li><li><strong>Linux (ARM/64):</strong> <code>otelcol_linux_arm64</code></li></ul><details open class="box cstyle notices info"><summary class=box-label><i class="fa-fw fas fa-info"></i>
Note</summary><div class=box-content><p>If none of the above match your host platform, please select and download the correct of your required build <a href=https://github.com/signalfx/splunk-otel-collector/releases/tag/v0.116.0 rel=external target=_blank><strong>here</strong></a>.</p></div></details><p>Once downloaded, rename the file to <code>otelcol</code> (or <code>otelcol.exe</code> on Windows).</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol    # OpenTelemetry Collector binary</span></span></code></pre></div><h3 id=workshop-overview>Workshop Overview</h3><p>During this workshop, we will cover the following topics:</p><ul><li><strong>Setting up the agent locally</strong>: Add metadata, and introduce the debug and file exporters.</li><li><strong>Configuring a gateway</strong>: Route traffic from the agent to the gateway.</li><li><strong>Configuring the <code>filelog</code> receiver</strong>: Collect log data from various log files.</li><li><strong>Enhancing agent resilience</strong>: Basic configurations for fault tolerance.</li><li><strong>Configuring processors</strong>:<ul><li>Filter out noise by dropping specific spans (e.g., health checks).</li><li>Remove unnecessary tags.</li><li>Transform attributes to match the expected format.</li><li>Route data to different endpoints based on the values received.</li></ul></li></ul><p>By the end of this workshop, you&rsquo;ll be familiar with configuring the OpenTelemetry Collector for a variety of real-world use cases.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of Advanced OpenTelemetry</h1><article class=default><header class=headline></header><h1 id=initial-setup-our-agent-config>Initial setup our agent config</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h3 id=setup>Setup</h3><p>In your <code>[WORKSHOP]</code> directory, create a subdirectory named 1-agent and navigate into it.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>mkdir -p [WORKSHOP]/1-agent
</span></span><span class=line><span class=cl>cd [WORKSHOP]/1-agent</span></span></code></pre></div><p>Inside the <code>1-agent</code> directory, create a file called <code>agent.yaml</code> and paste the following starting configuration into it:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent         # Module directory
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ agent.yaml  # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol         # OpenTelemetry Collector binary</span></span></code></pre></div><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>-<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>-<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[]</span></span></span></code></pre></div><p>This is the basic structure of an OpenTelemetry Collector configuration file, defining the components you&rsquo;ll need to work with.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Let&rsquo;s walk through a few modifications to get started:</p><ol><li><strong>Add <code>otlp</code> receiver</strong>: Under the <code>receivers</code> section, add the <code>otlp</code> receiver to enable the collector to receive telemetry data in the OTLP (OpenTelemetry Protocol) format.</li><li><strong>Add <code>protocols</code> section</strong>: Under the <code>otlp</code> receiver.</li><li><strong>Add <code>http</code> key</strong>: Under the <code>protocols</code> section, specify an <code>http</code> receiver type.</li><li><strong>Add <code>endpoint</code> key</strong>: Set the value to <code>0.0.0.0:4318</code>. This will tell the Collector to listen for incoming telemetry data on this endpoint.</li></ol><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-lightbulb"></i></span><span class=badge-content><strong>Hint</strong></span></span></summary><div class=box-content><p>For proper formatting, make sure to align the YAML structure, paying attention to indentation.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span></span></span></code></pre></div></div></details><ol start=5><li><strong>Add <code>debug</code> exporter</strong>: Under the <code>exporters</code> section, add a <code>debug</code> exporter. This will help you see the collected data in a human-readable format in the logs.</li><li><strong>Add <code>verbosity</code> level</strong>: Set the <code>verbosity</code> of the exporter to <code>detailed</code> for more comprehensive logging output.</li><li><strong>Update Pipelines</strong>: Ensure that the <code>otlp</code> receiver, <code>memory_limiter</code> processor, and <code>debug</code> exporter are added to the pipelines for traces, metrics, and logs.</li></ol><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-lightbulb"></i></span><span class=badge-content><strong>Hint</strong></span></span></summary><div class=box-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>   </span><span class=c># you also could use [memory_limiter]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporter</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># metrics: pipeline section...  </span></span></span></code></pre></div></div></details></div></details><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>In the exercise above, weâ€™ve provided all the key elements in YAML format, but itâ€™s up to you to correct and complete them. Be mindful of the formatting, as the OpenTelemetry Collector configuration is YAML-based.</p><p>Going forward, we will provide only a limited set of hints, so you&rsquo;ll need to apply what you&rsquo;ve learned.</p><p>If youâ€™re ever unsure about the format, you can refer to otelbin.io, which will display the default agent configuration when first accessed.</p></div></details><p>By using <a href=https://otelbin.io rel=external target=_blank><strong>otelbin.io</strong></a> to validate your <code>agent.yaml</code> file, you can quickly identify spelling or configuration errors. If everything is set up correctly, your configuration for all pipelines should look like this (click the image to enlarge):</p><p><a href=#R-image-6955498c02749121a70a9159df224cee class=lightbox-link><img alt=agent-traces class="noborder inline lazy lightbox noshadow figure-image" loading=lazy src="../images/agent-traces.png?classes=inline&width=20vw" style=height:auto;width:20vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6955498c02749121a70a9159df224cee><img alt=agent-traces class="noborder inline lazy lightbox noshadow lightbox-image" loading=lazy src="../images/agent-traces.png?classes=inline&width=20vw"></a>
<a href=#R-image-7391003aeee56224a508dbc6cf19d1ea class=lightbox-link><img alt=agent-metrics class="noborder inline lazy lightbox noshadow figure-image" loading=lazy src="../images/agent-metrics.png?classes=inline&width=20vw" style=height:auto;width:20vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7391003aeee56224a508dbc6cf19d1ea><img alt=agent-metrics class="noborder inline lazy lightbox noshadow lightbox-image" loading=lazy src="../images/agent-metrics.png?classes=inline&width=20vw"></a>
<a href=#R-image-02853b71f3d126cb691a8c0e69d755b5 class=lightbox-link><img alt=agent-logs class="noborder inline lazy lightbox noshadow figure-image" loading=lazy src="../images/agent-logs.png?classes=inline&width=20vw" style=height:auto;width:20vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-02853b71f3d126cb691a8c0e69d755b5><img alt=agent-logs class="noborder inline lazy lightbox noshadow lightbox-image" loading=lazy src="../images/agent-logs.png?classes=inline&width=20vw"></a></p><hr><h3 id=test--validate>Test & Validate</h3><p>To test your configuration, run the following command (ensure youâ€™re using the correct OpenTelemetry Collector binary you downloaded):</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>../otelcol --config=agent.yaml</span></span></code></pre></div><p>If everything is set up correctly, the last line of the output should read:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.116.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p>Next, open a new terminal window, create a file named <code>trace.json</code>, and copy the content from one of the tabs below (both tabs contain the same trace data):</p><div class=tab-panel data-tab-group=6684d2fc4828eb08a59a43b3a6b99f86><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6684d2fc4828eb08a59a43b3a6b99f86","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6684d2fc4828eb08a59a43b3a6b99f86","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;keytest&#34;</span><span class=p>:</span><span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some value&#34;</span><span class=p>}}]}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.service&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.environment&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;keytest&#34;</span><span class=p>:</span> <span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some value&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>In the second terminal window, run the following command to test your setup and validate the output:</p><div class=tab-panel data-tab-group=ef4a88ea28df9c7470da37e4c7b76f50><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ef4a88ea28df9c7470da37e4c7b76f50","curl-command")'>
<span class=tab-nav-text>cURL Command</span>
</button>
<button data-tab-item=debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ef4a88ea28df9c7470da37e4c7b76f50","debug-output")'>
<span class=tab-nav-text>Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=curl-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl> <span class=nb>curl </span><span class=n>-X</span> <span class=n>POST</span> <span class=n>-i</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>localhost</span><span class=err>:</span><span class=mf>4318</span><span class=p>/</span><span class=n>v1</span><span class=p>/</span><span class=n>traces</span> <span class=n>-H</span> <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=n>-d</span> <span class=s2>&#34;@trace.json&#34;</span></span></span></code></pre></div></div></div><div data-tab-item=debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-13T13:26:13.502+0100 info Traces {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>2025-01-13T13:26:13.502+0100 info ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL:
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>    -&gt; service.name: Str(my.service)
</span></span><span class=line><span class=cl>    -&gt; deployment.environment: Str(my.environment)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope my.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>    -&gt; my.scope.attribute: Str(some scope attribute)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>   Trace ID       : 5b8efff798038103d269b633813fc60c
</span></span><span class=line><span class=cl>   Parent ID      : eee19b7ec3c1b173
</span></span><span class=line><span class=cl>   ID             : eee19b7ec3c1b174
</span></span><span class=line><span class=cl>   Name           : I&#39;m a server span
</span></span><span class=line><span class=cl>   Kind           : Server
</span></span><span class=line><span class=cl>   Start time     : 2018-12-13 14:51:00 +0000 UTC
</span></span><span class=line><span class=cl>   End time       : 2018-12-13 14:51:01 +0000 UTC
</span></span><span class=line><span class=cl>   Status code    : Unset
</span></span><span class=line><span class=cl>   Status message :
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>    -&gt; : Str(some value)
</span></span><span class=line><span class=cl> {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div></div></div></div></div><p>Once you&rsquo;ve updated the configuration, youâ€™re ready to proceed to running the OpenTelemetry Collector with your new setup. This exercise sets the foundation for understanding how data flows through the OpenTelemetry Collector, including receivers, processors, and exporters.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1. Initial Agent Setup</h1><article class=default><header class=headline></header><h1 id=add-a-file-exporter>Add a File exporter</h1><h3 id=setup>Setup</h3><p>We want to see the output generated during the export phase of the pipeline, so we are going to write the OTLP data to files for comparison.</p><p>Let&rsquo;s run our second exercise:</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Add <code>file:</code> under <code>exporters:</code> key<ul><li>Add <code>path:</code> key with a value of <code>"./agent.out"</code></li><li>Add <code>rotation:</code> key<ul><li>Add <code>max_megabytes:</code> key and set a value of <code>2</code> # This set the max size for the file exporter output file</li><li>Add <code>max_backups:</code> key and set a value of <code>2</code> # This will set the max number rotational backup it creates</li></ul></li></ul></li></ul><p>Add <code>file</code> as an exporter to exporters array in the <code>metrics</code>, <code>traces</code> and <code>logs</code> pipelines. (leave debug as the first in the array)</p></div></details><p>Validate your updated <code>agent.yaml</code> with <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. As an example, here is how the <code>Traces:</code> section of your pipelines should look:</p><p><a href=#R-image-5bd9059d6b15a5f242785467f85b582e class=lightbox-link><img alt=otelbin-a-1-2-w class="noborder lazy lightbox noshadow figure-image" loading=lazy src="../../images/agent-1-2-traces.png?width=30vw" style=height:auto;width:30vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5bd9059d6b15a5f242785467f85b582e><img alt=otelbin-a-1-2-w class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src="../../images/agent-1-2-traces.png?width=30vw"></a></p><hr><h3 id=test--validate>Test & Validate</h3><p>Restart your collect this time with your new config to test it:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>WORKSHOP<span class=o>]</span>/otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p>Again, if you have done everything correctly, the last line of the output should be:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.116.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p>If you send a trace again, you should get the same output as we saw previously:</p><div class=tab-panel data-tab-group=bf494f45d85dbfbdeab65a391a3cf50a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bf494f45d85dbfbdeab65a391a3cf50a","curl-command")'>
<span class=tab-nav-text>cURL Command</span></button></div><div class=tab-content-container><div data-tab-item=curl-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl> <span class=nb>curl </span><span class=n>-X</span> <span class=n>POST</span> <span class=n>-i</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>localhost</span><span class=err>:</span><span class=mf>4318</span><span class=p>/</span><span class=n>v1</span><span class=p>/</span><span class=n>traces</span> <span class=n>-H</span> <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=n>-d</span> <span class=s2>&#34;@trace.json&#34;</span></span></span></code></pre></div></div></div></div></div><p>You now should have a file in the same directory called <code>agent.out</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]/1-agent/
</span></span><span class=line><span class=cl>â”œâ”€â”€ agent.yaml    # Configuration file
</span></span><span class=line><span class=cl>â”œâ”€â”€ agent.out     # Trace export file
</span></span><span class=line><span class=cl>â”œâ”€â”€ trace.json    # Trace JSON file</span></span></code></pre></div><p>In the file the trace is written as a single line in JSON format, when you look at the file it looks like this:</p><div class=tab-panel data-tab-group=492054872b89697ab4c24c43e053e4e4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("492054872b89697ab4c24c43e053e4e4","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("492054872b89697ab4c24c43e053e4e4","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;keytest&#34;</span><span class=p>:</span><span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some value&#34;</span><span class=p>}}]}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.service&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.environment&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;keytest&#34;</span><span class=p>:</span> <span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some value&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>If you want to see the JSON expanded on your device, you can cat the file and pipe it though <code>jq</code> (if you have it installed).</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ./agent.out <span class=p>|</span> jq</span></span></code></pre></div><p>Copy <code>agent.out</code> to <code>agent-1.out</code> so you can use it to compare against other results later on in this workshop.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 20, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=adding-resource-metadata>Adding Resource Metadata</h1><h3 id=setup>Setup</h3><p>What we have so far is basically a straight copy from the trace we send though the OTel collector. Now lets start adding some metadata to the base trace, this is information we can use during trouble shooting etc.</p><p>Let&rsquo;s run our next exercise:</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Add <code>resourcedetection:</code> under the <code>processors:</code> key<ul><li>Add <code>detectors:</code> key and set a value of <code>[system]</code></li><li>Add <code>override:</code> key and set a value of <code>true</code></li></ul></li><li>Add <code>resource:</code> under the <code>processors:</code> key and name it <code>/add_mode:</code><ul><li>Add <code>attributes:</code> key<ul><li>Add <code>- action:</code> key and set a value of <code>insert</code> * The - is on the same ident as of attributes<ul><li>Add <code>key:</code> key and set a value of <code>otelcol.service.mode</code></li><li>Add <code>value:</code> key wand set a value of <code>"agent"</code></li></ul></li></ul></li></ul></li></ul><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-lightbulb"></i></span><span class=badge-content><strong>Hint</strong></span></span></summary><div class=box-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=c>#.......</span></span></span></code></pre></div></div></details><ul><li>Add the two processors to <code>processors:</code> array in the pipelines (leaving <code>memory_limiter</code> as the first one)</li></ul></div></details><hr><p>Validate your new <code>agent.yaml</code> with <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>.</p><p><a href=#R-image-8d7045e7b05395dd17fb47fd239f364a class=lightbox-link><img alt=otelbin-a-1-3-logs class="noborder lazy lightbox noshadow figure-image" loading=lazy src="../../images/agent-1-3-logs.png?width=50vw" style=height:auto;width:50vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8d7045e7b05395dd17fb47fd239f364a><img alt=otelbin-a-1-3-logs class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src="../../images/agent-1-3-logs.png?width=50vw"></a></p><h3 id=test--validate>Test & Validate</h3><p>Delete the existing <code>./agent.out</code> file, then restart your collector with your new config to test it:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>WORKSHOP<span class=o>]</span>/otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p>Again, if you have done everything correctly, the last line of the output should be:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.116.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p>Send a trace again, check the agent.out, a new line should have been written for your trace:</p><div class=tab-panel data-tab-group=5f4fed5046bc540b14b06de6ab038275><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compact-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5f4fed5046bc540b14b06de6ab038275","compact-json")'>
<span class=tab-nav-text>Compact JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5f4fed5046bc540b14b06de6ab038275","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compact-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some value&#34;</span><span class=p>}}],</span><span class=nt>&#34;status&#34;</span><span class=p>:{}}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.service&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.environment&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some value&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>If you compare it to the original agent.out file you will note, the collector has added the <code>otelcol.service.mode</code> attribute and a number of <code>resourcedetection</code> & <code>resource</code> attributes to the <code>resourceSpans</code> section of the trace. These values are based on your device and added automatically as part of the processors we added to the pipeline:</p><div class=tab-panel data-tab-group=544f200d0aa001483770c716d30af9d0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compact-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("544f200d0aa001483770c716d30af9d0","compact-json")'>
<span class=tab-nav-text>Compact JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("544f200d0aa001483770c716d30af9d0","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compact-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}}</span><span class=err>,</span><span class=p>{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}}</span><span class=err>,</span><span class=p>{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=err>,</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=err>,</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 20, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=adding-the-hostmetric-receiver>Adding the Hostmetric Receiver</h1><h3 id=setup>Setup</h3><p>As a last exercise in this section, we are going to add a metric receiver that triggers at startup, then scrapes once every hour (to reduce spam):</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><p>Add <code>hostmetrics:</code> under the <code>receiver:</code> key</p><ul><li>Add <code>collection_interval:</code> key and set a value of <code>3600s</code> *(once every hour)</li><li>Add <code>scrapers:</code> key<ul><li>add <code>cpu:</code> key</li></ul></li></ul></li><li><p>Add the <code>hostmetrics</code> receiver to the receivers array in the <code>metrics:</code> pipeline (leaving <code>otlp</code> as the first one )</p></li></ul></div></details><p>Validate again with <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. Given we updated the <code>metrics:</code> pipeline your result should look like this:</p><p><a href=#R-image-2d3cbd4960cbef17e8368a49513591d2 class=lightbox-link><img alt=otelbin-a-1-4-metrics class="noborder lazy lightbox noshadow figure-image" loading=lazy src="../../images/agent-1-4-metrics.png?width=50vw" style=height:auto;width:50vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2d3cbd4960cbef17e8368a49513591d2><img alt=otelbin-a-1-4-metrics class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src="../../images/agent-1-4-metrics.png?width=50vw"></a></p><p>If <strong>otelbin.io</strong> complains about the scrapers entry, make sure you select the Splunk OpenTelemetry Collector from the validation target drop down at the top of the screen.</p><h3 id=test--validate>Test & Validate</h3><p>Delete the current agent.out, then restart the agent again using the agent.yaml. Based on the current config, the collector should write some metric lines to your agent.out at startup, then will repeat that every hour. The output from agent.out looks like this:</p><p>Note that we show the entries for <strong>cpu1</strong> only, you will get cpu entries for all the cpu&rsquo;s/cores present in your system.</p><p>Also note that in the <code>resourceMetrics</code> section you will find the same attributes added as with the trace we looked at earlier, these will help with corelating between traces and metrics.</p><div class=tab-panel data-tab-group=79570d952b1dff28cef25922c8fb3019><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("79570d952b1dff28cef25922c8fb3019","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("79570d952b1dff28cef25922c8fb3019","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceMetrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_HOST_NAME&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_OS&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeMetrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver/internal/scraper/cpuscraper&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;v0.116.0&#34;</span><span class=p>},</span><span class=nt>&#34;metrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;system.cpu.time&#34;</span><span class=p>,</span><span class=nt>&#34;description&#34;</span><span class=p>:</span><span class=s2>&#34;Total seconds each logical CPU spent on each mode.&#34;</span><span class=p>,</span><span class=nt>&#34;unit&#34;</span><span class=p>:</span><span class=s2>&#34;s&#34;</span><span class=p>,</span><span class=nt>&#34;sum&#34;</span><span class=p>:{</span><span class=nt>&#34;dataPoints&#34;</span><span class=p>:[{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;user&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>1028590.93</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;system&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>447490.75</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;idle&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>553542.9</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;interrupt&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu1&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;user&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>1029342.54</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu1&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;system&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>441906.19</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu1&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;idle&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>558385.54</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu1&#34;</span><span class=p>}}]}]}}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceMetrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_HOST_NAME&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_OS&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeMetrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver/internal/scraper/cpuscraper&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;v0.116.0&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;metrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;system.cpu.time&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Total seconds each logical CPU spent on each mode.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;unit&#34;</span><span class=p>:</span> <span class=s2>&#34;s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;sum&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;dataPoints&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>1028590.93</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>447490.75</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;idle&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>553542.9</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;interrupt&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu1&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>1029342.54</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu1&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>441906.19</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu1&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;idle&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1736873595700306000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>558385.54</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu1&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>]</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Stop the agent for now using <code>Command-c/Ctrl-c</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 20, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=route-data-though-a-gateway>Route data though a gateway</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<h3 id=gateway-setup>Gateway Setup</h3><p>In the location where you are running the workshop on your machine, create a new sub directory called <strong>2-gateway</strong>, then copy the last version of the <code>agent.yaml</code> and the <code>trace.json</code> we made earlier across to the new directory.</p><p>Move into the <code>[WORKSHOP]/2-gateway</code> directory and create a file called <code>gateway.yaml</code> and copy the following starting config in it.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span><span class=w> </span><span class=c># Note, the port number is 1000 higher then the regular port number since we going to run two collectors on the same machine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># Note, this will enable token pass through mode, more on this later</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w>     
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>debug]</span></span></span></code></pre></div><p>Let&rsquo;s start with our next exercise:</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Lets create a separate file exporter for <code>traces:</code>, <code>metrics:</code> and <code>logs:</code></p><ul><li><p>Add <code>file:</code> under the <code>exporter:</code> key and name it <code>/traces:</code></p><ul><li>Add <code>path:</code> key with a value of <code>"./gateway-traces.out"</code></li><li>Add <code>rotation:</code> key<ul><li>Add <code>max_megabytes:</code> key and set a value of <code>2</code> # This set the max size for the file exporter output file</li><li>Add <code>max_backups:</code> key and set a value of <code>2</code> # This will set the max number rotational backup it creates</li></ul></li></ul></li><li><p>Add it as the first exporter to the exporter array in the <code>traces:</code> pipeline (leaving <code>debug</code> as a second exporter).</p></li><li><p>Repeat the above two more time, only name them <code>/metrics:</code> and <code>/logs:</code>, with path being <code>./gateway-metrics.out</code> and <code>./gateway-logs.out</code> respectively and add them to the relevant pipeline</p></li></ul></div></details><p>Verify your gateway.yaml with <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. If done correctly your sections should like this <code>Logs:</code> example:</p><p><a href=#R-image-a440a80fd1eaf65b35de174984f2ade9 class=lightbox-link><img alt=otelbin-logs class="noborder lazy lightbox noshadow figure-image" loading=lazy src="../images/gateway-2-1-logs.png?width=50vw" style=height:auto;width:50vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a440a80fd1eaf65b35de174984f2ade9><img alt=otelbin-logs class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src="../images/gateway-2-1-logs.png?width=50vw"></a></p><p>Note: we will explain the <code>batch:</code> key in the next section.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 20, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 2. Gateway Setup</h1><article class=default><header class=headline></header><h1 id=test-the-gateway-and-prepare-the-agent>Test the gateway and prepare the agent</h1><h2 id=test-gateway>Test Gateway</h2><p>Start an other shell, make sure your in your [WORKSHOP]/2-gateway folder and run the following command in the new shell to test your gateway configuration.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]/otelcol --config=gateway.yaml</span></span></code></pre></div><p>If you have done everything correctly, the first and the last lines of the output should be:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025/01/15 15:33:53 settings.go:478: Set config to [gateway.yaml]
</span></span><span class=line><span class=cl>&lt;snip to the end&gt;
</span></span><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.116.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div><hr><h3 id=change-agent-config>Change agent config</h3><p>Again, check if you in your [WORKSHOP]/2-gateway folder. Open the agent.yaml we copied earlier in your editor, and let&rsquo;s add the <code>OTLP/HTTP</code> exporter to the agent.yaml - <em>This is the new preferred exporter for Splunk Observability Cloud</em>:</p><p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><p>Add <code>otlphttp:</code> under the <code>exporter:</code> key</p><ul><li>Add <code>endpoint:</code> key and set it to a value of <code>"http://localhost:5318"</code> * note that we use the port of the gateway</li><li>Add <code>headers:</code> key<ul><li>Add <code>X-SF-Token:</code> key and set it with a fake access token like <code>"FAKE_SPLUNK_ACCESS_TOKEN"</code></li></ul></li></ul></li><li><p>Add <code>batch:</code> under the <code>protocol:</code> key</p><ul><li>Add <code>X-SF-Token:</code> key</li></ul></li><li><p>Add <code>otlphttp</code> as the first exporter in all the <code>exporter</code> arrays of the pipelines. (Replace <code>file</code> and leave debug in place)</p></li><li><p>Add <code>batch</code> to the array list of the <code>processor:</code> section of all pipelines</p></li></ul></div></details><br>Again, validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong> As example here is the result for the <code>metrics</code> pipeline:</p><p><a href=#R-image-8b3d6c9d9e207bab180ea186b4e90a34 class=lightbox-link><img alt=otelbin-g-2-2-metrics class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/gateway-2-2-metrics.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8b3d6c9d9e207bab180ea186b4e90a34><img alt=otelbin-g-2-2-metrics class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/gateway-2-2-metrics.png></a></p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>The <strong>otlphttp</strong> exporter is now the default method to send metric and traces to Splunk Observability Cloud.</p><p>This component is included in the default configuration of the Splunk Distribution of the OpenTelemetry Collector to send traces and metrics to Splunk Observability Cloud when deploying in host monitoring (agent) mode</p><p>The older <em>sapm</em> and <em>signalfx</em> exporters will be phased out over time.</p><p>The <code>headers:</code> key with its sub key <code>X-SF-Token:</code> is the OpenTelemetry way to pass a access token.</p><p>To enable the passthrough mode, we did set <code>include_metadata:</code> to <code>true</code> on the <code>otlp</code> receiver in the gateway. Itâ€™ll ensure that headers passed to the collector are passed along with the data down in the collectorâ€™s pipeline.</p><p>The <code>batch:</code> section with they key <code>X-SF-Token:</code> will make sure that the collector will batch or group traces, metrics and logs together with the same Access_Token before being send to the backend for efficiency and performance.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 21, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=testing-the-route-from-agent-via-gateway>Testing the Route from agent via gateway</h1><h2 id=validate-agent-and-gateway-routing>Validate Agent and Gateway routing</h2><p>Verify the gateway is running in its own shell and is ready to receive data, then in the agent shell, start the agent with:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>WORKSHOP<span class=o>]</span>/otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p>The agent should start to send <em>cpu</em> metrics again and both the agent and the gateway should reflect that in their debug output similar like the following snippet from the console&rsquo;s:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NumberDataPoints #37
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>     -&gt; cpu: Str(cpu9)
</span></span><span class=line><span class=cl>     -&gt; state: Str(system)
</span></span><span class=line><span class=cl>StartTimestamp: 2024-12-09 14:18:28 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-01-15 15:27:51.319526 +0000 UTC
</span></span><span class=line><span class=cl>Value: 9637.660000
</span></span><span class=line><span class=cl>NumberDataPoints #38
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>     -&gt; cpu: Str(cpu9)
</span></span><span class=line><span class=cl>     -&gt; state: Str(idle)
</span></span><span class=line><span class=cl>StartTimestamp: 2024-12-09 14:18:28 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-01-15 15:27:51.319526 +0000 UTC
</span></span><span class=line><span class=cl>Value: 2064591.290000
</span></span><span class=line><span class=cl>NumberDataPoints #39
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>     -&gt; cpu: Str(cpu9)
</span></span><span class=line><span class=cl>     -&gt; state: Str(interrupt)
</span></span><span class=line><span class=cl>StartTimestamp: 2024-12-09 14:18:28 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-01-15 15:27:51.319526 +0000 UTC
</span></span><span class=line><span class=cl>Value: 0.000000
</span></span><span class=line><span class=cl>    {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;metrics&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><p>At the the moment you started the agent, it did collect the above metrics and send it along towards the gateway.<br>The Otel collector running <code>gateway</code> mode should have created a file called <code>./gateway-metrics.out</code> as part of the exporting phase of the pipeline service.</p><p>Check to see if <code>gateway-metrics.out</code> has been created. It should contain at leasts the following metrics for <code>cpu1</code></p><div class=tab-panel data-tab-group=0ee2c1c5a65a6017eb988569dcaccdae><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compact-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0ee2c1c5a65a6017eb988569dcaccdae","compact-json")'>
<span class=tab-nav-text>Compact JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("0ee2c1c5a65a6017eb988569dcaccdae","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compact-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceMetrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_HOST_NAME&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_OS&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeMetrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver/internal/scraper/cpuscraper&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;v0.116.0&#34;</span><span class=p>},</span><span class=nt>&#34;metrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;system.cpu.time&#34;</span><span class=p>,</span><span class=nt>&#34;description&#34;</span><span class=p>:</span><span class=s2>&#34;Total seconds each logical CPU spent on each mode.&#34;</span><span class=p>,</span><span class=nt>&#34;unit&#34;</span><span class=p>:</span><span class=s2>&#34;s&#34;</span><span class=p>,</span><span class=nt>&#34;sum&#34;</span><span class=p>:{</span><span class=nt>&#34;dataPoints&#34;</span><span class=p>:[{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;user&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>1168005.59</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;system&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>504260.9</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;idle&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>615648.75</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;interrupt&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu1&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;user&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>1168999.03</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu1&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;system&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>497785.47</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu1&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;idle&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>621140.39</span><span class=p>},{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu1&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;interrupt&#34;</span><span class=p>}}]}]}}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceMetrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_HOST_NAME&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_OS&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeMetrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver/internal/scraper/cpuscraper&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;v0.116.0&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;metrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;system.cpu.time&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Total seconds each logical CPU spent on each mode.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;unit&#34;</span><span class=p>:</span> <span class=s2>&#34;s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;sum&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;dataPoints&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>1168005.59</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>504260.9</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;idle&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>615648.75</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;interrupt&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu1&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>1168999.03</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu1&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>497785.47</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu1&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;idle&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>621140.39</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu1&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;interrupt&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>]</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div>Next, check if you copied the `trace.json` across to the `2-gateway` folder. Make sure both the gateway and the agent are running in their own shell, then in a 3rd shell run the curl command to send a trace:<div class=tab-panel data-tab-group=3fd2955de22e96c5986f86a206baaf22><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3fd2955de22e96c5986f86a206baaf22","curl-command")'>
<span class=tab-nav-text>cURL Command</span>
</button>
<button data-tab-item=debug-output-agentgateway class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("3fd2955de22e96c5986f86a206baaf22","debug-output-agentgateway")'>
<span class=tab-nav-text>Debug Output Agent/Gateway</span></button></div><div class=tab-content-container><div data-tab-item=curl-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl> <span class=nb>curl </span><span class=n>-X</span> <span class=n>POST</span> <span class=n>-i</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>localhost</span><span class=err>:</span><span class=mf>4318</span><span class=p>/</span><span class=n>v1</span><span class=p>/</span><span class=n>traces</span> <span class=n>-H</span> <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=n>-d</span> <span class=s2>&#34;@trace.json&#34;</span></span></span></code></pre></div></div></div><div data-tab-item=debug-output-agentgateway class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-13T13:26:13.502+0100 info Traces {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>2025-01-13T13:26:13.502+0100 info ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL:
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>    -&gt; service.name: Str(my.service)
</span></span><span class=line><span class=cl>    -&gt; deployment.environment: Str(my.environment)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope my.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>    -&gt; my.scope.attribute: Str(some scope attribute)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>   Trace ID       : 5b8efff798038103d269b633813fc60c
</span></span><span class=line><span class=cl>   Parent ID      : eee19b7ec3c1b173
</span></span><span class=line><span class=cl>   ID             : eee19b7ec3c1b174
</span></span><span class=line><span class=cl>   Name           : I&#39;m a server span
</span></span><span class=line><span class=cl>   Kind           : Server
</span></span><span class=line><span class=cl>   Start time     : 2018-12-13 14:51:00 +0000 UTC
</span></span><span class=line><span class=cl>   End time       : 2018-12-13 14:51:01 +0000 UTC
</span></span><span class=line><span class=cl>   Status code    : Unset
</span></span><span class=line><span class=cl>   Status message :
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>    -&gt; : Str(some value)
</span></span><span class=line><span class=cl> {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div></div></div></div></div><p>Now the gateway should have generated a new file called <code>./gateway-traces.out</code> and it should contain the following trace:</p><div class=tab-panel data-tab-group=78308fd9ded1935ec625c521ee0bc469><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("78308fd9ded1935ec625c521ee0bc469","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("78308fd9ded1935ec625c521ee0bc469","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_HOST_NAME&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_OS&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some value&#34;</span><span class=p>}}],</span><span class=nt>&#34;status&#34;</span><span class=p>:{}}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.service&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.environment&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;PIHAGEN-M-2QPQ.hagen-ict.nl&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;darwin&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some value&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Note that both the <code>./gateway-metrics.out</code> and the <code>./gateway-traces.out</code> have a resource metric/attribute key <code>"otelcol.service.mode"</code> with a value of <code>"agent"</code></p><p>We will correct that in a later section.<br>Stop the Agent and Gateway that are running using <code>Command-c/Ctrl-c</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 21, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=filelog-receiver>Filelog Receiver</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <code>FileLog</code> receiver in the OpenTelemetry Collector is used to ingest logs from files. It monitors specified files for new log entries and streams those logs into the Collector for further processing or exporting. It is useful for testing and development purposes.</p><p>The Filelog receiver is not recommended for production use, as it is not optimized for performance but can be useful in a pinch. For this part of the workshop, there is script that will generate log lines in a file. The Filelog receiver will read these log lines and send them to the OpenTelemetry Collector.</p><h3 id=setup>Setup</h3><p>Create a new sub directory called <code>3-filelog</code> and copy the content from <code>2-gateway</code> across. Delete any <code>*.out</code> files.</p><p>Copy one of the two version below and create the appropriate log generation script for your operating system in the new directory (<code>log-gen.sh</code> on Mac or Linux or <code>log-gen.ps1</code> for Windows). Make sure its executable.</p><p>Once we started the log-gen script the directory structure will look like this:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ agent.yaml          # Agent Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway.yaml        # Gateway Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ log-gen.(sh or ps1) # Script to write a file with logs lines 
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ quotes.log          # File containing Random log lines
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json          # Example trace file 
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol                 # OpenTelemetry Collector binary</span></span></code></pre></div><div class=tab-panel data-tab-group=1c604619d741075aa3eae481040d9ce0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-gensh-maclinux class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1c604619d741075aa3eae481040d9ce0","log-gensh-maclinux")'>
<span class=tab-nav-text>log-gen.sh (Mac/Linux)</span>
</button>
<button data-tab-item=log-genps1-windows class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("1c604619d741075aa3eae481040d9ce0","log-genps1-windows")'>
<span class=tab-nav-text>log-gen.ps1 (Windows)</span></button></div><div class=tab-content-container><div data-tab-item=log-gensh-maclinux class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># Define the log file</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_FILE</span><span class=o>=</span><span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define quotes</span>
</span></span><span class=line><span class=cl><span class=nv>LOTR_QUOTES</span><span class=o>=(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;One does not simply walk into Mordor.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Even the smallest person can change the course of the future.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;All we have to decide is what to do with the time that is given us.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;There is some good in this world, and it&#39;s worth fighting for.&#34;</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>STAR_WARS_QUOTES</span><span class=o>=(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Do or do not, there is no try.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;The Force will be with you. Always.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;I find your lack of faith disturbing.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;In my experience, there is no such thing as luck.&#34;</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Function to get a random quote</span>
</span></span><span class=line><span class=cl>get_random_quote<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>((</span> RANDOM % <span class=nv>2</span> <span class=o>==</span> <span class=m>0</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>LOTR_QUOTES</span><span class=p>[RANDOM % </span><span class=si>${#</span><span class=nv>LOTR_QUOTES</span><span class=p>[@]</span><span class=si>}</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>STAR_WARS_QUOTES</span><span class=p>[RANDOM % </span><span class=si>${#</span><span class=nv>STAR_WARS_QUOTES</span><span class=p>[@]</span><span class=si>}</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Function to get a random log level</span>
</span></span><span class=line><span class=cl>get_random_log_level<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>LOG_LEVELS</span><span class=o>=(</span><span class=s2>&#34;INFO&#34;</span> <span class=s2>&#34;WARN&#34;</span> <span class=s2>&#34;ERROR&#34;</span> <span class=s2>&#34;DEBUG&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>LOG_LEVELS</span><span class=p>[RANDOM % </span><span class=si>${#</span><span class=nv>LOG_LEVELS</span><span class=p>[@]</span><span class=si>}</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Write log entries in Log4j format</span>
</span></span><span class=line><span class=cl>generate_log_entry<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>TIMESTAMP</span><span class=o>=</span><span class=k>$(</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>LEVEL</span><span class=o>=</span><span class=k>$(</span>get_random_log_level<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>MESSAGE</span><span class=o>=</span><span class=k>$(</span>get_random_quote<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$TIMESTAMP</span><span class=s2> [</span><span class=nv>$LEVEL</span><span class=s2>] - </span><span class=nv>$MESSAGE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Main loop to write logsdate</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Writing logs to </span><span class=nv>$LOG_FILE</span><span class=s2>. Press Ctrl+C to stop.&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    generate_log_entry &gt;&gt; <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    sleep <span class=m>1</span> <span class=c1># Adjust this value for log frequency</span>
</span></span><span class=line><span class=cl><span class=k>done</span></span></span></code></pre></div></div></div><div data-tab-item=log-genps1-windows class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Define the log file</span>
</span></span><span class=line><span class=cl><span class=nv>$LogFile</span> <span class=p>=</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Define quotes</span>
</span></span><span class=line><span class=cl><span class=nv>$LOTRQuotes</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;One does not simply walk into Mordor.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Even the smallest person can change the course of the future.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;All we have to decide is what to do with the time that is given us.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;There is some good in this world, and it&#39;s worth fighting for.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$StarWarsQuotes</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Do or do not, there is no try.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;The Force will be with you. Always.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;I find your lack of faith disturbing.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;In my experience, there is no such thing as luck.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Function to get a random quote</span>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-RandomQuote</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=nb>Get-Random</span> <span class=n>-Minimum</span> <span class=mf>0</span> <span class=n>-Maximum</span> <span class=mf>2</span><span class=p>)</span> <span class=o>-eq</span> <span class=mf>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$LOTRQuotes</span> <span class=p>|</span> <span class=nb>Get-Random</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$StarWarsQuotes</span> <span class=p>|</span> <span class=nb>Get-Random</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Function to generate a log entry</span>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Generate-LogEntry</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Timestamp</span> <span class=p>=</span> <span class=nb>Get-Date</span> <span class=n>-Format</span> <span class=s2>&#34;yyyy-MM-dd HH:mm:ss&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$LogLevel</span> <span class=p>=</span> <span class=nb>Get-Random</span> <span class=n>-InputObject</span> <span class=s2>&#34;INFO&#34;</span><span class=p>,</span> <span class=s2>&#34;WARN&#34;</span><span class=p>,</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span> <span class=s2>&#34;DEBUG&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Message</span> <span class=p>=</span> <span class=nb>Get-RandomQuote</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;</span><span class=nv>$Timestamp</span><span class=s2> [</span><span class=nv>$LogLevel</span><span class=s2>] - </span><span class=nv>$Message</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Main loop to write logs</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Writing logs to </span><span class=nv>$LogFile</span><span class=s2>. Press Ctrl+C to stop.&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=vm>$true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$LogEntry</span> <span class=p>=</span> <span class=nb>Generate-LogEntry</span>
</span></span><span class=line><span class=cl>    <span class=nb>Add-Content</span> <span class=n>-Path</span> <span class=nv>$LogFile</span> <span class=n>-Value</span> <span class=nv>$LogEntry</span>
</span></span><span class=line><span class=cl>    <span class=nb>Start-Sleep</span> <span class=n>-Seconds</span> <span class=mf>1</span> <span class=c># Adjust this value for log frequency</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Run the new log generating script in its own shell and it will start writing lines to a file called <code>./quotes.log</code>, and the console output a single line:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>Writing logs to quotes.log. Press Ctrl+C to stop.</span></span></code></pre></div><p>Leave it running.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 3. Filelog Receiver</h1><article class=default><header class=headline></header><h1 id=configure-the-filelog-receiver-in-the-agent>Configure the filelog receiver in the agent</h1><h3 id=update-the-agent-configuration>Update the agent configuration</h3><p>Check that you are in the <code>[WORKSHOP]/3-filelog</code> folder. Open the <code>agent.yaml</code> copied across earlier and in your editor and add the <code>filelog</code> receiver to the <code>agent.yaml</code>.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li><p>Add <code>filelog</code> under the <code>receivers:</code> key and name it <code>./quotes:</code></p><ul><li>Add <code>include:</code> key and set it to a value of <code>[./quotes.log]</code></li><li>Add <code>include_file_path:</code> key and set it to a value of <code>true</code></li><li>Add <code>include_file_name:</code> key and set it to a value of <code>false</code></li><li>Add <code>resource:</code> key<ul><li>Add <code>com.splunk.source:</code> key and set it to a value of <code>./quotes.log</code></li><li>Add <code>com.splunk.sourcetype:</code> key and set it to a value of <code>quotes</code></li></ul></li></ul></li><li><p>Add <code>filelog/quotes</code> receiver to the <code>receivers:</code> array in the <code>logs:</code> section of the pipelines. (make sure it also contains <code>otlp</code>)</p></li></ul></div></details><p>Again validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>, the results for the <code>Logs:</code> pipeline should look like this:</p><p><a href=#R-image-3dfe07273043238ac2b87a40e24fe8e8 class=lightbox-link><img alt=otelbin-f-3-1-logs class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/filelog-3-1-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3dfe07273043238ac2b87a40e24fe8e8><img alt=otelbin-f-3-1-logs class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/filelog-3-1-logs.png></a></p><hr><h2 id=test-the-filelog-receiver>Test the Filelog receiver</h2><p>From the <code>[WORKSHOP]/3-filelog</code> folder, start the collector in <code>gateway</code> mode in its own shell and wait until it is ready to receive data. Next, make sure the quotes generating script is running its own shell</p><p>Once we start the agent, the resulting file structure will change to this:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ agent.yaml          # Agent Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway-logs.out.   # Output from the gateway logs pipeline
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway-metrics.out # Output from the gateway metrics pipeline
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway.yaml        # Gateway Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ log-gen.(sh or ps1) # Script to write a file with logs lines 
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ quotes.log          # File containing Random log lines
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json          # Example trace file 
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol                 # OpenTelemetry Collector binary</span></span></code></pre></div><p>To test teh <code>Filelog</code> receiver, start the agent in a 3rd shell with:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p>The agent should start to send <em>cpu</em> metrics again as before. However, the agent should also start reading the <code>quotes.log</code> file,and both the agent and the gateway should reflect that in their debug output lke this:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-18T21:25:01.806+0100    info    ResourceLog #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>     -&gt; com.splunk/source: Str(./quotes.log)
</span></span><span class=line><span class=cl>     -&gt; host.name: (YOUR_HOST_NAME)
</span></span><span class=line><span class=cl>     -&gt; os.type: Str(YOUR_OS)
</span></span><span class=line><span class=cl>     -&gt; otelcol.service.mode: Str(agent)
</span></span><span class=line><span class=cl>ScopeLogs #0
</span></span><span class=line><span class=cl>ScopeLogs SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope
</span></span><span class=line><span class=cl>LogRecord #0
</span></span><span class=line><span class=cl>ObservedTimestamp: 2025-01-18 20:25:01.7201606 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-01-18 21:25:01 [WARN] - Do or do not, there is no try.)
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>Trace ID:
</span></span><span class=line><span class=cl>Span ID:
</span></span><span class=line><span class=cl>Flags: 0
</span></span><span class=line><span class=cl>        {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><p>As the agent is reading the <code>quotes.log</code> file it will forward those log line to the gateway. The gateway pipeline should cause the <code>gateway-log.out</code> file to be generated with the following output:</p><div class=tab-panel data-tab-group=46d47c743206ed648575df1bafc5793b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("46d47c743206ed648575df1bafc5793b","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("46d47c743206ed648575df1bafc5793b","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{},</span><span class=nt>&#34;logRecords&#34;</span><span class=p>:[{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737231901720160600&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-01-18 21:25:01 [WARN] - Do or do not, there is no try.&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;PH-Windows-Box.hagen-ict.nl&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;windows&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{},</span><span class=nt>&#34;logRecords&#34;</span><span class=p>:[{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737231902719133000&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-01-18 21:25:02 [DEBUG] - One does not simply walk into Mordor.&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;./quotes.log&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;logRecords&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737231902719133000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-01-18 21:25:02 [DEBUG] - One does not simply walk into Mordor.&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Note that the <code>resoureLogs</code> section contains the same attributes as we saw in <code>traces</code> and <code>metrics</code>. This mechanism is what will drive <code>related content</code> in Splunk Observability and refers to the seamless linking and contextual correlation between logs, metrics, traces, and dashboards. This feature is designed to help users quickly identify and investigate issues by providing a unified view of related telemetry data. Instead of treating each data type in isolation, Splunk Observability connects them, enabling faster troubleshooting and root cause analysis.</p><div class=tab-panel data-tab-group=6baf60efd560f6a955a8bee81d26caeb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6baf60efd560f6a955a8bee81d26caeb","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6baf60efd560f6a955a8bee81d26caeb","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]}}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;./quotes.log&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Stop the Agent, Gateway and the Quotes generating script as well using <code>Command-c/Ctrl-c</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 21, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=building-resilience-in-opentelemetry-collector-using-the-file-storage-extension>Building Resilience in OpenTelemetry Collector Using the File Storage Extension</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>We will walk through how to use OpenTelemetry Collectorâ€™s <code>file_storage</code> extension to build resilience into your telemetry pipeline. Specifically, we will demonstrate how to use the file storage extension for checkpointing, managing retries, and handling temporary failures effectively.</p><p>The goal is to show how this configuration allows your OpenTelemetry Collector to reliably store intermediate states on disk, ensuring that no data is lost during network failures, and that the collector can resume where it left off.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><ul><li>This will only be useful if the connections fails for a short period like up to 15 minutes or so. If the connection is down for longer periods, the backend will drop the data anyways because the timing&rsquo;s are too far out of synch.</li><li>This will works for logs, but we will introduce a more robust solution in one of the upcoming collector builds.</li></ul></div></details><h3 id=setup>Setup</h3><p>Create a new sub directory called <code>4-resilience</code> and copy the content from <code>3-filelog</code> across and remove any *.out file. Your starting point for this exercise should be:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”œâ”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ log-gen.sh
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ quotes.log
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol</span></span></code></pre></div><p>In this exercise we are going to update the agent.yaml by adding an <code>extensions:</code> section.
This new section in an OpenTelemetry configuration YAML is used to define optional components that enhance or modify the behavior of the OpenTelemetry Collector. These components donâ€™t handle telemetry data directly but provide additional capabilities or services to the Collector.
The first exercise will be providing <strong>Checkpointing</strong> with the <code>file_storage</code> extension.<br>The <code>file_storage</code> extension is used to ensure that the OpenTelemetry Collector can persist checkpoints to disk. This is especially useful in cases where there are network failures or restarts. This way, the collector can recover from where it left off without losing data.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Let&rsquo;s add the extension part first:</p><ol><li><strong>Add</strong> <code>extensions:</code> <strong>section</strong>: Place this at the top of the <code>agent.yaml</code>.</li><li><strong>Add</strong> <code>file_storage</code> <strong>extension</strong>: Under the <strong>extensions</strong> section. Name it <code>/checkpoint:</code>.</li><li><strong>Add</strong> <code>directory:</code> <strong>key</strong>: under the <code>file_storage</code> extension and set it to a value of <code>"./checkpoint-folder"</code></li><li><strong>Add</strong> <code>create_directory:</code> <strong>key</strong>: Set the Value to <code>true</code>.</li><li><strong>Add</strong> <code>timeout:</code> <strong>key</strong>: Set the value to <code>1s</code>.</li><li><strong>Add</strong> <code>compaction:</code> <strong>key</strong> section.</li><li><strong>Add</strong> <code>on_start:</code> <strong>key</strong>: Under the <code>compaction:</code> section, set the value to ``true`.</li><li><strong>Add</strong> <code>directory:</code> <strong>key</strong>: Set the value to <code>./checkpoint-folder/tmp</code>.</li><li><strong>Add</strong> <code>max_transaction_size:</code> <strong>key</strong>: Set it to a value of <code>65_536</code></li></ol></div></details><p><strong>Explanation:</strong></p><ul><li><code>directory: ./checkpoint-folder</code>: Defines the folder where checkpoint files will be stored.</li><li><code>create_directory: true</code>: Ensures that the directory is created if it doesnâ€™t already exist.</li><li><code>timeout: 1s</code>: Specifies a timeout for file operations related to the checkpointing.</li><li><code>compaction</code>: Ensures that old checkpoint data is compacted periodically.<ul><li><code>on_start: true</code> : Determines whether the compaction process begins immediately when the OpenTelemetry Collector starts.</li><li><code>directory:</code> <code>./checkpoint-folder/tmp</code>: Specifies the directory used for compaction (as a midstep).</li><li><code>max_transaction_size</code> defines the size limit for checkpoint transactions before compaction occurs.</li></ul></li></ul><p>The next exercise is modifying the <code>otlphttp:</code> exporter where retries and queueing are configured.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>We are going to extend the existing <code>otlphttp</code> exporter:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;localhost:5317&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;FAKE_SPLUNK_ACCESS_TOKEN&#34;</span><span class=w> </span><span class=c># or your own version of a token</span></span></span></code></pre></div><p><strong>Steps:</strong></p><ol><li><strong>Add</strong> <code>tls:</code> <strong>key</strong>: Place at the same indent level as <code>headers:</code>.</li><li><strong>Add</strong> <code>insecure:</code> <strong>key</strong>: Under the <code>tls:</code> key and set its value to <code>true</code>.</li><li><strong>Add</strong> <code>retry_on_failure:</code> <strong>key</strong>: Place at the same indent level as <code>headers:</code>.</li><li><strong>Add</strong> <code>enabled:</code> <strong>key</strong>: Under the <code>retry_on_failure:</code> key and set its value to <code>true</code>.</li><li><strong>Add</strong> <code>sending_queue:</code> <strong>key</strong>:</li><li><strong>Add</strong> <code>enabled:</code> <strong>key</strong>: Under the <code>sending_queue:</code> key and set its value to <code>true</code>.</li><li><strong>Add</strong> <code>num_consumers:</code> <strong>key</strong>: Set its value to <code>10</code></li><li><strong>Add</strong> <code>queue_size:</code> <strong>key</strong>: Set its value to <code>10000</code></li><li><strong>Add</strong> <code>storage:</code> <strong>key</strong>: Set its value to <code>file_storage/checkpoint</code></li></ol></div></details><p><strong>Explanation:</strong></p><ul><li><code>retry_on_failure.enabled: true</code>: Enables retrying when there is a failure in sending data to the OTLP gateway.</li><li><code>sending_queue</code>: Configures an internal queue to store data that couldnâ€™t be sent. The <code>storage</code> option links the queue to the <code>file_storage/checkpoint</code> extension, ensuring resilience even in case of network failures.<ul><li><code>num_consumers: 10</code>: Specifies the number of consumers reading from the queue.</li><li><code>queue_size: 10000</code>: The maximum size of the queue.</li><li><code>storage: file_storage/checkpoint</code>: Specifies that the queue state will be backed up in the file system.</li></ul></li></ul><p>Again, validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong> for spelling mistakes etc. Your <code>Logs:</code> pipeline should like this:</p><p><a href=#R-image-0be75d999303e8b249364869ce2224b7 class=lightbox-link><img alt="logs from otelbin" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../images/filelog-3-1-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0be75d999303e8b249364869ce2224b7><img alt="logs from otelbin" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../images/filelog-3-1-logs.png></a></p><p>This setup ensures your OpenTelemetry Collector can handle network interruptions gracefully by storing telemetry data on disk and retrying failed transmissions. It combines checkpointing for recovery and queueing for efficient retries, making your pipeline more resilient and reliable. Now, letâ€™s test this configuration!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 4. Resilience</h1><article class=default><header class=headline></header><h1 id=test-your-resilience-setup>Test your Resilience Setup</h1><h3 id=step-1-setup-test-environment>Step 1: Setup Test environment</h3><p>In this section we are going to simulate an out age on the network and see if our configuration helps the Collector recover from that issue:</p><ol><li><p><strong>Run the Gateway</strong>
Now, run the OpenTelemetry Collector using the existing gateway configuration file. You can do this by executing the following command in your terminal:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config gateway.yaml</span></span></code></pre></div></li><li><p><strong>Run the Agent</strong>
Next, run the OpenTelemetry Collector using the configuration file you just created. You can do this by executing the following command in your terminal:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config agent.yaml</span></span></code></pre></div><p>This will start the collector with the resilience configurations specified in the YAML file.</p></li><li><p><strong>Run the log-gen script</strong>
To generate traffic, we going to start our Log generating script:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./log-gen.sh </span></span></code></pre></div></li></ol><h3 id=step-2-testing-the-resilience>Step 2: Testing the Resilience</h3><p>To test the resilience built into the system:</p><ol><li><p><strong>Simulate Network Failure:</strong>
Temporarily stop the OTLP receiver or shut down the endpoint where the telemetry data is being sent. You should see the retry mechanism kicking in, as the collector will attempt to resend the data.</p></li><li><p><strong>Check the Checkpoint Folder:</strong>
After a few retries, inspect the <code>./checkpoint-folder</code> directory. You should see checkpoint files stored there, which contain the serialized state of the queue.</p></li><li><p><strong>Restart the Collector:</strong>
Restart the OpenTelemetry Collector after stopping the OTLP receiver. The collector will resume sending data from the last checkpointed state, without losing any data.</p></li><li><p><strong>Inspect Logs and Files:</strong>
Inspect the logs to see the retry attempts. The <code>debug</code> exporter will output detailed logs, which should show retry attempts and any failures.</p></li></ol><h3 id=conclusion>Conclusion</h3><p>In this section, you learned how to enhance the resilience of the OpenTelemetry Collector by configuring the <code>file_storage/checkpoint</code> extension, setting up retry mechanisms for the OTLP exporter, and using a sending queue backed by file storage for storing data during temporary failures.</p><p>By leveraging file storage for checkpointing and queue persistence, you can ensure that your telemetry pipeline can recover gracefully from failures, making it more reliable for short interruptions for production environments.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 21, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=using-a-filter-to-drop-spans-in-opentelemetry-collector>Using a Filter to Drop Spans in OpenTelemetry Collector</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, we will explore how to use the filter processor in the OpenTelemetry Collector to selectively drop spans based on certain conditions. Specifically, we will drop traces based on the span name, which is commonly used to filter out unwanted spans such as health checks or internal communication traces.</p><p>By the end of this workshop, you&rsquo;ll know how to configure the OpenTelemetry Collector to:</p><p>Filter out unwanted spans.</p><ul><li>Use the filter processor to drop spans based on span names.</li><li>Understand and customize error handling in the filter processor.</li></ul><p>Overview of the Configuration
The main processor we&rsquo;ll be working with in this workshop is the filter processor. The filter processor allows you to filter out telemetry data (traces, metrics, logs) based on conditions like span names, attributes, or other criteria. This is useful in scenarios where you want to remove noise (such as health check requests) or prevent processing of unimportant traces.</p><p>Key Configuration Overview:
Hereâ€™s the key section of the YAML configuration that defines the filter processor:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>X-SF-Token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>upsert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>filter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>span</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s1>&#39;name == &#34;/_healthz&#34;&#39;</span></span></span></code></pre></div><p>Filter Processor: The filter processor is the core of this workshop. It is configured to drop spans based on a specific condition. In this case, we are filtering out spans whose name is &ldquo;/_healthz&rdquo;, typically associated with health check requests.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>filter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>span</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;name == &#34;/_healthz&#34;&#39;</span></span></span></code></pre></div><ul><li>error_mode: ignore: When the filter processor encounters an error in its configuration or processing, it will ignore it and continue processing other traces.</li><li>traces: This section defines the conditions for filtering traces.</li><li>span: We specify that we want to drop spans with the name &ldquo;/_healthz&rdquo;, which is common for health check requests in microservices.</li></ul><h3 id=step-1-review-the-yaml-configuration>Step 1: Review the YAML Configuration</h3><p>First, weâ€™ll take a closer look at the YAML configuration used in the OpenTelemetry Collector. This configuration defines how we process and filter telemetry data:</p><p>yaml
Copy
processors:
batch:
metadata_keys:
- X-SF-Token</p><p>memory_limiter:
check_interval: 2s
limit_mib: 512</p><p>resource/add_mode:
attributes:
- action: upsert
value: &ldquo;gateway&rdquo;
key: otelcol.service.mode</p><p>filter:
error_mode: ignore
traces:
span:
- &rsquo;name == &ldquo;/_healthz&rdquo;'</p><h3 id=step-2-apply-the-configuration>Step 2: Apply the Configuration</h3><h4 id=21-save-the-configuration>2.1 Save the Configuration</h4><p>Save the above YAML configuration to a file called otel-collector-config.yaml.</p><h4 id=22-run-the-opentelemetry-collector>2.2 Run the OpenTelemetry Collector</h4><p>Now, start the OpenTelemetry Collector with your configuration:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol --config<span class=o>=</span>otel-collector-config.yaml</span></span></code></pre></div><p>This will launch the OpenTelemetry Collector and apply your filter configuration to incoming telemetry data.</p><h3 id=step-3-simulate-trace-data>Step 3: Simulate Trace Data</h3><h4 id=31-send-sample-data-to-the-collector>3.1 Send Sample Data to the Collector</h4><p>To test your configuration, you&rsquo;ll need to generate some trace data that includes a span named &ldquo;/_healthz&rdquo;. This is typically seen in health check requests that many services send to verify their status.</p><p>You can use an instrumented application to generate trace data with the span name &ldquo;/_healthz&rdquo;.
Alternatively, you can simulate trace data manually if you&rsquo;re using a test environment.
Ensure that you send some traces with the span name &ldquo;/_healthz&rdquo; to confirm that they are filtered out.</p><h4 id=32-observe-the-filter-in-action>3.2 Observe the Filter in Action</h4><p>Once the data is sent, the OpenTelemetry Collector should process it and drop any spans with the name &ldquo;/_healthz&rdquo;. You can confirm this by checking the trace data in the destination where it is exported (e.g., Jaeger, Zipkin, or any other trace backend).</p><p>Expected Outcome:</p><ul><li>Traces with the span name &ldquo;/_healthz&rdquo; should not appear in the exported trace data.</li><li>Other spans should be processed normally and appear in the backend.</li></ul><h3 id=step-4-monitor-and-debug-the-filter-processor>Step 4: Monitor and Debug the Filter Processor</h3><h4 id=41-error-mode-handling>4.1 Error Mode Handling</h4><p>If the filter processor encounters any issues, the error_mode: ignore setting will ensure that the processing continues even if there&rsquo;s an error. However, itâ€™s useful to set up logging and monitoring to ensure that the filter configuration is working as expected.</p><p>For example, check the logs of the OpenTelemetry Collector for messages related to trace filtering.</p><h4 id=42-debugging-your-filter-configuration>4.2 Debugging Your Filter Configuration</h4><p>If the filter isnâ€™t working as expected, ensure that:</p><p>The span names are correctly matched.
The filter condition is correctly specified in the YAML file.
You can also adjust the log verbosity of the OpenTelemetry Collector to get more insight into its operations.</p><h3 id=step-5-customize-the-filter>Step 5: Customize the Filter</h3><h4 id=51-modify-the-filter-condition>5.1 Modify the Filter Condition</h4><p>You can customize the filter condition to drop spans based on other criteria. For example, you might want to drop spans that have a specific tag or attribute.</p><p>Example of dropping spans based on an attribute:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>filter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>span</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;attributes[&#34;deployment.environment&#34;] == &#34;testing&#34;&#39;</span></span></span></code></pre></div><p>This filter would drop spans where the deployment.environment attribute is set to &ldquo;testing&rdquo;.</p><h4 id=52-filter-multiple-spans>5.2 Filter Multiple Spans</h4><p>You can filter out multiple span names by extending the span list:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>filter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>span</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;name == &#34;/_healthz&#34;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;name == &#34;/internal/metrics&#34;&#39;</span></span></span></code></pre></div><p>This will drop spans with the names &ldquo;/_healthz&rdquo; and &ldquo;/internal/metrics&rdquo;.</p><h3 id=conclusion>Conclusion</h3><p>Congratulations! You have successfully configured the OpenTelemetry Collector to filter and drop unwanted spans. This configuration allows you to ignore internal or irrelevant traces, such as health check requests, which can help reduce noise in your telemetry data.</p><p>You can further extend this configuration to filter out spans based on different attributes, tags, or other criteria, making the OpenTelemetry Collector more customizable and efficient for your observability needs.</p><p>Feel free to experiment with different filter conditions and explore the other processor types available in OpenTelemetry to enhance your observability pipeline.</p><h3 id=next-steps>Next Steps</h3><ul><li><strong>Extend Filtering</strong>: Add more filtering conditions based on span attributes or other metadata.</li><li><strong>Explore More Processors</strong>: Learn about other processors like attributes, batch, or memory_limiter for more advanced use cases.</li><li><strong>Integrate with Backends</strong>: Try integrating this filtered data with a backend like Jaeger, Prometheus, or any other observability platform.</li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 20, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=removing-tags-and-redacting-sensitive-data-in-opentelemetry-collector>Removing Tags and Redacting Sensitive Data in OpenTelemetry Collector</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, you&rsquo;ll learn how to configure the OpenTelemetry Collector to remove specific tags and redact sensitive data from your telemetry (traces). This is essential when dealing with sensitive information such as credit card numbers, personal data, or other security-related information that needs to be protected or anonymized.</p><p>We&rsquo;ll walk through how to configure several processors in the OpenTelemetry Collector, including:</p><ul><li><strong>Removing Tags</strong>.</li><li><strong>Redacting Sensitive Data</strong> (such as credit card numbers and account credentials).</li><li><strong>Using regular expressions to block sensitive data</strong>.</li></ul><p>By the end of this workshop, you&rsquo;ll have a working OpenTelemetry Collector configuration that securely handles sensitive telemetry data.</p><p>Hereâ€™s a breakdown of the main components:</p><p>Processors: These will handle the data removal and redaction.
Batch Processor: We&rsquo;ll use it to control how traces are batched and exported.
Memory Limiter: Ensures that the collector does not consume too much memory.
Redaction Processor: A dedicated processor for redacting sensitive data, including credit card numbers and account details.</p><h3 id=step-1-review-the-yaml-configuration>Step 1: Review the YAML Configuration</h3><p>Let&rsquo;s look at the YAML configuration for this workshop. This file contains various processors and how they are configured to remove and redact sensitive data.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Batch processor to control batch size and metadata keys</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>X-SF-Token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Memory Limiter processor to prevent excessive memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Resource detection processor to detect system resource attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>override</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Resource processor to add a new mode attribute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;agent&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Attributes processor to remove specific tags (attributes) from traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/removetags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>SPAN_TAG_KEY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Attributes processor to update or redact sensitive data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/update</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>cc_number</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>redacted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update </span><span class=w> </span><span class=c># Redacts credit card numbers with the word &#39;redacted&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>account_password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete </span><span class=w> </span><span class=c># Deletes account password attribute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>account_email</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>hash </span><span class=w> </span><span class=c># Hashes the account email for privacy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Redaction processor to apply custom redaction rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redaction/update</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>allow_all_keys</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>  </span><span class=c># Block non-allowed keys</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>allowed_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>group</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ignored_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>safe_attribute </span><span class=w> </span><span class=c># Safe attributes that wonâ€™t be redacted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>blocked_values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;4[0-9]{12}(?:[0-9]{3})?&#34;</span><span class=w>  </span><span class=c># Regular expression for Visa credit card numbers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;(5[1-5][0-9]{14})&#34;</span><span class=w>        </span><span class=c># Regular expression for MasterCard numbers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>debug </span><span class=w> </span><span class=c># Diagnostic summary of redacted attributes</span></span></span></code></pre></div><h3 id=breakdown-of-key-configurations>Breakdown of Key Configurations</h3><h4 id=1-remove-tags-attributes>1. Remove Tags (Attributes)</h4><p>The attributes/removetags processor allows you to delete specific attributes (tags) from spans. In this case, we&rsquo;re removing the tag SPAN_TAG_KEY:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>attributes/removetags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>SPAN_TAG_KEY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete</span></span></span></code></pre></div><h4 id=2-update-sensitive-data>2. Update Sensitive Data</h4><p>The attributes/update processor is used to update or redact sensitive data. We perform the following actions:</p><p>Redacting credit card numbers: Replace the cc_number with the word &ldquo;redacted&rdquo;.
Deleting the account_password field to remove passwords from traces.
Hashing the account_email to anonymize email addresses.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>attributes/update</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>actions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>cc_number</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>redacted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>account_password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>account_email</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>hash</span></span></span></code></pre></div><h4 id=3-redaction-processor>3. Redaction Processor</h4><p>The redaction/update processor provides fine-grained control over which attributes are allowed or blocked from traces. We configure this processor to:</p><p>Allow specific keys: description, group, id, and name are the only allowed attributes.
Block sensitive data: Credit card numbers matching the provided regex patterns (Visa and MasterCard) will be blocked and redacted.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>redaction/update</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allow_all_keys</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allowed_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>group</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ignored_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>safe_attribute </span><span class=w> </span><span class=c># Attributes that will not be redacted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>blocked_values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s2>&#34;4[0-9]{12}(?:[0-9]{3})?&#34;</span><span class=w>  </span><span class=c># Visa card regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s2>&#34;(5[1-5][0-9]{14})&#34;</span><span class=w>         </span><span class=c># MasterCard card regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>debug </span><span class=w> </span><span class=c># Show detailed debug information about redactions</span></span></span></code></pre></div><h3 id=step-2-apply-and-test-the-configuration>Step 2: Apply and Test the Configuration</h3><h4 id=21-save-the-configuration>2.1 Save the Configuration</h4><p>Save the YAML configuration above into a file called otel-collector-config.yaml.</p><h4 id=22-run-the-opentelemetry-collector>2.2 Run the OpenTelemetry Collector</h4><p>To run the OpenTelemetry Collector with your configuration file, use the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol --config<span class=o>=</span>otel-collector-config.yaml</span></span></code></pre></div><h3 id=23-generate-some-sample-data>2.3 Generate Some Sample Data</h3><p>To test the configuration, generate some sample telemetry data (traces) that includes sensitive attributes such as:</p><ul><li>cc_number (credit card number),</li><li>account_password (password),</li><li>account_email (email address).</li></ul><p>You can use a test application or OpenTelemetry instrumentation to simulate these traces.</p><h3 id=24-verify-the-redaction>2.4 Verify the Redaction</h3><p>After the collector processes the data, verify that:</p><ul><li>The cc_number field is redacted with the word redacted.</li><li>The account_password field is deleted.</li><li>The account_email field is hashed.</li><li>Sensitive credit card numbers (Visa, MasterCard) are properly masked using regex.</li><li>Check the exported trace data in the file or backend you&rsquo;re using.</li></ul><h3 id=step-3-debugging-and-monitoring>Step 3: Debugging and Monitoring</h3><p>If you&rsquo;re unsure whether the redaction is working correctly, the summary field in the redaction/update processor will provide helpful debug information.</p><ul><li>Set summary: debug in the configuration.</li><li>This will show detailed diagnostic information about which attributes are redacted, deleted, or updated.</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>debug </span><span class=w> </span><span class=c># Provides debug-level details on redactions</span></span></span></code></pre></div><p>This will log information about each redacted or deleted attribute, helping you troubleshoot if something is missing.</p><h3 id=step-4-advanced-configuration-optional>Step 4: Advanced Configuration (Optional)</h3><h4 id=41-redacting-more-data>4.1 Redacting More Data</h4><p>You can easily extend the configuration to redact additional sensitive information. For example, if you need to redact phone numbers, social security numbers, or other personally identifiable information (PII), you can add more blocked_values in the redaction processor.</p><p>Example:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>blocked_values</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=s2>&#34;(\\+\\d{1,2}\\s?)?\\(?\\d{3}\\)?\\s?-?\\d{3}-?\\d{4}&#34;</span><span class=w>  </span><span class=c># Phone number regex</span></span></span></code></pre></div><h4 id=42-using-multiple-redaction-strategies>4.2 Using Multiple Redaction Strategies</h4><p>You can combine different strategies for redaction, such as:</p><p>-Replacing values with a fixed string (&ldquo;REDACTED&rdquo;).
-Hashing values for anonymity.
-Deleting values to remove them completely from telemetry data.</p><h3 id=conclusion>Conclusion</h3><p>Congratulations! You&rsquo;ve successfully configured the OpenTelemetry Collector to remove tags and redact sensitive data. By following the steps in this workshop, you&rsquo;ve ensured that any sensitive information in your telemetry data is properly handled and protected. This configuration is critical for adhering to privacy standards and ensuring secure handling of data in your observability pipelines.</p><p>Feel free to extend this configuration to suit your own use cases, and explore more advanced redaction patterns based on your requirements.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 20, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=using-the-opentelemetry-transform-processor>Using the OpenTelemetry Transform Processor</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, we will explore the <strong>Transform Processor</strong> in the OpenTelemetry Collector. This processor allows you to modify trace, metric, and log data at runtime by performing actions like adding, updating, or deleting attributes. Itâ€™s a powerful tool to reshape telemetry data before it is exported to the backend.</p><p>By the end of this workshop, you will learn how to:</p><ul><li>Use the <strong>Transform Processor</strong> to modify trace data.</li><li>Apply transformations to attributes (e.g., renaming or deleting attributes).</li><li>Update values in telemetry data dynamically.</li></ul><hr><h2 id=overview-of-the-configuration>Overview of the Configuration</h2><p>The <strong>Transform Processor</strong> allows you to perform a variety of modifications to incoming telemetry data, including:</p><ul><li><strong>Add or Update Attributes</strong>: You can add or modify attribute values on traces, metrics, or logs.</li><li><strong>Delete Attributes</strong>: Remove unnecessary attributes to keep your telemetry data clean and efficient.</li><li><strong>Rename Attributes</strong>: Modify attribute keys for consistency across your observability pipeline.</li></ul><h3 id=example-yaml-configuration-for-the-transform-processor>Example YAML Configuration for the Transform Processor</h3><p>Here is an example configuration that demonstrates how to use the Transform Processor to modify trace data:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>transform</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>http.method</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>POST</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;attributes[&#34;http.method&#34;] == &#34;GET&#34;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>new_attribute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;transformed_value&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>old_attribute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>transform]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span></span></span></code></pre></div><h3 id=key-sections-of-the-configuration>Key Sections of the Configuration</h3><ol><li><p><strong><code>transform</code> processor</strong>: This is where the transformations on trace data are specified.</p><ul><li><strong><code>action: update</code></strong>: Update an attribute value based on a condition. In this case, the <code>http.method</code> attribute is updated from <code>GET</code> to <code>POST</code>.</li><li><strong><code>action: insert</code></strong>: Insert a new attribute <code>new_attribute</code> with a fixed value <code>"transformed_value"</code>.</li><li><strong><code>action: delete</code></strong>: Delete an existing attribute, here we remove <code>old_attribute</code>.</li></ul></li><li><p><strong>Service pipelines</strong>: The processor is applied as part of the <code>traces</code> pipeline, which receives traces from the <code>otlp</code> receiver and exports them to the <code>otlp</code> exporter.</p></li></ol><h2 id=step-1-review-the-yaml-configuration>Step 1: Review the YAML Configuration</h2><p>Let&rsquo;s break down the key sections of the YAML configuration that we will use in this workshop.</p><h3 id=11-the-transform-processor>1.1 The Transform Processor</h3><p>The <strong>Transform Processor</strong> is configured under the <code>processors</code> section. Here&rsquo;s how each transformation is specified:</p><h4 id=update-action>Update Action</h4><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>http.method</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>POST</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;attributes[&#34;http.method&#34;] == &#34;GET&#34;&#39;</span></span></span></code></pre></div><p>This action updates the <code>http.method</code> attribute. It looks for traces where the <code>http.method</code> is <code>"GET"</code> and changes it to <code>"POST"</code>.</p><h4 id=insert-action>Insert Action</h4><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>new_attribute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;transformed_value&#34;</span></span></span></code></pre></div><p>This action inserts a new attribute, <code>new_attribute</code>, with a fixed value <code>"transformed_value"</code> to every trace processed.</p><h4 id=delete-action>Delete Action</h4><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>old_attribute</span></span></span></code></pre></div><p>This action deletes an attribute called <code>old_attribute</code> from the trace data.</p><h3 id=12-service-pipelines>1.2 Service Pipelines</h3><p>In the <strong>service</strong> section, we define a pipeline that uses the <code>transform</code> processor.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>transform]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span></span></span></code></pre></div><p>This pipeline receives traces via the <code>otlp</code> receiver, processes them through the <code>transform</code> processor, and then exports them using the <code>otlp</code> exporter.</p><h2 id=step-2-set-up-the-opentelemetry-collector>Step 2: Set Up the OpenTelemetry Collector</h2><h3 id=21-save-the-configuration>2.1 Save the Configuration</h3><p>Save the YAML configuration to a file, e.g., <code>otel-collector-transform-config.yaml</code>.</p><h3 id=22-run-the-opentelemetry-collector>2.2 Run the OpenTelemetry Collector</h3><p>Start the OpenTelemetry Collector with your configuration:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol --config<span class=o>=</span>otel-collector-transform-config.yaml</span></span></code></pre></div><p>This will start the OpenTelemetry Collector with the transformation configuration.</p><h2 id=step-3-simulate-trace-data>Step 3: Simulate Trace Data</h2><h3 id=31-generate-sample-trace-data>3.1 Generate Sample Trace Data</h3><p>To test the transformation, you need to generate trace data with certain attributes.</p><ul><li>For example, a trace could include the <code>http.method</code> attribute set to <code>"GET"</code>, and you want the <code>http.method</code> to be transformed to <code>"POST"</code>.</li><li>You can use any instrumented application that sends trace data to the OpenTelemetry Collector. Alternatively, use a trace simulator or generate trace data manually.</li></ul><p>Make sure to include:</p><ul><li>A trace with the <code>http.method</code> attribute set to <code>"GET"</code>.</li><li>A trace with an <code>old_attribute</code> that should be deleted.</li></ul><h3 id=32-observe-the-transformation>3.2 Observe the Transformation</h3><p>Once you send the trace data, you should see the following transformations:</p><ul><li>Any <code>http.method</code> attribute with the value <code>"GET"</code> will be updated to <code>"POST"</code>.</li><li>The new attribute <code>new_attribute</code> will be added with the value <code>"transformed_value"</code>.</li><li>The <code>old_attribute</code> will be removed from the trace.</li></ul><p>You can view the transformed trace data in your exporter (e.g., Jaeger, Zipkin, or any other trace backend).</p><h2 id=step-4-debug-and-monitor-the-transformations>Step 4: Debug and Monitor the Transformations</h2><h3 id=41-monitor-the-logs>4.1 Monitor the Logs</h3><p>To ensure the transformations are working correctly, check the OpenTelemetry Collector logs. Look for log entries related to the transformation processing.</p><h3 id=42-customize-your-transformations>4.2 Customize Your Transformations</h3><p>You can modify the transformation actions to suit your needs. Here are some customization options:</p><ul><li><strong>Add multiple attributes</strong>: Insert multiple attributes with different conditions.</li><li><strong>Use conditions with complex expressions</strong>: Combine conditions with logical operators to match more complex attribute patterns.</li><li><strong>Apply transformations on specific trace types</strong>: Use different transformations for different trace types by modifying the condition.</li></ul><h2 id=step-5-extend-the-transform-processor>Step 5: Extend the Transform Processor</h2><h3 id=51-update-multiple-attributes-based-on-conditions>5.1 Update Multiple Attributes Based on Conditions</h3><p>You can update multiple attributes at once. For example, if you want to update the <code>http.status_code</code> and <code>http.method</code> attributes:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>http.status_code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;200&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;attributes[&#34;http.status_code&#34;] == &#34;404&#34;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>http.method</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;POST&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;attributes[&#34;http.method&#34;] == &#34;GET&#34;&#39;</span></span></span></code></pre></div><h3 id=52-use-advanced-conditions>5.2 Use Advanced Conditions</h3><p>Conditions can be as complex as needed. Hereâ€™s an example of updating attributes based on a combination of conditions:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;redacted&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;attributes[&#34;user_type&#34;] == &#34;admin&#34; and attributes[&#34;http.status_code&#34;] == &#34;403&#34;&#39;</span></span></span></code></pre></div><p>This transformation will only update the <code>user_id</code> attribute when the <code>user_type</code> is <code>"admin"</code> and the <code>http.status_code</code> is <code>"403"</code>.</p><h3 id=53-conditional-deletion>5.3 Conditional Deletion</h3><p>You can conditionally delete attributes based on specific criteria. For example:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>sensitive_data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;attributes[&#34;http.status_code&#34;] == &#34;500&#34;&#39;</span></span></span></code></pre></div><p>This will delete the <code>sensitive_data</code> attribute from traces where the <code>http.status_code</code> is <code>"500"</code>.</p><hr><h2 id=conclusion>Conclusion</h2><p>In this section, you have learned how to use the <strong>Transform Processor</strong> in the OpenTelemetry Collector to modify trace data dynamically. Youâ€™ve seen how to:</p><ul><li>Update existing attributes based on conditions.</li><li>Insert new attributes.</li><li>Delete unwanted attributes.</li></ul><p>By leveraging the <strong>Transform Processor</strong>, you can efficiently modify telemetry data as it passes through the OpenTelemetry Collector, ensuring that only relevant and well-structured data is sent to your observability backends.</p><hr><h2 id=next-steps>Next Steps</h2><ul><li><strong>Extend the Transform Processor</strong>: Add more transformations based on different conditions.</li><li><strong>Integrate with Different Backends</strong>: Try exporting your transformed data to different observability backends like Prometheus, Jaeger, or Splunk.</li><li><strong>Explore Other Processors</strong>: Experiment with other processors like <code>batch</code>, <code>memory_limiter</code>, or <code>filter</code> to further enhance your telemetry processing pipeline.</li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 20, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=routing>Routing</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The routing processor allows you to route data to different destinations based on the attributes of the data. The routing processor can be used to send data to different backends based on the attributes of the data. For example, you can use the routing processor to send data to different backends based on the service name or the environment.</p><p><a href=#R-image-45b81dec5dc8d027dc9cc5ecc57db869 class=lightbox-link><img alt="Routing Processor" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../images/routing.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-45b81dec5dc8d027dc9cc5ecc57db869><img alt="Routing Processor" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../images/routing.png></a></p><p>Directory structure testing:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>your_project/
</span></span><span class=line><span class=cl>â”œâ”€â”€ checkpoint-folder/
</span></span><span class=line><span class=cl>â”œâ”€â”€ otel-collector-config.yaml  # Configuration file
</span></span><span class=line><span class=cl>â”œâ”€â”€ agent-standard.out         # Trace export file
</span></span><span class=line><span class=cl>â”œâ”€â”€ agent-security.out         # Security trace export file</span></span></code></pre></div><p>In this section, you&rsquo;ll configure the routing connector in OpenTelemetry to route traces based on specific attributes, enabling you to handle traces differently based on their contents. You will also learn how to manage data checkpointing, apply various processors, and configure multiple exporters. By the end of this workshop, you will have a complete OpenTelemetry Collector configuration that processes and routes trace data efficiently.</p><h2 id=overview-of-the-configuration>Overview of the Configuration</h2><p>In this section, weâ€™ll be using the following key components defined in the YAML configuration:</p><p>Extensions: File storage for checkpointing.
Receivers: Collecting trace data using the OTLP protocol.
Exporters: Exporting data to different locations including files and a remote OTLP endpoint.
Connectors: Routing traces based on attributes.
Processors: Enhancing data with resource detection, batching, and memory limiting.
Service Pipelines: Defining data flow for traces, metrics, and logs.
Let&rsquo;s dive into each section of the YAML configuration and learn how to use it.</p><p>Step 1: Setting Up the Directory Structure
First, ensure you have the required directory structure for the checkpoint folder and log files:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>your_project/
</span></span><span class=line><span class=cl>â”œâ”€â”€ checkpoint-folder/           <span class=c1># Directory for checkpoint files</span>
</span></span><span class=line><span class=cl>â”œâ”€â”€ agent-standard.out           <span class=c1># Output file for standard traces</span>
</span></span><span class=line><span class=cl>â”œâ”€â”€ agent-security.out           <span class=c1># Output file for security traces</span>
</span></span><span class=line><span class=cl>â””â”€â”€ otel-collector-config.yaml   <span class=c1># OpenTelemetry Collector config file</span></span></span></code></pre></div><p>Step 2: Understanding the Key Configuration Sections</p><p>2.1 Extensions
The file_storage/checkpoint extension is used to manage checkpoint data. This ensures that data is written reliably, even in the case of failures or restarts.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage/checkpoint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>./checkpoint-folder </span><span class=w> </span><span class=c># Where checkpoint data is stored</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>create_directory</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>          </span><span class=c># Create the directory if it doesnâ€™t exist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>1s                    </span><span class=w> </span><span class=c># Timeout for checkpoint operations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                </span><span class=c># Enable compaction at start</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=l>./checkpoint-folder </span><span class=w> </span><span class=c># Where to store compacted data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_transaction_size</span><span class=p>:</span><span class=w> </span><span class=l>65_536 </span><span class=w> </span><span class=c># Max size for each transaction</span></span></span></code></pre></div><p>Compaction: Helps in managing large files and keeping data manageable by breaking large transactions into smaller chunks.</p><p>2.2 Receivers
The otlp receiver is used to accept incoming traces over HTTP. By default, the endpoint is configured to listen on 0.0.0.0:4318.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>Copy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span><span class=w>   </span><span class=c># Receives OTLP traces over HTTP</span></span></span></code></pre></div><p>You can also configure a filelog receiver to read log data from files, but this is currently commented out.</p><p>2.3 Exporters
There are multiple exporters configured:</p><p>Debug Exporter: Outputs trace data in detailed verbosity for debugging.
File Exporters: Writes trace data to files with rotation policies.
OTLP Gateway Exporter: Sends trace data to a remote OTLP endpoint with queuing and retry options.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed  </span><span class=w> </span><span class=c># Enables detailed debug logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/standard</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./agent-standard.out</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rotation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_megabytes</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>    </span><span class=c># Maximum file size before rotation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_backups</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>      </span><span class=c># Max number of backup files</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/security</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>./agent-security.out</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rotation</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_megabytes</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_backups</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp/gateway</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;localhost:5317&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>insecure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>      </span><span class=c># Allows insecure TLS connections (not recommended for production)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>retry_on_failure</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>       </span><span class=c># Enables retries on failure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sending_queue</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>num_consumers</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>   </span><span class=c># Number of consumers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>queue_size</span><span class=p>:</span><span class=w> </span><span class=m>10000</span><span class=w>   </span><span class=c># Size of the sending queue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>file_storage/checkpoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;123456&#34;</span><span class=w>  </span><span class=c># Custom header for authentication</span></span></span></code></pre></div><p>2.4 Connectors: Routing</p><p>The routing connector routes traces based on attributes. Here, traces with the attribute deployment.environment == &ldquo;security_applications&rdquo; are routed to a separate pipeline, traces/security.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>connectors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default_pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/standard] </span><span class=w> </span><span class=c># Default pipeline for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                   </span><span class=w> </span><span class=c># Ignore errors during routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>statement</span><span class=p>:</span><span class=w> </span><span class=l>route() where attributes[&#34;deployment.environment&#34;] == &#34;security_applications&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/security]</span></span></span></code></pre></div><p>You can add additional routing rules by specifying different attribute conditions. The second routing rule is commented out but could be used to delete a specific key from the attributes before routing the data.</p><p>2.5 Processors
Processors allow you to manipulate and enrich data before exporting it:</p><p>Batch Processor: Batches data to improve performance.
Memory Limiter: Ensures that the collector doesnâ€™t consume too much memory.
Resource Detection: Adds system resource attributes to the traces.
Resource Mode: Adds custom attributes to traces.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>X-SF-Token  </span><span class=w> </span><span class=c># Include metadata in batches</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>   </span><span class=c># Limits memory usage to 512 MB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>override</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>    </span><span class=c># Overrides existing resource detection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;agent&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode</span></span></span></code></pre></div><p>2.6 Service Pipelines
The service section defines how the traces, logs, and metrics will flow through the system, from receivers to processors and exporters.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>file_storage/checkpoint]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]              </span><span class=w> </span><span class=c># Receives traces via OTLP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>routing, debug]     </span><span class=w> </span><span class=c># Routes and debugs traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/standard</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>routing]           </span><span class=w> </span><span class=c># Receives routed traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>file/standard]      </span><span class=w> </span><span class=c># Exports to standard file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/security</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>routing]           </span><span class=w> </span><span class=c># Receives routed security traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>file/security]      </span><span class=w> </span><span class=c># Exports to security file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>file/standard, debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>otlp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>file/standard, debug]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>traces/standard</span><span class=p>:</span><span class=w> </span><span class=l>Default pipeline for traces that do not match the routing condition.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>traces/security</span><span class=p>:</span><span class=w> </span><span class=l>Pipeline for security-related traces routed by the connector.</span></span></span></code></pre></div><p>Step 3: Running OpenTelemetry Collector</p><p>Create the configuration file: Copy the YAML configuration into a file named otel-collector-config.yaml.</p><p>Start the OpenTelemetry Collector:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>otelcol --config<span class=o>=</span>otel-collector-config.yaml</span></span></code></pre></div><p>Verify that the Collector is running: Check the logs for any errors. If there are no errors, traces should be flowing through the collector.</p><p>Step 4: Testing the Routing
To test the routing:</p><p>Generate or simulate trace data with the attribute deployment.environment = security_applications.
Verify that the traces are routed to the traces/security pipeline by checking the agent-security.out file.
You can also check agent-standard.out to ensure that other traces are routed to the standard pipeline.</p><p>Step 5: Checkpoint Management</p><p>The checkpoint extension ensures that data is reliably stored and managed. Check the checkpoint-folder directory for checkpoint files created during operation.
Compaction: Large transactions will be compacted into smaller chunks, which helps in managing large data volumes.</p><p>Conclusion
In this section, you&rsquo;ve learned how to configure the OpenTelemetry Collector to route traces based on attributes. Youâ€™ve also explored checkpointing, batching, resource detection, and the export of trace data to different destinations. You can extend this setup by adding more routing rules, processing options, and exporters as needed for your use case.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jan 20, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.76/js/clipboard.min.js?1737480558 defer></script><script src=/observability-workshop/v5.76/js/perfect-scrollbar.min.js?1737480558 defer></script><script src=/observability-workshop/v5.76/js/theme.js?1737480558 defer></script></body></html>