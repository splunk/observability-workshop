<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=generator content="Relearn 7.2.1"><meta name=description content='Exercise Inside the [WORKSHOP] directory, create a new subdirectory named 2-gateway. Next, copy all contents from the 1-agent directory into 2-gateway. After copying, remove agent.out. Create a file called gateway.yaml and add the following initial configuration: Change all terminal windows to the [WORKSHOP]/2-gateway directory. â€‹ gateway.yaml ########################### This section holds all the ## Configuration section ## configurations that can be ########################### used in this OpenTelemetry Collector extensions: # Array of Extensions health_check: # Configures the health check extension endpoint: 0.0.0.0:14133 # Port changed to prevent conflict with agent!!! receivers: otlp: # Receiver Type protocols: # list of Protocols used http: # This wil enable the HTTP Protocol endpoint: "0.0.0.0:5318" # Port changed to prevent conflict with agent!!! include_metadata: true # Needed for token pass through mode exporters: # Array of Exporters debug: # Exporter Type verbosity: detailed # Enabled detailed debug output processors: # Array of Processors memory_limiter: # Limits memory usage by Collectors pipeline check_interval: 2s # Interval to check memory usage limit_mib: 512 # Memory limit in MiB batch: # Processor to Batch data before sending metadata_keys: # Include token in batches - X-SF-Token # Batch data grouped by Token resource/add_mode: # Processor Type/Name attributes: # Array of Attributes and modifications - action: upsert # Action taken is to `insert&#39; or &#39;update&#39; a key key: otelcol.service.mode # key Name value: "gateway" # Key Value ########################### This section controls what ### Activation Section ### configuration will be used ########################### by the OpenTelemetry Collector service: # Services configured for this Collector extensions: [health_check] # Enabled extensions for this collector pipelines: # Array of configured pipelines traces: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter metrics: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter logs: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter â€‹ Updated Directory Structure [WORKSHOP] â”œâ”€â”€ 1-agent # Module directory â”œâ”€â”€ 2-gateway # Module directory â”‚Â â””â”€â”€ agent.yaml # OpenTelemetry Collector configuration file â”‚Â â””â”€â”€ gateway.yaml # OpenTelemetry Collector configuration file â”‚Â â””â”€â”€ trace.json # Sample trace data â””â”€â”€ otelcol # OpenTelemetry Collector binary'><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="2. Gateway Configuration :: Splunk Observability Cloud Workshops"><meta name=twitter:description content='Exercise Inside the [WORKSHOP] directory, create a new subdirectory named 2-gateway. Next, copy all contents from the 1-agent directory into 2-gateway. After copying, remove agent.out. Create a file called gateway.yaml and add the following initial configuration: Change all terminal windows to the [WORKSHOP]/2-gateway directory. â€‹ gateway.yaml ########################### This section holds all the ## Configuration section ## configurations that can be ########################### used in this OpenTelemetry Collector extensions: # Array of Extensions health_check: # Configures the health check extension endpoint: 0.0.0.0:14133 # Port changed to prevent conflict with agent!!! receivers: otlp: # Receiver Type protocols: # list of Protocols used http: # This wil enable the HTTP Protocol endpoint: "0.0.0.0:5318" # Port changed to prevent conflict with agent!!! include_metadata: true # Needed for token pass through mode exporters: # Array of Exporters debug: # Exporter Type verbosity: detailed # Enabled detailed debug output processors: # Array of Processors memory_limiter: # Limits memory usage by Collectors pipeline check_interval: 2s # Interval to check memory usage limit_mib: 512 # Memory limit in MiB batch: # Processor to Batch data before sending metadata_keys: # Include token in batches - X-SF-Token # Batch data grouped by Token resource/add_mode: # Processor Type/Name attributes: # Array of Attributes and modifications - action: upsert # Action taken is to `insert&#39; or &#39;update&#39; a key key: otelcol.service.mode # key Name value: "gateway" # Key Value ########################### This section controls what ### Activation Section ### configuration will be used ########################### by the OpenTelemetry Collector service: # Services configured for this Collector extensions: [health_check] # Enabled extensions for this collector pipelines: # Array of configured pipelines traces: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter metrics: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter logs: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter â€‹ Updated Directory Structure [WORKSHOP] â”œâ”€â”€ 1-agent # Module directory â”œâ”€â”€ 2-gateway # Module directory â”‚Â â””â”€â”€ agent.yaml # OpenTelemetry Collector configuration file â”‚Â â””â”€â”€ gateway.yaml # OpenTelemetry Collector configuration file â”‚Â â””â”€â”€ trace.json # Sample trace data â””â”€â”€ otelcol # OpenTelemetry Collector binary'><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.81/en/ninja-workshops/10-advanced-otel/2-gateway/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="2. Gateway Configuration :: Splunk Observability Cloud Workshops"><meta property="og:description" content='Exercise Inside the [WORKSHOP] directory, create a new subdirectory named 2-gateway. Next, copy all contents from the 1-agent directory into 2-gateway. After copying, remove agent.out. Create a file called gateway.yaml and add the following initial configuration: Change all terminal windows to the [WORKSHOP]/2-gateway directory. â€‹ gateway.yaml ########################### This section holds all the ## Configuration section ## configurations that can be ########################### used in this OpenTelemetry Collector extensions: # Array of Extensions health_check: # Configures the health check extension endpoint: 0.0.0.0:14133 # Port changed to prevent conflict with agent!!! receivers: otlp: # Receiver Type protocols: # list of Protocols used http: # This wil enable the HTTP Protocol endpoint: "0.0.0.0:5318" # Port changed to prevent conflict with agent!!! include_metadata: true # Needed for token pass through mode exporters: # Array of Exporters debug: # Exporter Type verbosity: detailed # Enabled detailed debug output processors: # Array of Processors memory_limiter: # Limits memory usage by Collectors pipeline check_interval: 2s # Interval to check memory usage limit_mib: 512 # Memory limit in MiB batch: # Processor to Batch data before sending metadata_keys: # Include token in batches - X-SF-Token # Batch data grouped by Token resource/add_mode: # Processor Type/Name attributes: # Array of Attributes and modifications - action: upsert # Action taken is to `insert&#39; or &#39;update&#39; a key key: otelcol.service.mode # key Name value: "gateway" # Key Value ########################### This section controls what ### Activation Section ### configuration will be used ########################### by the OpenTelemetry Collector service: # Services configured for this Collector extensions: [health_check] # Enabled extensions for this collector pipelines: # Array of configured pipelines traces: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter metrics: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter logs: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter â€‹ Updated Directory Structure [WORKSHOP] â”œâ”€â”€ 1-agent # Module directory â”œâ”€â”€ 2-gateway # Module directory â”‚Â â””â”€â”€ agent.yaml # OpenTelemetry Collector configuration file â”‚Â â””â”€â”€ gateway.yaml # OpenTelemetry Collector configuration file â”‚Â â””â”€â”€ trace.json # Sample trace data â””â”€â”€ otelcol # OpenTelemetry Collector binary'><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="2. Gateway Configuration :: Splunk Observability Cloud Workshops"><meta itemprop=description content='Exercise Inside the [WORKSHOP] directory, create a new subdirectory named 2-gateway. Next, copy all contents from the 1-agent directory into 2-gateway. After copying, remove agent.out. Create a file called gateway.yaml and add the following initial configuration: Change all terminal windows to the [WORKSHOP]/2-gateway directory. â€‹ gateway.yaml ########################### This section holds all the ## Configuration section ## configurations that can be ########################### used in this OpenTelemetry Collector extensions: # Array of Extensions health_check: # Configures the health check extension endpoint: 0.0.0.0:14133 # Port changed to prevent conflict with agent!!! receivers: otlp: # Receiver Type protocols: # list of Protocols used http: # This wil enable the HTTP Protocol endpoint: "0.0.0.0:5318" # Port changed to prevent conflict with agent!!! include_metadata: true # Needed for token pass through mode exporters: # Array of Exporters debug: # Exporter Type verbosity: detailed # Enabled detailed debug output processors: # Array of Processors memory_limiter: # Limits memory usage by Collectors pipeline check_interval: 2s # Interval to check memory usage limit_mib: 512 # Memory limit in MiB batch: # Processor to Batch data before sending metadata_keys: # Include token in batches - X-SF-Token # Batch data grouped by Token resource/add_mode: # Processor Type/Name attributes: # Array of Attributes and modifications - action: upsert # Action taken is to `insert&#39; or &#39;update&#39; a key key: otelcol.service.mode # key Name value: "gateway" # Key Value ########################### This section controls what ### Activation Section ### configuration will be used ########################### by the OpenTelemetry Collector service: # Services configured for this Collector extensions: [health_check] # Enabled extensions for this collector pipelines: # Array of configured pipelines traces: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter metrics: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter logs: receivers: - otlp # OTLP Receiver processors: - memory_limiter # Memory Limiter processor - resource/add_mode # Add metadata about collector mode - batch # Batch Processor, groups data before send exporters: - debug # Debug Exporter â€‹ Updated Directory Structure [WORKSHOP] â”œâ”€â”€ 1-agent # Module directory â”œâ”€â”€ 2-gateway # Module directory â”‚Â â””â”€â”€ agent.yaml # OpenTelemetry Collector configuration file â”‚Â â””â”€â”€ gateway.yaml # OpenTelemetry Collector configuration file â”‚Â â””â”€â”€ trace.json # Sample trace data â””â”€â”€ otelcol # OpenTelemetry Collector binary'><meta itemprop=dateModified content="2025-02-07T17:39:40+00:00"><meta itemprop=wordCount content="420"><title>2. Gateway Configuration :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.81/en/ninja-workshops/10-advanced-otel/2-gateway/index.html rel=canonical type=text/html title="2. Gateway Configuration :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.81/images/favicon.ico?1739527554 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.81/css/fontawesome-all.min.css?1739527554 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.81/css/fontawesome-all.min.css?1739527554 rel=stylesheet></noscript><link href=/observability-workshop/v5.81/css/auto-complete.css?1739527554 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.81/css/auto-complete.css?1739527554 rel=stylesheet></noscript><link href=/observability-workshop/v5.81/css/perfect-scrollbar.min.css?1739527554 rel=stylesheet><link href=/observability-workshop/v5.81/css/theme.min.css?1739527554 rel=stylesheet><link href=/observability-workshop/v5.81/css/format-print.min.css?1739527554 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.81",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.81/en/ninja-workshops/10-advanced-otel/2-gateway/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.81/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.81/en/ninja-workshops/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.81/en/ninja-workshops/10-advanced-otel/index.html><span itemprop=name>Advanced OpenTelemetry</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>2. Gateway Setup</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.81/en/ninja-workshops/10-advanced-otel/2-gateway/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.81/en/ninja-workshops/10-advanced-otel/1-agent/1-4-metadata/1-4-1-test-metadata/index.html title="1.4.1 Test Resource Metadata (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.81/en/ninja-workshops/10-advanced-otel/2-gateway/2-1-test-gateway/index.html title="2.1 Test Gateway (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=2-gateway-configuration>2. Gateway Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>2-gateway</code>.</li><li>Next, copy all contents from the <code>1-agent</code> directory into <code>2-gateway</code>.</li><li>After copying, remove <code>agent.out</code>.</li><li>Create a file called <code>gateway.yaml</code> and add the following initial configuration:</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/2-gateway</code> directory.</li></ul><div class=tab-panel data-tab-group=a9b04ea7e234dc3e94b347bbf2d4466d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gatewayyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a9b04ea7e234dc3e94b347bbf2d4466d","gatewayyaml")'>
<span class=tab-nav-text>gateway.yaml</span></button></div><div class=tab-content-container><div data-tab-item=gatewayyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>###########################         This section holds all the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## Configuration section ##         configurations that can be </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         used in this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>                       </span><span class=c># Array of Extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                   </span><span class=c># Configures the health check extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14133</span><span class=w>       </span><span class=c># Port changed to prevent conflict with agent!!!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                           </span><span class=c># Receiver Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>                    </span><span class=c># list of Protocols used</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                       </span><span class=c># This wil enable the HTTP Protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span><span class=w>  </span><span class=c># Port changed to prevent conflict with agent!!!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>    </span><span class=c># Needed for token pass through mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>                        </span><span class=c># Array of Exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                          </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed          </span><span class=w> </span><span class=c># Enabled detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>                       </span><span class=c># Array of Processors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                 </span><span class=c># Limits memory usage by Collectors pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s           </span><span class=w> </span><span class=c># Interval to check memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>                          </span><span class=c># Processor to Batch data before sending</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w>                </span><span class=c># Include token in batches</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>X-SF-Token                 </span><span class=w> </span><span class=c># Batch data grouped by Token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>              </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>                   </span><span class=c># Array of Attributes and modifications</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>upsert             </span><span class=w> </span><span class=c># Action taken is to `insert&#39; or &#39;update&#39; a key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode  </span><span class=w> </span><span class=c># key Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway&#34;</span><span class=w>            </span><span class=c># Key Value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         This section controls what</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>### Activation Section  ###         configuration  will be used</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         by the OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>                          </span><span class=c># Services configured for this Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check]     </span><span class=w> </span><span class=c># Enabled extensions for this collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>                      </span><span class=c># Array of configured pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Add metadata about collector mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Batch Processor, groups data before send                     </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Add metadata about collector mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Batch Processor, groups data before send                     </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Add metadata about collector mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Batch Processor, groups data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span></span></span></code></pre></div></div></div></div></div></div></details><div class=tab-panel data-tab-group=90af27e2fdb7ca0f830aa31e6ec679b7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("90af27e2fdb7ca0f830aa31e6ec679b7","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent             # Module directory
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway           # Module directory
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ agent.yaml      # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ gateway.yaml    # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json      # Sample trace data
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol             # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 2. Gateway Setup</h1><article class=default><header class=headline></header><h1 id=21-test-gateway>2.1 Test Gateway</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In this section, we will extend the <code>gateway.yaml</code> configuration you just created to separate metric, traces & logs into different files.</p><p><strong>Create a <code>file</code> exporter and name it <code>traces</code></strong>: Separate exporters need to be configured for traces, metrics, and logs. Below is the YAML configuration for traces:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces.out&#34;</span><span class=w>  </span><span class=c># Path where data will be saved in OTLP json format</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span></span></span></code></pre></div><p><strong>Create additional exporters for <code>metrics</code> and <code>logs</code></strong>: Follow the example above, and set appropriate exporter names. Update the file paths to <code>./gateway-metrics.out</code> for <code>metrics</code> and <code>./gateway-logs.out</code> for <code>logs</code>.</p><p><strong>Add exporters to each pipeline</strong>: Ensure that each pipeline includes its corresponding <code>file</code> exporter, placing it after the <code>debug</code> exporter.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Groups Data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/logs                </span><span class=w> </span><span class=c># File Exporter for logs</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>logs:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO3(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;file&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt;logs):::exporter
      EXP2(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; EXP2
      PRO3 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>:</p><ol><li>Find your <strong>Gateway</strong> terminal window.</li><li>Navigate to the<code>[WORKSHOP]/2-gateway</code> directory.</li><li>Run the following command to test the gateway configuration:</li></ol><div class=tab-panel data-tab-group=898cc3984942571e72378b488afe68e7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("898cc3984942571e72378b488afe68e7","gateway")'>
<span class=tab-nav-text>Gateway</span></button></div><div class=tab-content-container><div data-tab-item=gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p>If everything is set up correctly, the first and last lines of the output should look like:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025/01/15 15:33:53 settings.go:478: Set config to [gateway.yaml]
</span></span><span class=line><span class=cl>&lt;snip to the end&gt;
</span></span><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.116.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div></div></details><p>Next, we will configure the <strong>Agent</strong> to send data to the newly created <strong>Gateway</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 8, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=22-configure-agent>2.2 Configure Agent</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Update <code>agent.yaml</code></strong>:</p><ol><li>Switch to your <strong>Agent</strong> terminal window.</li><li>Make sure you are in the <code>[WORKSHOP]/2-gateway</code> directory.</li><li>Open the <code>agent.yaml</code> file that you copied earlier in your editor.</li></ol><p><strong>Add the <code>otlphttp</code> exporter</strong>:</p><ol><li>The <a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/components/otlphttp-exporter.html rel=external target=_blank><strong>OTLP/HTTP Exporter</strong></a> is used to send data from the agent to the gateway using the OTLP/HTTP protocol. This is now the preferred method for exporting data to Splunk Observability Cloud (more details in Section 2.4 Addendum).</li><li>Ensure the <code>endpoint</code> is set to the gateway endpoint and port number.</li><li>Add the <code>X-SF-Token</code> header with a random value. During this workshop, you can use <strong>any</strong> value for <code>X-SF-TOKEN</code>. However, if you are connecting to Splunk Observability Cloud, this is where you will need to enter your Splunk Access Token (more details in Section 2.4 Addendum).</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                       </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w> </span><span class=c># Gateway OTLP endpoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>                      </span><span class=c># Headers to add to the HTTPcall </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ACCESS_TOKEN&#34;</span><span class=w>  </span><span class=c># Splunk ACCESS_TOKEN header</span></span></span></code></pre></div><p><strong>Add a Batch Processor configuration</strong>: Use the <a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/batchprocessor/README.md rel=external target=_blank><strong>Batch Processor</strong></a>. It will accept spans, metrics, or logs and places them into batches. Batching helps better compress the data and reduce the number of outgoing connections required to transmit the data. It is highly recommended configuring the batch processor on every collector.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>                          </span><span class=c># Processor Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>X-SF-Token]  </span><span class=w> </span><span class=c># Array of metadata keys to batch </span></span></span></code></pre></div><p><strong>Update the pipelines</strong>:</p><ol><li>Add <code>hostmetrics</code> to the <code>metrics</code> pipeline. The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/hostmetricsreceiver#readme rel=external target=_blank><strong>HostMetrics Receiver</strong></a> will generate host metrics.</li><li>Add the <code>batch</code> processor after the <code>resource/add_mode</code> processor in the <code>traces</code>, <code>metrics</code>, and <code>logs</code> pipelines.</li><li>Replace the <code>file</code> exporter with the <code>otlphttp</code> exporter in the <code>traces</code>, <code>metrics</code>, and <code>logs</code> pipelines.</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp                       </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>hostmetrics                </span><span class=w> </span><span class=c># Hostmetrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_limiter             </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resourcedetection          </span><span class=w> </span><span class=c># System attributes metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resource/add_mode          </span><span class=w> </span><span class=c># Collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>batch                      </span><span class=w> </span><span class=c># Batch Processor, groups data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>debug                      </span><span class=w> </span><span class=c># Debug Exporter </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlphttp                   </span><span class=w> </span><span class=c># OTLP/HTTP Exporter</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>metrics:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      REC2(hostmetrics&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-metrics
    subgraph &#34; &#34;
      subgraph subID1[**Metrics**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; EXP2
      PRO4 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=23-sending-data-from-the-agent-to-the-gateway>2.3 Sending data from the Agent to the Gateway</h1><p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Verify the <code>gateway</code> is still running</strong>: Check your <strong>Gateway</strong> terminal window and make sure the <strong>Gateway</strong> collector is running.</p><p><strong>Start the Agent</strong>: In the <strong>Agent</strong> terminal window start the agent with the updated configuration:</p><div class=tab-panel data-tab-group=60d96face90a76f807d8174d5d53abfb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("60d96face90a76f807d8174d5d53abfb","agent")'>
<span class=tab-nav-text>Agent</span></button></div><div class=tab-content-container><div data-tab-item=agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Verify CPU Metrics</strong>:</p><ol><li>Check that when the <strong>Agent</strong> starts, it immediately starts sending <strong>CPU</strong> metrics.</li><li>Both the <strong>Agent</strong> and the <strong>Gateway</strong> will display this activity in their debug output. The output should resemble the following snippet:</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>NumberDataPoints #37
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>    -&gt; cpu: Str(cpu9)
</span></span><span class=line><span class=cl>    -&gt; state: Str(system)
</span></span><span class=line><span class=cl>StartTimestamp: 2024-12-09 14:18:28 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-01-15 15:27:51.319526 +0000 UTC
</span></span><span class=line><span class=cl>Value: 9637.660000</span></span></code></pre></div><p>At this stage, the <strong>Agent</strong> continues to collect <strong>CPU</strong> metrics once per hour or upon each restart and sends them to the gateway. The <strong>OpenTelemetry Collector</strong>, running in <strong>Gateway</strong> mode, processes these metrics and exports them to a file named <code>./gateway-metrics.out</code>. This file stores the exported metrics as part of the pipeline service.</p><p><strong>Verify Data arrived at Gateway</strong>:</p><ol><li>Open the newly created <code>gateway-metrics.out</code> file.</li><li>Check that it contains <strong>CPU</strong> metrics.</li><li>The Metrics should include details similar to those shown below (We&rsquo;re only displaying the <code>resourceMetrics</code> section and the first set of <strong>CPU</strong> metrics â€” You will likely see more):</li></ol><div class=tab-panel data-tab-group=cf2a8c939d637b43693196cd58280bcf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-gateway-metricsout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("cf2a8c939d637b43693196cd58280bcf","cat-gateway-metricsout")'>
<span class=tab-nav-text>cat <code>./gateway-metrics.out</code></span>
</button>
<button data-tab-item=cat-gateway-metricsout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("cf2a8c939d637b43693196cd58280bcf","cat-gateway-metricsout--jq")'>
<span class=tab-nav-text>cat <code>./gateway-metrics.out</code> | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-gateway-metricsout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceMetrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_HOST_NAME&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_OS&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;gateway&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeMetrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver/internal/scraper/cpuscraper&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;v0.116.0&#34;</span><span class=p>},</span><span class=nt>&#34;metrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;system.cpu.time&#34;</span><span class=p>,</span><span class=nt>&#34;description&#34;</span><span class=p>:</span><span class=s2>&#34;Total seconds each logical CPU spent on each mode.&#34;</span><span class=p>,</span><span class=nt>&#34;unit&#34;</span><span class=p>:</span><span class=s2>&#34;s&#34;</span><span class=p>,</span><span class=nt>&#34;sum&#34;</span><span class=p>:{</span><span class=nt>&#34;dataPoints&#34;</span><span class=p>:[{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;user&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>1168005.59</span><span class=p>}]}}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-gateway-metricsout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceMetrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_HOST_NAME&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_OS&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;gateway&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeMetrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver/internal/scraper/cpuscraper&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;v0.116.0&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;metrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;system.cpu.time&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Total seconds each logical CPU spent on each mode.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;unit&#34;</span><span class=p>:</span> <span class=s2>&#34;s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;sum&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;dataPoints&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>1168005.59</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p><strong>Validate both collectors are running</strong>:</p><ol><li>Find the <strong>Agent</strong> terminal window. If the <strong>Agent</strong> is stopped, restart it.</li><li>Find the <strong>Gateway</strong> terminal window. Check if the <strong>Gateway</strong> is running, otherwise restart it.</li></ol><p><strong>Send a Test Trace</strong>:</p><ol><li>Find your <strong>Tests</strong> terminal window</li><li>Navigate it to the <code>[WORKSHOP]/2-gateway</code> directory.</li><li>Ensure that you have copied <code>trace.json</code> to the <code>2-gateway</code> directory.</li><li>Run the <code>cURL</code> command to send the span.</li></ol><p>Below, we show the first and last lines of the debug output. Use the <strong>Complete Debug Output</strong> button below to verify that both the <strong>Agent</strong> and <strong>Gateway</strong> produced similar debug output.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-02-05T15:55:18.966+0100    info    Traces  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>      {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-scroll"></i></span><span class=badge-content>Complete Debug Output</span></span></summary><div class=box-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>        {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;metrics&#34;, &#34;name&#34;: &#34;debug&#34;}
</span></span><span class=line><span class=cl>2025-02-05T15:55:18.966+0100    info    Traces  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>2025-02-05T15:55:18.966+0100    info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; service.name: Str(my.service)
</span></span><span class=line><span class=cl>     -&gt; deployment.environment: Str(my.environment)
</span></span><span class=line><span class=cl>     -&gt; host.name: Str(PH-Windows-Box.hagen-ict.nl)
</span></span><span class=line><span class=cl>     -&gt; os.type: Str(windows)
</span></span><span class=line><span class=cl>     -&gt; otelcol.service.mode: Str(agent)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope my.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>     -&gt; my.scope.attribute: Str(some scope attribute)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>    Trace ID       : 5b8efff798038103d269b633813fc60c
</span></span><span class=line><span class=cl>    Parent ID      : eee19b7ec3c1b173
</span></span><span class=line><span class=cl>    ID             : eee19b7ec3c1b174
</span></span><span class=line><span class=cl>    Name           : I&#39;m a server span
</span></span><span class=line><span class=cl>    Kind           : Server
</span></span><span class=line><span class=cl>    Start time     : 2018-12-13 14:51:00 +0000 UTC
</span></span><span class=line><span class=cl>    End time       : 2018-12-13 14:51:01 +0000 UTC
</span></span><span class=line><span class=cl>    Status code    : Unset
</span></span><span class=line><span class=cl>    Status message :
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)</span></span></code></pre></div></div></details><p><strong>Gateway has handled the span</strong>: Verify that the gateway has generated a new file named <code>./gateway-traces.out</code>.</p><div class=tab-panel data-tab-group=8730fca565aed8eeb392ad9cc228bcfd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-gateway-tracesout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8730fca565aed8eeb392ad9cc228bcfd","cat-gateway-tracesout")'>
<span class=tab-nav-text>cat /gateway-traces.out</span>
</button>
<button data-tab-item=cat-gateway-tracesoutjq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("8730fca565aed8eeb392ad9cc228bcfd","cat-gateway-tracesoutjq")'>
<span class=tab-nav-text>cat /gateway-traces.out|jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-gateway-tracesout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;George Lucas&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;+1555-867-5309&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.email&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;george@deathstar.email&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;LOTR\u003eStarWars1-2-3&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.visa&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;4111 1111 1111 1111&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.amex&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;3782 822463 10005&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;5555 5555 5555 4444&#34;</span><span class=p>}}],</span><span class=nt>&#34;status&#34;</span><span class=p>:{}}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-gateway-tracesoutjq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.service&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.environment&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;+1555-867-5309&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;george@deathstar.email&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;4111 1111 1111 1111&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;5555 5555 5555 4444&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Ensure that both <code>gateway-metrics.out</code> and <code>gateway-traces.out</code> include a resource attribute key-value pair for <code>otelcol.service.mode</code> with the value <code>gateway</code>.</p></div></details><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>In the provided <code>gateway.yaml</code> configuration, we modified the <code>resource/add_mode</code> processor to use the <code>upsert</code> action instead of <code>insert</code>.
The <code>upsert</code> action updates the value of the resource attribute key if it already exists, setting it to <code>gateway</code>. If the key is not present, the <code>upsert</code> action will add it.</p></div></details></p><p>Stop the <strong>Agent</strong> and <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 8, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=24-addendum---info-on-access-tokens-and-batch-processing>2.4 Addendum - Info on Access Tokens and Batch Processing</h1><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><h2 id=introduction-to-the-otlphttp-exporter>Introduction to the otlphttp Exporter</h2><p>The <code>otlphttp</code> exporter is now the default method for sending metrics and traces to Splunk Observability Cloud. This exporter provides a standardized and efficient way to transmit telemetry data using the OpenTelemetry Protocol (OTLP) over HTTP.</p><p>When deploying the Splunk Distribution of the OpenTelemetry Collector in host monitoring (agent) mode, the <code>otlphttp</code> exporter is included by default. This replaces older exporters such as <code>sapm</code> and <code>signalfx</code>, which are gradually being phased out.</p></div></details><h2 id=configuring-splunk-access-tokens>Configuring Splunk Access Tokens</h2><p>To authenticate and send data to Splunk Observability Cloud, you need to configure access tokens properly.
In OpenTelemetry, authentication is handled via HTTP headers. To pass an access token, use the <code>headers:</code> key with the sub-key <code>X-SF-Token:</code>. This configuration works in both agent and gateway mode.</p><p>Example:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://ingest.&lt;realm&gt;.signalfx.com&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;your-access-token&#34;</span></span></span></code></pre></div><h3 id=pass-through-mode>Pass-Through Mode</h3><p>If you need to forward headers through the pipeline, enable pass-through mode by setting <code>include_metadata:</code> to <code>true</code> in the OTLP receiver configuration. This ensures that any authentication headers received by the collector are retained and forwarded along with the data.</p><p>Example:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div><p>This is particularly useful in gateway mode, where data from multiple agents may pass through a centralized gateway before being sent to Splunk.</p><h2 id=understanding-batch-processing>Understanding Batch Processing</h2><p>The Batch Processor is a key component in optimizing data transmission efficiency. It groups traces, metrics, and logs into batches before sending them to the backend. Batching improves performance by:</p><ul><li>Reducing the number of outgoing requests.</li><li>Improving compression efficiency.</li><li>Lowering network overhead.</li></ul><h3 id=configuring-the-batch-processor>Configuring the Batch Processor</h3><p>To enable batching, configure the <code>batch:</code> section and include the <code>X-SF-Token:</code> key. This ensures that data is grouped correctly before being sent to Splunk Observability Cloud.</p><p>Example:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>X-SF-Token]  </span><span class=w> </span><span class=c># Array of metadata keys to batch </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>send_batch_size</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>5s</span></span></span></code></pre></div><h3 id=best-practices-for-batch-processing>Best Practices for Batch Processing</h3><p>For optimal performance, it is recommended to use the Batch Processor in every collector deployment. The best placement for the Batch Processor is <strong>after the memory limiter and sampling processors</strong>. This ensures that only necessary data is batched, avoiding unnecessary processing of dropped data.</p><h3 id=gateway-configuration-with-batch-processor>Gateway Configuration with Batch Processor</h3><p>When deploying a gateway, ensure that the Batch Processor is included in the pipeline:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>memory_limiter, tail_sampling, batch]</span></span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>The <code>otlphttp</code> exporter is now the preferred method for sending telemetry data to Splunk Observability Cloud. Properly configuring Splunk Access Tokens ensures secure data transmission, while the Batch Processor helps optimize performance by reducing network overhead. By implementing these best practices, you can efficiently collect and transmit observability data at scale.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.81/js/clipboard.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/perfect-scrollbar.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-color.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-dispatch.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-drag.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-ease.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-interpolate.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-selection.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-timer.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-transition.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/d3/d3-zoom.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/js-yaml.min.js?1739527554 defer></script><script src=/observability-workshop/v5.81/js/mermaid.min.js?1739527554 defer></script><script>window.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/v5.81/js/theme.js?1739527554 defer></script></body></html>