<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=generator content="Relearn 7.2.1"><meta name=description content="Practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Advanced Collector Configuration :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.84/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Advanced Collector Configuration :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Advanced Collector Configuration :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's."><meta itemprop=dateModified content="2025-03-11T11:25:28+00:00"><meta itemprop=wordCount content="449"><title>Advanced Collector Configuration :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.84/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/index.html rel=canonical type=text/html title="Advanced Collector Configuration :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.84/images/favicon.ico?1741692583 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.84/css/fontawesome-all.min.css?1741692583 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.84/css/fontawesome-all.min.css?1741692583 rel=stylesheet></noscript><link href=/observability-workshop/v5.84/css/auto-complete.css?1741692583 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.84/css/auto-complete.css?1741692583 rel=stylesheet></noscript><link href=/observability-workshop/v5.84/css/perfect-scrollbar.min.css?1741692583 rel=stylesheet><link href=/observability-workshop/v5.84/css/theme.min.css?1741692583 rel=stylesheet><link href=/observability-workshop/v5.84/css/format-print.min.css?1741692583 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.84",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.84/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#workshop-overview>Workshop Overview</a></li><li><a href=#prerequisites>Prerequisites</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.84/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.84/en/ninja-workshops/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.84/en/ninja-workshops/3-opentelemetry-collector-workshops/index.html><span itemprop=name>OpenTelemetry Collector Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Advanced Collector Configuration</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.84/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.84/en/ninja-workshops/3-opentelemetry-collector-workshops/1-opentelemetry-collector/8-develop/5-business-logic/index.html title="OpenTelemetry Collector Development (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.84/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/1-agent/index.html title="1. Agent Configuration (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=advanced-collector-configuration>Advanced Collector Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>90 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Authors
</span><span class=badge-content>Robert Castley,
Charity Anderson,
Pieter Hagen
&
Geoff Higginbottom</span></span><p>The goal of this workshop is to help you become comfortable creating and modifying OpenTelemetry Collector configuration files. Youâ€™ll start with a minimal <code>agent.yaml</code> file and gradually configure several common advanced scenarios.</p><p>The workshop also explores how to configure the OpenTelemetry Collector to store telemetry data locally instead of transmitting it to a third-party vendor backend. Furthermore, this approach significantly enhances the debugging and troubleshooting process and is useful for testing and development environments where you donâ€™t want to send data to a production system.</p><p>To get the most out of this workshop, you should have a basic understanding of the OpenTelemetry Collector and its configuration file format. Additionally, proficiency in editing YAML files is required. The entire workshop is designed to run locally.</p><h3 id=workshop-overview>Workshop Overview</h3><p>During this workshop, we will cover the following topics:</p><ul><li><strong>Setting up the agent locally</strong>: Add metadata, and introduce the debug and file exporters.</li><li><strong>Configuring a gateway</strong>: Route traffic from the agent to the gateway.</li><li><strong>Configuring the FileLog receiver</strong>: Collect log data from various log files.</li><li><strong>Enhancing agent resilience</strong>: Basic configurations for fault tolerance.</li><li><strong>Configuring processors</strong>:<ul><li>Filter out noise by dropping specific spans (e.g., health checks).</li><li>Remove unnecessary tags, and handle sensitive data.</li><li>Transform data using OTTL (OpenTelemetry Transformation Language) in the pipeline before exporting.</li></ul></li><li><strong>Configuring Connectors</strong>:<ul><li>Route data to different endpoints based on the values received.</li><li>Convert log and span data to metrics.</li></ul></li></ul><p>By the end of this workshop, you&rsquo;ll be familiar with configuring the OpenTelemetry Collector for a variety of real-world use cases.</p><hr><h3 id=prerequisites>Prerequisites</h3><ul><li>Proficiency in editing YAML files using <code>vi</code>, <code>vim</code>, <code>nano</code>, or your preferred text editor.</li><li>Supported Environments:<ul><li>Splunk Workshop Instance (preferred)</li><li>Apple Mac (Apple Silicon). Installation of <code>jq</code> is required - <a href=https://jqlang.org/download/ rel=external target=_blank><strong>https://jqlang.org/download/</strong></a></li></ul></li></ul><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Create a workshop directory</strong>: In your environment create a new directory (e.g., <code>advanced-otel</code>). We will refer to this directory as <code>[WORKSHOP]</code> for the remainder of the workshop.</p><p><strong>Download workshop binaries</strong>: Change into your <code>[WORKSHOP]</code> directory and download the OpenTelemetry Collector and Load Generator binaries:</p><div class=tab-panel data-tab-group=fc32e51733b40425198a302607de345f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=splunk-workshop-instance class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("fc32e51733b40425198a302607de345f","splunk-workshop-instance")'>
<span class=tab-nav-text>Splunk Workshop Instance</span>
</button>
<button data-tab-item=apple-silicon class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("fc32e51733b40425198a302607de345f","apple-silicon")'>
<span class=tab-nav-text>Apple Silicon</span></button></div><div class=tab-content-container><div data-tab-item=splunk-workshop-instance class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L https://github.com/signalfx/splunk-otel-collector/releases/download/v0.120.0/otelcol_linux_amd64 -o otelcol <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/loadgen/build/loadgen-linux-amd64 -o loadgen</span></span></code></pre></div></div></div><div data-tab-item=apple-silicon class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L https://github.com/signalfx/splunk-otel-collector/releases/download/v0.120.0/otelcol_darwin_arm64 -o otelcol <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl -L https://github.com/splunk/observability-workshop/raw/refs/heads/main/workshop/ninja/advanced-otel/loadgen/build/loadgen-darwin-arm64 -o loadgen</span></span></code></pre></div><details open class="box cstyle notices warning"><summary class=box-label><i class="fa-fw fas fa-desktop"></i>
macOS Users</summary><div class=box-content><p>Before running the binaries on macOS, you need to remove the quarantine attribute that macOS applies to downloaded files. This step ensures they can execute without restrictions.</p><p>Run the following command in your terminal:</p><div class=tab-panel data-tab-group=5ee26d20c1a6275395f6dc52d38b13c8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=remove-quarantine-attribute class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5ee26d20c1a6275395f6dc52d38b13c8","remove-quarantine-attribute")'>
<span class=tab-nav-text>Remove Quarantine Attribute</span></button></div><div class=tab-content-container><div data-tab-item=remove-quarantine-attribute class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>xattr -dr com.apple.quarantine otelcol <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>xattr -dr com.apple.quarantine loadgen</span></span></code></pre></div></div></div></div></div></div></details></div></div></div></div><p><strong>Update file permissions</strong>: Once downloaded, update the file permissions to make both executable:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod +x otelcol loadgen <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>./otelcol -v <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>./loadgen --help</span></span></code></pre></div><div class=tab-panel data-tab-group=de444a7aa6d573ce39a3e83578ac1bb9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=initial-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("de444a7aa6d573ce39a3e83578ac1bb9","initial-directory-structure")'>
<span class=tab-nav-text>Initial Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=initial-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â”œâ”€â”€ otelcol      # OpenTelemetry Collector binary
</span></span><span class=line><span class=cl>â””â”€â”€ loadgen      # Load Generator binary</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of Advanced Collector Configuration</h1><article class=default><header class=headline></header><h1 id=1-agent-configuration>1. Agent Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>During this workshop, you will be using up to four terminal windows simultaneously. To stay organized, consider customizing each terminal or shell with unique names and colors. This will help you quickly identify and switch between them as needed.</p><p>We will refer to these terminals as: <strong>Agent</strong>, <strong>Gateway</strong>, <strong>Spans</strong> and <strong>Logs</strong>.</p></div></details><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ol><li><p>In the <strong>Agent terminal</strong> window, change into the <code>[WORKSHOP]</code> directory and create a new subdirectory named <code>1-agent</code>.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir 1-agent <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=nb>cd</span> 1-agent</span></span></code></pre></div></li><li><p>Create a file named <code>agent.yaml</code>. This file will define the basic structure of an OpenTelemetry Collector configuration.</p></li><li><p>Copy and paste the following initial configuration into <code>agent.yaml</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                        </span><span class=c># Health Check Extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>            </span><span class=c># Health Check Endpoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Receivers Pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>                         </span><span class=c># Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>3600s        </span><span class=w> </span><span class=c># Collection Interval (1hr)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>                             </span><span class=c># CPU Scraper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                                </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                            </span><span class=c># Configure HTTP protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span><span class=w>       </span><span class=c># Endpoint to bind to</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Exporters Pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                               </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed               </span><span class=w> </span><span class=c># Detailed verbosity level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Processors Pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                      </span><span class=c># Limits memory usage by Collectors pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s                </span><span class=w> </span><span class=c># Check interval</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                     </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection</span><span class=p>:</span><span class=w>                   </span><span class=c># Resource Detection Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]               </span><span class=w> </span><span class=c># Detect system resources</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>override</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                     </span><span class=c># Overwrites existing attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>                   </span><span class=c># Resource Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert                  </span><span class=w> </span><span class=c># Action to perform</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode       </span><span class=w> </span><span class=c># Key name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;agent&#34;</span><span class=w>                   </span><span class=c># Key value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Connectors Pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Service Section - Enabled Pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>health_check                      </span><span class=w> </span><span class=c># Health Check Extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                          </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Add system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Add collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                         </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span></span></span></code></pre></div></li><li><p>Your directory structure should now look like this:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ 1-agent
</span></span><span class=line><span class=cl>Â Â  â””â”€â”€ agent.yaml  # OpenTelemetry Collector configuration file</span></span></code></pre></div></li></ol></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1. Agent Setup</h1><article class=default><header class=headline></header><h1 id=11-validation--load-generation>1.1 Validation & Load Generation</h1><p>In this workshop, weâ€™ll use <a href=https://.otelbin.io/ rel=external target=_blank><strong>https://otelbin.io</strong></a> to quickly validate YAML syntax and ensure your OpenTelemetry configurations are accurate. This step helps avoid errors before running tests during the session.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Hereâ€™s how to validate your configuration:</p><ol><li><p>Open <a href=https://.otelbin.io/ rel=external target=_blank><strong>https://otelbin.io</strong></a> and replace the existing configuration by pasting your YAML into the left pane.</p><details open class="box cstyle notices info"><summary class=box-label><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>If are on a Mac and <strong>not</strong> using a Splunk Workshop instance, you can quickly copy the contents of the <code>agent.yaml</code> file to your clipboard by running the following command:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat agent.yaml <span class=p>|</span> pbcopy</span></span></code></pre></div></div></details></li><li><p>At the top of the page, make sure <strong>Splunk OpenTelemetry Collector</strong> is selected as the validation target.</p></li><li><p>Once validated, refer to the image representation below to confirm your pipelines are set up correctly.</p></li></ol><p>In most cases, weâ€™ll display only the <strong>key pipeline</strong>. However, if all three pipelines (Traces, Metrics, and Logs) share the same structure, weâ€™ll note this instead of showing each one individually.</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces/Metrics/Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fff,stroke-width:1px, color:#fff,stroke-dasharray: 3 3;</pre></div></details><hr><h2 id=load-generation-tool>Load Generation Tool</h2><p>For the is workshop we have specifically developed a <code>loadgen</code> tool. <code>loadgen</code> is a flexible load generator for simulating traces and logging activities. It supports base, health, and security traces by default, along with optional logging of random quotes to a file, either in plain text or JSON format.</p><p>The output generated by <code>loadgen</code> mimic those produced by an OpenTelemetry instrumentation library, allowing us to test the Collectorâ€™s processing logic and offers a simple yet powerful way to mimic real-world scenarios.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=12-test-agent-configuration>1.2 Test Agent Configuration</h1><p>Youâ€™re ready to start the OpenTelemetry Collector with the newly created <code>agent.yaml</code>. This exercise sets the foundation for understanding how data flows through the OpenTelemetry Collector.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Agent</strong>: In the <strong>Agent terminal</strong> window run the following command:</p><div class=tab-panel data-tab-group=693e8f9ad223e5895f09d42992e32fdc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-collector class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("693e8f9ad223e5895f09d42992e32fdc","start-collector")'>
<span class=tab-nav-text>Start Collector</span></button></div><div class=tab-content-container><div data-tab-item=start-collector class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Verify debug output</strong>: If everything is configured correctly, the first and last lines of the output will look like:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025/01/13T12:43:51 settings.go:478: Set config to [agent.yaml]
</span></span><span class=line><span class=cl>&lt;snip to the end&gt;
</span></span><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.117.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p><strong>Send Test Spans</strong>: Instead of instrumenting an application, weâ€™ll simulate sending trace data to the OpenTelemetry Collector using the <code>loadgen</code> tool.</p><p>In the <strong>Spans terminal</strong> window, change into the <code>1-agent</code> directory and run the following command to send a single span:</p><div class=tab-panel data-tab-group=5f687889573fb5e2ad5403fa63b6a3fe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5f687889573fb5e2ad5403fa63b6a3fe","start-load-generator")'>
<span class=tab-nav-text>Start Load Generator</span>
</button>
<button data-tab-item=load-generator-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5f687889573fb5e2ad5403fa63b6a3fe","load-generator-output")'>
<span class=tab-nav-text>Load Generator Output</span></button></div><div class=tab-content-container><div data-tab-item=start-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div></div></div><div data-tab-item=load-generator-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Sending traces. Use Ctrl-C to stop.
</span></span><span class=line><span class=cl>Response: {&#34;partialSuccess&#34;:{}}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Base trace sent with traceId: 1aacb1db8a6d510f10e52f154a7fdb90 and spanId: 7837a3a2d3635d9f</span></span></code></pre></div><p><code>{"partialSuccess":{}}</code>: Indicates 100% success, as the <code>partialSuccess</code> field is empty. In case of a partial failure, this field will include details about any failed parts.</p></div></div></div></div><p><strong>Verify Debug Output</strong>:</p><p>In the <strong>Agent terminal</strong> window check the collector&rsquo;s debug output:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-03-06T10:11:35.174Z        info    Traces  {&#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;Exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>2025-03-06T10:11:35.174Z        info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; service.name: Str(cinema-service)
</span></span><span class=line><span class=cl>     -&gt; deployment.environment: Str(production)
</span></span><span class=line><span class=cl>     -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>     -&gt; os.type: Str(linux)
</span></span><span class=line><span class=cl>     -&gt; otelcol.service.mode: Str(agent)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope cinema.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>     -&gt; fintest.scope.attribute: Str(Starwars, LOTR)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>    Trace ID       : 0ef4daa44a259a7199a948231bc383c0
</span></span><span class=line><span class=cl>    Parent ID      :
</span></span><span class=line><span class=cl>    ID             : e8fdd442c36cbfb1
</span></span><span class=line><span class=cl>    Name           : /movie-validator
</span></span><span class=line><span class=cl>    Kind           : Server
</span></span><span class=line><span class=cl>    Start time     : 2025-03-06 10:11:35.163557 +0000 UTC
</span></span><span class=line><span class=cl>    End time       : 2025-03-06 10:11:36.163557 +0000 UTC
</span></span><span class=line><span class=cl>    Status code    : Ok
</span></span><span class=line><span class=cl>    Status message : Success
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>     -&gt; payment.amount: Double(86.48)
</span></span><span class=line><span class=cl>        {&#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;Exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;}</span></span></code></pre></div></div></details><p>Stop the <code>agent</code> in the <strong>Agent terminal</strong> window using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=13-file-exporter>1.3 File Exporter</h1><p>To capture more than just debug output on the screen, we also want to generate output during the export phase of the pipeline. For this, we&rsquo;ll add a <strong>File Exporter</strong> to write OTLP data to files for comparison.</p><p>The difference between the OpenTelemetry <strong>debug exporter</strong> and the <strong>file exporter</strong> lies in their purpose and output destination:</p><table><thead><tr><th style=text-align:left>Feature</th><th style=text-align:left>Debug Exporter</th><th style=text-align:left>File Exporter</th></tr></thead><tbody><tr><td style=text-align:left><strong>Output Location</strong></td><td style=text-align:left>Console/Log</td><td style=text-align:left>File on disk</td></tr><tr><td style=text-align:left><strong>Purpose</strong></td><td style=text-align:left>Real-time debugging</td><td style=text-align:left>Persistent offline analysis</td></tr><tr><td style=text-align:left><strong>Best for</strong></td><td style=text-align:left>Quick inspection during testing</td><td style=text-align:left>Temporary storage and sharing</td></tr><tr><td style=text-align:left><strong>Production Use</strong></td><td style=text-align:left>No</td><td style=text-align:left>Rare, but possible</td></tr><tr><td style=text-align:left><strong>Persistence</strong></td><td style=text-align:left>No</td><td style=text-align:left>Yes</td></tr></tbody></table><p>In summary, the <strong>Debug Exporter</strong> is great for real-time, in-development troubleshooting, while the <strong>File Exporter</strong> is better suited for storing telemetry data locally for later use.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In the <strong>Agent terminal</strong> window ensure the collector is not running then edit the <code>agent.yaml</code> and configure the <strong>File Exporter</strong>:</p><ol><li><p><strong>Configuring a <code>file</code> exporter</strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/exporter/fileexporter/README.md rel=external target=_blank><strong>File Exporter</strong></a> writes telemetry data to files on disk.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file</span><span class=p>:</span><span class=w>                                </span><span class=c># File Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./agent.out&#34;</span><span class=w>                </span><span class=c># Save path (OTLP/JSON)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                      </span><span class=c># Overwrite the file each time</span></span></span></code></pre></div></li><li><p><strong>Update the Pipelines Section</strong>: Add the <code>file</code> exporter to the <code>traces</code> pipeline only:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                          </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Add system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Add collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                         </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file                          </span><span class=w> </span><span class=c># File Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span></span></span></code></pre></div></li></ol></div></details><p>Validate the agent configuration using <a href=https://.otelbin.io/ rel=external target=_blank><strong>https://otelbin.io</strong></a>:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;file&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; EXP1
      PRO3 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1.3. File Exporter</h1><article class=default><header class=headline></header><h1 id=131-test-file-exporter>1.3.1 Test File Exporter</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Restart your agent</strong>: Find your <strong>Agent terminal</strong> window, and (re)start the <code>agent</code> using the modified configuration:</p><div class=tab-panel data-tab-group=e084feaddeeede8cdda49c6023d1ef8b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e084feaddeeede8cdda49c6023d1ef8b","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span>
</button>
<button data-tab-item=agent-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("e084feaddeeede8cdda49c6023d1ef8b","agent-output")'>
<span class=tab-nav-text>Agent Output</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div><div data-tab-item=agent-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.120.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div></div></div></div></div><p><strong>Send a Trace</strong>: From the <strong>Spans terminal</strong> window send another span and verify you get the same output on the console as we saw previously:</p><div class=tab-panel data-tab-group=aa699b5f474b1f9123328103772abfba><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("aa699b5f474b1f9123328103772abfba","start-load-generator")'>
<span class=tab-nav-text>Start Load Generator</span></button></div><div class=tab-content-container><div data-tab-item=start-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div></div></div></div></div><p><strong>Verify that the <code>agent.out</code> file is written</strong>: Check that a file named <code>agent.out</code> is written in the current directory.</p><div class=tab-panel data-tab-group=ad186ed8d3802ba6d892467c8cfebabe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ad186ed8d3802ba6d892467c8cfebabe","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ 1-agent
</span></span><span class=line><span class=cl> Â Â  â””â”€â”€ agent.out   # OTLP/Json output created by the File Exporter
</span></span><span class=line><span class=cl> Â Â  â””â”€â”€ agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Verify the span format</strong>:</p><ol><li>Verify the format used by the File Exporter to write the span to <code>agent.out</code>.</li><li>The output will be a single line in <strong>OTLP/JSON</strong> format.</li><li>To view the contents of <code>agent.out</code>, you can use the <code>cat ./agent.out</code> command. For a more readable formatted view, pipe the output to <code>jq</code> like this: <code>cat ./agent.out | jq</code>:</li></ol><div class=tab-panel data-tab-group=a93825f95cf25ce8aa5f2b10f2e029c8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-agentout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a93825f95cf25ce8aa5f2b10f2e029c8","cat-agentout")'>
<span class=tab-nav-text>cat ./agent.out</span>
</button>
<button data-tab-item=cat-agentout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("a93825f95cf25ce8aa5f2b10f2e029c8","cat-agentout--jq")'>
<span class=tab-nav-text>cat ./agent.out | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-agentout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cinema-service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;production&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;workshop-instance&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;linux&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;cinema.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;fintest.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;Starwars, LOTR&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;d824a28db5aa5f5a3011f19c452e5af0&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;ab4cde146f77eacf&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;/movie-validator&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1741256991405300000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1741256992405300000&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;George Lucas&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;+1555-867-5309&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.email&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;george@deathstar.email&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.password&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;LOTR\u003eStarWars1-2-3&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.visa&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;4111 1111 1111 1111&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.amex&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;3782 822463 10005&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;5555 5555 5555 4444&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;payment.amount&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;doubleValue&#34;</span><span class=p>:</span><span class=mf>56.24</span><span class=p>}}],</span><span class=nt>&#34;status&#34;</span><span class=p>:{</span><span class=nt>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;Success&#34;</span><span class=p>,</span><span class=nt>&#34;code&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>}}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-agentout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cinema-service&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;production&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;RCASTLEY-M-YQRY.local&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;darwin&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;cinema.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;fintest.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;Starwars, LOTR&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;d824a28db5aa5f5a3011f19c452e5af0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;ab4cde146f77eacf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;/movie-validator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1741256991405300000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1741256992405300000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;+1555-867-5309&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;george@deathstar.email&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;4111 1111 1111 1111&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;5555 5555 5555 4444&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;payment.amount&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;doubleValue&#34;</span><span class=p>:</span> <span class=mf>56.24</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;Success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;code&#34;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><p>Stop the <code>agent</code> in <strong>Agent terminal</strong> window using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=2-gateway-configuration>2. Gateway Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The OpenTelemetry Gateway is designed to receive, process, and export telemetry data. It acts as an intermediary between telemetry sources (e.g. applications, services) and backends (e.g., observability platforms like Prometheus, Jaeger, or Splunk Observability Cloud).</p><p>The gateway is useful because it centralizes telemetry data collection, enabling features like data filtering, transformation, and routing to multiple destinations. It also reduces the load on individual services by offloading telemetry processing and ensures consistent data formats across distributed systems. This makes it easier to manage, scale, and analyze telemetry data in complex environments.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>In the <strong>Gateway terminal</strong> window, change into the <code>[WORKSHOP]</code> directory and create a new subdirectory named <code>2-gateway</code>.</li></ul><details open class="box cstyle notices important"><summary class=box-label><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/2-gateway</code> directory.</strong></p></div></details><ul><li>Next, copy <code>agent.yaml</code> from the <code>1-agent</code> directory into <code>2-gateway</code>.</li><li>Create a file called <code>gateway.yaml</code> and add the following initial configuration:</li></ul><div class=tab-panel data-tab-group=201ad41b5e22343146654e014dfefc93><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gatewayyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("201ad41b5e22343146654e014dfefc93","gatewayyaml")'>
<span class=tab-nav-text>gateway.yaml</span></button></div><div class=tab-content-container><div data-tab-item=gatewayyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>###########################         This section holds all the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## Configuration section ##         configurations that can be </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         used in this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>                       </span><span class=c># List of extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                   </span><span class=c># Health check extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14133</span><span class=w>       </span><span class=c># Custom port to avoid conflicts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                           </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                       </span><span class=c># HTTP protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span><span class=w>  </span><span class=c># Custom port to avoid conflicts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>    </span><span class=c># Required for token pass-through</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>                        </span><span class=c># List of exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                          </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed          </span><span class=w> </span><span class=c># Enable detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces.out&#34;</span><span class=w>  </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/metrics</span><span class=p>:</span><span class=w>                   </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-metrics.out&#34;</span><span class=w> </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/logs</span><span class=p>:</span><span class=w>                      </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-logs.out&#34;</span><span class=w>    </span><span class=c># Path for OTLP JSON output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>                       </span><span class=c># List of processors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                 </span><span class=c># Limits memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s           </span><span class=w> </span><span class=c># Memory check interval</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>                          </span><span class=c># Batches data before exporting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w>                </span><span class=c># Groups data by token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>X-SF-Token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>              </span><span class=c># Adds metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>upsert             </span><span class=w> </span><span class=c># Inserts or updates a key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode  </span><span class=w> </span><span class=c># Key name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway&#34;</span><span class=w>            </span><span class=c># Key value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>### Activation Section  ###</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>                          </span><span class=c># Service configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>telemetry</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>level</span><span class=p>:</span><span class=w> </span><span class=l>none                </span><span class=w> </span><span class=c># Disable metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check]     </span><span class=w> </span><span class=c># Enabled extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>                      </span><span class=c># Configured pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                       </span><span class=c># Traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>                      </span><span class=c># Metrics pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>                         </span><span class=c># Logs pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                 </span><span class=c># Processors for logs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/logs</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=1409ec7dfc65a165d5383dd490b39989><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1409ec7dfc65a165d5383dd490b39989","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ 2-gateway
</span></span><span class=line><span class=cl> Â Â  â””â”€â”€ agent.yaml
</span></span><span class=line><span class=cl> Â Â  â””â”€â”€ gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 2. Gateway Setup</h1><article class=default><header class=headline></header><h1 id=21-start-gateway>2.1 Start Gateway</h1><p>The configuration for the <code>gateway</code> does not need any additional configuration changes to function. This has been done to save time and focus on the core concepts of the <strong>Gateway</strong>.</p><p>Validate the <code>gateway</code> configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>logs:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO3(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;file&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt;logs):::exporter
      EXP2(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; EXP2
      PRO3 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway terminal</strong> window, run the following command to start the <code>gateway</code>:</p><div class=tab-panel data-tab-group=a8e3fe61a635e9d76a1e6ea9cb4c62be><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a8e3fe61a635e9d76a1e6ea9cb4c62be","start-the-gateway")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div data-tab-item=start-the-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p>If everything is configured correctly, the first and last lines of the output should look like:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025/01/15 15:33:53 settings.go:478: Set config to [gateway.yaml]
</span></span><span class=line><span class=cl>&lt;snip to the end&gt;
</span></span><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.120.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div></div></details><p>Next, we will configure the <code>agent</code> to send data to the newly created <code>gateway</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=22-configure-agent>2.2 Configure Agent</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add the <code>otlphttp</code> exporter</strong>: The <a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/components/otlphttp-exporter.html rel=external target=_blank><strong>OTLP/HTTP Exporter</strong></a> is used to send data from the agent to the gateway using the <strong>OTLP/HTTP</strong> protocol.</p><ol><li>Switch to your <strong>Agent terminal</strong> window.</li><li>Open the <code>agent.yaml</code> file that you copied earlier in your editor.</li><li>Add the <code>otlphttp</code> exporter configuration to the <code>exporters</code> section:</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                            </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w>  </span><span class=c># Gateway OTLP endpoint</span></span></span></code></pre></div><p><strong>Add a Batch Processor configuration</strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/batchprocessor/README.md rel=external target=_blank><strong>Batch Processor</strong></a> will accept spans, metrics, or logs and place them into batches. Batching helps better compress the data and reduce the number of outgoing connections required to transmit the data. It is highly recommended configuring the batch processor on every collector.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>                               </span><span class=c># Processor Type</span></span></span></code></pre></div><p><strong>Update the pipelines</strong>:</p><ol><li><strong>Enable Hostmetrics Receiver</strong>: Add <code>hostmetrics</code> to the <code>metrics</code> pipeline. The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/hostmetricsreceiver#readme rel=external target=_blank><strong>HostMetrics Receiver</strong></a> will generate host CPU metrics once per hour with the current configuration.</li><li><strong>Enable Batch Processor</strong>: Add the <code>batch</code> processor (after the <code>resource/add_mode</code> processor) to the <code>traces</code>, <code>metrics</code>, and <code>logs</code> pipelines.</li><li><strong>Enable OTLPHTTP Exporter</strong>: Add the <code>otlphttp</code> exporter to the <code>traces</code>, <code>metrics</code>, and <code>logs</code> pipelines.</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                          </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter                </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection             </span><span class=w> </span><span class=c># Add system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode             </span><span class=w> </span><span class=c># Add collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                         </span><span class=w> </span><span class=c># Batch processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                         </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file                          </span><span class=w> </span><span class=c># File Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp                      </span><span class=w> </span><span class=c># OTLP/HTTP Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>hostmetrics                   </span><span class=w> </span><span class=c># Host Metrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>metrics:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      REC2(hostmetrics&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-metrics
    subgraph &#34; &#34;
      subgraph subID1[**Metrics**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; EXP2
      PRO4 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=23-send-metrics-from-the-agent-to-the-gateway>2.3 Send metrics from the Agent to the Gateway</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Agent</strong>: In the <strong>Agent terminal</strong> window start the agent with the updated configuration:</p><div class=tab-panel data-tab-group=709342c6471246fefeb79298752d66b9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("709342c6471246fefeb79298752d66b9","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Verify CPU Metrics</strong>:</p><ol><li>Check that when the <code>agent</code> starts, it immediately starts sending <strong>CPU</strong> metrics.</li><li>Both the <code>agent</code> and the <code>gateway</code> will display this activity in their debug output. The output should resemble the following snippet:</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>NumberDataPoints #37
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>    -&gt; cpu: Str(cpu0)
</span></span><span class=line><span class=cl>    -&gt; state: Str(system)
</span></span><span class=line><span class=cl>StartTimestamp: 2024-12-09 14:18:28 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-01-15 15:27:51.319526 +0000 UTC
</span></span><span class=line><span class=cl>Value: 9637.660000</span></span></code></pre></div><p>At this stage, the <code>agent</code> continues to collect <strong>CPU</strong> metrics once per hour or upon each restart and sends them to the gateway.</p><p>The <code>gateway</code> processes these metrics and exports them to a file named <code>./gateway-metrics.out</code>. This file stores the exported metrics as part of the pipeline service.</p><p><strong>Verify Data arrived at Gateway</strong>: To confirm that CPU metrics, specifically for <code>cpu0</code>, have successfully reached the gateway, weâ€™ll inspect the <code>gateway-metrics.out</code> file using the <code>jq</code> command.</p><p>The following command filters and extracts the <code>system.cpu.time</code> metric, focusing on <code>cpu0</code>. It displays the metricâ€™s state (e.g., <code>user</code>, <code>system</code>, <code>idle</code>, <code>interrupt</code>) along with the corresponding values.</p><p>Run the command below in the <strong>Tests terminal</strong> to check the <code>system.cpu.time</code> metric:</p><div class=tab-panel data-tab-group=382bcccad32c709de5e0810820e27272><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-cpu-metrics class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("382bcccad32c709de5e0810820e27272","check-cpu-metrics")'>
<span class=tab-nav-text>Check CPU Metrics</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("382bcccad32c709de5e0810820e27272","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=check-cpu-metrics class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceMetrics[].scopeMetrics[].metrics[] | select(.name == &#34;system.cpu.time&#34;) | .sum.dataPoints[] | select(.attributes[0].value.stringValue == &#34;cpu0&#34;) | {cpu: .attributes[0].value.stringValue, state: .attributes[1].value.stringValue, value: .asDouble}&#39;</span> gateway-metrics.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>123407.02</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>64866.6</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;idle&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mf>216427.87</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;cpu&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;state&#34;</span><span class=p>:</span> <span class=s2>&#34;interrupt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=24-send-traces-from-the-agent-to-the-gateway>2.4 Send traces from the Agent to the Gateway</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Send a Test Trace</strong>:</p><ol><li>Validate <code>agent</code> and <code>gateway</code> are still running.</li><li>In the <strong>Spans terminal</strong> window, run the following command to send 5 spans and validate the output of the <code>agent</code> and <code>gateway</code> debug logs:</li></ol><div class=tab-panel data-tab-group=d68af0979b8d925cfc8fb934d2f67156><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d68af0979b8d925cfc8fb934d2f67156","start-the-load-generator")'>
<span class=tab-nav-text>Start the Load Generator</span>
</button>
<button data-tab-item=agentgateway-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("d68af0979b8d925cfc8fb934d2f67156","agentgateway-debug-output")'>
<span class=tab-nav-text>Agent/Gateway Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=start-the-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>5</span></span></span></code></pre></div></div></div><div data-tab-item=agentgateway-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-03-06T11:49:00.456Z        info    Traces  {&#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;Exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>2025-03-06T11:49:00.456Z        info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; service.name: Str(cinema-service)
</span></span><span class=line><span class=cl>     -&gt; deployment.environment: Str(production)
</span></span><span class=line><span class=cl>     -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>     -&gt; os.type: Str(linux)
</span></span><span class=line><span class=cl>     -&gt; otelcol.service.mode: Str(agent)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope cinema.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>     -&gt; fintest.scope.attribute: Str(Starwars, LOTR)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>    Trace ID       : 97fb4e5b13400b5689e3306da7cff077
</span></span><span class=line><span class=cl>    Parent ID      :
</span></span><span class=line><span class=cl>    ID             : 413358465e5b4f15
</span></span><span class=line><span class=cl>    Name           : /movie-validator
</span></span><span class=line><span class=cl>    Kind           : Server
</span></span><span class=line><span class=cl>    Start time     : 2025-03-06 11:49:00.431915 +0000 UTC
</span></span><span class=line><span class=cl>    End time       : 2025-03-06 11:49:01.431915 +0000 UTC
</span></span><span class=line><span class=cl>    Status code    : Ok
</span></span><span class=line><span class=cl>    Status message : Success
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>     -&gt; payment.amount: Double(87.01)
</span></span><span class=line><span class=cl>        {&#34;otelcol.component.id&#34;: &#34;debug&#34;, &#34;otelcol.component.kind&#34;: &#34;Exporter&#34;, &#34;otelcol.signal&#34;: &#34;traces&#34;}</span></span></code></pre></div></div></div></div></div><p><strong>Verify the Gateway has handled the spans</strong>: Once the gateway processes incoming spans, it writes the trace data to a file named <code>gateway-traces.out</code>. To confirm that the spans have been successfully handled, you can inspect this file.</p><p>Using the <code>jq</code> command, you can extract and display key details about each span, such as its <code>spanId</code> and its position in the file:</p><div class=tab-panel data-tab-group=8612a51c5748fd8b0cc19fdbfc62fcb6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=inspect-the-gateway-trace-file class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8612a51c5748fd8b0cc19fdbfc62fcb6","inspect-the-gateway-trace-file")'>
<span class=tab-nav-text>Inspect the Gateway Trace File</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("8612a51c5748fd8b0cc19fdbfc62fcb6","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=inspect-the-gateway-trace-file class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[] | &#34;Span \(input_line_number) found with spanId \(.spanId)&#34;&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with spanId 830b45581f53b3d8&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with spanId a82662dbed83cdee&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with spanId b662569e8e52c6ac&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with spanId 28b78a41a76162fa&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with spanId 23b06e57f8af7336&#34;</span></span></code></pre></div></div></div></div></div></div></details><p>Stop the <code>agent</code> and the <code>gateway</code> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=3-filelog-setup>3. FileLog Setup</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/filelogreceiver/README.md rel=external target=_blank><strong>FileLog Receiver</strong></a> in the OpenTelemetry Collector is used to ingest logs from files.</p><p>It monitors specified files for new log entries and streams those logs into the Collector for further processing or exporting. It is useful for testing and development purposes.</p><p>For this part of the workshop, the <code>loadgen</code> will generate logs using random quotes:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=line><span class=cl><span class=nx>lotrQuotes</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;One does not simply walk into Mordor.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;Even the smallest person can change the course of the future.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;All we have to decide is what to do with the time that is given us.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;There is some good in this world, and it&#39;s worth fighting for.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>starWarsQuotes</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;Do or do not, there is no try.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;The Force will be with you. Always.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;I find your lack of faith disturbing.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;In my experience, there is no such thing as luck.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The <strong>FileLog receiver</strong> in the <code>agent</code> will read these log lines and send them to the <code>gateway</code>.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>In the <strong>Logs terminal</strong> window, change into the <code>[WORKSHOP]</code> directory and create a new subdirectory named <code>3-filelog</code>.</li><li>Next, copy <code>*.yaml</code> from <code>2-gateway</code> into <code>3-filelog</code>.</li></ul><details open class="box cstyle notices important"><summary class=box-label><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/3-filelog</code> directory.</strong></p></div></details><div class=tab-panel data-tab-group=93a186b78d2eaeb409d98447e40f8dc7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("93a186b78d2eaeb409d98447e40f8dc7","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ 3-filelog
</span></span><span class=line><span class=cl> Â Â  â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl> Â Â  â””â”€â”€ gateway.yaml</span></span></code></pre></div></div></div></div></div><p>Start the <code>loadgen</code> and this will begin writing lines to a file named <code>quotes.log</code>:</p><div class=tab-panel data-tab-group=f6bfc067d6671d47c275e3660cb1ecf3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f6bfc067d6671d47c275e3660cb1ecf3","log-load-generator")'>
<span class=tab-nav-text>Log Load Generator</span>
</button>
<button data-tab-item=log-load-generator-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f6bfc067d6671d47c275e3660cb1ecf3","log-load-generator-output")'>
<span class=tab-nav-text>Log Load Generator Output</span></button></div><div class=tab-content-container><div data-tab-item=log-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -logs</span></span></code></pre></div></div></div><div data-tab-item=log-load-generator-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Writing logs to quotes.log. Press Ctrl+C to stop.</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 3. FileLog Setup</h1><article class=default><header class=headline></header><h1 id=31-configuration>3.1 Configuration</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In the <strong>Agent terminal</strong> window edit the <code>agent.yaml</code> and configure the FileLog receiver.</p><ol><li><p><strong>Configure FileLog Receiver</strong>: The <code>filelog</code> receiver reads log data from a file and includes custom resource attributes in the log data:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log             </span><span class=w> </span><span class=c># The file to read log data from</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include_file_path</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>            </span><span class=c># Include file path in the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include_file_name</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>           </span><span class=c># Exclude file name from the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>                          </span><span class=c># Add custom resource attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>com.splunk.source</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log </span><span class=w> </span><span class=c># Source of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>com.splunk.sourcetype</span><span class=p>:</span><span class=w> </span><span class=l>quotes   </span><span class=w> </span><span class=c># Source type of the log data</span></span></span></code></pre></div></li><li><p><strong>Update <code>logs</code> pipeline</strong>: Add the<code>filelog/quotes</code> receiver to the <code>logs</code> pipeline only:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes                </span><span class=w> </span><span class=c># Filelog Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></li><li><p><strong>Validate Configuration</strong>: Paste the updated <code>agent.yaml</code> into <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>logs:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      REC2(filelog&lt;br&gt;fa:fa-download&lt;br&gt;quotes):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(otlphttp&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; EXP1
      PRO4 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre></li></ol></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=32-test-filelog-receiver>3.2 Test FileLog Receiver</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <code>gateway</code>.</p><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <code>agent</code>.</p><p>A continuous stream of log data from the <code>quotes.log</code> will be in the <code>agent</code> and <code>gateway</code> debug logs:</p><div class=tab-panel data-tab-group=35346b03ea7484131a545f2036b40750><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agentgateway-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("35346b03ea7484131a545f2036b40750","agentgateway-debug-output")'>
<span class=tab-nav-text>Agent/Gateway Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=agentgateway-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Timestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-03-06 15:18:32 [ERROR] - There is some good in this world, and it&#39;s worth fighting for. LOTR)
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>Trace ID:
</span></span><span class=line><span class=cl>Span ID:
</span></span><span class=line><span class=cl>Flags: 0
</span></span><span class=line><span class=cl>LogRecord #1</span></span></code></pre></div></div></div></div></div><p><strong>Stop the <code>loadgen</code></strong>: In the <strong>Logs terminal</strong> window, stop the <code>loadgen</code> using <code>Ctrl-C</code>.</p><p><strong>Verify the gateway</strong>: Check if the <code>gateway</code> has written a <code>./gateway-logs.out</code> file.</p><p>At this point, your directory structure will appear as follows:</p><div class=tab-panel data-tab-group=7665969ce7e6b855e8500444902fd10c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7665969ce7e6b855e8500444902fd10c","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ 3-filelog
</span></span><span class=line><span class=cl> Â Â  â”œâ”€â”€ agent.out
</span></span><span class=line><span class=cl> Â Â  â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl> Â Â  â”œâ”€â”€ gateway-logs.out    # Output from the logs pipeline
</span></span><span class=line><span class=cl> Â Â  â”œâ”€â”€ gateway-metrics.out # Output from the metrics pipeline
</span></span><span class=line><span class=cl> Â Â  â”œâ”€â”€ gateway-traces.out  # Output from the traces pipeline
</span></span><span class=line><span class=cl> Â Â  â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl> Â Â  â””â”€â”€ quotes.log          # File containing Random log lines</span></span></code></pre></div></div></div></div></div><p><strong>Examine a log line</strong>: In <code>gateway-logs.out</code> compare a log line with the snippet below. Verify that the log entry includes the same attributes as we have seen in metrics and traces data previously:</p><div class=tab-panel data-tab-group=07822f5fabba1260ef35603c0c63f9d0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-gateway-logsout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("07822f5fabba1260ef35603c0c63f9d0","cat-gateway-logsout")'>
<span class=tab-nav-text>cat /gateway-logs.out</span>
</button>
<button data-tab-item=cat-gateway-logsout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("07822f5fabba1260ef35603c0c63f9d0","cat-gateway-logsout--jq")'>
<span class=tab-nav-text>cat ./gateway-logs.out | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-gateway-logsout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;workshop-instance&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;linux&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;gateway&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{},</span><span class=nt>&#34;logRecords&#34;</span><span class=p>:[{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1741274312475540000&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - All we have to decide is what to do with the time that is given us. LOTR&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>},{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1741274312475560000&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - Your focus determines your reality. SW&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-gateway-logsout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;./quotes.log&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;workshop-instance&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;linux&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;gateway&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;logRecords&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1741274312475540000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - All we have to decide is what to do with the time that is given us. LOTR&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1741274312475560000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-03-06 15:18:32 [DEBUG] - Your focus determines your reality. SW&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>You may also have noticed that every log line contains empty placeholders for <code>"traceId":""</code> and <code>"spanId":""</code>.<br>The FileLog receiver will populate these fields only if they are not already present in the log line.
For example, if the log line is generated by an application instrumented with an OpenTelemetry instrumentation library, these fields will already be included and will not be overwritten.</p></div></details></div></details><p>Stop the <code>agent</code> and <code>gateway</code> using <code>Ctrl-C</code> in their respective terminal windows.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=4-building-in-resilience>4. Building In Resilience</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The OpenTelemetry Collectorâ€™s <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/19bc7d6ee854c0c1b5c97d8d348e5b9d1199e8aa/extension/storage/filestorage/README.md rel=external target=_blank><strong>FileStorage Extension</strong></a> enhances the resilience of your telemetry pipeline by providing reliable checkpointing, managing retries, and handling temporary failures effectively.</p><p>With this extension enabled, the OpenTelemetry Collector can store intermediate states on disk, preventing data loss during network disruptions and allowing it to resume operations seamlessly.</p><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>This solution will work for metrics as long as the connection downtime is briefâ€”up to 15 minutes. If the downtime exceeds this, Splunk Observability Cloud will drop data due to datapoints being out of order.</p><p>For logs, there are plans to implement a more enterprise-ready solution in one of the upcoming Splunk OpenTelemetry Collector releases.</p></div></details><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>4-resilience</code>.</li><li>Next, copy <code>*.yaml</code> from the <code>3-filelog</code> directory into <code>4-resilience</code>.</li></ul><details open class="box cstyle notices important"><summary class=box-label><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/4-resilience</code> directory.</strong></p></div></details><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=881749e3863ddaed1b996248e619d49a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("881749e3863ddaed1b996248e619d49a","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â””â”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 4. Building Resilience</h1><article class=default><header class=headline></header><h1 id=41-file-storage-configuration>4.1 File Storage Configuration</h1><p>In this exercise, we will update the <code>extensions:</code> section of the <code>agent.yaml</code> file. This section is part of the OpenTelemetry configuration YAML and defines optional components that enhance or modify the OpenTelemetry Collectorâ€™s behavior.</p><p>While these components do not process telemetry data directly, they provide valuable capabilities and services to improve the Collectorâ€™s functionality.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Update the <code>agent.yaml</code></strong>: In the <strong>Agent terminal</strong> window, add the <code>file_storage</code> extension and name it <code>checkpoint</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage/checkpoint</span><span class=p>:</span><span class=w>             </span><span class=c># Extension Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./checkpoint-dir&#34;</span><span class=w>      </span><span class=c># Define directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>create_directory</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>             </span><span class=c># Create directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>1s                       </span><span class=w> </span><span class=c># Timeout for file operations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>                        </span><span class=c># Compaction settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                   </span><span class=c># Start compaction at Collector startup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Define compaction directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./checkpoint-dir/tmp&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_transaction_size</span><span class=p>:</span><span class=w> </span><span class=m>65536</span><span class=w>      </span><span class=c># Max. size limit before compaction occurs</span></span></span></code></pre></div><p><strong>Add <code>file_storage</code> to existing <code>otlphttp</code> exporter</strong>: Modify the <code>otlphttp:</code> exporter to configure retry and queuing mechanisms, ensuring data is retained and resent if failures occur:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>retry_on_failure</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                    </span><span class=c># Enable retry on failure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sending_queue</span><span class=p>:</span><span class=w>                     </span><span class=c># </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                    </span><span class=c># Enable sending queue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>num_consumers</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>                </span><span class=c># No. of consumers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>queue_size</span><span class=p>:</span><span class=w> </span><span class=m>10000</span><span class=w>                </span><span class=c># Max. queue size</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>file_storage/checkpoint</span><span class=w> </span><span class=c># File storage extension</span></span></span></code></pre></div><p><strong>Update the <code>services</code> section</strong>: Add the <code>file_storage/checkpoint</code> extension to the existing <code>extensions:</code> section. This will cause the extension to be enabled:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>file_storage/checkpoint           </span><span class=w> </span><span class=c># Enabled extensions for this collector</span></span></span></code></pre></div><p><strong>Update the <code>metrics</code> pipeline</strong>: For this exercise we are going to remove the <code>hostmetrics</code> receiver from the Metric pipeline to reduce debug and log noise:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># - hostmetrics                  # Hostmetrics Receiver</span></span></span></code></pre></div></div></details><p>Validate the <code>agent</code> configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>metrics:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(otlphttp&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-metrics
    subgraph &#34; &#34;
      subgraph subID1[**Metrics**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; EXP1
      PRO4 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=42-setup-environment-for-resilience-testing>4.2 Setup environment for Resilience Testing</h1><p>Next, we will configure our environment to be ready for testing the <strong>File Storage</strong> configuration.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway terminal</strong> window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=fb3f6de8143379627defd6012b6b22b4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("fb3f6de8143379627defd6012b6b22b4","start-the-gateway")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div data-tab-item=start-the-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent terminal</strong> window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=776ec20e788550f555cf5a744085beb7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("776ec20e788550f555cf5a744085beb7","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Send five test spans</strong>: In the <strong>Spans terminal</strong> window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=1f94d5bf90c13a55d5f4855400c17729><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1f94d5bf90c13a55d5f4855400c17729","start-load-generator")'>
<span class=tab-nav-text>Start Load Generator</span></button></div><div class=tab-content-container><div data-tab-item=start-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>5</span></span></span></code></pre></div></div></div></div></div><p>Both the <code>agent</code> and <code>gateway</code> should display debug logs, and the <code>gateway</code> should create a <code>./gateway-traces.out</code> file.</p></div></details><p>If everything functions correctly, we can proceed with testing system resilience.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=43-simulate-failure>4.3 Simulate Failure</h1><p>To assess the <strong>Agent&rsquo;s</strong> resilience, we&rsquo;ll simulate a temporary <code>gateway</code> outage and observe how the <code>agent</code> handles it:</p><p><strong>Summary</strong>:</p><ol><li><strong>Send Traces to the Agent</strong> â€“ Generate traffic by sending traces to the <code>agent</code>.</li><li><strong>Stop the Gateway</strong> â€“ This will trigger the <code>agent</code> to enter retry mode.</li><li><strong>Restart the Gateway</strong> â€“ The <code>agent</code> will recover traces from its persistent queue and forward them successfully. Without the persistent queue, these traces would have been lost permanently.</li></ol><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Simulate a network failure</strong>: In the <strong>Gateway terminal</strong> stop the <code>gateway</code> with <code>Ctrl-C</code> and wait until the gateway console shows that it has stopped:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T13:24:32.785+0100  info  service@v0.120.0/service.go:309  Shutdown complete.</span></span></code></pre></div><p><strong>Send traces</strong>: In the <strong>Spans terminal</strong> window send five more traces using the <code>loadgen</code>.</p><p>Notice that the agentâ€™s retry mechanism is activated as it continuously attempts to resend the data. In the agentâ€™s console output, you will see repeated messages similar to the following:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T14:22:47.020+0100  info  internal/retry_sender.go:126  Exporting failed. Will retry the request after interval.  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;otlphttp&#34;, &#34;error&#34;: &#34;failed to make an HTTP request: Post \&#34;http://localhost:5318/v1/traces\&#34;: dial tcp 127.0.0.1:5318: connect: connection refused&#34;, &#34;interval&#34;: &#34;9.471474933s&#34;}</span></span></code></pre></div><p><strong>Stop the Agent</strong>: In the <strong>Agent terminal</strong> window, use <code>Ctrl-C</code> to stop the agent. Wait until the agentâ€™s console confirms it has stopped:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T14:40:28.702+0100  info  extensions/extensions.go:66  Stopping extensions...
</span></span><span class=line><span class=cl>2025-01-28T14:40:28.702+0100  info  service@v0.120.0/service.go:309  Shutdown complete.</span></span></code></pre></div></div></details><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Stopping the agent will halt its retry attempts and prevent any future retry activity.</p><p>If the agent runs for too long without successfully delivering data, it may begin dropping traces, depending on the retry configuration, to conserve memory. By stopping the agent, any metrics, traces, or logs currently stored in memory are lost before being dropped, ensuring they remain available for recovery.</p><p>This step is essential for clearly observing the recovery process when the agent is restarted.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=44-simulate-recovery>4.4 Simulate Recovery</h1><p>In this exercise, weâ€™ll test how the <strong>OpenTelemetry Collector</strong> recovers from a network outage by restarting the <strong>Gateway</strong>. When the <code>gateway</code> becomes available again, the <code>agent</code> will resume sending data from its last checkpointed state, ensuring no data loss.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Restart the Gateway</strong>: In the <strong>Gateway terminal</strong> window run:</p><div class=tab-panel data-tab-group=790eed1d4e23e4e57f790fb8e5863c87><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("790eed1d4e23e4e57f790fb8e5863c87","gateway")'>
<span class=tab-nav-text>Gateway</span></button></div><div class=tab-content-container><div data-tab-item=gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Restart the Agent</strong>: In the <strong>Agent terminal</strong> window run:</p><div class=tab-panel data-tab-group=9c985ccc46e0cd3a1cda54a073ad18ce><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9c985ccc46e0cd3a1cda54a073ad18ce","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>After the <code>agent</code> is up and running, the <strong>File_Storage</strong> extension will detect buffered data in the checkpoint folder.<br>It will start to dequeue the stored spans from the last checkpoint folder, ensuring no data is lost.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Verify the Agent Debug output</strong><br>Note that the Agent Debug Screen does <strong>NOT</strong> change and still shows the following line indicating no new data is being exported.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-02-07T13:40:12.195+0100    info    service@v0.117.0/service.go:253 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p><strong>Watch the Gateway Debug output</strong><br>You should see from the <code>gateway</code> debug screen, it has started receiving the previously missed traces without requiring any additional action on your part.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>2025-02-07T12:44:32.651+0100    info    service@v0.117.0/service.go:253 Everything is ready. Begin running and processing data.
</span></span><span class=line><span class=cl>2025-02-07T12:47:46.721+0100    info    Traces  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 4, &#34;spans&#34;: 4}
</span></span><span class=line><span class=cl>2025-02-07T12:47:46.721+0100    info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:</span></span></code></pre></div><p><strong>Check the <code>gateway-traces.out</code> file</strong><br>Using <code>jq</code>, count the number of traces in the recreated <code>gateway-traces.out</code>. It should match the number you send when the <code>gateway</code> was down.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans | length | &#34;\(.) resourceSpans found&#34;&#39;</span> gateway-traces.out</span></span></code></pre></div></div></details><h3 id=conclusion>Conclusion</h3><p>This exercise demonstrated how to enhance the resilience of the OpenTelemetry Collector by configuring the <code>file_storage</code> extension, enabling retry mechanisms for the <code>otlp</code> exporter, and using a file-backed queue for temporary data storage.</p><p>By implementing file-based checkpointing and queue persistence, you ensure the telemetry pipeline can gracefully recover from temporary interruptions, making it a more robust and reliable for production environments.</p><p>Stop the <code>agent</code> and <code>gateway</code> using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=5-dropping-spans>5. Dropping Spans</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, we will explore how to use the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/filterprocessor/README.md rel=external target=_blank><strong>Filter Processor</strong></a> to selectively drop spans based on certain conditions.</p><p>Specifically, we will drop traces based on the span name, which is commonly used to filter out unwanted spans such as health checks or internal communication traces. In this case, we will be filtering out spans whose name is <code>"/_healthz"</code>, typically associated with health check requests and usually are quite &ldquo;<strong>noisy</strong>&rdquo;.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>5-dropping-spans</code>.</li><li>Next, copy <code>*.yaml</code> from the <code>4-resilience</code> directory into <code>5-dropping-spans</code>.</li></ul><details open class="box cstyle notices important"><summary class=box-label><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/5-dropping-spans</code> directory.</strong></p></div></details><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=30f6a257c22e3bda0008063a2e539b9b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("30f6a257c22e3bda0008063a2e539b9b","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ 5-dropping-spans
</span></span><span class=line><span class=cl>    â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>    â””â”€â”€ gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>Next, we will configure the <strong>filter processor</strong> and the respective pipelines.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 5. Dropping Spans</h1><article class=default><header class=headline></header><h1 id=51-configuration>5.1 Configuration</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Switch to your <strong>Gateway terminal</strong> window, open the <code>gateway.yaml</code> and add the following configuration to the <code>processors</code> section:</p><p><strong>Add a <code>filter</code> processor</strong>: Configure the <code>gateway</code> to drop spans with the name <code>"/_healthz"</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>filter/health</span><span class=p>:</span><span class=w>                       </span><span class=c># Defines a filter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                </span><span class=w> </span><span class=c># Ignore errors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                            </span><span class=c># Filtering rules for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>span</span><span class=p>:</span><span class=w>                            </span><span class=c># Exclude spans named &#34;/_healthz&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s1>&#39;name == &#34;/_healthz&#34;&#39;</span></span></span></code></pre></div><p><strong>Add the <code>filter</code> processor</strong>: Make sure you add the filter to the <code>traces</code> pipeline. Filtering should be applied as early as possible, ideally <em>right after the</em> memory_limiter and <em>before</em> the batch processor:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filter/health            </span><span class=w> </span><span class=c># Filters data based on rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(filter&lt;br&gt;fa:fa-microchip&lt;br&gt;health):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;file&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO4
      PRO4 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=52-test-filter-processor>5.2 Test Filter Processor</h1><p>To test your configuration, you&rsquo;ll need to generate some trace data that includes a span named <code>"/_healthz"</code>.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <code>gateway</code>.</p><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <code>agent</code>.</p><p><strong>Start the Loadgen</strong>: In the <strong>Spans terminal</strong> window run the <code>loadgen</code> with the flag to also send <code>healthz</code> spans along with base spans:</p><div class=tab-panel data-tab-group=a0c3e294385cd933efcbbaff6b6dc92b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-load-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a0c3e294385cd933efcbbaff6b6dc92b","start-load-generator")'>
<span class=tab-nav-text>Start Load Generator</span></button></div><div class=tab-content-container><div data-tab-item=start-load-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -health -count <span class=m>5</span></span></span></code></pre></div></div></div></div></div><p><strong>Verify <code>agent.out</code></strong>: Using <code>jq</code> confirm the name of the spans received by the <code>agent</code>:</p><div class=tab-panel data-tab-group=59eb56ff9242f820ef1d312ed1efd577><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-spans-in-agentout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("59eb56ff9242f820ef1d312ed1efd577","check-spans-in-agentout")'>
<span class=tab-nav-text>Check spans in agent.out</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("59eb56ff9242f820ef1d312ed1efd577","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=check-spans-in-agentout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[] | &#34;Span \(input_line_number) found with name \(.name)&#34;&#39;</span> ./agent.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 6 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 7 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 8 found with name /_healthz&#34;
</span></span><span class=line><span class=cl>&#34;Span 9 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 10 found with name /_healthz&#34;</span></span></code></pre></div></div></div></div></div><p><strong>Check the Gateway Debug output</strong>: Using <code>jq</code> confirm the name of the spans received by the <code>gateway</code>:</p><div class=tab-panel data-tab-group=ac721f312b39cc8ccf64ab7c7700722a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-spans-in-gateway-tracesout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ac721f312b39cc8ccf64ab7c7700722a","check-spans-in-gateway-tracesout")'>
<span class=tab-nav-text>Check spans in gateway-traces.out</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ac721f312b39cc8ccf64ab7c7700722a","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=check-spans-in-gateway-tracesout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=tab-panel data-tab-group=4d3dd1116cc4ab629a4b3cbf5fb0bd1d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=check-spans-in-gateway-tracesout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4d3dd1116cc4ab629a4b3cbf5fb0bd1d","check-spans-in-gateway-tracesout")'>
<span class=tab-nav-text>Check spans in gateway-traces.out</span></button></div><div class=tab-content-container><div data-tab-item=check-spans-in-gateway-tracesout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[] | &#34;Span \(input_line_number) found with name \(.name)&#34;&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div></div></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>The <code>gateway-metrics.out</code> file will not contain any spans named <code>/_healthz</code>.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&#34;Span 1 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 2 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 3 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 4 found with name /movie-validator&#34;
</span></span><span class=line><span class=cl>&#34;Span 5 found with name /movie-validator&#34;</span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>When using the <code>Filter</code> processor make sure you understand the look of your incoming data and test the configuration thoroughly. In general, use <strong>as specific a configuration as possible</strong> to lower the risk of the wrong data being dropped.</p><p>You can further extend this configuration to filter out spans based on different attributes, tags, or other criteria, making the OpenTelemetry Collector more customizable and efficient for your observability needs.</p></div></details><p>Stop the <code>agent</code> and <code>gateway</code> using <code>Ctrl-C</code> in their respective terminal windows.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=6-redacting-sensitive-data>6. Redacting Sensitive Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, you&rsquo;ll learn how to configure the OpenTelemetry Collector to remove specific tags and redact sensitive data from telemetry spans. This is crucial for protecting sensitive information such as credit card numbers, personal data, or other security-related details that must be anonymized before being processed or exported.</p><p>We&rsquo;ll walk through configuring key processors in the OpenTelemetry Collector, including:</p><ul><li><strong><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/attributesprocessor/README.md rel=external target=_blank>Attributes Processor</a></strong>: Modifies or removes specific span attributes.</li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/redactionprocessor/README.md rel=external target=_blank><strong>Redaction Processor</strong></a>: Ensures sensitive data is sanitized before being stored or transmitted.</li></ul><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>6-sensitive-data</code>.</li><li>Next, copy <code>*.yaml</code> from the <code>5-dropping-spans</code> directory into <code>6-sensitive-data</code>.</li></ul><details open class="box cstyle notices important"><summary class=box-label><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/6-sensitive-data</code> directory.</strong></p></div></details><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=2caf6dcc5a1c04998a378234f3708218><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2caf6dcc5a1c04998a378234f3708218","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ 6-sensitive-data
</span></span><span class=line><span class=cl>    â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>    â””â”€â”€ gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 6. Sensitive Data</h1><article class=default><header class=headline></header><h1 id=61-configuration>6.1 Configuration</h1><p>In this step, we&rsquo;ll modify <code>agent.yaml</code> to include the <code>attributes</code> and <code>redaction</code> processors. These processors will help ensure that sensitive data within span attributes is properly handled before being logged or exported.</p><p>Previously, you may have noticed that some span attributes displayed in the console contained personal and sensitive data. We&rsquo;ll now configure the necessary processors to filter out and redact this information effectively.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Switch to your <strong>Agent terminal</strong> window and open the <code>agent.yaml</code> file in your editor.</p><p><strong>Add an <code>attributes</code> Processor</strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/attributesprocessor rel=external target=_blank><strong>Attributes Processor</strong></a> allows you to update, delete, or hash specific attributes (tags) within spans.<br>We&rsquo;ll <strong>update</strong> the <code>user.phone_number</code>, <strong>hash</strong> the <code>user.email</code>, and <strong>delete</strong> the <code>user.account_password</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/update</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>                           </span><span class=c># Actions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.phone_number        </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update                </span><span class=w> </span><span class=c># Update action</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UNKNOWN NUMBER&#34;</span><span class=w>        </span><span class=c># New value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.email               </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>hash                  </span><span class=w> </span><span class=c># Hash the email value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.password            </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete                </span><span class=w> </span><span class=c># Delete the password</span></span></span></code></pre></div><p><strong>Add a <code>redaction</code> Processor</strong>: <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/redactionprocessor rel=external target=_blank><strong>The Redaction Processor</strong></a> will detect and redact sensitive data values based on predefined patterns. We&rsquo;ll block credit card numbers using regular expressions.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>redaction/redact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>allow_all_keys</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>               </span><span class=c># If false, only allowed keys will be retained</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>blocked_values</span><span class=p>:</span><span class=w>                    </span><span class=c># List of regex patterns to block</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b4[0-9]{3}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>       </span><span class=c># Visa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b5[1-5][0-9]{2}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>  </span><span class=c># MasterCard</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>debug                    </span><span class=w> </span><span class=c># Show debug details about redaction</span></span></span></code></pre></div><p><strong>Update the <code>traces</code> Pipeline</strong>: Integrate both processors into the <code>traces</code> pipeline. Make sure that you comment out the redaction processor at first: (We will enable it later)</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update             </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- redaction/redact              # Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      PRO6(attributes&lt;br&gt;fa:fa-microchip&lt;br&gt;update):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;debug&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP3(file&lt;br&gt;fa:fa-upload):::exporter

    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO6
      PRO6 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP2
      PRO5 --&gt; EXP3
      PRO5 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=62-test-attribute-processor>6.2 Test Attribute Processor</h1><p>In this exercise, we will <strong>delete</strong> the <code>user.account_password</code>, <strong>update</strong> the <code>user.phone_number</code> <strong>attribute</strong> and <strong>hash</strong> the <code>user.email</code> in the span data before it is exported by the <code>agent</code>.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <code>gateway</code>.</p><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <code>agent</code>.</p><p><strong>Start the Load Generator</strong>: In the <strong>Spans terminal</strong> window start the <code>loadgen</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p><strong>Check the debug output</strong>: For both the <code>agent</code> and <code>gateway</code> debug output, confirm that <code>user.account_password</code> has been removed, and both <code>user.phone_number</code> & <code>user.email</code> have been updated.</p><div class=tab-panel data-tab-group=ddb04133edbf9768bb7ee84388b65160><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ddb04133edbf9768bb7ee84388b65160","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ddb04133edbf9768bb7ee84388b65160","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>   -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>   -&gt; user.phone_number: Str(UNKNOWN NUMBER)
</span></span><span class=line><span class=cl>   -&gt; user.email: Str(62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287)
</span></span><span class=line><span class=cl>   -&gt; payment.amount: Double(51.71)
</span></span><span class=line><span class=cl>   -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>   -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>   -&gt; user.mastercard: Str(5555 5555 5555 4444)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>    -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>    -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>    -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>    -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>    -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>    -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>    -&gt; payment.amount: Double(95.22)</span></span></code></pre></div></div></div></div></div><p><strong>Check file output</strong>: Using <code>jq</code> validate that <code>user.account_password</code> has been removed, and <code>user.phone_number</code> & <code>user.email</code> have been updated in <code>gateway-taces.out</code>:</p><div class=tab-panel data-tab-group=7efe4519a7ddd35fd440495920019abe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=validate-attribute-changes class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7efe4519a7ddd35fd440495920019abe","validate-attribute-changes")'>
<span class=tab-nav-text>Validate attribute changes</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("7efe4519a7ddd35fd440495920019abe","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=validate-attribute-changes class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[].attributes[] | select(.key == &#34;user.password&#34; or .key == &#34;user.phone_number&#34; or .key == &#34;user.email&#34;) | {key: .key, value: .value.stringValue}&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Notice that the <code>user.account_password</code> has been removed, and the <code>user.phone_number</code> & <code>user.email</code> have been updated:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;UNKNOWN NUMBER&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><p>Stop the <code>agent</code> and <code>gateway</code> using <code>Ctrl-C</code> in their respective terminals.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=63-test-redaction-processor>6.3 Test Redaction Processor</h1><p>The <code>redaction</code> processor gives precise control over which attributes and values are <strong>permitted</strong> or <strong>removed</strong> from telemetry data.</p><p>In this exercise, we will <strong>redact</strong> the <code>user.visa</code> & <code>user.mastercard</code> <strong>values</strong> in the span data before it is exported by the <code>agent</code>.<details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Prepare the terminals</strong>: Delete the <code>*.out</code> files and clear the screen.</p><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <code>gateway</code>.</p><p><strong>Enable the <code>redaction/redact</code> processor</strong>: In the <strong>Agent terminal</strong> window, edit <code>agent.yaml</code> and remove the <code>#</code> we inserted in the previous exercise.</p><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <code>agent</code>.</p><p><strong>Start the Load Generator</strong>: In the <strong>Spans terminal</strong> window start the <code>loadgen</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p><strong>Check the debug output</strong>: For both the <code>agent</code> and <code>gateway</code> confirm the values for <code>user.visa</code> & <code>user.mastercard</code> have been updated. Notice <code>user.amex</code> attribute value was NOT redacted because a matching regex pattern was not added to <code>blocked_values</code></p><div class=tab-panel data-tab-group=5005592cbe4763526ef5ec104fd8e9bb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5005592cbe4763526ef5ec104fd8e9bb","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5005592cbe4763526ef5ec104fd8e9bb","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>   -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>   -&gt; user.phone_number: Str(UNKNOWN NUMBER)
</span></span><span class=line><span class=cl>   -&gt; user.email: Str(62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287)
</span></span><span class=line><span class=cl>   -&gt; payment.amount: Double(69.71)
</span></span><span class=line><span class=cl>   -&gt; user.visa: Str(****)
</span></span><span class=line><span class=cl>   -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>   -&gt; user.mastercard: Str(****)
</span></span><span class=line><span class=cl>   -&gt; redaction.masked.keys: Str(user.mastercard,user.visa)
</span></span><span class=line><span class=cl>   -&gt; redaction.masked.count: Int(2)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>    -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>    -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>    -&gt; user.password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>    -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>    -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>    -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>    -&gt; payment.amount: Double(65.54)</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>By including <code>summary:debug</code> in the redaction processor, the debug output will include summary information about which matching keys values were redacted, along with the count of values that were masked.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>     -&gt; redaction.masked.keys: Str(user.mastercard,user.visa)
</span></span><span class=line><span class=cl>     -&gt; redaction.masked.count: Int(2)</span></span></code></pre></div></div></details><p><strong>Check file output</strong>: In the newly created <code>gateway-traces.out</code> file to verify confirm that <code>user.visa</code> & <code>user.mastercard</code> have been updated.</p><div class=tab-panel data-tab-group=956013914edfb5d900ca24312d48142d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=validate-attribute-changes class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("956013914edfb5d900ca24312d48142d","validate-attribute-changes")'>
<span class=tab-nav-text>Validate attribute changes</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("956013914edfb5d900ca24312d48142d","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=validate-attribute-changes class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;.resourceSpans[].scopeSpans[].spans[].attributes[] | select(.key == &#34;user.visa&#34; or .key == &#34;user.mastercard&#34;) | {key: .key, value: .value.stringValue}&#39;</span> ./gateway-traces.out</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><p>Notice that the <code>user.account_password</code> has been removed, and the <code>user.phone_number</code> & <code>user.email</code> have been updated:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;****&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=s2>&#34;****&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details></p><p>These are just a few examples of how <code>attributes</code> and <code>redaction</code> processors can be configured to protect sensitive data.</p><p>Stop the <code>agent</code> and <code>gateway</code> using <code>Ctrl-C</code> in their respective terminals.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=7-transform-data>7. Transform Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/transformprocessor/README.md rel=external target=_blank><strong>Transform Processor</strong></a> lets you modify telemetry dataâ€”logs, metrics, and tracesâ€”as it flows through the pipeline. Using the <strong>OpenTelemetry Transformation Language (OTTL)</strong>, you can filter, enrich, and transform data on the fly without touching your application code.</p><p>In this exercise weâ€™ll update <code>agent.yaml</code> to include a <strong>Transform Processor</strong> that will:</p><ul><li><strong>Filter</strong> log resource attributes.</li><li><strong>Parse</strong> JSON structured log data into attributes.</li><li><strong>Set</strong> log severity levels based on the log message body.</li></ul><p>You may have noticed that in previous logs, fields like <code>SeverityText</code> and <code>SeverityNumber</code> were undefined (this is typical of the <code>filelog</code> receiver). However, the severity is embedded within the log body:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>SeverityText: 
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-01-31 15:49:29 [WARN] - Do or do not, there is no try.)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div><p>Logs often contain structured data encoded as JSON within the log body. Extracting these fields into attributes allows for better indexing, filtering, and querying. Instead of manually parsing JSON in downstream systems, OTTL enables automatic transformation at the telemetry pipeline level.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>7-transform-data</code>.</li><li>Next, copy <code>*.yaml</code> from the <code>6-sensitve-data</code> directory into <code>7-transform-data</code>.</li></ul><details open class="box cstyle notices important"><summary class=box-label><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>[WORKSHOP]/7-transform-data</code> directory.</strong></p></div></details><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=adf80d4760cc425b381da3b2a719341a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("adf80d4760cc425b381da3b2a719341a","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â””â”€â”€ 7-transform-data
</span></span><span class=line><span class=cl>    â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>    â””â”€â”€ gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 7. Transform Data</h1><article class=default><header class=headline></header><h1 id=71-configuration>7.1 Configuration</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add a <code>transform</code> processor</strong>: Switch to your <strong>Agent terminal</strong> window and edit the <code>agent.yaml</code> and add the following <code>transform</code> processor:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>transform/logs</span><span class=p>:</span><span class=w>                      </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>log_statements</span><span class=p>:</span><span class=w>                    </span><span class=c># Log Processing Statements</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>resource             </span><span class=w> </span><span class=c># Log Context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statements</span><span class=p>:</span><span class=w>                    </span><span class=c># List of attribute keys to keep</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>keep_keys(attributes, [&#34;com.splunk.sourcetype&#34;, &#34;host.name&#34;, &#34;otelcol.service.mode&#34;])</span></span></span></code></pre></div><p>By using the <code>-context: resource</code> key we are targeting the <code>resourceLog</code> attributes of logs.</p><p>This configuration ensures that only the relevant resource attributes (<code>com.splunk.sourcetype</code>, <code>host.name</code>, <code>otelcol.service.mode</code>) are retained, improving log efficiency and reducing unnecessary metadata.</p><p><strong>Adding a Context Block for Log Severity Mapping</strong>: To properly set the <code>severity_text</code> and <code>severity_number</code> fields of a log record, we add another log <code>context</code> block within <code>log_statements</code>.</p><p>This configuration extracts the <code>level</code> value from the log body, maps it to <code>severity_text</code>, and assigns the appropriate <code>severity_number</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>      </span>- <span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>log                  </span><span class=w> </span><span class=c># Log Context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statements</span><span class=p>:</span><span class=w>                    </span><span class=c># Transform Statements Array</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(cache, ParseJSON(body)) where IsMatch(body, &#34;^\\{&#34;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>flatten(cache, &#34;&#34;)        </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>merge_maps(attributes, cache, &#34;upsert&#34;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_text, attributes[&#34;level&#34;])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 1) where severity_text == &#34;TRACE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 5) where severity_text == &#34;DEBUG&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 9) where severity_text == &#34;INFO&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 13) where severity_text == &#34;WARN&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 17) where severity_text == &#34;ERROR&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 21) where severity_text == &#34;FATAL&#34;</span></span></span></code></pre></div><p><strong>Summary of Key Transformations</strong>:</p><ul><li><strong>Parse JSON</strong>: Extracts structured data from the log body.</li><li><strong>Flatten JSON</strong>: Converts nested JSON objects into a flat structure.</li><li><strong>Merge Attributes</strong>: Integrates extracted data into log attributes.</li><li><strong>Map Severity Text</strong>: Assigns severity_text from the logâ€™s level attribute.</li><li><strong>Assign Severity Numbers</strong>: Converts severity levels into standardized numerical values.</li></ul><p>You should have a <strong>single</strong> <code>transform</code> processor containing two context blocks: one for <code>resource</code> and one for <code>log</code>.</p><p>This configuration ensures that log severity is correctly extracted, standardized, and structured for efficient processing.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>This method of mapping all JSON fields to top-level attributes should only be used for <strong>testing and debugging OTTL</strong>. It will result in high cardinality in a production scenario.</p></div></details><p><strong>Update the <code>logs</code> pipeline</strong>: Add the <code>transform/logs:</code> processor into the <code>logs:</code> pipeline:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>transform/logs                </span><span class=w> </span><span class=c># Transform logs processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <a href=https://.otelbin.io/ rel=external target=_blank><strong>https://otelbin.io</strong></a>. For reference, the <code>logs:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      REC2(filelog&lt;br&gt;fa:fa-download&lt;br&gt;quotes):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(transform&lt;br&gt;fa:fa-microchip&lt;br&gt;logs):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;debug&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; PRO5
      PRO5 --&gt; EXP2
      PRO5 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 11, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=72-setup-environment>7.2 Setup Environment</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway terminal</strong> run:</p><div class=tab-panel data-tab-group=579a5c76f7831acbb8620557d3548ce5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("579a5c76f7831acbb8620557d3548ce5","start-the-gateway")'>
<span class=tab-nav-text>Start the Gateway</span></button></div><div class=tab-content-container><div data-tab-item=start-the-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent terminal</strong> run:</p><div class=tab-panel data-tab-group=1daa6c1afc163d4512fd2987d095b54b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=start-the-agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1daa6c1afc163d4512fd2987d095b54b","start-the-agent")'>
<span class=tab-nav-text>Start the Agent</span></button></div><div class=tab-content-container><div data-tab-item=start-the-agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Load Generator</strong>: Open the <strong>Logs terminal</strong> window and run the <code>loadgen</code>.</p><details open class="box cstyle notices important"><summary class=box-label><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>To ensure the logs are structured in JSON format, include the <code>-json</code> flag when starting the script.</p></div></details><div class=tab-panel data-tab-group=6a94457c0244fecea36abe821c52fc0b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6a94457c0244fecea36abe821c52fc0b","log-generator")'>
<span class=tab-nav-text>Log Generator</span></button></div><div class=tab-content-container><div data-tab-item=log-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -logs -json -count <span class=m>5</span></span></span></code></pre></div></div></div></div></div><p>The <code>loadgen</code> will write 5 log lines to <code>./quotes.log</code> in JSON format.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=73-test-transform-processor>7.3 Test Transform Processor</h1><p>This test verifies that the <code>com.splunk/source</code> and <code>os.type</code> metadata have been <strong>removed</strong> from the log resource attributes before being exported by the <code>agent</code>. Additionally, the test ensures that:</p><ol><li>The log body is parsed to extract severity information.<ul><li><code>SeverityText</code> and <code>SeverityNumber</code> are set on the <code>LogRecord</code>.</li></ul></li><li>JSON fields from the log body are promoted to log <code>attributes</code>.</li></ol><p>This ensures proper metadata filtering, severity mapping, and structured log enrichment before export.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Stop the Load Generator</strong>: In the <strong>Logs terminal</strong> window, press <code>Ctrl+C</code> to stop the <code>loadgen</code>.</p><p><strong>Check the debug output</strong>: For both the <code>agent</code> and <code>gateway</code> confirm that <code>com.splunk/source</code> and <code>os.type</code> have been removed:</p><div class=tab-panel data-tab-group=512280241b41d460b47231d48e59dc66><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("512280241b41d460b47231d48e59dc66","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("512280241b41d460b47231d48e59dc66","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>   -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>   -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>   -&gt; otelcol.service.mode: Str(agent)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>   -&gt; com.splunk.source: Str(./quotes.log)
</span></span><span class=line><span class=cl>   -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>   -&gt; host.name: Str(workshop-instance)
</span></span><span class=line><span class=cl>   -&gt; os.type: Str(linux)
</span></span><span class=line><span class=cl>   -&gt; otelcol.service.mode: Str(agent)</span></span></code></pre></div></div></div></div></div><p>For both the <code>agent</code> and <code>gateway</code> confirm that <code>SeverityText</code> and <code>SeverityNumber</code> in the <code>LogRecord</code> is now defined with the severity <code>level</code> from the log body. Confirm that the JSON fields from the body can be accessed as top-level log <code>Attributes</code>:</p><div class=tab-panel data-tab-group=81774899abe47e37978990441deff0ac><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("81774899abe47e37978990441deff0ac","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("81774899abe47e37978990441deff0ac","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>SeverityText: WARN
</span></span><span class=line><span class=cl>SeverityNumber: Warn(13)
</span></span><span class=line><span class=cl>Body: Str({&#34;level&#34;:&#34;WARN&#34;,&#34;message&#34;:&#34;Your focus determines your reality.&#34;,&#34;movie&#34;:&#34;SW&#34;,&#34;timestamp&#34;:&#34;2025-03-07 11:17:26&#34;})
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>     -&gt; level: Str(WARN)
</span></span><span class=line><span class=cl>     -&gt; message: Str(Your focus determines your reality.)
</span></span><span class=line><span class=cl>     -&gt; movie: Str(SW)
</span></span><span class=line><span class=cl>     -&gt; timestamp: Str(2025-03-07 11:17:26)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str({&#34;level&#34;:&#34;WARN&#34;,&#34;message&#34;:&#34;Your focus determines your reality.&#34;,&#34;movie&#34;:&#34;SW&#34;,&#34;timestamp&#34;:&#34;2025-03-07 11:17:26&#34;})
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div></div></div></div></div><p><strong>Check file output</strong>: In the new <code>gateway-logs.out</code> file verify the data has been transformed:</p><div class=tab-panel data-tab-group=c09e6d59d618ff73f89129e15618e55a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=jq-query class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c09e6d59d618ff73f89129e15618e55a","jq-query")'>
<span class=tab-nav-text>jq Query</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c09e6d59d618ff73f89129e15618e55a","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=jq-query class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq <span class=s1>&#39;[.resourceLogs[].scopeLogs[].logRecords[] | {severityText, severityNumber, body: .body.stringValue}]&#39;</span> gateway-logs.out</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;DEBUG\&#34;,\&#34;message\&#34;:\&#34;All we have to decide is what to do with the time that is given us.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;WARN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>13</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;WARN\&#34;,\&#34;message\&#34;:\&#34;The Force will be with you. Always.\&#34;,\&#34;movie\&#34;:\&#34;SW\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>17</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;ERROR\&#34;,\&#34;message\&#34;:\&#34;One does not simply walk into Mordor.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;DEBUG\&#34;,\&#34;message\&#34;:\&#34;Do or do not, there is no try.\&#34;,\&#34;movie\&#34;:\&#34;SW\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;severityNumber&#34;</span><span class=p>:</span> <span class=mi>17</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=s2>&#34;{\&#34;level\&#34;:\&#34;ERROR\&#34;,\&#34;message\&#34;:\&#34;There is some good in this world, and it&#39;s worth fighting for.\&#34;,\&#34;movie\&#34;:\&#34;LOTR\&#34;,\&#34;timestamp\&#34;:\&#34;2025-03-07 11:56:29\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span></span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=8-routing-data>8. Routing Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/routingconnector rel=external target=_blank><strong>Routing Connector</strong></a> in OpenTelemetry is a powerful feature that allows you to direct data (<code>traces</code>, <code>metrics</code>, or <code>logs</code>) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.</p><p>For example, you might want to send <em>production</em> data to one exporter while directing <em>test</em> or <em>development</em> data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>8-routing-data</code>.</li><li>Next, copy <code>*.yaml</code> from the <code>7-transform-data</code> directory into <code>8-routing-data</code>.</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/8-routing-data</code> directory.</li></ul><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=fd7ff3111a29ff2797a1404ca6fbaad0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("fd7ff3111a29ff2797a1404ca6fbaad0","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ 8-routing
</span></span><span class=line><span class=cl>    â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>    â””â”€â”€ gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>Next, we will configure the routing connector and the respective pipelines.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 3, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 8. Routing Data</h1><article class=default><header class=headline></header><h1 id=81-configure-the-routing-connector>8.1 Configure the Routing Connector</h1><p>In this exercise, you will configure the <strong>Routing Connector</strong> in the <code>gateway.yaml</code> file. This setup enables the <code>gateway</code> to route traces based on the <code>deployment.environment</code> attribute in the spans you send. By implementing this, you can process and handle traces differently depending on their attributes.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In OpenTelemetry configuration files, <code>connectors</code> have their own dedicated section, similar to receivers and processors.</p><p><strong>Add the <code>routing</code> connector</strong>:
In the <strong>Gateway terminal</strong> window edit <code>gateway.yaml</code> and add the following below the <code>receivers:</code> section and above the <code>processors:</code> section:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>connectors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default_pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/standard]</span><span class=w> </span><span class=c># Default pipeline if no rule matches</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                  </span><span class=w> </span><span class=c># Ignore errors in routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w>                               </span><span class=c># Define routing rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Routes spans to a target pipeline if the resourceSpan attribute matches the rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>statement</span><span class=p>:</span><span class=w> </span><span class=l>route() where attributes[&#34;deployment.environment&#34;] == &#34;security_applications&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/security]    </span><span class=w> </span><span class=c># Target pipeline </span></span></span></code></pre></div><p>The rules above apply to traces, but this approach also applies to <code>metrics</code> and <code>logs</code>, allowing them to be routed based on attributes in <code>resourceMetrics</code> or <code>resourceLogs</code>.</p><p><strong>Configure <code>file:</code> exporters</strong>: The <code>routing</code> connector requires separate targets for routing. Add two file exporters, <code>file/traces/security</code> and <code>file/traces/standard</code>, to ensure data is directed correctly.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/standard</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter for regular traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-standard.out&#34;</span><span class=w>  </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                          </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/security</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter for security traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-security.out&#34;</span><span class=w>  </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                          </span><span class=c># Overwrite the file each time </span></span></span></code></pre></div></div></details><p>With the <code>routing</code> configuration complete, the next step is to configure the <code>pipelines</code> to apply these routing rules.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 4, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=82-configuring-the-pipelines>8.2 Configuring the Pipelines</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add both the <code>standard</code> and <code>security</code> traces pipelines</strong>:</p><ol><li><p><strong>Add the Standard pipeline</strong>: This pipeline processes all spans that do not match the routing rule.<br>This pipeline is using <code>routing</code> as its receiver. Place it below the existing <code>traces:</code> pipeline, keeping its configuration unchanged for now:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/standard</span><span class=p>:</span><span class=w>              </span><span class=c># Default pipeline for unmatched spans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                  </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/standard     </span><span class=w> </span><span class=c># File exporter for unmatched spans</span></span></span></code></pre></div></li><li><p><strong>Configure the Security pipeline</strong>: This pipeline will handle all spans that match the routing rule.<br>This also uses <code>routing</code> as its receiver. Add this below the Standard one:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/security</span><span class=p>:</span><span class=w>              </span><span class=c># New Security Traces/Spans Pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                  </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/security     </span><span class=w> </span><span class=c># File Exporter for spans matching rule</span></span></span></code></pre></div></li></ol><p><strong>Update the <code>traces</code> pipeline to use routing</strong>:</p><ol><li><p>To enable <code>routing</code>, update the original <code>traces:</code> pipeline by using <code>routing</code> as the only exporter.<br>This ensures all span data is sent through the routing connector for evaluation.</p></li><li><p>Remove all processors and replace it with an empty array (<code>[]</code>). These are now defined in the <code>traces/standard</code> and <code>traces/security</code> pipelines.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                           </span><span class=c># Original traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                         </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                      </span><span class=w> </span><span class=c># Routing Connector</span></span></span></code></pre></div></li></ol></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      PRO6(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
      EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP4(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
      ROUTE1(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-export
      ROUTE2(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
      ROUTE3(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
    %% Links
    subID1:::sub-traces
    subID2:::sub-traces
    subID3:::sub-traces
    subgraph &#34; &#34;
    direction LR
      subgraph subID1[**Traces**]
      REC1 --&gt; ROUTE1
      end
      subgraph subID2[**Traces/standard**]
      ROUTE1 --&gt; ROUTE2
      ROUTE2 --&gt; PRO1
      PRO1 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
      subgraph subID3[**Traces/security**]
      ROUTE1 --&gt; ROUTE3
      ROUTE3 --&gt; PRO2
      PRO2 --&gt; PRO4
      PRO4 --&gt; PRO6
      PRO6 --&gt; EXP3
      PRO6 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 4, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=83-test-routing-connector>8.3 Test Routing Connector</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In this section, we will test the <code>routing</code> rule configured for the <strong>Gateway</strong>. The expected result is that the<code>span</code> from the <code>security.json</code> file will be sent to the <code>gateway-traces-security.out</code> file.</p><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <code>gateway</code>.</p><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <code>agent</code>.</p><p><strong>Send a Regular Span</strong>: In the <strong>Spans terminal</strong> window send a regular span using the <code>loadgen</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p>Both the <code>agent</code> and <code>gateway</code> will display debug information. The gateway will also generate a new <code>gateway-traces-standard.out</code> file, as this is now the designated destination for regular spans.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you check <code>gateway-traces-standard.out</code>, it will contain the <code>span</code> sent by <code>loadgen</code>. You will also see an empty <code>gateway-traces-security.out</code> file, as the routing configuration creates output files immediately, even if no matching spans have been processed yet.</p></div></details><p><strong>Send a Security Span</strong>: In the <strong>Spans terminal</strong> window send a security span using the <code>security</code> flag:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -security -count <span class=m>1</span></span></span></code></pre></div><p>Again, both the <code>agent</code> and <code>gateway</code> should display debug information, including the span you just sent. This time, the <code>gateway</code> will write a line to the <code>gateway-traces-security.out</code> file, which is designated for spans where the <code>deployment.environment</code> resource attribute matches <code>"security_applications"</code>.
The <code>gateway-traces-standard.out</code> should be unchanged.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you verify the <code>./gateway-traces-security.out</code> it should only contain the spans from the <code>"security_applications"</code> deployment.environment.</p></div></details><p>You can repeat this scenario multiple times, and each trace will be written to its corresponding output file.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=84-conclusion>8.4 Conclusion</h1><h2 id=conclusion>Conclusion</h2><p>In this section, we successfully tested the routing connector in the gateway by sending different spans and verifying their destinations.</p><ul><li><p><strong>Regular spans</strong> were correctly routed to <code>gateway-traces-standard.out</code>, confirming that spans without a matching <code>deployment.environment</code> attribute follow the default pipeline.</p></li><li><p><strong>Security-related spans</strong> were routed to <code>gateway-traces-security.out</code>, demonstrating that the routing rule based on <code>"deployment.environment": "security_applications"</code> works as expected.</p></li></ul><p>By inspecting the output files, we confirmed that the OpenTelemetry Collector <em>correctly evaluates span attributes and routes them to the appropriate destinations</em>. This validates that routing rules can effectively separate and direct telemetry data for different use cases.</p><p>You can now extend this approach by defining additional routing rules to further categorize spans, metrics, and logs based on different attributes.</p><p>Stop the <code>agent</code> and <code>gateway</code> in their respective terminals using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=wrap-up>Wrap-up</h1><p><a href=#R-image-ab522bdde924d7a983a84497fc680e06 class=lightbox-link><img alt="Well done" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../images/welldone.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ab522bdde924d7a983a84497fc680e06><img alt="Well done" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../images/welldone.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 6, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.84/js/clipboard.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/perfect-scrollbar.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-color.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-dispatch.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-drag.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-ease.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-interpolate.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-selection.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-timer.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-transition.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/d3/d3-zoom.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/js-yaml.min.js?1741692583 defer></script><script src=/observability-workshop/v5.84/js/mermaid.min.js?1741692583 defer></script><script>window.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/v5.84/js/theme.js?1741692583 defer></script></body></html>