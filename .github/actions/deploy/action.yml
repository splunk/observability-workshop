name: 'Deploy'
description: 'Build and deploy workshop'

inputs:
  flavour:
    description: type of version to release
    required: true
    default: 'minor'

runs:
  using: "composite"
  steps:
    - name: Bumpversion and commit
      id: bumpversion
      shell: bash
      run: ./.github/ci/do_release -t ${{ inputs.flavour }}

    - name: Build Site
      shell: bash
      run: ./.github/ci/build_site -b ${{ steps.bumpversion.outputs.base_url }} -t ${{ steps.bumpversion.outputs.tag_name }}

    - name: Deploy
      uses: peaceiris/actions-gh-pages@v3
      if: github.ref == 'refs/heads/master' && inputs.flavour == 'minor'
      with:
        github_token: ${{ github.token }}
        publish_dir: './site/v${{ steps.bumpversion.outputs.tag_name }}'
        destination_dir: 'v${{ steps.bumpversion.outputs.tag_name }}'
        commit_message: 'Docs: Releasing ${{ steps.bumpversion.outputs.tag_name }}'
