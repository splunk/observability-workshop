<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 8.0.0+97777ec5111409397e83f44eca496eea97697836"><meta name=description content="The Routing Connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines/destinations based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="6. Routing Data :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="The Routing Connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines/destinations based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v6.9/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/6-routing-data/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="6. Routing Data :: Splunk Observability Cloud Workshops"><meta property="og:description" content="The Routing Connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines/destinations based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="6. Routing Data :: Splunk Observability Cloud Workshops"><meta itemprop=description content="The Routing Connector in OpenTelemetry is a powerful feature that allows you to direct data (traces, metrics, or logs) to different pipelines/destinations based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.
For example, you might want to send production data to one exporter while directing test or development data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic."><meta itemprop=dateModified content="2025-09-19T17:43:15+01:00"><meta itemprop=wordCount content="145"><title>6. Routing Data :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v6.9/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/6-routing-data/index.html rel=canonical type=text/html title="6. Routing Data :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v6.9/images/favicon.ico?1760432859 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v6.9/css/auto-complete/auto-complete.min.css?1760432859 rel=stylesheet><script src=/observability-workshop/v6.9/js/auto-complete/auto-complete.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/search-lunr.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/search.min.js?1760432859 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/v6.9/searchindex.en.js?1760432859"</script><script src=/observability-workshop/v6.9/js/lunr/lunr.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/lunr/lunr.stemmer.support.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/lunr/lunr.multi.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/lunr/lunr.en.min.js?1760432859 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/observability-workshop/v6.9/fonts/fontawesome/css/fontawesome-all.min.css?1760432859 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v6.9/fonts/fontawesome/css/fontawesome-all.min.css?1760432859 rel=stylesheet></noscript><link href=/observability-workshop/v6.9/css/perfect-scrollbar/perfect-scrollbar.min.css?1760432859 rel=stylesheet><link href=/observability-workshop/v6.9/css/theme.min.css?1760432859 rel=stylesheet><link href=/observability-workshop/v6.9/css/format-print.min.css?1760432859 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/6-routing-data/index.html",window.relearn.relBasePath="../../../../..",window.relearn.relBaseUri="../../../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v6.9",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({appplicationName:"observability-workshop",realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",recorder:"splunk",features:{video:!0}})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-url=/observability-workshop/v6.9/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/6-routing-data/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.9/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.9/en/ninja-workshops/index.html><span itemprop=name>Splunk4Ninjas Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.9/en/ninja-workshops/3-opentelemetry-collector-workshops/index.html><span itemprop=name>OpenTelemetry Collector Workshops</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v6.9/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/index.html><span itemprop=name>Advanced OpenTelemetry Collector</span></a><meta itemprop=position content="4">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>6. Routing Data</span><meta itemprop=position content="5"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.9/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/6-routing-data/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.9/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/5-transform-data/5-3-test-transform/index.html title="5.3 Test Transform Processor (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v6.9/en/ninja-workshops/3-opentelemetry-collector-workshops/2-advanced-collector/6-routing-data/6-1-connector/index.html title="6.1 Configure the Routing Connector (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=6-routing-data>6. Routing Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/routingconnector rel=external target=_blank><strong>Routing Connector</strong></a> in OpenTelemetry is a powerful feature that allows you to direct data (<code>traces</code>, <code>metrics</code>, or <code>logs</code>) to different pipelines/destinations based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.</p><p>For example, you might want to send <em>production</em> data to one exporter while directing <em>test</em> or <em>development</em> data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic.</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p><strong>Change <em>ALL</em> terminal windows to the <code>6-routing-data</code> directory and run the <code>clear</code> command.</strong></p></div></details><p>Copy <code>*.yaml</code> from the <code>5-transform-data</code> directory into <code>6-routing-data</code>. Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=R-tabs-a0147b4ce7d4273d7c925a77dca5226b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a0147b4ce7d4273d7c925a77dca5226b","R-tab-5a476a4994a778a4fb1b2011e6c9054c")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-5a476a4994a778a4fb1b2011e6c9054c class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── agent.yaml
</span></span><span class=line><span class=cl>└── gateway.yaml</span></span></code></pre></div></div></div></div></div></div></details><p>Next, we will configure the routing connector and the respective pipelines.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 6. Routing Data</h1><article class=default><header class=headline></header><h1 id=61-configure-the-routing-connector>6.1 Configure the Routing Connector</h1><p>In this exercise, you will configure the <strong>Routing Connector</strong> in the <code>gateway.yaml</code>. The Routing Connector can route metrics, traces, and logs based on any attributes, we will focus exclusively on trace routing based on the <code>deployment.environment</code> attribute (though any span/log/metirc attribute can be used).</p><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add new <code>file</code> exporters</strong>: The <code>routing</code> connector requires different targets for routing. In the <strong>Gateway terminal</strong> create two new file exporters, <code>file/traces/route1-regular</code> and <code>file/traces/route2-security</code>, to ensure data is directed correctly in the <code>exporters</code> section of the <code>gateway.yaml</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/route1-regular</span><span class=p>:</span><span class=w>                     </span><span class=c># Exporter for regular traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-route1-regular.out&#34;</span><span class=w>   </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                                 </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/route2-security</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter for security traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-route2-security.out&#34;</span><span class=w>  </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                                 </span><span class=c># Overwrite the file each time </span></span></span></code></pre></div><p><strong>Enable Routing</strong> by adding the <code>routing</code> connector. In OpenTelemetry configuration files, <code>connectors</code> have their own dedicated section, similar to receivers and processors.</p><p>Find and uncomment the <code>#connectors:</code> section. Then, add the following below the <code>connectors:</code> section:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>routing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default_pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/route1-regular] </span><span class=w> </span><span class=c># Default pipeline if no rule matches</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                         </span><span class=w> </span><span class=c># Ignore errors in routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w>                                      </span><span class=c># Define routing rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Routes spans to a target pipeline if the resourceSpan attribute matches the rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>statement</span><span class=p>:</span><span class=w> </span><span class=l>route() where attributes[&#34;deployment.environment&#34;] == &#34;security-applications&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/route2-security]    </span><span class=w> </span><span class=c># Security target pipeline </span></span></span></code></pre></div></div></details><p>The default pipeline in the configuration file works at a Catch all. It will be the routing target for any data (spans in our case) that do not match a rule in the routing rules table, In this table you find the pipeline that is the target for any span that matches the following rule: <code>["deployment.environment"] == "security-applications"</code></p><p>With the <code>routing</code> configuration complete, the next step is to configure the <code>pipelines</code> to apply these routing rules.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=62-configuring-the-pipelines>6.2 Configuring the Pipelines</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Update the original <code>traces</code> pipeline to use routing</strong>:</p><ol><li><p>To enable <code>routing</code>, update the original <code>traces</code> pipeline to use <code>routing</code> as the only exporter. This ensures all span data is sent through the <strong>Routing Connector</strong> for evaluation and then onwards to connected pipelines. Also, remove <strong>all</strong> processors and replace it with an empty array (<code>[]</code>) as this will now behandeld in the <code>traces/route1-regular</code> and <code>traces/route2-security</code> pipelines, allowing for custom behaviour for each route. Your <code>traces:</code> configuration should look like this:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>traces</span><span class=p>:</span><span class=w>                       </span><span class=c># Traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>              </span><span class=c># Processors for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>routing</span></span></span></code></pre></div></li></ol><p><strong>Add both the <code>route1-regular</code> and <code>route2-security</code> traces pipelines</strong> below the existing <code>traces</code> pipeline:</p><ol><li><p><strong>Configure Route1-regular pipeline</strong>: This pipeline will handle all spans that have <strong>no match</strong> in the routing table in the connector.
Notice this uses <code>routing</code> as its only receiver and will recieve data thought its <code>connection</code> from the original traces pipeline.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/route1-regular</span><span class=p>:</span><span class=w>         </span><span class=c># Default pipeline for unmatched spans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                   </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter            </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode         </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                     </span><span class=w> </span><span class=c># Debug Exporter </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/route1-regular</span><span class=w> </span><span class=c># File Exporter for unmatched spans </span></span></span></code></pre></div></li><li><p><strong>Add the route2-security pipeline</strong>: This pipeline processes all spans that do match our rule <code>"[deployment.environment"] == "security-applications"</code> in the the routing rule. This pipeline is also using <code>routing</code> as its receiver. Add this pipline below the <code>traces/route1-regular</code> one.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/route2-security</span><span class=p>:</span><span class=w>         </span><span class=c># Default pipeline for unmatched spans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                    </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter             </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode          </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                      </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/route2-security</span><span class=w> </span><span class=c># File exporter for unmatched spans</span></span></span></code></pre></div></li></ol></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      PRO6(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
      EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP4(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
      ROUTE1(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-export
      ROUTE2(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
      ROUTE3(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
    %% Links
    subID1:::sub-traces
    subID2:::sub-traces
    subID3:::sub-traces
    subgraph &#34; &#34;
    direction LR
      subgraph subID1[**Traces**]
      REC1 --&gt; ROUTE1
      end
      subgraph subID2[**Traces/route2-security**]
      ROUTE1 --&gt; ROUTE2
      ROUTE2 --&gt; PRO1
      PRO1 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
      subgraph subID3[**Traces/route1-regular**]
      ROUTE1 --&gt; ROUTE3
      ROUTE3 --&gt; PRO2
      PRO2 --&gt; PRO4
      PRO4 --&gt; PRO6
      PRO6 --&gt; EXP3
      PRO6 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=63-test-routing-connector>6.3 Test Routing Connector</h1><details open class="box cstyle notices green"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In this section, we will test the <code>routing</code> rule configured for the <strong>Gateway</strong>. The expected result is that a <code>span</code> generated by the <code>loadgen</code> that match the <code>"[deployment.environment"] == "security-applications"</code> rule will be sent to the <code>gateway-traces-route2-security.out</code> file.</p><p><strong>Start the Gateway</strong>: In your <strong>Gateway terminal</strong> window start the <strong>Gateway</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config gateway.yaml</span></span></code></pre></div><p><strong>Start the Agent</strong>: In your <strong>Agent terminal</strong> window start the <strong>Agent</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config agent.yaml</span></span></code></pre></div><p><strong>Send a Regular Span</strong>: In the <strong>Loadgen terminal</strong> window send a regular span using the <code>loadgen</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -count <span class=m>1</span></span></span></code></pre></div><p>Both the <strong>Agent</strong> and <strong>Gateway</strong> will display debug information. The gateway will also generate a new <code>gateway-traces-route1-regular.out</code> file, as this is now the designated destination for regular spans.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you check <code>gateway-traces-route1-regular.out</code>, it will contain the <code>span</code> sent by <code>loadgen</code>. You will also see an empty <code>gateway-traces-route2-security..out</code> file, as the routing configuration creates output files immediately, even if no matching spans have been processed yet.</p></div></details><p><strong>Send a Security Span</strong>: In the <strong>Loadgen terminal</strong> window send a security span using the <code>security</code> flag:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../loadgen -security -count <span class=m>1</span></span></span></code></pre></div><p>Again, both the <strong>Agent</strong> and <strong>Gateway</strong> should display debug information, including the span you just sent. This time, the <strong>Gateway</strong> will write a line to the <code>gateway-traces-route2-security.out</code> file, which is designated for spans where the <code>deployment.environment</code> resource attribute matches <code>"security-applications"</code>.</p><div class=tab-panel data-tab-group=R-tabs-e104fb5db11d4051d14f60ace8cc6589><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=R-tab-ad0c2b09920ec6396d478d255cb39b4d class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-e104fb5db11d4051d14f60ace8cc6589","R-tab-ad0c2b09920ec6396d478d255cb39b4d")'>
<span class=tab-nav-text>Validate resource attribute matches</span>
</button>
<button data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-e104fb5db11d4051d14f60ace8cc6589","R-tab-29c2c02a361c9d7028472e5d92cd4a54")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=R-tab-ad0c2b09920ec6396d478d255cb39b4d class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jq -c <span class=s1>&#39;.resourceSpans[] as $resource | $resource.scopeSpans[].spans[] | {spanId: .spanId, deploymentEnvironment: ($resource.resource.attributes[] | select(.key == &#34;deployment.environment&#34;) | .value.stringValue)}&#39;</span> gateway-traces-route2-security.out</span></span></code></pre></div></div></div><div data-tab-item=R-tab-29c2c02a361c9d7028472e5d92cd4a54 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;cb799e92e26d5782&#34;</span><span class=p>,</span><span class=nt>&#34;deploymentEnvironment&#34;</span><span class=p>:</span><span class=s2>&#34;security-applications&#34;</span><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>You can repeat this scenario multiple times, and each trace will be written to its corresponding output file.</p></div></details><details open class="box cstyle notices important"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-bolt"></i>
Important</summary><div class=box-content><p>Stop the <strong>Agent</strong> and the <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p></div></details><h2 id=conclusion>Conclusion</h2><p>In this section, we successfully tested the routing connector in the gateway by sending different spans and verifying their destinations.</p><ul><li><p><strong>Regular spans</strong> were correctly routed to <code>gateway-traces-route1-regular.out</code>, confirming that spans without a matching <code>deployment.environment</code> attribute follow the default pipeline.</p></li><li><p><strong>Security-related spans</strong> were routed to <code>gateway-traces-route2-security.out</code>, demonstrating that the routing rule based on <code>"deployment.environment": "security-applications"</code> works as expected.</p></li></ul><p>By inspecting the output files, we confirmed that the OpenTelemetry Collector <em>correctly evaluates span attributes and routes them to the appropriate destinations</em>. This validates that routing rules can effectively separate and direct telemetry data for different use cases.</p><p>You can now extend this approach by defining additional routing rules to further categorize spans, metrics, and logs based on different attributes.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v6.9/js/js-yaml/js-yaml.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-color.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-dispatch.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-drag.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-ease.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-interpolate.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-selection.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-timer.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-transition.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/d3/d3-zoom.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/mermaid/mermaid.min.js?1760432859 defer></script><script>window.relearn.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/v6.9/js/clipboard/clipboard.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/perfect-scrollbar/perfect-scrollbar.min.js?1760432859 defer></script><script src=/observability-workshop/v6.9/js/theme.min.js?1760432859 defer></script></body></html>