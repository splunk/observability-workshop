<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.145.0"><meta name=generator content="Relearn 7.6.1+81b6d3c32c77aeecc29c4700d2123bd2fb3401c2"><meta name=description content="Automatic Discovery Workshops"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Automatic Discovery Workshops :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Automatic Discovery Workshops"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Automatic Discovery Workshops :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Automatic Discovery Workshops"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Automatic Discovery Workshops :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Automatic Discovery Workshops"><meta itemprop=dateModified content="2024-09-19T16:47:03+01:00"><meta itemprop=wordCount content="40"><title>Automatic Discovery Workshops :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/index.html rel=canonical type=text/html title="Automatic Discovery Workshops :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.99/images/favicon.ico?1752058459 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.99/css/auto-complete/auto-complete.min.css?1752058459 rel=stylesheet><script src=/observability-workshop/v5.99/js/auto-complete/auto-complete.min.js?1752058459 defer></script><script src=/observability-workshop/v5.99/js/search-lunr.min.js?1752058459 defer></script><script src=/observability-workshop/v5.99/js/search.min.js?1752058459 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/observability-workshop/v5.99/searchindex.en.js?1752058459"</script><script src=/observability-workshop/v5.99/js/lunr/lunr.min.js?1752058459 defer></script><script src=/observability-workshop/v5.99/js/lunr/lunr.stemmer.support.min.js?1752058459 defer></script><script src=/observability-workshop/v5.99/js/lunr/lunr.multi.min.js?1752058459 defer></script><script src=/observability-workshop/v5.99/js/lunr/lunr.en.min.js?1752058459 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/observability-workshop/v5.99/fonts/fontawesome/css/fontawesome-all.min.css?1752058459 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.99/fonts/fontawesome/css/fontawesome-all.min.css?1752058459 rel=stylesheet></noscript><link href=/observability-workshop/v5.99/css/perfect-scrollbar/perfect-scrollbar.min.css?1752058459 rel=stylesheet><link href=/observability-workshop/v5.99/css/theme.min.css?1752058459 rel=stylesheet><link href=/observability-workshop/v5.99/css/format-print.min.css?1752058459 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/ninja-workshops/1-automatic-discovery/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.99",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"h7q1NLX6lJz0h_5-OqQJkg"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}p{margin:.75rem 0}.highlight{max-height:500px;overflow-y:auto}pre:not(.mermaid){margin:0}</style></head><body class="mobile-support print" data-url=/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.99/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.99/en/ninja-workshops/index.html><span itemprop=name>Splunk4Ninjas Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Automatic Discovery Workshops</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.99/en/ninja-workshops/index.html title="Splunk4Ninjas Workshops (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html title="PetClinic Monolith Workshop (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=automatic-discovery-workshops>Automatic Discovery Workshops</h1><ul class="children children-li children-sort-"><li class=children-title><a href=/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/index.html>PetClinic Monolith Workshop</a><p>A workshop using automatic discovery and configuration for Java.</p></li><li class=children-title><a href=/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/index.html>PetClinic Kubernetes Workshop</a><p>Learn how to enable automatic discovery and configuration for your Java-based application running in Kubernetes. Experience real-time monitoring to help you maximize application behavior with end-to-end visibility.</p></li></ul><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of Automatic Discovery Workshops</h1><article class=default><header class=headline></header><h1 id=petclinic-monolith-workshop>PetClinic Monolith Workshop</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>30 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Robert Castley</span></span><p>The goal is to walk through the basic steps to configure the following components of the <strong>Splunk Observability Cloud</strong> platform:</p><ul><li>Splunk Infrastructure Monitoring (IM)</li><li>Splunk Automatic Discovery for Java (APM)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Real User Monitoring (RUM)</li><li>RUM to APM Correlation</li><li>Splunk Log Observer (LO)</li></ul><p>We will also show the steps about how to clone (download) a sample Java application (Spring PetClinic), as well as how to compile, package and run the application.</p><p>Once the application is up and running, we will instantly start seeing metrics, traces and logs via the <strong>automatic discovery and configuration</strong> for Java 2.x that will be used by the <strong>Splunk APM</strong> product.</p><p>After that, we will instrument PetClinic&rsquo;s end user interface (HTML pages rendered by the application) with the <strong>Splunk OpenTelemetry Javascript Libraries (RUM)</strong> that will generate RUM traces around all the individual clicks and page loads executed by an end user.</p><p>Lastly, we will view the logs generated by the automatic injection of trace metadata into the PetClinic application logs.</p><details open class="box cstyle notices primary"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info"></i>
Prerequisites</summary><div class=box-content><ul><li>Outbound SSH access to port <code>2222</code>.</li><li>Outbound HTTP access to port <code>8083</code>.</li><li>Familiarity with the <code>bash</code> shell and <code>vi/vim</code> editor.</li></ul></div></details><p><a href=#R-image-ad5aa9f01f27c875349543d82672573f class=lightbox-link><img alt="PetClinic Exercise" class="lazy lightbox figure-image" loading=lazy src=/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/images/petclinic-exercise.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ad5aa9f01f27c875349543d82672573f><img alt="PetClinic Exercise" class="lazy lightbox lightbox-image" loading=lazy src=/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/1-petclinic-monolith/images/petclinic-exercise.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><section><h1 class=a11y-only>Subsections of PetClinic Monolith Workshop</h1><article class=default><header class=headline></header><h1 id=installing-the-opentelemetry-collector>Installing the OpenTelemetry Collector</h1><p>The Splunk OpenTelemetry Collector is the core component of instrumenting infrastructure and applications. Its role is to collect and send:</p><ul><li>Infrastructure metrics (disk, CPU, memory, etc.)</li><li>Application Performance Monitoring (APM) traces</li><li>Profiling data</li><li>Host and application logs</li></ul><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
Remove any existing OpenTelemetry Collectors</summary><div class=box-content><p>If you have completed the Splunk IM workshop, please ensure you have deleted the collector running in Kubernetes before continuing. This can be done by running the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div><p>The EC2 instance may already have an older version of the collector already installed. To uninstall the collector, run the following commands:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh
</span></span><span class=line><span class=cl>sudo sh /tmp/splunk-otel-collector.sh --uninstall</span></span></code></pre></div></div></details><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal run the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/check_env.sh</span></span></code></pre></div><p>In the output check that all the following environment variables are present and have values set. If any are missing, please contact your instructor:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ACCESS_TOKEN
</span></span><span class=line><span class=cl>REALM
</span></span><span class=line><span class=cl>RUM_TOKEN
</span></span><span class=line><span class=cl>HEC_TOKEN
</span></span><span class=line><span class=cl>HEC_URL
</span></span><span class=line><span class=cl>INSTANCE</span></span></code></pre></div><p>We can then go ahead and install the Collector. Some additional parameters are passed to the installation script, they are:</p><ul><li><code>--with-instrumentation</code> - This will install the agent from the Splunk distribution of OpenTelemetry Java, which is then loaded automatically when the PetClinic Java application starts up. No configuration is required!</li><li><code>--deployment-environment</code> - Sets the resource attribute <code>deployment.environment</code> to the value passed. This is used to filter views in the UI.</li><li><code>--enable-profiler</code> - Enables the profiler for the Java application. This will generate CPU profiles for the application.</li><li><code>--enable-profiler-memory</code> - Enables the profiler for the Java application. This will generate memory profiles for the application.</li><li><code>--enable-metrics</code> - Enables the exporting of Micrometer metrics</li><li><code>--hec-token</code> - Sets the HEC token for the collector to use</li><li><code>--hec-url</code> - Sets the HEC URL for the collector to use</li></ul><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSL https://dl.signalfx.com/splunk-otel-collector.sh &gt; /tmp/splunk-otel-collector.sh <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo sh /tmp/splunk-otel-collector.sh --realm <span class=nv>$REALM</span> -- <span class=nv>$ACCESS_TOKEN</span> --mode agent --without-fluentd --with-instrumentation --deployment-environment <span class=nv>$INSTANCE</span>-petclinic --enable-profiler --enable-profiler-memory --enable-metrics --hec-token <span class=nv>$HEC_TOKEN</span> --hec-url <span class=nv>$HEC_URL</span></span></span></code></pre></div><p>Next, we will patch the collector to expose the hostname of the instance and not the AWS instance ID. This will make it easier to filter data in the UI:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sed -i <span class=s1>&#39;s/gcp, ecs, ec2, azure, system/system, gcp, ecs, ec2, azure/g&#39;</span> /etc/otel/collector/agent_config.yaml</span></span></code></pre></div><p>Once the <code>agent_config.yaml</code> has been patched, you will need to restart the collector:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart splunk-otel-collector</span></span></code></pre></div><p>Once the installation is completed, you can navigate to the <strong>Hosts with agent installed</strong> dashboard to see the data from your host, <strong>Dashboards ‚Üí Hosts with agent installed</strong>.</p><p>Use the dashboard filter and select <code>host.name</code> and type or select the hostname of your workshop instance (you can get this from the command prompt in your terminal session). Once you see data flowing for your host, we are then ready to get started with the APM component.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 3, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=building-the-spring-petclinic-application>Building the Spring PetClinic Application</h1><p>The first thing we need to set up APM is&mldr; well, an application. For this exercise, we will use the Spring PetClinic application. This is a very popular sample Java application built with the Spring framework (Springboot).</p><p>First, clone the PetClinic GitHub repository, and then we will compile, build, package and test the application:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/spring-projects/spring-petclinic</span></span></code></pre></div><p>Change into the <code>spring-petclinic</code> directory:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> spring-petclinic</span></span></code></pre></div><p>Using Docker, start a MySQL database for PetClinic to use:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -e <span class=nv>MYSQL_USER</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>petclinic -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>root -e <span class=nv>MYSQL_DATABASE</span><span class=o>=</span>petclinic -p 3306:3306 docker.io/biarms/mysql:5.7</span></span></code></pre></div><p>Next, we will start another container running Locust that will generate some simple traffic to the PetClinic application. Locust is a simple load-testing tool that can be used to generate traffic to a web application.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --network<span class=o>=</span><span class=s2>&#34;host&#34;</span> -d -p 8090:8090 -v ~/workshop/petclinic:/mnt/locust docker.io/locustio/locust -f /mnt/locust/locustfile.py --headless -u <span class=m>1</span> -r <span class=m>1</span> -H http://127.0.0.1:8083</span></span></code></pre></div><p>Next, compile, build and package PetClinic using <code>maven</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>This will take a few minutes the first time you run and will download a lot of dependencies before it compiles the application. Future builds will be a lot quicker.</p></div></details><p>Once the build completes, you need to obtain the public IP address of the instance you are running on. You can do this by running the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://ifconfig.me</span></span></code></pre></div><p>You will see an IP address returned, make a note of this as we will need it to validate that the application is running.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=automatic-discovery-and-configuration-for-java>Automatic discovery and configuration for Java</h1><p>You can now start the application with the following command. Notice that we are passing the <code>mysql</code> profile to the application, this will tell the application to use the MySQL database we started earlier. We are also setting the <code>otel.service.name</code> and <code>otel.resource.attributes</code> to a logical names using the instance name. These will also be used in the UI for filtering:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>You can validate the application is running by visiting <code>http://&lt;IP_ADDRESS>:8083</code> (replace <code>&lt;IP_ADDRESS></code> with the IP address you obtained earlier).</p><p>When we installed the collector we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that the collector will automatically generate CPU and Memory profiles for the application and send them to Splunk Observability Cloud.</p><p>When you start the PetClinic application you will see the collector automatically detect the application and instrument it for traces and profiling.</p><div class=tab-panel data-tab-group=f9b2da1d08975d3f501ab42c7c0c34f5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f9b2da1d08975d3f501ab42c7c0c34f5","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/lib/splunk-instrumentation/splunk-otel-javaagent.jar
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:58:970 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-2.6.0-otel-2.6.0
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:730 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:731 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : null
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:732 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT10S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-08-20 11:35:59:733 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div><p>You can now visit the Splunk APM UI and examine the application components, traces, profiling, DB Query performance and metrics. From the left-hand menu click <strong>APM</strong> and then click the <strong>Environment</strong> dropdown and select your environment e.g. <code>&lt;INSTANCE>-petclinic</code> (where<code>&lt;INSTANCE></code> is replaced with the value you noted down earlier).</p><p>Once your validation is complete you can stop the application by pressing <code>Ctrl-c</code>.</p><p>Resource attributes can be added to every reported span. For example <code>version=0.314</code>. A comma-separated list of resource attributes can also be defined e.g. <code>key1=val1,key2=val2</code>.</p><p>Let&rsquo;s launch the PetClinic again using new resource attributes. Note, that adding resource attributes to the run command will override what was defined when we installed the collector. Let&rsquo;s add a new resource attribute <code>version=0.314</code>:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Back in the Splunk APM UI we can drill down on a recent trace and see the new <code>version</code> attribute in a span.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Nov 4, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=3-real-user-monitoring>3. Real User Monitoring</h1><p>For the Real User Monitoring (RUM) instrumentation, we will add the Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web rel=external target=_blank><strong>https://github.com/signalfx/splunk-otel-js-web</strong></a> snippet in the pages, we will use the wizard again <strong>Data Management ‚Üí Add Integration ‚Üí RUM Instrumentation ‚Üí Browser Instrumentation</strong>.</p><p>Your instructor will inform you which token to use from the dropdown, click <strong>Next</strong>. Enter <strong>App name</strong> and <strong>Environment</strong> using the following syntax:</p><ul><li><code>&lt;INSTANCE>-petclinic-service</code> - replacing <code>&lt;INSTANCE></code> with the value you noted down earlier.</li><li><code>&lt;INSTANCE>-petclinic-env</code> - replacing <code>&lt;INSTANCE></code> with the value you noted down earlier.</li></ul><p>The wizard will then show a snippet of HTML code that needs to be placed at the top of the pages in the <code>&lt;head></code> section. The following is an example of the (do not use this snippet, use the one generated by the wizard):</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>IMPORTANT: Replace the <span class=p>&lt;</span><span class=nt>version</span><span class=p>&gt;</span> placeholder in the src URL with a
</span></span><span class=line><span class=cl>version from https://github.com/signalfx/splunk-otel-js-web/releases
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*/
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>The Spring PetClinic application uses a single HTML page as the &ldquo;layout&rdquo; page, that is reused across all pages of the application. This is the perfect location to insert the Splunk RUM Instrumentation Library as it will be loaded in all pages automatically.</p><p>Let&rsquo;s then edit the layout page:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi src/main/resources/templates/fragments/layout.html</span></span></code></pre></div><p>Next, insert the snippet we generated above in the <code>&lt;head></code> section of the page. Make sure you don&rsquo;t include the comment and replace <code>&lt;version></code> in the source URL to <code>latest</code> e.g.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!doctype html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>th:fragment</span><span class=o>=</span><span class=s>&#34;layout (template, menu)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>realm</span><span class=o>:</span> <span class=s2>&#34;eu0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=s2>&#34;&lt;redacted&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>applicationName</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-service&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=s2>&#34;petclinic-1be0-petclinic-env&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>...</span></span></code></pre></div><p>With the code changes complete, we need to rebuild the application and run it again. Run the <code>maven</code> command to compile/build/package PetClinic:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span>true</span></span></code></pre></div><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dserver.port<span class=o>=</span><span class=m>8083</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.resource.attributes<span class=o>=</span>deployment.environment<span class=o>=</span><span class=nv>$INSTANCE</span>-petclinic-env,version<span class=o>=</span>0.314 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql</span></span></code></pre></div><p>Then let&rsquo;s visit the application using a browser to generate real-user traffic <code>http://&lt;IP_ADDRESS>:8083</code>.</p><p>In RUM, filter down into the environment as defined in the RUM snippet above and click through to the dashboard.</p><p>When you drill down into a RUM trace you will see a link to APM in the spans. Clicking on the trace ID will take you to the corresponding APM trace for the current RUM trace.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article><article class=default><header class=headline></header><h1 id=4-log-observer>4. Log Observer</h1><p>For the Splunk Log Observer component, the Splunk OpenTelemetry Collector automatically collects logs from the Spring PetClinic application and sends them to Splunk Observability Cloud using the OTLP exporter, anotating the log events with <code>trace_id</code>, <code>span_id</code> and trace flags.</p><p>Log Observer provides a real-time view of logs from your applications and infrastructure. It allows you to search, filter, and analyze logs to troubleshoot issues and monitor your environment.</p><p>Go back to the PetClinic web application and click on the <strong>Error</strong> link several times. This will generate some log messages in the PetClinic application logs.</p><p><a href=#R-image-bab7de0e9953edc110e27750b6f2bb15 class=lightbox-link><img alt="PetClinic Error" class="lazy lightbox figure-image" loading=lazy src=../images/petclinic-error.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bab7de0e9953edc110e27750b6f2bb15><img alt="PetClinic Error" class="lazy lightbox lightbox-image" loading=lazy src=../images/petclinic-error.png></a></p><p>From the left-hand menu click on <strong>Log Observer</strong> and ensure <strong>Index</strong> is set to <strong>splunk4rookies-workshop</strong>.</p><p>Next, click <strong>Add Filter</strong> search for the field <code>service.name</code> select the value <code>&lt;INSTANCE>-petclinic-service</code> and click <code>=</code> (include). You should now see only the log messages from your PetClinic application.</p><p>Select one of the log entries that were generated by clicking on the <strong>Error</strong> link in the PetClinic application. You will see the log message and the trace metadata that was automatically injected into the log message. Also, you will notice that Related Content is available for APM and Infrastructure.</p><p><a href=#R-image-162395d37d67e71a9186937f13009687 class=lightbox-link><img alt="Log Observer" class="lazy lightbox figure-image" loading=lazy src=../images/log-observer.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-162395d37d67e71a9186937f13009687><img alt="Log Observer" class="lazy lightbox lightbox-image" loading=lazy src=../images/log-observer.png></a></p><p>This is the end of the workshop and we have certainly covered a lot of ground. At this point, you should have metrics, traces (APM & RUM), logs, database query performance and code profiling being reported into Splunk Observability Cloud and all without having to modify the PetClinic application code (well except for RUM).</p><p><strong>Congratulations!</strong></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Sep 19, 2024</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=spring-petclinic-springboot-based-microservices-on-kubernetes>Spring PetClinic SpringBoot Based Microservices On Kubernetes</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>90 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Author
</span><span class=badge-content>Pieter Hagen</span></span><p>The goal of this workshop is to introduce the features of Splunk&rsquo;s <strong>automatic discovery and configuration</strong> for Java.</p><p>The workshop scenario will be created by installing a simple (<strong>un-instrumented</strong>) Java microservices application in Kubernetes.</p><p>Following simple steps to install the Splunk OpenTelemetry Collector with automatic discovery for existing Java based deployments, we will see how easy it is to send metrics, traces and logs to <strong>Splunk Observability Cloud</strong>.</p><details open class="box cstyle notices splunk"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-circle-info"></i>
Prerequisites</summary><div class=box-content><ul><li>Outbound SSH access to port <strong>2222</strong>.</li><li>Outbound HTTP access to port <strong>81</strong>.</li><li>Familiarity with the Linux command line.</li></ul></div></details><p>During this workshop we will cover the following components:</p><ul><li>Splunk Infrastructure Monitoring (<strong>IM</strong>)</li><li>Splunk automatic discovery and configuration for Java (<strong>APM</strong>)<ul><li>Database Query Performance</li><li>AlwaysOn Profiling</li></ul></li><li>Splunk Log Observer (<strong>LO</strong>)</li><li>Splunk Real User Monitoring (<strong>RUM</strong>)</li></ul><p><em>Splunk Synthetics is feeling a little left out here, but we cover that in other workshops</em> <i class="fa-fw fas fa-heart"></i></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of PetClinic Kubernetes Workshop</h1><article class=default><header class=headline></header><h1 id=architecture>Architecture</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>5 minutes</span>
</span>&nbsp;<p>The Spring PetClinic Java application is a simple microservices application that consists of frontend and backend services. The frontend service is a Spring Boot application that serves a web interface to interact with backend services. The backend services are Spring Boot applications that serve RESTful API&rsquo;s to interact with a MySQL database.</p><p>By the end of this workshop, you will have a better understanding of how to enable <strong>automatic discovery and configuration</strong> for your Java-based applications running in Kubernetes.</p><p>The diagram below details the architecture of the Spring PetClinic Java application running in Kubernetes with the Splunk OpenTelemetry Operator and automatic discovery and configuration enabled.</p><p><a href=#R-image-a44ba1ddc9c10692bec5e19b5b13175f class=lightbox-link><img alt="Splunk Otel Architecture" class="lazy lightbox figure-image" loading=lazy src=../images/auto-instrumentation-java-diagram.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a44ba1ddc9c10692bec5e19b5b13175f><img alt="Splunk Otel Architecture" class="lazy lightbox lightbox-image" loading=lazy src=../images/auto-instrumentation-java-diagram.png></a></p><hr><p>Based on the <a href=https://github.com/signalfx/splunk-otel-collector-chart/blob/main/examples/enable-operator-and-auto-instrumentation/spring-petclinic-java.md rel=external target=_blank><strong>example</strong></a> <strong>Josh Voravong</strong> created.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=preparation-of-the-workshop-instance>Preparation of the Workshop instance</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>The instructor will provide you with the login information for the instance that we will be using during the workshop.</p><p>When you first log into your instance, you will be greeted by the Splunk Logo as shown below. If you have any issues connecting to your workshop instance, please reach out to your Instructor.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ ssh -p 2222 splunk@&lt;IP-ADDRESS&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó  
</span></span><span class=line><span class=cl>‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù    ‚ïö‚ñà‚ñà‚ïó 
</span></span><span class=line><span class=cl>‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù      ‚ïö‚ñà‚ñà‚ïó
</span></span><span class=line><span class=cl>‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó      ‚ñà‚ñà‚ïî‚ïù
</span></span><span class=line><span class=cl>‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïî‚ïù 
</span></span><span class=line><span class=cl>‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù    ‚ïö‚ïê‚ïù  
</span></span><span class=line><span class=cl>Last login: Mon Feb  5 11:04:54 2024 from [Redacted]
</span></span><span class=line><span class=cl>splunk@show-no-config-i-0d1b29d967cb2e6ff ~ $</span></span></code></pre></div><p>To ensure your instance is configured correctly, we need to confirm that the required environment variables for this workshop are set correctly. In your terminal, run the following script and check that the environment variables are present and set with actual valid values:</p><div class=tab-panel data-tab-group=9593ff172f5285f9a3305a1ec75b7ab8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=script class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9593ff172f5285f9a3305a1ec75b7ab8","script")'>
<span class=tab-nav-text>Script</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("9593ff172f5285f9a3305a1ec75b7ab8","example-output")'>
<span class=tab-nav-text>Example Output</span></button></div><div class=tab-content-container><div data-tab-item=script class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>. ~/workshop/petclinic/scripts/check_env.sh</span></span></code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ACCESS_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>REALM</span> <span class=o>=</span> &lt;e.g. eu0, us1, us2, jp0, au0 etc.&gt;
</span></span><span class=line><span class=cl><span class=nv>RUM_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>HEC_TOKEN</span> <span class=o>=</span> &lt;redacted&gt;
</span></span><span class=line><span class=cl><span class=nv>HEC_URL</span> <span class=o>=</span> https://&lt;...&gt;/services/collector/event
</span></span><span class=line><span class=cl><span class=nv>INSTANCE</span> <span class=o>=</span> &lt;instance_name&gt;</span></span></code></pre></div></div></div></div></div><p>Please make a note of the <code>INSTANCE</code> environment variable value as this will be used later to filter data in <strong>Splunk Observability Cloud</strong>.</p><p>For this workshop, <strong>all</strong> the above environment variables are required. If any have values missing, please contact your Instructor.</p><details open class="box cstyle notices splunk"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-circle-info"></i>
Delete any existing OpenTelemetry Collectors</summary><div class=box-content><p>If you have previously completed a Splunk Observability workshop using this EC2 instance, you
need to ensure that any existing installation of the Splunk OpenTelemetry Collector is
deleted. This can be achieved by running the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>May 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 2. Preparation</h1><article class=default><header class=headline></header><h1 id=deploy-the-splunk-opentelemetry-collector>Deploy the Splunk OpenTelemetry Collector</h1><p>To get Observability signals (<strong>metrics, traces</strong> and <strong>logs</strong>) into <strong>Splunk Observability Cloud</strong> we need to deploy the Splunk OpenTelemetry Collector into the Kubernetes cluster.</p><p>For this workshop, we will be using the Splunk OpenTelemetry Collector Helm Chart. First, we need to add the Helm chart repository to Helm and run <code>helm repo update</code> to ensure the latest version:</p><div class=tab-panel data-tab-group=5033a29634d7e011ed23afb901d03954><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=install-helm-chart class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5033a29634d7e011ed23afb901d03954","install-helm-chart")'>
<span class=tab-nav-text>Install Helm Chart</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5033a29634d7e011ed23afb901d03954","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=install-helm-chart class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add splunk-otel-collector-chart https://signalfx.github.io/splunk-otel-collector-chart <span class=o>&amp;&amp;</span> helm repo update</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>&#34;splunk-otel-collector-chart&#34; has been added to your repositories
</span></span><span class=line><span class=cl>Using ACCESS_TOKEN={REDACTED}
</span></span><span class=line><span class=cl>Using REALM=eu0
</span></span><span class=line><span class=cl>Hang tight while we grab the latest from your chart repositories...
</span></span><span class=line><span class=cl>...Successfully got an update from the &#34;splunk-otel-collector-chart&#34; chart repository
</span></span><span class=line><span class=cl>Update Complete. ‚éàHappy Helming!‚éà</span></span></code></pre></div></div></div></div></div><p><strong>Splunk Observability Cloud</strong> offers wizards in the UI to walk you through the setup of the OpenTelemetry Collector on Kubernetes, but in the interest of time, we will use the Helm install command below. Additional parameters are set to enable the operator for automatic discovery and configuration and code profiling.</p><ul><li><code>--set="operator.enabled=true"</code> - this will install the OpenTelemetry operator that will be used to handle automatic discovery and configuration.</li><li><code>--set="splunkObservability.profilingEnabled=true"</code> - this enables Code Profiling via the operator.</li></ul><p>To install the collector run the following command. Do <strong>NOT</strong> edit this:</p><div class=tab-panel data-tab-group=dd1766ff4a58cc97798458bfc30072bd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=helm-install class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("dd1766ff4a58cc97798458bfc30072bd","helm-install")'>
<span class=tab-nav-text>Helm Install</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("dd1766ff4a58cc97798458bfc30072bd","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=helm-install class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install splunk-otel-collector --version 0.126.0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;operatorcrds.install=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;operator.enabled=true&#34;</span>, <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.accessToken=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;clusterName=</span><span class=nv>$INSTANCE</span><span class=s2>-k3s-cluster&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkObservability.profilingEnabled=true&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;agent.service.enabled=true&#34;</span>  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;environment=</span><span class=nv>$INSTANCE</span><span class=s2>-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.endpoint=</span><span class=nv>$HEC_URL</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.token=</span><span class=nv>$HEC_TOKEN</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--set<span class=o>=</span><span class=s2>&#34;splunkPlatform.index=splunk4rookies-workshop&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>splunk-otel-collector-chart/splunk-otel-collector <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-f ~/workshop/k3s/otel-collector.yaml</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>LAST DEPLOYED: Fri Apr 19 09:39:54 2024
</span></span><span class=line><span class=cl>NAMESPACE: default
</span></span><span class=line><span class=cl>STATUS: deployed
</span></span><span class=line><span class=cl>REVISION: 1
</span></span><span class=line><span class=cl>NOTES:
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Platform endpoint &#34;https://http-inputs-o11y-workshop-eu0.splunkcloud.com:443/services/collector/event&#34;.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Splunk OpenTelemetry Collector is installed and configured to send data to Splunk Observability realm eu0.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[INFO] You&#39;ve enabled the operator&#39;s auto-instrumentation feature (operator.enabled=true)! The operator can automatically instrument Kubernetes hosted applications.
</span></span><span class=line><span class=cl>  - Status: Instrumentation language maturity varies. See `operator.instrumentation.spec` and documentation for utilized instrumentation details.
</span></span><span class=line><span class=cl>  - Splunk Support: We offer full support for Splunk distributions and best-effort support for native OpenTelemetry distributions of auto-instrumentation libraries.</span></span></code></pre></div></div></div></div></div><p>Ensure the Pods are reported as <strong>Running</strong> before continuing (this typically takes around 30 seconds).</p><div class=tab-panel data-tab-group=573dd89dde348407cf8341a0be723777><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("573dd89dde348407cf8341a0be723777","kubectl-get-pods")'>
<span class=tab-nav-text>kubectl get pods</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("573dd89dde348407cf8341a0be723777","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods <span class=p>|</span> grep splunk-otel </span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-6bd5567d95-5f8cj     1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-tspd2                               1/1     Running   0          10m
</span></span><span class=line><span class=cl>splunk-otel-collector-operator-69d476cb7-j7zwd                  2/2     Running   0          10m</span></span></code></pre></div></div></div></div></div><p>Ensure there are no errors reported by the Splunk OpenTelemetry Collector (press <code>ctrl + c</code> to exit) or use the installed <strong>awesome</strong> <code>k9s</code> terminal UI for bonus points!</p><div class=tab-panel data-tab-group=67b340e29cb51390cdda3fd314ac77ed><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-logs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("67b340e29cb51390cdda3fd314ac77ed","kubectl-logs")'>
<span class=tab-nav-text>kubectl logs</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("67b340e29cb51390cdda3fd314ac77ed","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-logs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -l <span class=nv>app</span><span class=o>=</span>splunk-otel-collector -f --container otel-collector</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2021-03-21T16:11:10.900Z        INFO    service/service.go:364  Starting receivers...
</span></span><span class=line><span class=cl>2021-03-21T16:11:10.900Z        INFO    builder/receivers_builder.go:70 Receiver is starting... {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;prometheus&#34;, &#34;component_name&#34;: &#34;prometheus&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:75 Receiver started.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;prometheus&#34;, &#34;component_name&#34;: &#34;prometheus&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:70 Receiver is starting... {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    k8sclusterreceiver@v0.21.0/watcher.go:195       Configured Kubernetes MetadataExporter  {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;, &#34;exporter_name&#34;: &#34;signalfx&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    builder/receivers_builder.go:75 Receiver started.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    healthcheck/handler.go:128      Health Check state change       {&#34;component_kind&#34;: &#34;extension&#34;, &#34;component_type&#34;: &#34;health_check&#34;, &#34;component_name&#34;: &#34;health_check&#34;, &#34;status&#34;: &#34;ready&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    service/service.go:267  Everything is ready. Begin running and processing data.
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.009Z        INFO    k8sclusterreceiver@v0.21.0/receiver.go:59       Starting shared informers and wait for initial cache sync.      {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}
</span></span><span class=line><span class=cl>2021-03-21T16:11:11.281Z        INFO    k8sclusterreceiver@v0.21.0/receiver.go:75       Completed syncing shared informer caches.       {&#34;component_kind&#34;: &#34;receiver&#34;, &#34;component_type&#34;: &#34;k8s_cluster&#34;, &#34;component_name&#34;: &#34;k8s_cluster&#34;}</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Deleting a failed installation</summary><div class=box-content><p>If you make an error installing the OpenTelemetry Collector you can start over by deleting the
installation with the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm delete splunk-otel-collector</span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>May 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=deploy-the-petclinic-application>Deploy the PetClinic Application</h1><p>The first deployment of our application will be using prebuilt containers to give this base scenario: a regular Java microservices-based application running in Kubernetes that we want to start observing. So let&rsquo;s deploy the application:</p><div class=tab-panel data-tab-group=576ec4f9417f25fb6dc3ba822c79ee01><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-apply class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("576ec4f9417f25fb6dc3ba822c79ee01","kubectl-apply")'>
<span class=tab-nav-text>kubectl apply</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("576ec4f9417f25fb6dc3ba822c79ee01","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-apply class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f ~/workshop/petclinic/deployment.yaml</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/config-server created
</span></span><span class=line><span class=cl>service/config-server created
</span></span><span class=line><span class=cl>deployment.apps/discovery-server created
</span></span><span class=line><span class=cl>service/discovery-server created
</span></span><span class=line><span class=cl>deployment.apps/api-gateway created
</span></span><span class=line><span class=cl>service/api-gateway created
</span></span><span class=line><span class=cl>service/api-gateway-external created
</span></span><span class=line><span class=cl>deployment.apps/customers-service created
</span></span><span class=line><span class=cl>service/customers-service created
</span></span><span class=line><span class=cl>deployment.apps/vets-service created
</span></span><span class=line><span class=cl>service/vets-service created
</span></span><span class=line><span class=cl>deployment.apps/visits-service created
</span></span><span class=line><span class=cl>service/visits-service created
</span></span><span class=line><span class=cl>deployment.apps/admin-server created
</span></span><span class=line><span class=cl>service/admin-server created
</span></span><span class=line><span class=cl>service/petclinic-db created
</span></span><span class=line><span class=cl>deployment.apps/petclinic-db created
</span></span><span class=line><span class=cl>configmap/petclinic-db-initdb-config created
</span></span><span class=line><span class=cl>deployment.apps/petclinic-loadgen-deployment created
</span></span><span class=line><span class=cl>configmap/scriptfile created</span></span></code></pre></div></div></div></div></div><p>At this point, we can verify the deployment by checking that the Pods are running. The containers need to be downloaded and started, so this may take a couple of minutes.</p><div class=tab-panel data-tab-group=770beb0a6b91ce105e1e30397f9dbb19><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=kubectl-get-pods class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("770beb0a6b91ce105e1e30397f9dbb19","kubectl-get-pods")'>
<span class=tab-nav-text>kubectl get pods</span>
</button>
<button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("770beb0a6b91ce105e1e30397f9dbb19","output")'>
<span class=tab-nav-text>Output</span></button></div><div class=tab-content-container><div data-tab-item=kubectl-get-pods class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get pods</span></span></code></pre></div></div></div><div data-tab-item=output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME                                                            READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>splunk-otel-collector-k8s-cluster-receiver-655dcd9b6b-dcvkb     1/1     Running   <span class=m>0</span>          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-agent-dg2vj                               1/1     Running   <span class=m>0</span>          114s
</span></span><span class=line><span class=cl>splunk-otel-collector-operator-57cbb8d7b4-dk5wf                 2/2     Running   <span class=m>0</span>          114s
</span></span><span class=line><span class=cl>petclinic-db-64d998bb66-2vzpn                                   1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>api-gateway-d88bc765-jd5lg                                      1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>visits-service-7f97b6c579-bh9zj                                 1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>admin-server-76d8b956c5-mb2zv                                   1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>customers-service-847db99f79-mzlg2                              1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>vets-service-7bdcd7dd6d-2tcfd                                   1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>petclinic-loadgen-deployment-5d69d7f4dd-xxkn4                   1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>config-server-67f7876d48-qrsr5                                  1/1     Running   <span class=m>0</span>          58s
</span></span><span class=line><span class=cl>discovery-server-554b45cfb-bqhgt                                1/1     Running   <span class=m>0</span>          58s</span></span></code></pre></div></div></div></div></div><p>Make sure the output of <code>kubectl get pods</code> matches the output as shown in the above Output tab. Ensure all the services are shown as <strong>Running</strong> (or use <code>k9s</code> to continuously monitor the status).</p><p>To test the application, you need to obtain the public IP address of your instance. You can do this by running the following command:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://ifconfig.me</span></span></code></pre></div><p>Validate if the application is running by visiting <strong>http://&lt;IP_ADDRESS>:81</strong> (replace <strong>&lt;IP_ADDRESS></strong> with the IP address you obtained above). You should see the PetClinic application running. The application is also running on ports <strong>80</strong> & <strong>443</strong> if you prefer to use those or port <strong>81</strong> is unreachable.</p><p><a href=#R-image-19ee00be669191d34c223be229d6afb5 class=lightbox-link><img alt="Pet shop" class="lazy lightbox figure-image" loading=lazy src=../../images/petclinic.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-19ee00be669191d34c223be229d6afb5><img alt="Pet shop" class="lazy lightbox lightbox-image" loading=lazy src=../../images/petclinic.png></a></p><p>Make sure the application is working correctly by visiting the <strong>All Owners</strong> <strong>(1)</strong> and <strong>Veterinarians</strong> <strong>(2)</strong> tabs, confirming that you see a list of names on each page.</p><p><a href=#R-image-ad8f774b653f47b16b295c8fac708248 class=lightbox-link><img alt=Owners class="lazy lightbox figure-image" loading=lazy src=../../images/petclinic-owners.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ad8f774b653f47b16b295c8fac708248><img alt=Owners class="lazy lightbox lightbox-image" loading=lazy src=../../images/petclinic-owners.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>May 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=verify-kubernetes-cluster-metrics>Verify Kubernetes Cluster metrics</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Once the installation has completed, you can log in to <strong>Splunk Observability Cloud</strong> and verify that the metrics are flowing in from your Kubernetes cluster.</p><p>From the left-hand menu, click on <strong>Infrastructure</strong> and select <strong>Kubernetes</strong>, then select the <strong>Kubernetes nodes</strong> pane. Once you are in the <strong>Kubernetes nodes</strong> view, change the <strong>Time</strong> filter from <strong>-4h</strong> to the last 15 minutes <strong>(-15m)</strong> to focus on the latest data.</p><p>Next, from the list of nodes, select the Node name of your workshop instance. Note: You can get the unique part from your cluster name by using the <code>INSTANCE</code> from the output from the shell script you ran earlier. <strong>(1)</strong></p><p><a href=#R-image-9c874b4fc7cb22ee7b7b569560b9bb1d class=lightbox-link><img alt=NavigatorList class="lazy lightbox figure-image" loading=lazy src=../images/navigatorlist.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9c874b4fc7cb22ee7b7b569560b9bb1d><img alt=NavigatorList class="lazy lightbox lightbox-image" loading=lazy src=../images/navigatorlist.png></a></p><p>Open the <strong>Hierarchy Map</strong> by clicking on the <em>Hierarchy Map</em> link in the gray pane to show the graphical representation of your node.</p><p><a href=#R-image-36c7e985e759f097a9f351aa471e3eef class=lightbox-link><img alt=HeirarchyMap class="lazy lightbox figure-image" loading=lazy src=../images/hierarchymap.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-36c7e985e759f097a9f351aa471e3eef><img alt=HeirarchyMap class="lazy lightbox lightbox-image" loading=lazy src=../images/hierarchymap.png></a></p><p>You will now only have your cluster visible. Scroll down the page to see the metrics coming in from your cluster. Locate the <strong>Node log events rate</strong> <strong>(1)</strong> chart and click on a vertical bar to see the log entries coming in from your cluster.</p><p><a href=#R-image-f5eaff0f4cb723f20abc6326b074eab8 class=lightbox-link><img alt=Logs class="lazy lightbox figure-image" loading=lazy src=../images/k8s-peek-at-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f5eaff0f4cb723f20abc6326b074eab8><img alt=Logs class="lazy lightbox lightbox-image" loading=lazy src=../images/k8s-peek-at-logs.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>May 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=setting-up-automatic-discovery-and-configuration-for-apm>Setting up automatic discovery and configuration for APM</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, we will enable <strong>automatic discovery and configuration</strong> for the Java services running in Kubernetes. This means that the OpenTelemetry Collector will look for Pod annotations that indicate that the Java application should be instrumented with the Splunk OpenTelemetry Java agent. This will allow us to get traces, spans, and profiling data from Java services running on the cluster.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
automatic discovery and configuration</summary><div class=box-content><p>It is important to understand that automatic discovery and configuration is designed to get <strong>trace, span & profiling</strong> data out of your application <strong>without requiring code changes or recompilation</strong>.</p><p>This is a great way to get started with APM, but it is <strong>not</strong> a replacement for manual instrumentation. Manual instrumentation allows you to add custom spans, tags, and logs to your application, which can provide more context and detail to your traces.</p></div></details><p>For Java applications, the OpenTelemetry Collector will look for the annotation <code>instrumentation.opentelemetry.io/inject-java</code>.</p><p>The annotation can have the value set to <code>true</code> or to the <code>namespace/daemonset</code> of the OpenTelemetry Collector e.g. <code>default/splunk-otel-collector</code>. This allows working across namespaces and is what we will use in this workshop.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Using the deployment.yaml</summary><div class=box-content><p>If you want your Pods to send traces automatically, you can add the annotation to the <code>deployment.yaml</code> as shown below. This will add the instrumentation library during the initial deployment. To speed things up we have done that for the following Pods:</p><ul><li><strong>admin-server</strong></li><li><strong>config-server</strong></li><li><strong>discovery-server</strong></li></ul><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/part-of</span><span class=p>:</span><span class=w> </span><span class=l>spring-petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>admin-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>instrumentation.opentelemetry.io/inject-java</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;default/splunk-otel-collector&#34;</span></span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 4. Automatic discovery and configuration</h1><article class=default><header class=headline></header><h1 id=patching-the-deployment>Patching the Deployment</h1><p>To configure <strong>automatic discovery and configuration</strong>, the deployments need to be patched to add the instrumentation annotation. Once patched, the OpenTelemetry Collector will inject the automatic discovery and configuration library and the Pods will be restarted in order to start sending traces and profiling data. First, confirm that the <code>api-gateway</code> does not have the <code>splunk-otel-java</code> image by running the following:</p><div class=tab-panel data-tab-group=5833ae99fc274752fc62d268a41e9231><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=describe-api-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5833ae99fc274752fc62d268a41e9231","describe-api-gateway")'>
<span class=tab-nav-text>Describe api-gateway</span>
</button>
<button data-tab-item=describe-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("5833ae99fc274752fc62d268a41e9231","describe-output")'>
<span class=tab-nav-text>Describe Output</span></button></div><div class=tab-content-container><div data-tab-item=describe-api-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span> grep Image:</span></span></code></pre></div></div></div><div data-tab-item=describe-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Image:         quay.io/phagen/spring-petclinic-api-gateway:0.0.2</span></span></code></pre></div></div></div></div></div><p>Next, enable the Java automatic discovery and configuration for all the services by adding the annotation to the deployments. The following command will patch the all deployments. This will trigger the OpenTelemetry Operator to inject the <code>splunk-otel-java</code> image into the Pods:</p><div class=tab-panel data-tab-group=de53cc583b5a7f66b1ccfe2638e61497><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=patch-all-petclinic-services class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("de53cc583b5a7f66b1ccfe2638e61497","patch-all-petclinic-services")'>
<span class=tab-nav-text>Patch all PetClinic services</span>
</button>
<button data-tab-item=patch-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("de53cc583b5a7f66b1ccfe2638e61497","patch-output")'>
<span class=tab-nav-text>Patch Output</span></button></div><div class=tab-content-container><div data-tab-item=patch-all-petclinic-services class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get deployments -l app.kubernetes.io/part-of<span class=o>=</span>spring-petclinic -o name <span class=p>|</span> xargs -I % kubectl patch % -p <span class=s2>&#34;{\&#34;spec\&#34;: {\&#34;template\&#34;:{\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{\&#34;instrumentation.opentelemetry.io/inject-java\&#34;:\&#34;default/splunk-otel-collector\&#34;}}}}}&#34;</span></span></span></code></pre></div></div></div><div data-tab-item=patch-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>deployment.apps/config-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/admin-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/customers-service patched
</span></span><span class=line><span class=cl>deployment.apps/visits-service patched
</span></span><span class=line><span class=cl>deployment.apps/discovery-server patched (no change)
</span></span><span class=line><span class=cl>deployment.apps/vets-service patched
</span></span><span class=line><span class=cl>deployment.apps/api-gateway patched</span></span></code></pre></div></div></div></div></div><p>There will be no change for the <strong>config-server</strong>, <strong>discovery-server</strong> and <strong>admin-server</strong> as these have already been patched.</p><p>To check the container image(s) of the <code>api-gateway</code> pod again, run the following command:</p><div class=tab-panel data-tab-group=12513ede19865e86930b89bc13ae290d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=describe-api-gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("12513ede19865e86930b89bc13ae290d","describe-api-gateway")'>
<span class=tab-nav-text>Describe api-gateway</span>
</button>
<button data-tab-item=describe-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("12513ede19865e86930b89bc13ae290d","describe-output")'>
<span class=tab-nav-text>Describe Output</span></button></div><div class=tab-content-container><div data-tab-item=describe-api-gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe pods api-gateway <span class=p>|</span> grep Image:</span></span></code></pre></div></div></div><div data-tab-item=describe-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Image:         ghcr.io/signalfx/splunk-otel-java/splunk-otel-java:v1.30.0
</span></span><span class=line><span class=cl>Image:         quay.io/phagen/spring-petclinic-api-gateway:0.0.2</span></span></code></pre></div></div></div></div></div><p>A new image has been added to the <code>api-gateway</code> which will pull <code>splunk-otel-java</code> from <code>ghcr.io</code> (Note: if you see two <code>api-gateway</code> containers, the original one is probably still terminating, so give it a few seconds).</p><p>Navigate back to the Kubernetes Navigator in <strong>Splunk Observability Cloud</strong>. After a couple of minutes, you will see that the Pods are being restarted by the operator and the automatic discovery and configuration container will be added. This will look similar to the screenshot below:</p><p><a href=#R-image-678abbda73ab7d5d8f4ca1aab5fff00a class=lightbox-link><img alt=restart class="lazy lightbox figure-image" loading=lazy src=../../images/k8s-navigator-restarted-pods.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-678abbda73ab7d5d8f4ca1aab5fff00a><img alt=restart class="lazy lightbox lightbox-image" loading=lazy src=../../images/k8s-navigator-restarted-pods.png></a></p><p>Wait for the Pods to turn green in the Kubernetes Navigator, then go tho the next section.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>May 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=viewing-the-data-in-splunk-apm>Viewing the data in Splunk APM</h1><p>In the left-hand menu click on <strong>APM</strong> to see the data generated by the traces from the newly instrumented services. Change the <strong>Environment</strong> filter <strong>(1)</strong> to the name of your workshop instance in the dropdown box. (Note: this will be <strong><code>&lt;INSTANCE>-workshop</code></strong> where <strong><code>INSTANCE</code></strong> is the value from the shell script you ran earlier. Ensure it is the only one selected.)</p><p><a href=#R-image-6bd1e586af77f6658f8ad4900c835517 class=lightbox-link><img alt=apm class="lazy lightbox figure-image" loading=lazy src=../../images/zero-config-first-services-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6bd1e586af77f6658f8ad4900c835517><img alt=apm class="lazy lightbox lightbox-image" loading=lazy src=../../images/zero-config-first-services-overview.png></a></p><p>If you see a Critical Alert, you can ignore it as it is caused by the sudden request increase generated by the load generator <strong>(2)</strong>. Click on the <strong>Service Map</strong> <strong>(3)</strong> pane to get ready for the next section.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>May 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=apm-features>APM Features</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>As we have seen in the previous section, once you enable <strong>automatic discovery and configuration</strong> on your services, traces are sent to <strong>Splunk Observability Cloud</strong>.</p><p>With these traces, Splunk will automatically generate <strong>Service Maps</strong> and <strong>RED Metrics</strong>. These are the first steps in understanding the behavior of your services and how they interact with each other.</p><p>In this next section, we are going to examine the traces themselves and the information they provide to help you understand the behavior of your services &ndash; all without touching your code!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 5. APM Features</h1><article class=default><header class=headline></header><h1 id=apm-service-map>APM Service Map</h1><p><a href=#R-image-c02cb66168a74188f063d501446d1a90 class=lightbox-link><img alt="apm map" class="lazy lightbox figure-image" loading=lazy src=../../images/zero-config-first-services-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c02cb66168a74188f063d501446d1a90><img alt="apm map" class="lazy lightbox lightbox-image" loading=lazy src=../../images/zero-config-first-services-map.png></a></p><p>The above map shows all the interactions between all the services. The map may still be in an interim state as it will take the PetClinic Microservice application a few minutes to start up and fully synchronize. Reducing the time filter to a custom time of <strong>2 minutes</strong> by entering <strong>-2m</strong> will help. You can click on the <strong>Refresh</strong> button <strong>(1)</strong> in the top right-hand corner of the screen. The initial startup-related errors indicated by red circles will eventually disappear.</p><p>Next, let&rsquo;s examine the metrics that are available for each service that is instrumented by visiting the request, error, and duration (RED) metrics Dashboard.</p><p>For this exercise, we are going to use a common scenario you would use if your service operation was showing high latency or errors.</p><p>Click on <strong>customers-service</strong> in the Dependency map, then make sure the <code>customers-service</code> is selected in the <strong>Services</strong> dropdown box <strong>(1)</strong>. Next, select <code>GET /owners</code> from the Operations dropdown <strong>(2)</strong> adjacent to the Service name.</p><p>This should give you the workflow with a filter on <code>GET /owners</code> as shown below:</p><p><a href=#R-image-489688f9cf335dbb4d530592c84e7e42 class=lightbox-link><img alt="select a trace" class="lazy lightbox figure-image" loading=lazy src=../../images/select-workflow.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-489688f9cf335dbb4d530592c84e7e42><img alt="select a trace" class="lazy lightbox lightbox-image" loading=lazy src=../../images/select-workflow.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>May 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=apm-trace>APM Trace</h1><p>To pick a trace, select a line in the <code>Service Requests & Errors</code> chart <strong>(1)</strong>. A selection of related traces will appear.</p><p>Once you have the list of related traces, click on the blue <strong>(2)</strong> Trace ID Link, making sure the trace you select has the same three services mentioned in the Services Column.</p><p><a href=#R-image-fada7dc3652a8481897d71e44e8b9a35 class=lightbox-link><img alt=workflow-trace-pick class="lazy lightbox figure-image" loading=lazy src=../../images/selecting-a-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fada7dc3652a8481897d71e44e8b9a35><img alt=workflow-trace-pick class="lazy lightbox lightbox-image" loading=lazy src=../../images/selecting-a-trace.png></a></p><p>This brings us to the selected Trace in the Waterfall view:</p><p>Here we find several sections:</p><ul><li>The Waterfall Pane <strong>(1)</strong>, where you see the trace and all the instrumented functions visible as spans, with their duration representation and order/relationship showing.</li><li>The Trace Info Pane <strong>(2)</strong>, which shows the selected Span information (highlighted with a box around the Span in the Waterfall Pane).</li><li>The Span Pane <strong>(3)</strong> where you can find all the Tags that have been sent in the selected Span. You can scroll down to see all of them.</li><li>The process Pane, with tags related to the process that created the Span (scroll down to see as it is not in the screenshot).</li><li>The Trace Properties, located at the top right-hand side of the pane is collapsed by default.</li></ul><p><a href=#R-image-4d73d8242796835a43623687dae559a2 class=lightbox-link><img alt=waterfall class="lazy lightbox figure-image" loading=lazy src=../../images/waterfall-view.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4d73d8242796835a43623687dae559a2><img alt=waterfall class="lazy lightbox lightbox-image" loading=lazy src=../../images/waterfall-view.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=apm-span>APM Span</h1><p>While we examine our spans, let&rsquo;s look at several out-of-the-box features that you get <strong>without code modifications</strong> when using <strong>automatic discovery and configuration</strong> on top of tracing:</p><p>First, in the Waterfall Pane, make sure the <code>customers-service:SELECT petclinic</code> or similar span is selected as shown in the screenshot below:</p><p><a href=#R-image-d3e05433e9b91dfd81de0e17e0d037e0 class=lightbox-link><img alt=DB-query class="lazy lightbox figure-image" loading=lazy src=../../images/db-query.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d3e05433e9b91dfd81de0e17e0d037e0><img alt=DB-query class="lazy lightbox lightbox-image" loading=lazy src=../../images/db-query.png></a></p><ul><li>The basic latency information is shown as a bar for the instrumented function or call. In our example above, it took 17.8 Milliseconds.</li><li>Several similar Spans <strong>(1)</strong> are only visible if the span is repeated multiple times. In this case, there are 10 repeats in our example. You can show/hide them all by clicking on the <code>10x</code> and all spans will show in order.</li><li><strong>Inferred Services</strong>: Calls made to external systems that are not instrumented show up as a grey &lsquo;inferred&rsquo; span. The Inferred Service or span in our example is a call to the Mysql Database <code>mysql:petclinic SELECT petclinic</code> <strong>(2)</strong> as shown above.</li><li><strong>Span Tags</strong>: In the Tag Pane, we see standard tags produced by the automatic discovery and configuration. In this case, the span is calling a Database, so it includes the <code>db.statement</code> tag <strong>(3)</strong>. This tag will hold the DB query statement and is used by the Database call performed during this span. This will be used by the DB-Query Performance feature. We look at DB-Query Performance in the next section.</li><li><strong>Always-on Profiling</strong>: <strong>IF</strong> the system is configured to capture Profiling data during a Span life cycle. It will show the number of Call Stacks captured in the Spans timeline. In our example above, we see 18 Call Stacks for the <code>customer-service:GET /owners</code> Span. <strong>(4)</strong></li></ul><p>We will look at Profiling in the next section.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=service-centric-view>Service Centric View</h1><p>Splunk APM provide <strong>Service Centric Views</strong> that provide engineers a deep understanding of service performance in one centralized view. Now, across every service, engineers can quickly identify errors or bottlenecks from a service‚Äôs underlying infrastructure, pinpoint performance degradation from new deployments, and visualize the health of every third party dependency.</p><p>To see this dashboard for the <code>api-gateway</code>, click on <strong>APM</strong> from the left-hand menu and then click on the <code>api-gateway</code> service in the list. This will bring you to the Service Centric View dashboard:</p><p><a href=#R-image-036273bfeee4d7740f31219bb5559bd1 class=lightbox-link><img alt=service_maps class="lazy lightbox figure-image" loading=lazy src=../../images/service-view.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-036273bfeee4d7740f31219bb5559bd1><img alt=service_maps class="lazy lightbox lightbox-image" loading=lazy src=../../images/service-view.png></a></p><p>This view, which is available for each of your instrumented services, offers an overview of <strong>Service metrics</strong>, <strong>Error breakdown</strong>, <strong>Runtime metrics (Java)</strong> and <strong>Infrastructure metrics</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>May 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=always-on-profiling--db-query-performance>Always-On Profiling & DB Query Performance</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>15 minutes</span>
</span>&nbsp;<p>As we have seen in the previous chapter, you can trace your interactions between the various services using APM without touching your code, allowing you to identify issues faster.</p><p>In addition to tracing, <strong>automatic discovery and configuration</strong> offers additional features out of the box that can help you find issues even faster! In this section we are going to look at two of them:</p><ul><li><strong>Always-on Profiling and Java Metrics</strong></li><li><strong>Database Query Performance</strong></li></ul><p>If you want to dive deeper into Always-on Profiling or DB-Query performance, we have a separate Ninja Workshop called <a href=/en/scenarios/debug_problems/><strong>Debug Problems in Microservices</strong></a> that you can follow.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 6. Advanced Features</h1><article class=default><header class=headline></header><h1 id=always-on-profiling--metrics>Always-On Profiling & Metrics</h1><p>When we installed the Splunk Distribution of the OpenTelemetry Collector using the Helm chart earlier, we configured it to enable <strong>AlwaysOn Profiling</strong> and <strong>Metrics</strong>. This means that OpenTelemetry Java will automatically generate CPU and Memory profiling for the application, sending them to Splunk Observability Cloud.</p><p>When you deploy the PetClinic application and set the annotation, the collector automatically detects the application and instruments it for traces and profiling. We can verify this by examining the startup logs of one of the Java containers we are instrumenting by running the following script:</p><p>The logs will show the flags that were picked up by the Java automatic discovery and configuration:</p><p><div class=tab-panel data-tab-group=ce2ab2e7dd466aafb2d2bf291b352a44><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=run-the-script class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ce2ab2e7dd466aafb2d2bf291b352a44","run-the-script")'>
<span class=tab-nav-text>Run the script</span>
</button>
<button data-tab-item=example-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("ce2ab2e7dd466aafb2d2bf291b352a44","example-output")'>
<span class=tab-nav-text>Example output</span></button></div><div class=tab-content-container><div data-tab-item=run-the-script class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code" dir=auto><pre tabindex=0><code class=language-logs data-lang=logs>.  ~/workshop/petclinic/scripts/get_logs.sh</code></pre></div></div></div><div data-tab-item=example-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2024/02/15 09:42:00 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:01 Problem with dial: dial tcp 10.43.104.25:8761: connect: connection refused. Sleeping 1s
</span></span><span class=line><span class=cl>2024/02/15 09:42:02 Connected to tcp://discovery-server:8761
</span></span><span class=line><span class=cl>Picked up JAVA_TOOL_OPTIONS:  -javaagent:/otel-auto-instrumentation-java/javaagent.jar
</span></span><span class=line><span class=cl>Picked up _JAVA_OPTIONS: -Dspring.profiles.active=docker,mysql -Dsplunk.profiler.call.stack.interval=150
</span></span><span class=line><span class=cl>OpenJDK 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:056 +0000] [main] INFO io.opentelemetry.javaagent.tooling.VersionLogger - opentelemetry-javaagent - version: splunk-1.30.1-otel-1.32.1
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:03:768 +0000] [main] INFO com.splunk.javaagent.shaded.io.micrometer.core.instrument.push.PushMeterRegistry - publishing metrics for SignalFxMeterRegistry every 30s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:478 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - Profiler configuration:
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:480 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                  splunk.profiler.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -                splunk.profiler.directory : /tmp
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:505 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -       splunk.profiler.recording.duration : 20s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:506 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -               splunk.profiler.keep-files : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:510 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -            splunk.profiler.logs-endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -              otel.exporter.otlp.endpoint : http://10.13.2.38:4317
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:513 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -           splunk.profiler.memory.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:515 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -             splunk.profiler.tlab.enabled : true
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -        splunk.profiler.memory.event.rate : 150/s
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:516 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.call.stack.interval : PT0.15S
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -  splunk.profiler.include.internal.stacks : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger -      splunk.profiler.tracing.stacks.only : false
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:517 +0000] [main] INFO com.splunk.opentelemetry.profiler.ConfigurationLogger - -----------------------
</span></span><span class=line><span class=cl>[otel.javaagent 2024-02-15 09:42:07:518 +0000] [main] INFO com.splunk.opentelemetry.profiler.JfrActivator - Profiler is active.</span></span></code></pre></div></div></div></div></div>We are interested in the section written by the <code>com.splunk.opentelemetry.profiler.ConfigurationLogger</code> or the <strong>Profiling Configuration</strong>.</p><p>We can see the various settings you can control, such as the <code>splunk.profiler.directory</code>, which is the location where the agent writes the call stacks before sending them to Splunk. (This may be different depending on how you configure your containers.)</p><p>Another parameter you may want to change is <code>splunk.profiler.call.stack.interval</code>. This is how often the system captures a CPU Stack trace. You may want to reduce this interval setting if you have short spans like the ones we have in our Pet Clinic application. For the demo application, we did not change the default interval value, so Spans may not always have a CPU Call Stack related to them.</p><p>You can find how to set these parameters <a href=https://help.splunk.com/en/splunk-observability-cloud/manage-data/available-data-sources/supported-integrations-in-splunk-observability-cloud/apm-instrumentation/instrument-a-java-application/configure-the-java-agent#profiling-configuration-java rel=external target=_blank>here</a>. In the example below, we see how to set a higher collection rate for call stacks in the <code>deployment.yaml</code>, by setting this value in the JAVA_OPTIONS config section.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>env</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>JAVA_OPTIONS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Xdebug -Dsplunk.profiler.call.stack.interval=150&#34;</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 3, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=always-on-profiling-in-the-trace-waterfall>Always-On Profiling in the Trace Waterfall</h1><p>Make sure you have your original (or similar) Trace & Span <strong>(1)</strong> selected in the APM Waterfall view and select <strong>Memory Stack Traces (2)</strong> from the right-hand pane:</p><p><a href=#R-image-2f90c50a8a3a219e3ed04b938a4d6046 class=lightbox-link><img alt="profiling from span" class="lazy lightbox figure-image" loading=lazy src=../../images/flamechart-in-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2f90c50a8a3a219e3ed04b938a4d6046><img alt="profiling from span" class="lazy lightbox lightbox-image" loading=lazy src=../../images/flamechart-in-waterfall.png></a></p><p>The pane should show you the Memory Stack Trace Flame Graph <strong>(3)</strong>. You can scroll down and/or expand by dragging the right side of the pane.</p><p>AlwaysOn Profiling is constantly taking snapshots, or stack traces, of your application‚Äôs code. Imagine having to read through thousands of stack traces! It is simply not practical. To assist with this, AlwaysOn Profiling aggregates and summarizes profiling data, providing a convenient way to explore Call Stacks in a view called the <strong>Flame Graph</strong>. It represents a summary of all stack traces captured from your application. You can use the Flame Graph to discover which lines of code might be causing performance issues and to confirm whether changes you make to the code have the intended effect.</p><p>To dive deeper into Always-on Profiling, select Span <strong>(3)</strong> (as referenced in the above image) in the Profiling Pane under <strong>Memory Stack Traces</strong>. This will open the Always-on Profiling main screen, with the Memory view pre-selected:</p><p><a href=#R-image-62d360cadf680366011ca2446977b1db class=lightbox-link><img alt="Profiling main" class="lazy lightbox figure-image" loading=lazy src=../../images/profiling-memory.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-62d360cadf680366011ca2446977b1db><img alt="Profiling main" class="lazy lightbox lightbox-image" loading=lazy src=../../images/profiling-memory.png></a></p><ul><li>The Time filter will be set to the time frame of the span we selected <strong>(1)</strong></li><li>Java Memory Metric Charts <strong>(2)</strong> allow you to <code>Monitor Heap Memory, Application Activity</code> like <code>Memory Allocation Rate</code> and <code>Garbage Collecting</code> Metrics.</li><li>Ability to focus/see metrics and Stack Traces only related to the Span <strong>(3)</strong>, This will filter out background activities running in the Java application if required.</li><li>Java Function calls identified <strong>(4)</strong>, allowing you to drill down into the Methods called from that function.</li><li>The Flame Graph <strong>(5)</strong>, with the visualization of hierarchy based on the stack traces of the profiled service.</li><li>Ability to select the Service instance <strong>(6)</strong> in case the service spins up multiple version of itself.</li></ul><p>For further investigation, the UI allows you to click a stack trace so that you can see the called function and the relevant line from the flame chart that you can then use in your coding platform to view the actual lines of code (depending of course on your preferred Coding platform).</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 3, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=database-query-performance>Database Query Performance</h1><p>With Database Query Performance, you can monitor the impact of your database queries on service availability directly in Splunk APM. This way, you can quickly identify long-running, unoptimized, or heavy queries and mitigate issues they might be causing, without having to instrument your databases.</p><p>To look at the performance of your database queries, make sure you are on the APM <strong>Service Map</strong> page either by going back in the browser or navigating to the APM section in the Menu bar, then click on the <strong>Service Map</strong> tile.</p><p>Select the inferred database service <code>mysql:petclinic</code> Inferred Database server in the Dependency map <strong>(1)</strong>, then scroll the right-hand pane to find the <strong>Database Query Performance</strong> Pane <strong>(2)</strong>.</p><p><a href=#R-image-709cdb1c869554c50575a6a56ef786d4 class=lightbox-link><img alt="DB-query from map" class="lazy lightbox figure-image" loading=lazy src=../../images/db-query-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-709cdb1c869554c50575a6a56ef786d4><img alt="DB-query from map" class="lazy lightbox lightbox-image" loading=lazy src=../../images/db-query-map.png></a></p><p>If the service you have selected in the map is indeed an (inferred) database server, this pane will populate with the top 90% (P90) database calls based on duration. To dive deeper into the db-query performance function, click somewhere on the word <strong>Database Query Performance</strong> at the top of the pane.</p><p>This will bring us to the DB-query Performance overview screen:</p><p><a href=#R-image-6f06671fbe7aebf57d0045e6a55d7469 class=lightbox-link><img alt="DB-query full" class="lazy lightbox figure-image" loading=lazy src=../../images/db-query-full.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6f06671fbe7aebf57d0045e6a55d7469><img alt="DB-query full" class="lazy lightbox lightbox-image" loading=lazy src=../../images/db-query-full.png></a></p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Database Query Normalization</summary><div class=box-content><p>By default, Splunk APM instrumentation sanitizes database queries to remove or mask sensible data, such as secrets or personally identifiable information (PII) from the <code>db.statements</code>. You can find how to turn off database query normalization <a href=https://help.splunk.com/en/splunk-observability-cloud/monitor-application-performance/monitor-database-query-performance/troubleshoot-database-query-performance#turn-off-database-query-normalization rel=external target=_blank>here</a>.</p></div></details><p>This screen will show us all the Database queries <strong>(1)</strong> done to our database from your application, based on the Traces & Spans sent to the Splunk Observability Cloud. Note that you can compare them across a time block or sort them on Total Time, P90 Latency & Requests <strong>(2)</strong>.</p><p>For each Database query in the list, we see the highest latency, the total number of calls during the time window and the number of requests per second <strong>(3)</strong>. This allows you to identify places where you might optimize your queries.</p><p>You can select traces containing Database Calls via the two charts in the right-hand pane <strong>(5)</strong>. Use the Tag Spotlight pane <strong>(6)</strong> to drill down to see which tags are related to the database calls, based on endpoints or tags.</p><p>If you need to see a detailed view of a query:</p><p><a href=#R-image-2cdc3cd11a7063578d7b6d4038e5c79a class=lightbox-link><img alt=details class="lazy lightbox figure-image" loading=lazy src=../../images/query-details.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2cdc3cd11a7063578d7b6d4038e5c79a><img alt=details class="lazy lightbox lightbox-image" loading=lazy src=../../images/query-details.png></a></p><p>Click on the specific Query <strong>(1)</strong>. This will open the Query Details pane <strong>(2)</strong>, which you can use for more detailed investigations.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 3, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=log-observer>Log Observer</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>Up until this point, there have been <strong>no code changes</strong>, yet tracing, profiling and Database Query Performance data is being sent to Splunk Observability Cloud.</p><p>Next, we will work with <strong>Splunk Log Observer</strong> to obtain log data from the Spring PetClinic application.</p><p>The <strong>Splunk OpenTelemetry Collector</strong> automatically collects logs from the Spring PetClinic application and sends them to Splunk Observability Cloud using the OTLP exporter, annotating the log events with <code>trace_id</code>, <code>span_id</code> and trace flags.</p><p><strong>Splunk Log Observer</strong> is then used to view the logs, automatically correlating log information with services and traces.</p><p>This feature is called <a href=https://help.splunk.com/en/splunk-observability-cloud/data-tools/related-content rel=external target=_blank><strong>Related Content</strong></a>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Jun 3, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 7. Log Observer</h1><article class=default><header class=headline></header><h1 id=viewing-the-logs>Viewing the Logs</h1><p>In order to see logs click on the <a href=#R-image-7f679c266af3716e7742ec3b249c4984 class=lightbox-link><img alt=Logo class="inline lazy lightbox figure-image" loading=lazy src="../images/logo-icon.png?classes=inline&height=25px" style=height:25px;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7f679c266af3716e7742ec3b249c4984><img alt=Logo class="inline lazy lightbox lightbox-image" loading=lazy src="../images/logo-icon.png?classes=inline&height=25px"></a> <strong>Log Observer</strong> in the left-hand menu. Once in Log Observer please ensure <strong>Index</strong> on the filter bar is set to <strong>splunk4rookies-workshop</strong>. <strong>(1)</strong></p><p>Next, click <strong>Add Filter</strong> and search, using the <em>Fields</em> <strong>(2)</strong> option for the field <code>deployment.environment</code> <strong>(3)</strong>. Then from the dropdown list, select your workshop instance, <strong>(4)</strong> and click <code>=</code> (to include). You will now see only the log messages from your PetClinic application.</p><p><a href=#R-image-5149512f5790c471f5a640215eda621a class=lightbox-link><img alt="Log Observer sort" class="lazy lightbox figure-image" loading=lazy src=../../images/log-observer-sort.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5149512f5790c471f5a640215eda621a><img alt="Log Observer sort" class="lazy lightbox lightbox-image" loading=lazy src=../../images/log-observer-sort.png></a></p><p>Next, search for the field <code>service.name</code>, selecting the value <code>customers-service</code> and click <code>=</code> (to include). This should now appear in the filter bar <strong>(1)</strong>. Next click on the Button <strong>Run Search</strong> <strong>(2)</strong>.</p><p><a href=#R-image-0bf5be0901c0d517d75c716ad24476f1 class=lightbox-link><img alt="Log Observer run" class="lazy lightbox figure-image" loading=lazy src=../../images/log-observer-run.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0bf5be0901c0d517d75c716ad24476f1><img alt="Log Observer run" class="lazy lightbox lightbox-image" loading=lazy src=../../images/log-observer-run.png></a></p><p>This wil refresh the log entries and they will now be reduced to show the entries from your <code>customers-service</code> only.</p><p><a href=#R-image-c29c8d7964daaf36e5ae5c60bad1f0ed class=lightbox-link><img alt="Log Observer" class="lazy lightbox figure-image" loading=lazy src=../../images/log-observer-trace-info.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c29c8d7964daaf36e5ae5c60bad1f0ed><img alt="Log Observer" class="lazy lightbox lightbox-image" loading=lazy src=../../images/log-observer-trace-info.png></a></p><p>Click on an entry that starts with <em>&ldquo;Saving pet&rdquo;</em> <strong>(1)</strong>. A side pane will open where you can see the detailed information, including the relevant trace and span IDs <strong>(2)</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=related-content>Related Content</h1><p>The bottom pane is where any related content will be reported. In the screenshot below you can see that APM has found a trace that is related to this log line <strong>(1)</strong>:</p><p><a href=#R-image-c6121c41bd7feca5e2fe9b6d87cc5c44 class=lightbox-link><img alt=RC class="lazy lightbox figure-image" loading=lazy src=../../images/log-apm-rc.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c6121c41bd7feca5e2fe9b6d87cc5c44><img alt=RC class="lazy lightbox lightbox-image" loading=lazy src=../../images/log-apm-rc.png></a></p><p>By clicking <strong>(2)</strong> on <strong>Trace for 960432ac9f16b98be84618778905af50</strong> we will be taken to the waterfall in APM for this specific trace, where this log line was generated:</p><p><a href=#R-image-4015fb5839d42b1849ae22158c8ab3de class=lightbox-link><img alt="waterfall logs" class="lazy lightbox figure-image" loading=lazy src=../../images/waterfall-with-logs.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4015fb5839d42b1849ae22158c8ab3de><img alt="waterfall logs" class="lazy lightbox lightbox-image" loading=lazy src=../../images/waterfall-with-logs.png></a></p><p>Note that you now have a <strong>Related Content</strong> pane for Logs appearing <strong>(1)</strong>. Clicking on this will take you back to Log Observer and will display all the log lines that are part of this trace.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=real-user-monitoring>Real User Monitoring</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>To enable Real User Monitoring (RUM) instrumentation for an application, you need to add the Open Telemetry Javascript <a href=https://github.com/signalfx/splunk-otel-js-web rel=external target=_blank><strong>https://github.com/signalfx/splunk-otel-js-web</strong></a> snippet to the code base.</p><p>The Spring PetClinic application uses a single <a href=https://github.com/spring-petclinic/spring-petclinic-microservices/blob/main/spring-petclinic-api-gateway/src/main/resources/static/index.html rel=external target=_blank><strong>index</strong></a> HTML page, that is reused across all views of the application. This is the perfect location to insert the Splunk RUM instrumentation library as it will be loaded for all pages automatically.</p><p>The <code>api-gateway</code> service is already running the instrumentation and sending RUM traces to Splunk Observability Cloud and we will review the data in the next section.</p><p>If you&rsquo;d like to verify the snippet, you can view the page source in your browser by right-clicking on the page and selecting <strong>View Page Source</strong>.</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;/env.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>  
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js&#34;</span> <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>realm</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_REALM</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Realm:&#39;</span><span class=p>,</span> <span class=nx>realm</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>auth</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_AUTH</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>appName</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_APP_NAME</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>environmentName</span> <span class=o>=</span> <span class=nx>env</span><span class=p>.</span><span class=nx>RUM_ENVIRONMENT</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>realm</span> <span class=o>&amp;&amp;</span> <span class=nx>auth</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>realm</span><span class=o>:</span> <span class=nx>realm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=nx>auth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>applicationName</span><span class=o>:</span> <span class=nx>appName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>deploymentEnvironment</span><span class=o>:</span> <span class=nx>environmentName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>version</span><span class=o>:</span> <span class=s1>&#39;1.0.0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>            <span class=nx>SplunkSessionRecorder</span><span class=p>.</span><span class=nx>init</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=nx>app</span><span class=o>:</span> <span class=nx>appName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>realm</span><span class=o>:</span> <span class=nx>realm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>rumAccessToken</span><span class=o>:</span> <span class=nx>auth</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=kr>const</span> <span class=nx>Provider</span> <span class=o>=</span> <span class=nx>SplunkRum</span><span class=p>.</span><span class=nx>provider</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>tracer</span><span class=o>=</span><span class=nx>Provider</span><span class=p>.</span><span class=nx>getTracer</span><span class=p>(</span><span class=s1>&#39;appModuleLoader&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Realm or auth is empty, provide default values or skip initialization
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Realm or auth is empty. Skipping Splunk Rum initialization.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>     <span class=c>&lt;!-- Section added for  RUM --&gt;</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 8. Real User Monitoring</h1><article class=default><header class=headline></header><h1 id=select-the-rum-view-for-the-petclinic-app>Select the RUM view for the Petclinic App</h1><p>Lets start with a quick, high level tour of RUM by clicking <strong>RUM</strong> in the left-hand menu. Then change the <strong>Environment</strong> filter <strong>(1)</strong> to the name of your workshop instance from the dropdown box, selecting <strong><code>&lt;INSTANCE>-workshop</code></strong> <strong>(1)</strong> (where <strong><code>INSTANCE</code></strong> is the value from the shell script you ran earlier). Make sure it is the only one selected.</p><p>Then change the <strong>App</strong> <strong>(2)</strong> dropdown box to the name of your app, it will be <strong><code>&lt;INSTANCE>-store</code></strong></p><p><a href=#R-image-0fecdebc19ef769c4c88ed665b98f093 class=lightbox-link><img alt="rum select" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-env-select.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0fecdebc19ef769c4c88ed665b98f093><img alt="rum select" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-env-select.png></a></p><p>Once you have selected your <strong>Environment</strong> and <strong>App</strong>, you will see an overview page showing the RUM status of your Application. (If your Summary Dashboard is just a single row of numbers, you are looking at the condensed view. You can expand it by clicking on the <strong>> (1)</strong> in front of the Application name). If any JavaScript errors occurred, they will show up as shown below:</p><p><a href=#R-image-824e70b9186de7ad4b4ceb77caa915b8 class=lightbox-link><img alt="rum overview" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-overview.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-824e70b9186de7ad4b4ceb77caa915b8><img alt="rum overview" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-overview.png></a></p><p>To continue, click on the blue link (with your workshop name) to get to the details page. This will bring up a new dashboard view breaking down the interactions by UX Metrics, Front-end Health, Back-end Health and Custom Events and comparing them to historic metrics (1 hour by default).</p><p><a href=#R-image-71f9728b34f62ca50768496445ecad0b class=lightbox-link><img alt="rum  main" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-main.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-71f9728b34f62ca50768496445ecad0b><img alt="rum  main" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-main.png></a>
Normally, you have only one line inside the first chart. Click on the link that relates to your Petclinic shop,
http://198.19.249.202:81 in our example:</p><p>This will bring us to the Tag Spotlight page.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=rum-trace-waterfall-view--linking-to-apm>RUM trace Waterfall view & linking to APM</h1><p>In the TAG Spotlight view, you are presented with all the tags associated with the RUM data. Tags are key-value pairs that are used to identify the data. In this case, the tags are automatically generated by the OpenTelemetry instrumentation. The tags are used to filter the data and to create the charts and tables. The Tag Spotlight view allows you detect trends in behavior and to drill down into a user session.</p><p><a href=#R-image-b2be255df37eda1c04179f449075b4d0 class=lightbox-link><img alt="RUM TAG" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-tag-spotlight.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b2be255df37eda1c04179f449075b4d0><img alt="RUM TAG" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-tag-spotlight.png></a></p><p>Click on User Sessions <strong>(1)</strong>, this will show you the list of user session that occurred during the time window.</p><p>We want to look at one of the session, so click on <em>Duration</em> <strong>(2)</strong> to sort on duration, and make sure you click on the link of one of the longer ones <strong>(3)</strong>:</p><p><a href=#R-image-3e7562bf07b56fc652b9956a05c84bbb class=lightbox-link><img alt="User sessions" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-user-sessions.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3e7562bf07b56fc652b9956a05c84bbb><img alt="User sessions" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-user-sessions.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=rum-trace-waterfall-view--linking-to-apm>RUM trace Waterfall view & linking to APM</h1><p>We are now looking at the RUM Trace waterfall, this will tell you what happened during the session on the user device as they visited the page of our petclinic application.</p><p>If you scroll down the waterfall find click on the <strong>#!/owners/details</strong> segment on the right <strong>(1)</strong>, you see a list of actions that occurred during the handling of the Vets request. Note, that the HTTP request have a blue <strong>APM</strong> link before the return code. Pick one, and click on the APM link. This will show you the APM info for this backend service call hosted in Kubernetes.</p><p><a href=#R-image-120d0117f2fd294193d155a8bb13b612 class=lightbox-link><img alt="rum apm link" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-120d0117f2fd294193d155a8bb13b612><img alt="rum apm link" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-trace.png></a></p><p>Note, if you want to drill down to verify what happened with the request, click on the Trace ID url.</p><p>This will show you the trace related to your request from RUM:</p><p><a href=#R-image-5f8e6066d22b384d156b7d035bab83cd class=lightbox-link><img alt="RUm-apm linked" class="lazy lightbox figure-image" loading=lazy src=../../images/rum-apm-waterfall.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5f8e6066d22b384d156b7d035bab83cd><img alt="RUm-apm linked" class="lazy lightbox lightbox-image" loading=lazy src=../../images/rum-apm-waterfall.png></a></p><p>You can see that the entry point into your service now has a <strong>RUM (1)</strong> related content link added, allowing you to return back to your RUM session after you validated what happened in your backend service.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=workshop-wrap-up->Workshop Wrap-up üéÅ</h1><p>Congratulations, you have completed the <strong>Get the Most Out of Your Existing Kubernetes Java Applications Using Automatic Discovery and Configuration With OpenTelemetry</strong> workshop.</p><p>Today, you have learned how easy it is to add Tracing, Code Profiling and Database Query Performance to your existing Java application in Kubernetes.</p><p>You immediately improved the observability of the application and infrastructure without touching a line of code or configuration using <strong>Automatic Discovery and Configuration</strong>.</p><p>You also learned that with simple configuration changes, you can add even more observability (<strong>logging</strong> and <strong>RUM</strong>) to the application in order to provide end-to-end observability.</p><p><a href=#R-image-752e478b59f745d37c096cc4d4349206 class=lightbox-link><img alt=Champagne class="lazy lightbox figure-image" loading=lazy src="/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/9-wrap-up/images/champagne.png?width=45vw" style=height:auto;width:45vw></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-752e478b59f745d37c096cc4d4349206><img alt=Champagne class="lazy lightbox lightbox-image" loading=lazy src="/observability-workshop/v5.99/en/ninja-workshops/1-automatic-discovery/2-petclinic-kubernetes/9-wrap-up/images/champagne.png?width=45vw"></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Mar 21, 2025</span></span></footer></article></section></section></div></main></div><script src=/observability-workshop/v5.99/js/clipboard/clipboard.min.js?1752058459 defer></script><script src=/observability-workshop/v5.99/js/perfect-scrollbar/perfect-scrollbar.min.js?1752058459 defer></script><script src=/observability-workshop/v5.99/js/theme.min.js?1752058459 defer></script></body></html>