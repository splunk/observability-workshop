<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.125.5"><meta name=generator content="Relearn 6.0.0+tip"><meta name=description content="Custom Attribution (Custom Tags) To take a deeper look at this issue and make this much easier to debug we will implement Custom Attributes via Opentelemetry Manual Instrumentation.
To speed up manual instrumentation in Java you can leverage OpenTelemetry Annotations, which automatically create a span around a method without modifying the actual code inside the method. This can be very valuable if you are working with an SRE that may have limited access to source code changes."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Custom Tags :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="Custom Attribution (Custom Tags) To take a deeper look at this issue and make this much easier to debug we will implement Custom Attributes via Opentelemetry Manual Instrumentation.
To speed up manual instrumentation in Java you can leverage OpenTelemetry Annotations, which automatically create a span around a method without modifying the actual code inside the method. This can be very valuable if you are working with an SRE that may have limited access to source code changes."><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.54/en/other/7-mttr-custom-tags/6-custom-tags/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Custom Tags :: Splunk Observability Cloud Workshops"><meta property="og:description" content="Custom Attribution (Custom Tags) To take a deeper look at this issue and make this much easier to debug we will implement Custom Attributes via Opentelemetry Manual Instrumentation.
To speed up manual instrumentation in Java you can leverage OpenTelemetry Annotations, which automatically create a span around a method without modifying the actual code inside the method. This can be very valuable if you are working with an SRE that may have limited access to source code changes."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="Ninja Workshops"><meta property="article:modified_time" content="2023-12-21T14:15:53+00:00"><meta itemprop=name content="Custom Tags :: Splunk Observability Cloud Workshops"><meta itemprop=description content="Custom Attribution (Custom Tags) To take a deeper look at this issue and make this much easier to debug we will implement Custom Attributes via Opentelemetry Manual Instrumentation.
To speed up manual instrumentation in Java you can leverage OpenTelemetry Annotations, which automatically create a span around a method without modifying the actual code inside the method. This can be very valuable if you are working with an SRE that may have limited access to source code changes."><meta itemprop=dateModified content="2023-12-21T14:15:53+00:00"><meta itemprop=wordCount content="529"><title>Custom Tags :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.54/en/other/7-mttr-custom-tags/6-custom-tags/index.html rel=canonical type=text/html title="Custom Tags :: Splunk Observability Cloud Workshops"><link href=../../../../images/favicon.ico?1715858742 rel=icon type=image/x-icon sizes=any><link href=../../../../css/fontawesome-all.min.css?1715858756 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/fontawesome-all.min.css?1715858756 rel=stylesheet></noscript><link href=../../../../css/nucleus.css?1715858756 rel=stylesheet><link href=../../../../css/auto-complete.css?1715858756 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/auto-complete.css?1715858756 rel=stylesheet></noscript><link href=../../../../css/perfect-scrollbar.min.css?1715858756 rel=stylesheet><link href=../../../../css/fonts.css?1715858756 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/fonts.css?1715858756 rel=stylesheet></noscript><link href=../../../../css/theme.css?1715858756 rel=stylesheet><link href=../../../../css/theme-splunk-light.css?1715858756 rel=stylesheet id=R-variant-style><link href=../../../../css/chroma-relearn-light.css?1715858756 rel=stylesheet id=R-variant-chroma-style><link href=../../../../css/variant.css?1715858756 rel=stylesheet><link href=../../../../css/print.css?1715858756 rel=stylesheet media=print><link href=../../../../css/format-print.css?1715858756 rel=stylesheet><script src=../../../../js/variant.js?1715858756></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.54",window.index_js_url="../../../../en/index.search.js",window.variants&&variants.init(["splunk-light","splunk-dark"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"eu0",rumAccessToken:"TR9BBfgYo7qJfqrfgqjoqA"})</script></script><style>:root{--MAIN-WIDTH-MAX:1000rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../../en/other/7-mttr-custom-tags/6-custom-tags/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../en/other/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../en/other/7-mttr-custom-tags/index.html><span itemprop=name>Improving MTTR w/ Custom Tags</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>6. Custom Tags</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../../../en/other/7-mttr-custom-tags/5-debugging101/index.html title="Debugging 101 (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../../../en/other/7-mttr-custom-tags/7-fixing-code/index.html title="Fixing Code (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=custom-tags>Custom Tags</h1><h2 id=custom-attribution-custom-tags>Custom Attribution (Custom Tags)</h2><p>To take a deeper look at this issue and make this much easier to debug we will implement Custom Attributes via Opentelemetry Manual Instrumentation.</p><p>To speed up manual instrumentation in Java you can leverage OpenTelemetry Annotations, which automatically create a span around a method without modifying the actual code inside the method. This can be very valuable if you are working with an SRE that may have limited access to source code changes.</p><p>To add even more information to help our developers find the root cause faster, OpenTelemetry Annotations can be used to generate span tags with parameter values for the method in question. This is incredibly important to mean time to Repair, because as a Developer, if I know the parameter values of a function at the time of latency or error, I can debug this without having to reproduce an issue in another environment if I have Full Fidelity Tracing.</p><p>Splunk Full Fidelity APM allows our customers development teams to debug their code as it ran in production, 100% of the time. Add with Custom Attribution, you are providing repeatable Mean Time to Repair reduction&mldr; 100% of the time, only with Full Fidelity tracing.</p><p>To expedite manual instrumentation implementation for this exercise, we have provided a tool which will annotate the entirety of the &ldquo;shop&rdquo; and &ldquo;products&rdquo; services with OpenTelemetry standard annotations for every function call without having to write any code. This &ldquo;annotator&rdquo; tool will also tag every parameter in every function, which adds a span tag with Parameter=Value.</p><ul><li>Run Manual Instrumentation Tool</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./AutomateManualInstrumentation.sh</span></span></code></pre></div><ul><li>Rebuild and Deploy the Application</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./BuildAndDeploy.sh</span></span></code></pre></div><h2 id=visualize-in-splunk-apm>Visualize in Splunk APM</h2><p>Now that we have rebuilt and deployed our application, traffic is being sent once again.</p><p>Go back to the Splunk Observability UI and let&rsquo;s see if these annotations help us narrow down the root cause more quickly.</p><p>Let&rsquo;s try to find our latency root cause again, this time with every function and every parameter spanned and tagged respectively&mldr;. You will see exactly what this means and how it benefits developers in a moment.</p><p><a href=#R-image-5cd5c309e86b9448f23562e5d4eefa2c class=lightbox-link><img alt=6-custom-tags-1-apm-map class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../en/other/7-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-1-apm-map.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5cd5c309e86b9448f23562e5d4eefa2c><img alt=6-custom-tags-1-apm-map class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../en/other/7-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-1-apm-map.png></a></p><ul><li>Click on shop service</li><li>Click Traces ( on the right side )</li><li>Sort by Duration</li><li>Select the longest duration trace ( or one of the obvious much longer ones )</li></ul><p><a href=#R-image-29a83471d46832bfe8a7dce360788b8b class=lightbox-link><img alt=6-custom-tags-2-trace class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../../../en/other/7-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-2-trace.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-29a83471d46832bfe8a7dce360788b8b><img alt=6-custom-tags-2-trace class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../../../en/other/7-mttr-custom-tags/6-custom-tags/../images/6-custom-tags-2-trace.png></a></p><p>We can see that the actual function call that has the latency was not <code>ProductResource.getAllProducts</code> but the function call <code>ProductResource.myCoolFunction234234234</code>.</p><p>Since we now have the parameter tagged as part of our span metadata the actual root cause is seemingly related to the &ldquo;location&rdquo; <strong>Colorado</strong>. And it appears the one custom attribute that was tagged for function <code>ProductResource.myCoolFunction234234234</code> was <code>myInt</code> with a value of <strong>999</strong>. With this information a developer can debug very quickly.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note</div><div class=box-content><p>We added additional span information, which we call <strong>Custom Attributes</strong> here at Splunk. In this case our <strong>Custom Attributes</strong> are <strong>Parameter Values at Time of Latency</strong>.</p></div></div><p>In our exmaple the <code>myInt</code> tag was created due our handy Annotator, that did the OpenTelemetry Annotations for us.</p><ul><li>Using nano:</li></ul><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nano products/src/main/java/com/shabushabu/javashop/products/resources/ProductResource.java</span></span></code></pre></div><ul><li>Search in Nano: <strong>[CTRL]-w</strong></li><li>Enter in: <strong>999 [Enter]</strong></li></ul><p>We can see here, someone wrote some very bad code in the form of a long Sleep!</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>999</span><span class=o>==</span><span class=n>myInt</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sleepy</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=n>5000</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>3000</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>3000</span><span class=p>);</span></span></span></code></pre></div><footer class=footline><span class="badge cstyle tip badge-with-title"><span class=badge-title class=text-muted>Last Modified By
</span><span class=badge-content>Robert Castley</span>
</span>&nbsp;
<span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted><i class="fa-fw fas fa-calendar"></i>
</span><span class=badge-content>Dec 21, 2023</span></span></footer></article></div></main></div><script src=../../../../js/clipboard.min.js?1715858756 defer></script><script src=../../../../js/perfect-scrollbar.min.js?1715858756 defer></script><script src=../../../../js/theme.js?1715858756 defer></script></body></html>