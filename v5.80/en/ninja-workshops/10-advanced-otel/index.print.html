<!doctype html><html lang=en dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=generator content="Relearn 7.2.1"><meta name=description content="In this workshop you will practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Advanced OpenTelemetry :: Splunk Observability Cloud Workshops"><meta name=twitter:description content="In this workshop you will practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's"><meta property="og:url" content="https://splunk.github.io/observability-workshop/v5.80/en/ninja-workshops/10-advanced-otel/index.html"><meta property="og:site_name" content="Splunk Observability Cloud Workshops"><meta property="og:title" content="Advanced OpenTelemetry :: Splunk Observability Cloud Workshops"><meta property="og:description" content="In this workshop you will practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Advanced OpenTelemetry :: Splunk Observability Cloud Workshops"><meta itemprop=description content="In this workshop you will practice setting up the OpenTelemetry Collector configuration from scratch and go though several advanced configuration scenarios's"><meta itemprop=dateModified content="2025-02-06T20:15:34+00:00"><meta itemprop=wordCount content="419"><title>Advanced OpenTelemetry :: Splunk Observability Cloud Workshops</title>
<link href=https://splunk.github.io/observability-workshop/v5.80/en/ninja-workshops/10-advanced-otel/index.html rel=canonical type=text/html title="Advanced OpenTelemetry :: Splunk Observability Cloud Workshops"><link href=/observability-workshop/v5.80/images/favicon.ico?1738950861 rel=icon type=image/x-icon sizes=any><link href=/observability-workshop/v5.80/css/fontawesome-all.min.css?1738950861 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.80/css/fontawesome-all.min.css?1738950861 rel=stylesheet></noscript><link href=/observability-workshop/v5.80/css/auto-complete.css?1738950861 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/observability-workshop/v5.80/css/auto-complete.css?1738950861 rel=stylesheet></noscript><link href=/observability-workshop/v5.80/css/perfect-scrollbar.min.css?1738950861 rel=stylesheet><link href=/observability-workshop/v5.80/css/theme.min.css?1738950861 rel=stylesheet><link href=/observability-workshop/v5.80/css/format-print.min.css?1738950861 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../../..",window.relearn.absBaseUri="https://splunk.github.io/observability-workshop/v5.80",window.relearn.min=`.min`,window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.themevariants=["auto","splunk-light","splunk-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}}))},window.relearn.markVariant=function(){var t=window.localStorage.getItem(window.relearn.absBaseUri+"/variant"),e=document.querySelector("#R-select-variant");e&&(e.value=t)},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant(),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web.js crossorigin=anonymous></script><script src=https://cdn.signalfx.com/o11y-gdi-rum/latest/splunk-otel-web-session-recorder.js crossorigin=anonymous></script><script>SplunkRum.init({realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA",applicationName:"observability-workshop",deploymentEnvironment:"splunk.github.io",version:"1.0"}),SplunkSessionRecorder.init({app:"observability-workshop",realm:"us1",rumAccessToken:"dp3FKraOS_wVhe-l7eCOsA"})</script></script><style>:root{--MAIN-WIDTH-MAX:130rem;--MENU-WIDTH-L:23rem}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/observability-workshop/v5.80/en/ninja-workshops/10-advanced-otel/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#workshop-overview>Workshop Overview</a></li><li><a href=#prerequisites>Prerequisites</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.80/en/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/observability-workshop/v5.80/en/ninja-workshops/index.html><span itemprop=name>Ninja Workshops</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Advanced OpenTelemetry</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.80/en/ninja-workshops/10-advanced-otel/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.80/en/ninja-workshops/9-solving-problems-with-o11y-cloud/6-summary/index.html title="Summary (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/observability-workshop/v5.80/en/ninja-workshops/10-advanced-otel/1-agent/index.html title="1. Agent Configuration (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable ninja-workshops" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=advanced-opentelemetry>Advanced OpenTelemetry</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>90 minutes</span>
</span>&nbsp;
<span class="badge cstyle blue badge-with-title"><span class=badge-title class=text-muted>Authors
</span><span class=badge-content>Robert Castley,
Charity Anderson
&
Pieter Hagen</span></span><p>The goal of this workshop is to help you become comfortable creating and modifying OpenTelemetry Collector configuration files. Youâ€™ll start with a minimal <code>agent.yaml</code> file and gradually configure several common advanced scenarios.</p><p>The workshop also explores how to configure the OpenTelemetry Collector to store telemetry data locally instead of transmitting it to a third-party vendor backend. Furthermore, this approach significantly enhances the debugging and troubleshooting process and is useful for testing and development environments where you donâ€™t want to send data to a production system.</p><p>To get the most out of this workshop, you should have a basic understanding of the OpenTelemetry Collector and its configuration file format. Additionally, proficiency in editing YAML files is required. The entire workshop is designed to run locally.</p><h3 id=workshop-overview>Workshop Overview</h3><p>During this workshop, we will cover the following topics:</p><ul><li><strong>Setting up the agent locally</strong>: Add metadata, and introduce the debug and file exporters.</li><li><strong>Configuring a gateway</strong>: Route traffic from the agent to the gateway.</li><li><strong>Configuring the Filelog receiver</strong>: Collect log data from various log files.</li><li><strong>Enhancing agent resilience</strong>: Basic configurations for fault tolerance.</li><li><strong>Configuring processors</strong>:<ul><li>Filter out noise by dropping specific spans (e.g., health checks).</li><li>Remove unnecessary tags, and handle sensitive data.</li><li>Transform data using OTTL in the pipeline before exporting.</li></ul></li><li><strong>Configuring Connectors</strong>: Route data to different endpoints based on the values received.</li></ul><p>By the end of this workshop, you&rsquo;ll be familiar with configuring the OpenTelemetry Collector for a variety of real-world use cases.</p><hr><h3 id=prerequisites>Prerequisites</h3><ul><li><strong>Create a directory</strong> on your machine for the workshop (e.g., <code>advanced-otel</code>). We will refer to this directory as <code>[WORKSHOP]</code> in the instructions.</li><li><strong>Download the latest OpenTelemetry Collector release</strong> for your platform and place it in the <code>[WORKSHOP]</code> directory:</li></ul><table><thead><tr><th style=text-align:left>Platform</th><th style=text-align:left>Binary URL</th></tr></thead><tbody><tr><td style=text-align:left>Apple Mac (Apple Silicon)</td><td style=text-align:left><strong><a href=https://github.com/signalfx/splunk-otel-collector/releases/download/v0.117.0/otelcol_darwin_arm64 rel=external target=_blank>otelcol_darwin_arm64</a></strong></td></tr><tr><td style=text-align:left>Apple Mac (Intel)</td><td style=text-align:left><strong><a href=https://github.com/signalfx/splunk-otel-collector/releases/download/v0.117.0/otelcol_darwin_amd64 rel=external target=_blank>otelcol_darwin_amd64</a></strong></td></tr><tr><td style=text-align:left>Windows AMD/64</td><td style=text-align:left><strong><a href=https://github.com/signalfx/splunk-otel-collector/releases/download/v0.117.0/otelcol_windows_amd64.exe rel=external target=_blank>otelcol_windows_amd64.exe</a></strong></td></tr><tr><td style=text-align:left>Linux (AMD/64)</td><td style=text-align:left><strong><a href=https://github.com/signalfx/splunk-otel-collector/releases/download/v0.117.0/otelcol_linux_amd64 rel=external target=_blank>otelcol_linux_amd64</a></strong></td></tr><tr><td style=text-align:left>Linux (ARM/64)</td><td style=text-align:left><strong><a href=https://github.com/signalfx/splunk-otel-collector/releases/download/v0.117.0/otelcol_linux_arm64 rel=external target=_blank>otelcol_linux_arm64</a></strong></td></tr></tbody></table><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Once downloaded, rename the file to <code>otelcol</code> (or <code>otelcol.exe</code> on Windows). On Mac and Linux, update the file permissions to make it executable:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod +x otelcol</span></span></code></pre></div><div class=tab-panel data-tab-group=78967991e5e538ba5248ac25e735fd38><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=initial-linuxmac-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("78967991e5e538ba5248ac25e735fd38","initial-linuxmac-directory-structure")'>
<span class=tab-nav-text>Initial Linux/Mac Directory Structure</span>
</button>
<button data-tab-item=initial-windows-directory-structure class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("78967991e5e538ba5248ac25e735fd38","initial-windows-directory-structure")'>
<span class=tab-nav-text>Initial Windows Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=initial-linuxmac-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol      # OpenTelemetry Collector binary</span></span></code></pre></div></div></div><div data-tab-item=initial-windows-directory-structure class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol.exe  # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>Mac users must trust the executable when running <code>otelcol</code> for the first time. For more details, refer to <a href=https://support.apple.com/en-mide/102445 rel=external target=_blank><strong>Apple&rsquo;s support page</strong></a>.</p></div></details><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Optional Tools</summary><div class=box-content><p>For this workshop, using a good YAML editor like <a href=https://code.visualstudio.com/download rel=external target=_blank><strong>Visual Studio Code</strong></a> will be beneficial.</p><p>Additionally, having access to <a href=https://jqlang.org/download/ rel=external target=_blank><strong>jq</strong></a> is recommended. This lightweight command-line tool helps process and format JSON data, making it easier to inspect traces, metrics, and logs from the OpenTelemetry Collector.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 6, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of Advanced OpenTelemetry</h1><article class=default><header class=headline></header><h1 id=1-agent-configuration>1. Agent Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>During this workshop, you will be using up to four terminal windows simultaneously. To stay organized, consider customizing each terminal or shell with unique names and colors. This will help you quickly identify and switch between them as needed.</p><p>We will refer to these terminals as: <strong>Agent</strong>, <strong>Gateway</strong>, <strong>Tests</strong> and <strong>Log-gen</strong>.</p></div></details><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In your <code>[WORKSHOP]</code> directory, create a subdirectory called <code>1-agent</code> and change into that directory.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>cd [WORKSHOP]
</span></span><span class=line><span class=cl>mkdir 1-agent
</span></span><span class=line><span class=cl>cd 1-agent</span></span></code></pre></div><p>In the <code>1-agent</code> directory, create a file named <code>agent.yaml</code>. This file will define the basic structure of an OpenTelemetry Collector configuration.</p><p>Copy and paste the following initial configuration into <code>agent.yaml</code>:</p><div class=tab-panel data-tab-group=8ea7795cf899ffb779fb194a5886b811><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agentyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8ea7795cf899ffb779fb194a5886b811","agentyaml")'>
<span class=tab-nav-text>agent.yaml</span></button></div><div class=tab-content-container><div data-tab-item=agentyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>###########################        This section holds all the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## Configuration section ##        configurations that can be </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################        used in this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>                       </span><span class=c># Array of Extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                   </span><span class=c># Configures the health check extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>13133</span><span class=w>       </span><span class=c># Endpoint to collect health check data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>                        </span><span class=c># Array of Receivers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hostmetrics</span><span class=p>:</span><span class=w>                    </span><span class=c># Receiver Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>collection_interval</span><span class=p>:</span><span class=w> </span><span class=l>3600s   </span><span class=w> </span><span class=c># Scrape metrics every hour</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>scrapers</span><span class=p>:</span><span class=w>                     </span><span class=c># Array of hostmetric scrapers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cpu</span><span class=p>:</span><span class=w>                        </span><span class=c># Scraper for cpu metrics</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>                        </span><span class=c># Array of Exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>                       </span><span class=c># Array of Processors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                 </span><span class=c># Limits memory usage by Collectors pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s           </span><span class=w> </span><span class=c># Interval to check memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         This section controls what</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>### Activation Section  ###         configurations will be used</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         by this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>                          </span><span class=c># Services configured for this Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w>                     </span><span class=c># Enabled extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>                      </span><span class=c># Array of configured pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=l>exporters:</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=dde900a425dd91c1770f07444a2680ad><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("dde900a425dd91c1770f07444a2680ad","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent         # Module directory
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ agent.yaml  # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol         # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1. Agent Setup</h1><article class=default><header class=headline></header><h1 id=11-agent-configuration>1.1 Agent Configuration</h1><p>Let&rsquo;s walk through a few modifications to our agent configuration to get things started:</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add an <code>otlp</code> receiver</strong>: The <a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/components/otlp-receiver.html rel=external target=_blank><strong>OTLP receiver</strong></a> will listen for incoming telemetry data over HTTP (or gRPC).</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                           </span><span class=c># Receiver Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>                    </span><span class=c># list of Protocols used </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                       </span><span class=c># This wil enable the HTTP Protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:4318&#34;</span><span class=w>  </span><span class=c># Endpoint for incoming telemetry data</span></span></span></code></pre></div><p><strong>Add a <code>debug</code> exporter</strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/exporter/debugexporter/README.md rel=external target=_blank><strong>Debug exporter</strong></a> will output detailed debug information for every telemetry record.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                          </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed          </span><span class=w> </span><span class=c># Enabled detailed debug output</span></span></span></code></pre></div><p><strong>Update Pipelines</strong>: Ensure that the <code>otlp</code> receiver, <code>memory_limiter</code> processor, and <code>debug</code> exporter are added to the pipelines for <code>traces</code>, <code>metrics</code>, and <code>logs</code>. You can choose to use the format below or use array brackets <code>[memory_limiter]</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter Processor  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span></span></span></code></pre></div></div></details><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Usage</summary><div class=box-content><p>During this workshop, we will use <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong> to quickly validate YAML syntax and ensure OpenTelemetry configurations are correct. This helps prevent errors before running tests during this workshop.</p><p>To validate your configuration:</p><ol><li>Open <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong> and replace the existing configuration by pasting your own YAML into the left pane.</li><li>At the top of the page, ensure that <strong>Splunk OpenTelemetry Collector</strong> is selected as the validation target.</li><li>Once validated, refer to the image representation below to verify if your pipelines are correctly set up.</li></ol><p>In most cases, we will display only the key pipeline. However, if all three pipelines (<strong>Traces</strong>, <strong>Metrics</strong>, and <strong>Logs</strong>) share the same structure, we will indicate this instead of displaying each one separately.</p></div></details><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces/Metrics/Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fff,stroke-width:1px, color:#fff,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=12-test-agent-configuration>1.2 Test Agent Configuration</h1><p>Once you&rsquo;ve updated the configuration, youâ€™re ready to proceed to running the OpenTelemetry Collector with your new setup. This exercise sets the foundation for understanding how data flows through the OpenTelemetry Collector.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Find your Agent terminal window</strong>:</p><ol><li>Change into the <code>[WORKSHOP]/1-agent</code> folder</li><li>Run the following command:</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p>In this workshop, we use <strong>macOS/Linux</strong> commands by default. If youâ€™re using Windows, adjust the commands as needed i.e. use <code>./otelcol.exe</code>.</p></div></details><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>On Windows, a dialog box may appear asking if you want to grant public and private network access to <code>otelcol.exe</code>. Click <strong>&ldquo;Allow&rdquo;</strong> to proceed.</p></div></details><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Verify debug output</strong>: If everything is set up correctly, the first and last lines of the output should display:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025/01/13T12:43:51 settings.go:478: Set config to [agent.yaml]
</span></span><span class=line><span class=cl>&lt;snip to the end&gt;
</span></span><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.117.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p><strong>Create a test span file</strong>:
Instead of instrumenting an application, we will simulate sending trace data to the OpenTelemetry Collector using <code>cURL</code>. The trace data, formatted in JSON, represents what an instrumentation library would typically generate and send.</p><ol><li>Find your <strong>Tests</strong> Terminal window and change into the <code>[WORKSHOP]/1-agent</code> directory.</li><li>Copy and paste the following <strong>span</strong> data into a new file named <code>trace.json</code>:</li></ol><p>This file will allow us to test how the OpenTelemetry Collector processes and send <strong>spans</strong> that are part of a trace, without requiring actual application instrumentation.</p><div class=tab-panel data-tab-group=d26d7b750e9bd4d3284d5f19b4159188><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=tracejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d26d7b750e9bd4d3284d5f19b4159188","tracejson")'>
<span class=tab-nav-text>trace.json</span></button></div><div class=tab-content-container><div data-tab-item=tracejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;George Lucas&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;+1555-867-5309&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.email&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;george@deathstar.email&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.visa&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;4111 1111 1111 1111&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.amex&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;3782 822463 10005&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;5555 5555 5555 4444&#34;</span><span class=p>}}]}]}]}]}</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=9ee7ad2475893e3d59350d3d9e16ded4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9ee7ad2475893e3d59350d3d9e16ded4","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent         # Module directory
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ agent.yaml  # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json  # Sample trace data
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol         # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div><p><strong>Send a test span</strong>: Run the following command to send a <strong>span</strong> to the agent:</p><div class=tab-panel data-tab-group=7fcbd72013a6d9be86237866f5019865><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7fcbd72013a6d9be86237866f5019865","curl-command")'>
<span class=tab-nav-text>cURL Command</span>
</button>
<button data-tab-item=curl-response class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("7fcbd72013a6d9be86237866f5019865","curl-response")'>
<span class=tab-nav-text>cURL Response</span></button></div><div class=tab-content-container><div data-tab-item=curl-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl> curl -X POST -i http://localhost:4318/v1/traces -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s2>&#34;@trace.json&#34;</span></span></span></code></pre></div></div></div><div data-tab-item=curl-response class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>HTTP/1.1 200 OK
</span></span><span class=line><span class=cl>Content-Type: application/json
</span></span><span class=line><span class=cl>Date: Mon, 27 Jan 2025 09:51:02 GMT
</span></span><span class=line><span class=cl>Content-Length: 21
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{&#34;partialSuccess&#34;:{}}%</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices info"><summary class=box-label><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><ol><li><code>HTTP/1.1 200 OK</code>: Confirms the request was processed successfully.</li><li><code>{"partialSuccess":{}}</code>: Indicates 100% success, as the field is empty. In case of a partial failure, this field will include details about any failed parts.</li></ol></div></details></div></details><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>On Windows, you may encounter the following error:</p><span style=color:red;font-family:monospace;font-weight:700>Invoke-WebRequest : Cannot bind parameter &lsquo;Headers&rsquo;. Cannot convert the &ldquo;Content-Type: application/json&rdquo; &mldr;</span><p>To resolve this, use <code>curl.exe</code> instead of just <code>curl</code>.</p></div></details><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Verify Debug Output</strong>:</p><ol><li>Find the <strong>Agent</strong> terminal window and check the collector&rsquo;s debug output. You should see the Debug entries related to the span you just sent.</li><li>We are showing the first and last lines of the debug log for that span. To get the full context, Use the <strong>Complete Debug Output</strong> Button to review.</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-02-03T12:46:25.675+0100    info ResourceSpans #0
</span></span><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>        {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-scroll"></i></span><span class=badge-content>Complete Debug Output</span></span></summary><div class=box-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-02-03T12:46:25.675+0100    info ResourceSpans #0  
</span></span><span class=line><span class=cl>Resource SchemaURL:
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; service.name: Str(my.service)
</span></span><span class=line><span class=cl>     -&gt; deployment.environment: Str(my.environment)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope my.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>     -&gt; my.scope.attribute: Str(some scope attribute)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>    Trace ID       : 5b8efff798038103d269b633813fc60c
</span></span><span class=line><span class=cl>    Parent ID      : eee19b7ec3c1b173
</span></span><span class=line><span class=cl>    ID             : eee19b7ec3c1b174
</span></span><span class=line><span class=cl>    Name           : I&#39;m a server span
</span></span><span class=line><span class=cl>    Kind           : Server
</span></span><span class=line><span class=cl>    Start time     : 2018-12-13 14:51:00 +0000 UTC
</span></span><span class=line><span class=cl>    End time       : 2018-12-13 14:51:01 +0000 UTC
</span></span><span class=line><span class=cl>    Status code    : Unset
</span></span><span class=line><span class=cl>    Status message :
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>        {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=13-file-exporter>1.3 File Exporter</h1><p>To capture more than just debug output on the screen, we also want to generate output during the export phase of the pipeline. For this, we&rsquo;ll add a <strong>File Exporter</strong> to write OTLP data to files for comparison. The difference between the OpenTelemetry <strong>debug exporter</strong> and the <strong>file exporter</strong> lies in their purpose and output destination:</p><table><thead><tr><th style=text-align:left>Feature</th><th style=text-align:left>Debug Exporter</th><th style=text-align:left>File Exporter</th></tr></thead><tbody><tr><td style=text-align:left><strong>Output Location</strong></td><td style=text-align:left>Console/Log</td><td style=text-align:left>File on disk</td></tr><tr><td style=text-align:left><strong>Purpose</strong></td><td style=text-align:left>Real-time debugging</td><td style=text-align:left>Persistent offline analysis</td></tr><tr><td style=text-align:left><strong>Best for</strong></td><td style=text-align:left>Quick inspection during testing</td><td style=text-align:left>Temporary storage and sharing</td></tr><tr><td style=text-align:left><strong>Production Use</strong></td><td style=text-align:left>No</td><td style=text-align:left>Rare, but possible</td></tr><tr><td style=text-align:left><strong>Persistence</strong></td><td style=text-align:left>No</td><td style=text-align:left>Yes</td></tr></tbody></table><p>In summary, the <strong>Debug Exporter</strong> is great for real-time, in-development troubleshooting, while the <strong>File Exporter</strong> is better suited for storing telemetry data locally for later use.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Find your <strong>Agent</strong> terminal window, and stop the running collector by pressing <code>Ctrl-C</code>. Once the <strong>Agent</strong> has stopped, open the <code>agent.yaml</code> and configure the <strong>File Exporter</strong>:</p><ol><li><p><strong>Configuring a <code>file</code> exporter</strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/exporter/fileexporter/README.md rel=external target=_blank><strong>File Exporter</strong></a> writes telemetry data to files on disk.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file</span><span class=p>:</span><span class=w>                           </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./agent.out&#34;</span><span class=w>           </span><span class=c># Save path (OTLP JSON)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span></span></span></code></pre></div></li><li><p><strong>Update the Pipelines Section</strong>: Add the <code>file</code> exporter to the <code>metrics</code>, <code>traces</code> and <code>logs</code> pipelines (leave debug as the first in the array).</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file                     </span><span class=w> </span><span class=c># File Exporter</span></span></span></code></pre></div></li></ol></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>:</p><pre class="mermaid align-center">flowchart LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;file&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces/Metrics/Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; EXP1
      PRO1 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fff,stroke-width:1px, color:#fff,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1.3. File Exporter</h1><article class=default><header class=headline></header><h1 id=131-test-file-exporter>1.3.1 Test File Exporter</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Restart your agent</strong>: Find your <strong>Agent</strong> terminal window, and (re)start the agent, this time with your new config to test it:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p>Again, if you have done everything correctly, the last line of the output should be:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.116.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p><strong>Send a Trace</strong>:</p><ol><li>From the <strong>Test</strong> terminal window send another span.</li><li>Verify you get the same output on the console as we saw previously:</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -X POST -i http://localhost:4318/v1/traces -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s2>&#34;@trace.json&#34;</span></span></span></code></pre></div><p><strong>Verify that the <code>agent.out</code> file is written</strong>: Check that a file named <code>agent.out</code> is written in the current directory.</p><div class=tab-panel data-tab-group=74dadd0e8af0108dd2aaf7cae896f7df><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("74dadd0e8af0108dd2aaf7cae896f7df","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent         # Module directory
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ agent.out   # OTLP/Json output created by the File Exporter
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ agent.yaml  # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json  # Sample trace data
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol         # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>On <strong>Windows</strong>, an open file may appear empty or cause issues when attempting to read it. To prevent this, make sure to stop the <strong>Agent</strong> or the <strong>Gateway</strong> before inspecting the file, as instructed.</p></div></details><p><strong>Verify the span format</strong>:</p><ol><li>Check the Format that The File Exporter has used to write the span to the <code>agent.out</code>.</li><li>It should be a single line in OTLP/JSON format.</li><li>Since no modifications have been made to the pipeline yet, this file should be identical to <code>trace.json</code>.</li></ol><div class=tab-panel data-tab-group=081d108a42b8759557832a5fb711e809><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-agentout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("081d108a42b8759557832a5fb711e809","cat-agentout")'>
<span class=tab-nav-text>cat ./agent.out</span>
</button>
<button data-tab-item=cat-agentout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("081d108a42b8759557832a5fb711e809","cat-agentout--jq")'>
<span class=tab-nav-text>cat ./agent.out | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-agentout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;George Lucas&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;+1555-867-5309&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.email&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;george@deathstar.email&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.visa&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;4111 1111 1111 1111&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.amex&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;3782 822463 10005&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;5555 5555 5555 4444&#34;</span><span class=p>}}]}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-agentout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.service&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.environment&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;+1555-867-5309&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;george@deathstar.email&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;4111 1111 1111 1111&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;5555 5555 5555 4444&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you want to view the fileâ€™s content, simply run:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cat agent.out</span></span></code></pre></div><p>For a formatted JSON output, you can use the same command but pipe it through <strong>jq</strong> (if installed):</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ./agent.out <span class=p>|</span> jq</span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=14-resource-metadata>1.4 Resource Metadata</h1><p>So far, we&rsquo;ve simply exported an exact copy of the span sent through the OpenTelemetry Collector.</p><p>Now, let&rsquo;s improve the base span by adding metadata with processors. This extra information can be helpful for troubleshooting and correlation.</p><p>Find your <strong>Agent</strong> terminal window, and stop the running collector by pressing <code>Ctrl-C</code>. Once the <strong>Agent</strong> has stopped, open the <code>agent.yaml</code> and configure the <code>resourcedetection</code> and <code>resource</code> processors:</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add the <code>resourcedetection</code> Processor</strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/resourcedetectionprocessor/README.md rel=external target=_blank><strong>Resource Detection Processor</strong></a> can be used to detect resource information from the host and append or override the resource value in telemetry data with this information.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>resourcedetection</span><span class=p>:</span><span class=w>              </span><span class=c># Processor Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>detectors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>system]          </span><span class=w> </span><span class=c># Detect system resource information</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>override</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>                </span><span class=c># Overwrites existing attributes</span></span></span></code></pre></div><p><strong>Add <code>resource</code> Processor and name it <code>add_mode</code></strong>: The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/resourceprocessor/README.md rel=external target=_blank><strong>Resource Processor</strong></a> can be used to apply changes on resource attributes.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>              </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>                   </span><span class=c># Array of attributes and modifications</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>insert             </span><span class=w> </span><span class=c># Action is to insert a key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode  </span><span class=w> </span><span class=c># Key name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;agent&#34;</span><span class=w>              </span><span class=c># Key value</span></span></span></code></pre></div><p><strong>Update All Pipelines</strong>: Add both processors (<code>resourcedetection</code> and <code>resource/add_mode</code>) to the <code>processors</code> array in <strong>all pipelines</strong> (traces, metrics, and logs). Ensure <code>memory_limiter</code> remains the first processor.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection        </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file                     </span><span class=w> </span><span class=c># File Exporter</span></span></span></code></pre></div></div></details><p>By adding these processors, we enrich the data with system metadata and the agentâ€™s operational mode, which aids in troubleshooting and provides useful context for related content.</p><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;file&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces/Metrics/Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; EXP1
      PRO3 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fff,stroke-width:1px, color:#fff,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 1.4 Resource Metadata</h1><article class=default><header class=headline></header><h1 id=141-test-resource-metadata>1.4.1 Test Resource Metadata</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Restart your Agent</strong>: Find your <strong>Agent</strong> terminal window, and restart your collector using the updated configuration to test the changes:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p>If everything is set up correctly, the last line of the output should confirm the collector is running:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>  2025-01-13T12:43:51.747+0100 info service@v0.116.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p><strong>Send a Trace</strong>: From the <strong>Tests</strong> terminal window, send a trace again with the <code>cURL</code> command to create a new <code>agent.out</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=nb>curl </span><span class=n>-X</span> <span class=n>POST</span> <span class=n>-i</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>localhost</span><span class=err>:</span><span class=mf>4318</span><span class=p>/</span><span class=n>v1</span><span class=p>/</span><span class=n>traces</span> <span class=n>-H</span> <span class=s2>&#34;Content-Type: application/json&#34;</span> <span class=n>-d</span> <span class=s2>&#34;@trace.json&#34;</span></span></span></code></pre></div><p><strong>Check the Agentâ€™s debug output</strong>: You should see three new lines in the <code>resource attributes</code> section: (<code>host.name</code>, <code>os.type</code> & <code>otelcol.service.mode</code>):</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>    -&gt; service.name: Str(my.service)
</span></span><span class=line><span class=cl>    -&gt; deployment.environment: Str(my.environment)
</span></span><span class=line><span class=cl>    -&gt; host.name: Str([MY_HOST_NAME])
</span></span><span class=line><span class=cl>    -&gt; os.type: Str([MY_OS])
</span></span><span class=line><span class=cl>    -&gt; otelcol.service.mode: Str(agent)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div><p><strong>Verify <code>agent.out</code></strong>: Validate the <code>agent.out</code> file contains the updated data:</p><div class=tab-panel data-tab-group=e14df5b0c6c259625ad5ee7d8d549b2c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e14df5b0c6c259625ad5ee7d8d549b2c","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>  [WORKSHOP]
</span></span><span class=line><span class=cl>  â”œâ”€â”€ 1-agent         # Module directory
</span></span><span class=line><span class=cl>  â”‚Â Â  â””â”€â”€ agent.out   # OTLP/Json output created by the File Exporter
</span></span><span class=line><span class=cl>  â”‚Â Â  â””â”€â”€ agent.yaml  # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>  â”‚Â Â  â””â”€â”€ trace.json  # Sample trace data
</span></span><span class=line><span class=cl>  â””â”€â”€ otelcol         # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div><p><strong>Verify that metadata is added to spans in the new <code>agent.out</code> file</strong>:</p><ol><li>Check for the existence of the<code>otelcol.service.mode</code> attribute in the <code>resourceSpans</code> section and that it has a value of <code>agent</code>.</li><li>Verify that the <code>resourcedetection</code> attributes (<code>host.name</code> and <code>os.type</code>) exist too.</li></ol><p>These values are automatically added based on your device by the processors configured in the pipeline.</p><div class=tab-panel data-tab-group=7fd5fd648b0bb57e892fd99ce3202209><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-agentout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7fd5fd648b0bb57e892fd99ce3202209","cat-agentout")'>
<span class=tab-nav-text>cat ./agent.out</span>
</button>
<button data-tab-item=cat-agentout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("7fd5fd648b0bb57e892fd99ce3202209","cat-agentout--jq")'>
<span class=tab-nav-text>cat ./agent.out | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-agentout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;George Lucas&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;+1555-867-5309&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.email&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;george@deathstar.email&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;LOTR\u003eStarWars1-2-3&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.visa&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;4111 1111 1111 1111&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.amex&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;3782 822463 10005&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;5555 5555 5555 4444&#34;</span><span class=p>}}],</span><span class=nt>&#34;status&#34;</span><span class=p>:{}}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-agentout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.service&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.environment&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;+1555-867-5309&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;george@deathstar.email&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;4111 1111 1111 1111&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;5555 5555 5555 4444&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><p>Stop the <strong>Agent</strong> process by pressing <code>Ctrl-C</code> in the terminal window.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section></section><article class=default><header class=headline></header><h1 id=2-gateway-configuration>2. Gateway Configuration</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>2-gateway</code>.</li><li>Next, copy all contents from the <code>1-agent</code> directory into <code>2-gateway</code>.</li><li>After copying, remove <code>agent.out</code>.</li><li>Create a file called <code>gateway.yaml</code> and add the following initial configuration:</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/2-gateway</code> directory.</li></ul><div class=tab-panel data-tab-group=ffc4c2dfdde397dcadbc1170b4789a72><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gatewayyaml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ffc4c2dfdde397dcadbc1170b4789a72","gatewayyaml")'>
<span class=tab-nav-text>gateway.yaml</span></button></div><div class=tab-content-container><div data-tab-item=gatewayyaml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>###########################         This section holds all the</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## Configuration section ##         configurations that can be </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         used in this OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extensions</span><span class=p>:</span><span class=w>                       </span><span class=c># Array of Extensions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>health_check</span><span class=p>:</span><span class=w>                   </span><span class=c># Configures the health check extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>14133</span><span class=w>       </span><span class=c># Port changed to prevent conflict with agent!!!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>                           </span><span class=c># Receiver Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>                    </span><span class=c># list of Protocols used</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>                       </span><span class=c># This wil enable the HTTP Protocol</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;0.0.0.0:5318&#34;</span><span class=w>  </span><span class=c># Port changed to prevent conflict with agent!!!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>    </span><span class=c># Needed for token pass through mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>exporters</span><span class=p>:</span><span class=w>                        </span><span class=c># Array of Exporters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>debug</span><span class=p>:</span><span class=w>                          </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbosity</span><span class=p>:</span><span class=w> </span><span class=l>detailed          </span><span class=w> </span><span class=c># Enabled detailed debug output</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>processors</span><span class=p>:</span><span class=w>                       </span><span class=c># Array of Processors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memory_limiter</span><span class=p>:</span><span class=w>                 </span><span class=c># Limits memory usage by Collectors pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>check_interval</span><span class=p>:</span><span class=w> </span><span class=l>2s           </span><span class=w> </span><span class=c># Interval to check memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>limit_mib</span><span class=p>:</span><span class=w> </span><span class=m>512</span><span class=w>                </span><span class=c># Memory limit in MiB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>                          </span><span class=c># Processor to Batch data before sending</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w>                </span><span class=c># Include token in batches</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>X-SF-Token                 </span><span class=w> </span><span class=c># Batch data grouped by Token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource/add_mode</span><span class=p>:</span><span class=w>              </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>attributes</span><span class=p>:</span><span class=w>                   </span><span class=c># Array of Attributes and modifications</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>upsert             </span><span class=w> </span><span class=c># Action taken is to `insert&#39; or &#39;update&#39; a key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>otelcol.service.mode  </span><span class=w> </span><span class=c># key Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;gateway&#34;</span><span class=w>            </span><span class=c># Key Value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         This section controls what</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>### Activation Section  ###         configuration  will be used</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>###########################         by the OpenTelemetry Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>                          </span><span class=c># Services configured for this Collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>health_check]     </span><span class=w> </span><span class=c># Enabled extensions for this collector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>                      </span><span class=c># Array of configured pipelines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Add metadata about collector mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Batch Processor, groups data before send                     </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Add metadata about collector mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Batch Processor, groups data before send                     </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Add metadata about collector mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Batch Processor, groups data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span></span></span></code></pre></div></div></div></div></div></div></details><div class=tab-panel data-tab-group=fd77ec86735efc3b4ff0607a5e32ae2c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("fd77ec86735efc3b4ff0607a5e32ae2c","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[WORKSHOP]
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent             # Module directory
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway           # Module directory
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ agent.yaml      # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ gateway.yaml    # OpenTelemetry Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json      # Sample trace data
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol             # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 2. Gateway Setup</h1><article class=default><header class=headline></header><h1 id=21-test-gateway>2.1 Test Gateway</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>In this section, we will extend the <code>gateway.yaml</code> configuration you just created to separate metric, traces & logs into different files.</p><p><strong>Create a <code>file</code> exporter and name it <code>traces</code></strong>: Separate exporters need to be configured for traces, metrics, and logs. Below is the YAML configuration for traces:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces.out&#34;</span><span class=w>  </span><span class=c># Path where data will be saved in OTLP json format</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                 </span><span class=c># Overwrite the file each time</span></span></span></code></pre></div><p><strong>Create additional exporters for <code>metrics</code> and <code>logs</code></strong>: Follow the example above, and set appropriate exporter names. Update the file paths to <code>./gateway-metrics.out</code> for <code>metrics</code> and <code>./gateway-logs.out</code> for <code>logs</code>.</p><p><strong>Add exporters to each pipeline</strong>: Ensure that each pipeline includes its corresponding <code>file</code> exporter, placing it after the <code>debug</code> exporter.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Groups Data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/logs                </span><span class=w> </span><span class=c># File Exporter for logs</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>logs:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO3(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;file&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt;logs):::exporter
      EXP2(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; EXP2
      PRO3 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>:</p><ol><li>Find your <strong>Gateway</strong> terminal window.</li><li>Navigate to the<code>[WORKSHOP]/2-gateway</code> directory.</li><li>Run the following command to test the gateway configuration:</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>../otelcol --config=gateway.yaml</span></span></code></pre></div><p>If everything is set up correctly, the first and last lines of the output should look like:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025/01/15 15:33:53 settings.go:478: Set config to [gateway.yaml]
</span></span><span class=line><span class=cl>&lt;snip to the end&gt;
</span></span><span class=line><span class=cl>2025-01-13T12:43:51.747+0100 info service@v0.116.0/service.go:261 Everything is ready. Begin running and processing data.</span></span></code></pre></div></div></details><p>Next, we will configure the <strong>Agent</strong> to send data to the newly created <strong>Gateway</strong>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=22-configure-agent>2.2 Configure Agent</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Update <code>agent.yaml</code></strong>:</p><ol><li>Switch to your <strong>Agent</strong> terminal window.</li><li>Make sure you are in the <code>[WORKSHOP]/2-gateway</code> directory.</li><li>Open the <code>agent.yaml</code> file that you copied earlier in your editor.</li></ol><p><strong>Add the <code>otlphttp</code> exporter</strong>:</p><ol><li>The <a href=https://docs.splunk.com/observability/en/gdi/opentelemetry/components/otlphttp-exporter.html rel=external target=_blank><strong>OTLP/HTTP Exporter</strong></a> is used to send data from the agent to the gateway using the OTLP/HTTP protocol. This is now the preferred method for exporting data to Splunk Observability Cloud (more details in Section 2.4 Addendum).</li><li>Ensure the <code>endpoint</code> is set to the gateway endpoint and port number.</li><li>Add the <code>X-SF-Token</code> header with a random value. During this workshop, you can use <strong>any</strong> value for <code>X-SF-TOKEN</code>. However, if you are connecting to Splunk Observability Cloud, this is where you will need to enter your Splunk Access Token (more details in Section 2.4 Addendum).</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                       </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w> </span><span class=c># Gateway OTLP endpoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>                      </span><span class=c># Headers to add to the HTTPcall </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ACCESS_TOKEN&#34;</span><span class=w>  </span><span class=c># Splunk ACCESS_TOKEN header</span></span></span></code></pre></div><p><strong>Add a Batch Processor configuration</strong>: Use the <a href=https://github.com/open-telemetry/opentelemetry-collector/blob/main/processor/batchprocessor/README.md rel=external target=_blank><strong>Batch Processor</strong></a>. It will accept spans, metrics, or logs and places them into batches. Batching helps better compress the data and reduce the number of outgoing connections required to transmit the data. It is highly recommended configuring the batch processor on every collector.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>                          </span><span class=c># Processor Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>X-SF-Token]  </span><span class=w> </span><span class=c># Array of metadata keys to batch </span></span></span></code></pre></div><p><strong>Update the pipelines</strong>:</p><ol><li>Add <code>hostmetrics</code> to the <code>metrics</code> pipeline. The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/hostmetricsreceiver#readme rel=external target=_blank><strong>HostMetrics Receiver</strong></a> will generate host metrics.</li><li>Add the <code>batch</code> processor after the <code>memory_limiter</code> in all pipelines.</li><li>Replace the <code>file:</code> exporter in all pipelines. Add the <code>otlphttp</code> exporter in the <code>traces</code>, <code>metrics</code>, and <code>logs</code> pipelines instead.</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp                       </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>hostmetrics                </span><span class=w> </span><span class=c># Hostmetrics Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>memory_limiter             </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resourcedetection          </span><span class=w> </span><span class=c># System attributes metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>resource/add_mode          </span><span class=w> </span><span class=c># Collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>batch                      </span><span class=w> </span><span class=c># Batch Processor, groups data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>debug                      </span><span class=w> </span><span class=c># Debug Exporter </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlphttp                   </span><span class=w> </span><span class=c># OTLP/HTTP Exporter</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>metrics:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      REC2(hostmetrics&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-metrics
    subgraph &#34; &#34;
      subgraph subID1[**Metrics**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; EXP2
      PRO4 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-metrics stroke:#38bdf8,stroke-width:1px, color:#38bdf8,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=23-sending-data-from-the-agent-to-the-gateway>2.3 Sending data from the Agent to the Gateway</h1><p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Verify the <code>gateway</code> is still running</strong>: Check your <strong>Gateway</strong> terminal window and make sure the <strong>Gateway</strong> collector is running.</p><p><strong>Start the Agent</strong>: In the <strong>Agent</strong> terminal window start the agent with the updated configuration:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>../otelcol --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p><strong>Verify CPU Metrics</strong>:</p><ol><li>Check that when the <strong>Agent</strong> starts, it immediately starts sending <strong>CPU</strong> metrics.</li><li>Both the <strong>Agent</strong> and the <strong>Gateway</strong> will display this activity in their debug output. The output should resemble the following snippet:</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>NumberDataPoints #37
</span></span><span class=line><span class=cl>Data point attributes:
</span></span><span class=line><span class=cl>    -&gt; cpu: Str(cpu9)
</span></span><span class=line><span class=cl>    -&gt; state: Str(system)
</span></span><span class=line><span class=cl>StartTimestamp: 2024-12-09 14:18:28 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 2025-01-15 15:27:51.319526 +0000 UTC
</span></span><span class=line><span class=cl>Value: 9637.660000</span></span></code></pre></div><p>At this stage, the <strong>Agent</strong> continues to collect <strong>CPU</strong> metrics once per hour or upon each restart and sends them to the gateway. The <strong>OpenTelemetry Collector</strong>, running in <strong>Gateway</strong> mode, processes these metrics and exports them to a file named <code>./gateway-metrics.out</code>. This file stores the exported metrics as part of the pipeline service.</p><p><strong>Verify Data arrived at Gateway</strong>:</p><ol><li>Open the newly created <code>gateway-metrics.out</code> file.</li><li>Check that it contains <strong>CPU</strong> metrics.</li><li>The Metrics should include details similar to those shown below (We&rsquo;re only displaying the <code>resourceMetrics</code> section and the first set of <strong>CPU</strong> metrics â€” You will likely see more):</li></ol><div class=tab-panel data-tab-group=6fe9c18d2bc28f6e674fa2e2b1cc9d28><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-gateway-metricsout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6fe9c18d2bc28f6e674fa2e2b1cc9d28","cat-gateway-metricsout")'>
<span class=tab-nav-text>cat <code>./gateway-metrics.out</code></span>
</button>
<button data-tab-item=cat-gateway-metricsout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("6fe9c18d2bc28f6e674fa2e2b1cc9d28","cat-gateway-metricsout--jq")'>
<span class=tab-nav-text>cat <code>./gateway-metrics.out</code> | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-gateway-metricsout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceMetrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_HOST_NAME&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;YOUR_OS&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;gateway&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeMetrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver/internal/scraper/cpuscraper&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;v0.116.0&#34;</span><span class=p>},</span><span class=nt>&#34;metrics&#34;</span><span class=p>:[{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;system.cpu.time&#34;</span><span class=p>,</span><span class=nt>&#34;description&#34;</span><span class=p>:</span><span class=s2>&#34;Total seconds each logical CPU spent on each mode.&#34;</span><span class=p>,</span><span class=nt>&#34;unit&#34;</span><span class=p>:</span><span class=s2>&#34;s&#34;</span><span class=p>,</span><span class=nt>&#34;sum&#34;</span><span class=p>:{</span><span class=nt>&#34;dataPoints&#34;</span><span class=p>:[{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;cpu&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;cpu0&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;state&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;user&#34;</span><span class=p>}}],</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span><span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span><span class=nt>&#34;asDouble&#34;</span><span class=p>:</span><span class=mf>1168005.59</span><span class=p>}]}}]}]}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-gateway-metricsout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceMetrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_HOST_NAME&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_OS&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;gateway&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeMetrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;github.com/open-telemetry/opentelemetry-collector-contrib/receiver/hostmetricsreceiver/internal/scraper/cpuscraper&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;v0.116.0&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;metrics&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;system.cpu.time&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Total seconds each logical CPU spent on each mode.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;unit&#34;</span><span class=p>:</span> <span class=s2>&#34;s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;sum&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;dataPoints&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                  <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;cpu0&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>},</span>
</span></span><span class=line><span class=cl>                      <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;state&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                          <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                      <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1733753908000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;timeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737133726158376000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;asDouble&#34;</span><span class=p>:</span> <span class=mf>1168005.59</span>
</span></span><span class=line><span class=cl>                  <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>]</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p><strong>Validate both collectors are running</strong>:</p><ol><li>Find the <strong>Agent</strong> terminal window. If the <strong>Agent</strong> is stopped, restart it.</li><li>Find the <strong>Gateway</strong> terminal window. Check if the <strong>Gateway</strong> is running, otherwise restart it.</li></ol><p><strong>Send a Test Trace</strong>:</p><ol><li>Find your <strong>Tests</strong> terminal window</li><li>Navigate it to the <code>[WORKSHOP]/2-gateway</code> directory.</li><li>Ensure that you have copied <code>trace.json</code> to the <code>2-gateway</code> directory.</li><li>Run the <code>cURL</code> command to send the span.</li></ol><p>Below, we show the first and last lines of the debug output. Use the <strong>Complete Debug Output</strong> button below to verify that both the <strong>Agent</strong> and <strong>Gateway</strong> produced similar debug output.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-02-05T15:55:18.966+0100    info    Traces  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>      {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-scroll"></i></span><span class=badge-content>Complete Debug Output</span></span></summary><div class=box-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>        {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;metrics&#34;, &#34;name&#34;: &#34;debug&#34;}
</span></span><span class=line><span class=cl>2025-02-05T15:55:18.966+0100    info    Traces  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 1, &#34;spans&#34;: 1}
</span></span><span class=line><span class=cl>2025-02-05T15:55:18.966+0100    info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; service.name: Str(my.service)
</span></span><span class=line><span class=cl>     -&gt; deployment.environment: Str(my.environment)
</span></span><span class=line><span class=cl>     -&gt; host.name: Str(PH-Windows-Box.hagen-ict.nl)
</span></span><span class=line><span class=cl>     -&gt; os.type: Str(windows)
</span></span><span class=line><span class=cl>     -&gt; otelcol.service.mode: Str(agent)
</span></span><span class=line><span class=cl>ScopeSpans #0
</span></span><span class=line><span class=cl>ScopeSpans SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope my.library 1.0.0
</span></span><span class=line><span class=cl>InstrumentationScope attributes:
</span></span><span class=line><span class=cl>     -&gt; my.scope.attribute: Str(some scope attribute)
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>    Trace ID       : 5b8efff798038103d269b633813fc60c
</span></span><span class=line><span class=cl>    Parent ID      : eee19b7ec3c1b173
</span></span><span class=line><span class=cl>    ID             : eee19b7ec3c1b174
</span></span><span class=line><span class=cl>    Name           : I&#39;m a server span
</span></span><span class=line><span class=cl>    Kind           : Server
</span></span><span class=line><span class=cl>    Start time     : 2018-12-13 14:51:00 +0000 UTC
</span></span><span class=line><span class=cl>    End time       : 2018-12-13 14:51:01 +0000 UTC
</span></span><span class=line><span class=cl>    Status code    : Unset
</span></span><span class=line><span class=cl>    Status message :
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)</span></span></code></pre></div></div></details><p><strong>Gateway has handled the span</strong>: Verify that the gateway has generated a new file named <code>./gateway-traces.out</code>.</p><div class=tab-panel data-tab-group=95dd917be8bae94105863eba20f8a2ab><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-gateway-tracesout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("95dd917be8bae94105863eba20f8a2ab","cat-gateway-tracesout")'>
<span class=tab-nav-text>cat /gateway-traces.out</span>
</button>
<button data-tab-item=cat-gateway-tracesoutjq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("95dd917be8bae94105863eba20f8a2ab","cat-gateway-tracesoutjq")'>
<span class=tab-nav-text>cat /gateway-traces.out|jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-gateway-tracesout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.service&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;my.environment&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;George Lucas&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;+1555-867-5309&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.email&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;george@deathstar.email&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;LOTR\u003eStarWars1-2-3&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.visa&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;4111 1111 1111 1111&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.amex&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;3782 822463 10005&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;5555 5555 5555 4444&#34;</span><span class=p>}}],</span><span class=nt>&#34;status&#34;</span><span class=p>:{}}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-gateway-tracesoutjq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;service.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.service&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;my.environment&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeSpans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;my.library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;some scope attribute&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;spans&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;5b8efff798038103d269b633813fc60c&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b174&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span> <span class=s2>&#34;eee19b7ec3c1b173&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;+1555-867-5309&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;george@deathstar.email&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;4111 1111 1111 1111&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;5555 5555 5555 4444&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Ensure that both <code>gateway-metrics.out</code> and <code>gateway-traces.out</code> include a resource attribute key-value pair for <code>otelcol.service.mode</code> with the value <code>gateway</code>.</p></div></details><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>In the provided <code>gateway.yaml</code> configuration, we modified the <code>resource/add_mode</code> processor to use the <code>upsert</code> action instead of <code>insert</code>.
The <code>upsert</code> action updates the value of the resource attribute key if it already exists, setting it to <code>gateway</code>. If the key is not present, the <code>upsert</code> action will add it.</p></div></details></p><p>Stop the <strong>Agent</strong> and <strong>Gateway</strong> processes by pressing <code>Ctrl-C</code> in their respective terminals.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=24-addendum---info-on-access-tokens-and-batch-processing>2.4 Addendum - Info on Access Tokens and Batch Processing</h1><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><h2 id=introduction-to-the-otlphttp-exporter>Introduction to the otlphttp Exporter</h2><p>The <code>otlphttp</code> exporter is now the default method for sending metrics and traces to Splunk Observability Cloud. This exporter provides a standardized and efficient way to transmit telemetry data using the OpenTelemetry Protocol (OTLP) over HTTP.</p><p>When deploying the Splunk Distribution of the OpenTelemetry Collector in host monitoring (agent) mode, the <code>otlphttp</code> exporter is included by default. This replaces older exporters such as <code>sapm</code> and <code>signalfx</code>, which are gradually being phased out.</p></div></details><h2 id=configuring-splunk-access-tokens>Configuring Splunk Access Tokens</h2><p>To authenticate and send data to Splunk Observability Cloud, you need to configure access tokens properly.
In OpenTelemetry, authentication is handled via HTTP headers. To pass an access token, use the <code>headers:</code> key with the sub-key <code>X-SF-Token:</code>. This configuration works in both agent and gateway mode.</p><p>Example:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://ingest.&lt;realm&gt;.signalfx.com&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;your-access-token&#34;</span></span></span></code></pre></div><h3 id=pass-through-mode>Pass-Through Mode</h3><p>If you need to forward headers through the pipeline, enable pass-through mode by setting <code>include_metadata:</code> to <code>true</code> in the OTLP receiver configuration. This ensures that any authentication headers received by the collector are retained and forwarded along with the data.</p><p>Example:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>otlp</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocols</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>http</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>include_metadata</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div><p>This is particularly useful in gateway mode, where data from multiple agents may pass through a centralized gateway before being sent to Splunk.</p><h2 id=understanding-batch-processing>Understanding Batch Processing</h2><p>The Batch Processor is a key component in optimizing data transmission efficiency. It groups traces, metrics, and logs into batches before sending them to the backend. Batching improves performance by:</p><ul><li>Reducing the number of outgoing requests.</li><li>Improving compression efficiency.</li><li>Lowering network overhead.</li></ul><h3 id=configuring-the-batch-processor>Configuring the Batch Processor</h3><p>To enable batching, configure the <code>batch:</code> section and include the <code>X-SF-Token:</code> key. This ensures that data is grouped correctly before being sent to Splunk Observability Cloud.</p><p>Example:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>batch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata_keys</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>X-SF-Token]  </span><span class=w> </span><span class=c># Array of metadata keys to batch </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>send_batch_size</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>5s</span></span></span></code></pre></div><h3 id=best-practices-for-batch-processing>Best Practices for Batch Processing</h3><p>For optimal performance, it is recommended to use the Batch Processor in every collector deployment. The best placement for the Batch Processor is <strong>after the memory limiter and sampling processors</strong>. This ensures that only necessary data is batched, avoiding unnecessary processing of dropped data.</p><h3 id=gateway-configuration-with-batch-processor>Gateway Configuration with Batch Processor</h3><p>When deploying a gateway, ensure that the Batch Processor is included in the pipeline:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>memory_limiter, tail_sampling, batch]</span></span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>The <code>otlphttp</code> exporter is now the preferred method for sending telemetry data to Splunk Observability Cloud. Properly configuring Splunk Access Tokens ensures secure data transmission, while the Batch Processor helps optimize performance by reducing network overhead. By implementing these best practices, you can efficiently collect and transmit observability data at scale.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=3-filelog-setup>3. Filelog Setup</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/filelogreceiver/README.md rel=external target=_blank><strong>FileLog Receiver</strong></a> in the OpenTelemetry Collector is used to ingest logs from files.</p><p>It monitors specified files for new log entries and streams those logs into the Collector for further processing or exporting. It is useful for testing and development purposes.</p><p>For this part of the workshop, there is script that will generate log lines in a file. The Filelog receiver will read these log lines and send them to the OpenTelemetry Collector.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Move to the <strong>log-gen</strong> terminal window.</li><li>Navigate to the <code>[WORKSHOP]</code> directory and create a new subdirectory named <code>3-filelog</code>.</li><li>Next, copy all contents from the <code>2-gateway</code> directory into <code>3-filelog</code>.</li><li>After copying, remove any <code>*.out</code> and <code>*.log</code> files.</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/3-filelog</code> directory.</li></ul><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=8ce0ddf4560bf125f09fb861e38acf93><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8ce0ddf4560bf125f09fb861e38acf93","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ agent.yaml          # Agent Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway.yaml        # Gateway Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json          # Example trace file
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol                 # OpenTelemetry binary</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 3. Filelog Setup</h1><article class=default><header class=headline></header><h1 id=31-create-log-gen-script>3.1 Create Log-Gen Script</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Create the <code>log-gen</code> script</strong>: In the <code>3-filelog</code> directory create the script <code>log-gen.sh</code> (macOS/Linux), or <code>log-gen.ps1</code> (Windows) using the appropriate script below for your operating system:</p><div class=tab-panel data-tab-group=bf46da1c9c65b4382ef49a3f5e97ca84><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-gensh-macoslinux class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bf46da1c9c65b4382ef49a3f5e97ca84","log-gensh-macoslinux")'>
<span class=tab-nav-text>log-gen.sh (macOS/Linux)</span>
</button>
<button data-tab-item=log-genps1-windows class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("bf46da1c9c65b4382ef49a3f5e97ca84","log-genps1-windows")'>
<span class=tab-nav-text>log-gen.ps1 (Windows)</span></button></div><div class=tab-content-container><div data-tab-item=log-gensh-macoslinux class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># Define the log file</span>
</span></span><span class=line><span class=cl><span class=nv>LOG_FILE</span><span class=o>=</span><span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define quotes</span>
</span></span><span class=line><span class=cl><span class=nv>LOTR_QUOTES</span><span class=o>=(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;One does not simply walk into Mordor.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Even the smallest person can change the course of the future.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;All we have to decide is what to do with the time that is given us.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;There is some good in this world, and it&#39;s worth fighting for.&#34;</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>STAR_WARS_QUOTES</span><span class=o>=(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Do or do not, there is no try.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;The Force will be with you. Always.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;I find your lack of faith disturbing.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;In my experience, there is no such thing as luck.&#34;</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Function to get a random quote</span>
</span></span><span class=line><span class=cl>get_random_quote<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>((</span> RANDOM % <span class=nv>2</span> <span class=o>==</span> <span class=m>0</span> <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>LOTR_QUOTES</span><span class=p>[RANDOM % </span><span class=si>${#</span><span class=nv>LOTR_QUOTES</span><span class=p>[@]</span><span class=si>}</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>STAR_WARS_QUOTES</span><span class=p>[RANDOM % </span><span class=si>${#</span><span class=nv>STAR_WARS_QUOTES</span><span class=p>[@]</span><span class=si>}</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Function to get a random log level</span>
</span></span><span class=line><span class=cl>get_random_log_level<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>LOG_LEVELS</span><span class=o>=(</span><span class=s2>&#34;INFO&#34;</span> <span class=s2>&#34;WARN&#34;</span> <span class=s2>&#34;ERROR&#34;</span> <span class=s2>&#34;DEBUG&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>LOG_LEVELS</span><span class=p>[RANDOM % </span><span class=si>${#</span><span class=nv>LOG_LEVELS</span><span class=p>[@]</span><span class=si>}</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Function to generate log entry</span>
</span></span><span class=line><span class=cl>generate_log_entry<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>TIMESTAMP</span><span class=o>=</span><span class=k>$(</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>LEVEL</span><span class=o>=</span><span class=k>$(</span>get_random_log_level<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>MESSAGE</span><span class=o>=</span><span class=k>$(</span>get_random_quote<span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$JSON_OUTPUT</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=nb>true</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;{\&#34;timestamp\&#34;: \&#34;</span><span class=nv>$TIMESTAMP</span><span class=s2>\&#34;, \&#34;level\&#34;: \&#34;</span><span class=nv>$LEVEL</span><span class=s2>\&#34;, \&#34;message\&#34;: \&#34;</span><span class=nv>$MESSAGE</span><span class=s2>\&#34;}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$TIMESTAMP</span><span class=s2> [</span><span class=nv>$LEVEL</span><span class=s2>] - </span><span class=nv>$MESSAGE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Parse command line arguments</span>
</span></span><span class=line><span class=cl><span class=nv>JSON_OUTPUT</span><span class=o>=</span><span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$#</span><span class=s2>&#34;</span> -gt <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nv>$1</span> in
</span></span><span class=line><span class=cl>        -json<span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>JSON_OUTPUT</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>            <span class=p>;;</span>
</span></span><span class=line><span class=cl>    <span class=k>esac</span>
</span></span><span class=line><span class=cl>    <span class=nb>shift</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Main loop to write logs</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Writing logs to </span><span class=nv>$LOG_FILE</span><span class=s2>. Press Ctrl+C to stop.&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    generate_log_entry &gt;&gt; <span class=s2>&#34;</span><span class=nv>$LOG_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    sleep <span class=m>1</span> <span class=c1># Adjust this value for log frequency</span>
</span></span><span class=line><span class=cl><span class=k>done</span></span></span></code></pre></div></div></div><div data-tab-item=log-genps1-windows class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=c># Define the log file</span>
</span></span><span class=line><span class=cl><span class=nv>$LOG_FILE</span> <span class=p>=</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Define quotes</span>
</span></span><span class=line><span class=cl><span class=nv>$LOTR_QUOTES</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;One does not simply walk into Mordor.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Even the smallest person can change the course of the future.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;All we have to decide is what to do with the time that is given us.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;There is some good in this world, and it&#39;s worth fighting for.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$STAR_WARS_QUOTES</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Do or do not, there is no try.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;The Force will be with you. Always.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;I find your lack of faith disturbing.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;In my experience, there is no such thing as luck.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Function to get a random quote</span>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-RandomQuote</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=nb>Get-Random</span> <span class=n>-Minimum</span> <span class=mf>0</span> <span class=n>-Maximum</span> <span class=mf>2</span><span class=p>)</span> <span class=o>-eq</span> <span class=mf>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$LOTR_QUOTES</span><span class=p>[(</span><span class=nb>Get-Random</span> <span class=n>-Minimum</span> <span class=mf>0</span> <span class=n>-Maximum</span> <span class=nv>$LOTR_QUOTES</span><span class=p>.</span><span class=n>Length</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$STAR_WARS_QUOTES</span><span class=p>[(</span><span class=nb>Get-Random</span> <span class=n>-Minimum</span> <span class=mf>0</span> <span class=n>-Maximum</span> <span class=nv>$STAR_WARS_QUOTES</span><span class=p>.</span><span class=n>Length</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Function to get a random log level</span>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Get-RandomLogLevel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$LOG_LEVELS</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span><span class=s2>&#34;INFO&#34;</span><span class=p>,</span> <span class=s2>&#34;WARN&#34;</span><span class=p>,</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$LOG_LEVELS</span><span class=p>[(</span><span class=nb>Get-Random</span> <span class=n>-Minimum</span> <span class=mf>0</span> <span class=n>-Maximum</span> <span class=nv>$LOG_LEVELS</span><span class=p>.</span><span class=n>Length</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Function to generate log entry</span>
</span></span><span class=line><span class=cl><span class=kd>function</span><span class=w> </span><span class=nb>Generate-LogEntry</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$TIMESTAMP</span> <span class=p>=</span> <span class=nb>Get-Date</span> <span class=n>-Format</span> <span class=s2>&#34;yyyy-MM-dd HH:mm:ss&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$LEVEL</span> <span class=p>=</span> <span class=nb>Get-RandomLogLevel</span>
</span></span><span class=line><span class=cl>    <span class=nv>$MESSAGE</span> <span class=p>=</span> <span class=nb>Get-RandomQuote</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$JSON_OUTPUT</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$logEntry</span> <span class=p>=</span> <span class=vm>@</span><span class=p>{</span> <span class=n>timestamp</span> <span class=p>=</span> <span class=nv>$TIMESTAMP</span><span class=p>;</span> <span class=n>level</span> <span class=p>=</span> <span class=nv>$LEVEL</span><span class=p>;</span> <span class=n>message</span> <span class=p>=</span> <span class=nv>$MESSAGE</span> <span class=p>}</span> <span class=p>|</span> <span class=nb>ConvertTo-Json</span> <span class=n>-Compress</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$logEntry</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>$TIMESTAMP</span><span class=s2> [</span><span class=nv>$LEVEL</span><span class=s2>] - </span><span class=nv>$MESSAGE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$logEntry</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Parse command line arguments</span>
</span></span><span class=line><span class=cl><span class=nv>$JSON_OUTPUT</span> <span class=p>=</span> <span class=vm>$false</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$args</span> <span class=o>-contains</span> <span class=s2>&#34;-json&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$JSON_OUTPUT</span> <span class=p>=</span> <span class=vm>$true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># Main loop to write logs</span>
</span></span><span class=line><span class=cl><span class=nb>Write-Host</span> <span class=s2>&#34;Writing logs to </span><span class=nv>$LOG_FILE</span><span class=s2>. Press Ctrl+C to stop.&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=vm>$true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$logEntry</span> <span class=p>=</span> <span class=nb>Generate-LogEntry</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c># Ensure UTF-8 encoding is used (without BOM) to avoid unwanted characters</span>
</span></span><span class=line><span class=cl>    <span class=nv>$logEntry</span> <span class=p>|</span> <span class=nb>Out-File</span> <span class=n>-Append</span> <span class=n>-FilePath</span> <span class=nv>$LOG_FILE</span> <span class=n>-Encoding</span> <span class=n>utf8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>Start-Sleep</span> <span class=n>-Seconds</span> <span class=mf>1</span>  <span class=c># Adjust log frequency</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=56525809c0d2af3e87c06cf873dc132a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("56525809c0d2af3e87c06cf873dc132a","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ agent.yaml          # Agent Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway.yaml        # Gateway Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ log-gen.(sh or ps1) # Script to write a file with logs lines 
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json          # Example trace file 
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol                 # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div><p>For <strong>macOS/Linux</strong> make sure the script is executable:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod +x log-gen.sh</span></span></code></pre></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=32-start-log-gen>3.2 Start Log-Gen</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Start the appropriate script for your system. The script will begin writing lines to a file named <code>quotes.log</code>:</p><div class=tab-panel data-tab-group=0346df86071f904f5ec060a0c4f479b4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0346df86071f904f5ec060a0c4f479b4","log-generator")'>
<span class=tab-nav-text>Log Generator</span></button></div><div class=tab-content-container><div data-tab-item=log-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>./log-gen.sh</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=6330427872ca06d54513e85006748dc1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-generator-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6330427872ca06d54513e85006748dc1","log-generator-output")'>
<span class=tab-nav-text>Log Generator Output</span></button></div><div class=tab-content-container><div data-tab-item=log-generator-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Writing logs to quotes.log. Press Ctrl+C to stop.</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>On Windows, you may encounter the following error:</p><span style=color:red;font-family:monospace;font-weight:400><p>.\log-gen.ps1 : File .\log-gen.ps1 cannot be loaded because running scripts is disabled on this system &mldr;</p></span><p>To resolve this run:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=n>powershell</span> <span class=n>-ExecutionPolicy</span> <span class=n>Bypass</span> <span class=o>-File</span> <span class=nb>log-gen</span><span class=p>.</span><span class=n>ps1</span></span></span></code></pre></div></div></details></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=33-filelog-configuration>3.3 Filelog Configuration</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Move to the <strong>Agent</strong> terminal window and change into the <code>[WORKSHOP]/3-filelog</code> directory. Open the <code>agent.yaml</code> copied across earlier and in your editor add the <code>filelog</code> receiver to the <code>agent.yaml</code>.</p><p><strong>Create the <code>filelog</code> receiver and name it <code>quotes</code></strong>: The <strong>FileLog</strong> receiver reads log data from a file and includes custom resource attributes in the log data:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>filelog/quotes</span><span class=p>:</span><span class=w>                      </span><span class=c># Receiver Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log             </span><span class=w> </span><span class=c># The file to read log data from</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include_file_path</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>            </span><span class=c># Include file path in the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include_file_name</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>           </span><span class=c># Exclude file name from the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resource</span><span class=p>:</span><span class=w>                          </span><span class=c># Add custom resource attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>com.splunk.source</span><span class=p>:</span><span class=w> </span><span class=l>./quotes.log </span><span class=w> </span><span class=c># Source of the log data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>com.splunk.sourcetype</span><span class=p>:</span><span class=w> </span><span class=l>quotes   </span><span class=w> </span><span class=c># Source type of the log data</span></span></span></code></pre></div><p><strong>Add <code>filelog/quotes</code> receiver</strong>: In the <code>logs:</code> pipeline add the <code>filelog/quotes:</code> receiver.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes           </span><span class=w> </span><span class=c># Filelog Receiver reading quotes.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection        </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Batch Processor, groups data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp                 </span><span class=w> </span><span class=c># OTLP/HTTP EXporter</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>logs:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      REC2(filelog&lt;br&gt;fa:fa-download&lt;br&gt;quotes):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(otlphttp&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; EXP1
      PRO4 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=34-test-filelog-receiver>3.4 Test Filelog Receiver</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Check the log-gen script is running</strong>: Find the <strong>log-gen</strong> Terminal window, and check the script is still running, and the last line is still stating the below, if it not, restart it in the <code>[WORKSHOP]/3-filelog</code> folder.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Writing logs to quotes.log. Press Ctrl+C to stop.</span></span></code></pre></div><p><strong>Start the Gateway</strong>:</p><ol><li>Find your <code>Gateway</code> terminal window.</li><li>Navigate to the <code>[WORKSHOP]/3-filelog</code> directory.</li><li>Start the <strong>Gateway</strong> collector.</li></ol><p><strong>Start the Agent</strong>:</p><ol><li>Switch to your <code>Agent</code> terminal window</li><li>Navigate to the <code>[WORKSHOP]/3-filelog</code> directory</li><li>Start the <strong>Agent</strong>.</li><li>Ignore the initial <strong>CPU</strong> metrics in the debug output and wait until the continuous stream of log data from the <code>quotes.log</code> appears. The debug output should look similar to the following (use the <em>Check Full Debug Log</em> to see all data):</li></ol><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>Body: Str(2025-02-05 18:05:16 [INFO] - All we have to decide is what to do with the time that is given)us.
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>    -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div><details class="box cstyle notices transparent expand"><summary class=box-label><i class="expander-icon fa-fw fas fa-chevron-right"></i>
<span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-scroll"></i></span><span class=badge-content>Check Full Debug Log</span></span></summary><div class=box-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-02-05T18:05:17.050+0100    info    Logs    {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource logs&#34;: 1, &#34;log records&#34;: 1}
</span></span><span class=line><span class=cl>2025-02-05T18:05:17.050+0100    info    ResourceLog #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:
</span></span><span class=line><span class=cl>     -&gt; com.splunk.source: Str(./quotes.log)
</span></span><span class=line><span class=cl>     -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>     -&gt; host.name: Str(PH-Windows-Box.hagen-ict.nl)
</span></span><span class=line><span class=cl>     -&gt; os.type: Str(windows)
</span></span><span class=line><span class=cl>     -&gt; otelcol.service.mode: Str(gateway)
</span></span><span class=line><span class=cl>ScopeLogs #0
</span></span><span class=line><span class=cl>ScopeLogs SchemaURL:
</span></span><span class=line><span class=cl>InstrumentationScope
</span></span><span class=line><span class=cl>LogRecord #0
</span></span><span class=line><span class=cl>ObservedTimestamp: 2025-02-05 17:05:16.6926816 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>SeverityText:
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-02-05 18:05:16 [INFO] - All we have to decide is what to do with the time that is given)us.
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>Trace ID:
</span></span><span class=line><span class=cl>Span ID:
</span></span><span class=line><span class=cl>Flags: 0
</span></span><span class=line><span class=cl>        {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div></div></details><p><strong>Verify the gateway has handled the logs</strong>:</p><ol><li><strong>Windows only</strong>: Stop the <strong>Agent</strong> and <strong>Gateway</strong> to flush the files.</li><li>Check if the <strong>Gateway</strong> has written a <code>./gateway-log.out</code> file.</li></ol><p>At this point, your directory structure will appear as follows:</p><div class=tab-panel data-tab-group=f6efbf0899164c49e164b3e12ef28922><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f6efbf0899164c49e164b3e12ef28922","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ agent.yaml          # Agent Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway-logs.out    # Output from the gateway logs pipeline
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway-metrics.out # Output from the gateway metrics pipeline
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway.yaml        # Gateway Collector configuration file
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ log-gen.(sh or ps1) # Script to write a file with logs lines 
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ quotes.log          # File containing Random log lines
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json          # Example trace file 
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol                 # OpenTelemetry Collector binary</span></span></code></pre></div></div></div></div></div><p><strong>Examine a log line in <code>gateway-log.out</code></strong>: Compare a log line with the snippet below. It is a preview showing the beginning and a single log line; your actual output will contain many, many more:</p><div class=tab-panel data-tab-group=c2465e8b244e80578d0f343d514a0329><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=cat-gateway-logout class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c2465e8b244e80578d0f343d514a0329","cat-gateway-logout")'>
<span class=tab-nav-text>cat /gateway-log.out</span>
</button>
<button data-tab-item=cat-gateway-logout--jq class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("c2465e8b244e80578d0f343d514a0329","cat-gateway-logout--jq")'>
<span class=tab-nav-text>cat <code>./gateway-log.out</code> | jq</span></button></div><div class=tab-content-container><div data-tab-item=cat-gateway-logout class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{},</span><span class=nt>&#34;logRecords&#34;</span><span class=p>:[{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737231901720160600&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-01-18 21:25:01 [WARN] - Do or do not, there is no try.&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;PH-Windows-Box.hagen-ict.nl&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;windows&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{},</span><span class=nt>&#34;logRecords&#34;</span><span class=p>:[{</span><span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1737231902719133000&#34;</span><span class=p>,</span><span class=nt>&#34;body&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;2025-01-18 21:25:02 [DEBUG] - One does not simply walk into Mordor.&#34;</span><span class=p>},</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes.log&#34;</span><span class=p>}}],</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>}]}],</span><span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span><span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span><span class=p>}]}</span></span></span></code></pre></div></div></div><div data-tab-item=cat-gateway-logout--jq class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;./quotes.log&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;scopeLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;logRecords&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1737231902719133000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-01-18 21:25:02 [DEBUG] - One does not simply walk into Mordor.&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schemaUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://opentelemetry.io/schemas/1.6.1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p><strong>Examine the <code>resourceLogs</code> section</strong>: Verify that the files include the same attributes we observed in the <code>traces</code> and <code>metrics</code> sections.</p><div class=tab-panel data-tab-group=b82d2f7038b0e047e2098538b5203a2d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=compacted-json class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b82d2f7038b0e047e2098538b5203a2d","compacted-json")'>
<span class=tab-nav-text>Compacted JSON</span>
</button>
<button data-tab-item=formatted-json class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("b82d2f7038b0e047e2098538b5203a2d","formatted-json")'>
<span class=tab-nav-text>Formatted JSON</span></button></div><div class=tab-content-container><div data-tab-item=compacted-json class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceLogs&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;quotes&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;./quotes.log&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;host.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;os.type&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;[YOUR_OS]&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;agent&#34;</span><span class=p>}}]}}]}</span></span></span></code></pre></div></div></div><div data-tab-item=formatted-json class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;resourceLogs&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;resource&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk/source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;./quotes.log&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_HOST_NAME]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;[YOUR_OS]&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></details><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>You may also have noticed that every log line contains empty placeholders for <code>"traceId":""</code> and <code>"spanId":""</code>.<br>The FileLog receiver will populate these fields only if they are not already present in the log line.
For example, if the log line is generated by an application instrumented with an OpenTelemetry instrumentation library, these fields will already be included and will not be overwritten.</p></div></details><p>Stop the Agent, Gateway and the Quotes generating script as well using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=4-building-in-resilience>4. Building In Resilience</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The OpenTelemetry Collectorâ€™s <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/19bc7d6ee854c0c1b5c97d8d348e5b9d1199e8aa/extension/storage/filestorage/README.md rel=external target=_blank><strong>FileStorage Extension</strong></a> enhances the resilience of your telemetry pipeline by providing reliable checkpointing, managing retries, and handling temporary failures effectively.</p><p>With this extension enabled, the OpenTelemetry Collector can store intermediate states on disk, preventing data loss during network disruptions and allowing it to resume operations seamlessly.</p><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>This solution will work for metrics as long as the connection downtime is briefâ€”up to 15 minutes. If the downtime exceeds this, Splunk Observability Cloud will drop data due to datapoints being out of order.</p><p>For logs, there are plans to implement a more enterprise-ready solution in one of the upcoming Splunk OpenTelemetry Collector releases.</p></div></details><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>4-resilience</code>.</li><li>Next, copy all contents from the <code>3-filelog</code> directory into <code>4-resilience</code>.</li><li>After copying, remove any <code>*.out</code> and <code>*.log</code> files.</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/4-reslilience</code> directory.</li></ul><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=2e7b54d41461d75f0ea83291dade4653><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2e7b54d41461d75f0ea83291dade4653","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”œâ”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl>â”‚Â Â  â”œâ”€â”€ log-gen.sh (or .ps1)
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 4. Building Resilience</h1><article class=default><header class=headline></header><h1 id=41-file-storage-configuration>4.1 File Storage Configuration</h1><p>In this exercise, we will update the <code>extensions:</code> section of the <code>agent.yaml</code> file. This section is part of the OpenTelemetry configuration YAML and defines optional components that enhance or modify the OpenTelemetry Collectorâ€™s behavior.</p><p>While these components do not process telemetry data directly, they provide valuable capabilities and services to improve the Collectorâ€™s functionality.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Update the <code>agent.yaml</code></strong>: Add the <code>file_storage</code> extension and name it <code>checkpoint</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file_storage/checkpoint</span><span class=p>:</span><span class=w>         </span><span class=c># Extension Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./checkpoint-dir&#34;</span><span class=w>  </span><span class=c># Define directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>create_directory</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>         </span><span class=c># Create directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>1s                   </span><span class=w> </span><span class=c># Timeout for file operations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>compaction</span><span class=p>:</span><span class=w>                    </span><span class=c># Compaction settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>on_start</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>               </span><span class=c># Start compaction at Collector startup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Define compaction directory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>directory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./checkpoint-dir/tmp&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Max. size limit before compaction occurs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>max_transaction_size</span><span class=p>:</span><span class=w> </span><span class=m>65536</span></span></span></code></pre></div><p><strong>Add <code>file_storage</code> to existing <code>otlphttp</code> exporter</strong>: Modify the <code>otlphttp:</code> exporter to configure retry and queuing mechanisms, ensuring data is retained and resent if failures occur:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>otlphttp</span><span class=p>:</span><span class=w>                       </span><span class=c># Exporter Type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>endpoint</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;http://localhost:5318&#34;</span><span class=w> </span><span class=c># Gateway OTLP endpoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>headers</span><span class=p>:</span><span class=w>                      </span><span class=c># Headers to add to the HTTPcall </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>X-SF-Token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ACCESS_TOKEN&#34;</span><span class=w>  </span><span class=c># Splunk ACCESS_TOKEN header</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>retry_on_failure</span><span class=p>:</span><span class=w>             </span><span class=c># Retry on failure settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>               </span><span class=c># Enables retrying</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>sending_queue</span><span class=p>:</span><span class=w>                </span><span class=c># Sending queue settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>               </span><span class=c># Enables Sending queue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>num_consumers</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>           </span><span class=c># Number of consumers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>queue_size</span><span class=p>:</span><span class=w> </span><span class=m>10000</span><span class=w>           </span><span class=c># Maximum queue size</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># File storage extension</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>file_storage/checkpoint</span></span></span></code></pre></div><p><strong>Update the <code>services</code> section</strong>: Add the <code>file_storage/checkpoint</code> extension to the existing <code>extensions:</code> section. This will cause the extension to be enabled:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extensions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>health_check</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>file_storage/checkpoint      </span><span class=w> </span><span class=c># Enabled extensions for this collector</span></span></span></code></pre></div><p><strong>Update the <code>metrics</code> pipeline</strong>: For this exercise we are going to remove the <code>hostmetrics</code> receiver from the Metric pipeline to reduce debug and log noise:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>otlp                       </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># - hostmetrics               # Hostmetrics Receiver</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>metrics:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip):::processor
      PRO4(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(otlphttp&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; EXP1
      PRO4 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=42-setup-environment-for-resilience-testing>4.2 Setup environment for Resilience Testing</h1><p>Next, we will configure our environment to be ready for testing the <strong>File Storage</strong> configuration.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway</strong> terminal window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=a8f618d2e62c82068f67eb298f2495c4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a8f618d2e62c82068f67eb298f2495c4","gateway")'>
<span class=tab-nav-text>Gateway</span></button></div><div class=tab-content-container><div data-tab-item=gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent</strong> terminal window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=1c150a04630592926d3129aea6da3c36><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1c150a04630592926d3129aea6da3c36","agent")'>
<span class=tab-nav-text>Agent</span></button></div><div class=tab-content-container><div data-tab-item=agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Send a test trace</strong>: In the <strong>Test</strong> terminal window navigate to the <code>[WORKSHOP]/4-resilience</code> directory and run:</p><div class=tab-panel data-tab-group=b166c05207365acb0fc26a517860bcae><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b166c05207365acb0fc26a517860bcae","curl-command")'>
<span class=tab-nav-text>cURL command</span></button></div><div class=tab-content-container><div data-tab-item=curl-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -X POST -i http://localhost:4318/v1/traces -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s2>&#34;@trace.json&#34;</span></span></span></code></pre></div></div></div></div></div><p>Both the <strong>Agent</strong> and <strong>Gateway</strong> should display debug logs, and the <strong>Gateway</strong> should create a <code>./gateway-traces.out</code> file.</p></div></details><p>If everything functions correctly, we can proceed with testing system resilience.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=43-simulate-failure>4.3 Simulate Failure</h1><p>To assess the <strong>Agent&rsquo;s</strong> resilience, we&rsquo;ll simulate a temporary <strong>Gateway</strong> outage and observe how the <strong>Agent</strong> handles it:</p><p><strong>Summary</strong>:</p><ol><li><strong>Send Traces to the Agent</strong> â€“ Generate traffic by sending traces to the <strong>Agent</strong>.</li><li><strong>Stop the Gateway</strong> â€“ This will trigger the <strong>Agent</strong> to enter retry mode.</li><li><strong>Restart the Gateway</strong> â€“ The <strong>Agent</strong> will recover traces from its persistent queue and forward them successfully. Without the persistent queue, these traces would have been lost permanently.</li></ol><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Simulate a network failure</strong>: In the <strong>Gateway</strong> terminal stop the <strong>Gateway</strong> with <code>Ctrl-C</code> and wait until the gateway console shows that it has stopped:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T13:24:32.785+0100  info  service@v0.116.0/service.go:309  Shutdown complete.</span></span></code></pre></div><p><strong>Send traces</strong>: In the <strong>Test</strong> terminal window send two traces using the <code>curl</code> command we used earlier.</p><p>Notice that the agentâ€™s retry mechanism is activated as it continuously attempts to resend the data. In the agentâ€™s console output, you will see repeated messages similar to the following:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T14:22:47.020+0100  info  internal/retry_sender.go:126  Exporting failed. Will retry the request after interval.  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;otlphttp&#34;, &#34;error&#34;: &#34;failed to make an HTTP request: Post \&#34;http://localhost:5318/v1/traces\&#34;: dial tcp 127.0.0.1:5318: connect: connection refused&#34;, &#34;interval&#34;: &#34;9.471474933s&#34;}</span></span></code></pre></div><p><strong>Stop the Agent</strong>: Use <code>Ctrl-C</code> to stop the agent. Wait until the agentâ€™s console confirms it has stopped:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-01-28T14:40:28.702+0100  info  extensions/extensions.go:66  Stopping extensions...
</span></span><span class=line><span class=cl>2025-01-28T14:40:28.702+0100  info  service@v0.116.0/service.go:309  Shutdown complete.</span></span></code></pre></div></div></details><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>Stopping the agent will halt its retry attempts and prevent any future retry activity.</p><p>If the agent runs for too long without successfully delivering data, it may begin dropping traces, depending on the retry configuration, to conserve memory. By stopping the agent, any metrics, traces, or logs currently stored in memory are lost before being dropped, ensuring they remain available for recovery.</p><p>This step is essential for clearly observing the recovery process when the agent is restarted.</p></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=44-simulate-recovery>4.4 Simulate Recovery</h1><p>In this exercise, weâ€™ll test how the <strong>OpenTelemetry Collector</strong> recovers from a network outage by restarting the <strong>Gateway</strong>. When the <strong>Gateway</strong> becomes available again, the <strong>Agent</strong> will resume sending data from its last checkpointed state, ensuring no data loss.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Restart the Gateway</strong>: In the <strong>Gateway</strong> terminal window run:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div><p><strong>Restart the Agent</strong>: In the <strong>Agent</strong> terminal window run:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></details><p>After the <strong>Agent</strong> is up and running, the <strong>File_Storage</strong> extension will detect buffered data in the checkpoint folder.<br>It will start to dequeue the stored spans from the last checkpoint folder, ensuring no data is lost.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Verify the Agent Debug output</strong><br>Note that the Agent Debug Screen does <strong>NOT</strong> change and still shows the following line indicating no new data is being exported.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>2025-02-07T13:40:12.195+0100    info    service@v0.117.0/service.go:253 Everything is ready. Begin running and processing data.</span></span></code></pre></div><p><strong>Watch the Gateway Debug output</strong><br>You should see from the <strong>Gateway</strong> debug screen, it has started receiving the previously missed traces without requiring any additional action on your part.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>2025-02-07T12:44:32.651+0100    info    service@v0.117.0/service.go:253 Everything is ready. Begin running and processing data.
</span></span><span class=line><span class=cl>2025-02-07T12:47:46.721+0100    info    Traces  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;, &#34;resource spans&#34;: 4, &#34;spans&#34;: 4}
</span></span><span class=line><span class=cl>2025-02-07T12:47:46.721+0100    info    ResourceSpans #0
</span></span><span class=line><span class=cl>Resource SchemaURL: https://opentelemetry.io/schemas/1.6.1
</span></span><span class=line><span class=cl>Resource attributes:</span></span></code></pre></div><p><strong>Check the <code>gateway-traces.out</code> file</strong><br>Count the number of traces in the recreated <code>./gateway-traces.out</code>. It should match the number you send when the <strong>Gateway</strong> was down</p></div></details><h3 id=conclusion>Conclusion</h3><p>This exercise demonstrated how to enhance the resilience of the OpenTelemetry Collector by configuring the <code>file_storage</code> extension, enabling retry mechanisms for the <code>otlp</code> exporter, and using a file-backed queue for temporary data storage.</p><p>By implementing file-based checkpointing and queue persistence, you ensure the telemetry pipeline can gracefully recover from temporary interruptions, making it a more robust and reliable for production environments.</p><p>Stop the <strong>Agent</strong> and <strong>Gateway</strong> using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=5-dropping-spans>5. Dropping Spans</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, we will explore how to use the <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/filterprocessor/README.md rel=external target=_blank><strong>Filter Processor</strong></a> to selectively drop spans based on certain conditions.</p><p>Specifically, we will drop traces based on the span name, which is commonly used to filter out unwanted spans such as health checks or internal communication traces. In this case, we will be filtering out spans whose name is <code>"/_healthz"</code>, typically associated with health check requests and usually are quite &ldquo;<strong>noisy</strong>&rdquo;.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>5-dropping-spans</code>.</li><li>Next, copy all contents from the <code>4-resilience</code> directory into <code>5-dropping-spans</code>.</li><li>After copying, remove any <code>*.out</code> and <code>*.log</code> files.</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/5-dropping-spans</code> directory.</li></ul><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=6cbe3258cb14b92a907d3b2806e6a250><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6cbe3258cb14b92a907d3b2806e6a250","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”œâ”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”œâ”€â”€ 5-dropping-spans
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€â”€checkpoint-dir
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ log-gen.sh (or .ps1)
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ trace.json
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol</span></span></code></pre></div></div></div></div></div></div></details><p>Next, we will configure the <strong>filter processor</strong> and the respective pipelines.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 5. Dropping Spans</h1><article class=default><header class=headline></header><h1 id=51-configuration>5.1 Configuration</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Switch to your <strong>Gateway</strong> terminal window. Navigate to the <code>[WORKSHOP]/5-dropping-spans</code> directory and open the <code>gateway.yaml</code> and add the following configuration to the <code>processors</code> section:</p><p><strong>Add a <code>filter</code> processor</strong>: Configure the OpenTelemetry Collector to drop spans with the name <code>"/_healthz"</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>filter/health</span><span class=p>:</span><span class=w>                  </span><span class=c># Defines a filter processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore           </span><span class=w> </span><span class=c># Ignore errors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                       </span><span class=c># Filtering rules for traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>span</span><span class=p>:</span><span class=w>                       </span><span class=c># Exclude spans named &#34;/_healthz&#34;  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=s1>&#39;name == &#34;/_healthz&#34;&#39;</span></span></span></code></pre></div><p><strong>Add the <code>filter</code> processor</strong>: Make sure you add the filter to the <code>traces</code> pipeline. Filtering should be applied as early as possible, ideally <em>right after the</em> memory_limiter and <em>before</em> the batch processor:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>otlp                   </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>                
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>memory_limiter         </span><span class=w> </span><span class=c># Manage memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>resource/add_mode      </span><span class=w> </span><span class=c># Add metadata about collector mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>filter/health          </span><span class=w> </span><span class=c># Filter Processor. Filter&#39;s out Data based on rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>batch                  </span><span class=w> </span><span class=c># Groups Data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>               
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>debug                  </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>file/traces            </span><span class=w> </span><span class=c># File Exporter for Trace</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(filter&lt;br&gt;fa:fa-microchip&lt;br&gt;health):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;ensp;debug&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;file&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload&lt;br&gt;traces):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; PRO5
      PRO5 --&gt; EXP1
      PRO5 --&gt; EXP2
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=52-test-filter-processor>5.2 Test Filter Processor</h1><p>To test your configuration, you&rsquo;ll need to generate some trace data that includes a span named <code>"/_healthz"</code>.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Create &ldquo;noisy&rdquo; &lsquo;healthz&rsquo; span</strong>:</p><ol><li>Create a new file called <code>health.json</code> in the <code>5-dropping-spans</code> directory.</li><li>Copy and paste the following JSON into the <code>health.json</code> file.</li><li>Note the span name is set to <code>{"name":"healthz"}</code> in the json.</li></ol><div class=tab-panel data-tab-group=9f4be7ef00d672ef4b5f238632f355a6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=healthjson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9f4be7ef00d672ef4b5f238632f355a6","healthjson")'>
<span class=tab-nav-text>health.json</span></button></div><div class=tab-content-container><div data-tab-item=healthjson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;frontend&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;healthz&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;/_healthz&#34;</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[]}]}]}]}</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=9da7cbd6c2afa1e2d123b5e4dcaaea45><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9da7cbd6c2afa1e2d123b5e4dcaaea45","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”œâ”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”œâ”€â”€ 5-dropping-spans
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€â”€checkpoint-dir
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ health.json
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ log-gen.sh (or .ps1)
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ trace.json
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol</span></span></code></pre></div></div></div></div></div><p><strong>Start the Gateway</strong>: In the <strong>Gateway</strong> terminal window navigate to the <code>[WORKSHOP]/5-dropping-spans</code> directory and run:</p><div class=tab-panel data-tab-group=d19ca781a6a6e60e4e0265365f6f8fb6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d19ca781a6a6e60e4e0265365f6f8fb6","gateway")'>
<span class=tab-nav-text>Gateway</span></button></div><div class=tab-content-container><div data-tab-item=gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent</strong> terminal window navigate to the <code>[WORKSHOP]/5-dropping-spans</code> directory and run:</p><div class=tab-panel data-tab-group=bf514b0196f9e933f1a33678774e70e8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bf514b0196f9e933f1a33678774e70e8","agent")'>
<span class=tab-nav-text>Agent</span></button></div><div class=tab-content-container><div data-tab-item=agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Send the new <code>health.json</code> payload:</strong> In the <strong>Test</strong> terminal window navigate to the <code>[WORKSHOP]/5-dropping-spans</code> directory and run the <code>curl</code> command below. (<strong>Windows use <code>curl.exe</code></strong>).</p><div class=tab-panel data-tab-group=a5e90a4473cbacd0c6c1b07a56988ef4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=curl-command class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a5e90a4473cbacd0c6c1b07a56988ef4","curl-command")'>
<span class=tab-nav-text>cURL command</span></button></div><div class=tab-content-container><div data-tab-item=curl-command class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -X POST -i http://localhost:4318/v1/traces -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s2>&#34;@health.json&#34;</span></span></span></code></pre></div></div></div></div></div><p><strong>Verify Agent Debug output shows the <code>healthz</code> span</strong>: Confirm that the span <code>span</code> payload is sent, Check the agentâ€™s debug output to see the span data like the snippet below:</p><div class=tab-panel data-tab-group=bfbb6464e5e09f6d0e50f153830e30f6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bfbb6464e5e09f6d0e50f153830e30f6","debug-output")'>
<span class=tab-nav-text>Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>Span #0
</span></span><span class=line><span class=cl>    Trace ID       : 5b8efff798038103d269b633813fc60c
</span></span><span class=line><span class=cl>    Parent ID      : eee19b7ec3c1b173
</span></span><span class=line><span class=cl>    ID             : eee19b7ec3c1b174
</span></span><span class=line><span class=cl>    Name           : /_healthz
</span></span><span class=line><span class=cl>    Kind           : Server
</span></span><span class=line><span class=cl>&lt;snip&gt;</span></span></code></pre></div></div></div></div></div><p>The <strong>Agent</strong> has forward the span to the <strong>Gateway</strong>.</p><p><strong>Check the Gateway Debug output</strong>:</p><ol><li>The Gateway should <strong>NOT</strong> show any span data received. This is because the <strong>Gateway</strong> is configured with a filter to drop spans named <code>"/_healthz"</code>, so the span will be discarded/dropped and not processed further.</li><li>Confirm normal span are processed by using the cURL command with the <code>trace.json</code> file again. This time, you should see both the agent and gateway process the spans successfully.</li></ol></div></details><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>When using the <code>Filter</code> processor make sure you understand the look of your incoming data and test the configuration thoroughly. In general, use <strong>as specific a configuration as possible</strong> to lower the risk of the wrong data being dropped.</p></div></details><p>You can further extend this configuration to filter out spans based on different attributes, tags, or other criteria, making the OpenTelemetry Collector more customizable and efficient for your observability needs.</p><p>Stop the <strong>Agent</strong> and <strong>Gateway</strong> using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=6-redacting-sensitive-data>6. Redacting Sensitive Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>In this section, you&rsquo;ll learn how to configure the OpenTelemetry Collector to remove specific tags and redact sensitive data from telemetry spans. This is crucial for protecting sensitive information such as credit card numbers, personal data, or other security-related details that must be anonymized before being processed or exported.</p><p>We&rsquo;ll walk through configuring key processors in the OpenTelemetry Collector, including:</p><ul><li><strong><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/attributesprocessor/README.md rel=external target=_blank>Attributes Processor</a></strong>: Modifies or removes specific span attributes.</li><li><a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/redactionprocessor/README.md rel=external target=_blank><strong>Redaction Processor</strong></a>: Ensures sensitive data is sanitized before being stored or transmitted.</li></ul><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>6-sensitive-data</code>.</li><li>Next, copy all contents from the <code>5-dropping-spans</code> directory into <code>6-sensitive-data</code>.</li><li>After copying, remove any <code>*.out</code> and <code>*.log</code> files.</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/6-sensitive-data</code> directory.</li></ul><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=0355b625d955cb8333462826359afddc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0355b625d955cb8333462826359afddc","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”œâ”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”œâ”€â”€ 5-dropping-spans
</span></span><span class=line><span class=cl>â”œâ”€â”€ 6-sensitive-data
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€â”€checkpoint-dir
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ health.json
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ log-gen.sh (or .ps1)
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ trace.json
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 6. Sensitive Data</h1><article class=default><header class=headline></header><h1 id=61-configuration>6.1 Configuration</h1><p>In this step, we&rsquo;ll modify <code>agent.yaml</code> to include the <code>attributes</code> and <code>redaction</code> processors. These processors will help ensure that sensitive data within span attributes is properly handled before being logged or exported.</p><p>Previously, you may have noticed that some span attributes displayed in the console contained personal data. We&rsquo;ll now configure the necessary processors to filter out and redact this information effectively.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>     -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;traces&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p>Switch to your <strong>Agent</strong> terminal window. Navigate to the <code>[WORKSHOP]/6-sensitive-data</code> directory and open the <code>agent.yaml</code> file in your editor.</p><p><strong>Add an <code>attributes</code> Processor</strong>: This processor allows you to update, delete, or hash specific attributes (tags) within spans.<br>We&rsquo;ll <strong>update</strong> the <code>user.phone_number</code>, <strong>hash</strong> the <code>user.email</code>, and <strong>delete</strong> the <code>user.account_password</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>attributes/update</span><span class=p>:</span><span class=w>               </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>actions</span><span class=p>:</span><span class=w>                       </span><span class=c># List of actions</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.phone_number    </span><span class=w> </span><span class=c># Target key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>update            </span><span class=w> </span><span class=c># Replace value with &#34;UNKNOWN NUMBER&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UNKNOWN NUMBER&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.email           </span><span class=w> </span><span class=c># Hash the email value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>hash               </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user.account_password</span><span class=w> </span><span class=c># Remove the password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>delete</span></span></span></code></pre></div><p><strong>Add a <code>redaction</code> Processor</strong>: This processor will detect and redact sensitive values based on predefined patterns. We&rsquo;ll block credit card numbers using regular expressions.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>redaction/redact</span><span class=p>:</span><span class=w>               </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>allow_all_keys</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>          </span><span class=c># If false, only allowed keys will be retained</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>blocked_values</span><span class=p>:</span><span class=w>               </span><span class=c># List of regex patterns to hash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b4[0-9]{3}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>  </span><span class=c># Visa card</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b5[1-5][0-9]{2}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>  </span><span class=c># MasterCard</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>debug </span><span class=w> </span><span class=c># Show debug details about redaction</span></span></span></code></pre></div><p><strong>Update the <code>traces</code> Pipeline</strong>: Integrate both processors into the <code>traces</code> pipeline. Make sure that you comment out the redaction processor at first: (We will enable it later)</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                     </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter           </span><span class=w> </span><span class=c># Manage memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>attributes/update        </span><span class=w> </span><span class=c># Update, hash, and remove attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- redaction/redact          # Redact sensitive fields using regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection        </span><span class=w> </span><span class=c># Add system attributes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode        </span><span class=w> </span><span class=c># Add metadata about collector mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                    </span><span class=w> </span><span class=c># Batch Processor, groups data before send</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                    </span><span class=w> </span><span class=c># Debug Exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlphttp                 </span><span class=w> </span><span class=c># OTLP/HTTP EXporter used by Splunk O11Y </span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      PRO6(attributes&lt;br&gt;fa:fa-microchip&lt;br&gt;update):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;debug&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-traces
    subgraph &#34; &#34;
      subgraph subID1[**Traces**]
      direction LR
      REC1 --&gt; PRO1
      PRO1 --&gt; PRO6
      PRO6 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO5
      PRO5 --&gt; EXP2
      PRO5 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=62-test-attribute-processor>6.2 Test Attribute Processor</h1><p>In this exercise, we will <strong>delete</strong> the <code>user.account_password</code>, <strong>update</strong> the <code>user.phone_number</code> <strong>attribute</strong> and <strong>hash</strong> the <code>user.email</code> in the span data before it is exported by the <strong>Agent</strong>.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway</strong> terminal window navigate to the <code>[WORKSHOP]/6-sensitive-data</code> directory and run:</p><div class=tab-panel data-tab-group=9958d869810bd24672edd752873d8fd8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9958d869810bd24672edd752873d8fd8","gateway")'>
<span class=tab-nav-text>Gateway</span></button></div><div class=tab-content-container><div data-tab-item=gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent</strong> terminal window navigate to the <code>[WORKSHOP]/6-sensitive-data</code> directory and run:</p><div class=tab-panel data-tab-group=ccb01de29a7d0022180682fb7fee742d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ccb01de29a7d0022180682fb7fee742d","agent")'>
<span class=tab-nav-text>Agent</span></button></div><div class=tab-content-container><div data-tab-item=agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Send a span</strong>:</p><ol><li>In the <strong>Test</strong> terminal window change into the <code>6-sensitive-data</code> directory.</li><li>Send the span containing <strong>sensitive data</strong> by running the <code>curl</code> command to send <code>trace.json</code>.</li></ol><p><strong>Check the debug output</strong>: For both the <strong>Agent</strong> and <strong>Gateway</strong> debug output, confirm that <code>user.account_password</code> has been removed, and both <code>user.phone_number</code> & <code>user.email</code> have been updated.</p><div class=tab-panel data-tab-group=f9e3ba8410239b6574cd7a1be7bcf9d5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f9e3ba8410239b6574cd7a1be7bcf9d5","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f9e3ba8410239b6574cd7a1be7bcf9d5","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(UNKNOWN NUMBER)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str. (62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>      -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>      -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>      -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>      -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>      -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>      -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>      -&gt; user.amex: Str(3782 822463 10005)</span></span></code></pre></div></div></div></div></div><p><strong>Check file output</strong>: In the new <code>gateway-traces.out</code> file confirm that <code>user.account_password</code> has been removed, and <code>user.phone_number</code> & <code>user.email</code> have been updated:</p><div class=tab-panel data-tab-group=431398ddd41716774678124c6fc26c34><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-file-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("431398ddd41716774678124c6fc26c34","new-file-output")'>
<span class=tab-nav-text>New File Output</span>
</button>
<button data-tab-item=original-file-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("431398ddd41716774678124c6fc26c34","original-file-output")'>
<span class=tab-nav-text>Original File Output</span></button></div><div class=tab-content-container><div data-tab-item=new-file-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;attributes&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;UNKNOWN NUMBER&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;5555 5555 5555 4444&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;4111 1111 1111 1111&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span> 
</span></span><span class=line><span class=cl>            <span class=p>]</span></span></span></code></pre></div></div></div><div data-tab-item=original-file-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;attributes&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;+1555-867-5309&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;george@deathstar.email&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;5555 5555 5555 4444&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;4111 1111 1111 1111&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span> 
</span></span><span class=line><span class=cl>            <span class=p>]</span></span></span></code></pre></div></div></div></div></div></div></details><p>Stop the <strong>Agent</strong> and <strong>Gateway</strong> using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=63-test-redaction-processor>6.3 Test Redaction Processor</h1><p>The <code>redaction</code> processor gives precise control over which attributes and values are <strong>permitted</strong> or <strong>removed</strong> from telemetry data.</p><p>Earlier we configured the agent collector to:</p><p><strong>Block sensitive data</strong>: Any values (in this case Credit card numbers) matching the provided regex patterns (Visa and MasterCard) are automatically detected and redacted.</p><p>This is achieved using the <code>redaction</code> processor you added earlier, where we define <code>regex</code> patterns to filter out unwanted data:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>redaction/redact</span><span class=p>:</span><span class=w>               </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>allow_all_keys</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>          </span><span class=c># False removes all key unless in allow list </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>blocked_values</span><span class=p>:</span><span class=w>               </span><span class=c># List of regex to check and hash</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># Visa card regex.  - Please note the &#39;&#39; around the regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b4[0-9]{3}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># MasterCard card regex - Please note the &#39;&#39; around the regex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s1>&#39;\b5[1-5][0-9]{2}[\s-]?[0-9]{4}[\s-]?[0-9]{4}[\s-]?[0-9]{4}\b&#39;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>summary</span><span class=p>:</span><span class=w> </span><span class=l>debug </span><span class=w> </span><span class=c># Show detailed debug information about the redaction </span></span></span></code></pre></div><h3 id=test-the-redaction-processor>Test the Redaction Processor</h3><p>In this exercise, we will <strong>redact</strong> the <code>user.visa</code> & <code>user.mastercard</code> <strong>values</strong> in the span data before it is exported by the <strong>Agent</strong>.<details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Prepare the terminals</strong>: Delete the <code>*.out</code> files and clear the screen.</p><p><strong>Enable the <code>redaction/redact</code> processor</strong>: Edit <code>agent.yaml</code> and remove the <code>#</code> we inserted in the previous exercise.</p><p><strong>Start the Gateway</strong>: In the <strong>Gateway</strong> terminal window navigate to the <code>[WORKSHOP]/6-sensitive-data</code> directory and run:</p><div class=tab-panel data-tab-group=4b8a1422b90c16e1c24283176fa0a1cc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4b8a1422b90c16e1c24283176fa0a1cc","gateway")'>
<span class=tab-nav-text>Gateway</span></button></div><div class=tab-content-container><div data-tab-item=gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent</strong> terminal window navigate to the <code>[WORKSHOP]/6-sensitive-data</code> directory and run:</p><div class=tab-panel data-tab-group=97d850981ece3e71cf3ce3576157d0df><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("97d850981ece3e71cf3ce3576157d0df","agent")'>
<span class=tab-nav-text>Agent</span></button></div><div class=tab-content-container><div data-tab-item=agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Send a span</strong>: Run the <code>curl</code> command and in the <strong>Test</strong> terminal window to send <code>trace.json</code>.</p><p><strong>Check the debug output</strong>: For both the <strong>Agent</strong> and <strong>Gateway</strong> confirm the values for <code>user.visa</code> & <code>user.mastercard</code> have been updated. Notice <code>user.amex</code> attribute value was NOT redacted because a matching regex pattern was not added to <code>blocked_values</code></p><div class=tab-panel data-tab-group=2c5d617d613c604aa24170c67e7ced39><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2c5d617d613c604aa24170c67e7ced39","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("2c5d617d613c604aa24170c67e7ced39","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>     -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>     -&gt; user.phone_number: Str(UNKNOWN NUMBER)
</span></span><span class=line><span class=cl>     -&gt; user.email: Str. (62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287)
</span></span><span class=line><span class=cl>     -&gt; user.mastercard: Str(****)
</span></span><span class=line><span class=cl>     -&gt; user.visa: Str(****)
</span></span><span class=line><span class=cl>     -&gt; user.amex: Str(3782 822463 10005)
</span></span><span class=line><span class=cl>     -&gt; redaction.masked.keys: Str(user.mastercard,user.visa)
</span></span><span class=line><span class=cl>     -&gt; redaction.masked.count: Int(2)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>      -&gt; user.name: Str(George Lucas)
</span></span><span class=line><span class=cl>      -&gt; user.phone_number: Str(+1555-867-5309)
</span></span><span class=line><span class=cl>      -&gt; user.email: Str(george@deathstar.email)
</span></span><span class=line><span class=cl>      -&gt; user.account_password: Str(LOTR&gt;StarWars1-2-3)
</span></span><span class=line><span class=cl>      -&gt; user.mastercard: Str(5555 5555 5555 4444)
</span></span><span class=line><span class=cl>      -&gt; user.visa: Str(4111 1111 1111 1111)
</span></span><span class=line><span class=cl>      -&gt; user.amex: Str(3782 822463 10005)</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>By including <code>summary:debug</code> in the redaction processor, the debug output will include summary information about which matching keys values were redacted, along with the count of values that were masked.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>     -&gt; redaction.masked.keys: Str(user.mastercard,user.visa)
</span></span><span class=line><span class=cl>     -&gt; redaction.masked.count: Int(2)</span></span></code></pre></div></div></details><p><strong>Check file output</strong>: In the newly created <code>gateway-traces.out</code> file to verify confirm that <code>user.visa</code> & <code>user.mastercard</code> have been updated.</p><div class=tab-panel data-tab-group=946891825edf135c8e831a2e190f04a2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-file-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("946891825edf135c8e831a2e190f04a2","new-file-output")'>
<span class=tab-nav-text>New File Output</span>
</button>
<button data-tab-item=original-file-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("946891825edf135c8e831a2e190f04a2","original-file-output")'>
<span class=tab-nav-text>Original File Output</span></button></div><div class=tab-content-container><div data-tab-item=new-file-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;attributes&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;UNKNOWN NUMBER&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;62d5e03d8fd5808e77aee5ebbd90cf7627a470ae0be9ffd10e8025a4ad0e1287&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;****&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;****&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span></span></span></code></pre></div></div></div><div data-tab-item=original-file-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;attributes&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;George Lucas&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.phone_number&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;+1555-867-5309&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;george@deathstar.email&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.account_password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;LOTR&gt;StarWars1-2-3&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.mastercard&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;5555 5555 5555 4444&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>  
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;user.visa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;4111 1111 1111 1111&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;user.amex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;value&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;3782 822463 10005&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>               <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span></span></span></code></pre></div></div></div></div></div></div></details></p><p>These are just a few examples of how <code>attributes</code> and <code>redaction</code> processors can be configured to protect sensitive data.</p><p>Stop the <strong>Agent</strong> and <strong>Gateway</strong> using <code>Ctrl-C</code>.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=7-transform-data>7. Transform Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/transformprocessor/README.md rel=external target=_blank><strong>Transform Processor</strong></a> lets you modify telemetry dataâ€”logs, metrics, and tracesâ€”as it flows through the pipeline. Using the <strong>OpenTelemetry Transformation Language (OTTL)</strong>, you can filter, enrich, and transform data on the fly without touching your application code.</p><p>In this exercise weâ€™ll update <code>agent.yaml</code> to include a <strong>Transform Processor</strong> that will:</p><ul><li><strong>Filter</strong> log resource attributes.</li><li><strong>Parse</strong> JSON structured log data into attributes.</li><li><strong>Set</strong> log severity levels based on the log message body.</li></ul><p>You may have noticed that in previous logs, fields like <code>SeverityText</code> and <code>SeverityNumber</code> were undefined (this is typical of the <code>filelog</code> receiver). However, the severity is embedded within the log body:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;snip&gt;
</span></span><span class=line><span class=cl>LogRecord #0
</span></span><span class=line><span class=cl>ObservedTimestamp: 2025-01-31 21:49:29.924017 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>SeverityText: 
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-01-31 15:49:29 [WARN] - Do or do not, there is no try.)
</span></span><span class=line><span class=cl>&lt;/snip&gt;</span></span></code></pre></div><p>Logs often contain structured data encoded as JSON within the log body. Extracting these fields into attributes allows for better indexing, filtering, and querying. Instead of manually parsing JSON in downstream systems, OTTL enables automatic transformation at the telemetry pipeline level.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>7-transform</code>.</li><li>Next, copy all contents from the <code>6-sensitve-data</code> directory into <code>7-transform</code>.</li><li>After copying, remove any <code>*.out</code> and <code>*.log</code> files.</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/7-transform</code> directory.</li></ul><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=89ab8a28fa4f27dc169c2c031af20e86><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("89ab8a28fa4f27dc169c2c031af20e86","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”œâ”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”œâ”€â”€ 5-dropping-spans
</span></span><span class=line><span class=cl>â”œâ”€â”€ 6-sensitive-data
</span></span><span class=line><span class=cl>â”œâ”€â”€ 7-transform-data
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€â”€checkpoint-dir
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ health.json
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ log-gen.sh (or .ps1)
</span></span><span class=line><span class=cl>â”‚   â””â”€â”€ trace.json
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 7. Transform Data</h1><article class=default><header class=headline></header><h1 id=71-transform-configuration>7.1 Transform Configuration</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Configure the <code>transform</code> processor</strong> and name it <code>/logs</code>: By using the <code>-context: resource</code> key we are targeting the <code>resourceLog</code> attributes of logs.</p><p>This configuration ensures that only the relevant resource attributes (<code>com.splunk.sourcetype</code>, <code>host.name</code>, <code>otelcol.service.mode</code>) are retained, improving log efficiency and reducing unnecessary metadata.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>transform/logs</span><span class=p>:</span><span class=w>                     </span><span class=c># Processor Type/Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>log_statements</span><span class=p>:</span><span class=w>                   </span><span class=c># Log Processing Statements</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>resource            </span><span class=w> </span><span class=c># Log Context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statements</span><span class=p>:</span><span class=w>                   </span><span class=c># List of attribute keys to keep</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>keep_keys(attributes, [&#34;com.splunk.sourcetype&#34;, &#34;host.name&#34;, &#34;otelcol.service.mode&#34;])</span></span></span></code></pre></div><p><strong>Adding a Context Block for Log Severity Mapping</strong>: To properly set the <code>severity_text</code> and <code>severity_number</code> fields of a log record, we add another log <code>context</code> block within <code>log_statements</code>.</p><p>This configuration extracts the <code>level</code> value from the log body, maps it to <code>severity_text</code>, and assigns the appropriate <code>severity_number</code>:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>      </span>- <span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>log                 </span><span class=w> </span><span class=c># Log Context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>statements</span><span class=p>:</span><span class=w>                   </span><span class=c># Transform Statements Array</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(cache, ParseJSON(body)) where IsMatch(body, &#34;^\\{&#34;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>flatten(cache, &#34;&#34;)        </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>merge_maps(attributes, cache, &#34;upsert&#34;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_text, attributes[&#34;level&#34;])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 1) where severity_text == &#34;TRACE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 5) where severity_text == &#34;DEBUG&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 9) where severity_text == &#34;INFO&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 13) where severity_text == &#34;WARN&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 17) where severity_text == &#34;ERROR&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>set(severity_number, 21) where severity_text == &#34;FATAL&#34;</span></span></span></code></pre></div><p><strong>Summary of Key Transformations</strong>:</p><ul><li><strong>Parse JSON</strong>: Extracts structured data from the log body.</li><li><strong>Flatten JSON</strong>: Converts nested JSON objects into a flat structure.</li><li><strong>Merge Attributes</strong>: Integrates extracted data into log attributes.</li><li><strong>Map Severity Text</strong>: Assigns severity_text from the logâ€™s level attribute.</li><li><strong>Assign Severity Numbers</strong>: Converts severity levels into standardized numerical values.</li></ul><p>You should have a <strong>single</strong> <code>transform</code> processor containing two context blocks: one for <code>resource</code> and one for <code>log</code>.</p><p>This configuration ensures that log severity is correctly extracted, standardized, and structured for efficient processing.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>This method of mapping all JSON fields to top-level attributes should only be used for <strong>testing and debugging OTTL</strong>. It will result in high cardinality in a production scenario.</p></div></details><p><strong>Update the <code>logs</code> pipeline</strong>: Add the <code>transform/logs:</code> processor into the <code>logs:</code> pipeline:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>logs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                    </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>filelog/quotes          </span><span class=w> </span><span class=c># Filelog Receiver reading quotes.log</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter          </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resourcedetection       </span><span class=w> </span><span class=c># Adds system attributes to the data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode       </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>transform/logs          </span><span class=w> </span><span class=c># Transform Processor to update log lines</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>batch                   </span><span class=w> </span><span class=c># Batch Processor, groups data before send</span></span></span></code></pre></div></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>logs:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      REC2(filelog&lt;br&gt;fa:fa-download&lt;br&gt;quotes):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(resourcedetection&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip&lt;br&gt;add_mode):::processor
      PRO4(transform&lt;br&gt;fa:fa-microchip&lt;br&gt;logs):::processor
      PRO5(batch&lt;br&gt;fa:fa-microchip):::processor
      EXP1(otlphttp&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;ensp;&amp;ensp;debug&amp;ensp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
    %% Links
    subID1:::sub-logs
    subgraph &#34; &#34;
      subgraph subID1[**Logs**]
      direction LR
      REC1 --&gt; PRO1
      REC2 --&gt; PRO1
      PRO1 --&gt; PRO2
      PRO2 --&gt; PRO3
      PRO3 --&gt; PRO4
      PRO4 --&gt; PRO5
      PRO5 --&gt; EXP2
      PRO5 --&gt; EXP1
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-logs stroke:#34d399,stroke-width:1px, color:#34d399,stroke-dasharray: 3 3;</pre><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=72-setup-environment>7.2 Setup Environment</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Log Generator</strong>: In the <strong>Test</strong> terminal window, navigate to the <code>[WORKSHOP]/7-transform-data</code> directory and start the appropriate <code>log-gen</code> script for your system. We want to work with structured JSON logs, so add the <code>-json</code> flag.</p><div class=tab-panel data-tab-group=869508a331a19255ec3ab0e4233c30cd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-generator class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("869508a331a19255ec3ab0e4233c30cd","log-generator")'>
<span class=tab-nav-text>Log Generator</span></button></div><div class=tab-content-container><div data-tab-item=log-generator class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>./log-gen.sh -json</span></span></code></pre></div></div></div></div></div><p>The script will begin writing lines to a file named <code>./quotes.log</code>, while displaying a single line of output in the console.</p><div class=tab-panel data-tab-group=e2d88d594e5d76a49e73d37a1e9eca08><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=log-generator-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e2d88d594e5d76a49e73d37a1e9eca08","log-generator-output")'>
<span class=tab-nav-text>Log Generator Output</span></button></div><div class=tab-content-container><div data-tab-item=log-generator-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>Writing logs to quotes.log. Press Ctrl+C to stop.</span></span></code></pre></div></div></div></div></div><p><strong>Start the Gateway</strong>: In the <strong>Gateway</strong> terminal window navigate to the <code>[WORKSHOP]/7-transform-data</code> directory and run:</p><div class=tab-panel data-tab-group=b27a47c0d3bf6b9d86744b3ffb1f5505><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=gateway class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b27a47c0d3bf6b9d86744b3ffb1f5505","gateway")'>
<span class=tab-nav-text>Gateway</span></button></div><div class=tab-content-container><div data-tab-item=gateway class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div></div></div></div></div><p><strong>Start the Agent</strong>: In the <strong>Agent</strong> terminal window navigate to the <code>[WORKSHOP]/7-transform-data</code> directory and run:</p><div class=tab-panel data-tab-group=0ebaa8dedf224709cc0147543243463c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=agent class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0ebaa8dedf224709cc0147543243463c","agent")'>
<span class=tab-nav-text>Agent</span></button></div><div class=tab-content-container><div data-tab-item=agent class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>agent.yaml</span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=73-test-transform-processor>7.3 Test Transform Processor</h1><p>This test verifies that the <code>com.splunk/source</code> and <code>os.type</code> metadata have been <strong>removed</strong> from the log resource attributes before being exported by the <strong>Agent</strong>. Additionally, the test ensures that:</p><ol><li>The log body is parsed to extract severity information.<ul><li><code>SeverityText</code> and <code>SeverityNumber</code> are set on the <code>LogRecord</code>.</li></ul></li><li>JSON fields from the log body are promoted to log <code>attributes</code>.</li></ol><p>This ensures proper metadata filtering, severity mapping, and structured log enrichment before export.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Check the debug output</strong>: For both the <strong>Agent</strong> and <strong>Gateway</strong> confirm that <code>com.splunk/source</code> and <code>os.type</code> have been removed:</p><div class=tab-panel data-tab-group=cbe0c22c79fbfc33e316730f6d34c3dc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("cbe0c22c79fbfc33e316730f6d34c3dc","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("cbe0c22c79fbfc33e316730f6d34c3dc","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>  Resource attributes:
</span></span><span class=line><span class=cl>   -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>   -&gt; host.name: Str(YOUR_HOST_NAME)
</span></span><span class=line><span class=cl>   -&gt; otelcol.service.mode: Str(agent)</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>  Resource attributes:
</span></span><span class=line><span class=cl>   -&gt; com.splunk.sourcetype: Str(quotes)
</span></span><span class=line><span class=cl>   -&gt; com.splunk/source: Str(./quotes.log)
</span></span><span class=line><span class=cl>   -&gt; host.name: Str(YOUR_HOST_NAME)
</span></span><span class=line><span class=cl>   -&gt; os.type: Str(YOUR_OS)
</span></span><span class=line><span class=cl>   -&gt; otelcol.service.mode: Str(agent)</span></span></code></pre></div></div></div></div></div><p><strong>Check the debug output</strong>: For both the <strong>Agent</strong> and <strong>Gateway</strong> confirm that <code>SeverityText</code> and <code>SeverityNumber</code> in the <code>LogRecord</code> is now defined with the severity <code>level</code> from the log body. Confirm that the JSON fields from the body can be accessed as top-level log <code>Attributes</code>:</p><div class=tab-panel data-tab-group=683e8b078c931465d296410cb8cc90b0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-debug-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("683e8b078c931465d296410cb8cc90b0","new-debug-output")'>
<span class=tab-nav-text>New Debug Output</span>
</button>
<button data-tab-item=original-debug-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("683e8b078c931465d296410cb8cc90b0","original-debug-output")'>
<span class=tab-nav-text>Original Debug Output</span></button></div><div class=tab-content-container><div data-tab-item=new-debug-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>LogRecord #0
</span></span><span class=line><span class=cl>ObservedTimestamp: 2025-01-31 21:49:29.924017 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>SeverityText: WARN
</span></span><span class=line><span class=cl>SeverityNumber: Warn(13)
</span></span><span class=line><span class=cl>Body: Str(2025-01-31 15:49:29 [WARN] - Do or do not, there is no try.)
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>    -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>    -&gt; timestamp: Str(2025-01-31 15:49:29)
</span></span><span class=line><span class=cl>    -&gt; level: Str(WARN)
</span></span><span class=line><span class=cl>    -&gt; message: Str(Do or do not, there is no try.)
</span></span><span class=line><span class=cl>Trace ID:
</span></span><span class=line><span class=cl>Span ID:
</span></span><span class=line><span class=cl>Flags: 0
</span></span><span class=line><span class=cl>  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div></div></div><div data-tab-item=original-debug-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>LogRecord #0
</span></span><span class=line><span class=cl>ObservedTimestamp: 2025-01-31 21:49:29.924017 +0000 UTC
</span></span><span class=line><span class=cl>Timestamp: 1970-01-01 00:00:00 +0000 UTC
</span></span><span class=line><span class=cl>SeverityText: 
</span></span><span class=line><span class=cl>SeverityNumber: Unspecified(0)
</span></span><span class=line><span class=cl>Body: Str(2025-01-31 15:49:29 [WARN] - Do or do not, there is no try.)
</span></span><span class=line><span class=cl>Attributes:
</span></span><span class=line><span class=cl>    -&gt; log.file.path: Str(quotes.log)
</span></span><span class=line><span class=cl>Trace ID:
</span></span><span class=line><span class=cl>Span ID:
</span></span><span class=line><span class=cl>Flags: 0
</span></span><span class=line><span class=cl>  {&#34;kind&#34;: &#34;exporter&#34;, &#34;data_type&#34;: &#34;logs&#34;, &#34;name&#34;: &#34;debug&#34;}</span></span></code></pre></div></div></div></div></div><p><strong>Check file output</strong>: In the new <code>gateway-logs.out</code> file verify the data has been transformed:</p><div class=tab-panel data-tab-group=f6bf696c8752f9110eff1a50afe71ab7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=new-file-output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f6bf696c8752f9110eff1a50afe71ab7","new-file-output")'>
<span class=tab-nav-text>New File Output</span>
</button>
<button data-tab-item=original-file-output class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("f6bf696c8752f9110eff1a50afe71ab7","original-file-output")'>
<span class=tab-nav-text>Original File Output</span></button></div><div class=tab-content-container><div data-tab-item=new-file-output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>      <span class=s2>&#34;resource&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_HOST_NAME&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span><span class=err>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;scopeLogs&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;logRecords&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1738360169924017000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;severityText&#34;</span><span class=p>:</span> <span class=s2>&#34;WARN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-01-31 15:49:29 [WARN] - Do or do not, there is no try.&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;timestamp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-01-31 15:49:29&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;level&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;WARN&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;message&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;Do or do not, there is no try.&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span></span></span></code></pre></div></div></div><div data-tab-item=original-file-output class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>      <span class=s2>&#34;resource&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.sourcetype&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;com.splunk.source&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;./quotes.log&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;host.name&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_HOST_NAME&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;os.type&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;YOUR_OS&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;otelcol.service.mode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;agent&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span><span class=err>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;scopeLogs&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;scope&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;logRecords&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;observedTimeUnixNano&#34;</span><span class=p>:</span> <span class=s2>&#34;1738349801265812000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;body&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;2025-01-31 12:56:41 [INFO] - There is some good in this world, and it&#39;s worth fighting for.&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;attributes&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;key&#34;</span><span class=p>:</span> <span class=s2>&#34;log.file.path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;value&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&#34;stringValue&#34;</span><span class=p>:</span> <span class=s2>&#34;quotes.log&#34;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;traceId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;spanId&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span></span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=8-routing-data>8. Routing Data</h1><span class="badge cstyle primary badge-with-title"><span class=badge-title><i class="fa-fw fas fa-clock"></i></span><span class=badge-content>10 minutes</span>
</span>&nbsp;<p>The <a href=https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/connector/routingconnector rel=external target=_blank><strong>Routing Connector</strong></a> in OpenTelemetry is a powerful feature that allows you to direct data (<code>traces</code>, <code>metrics</code>, or <code>logs</code>) to different pipelines based on specific criteria. This is especially useful in scenarios where you want to apply different processing or exporting logic to subsets of your telemetry data.</p><p>For example, you might want to send <em>production</em> data to one exporter while directing <em>test</em> or <em>development</em> data to another. Similarly, you could route certain spans based on their attributes, such as service name, environment, or span name, to apply custom processing or storage logic.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><ul><li>Inside the <code>[WORKSHOP]</code> directory, create a new subdirectory named <code>8-routing</code>.</li><li>Next, copy all contents from the <code>7-transform-data</code> directory into <code>8-routing</code>.</li><li>After copying, remove any <code>*.out</code> and <code>*.log</code> files.</li><li>Change <strong>all</strong> terminal windows to the <code>[WORKSHOP]/8-routing</code> directory.</li></ul><p>Your updated directory structure will now look like this:</p><div class=tab-panel data-tab-group=be8a2e952877f7c8b430e70a9d41af3e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=updated-directory-structure class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("be8a2e952877f7c8b430e70a9d41af3e","updated-directory-structure")'>
<span class=tab-nav-text>Updated Directory Structure</span></button></div><div class=tab-content-container><div data-tab-item=updated-directory-structure class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WORKSHOP
</span></span><span class=line><span class=cl>â”œâ”€â”€ 1-agent
</span></span><span class=line><span class=cl>â”œâ”€â”€ 2-gateway
</span></span><span class=line><span class=cl>â”œâ”€â”€ 3-filelog
</span></span><span class=line><span class=cl>â”œâ”€â”€ 4-resilience
</span></span><span class=line><span class=cl>â”œâ”€â”€ 5-dropping-spans
</span></span><span class=line><span class=cl>â”œâ”€â”€ 6-sensitive-data
</span></span><span class=line><span class=cl>â”œâ”€â”€ 7-transform-data
</span></span><span class=line><span class=cl>â”œâ”€â”€ 8-routing
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€â”€checkpoint-dir
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ agent.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ health.json
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ gateway.yaml
</span></span><span class=line><span class=cl>â”‚   â”œâ”€â”€ log-gen.sh (or .ps1)
</span></span><span class=line><span class=cl>â”‚Â Â  â””â”€â”€ trace.json
</span></span><span class=line><span class=cl>â””â”€â”€ otelcol</span></span></code></pre></div></div></div></div></div></div></details><p>Next, we will configure the routing connector and the respective pipelines.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><section><h1 class=a11y-only>Subsections of 8. Routing Data</h1><article class=default><header class=headline></header><h1 id=81-configure-the-routing-connector>8.1 Configure the Routing Connector</h1><p>In this exercise, you will configure the <code>routing</code> connector in the <code>gateway.yaml</code> file. This setup enables the <strong>Gateway</strong> to route traces based on the <code>deployment.environment</code> attribute in the spans you send. By implementing this, you can process and handle traces differently depending on their attributes.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add the <code>routing</code> connector</strong>: In the <strong>Gateway</strong> terminal window edit <code>gateway.yaml</code> and add the following below the <code>receivers:</code> section and above the <code>processors:</code> section:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>connectors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>default_pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/standard]</span><span class=w> </span><span class=c># Default pipeline if no rule matches</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>error_mode</span><span class=p>:</span><span class=w> </span><span class=l>ignore                  </span><span class=w> </span><span class=c># Ignore errors in routing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>table</span><span class=p>:</span><span class=w>                               </span><span class=c># Define routing rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Routes spans to a target pipeline if the resourceSpan attribute matches the rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>statement</span><span class=p>:</span><span class=w> </span><span class=l>route() where attributes[&#34;deployment.environment&#34;] == &#34;security_applications&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>pipelines</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>traces/security]    </span><span class=w> </span><span class=c># Target pipeline </span></span></span></code></pre></div><p>In OpenTelemetry configuration files, <code>connectors</code> have their own dedicated section, similar to receivers and processors. This approach also applies to <code>metrics</code> and <code>logs</code>, allowing them to be routed based on attributes in <code>resourceMetrics</code> or <code>resourceLogs</code>.</p><p><strong>Configure <code>file:</code> exporters</strong>: The <code>routing</code> connector requires separate targets for routing. Add two file exporters, <code>file/traces/security</code> and <code>file/traces/standard</code>, to ensure data is directed correctly:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/standard</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter for regular traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-standard.out&#34;</span><span class=w>  </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                          </span><span class=c># Overwrite the file each time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>file/traces/security</span><span class=p>:</span><span class=w>                    </span><span class=c># Exporter for security traces</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;./gateway-traces-security.out&#34;</span><span class=w>  </span><span class=c># Path for saving trace data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>append</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>                          </span><span class=c># Overwrite the file each time </span></span></span></code></pre></div></div></details><p>With the <code>routing</code> configuration complete, the next step is to configure the <code>pipelines</code> to apply these routing rules.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=82-configuring-the-pipelines>8.2 Configuring the Pipelines</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Add both the <code>standard</code> and <code>security</code> traces pipelines</strong>:</p><ol><li><p><strong>Standard pipeline</strong>: This pipeline processes all spans that do not match the routing rule. Add it below the existing <code>traces:</code> pipeline, keeping the configuration unchanged for now:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/standard</span><span class=p>:</span><span class=w>                </span><span class=c># Default pipeline for unmatched spans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                    </span><span class=w> </span><span class=c># Receive data from the routing connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter             </span><span class=w> </span><span class=c># Limits memory usage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode          </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                      </span><span class=w> </span><span class=c># Debug exporter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/standard       </span><span class=w> </span><span class=c># File exporter for unmatched spans</span></span></span></code></pre></div></li><li><p><strong>Security pipeline</strong>: This pipeline will handle all spans that match the routing rule:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span><span class=nt>traces/security</span><span class=p>:</span><span class=w>                </span><span class=c># New Security Traces/Spans Pipeline       </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                    </span><span class=w> </span><span class=c># Routing Connector, Only receives data from Connector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>memory_limiter             </span><span class=w> </span><span class=c># Memory Limiter Processor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>resource/add_mode          </span><span class=w> </span><span class=c># Adds collector mode metadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>debug                      </span><span class=w> </span><span class=c># Debug Exporter </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>file/traces/security       </span><span class=w> </span><span class=c># File Exporter for spans matching rule</span></span></span></code></pre></div></li></ol><p><strong>Update the <code>traces</code> pipeline to use routing</strong>:</p><ol><li><p>To enable <code>routing</code>, update the original <code>traces:</code> pipeline by adding <code>routing</code> as an exporter. This ensures all span data is sent through the routing connector for evaluation.</p></li><li><p>Remove all processors as these are now defined in the <code>traces/standard</code> and <code>traces/security</code> pipelines.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>pipelines</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>traces</span><span class=p>:</span><span class=w>                           </span><span class=c># Original traces pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>receivers</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>otlp                         </span><span class=w> </span><span class=c># OTLP Receiver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>processors</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>exporters</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>routing                      </span><span class=w> </span><span class=c># Routing Connector</span></span></span></code></pre></div></li></ol></div></details><details open class="box cstyle notices note"><summary class=box-label><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p>By excluding the batch processor, spans are written immediately instead of waiting for multiple spans to accumulate before processing. This improves responsiveness, making the workshop run faster and allowing you to see results sooner.</p></div></details><p>Validate the agent configuration using <strong><a href=https://www.otelbin.io/ rel=external target=_blank>otelbin.io</a></strong>. For reference, the <code>traces:</code> section of your pipelines will look similar to this:</p><pre class="mermaid align-center">%%{init:{&#34;fontFamily&#34;:&#34;monospace&#34;}}%%
graph LR
    %% Nodes
      REC1(&amp;nbsp;&amp;nbsp;&amp;nbsp;otlp&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;fa:fa-download):::receiver
      PRO1(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO2(memory_limiter&lt;br&gt;fa:fa-microchip):::processor
      PRO3(resource&lt;br&gt;fa:fa-microchip):::processor
      PRO4(resource&lt;br&gt;fa:fa-microchip):::processor
      EXP1(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP2(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload):::exporter
      EXP3(&amp;nbsp;&amp;ensp;debug&amp;nbsp;&amp;ensp;&lt;br&gt;fa:fa-upload):::exporter
      EXP4(&amp;emsp;&amp;emsp;file&amp;emsp;&amp;emsp;&lt;br&gt;fa:fa-upload):::exporter
      ROUTE1(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-export
      ROUTE2(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
      ROUTE3(&amp;nbsp;routing&amp;nbsp;&lt;br&gt;fa:fa-route):::con-receive
    %% Links
    subID1:::sub-traces
    subID2:::sub-traces
    subID3:::sub-traces
    subgraph &#34; &#34;
    direction LR
      subgraph subID1[**Traces**]
      REC1 --&gt; ROUTE1
      end
      subgraph subID2[**Traces/standard**]
      ROUTE1 --&gt; ROUTE2
      ROUTE2 --&gt; PRO1
      PRO1 --&gt; PRO3
      PRO3 --&gt; EXP1
      PRO3 --&gt; EXP2
      end
      subgraph subID3[**Traces/security**]
      ROUTE1 --&gt; ROUTE3
      ROUTE3 --&gt; PRO2
      PRO2 --&gt; PRO4
      PRO4 --&gt; EXP3
      PRO4 --&gt; EXP4
      end
    end
classDef receiver,exporter fill:#8b5cf6,stroke:#333,stroke-width:1px,color:#fff;
classDef processor fill:#6366f1,stroke:#333,stroke-width:1px,color:#fff;
classDef con-receive,con-export fill:#45c175,stroke:#333,stroke-width:1px,color:#fff;
classDef sub-traces stroke:#fbbf24,stroke-width:1px, color:#fbbf24,stroke-dasharray: 3 3;</pre><p>Lets&rsquo; test our configuration!</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=83-setup-environment>8.3 Setup Environment</h1><p>In this section, we will test the <code>routing</code> rule configured for the <strong>Gateway</strong>. The expected result is that the<code>span</code> from the <code>security.json</code> file will be sent to the <code>gateway-traces-security.out</code> file.</p><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Start the Gateway</strong>: In the <strong>Gateway</strong> terminal window navigate to the <code>[WORKSHOP]/8-routing</code> directory and run:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>gateway.yaml</span></span></code></pre></div><p><strong>Start the Agent</strong>: In the <strong>Agent</strong> terminal window navigate to the <code>[WORKSHOP]/8-routing</code> directory and run:</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>../otelbin --config<span class=o>=</span>agent.yaml</span></span></code></pre></div><p><strong>Create new security trace</strong>: In the <strong>Tests</strong> terminal window navigate to the <code>[WORKSHOP]/8-routing</code> directory.</p><p>The following JSON contains attributes which will trigger the routing rule. Copy the content from the tab below and save into a file named <code>security.json</code>.</p><div class=tab-panel data-tab-group=b3a100dbed5cd2dfdb159d36a0d0f00f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=securityjson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b3a100dbed5cd2dfdb159d36a0d0f00f","securityjson")'>
<span class=tab-nav-text>security.json</span></button></div><div class=tab-content-container><div data-tab-item=securityjson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;resourceSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;resource&#34;</span><span class=p>:{</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;service.name&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;password_check&#34;</span><span class=p>}},{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;deployment.environment&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;security_applications&#34;</span><span class=p>}}]},</span><span class=nt>&#34;scopeSpans&#34;</span><span class=p>:[{</span><span class=nt>&#34;scope&#34;</span><span class=p>:{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;my.library&#34;</span><span class=p>,</span><span class=nt>&#34;version&#34;</span><span class=p>:</span><span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;my.scope.attribute&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some scope attribute&#34;</span><span class=p>}}]},</span><span class=nt>&#34;spans&#34;</span><span class=p>:[{</span><span class=nt>&#34;traceId&#34;</span><span class=p>:</span><span class=s2>&#34;5B8EFFF798038103D269B633813FC60C&#34;</span><span class=p>,</span><span class=nt>&#34;spanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B174&#34;</span><span class=p>,</span><span class=nt>&#34;parentSpanId&#34;</span><span class=p>:</span><span class=s2>&#34;EEE19B7EC3C1B173&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;I&#39;m a server span&#34;</span><span class=p>,</span><span class=nt>&#34;startTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712660000000000&#34;</span><span class=p>,</span><span class=nt>&#34;endTimeUnixNano&#34;</span><span class=p>:</span><span class=s2>&#34;1544712661000000000&#34;</span><span class=p>,</span><span class=nt>&#34;kind&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;attributes&#34;</span><span class=p>:[{</span><span class=nt>&#34;keytest&#34;</span><span class=p>:</span><span class=s2>&#34;my.span.attr&#34;</span><span class=p>,</span><span class=nt>&#34;value&#34;</span><span class=p>:{</span><span class=nt>&#34;stringValue&#34;</span><span class=p>:</span><span class=s2>&#34;some value&#34;</span><span class=p>}}]}]}]}]}</span></span></span></code></pre></div></div></div></div></div></div></details><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article><article class=default><header class=headline></header><h1 id=84-test-routing-connector>8.4 Test Routing Connector</h1><details open class="box cstyle notices green"><summary class=box-label><i class="fa-fw fas fa-running"></i>
Exercise</summary><div class=box-content><p><strong>Send a Regular Span</strong>:</p><ol><li>Locate the <strong>Test</strong> terminal and navigate to the <code>[WORKSHOP]/8-routing</code> directory.</li><li>Send a regular span using the <code>trace.json</code> file to confirm proper communication.</li></ol><p>Both the <strong>Agent</strong> and <strong>Gateway</strong> should display debug information, including the span you just sent. The gateway will also generate a new <code>gateway-traces-standard.out</code> file, as this is now the designated destination for regular spans.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you check <code>gateway-traces-standard.out</code>, it should contain the <code>span</code> sent using the <code>cURL</code> command. You will also see an empty <code>gateway-traces-security.out</code> file, as the routing configuration creates output files immediately, even if no matching spans have been processed yet.</p></div></details><p><strong>Send a Security Span</strong>:</p><ol><li>Ensure both the <strong>Agent</strong> and <strong>Gateway</strong> are running.</li><li>Send a security span using the <code>security.json</code> file to test the gatewayâ€™s routing rule.</li></ol><p>Again, both the <strong>Agent</strong> and <strong>Gateway</strong> should display debug information, including the span you just sent. This time, the <strong>Gateway</strong> will write a line to the <code>gateway-traces-security.out</code> file, which is designated for spans where the <code>deployment.environment</code> resource attribute matches <code>"security_applications"</code>.
The <code>gateway-traces-standard.out</code> should be unchanged.</p><details open class="box cstyle notices primary"><summary class=box-label><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>If you verify the <code>./gateway-traces-security.out</code> it should only contain the spans from the <code>"security_applications"</code> deployment.environment.</p></div></details><p>You can repeat this scenario multiple times, and each trace will be written to its corresponding output file.</p></div></details><h3 id=conclusion>Conclusion</h3><p>In this section, we successfully tested the routing connector in the gateway by sending different spans and verifying their destinations.</p><ul><li><p><strong>Regular spans</strong> were correctly routed to <code>gateway-traces-default.out</code>, confirming that spans without a matching <code>deployment.environment</code> attribute follow the default pipeline.</p></li><li><p><strong>Security-related spans</strong> from <code>security.json</code> were routed to <code>gateway-traces-security.out</code>, demonstrating that the routing rule based on <code>"deployment.environment": "security_applications"</code> works as expected.</p></li></ul><p>By inspecting the output files, we confirmed that the OpenTelemetry Collector <em>correctly evaluates span attributes and routes them to the appropriate destinations</em>. This validates that routing rules can effectively separate and direct telemetry data for different use cases.</p><p>You can now extend this approach by defining additional routing rules to further categorize spans, metrics, and logs based on different attributes.</p><p>Stop the <strong>Agent</strong>, <strong>Gateway</strong> and the <code>log-gen</code> script in their respective terminals.</p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 7, 2025</span></span></footer></article></section><article class=default><header class=headline></header><h1 id=wrap-up>Wrap-up</h1><p><a href=#R-image-54d7fdafbe08ad8733735263a1362792 class=lightbox-link><img alt="Well done" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../images/welldone.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-54d7fdafbe08ad8733735263a1362792><img alt="Well done" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../images/welldone.png></a></p><footer class=footline><span class="badge cstyle note badge-with-title"><span class=badge-title class=text-muted>Last Modified
</span><span class=badge-content>Feb 3, 2025</span></span></footer></article></section></div></main></div><script src=/observability-workshop/v5.80/js/clipboard.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/perfect-scrollbar.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-color.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-dispatch.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-drag.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-ease.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-interpolate.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-selection.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-timer.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-transition.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/d3/d3-zoom.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/js-yaml.min.js?1738950861 defer></script><script src=/observability-workshop/v5.80/js/mermaid.min.js?1738950861 defer></script><script>window.themeUseMermaid=JSON.parse("{}")</script><script src=/observability-workshop/v5.80/js/theme.js?1738950861 defer></script></body></html>